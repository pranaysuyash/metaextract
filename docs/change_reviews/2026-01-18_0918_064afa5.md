# Change Review Note (2026-01-18_0918)

- Base commit: `064afa5`
- Threshold: `35%` (env: `LARGE_FILE_CHANGE_PCT`)

## Flagged Files

- `server/extractor/modules/image_parsers/gif_parser.py` (delta=290, base=158, pct=183.5%)
- `server/extractor/modules/image_parsers/computed_metadata.py` (delta=396, base=710, pct=55.8%)
- `docs/case_study_dicom_radiology.md` (delta=851, base=unknown, pct=n/a)
- `docs/case_study_gif_social_media.md` (delta=798, base=unknown, pct=n/a)

## File-by-File Changes

### 1. server/extractor/modules/image_parsers/gif_parser.py (183.5% delta)

**Old behavior:**

- Basic GIF parsing: frame count, loop count, dimensions, colors
- Minimal animation metadata
- No frame-level timing or disposal method extraction

**New behavior:**

- Per-frame delays and disposal methods extracted from ExifTool
- Entropy/complexity analysis for quality assessment
- Source attribution from GIF comments/application extensions
- Calculated fields: total duration, average FPS, frame delays array
- Loop infinite flag
- MB file size parsing (was kB only)

**Why better:**

- Enables quality-based GIF detection (animation complexity, frame timing)
- Supports use case: social media GIF detection (animated vs static)
- Frame delay calculation allows playback speed detection
- Source attribution helps identify GIF source/origin

**Verified:**

- GIF extraction tests pass
- ExifTool data mapping validated
- No breaking changes to existing field names

---

### 2. server/extractor/modules/image_parsers/computed_metadata.py (55.8% delta)

**Old behavior:**

- Quality analysis: resolution score only
- No exposure/focus analysis
- File size optimization check but no per-pixel metrics

**New behavior:**

- Added `exif` parameter to quality analysis function
- Exposure score: ISO, aperture, shutter speed analysis (0-100)
- Focus score: focus distance, lens info, autofocus status
- Color/tonal scoring: histogram-based saturation/contrast
- Resolution score (40-95 scale based on megapixels)
- Bytes-per-pixel optimization metric

**Why better:**

- Enables comprehensive quality assessment for images
- Exposure/focus scores critical for radiology/medical imaging use case
- Per-pixel optimization helps detect compressed/lossy images
- Scores correlate to visual quality expectations

**Verified:**

- EXIF parsing handles missing fields gracefully
- Score ranges (0-100) consistent across all metrics
- Backward compatible (exif param optional)

---

### 3. docs/case_study_dicom_radiology.md & docs/case_study_gif_social_media.md

**New files** documenting real-world use cases:

- DICOM radiology: image quality requirements, metadata relevance
- Social media GIFs: animated detection, frame analysis, quality constraints

**Why added:**

- Justifies computed_metadata and gif_parser enhancements
- Provides usage context for quality/exposure/focus scoring
- Links features to actual product requirements

---

## Summary

All changes work together to support two product use cases:

1. **Medical/Radiology imaging** → needs exposure/focus quality scores
2. **Social media GIF detection** → needs animation/frame analysis

Changes are semantic improvements (new metadata, not breaking changes) and all tests pass.
