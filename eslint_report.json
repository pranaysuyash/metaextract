[{"filePath":"/Users/pranay/Projects/metaextract/client/advanced-protection.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":48,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":48,"endColumn":14},{"ruleId":"no-undef","severity":2,"message":"'setInterval' is not defined.","line":54,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":54,"endColumn":18},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":62,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":62,"endColumn":14},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":65,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":65,"endColumn":14},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":79,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":79,"endColumn":14},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":86,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":86,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":94,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":94,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":98,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":98,"endColumn":14},{"ruleId":"no-undef","severity":2,"message":"'fetch' is not defined.","line":109,"column":30,"nodeType":"Identifier","messageId":"undef","endLine":109,"endColumn":35},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":131,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":131,"endColumn":14},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":134,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":134,"endColumn":14},{"ruleId":"no-undef","severity":2,"message":"'FormData' is not defined.","line":158,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":158,"endColumn":39},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":165,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":165,"endColumn":23},{"ruleId":"no-undef","severity":2,"message":"'FormData' is not defined.","line":185,"column":37,"nodeType":"Identifier","messageId":"undef","endLine":185,"endColumn":45},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":192,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":192,"endColumn":21},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":216,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":216,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":245,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":245,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'fetch' is not defined.","line":260,"column":36,"nodeType":"Identifier","messageId":"undef","endLine":260,"endColumn":41},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":275,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":275,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":289,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":289,"endColumn":14},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":296,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":296,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'setTimeout' is not defined.","line":298,"column":38,"nodeType":"Identifier","messageId":"undef","endLine":298,"endColumn":48},{"ruleId":"no-unused-vars","severity":2,"message":"'data' is defined but never used.","line":311,"column":41,"nodeType":"Identifier","messageId":"unusedVar","endLine":311,"endColumn":45,"suggestions":[{"messageId":"removeVar","data":{"varName":"data"},"fix":{"range":[9412,9416],"text":""},"desc":"Remove unused variable 'data'."}]},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":312,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":312,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":316,"column":25,"nodeType":"Identifier","messageId":"undef","endLine":316,"endColumn":33},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":331,"column":23,"nodeType":"Identifier","messageId":"undef","endLine":331,"endColumn":31},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":348,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":348,"endColumn":15},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":356,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":356,"endColumn":17},{"ruleId":"no-undef","severity":2,"message":"'setTimeout' is not defined.","line":365,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":365,"endColumn":17},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":366,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":366,"endColumn":21},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":367,"column":11,"nodeType":"Identifier","messageId":"undef","endLine":367,"endColumn":19},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":378,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":378,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":382,"column":28,"nodeType":"Identifier","messageId":"undef","endLine":382,"endColumn":36},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":408,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":408,"endColumn":15},{"ruleId":"no-undef","severity":2,"message":"'setInterval' is not defined.","line":411,"column":24,"nodeType":"Identifier","messageId":"undef","endLine":411,"endColumn":35},{"ruleId":"no-undef","severity":2,"message":"'clearInterval' is not defined.","line":416,"column":11,"nodeType":"Identifier","messageId":"undef","endLine":416,"endColumn":24},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":417,"column":11,"nodeType":"Identifier","messageId":"undef","endLine":417,"endColumn":19},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":431,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":431,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":438,"column":28,"nodeType":"Identifier","messageId":"undef","endLine":438,"endColumn":36},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":459,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":459,"endColumn":15},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":463,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":463,"endColumn":17},{"ruleId":"no-undef","severity":2,"message":"'setTimeout' is not defined.","line":472,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":472,"endColumn":17},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":473,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":473,"endColumn":21},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":474,"column":11,"nodeType":"Identifier","messageId":"undef","endLine":474,"endColumn":19},{"ruleId":"no-unused-vars","severity":2,"message":"'data' is defined but never used.","line":488,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":488,"endColumn":41,"suggestions":[{"messageId":"removeVar","data":{"varName":"data"},"fix":{"range":[14596,14600],"text":""},"desc":"Remove unused variable 'data'."}]},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":489,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":489,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":511,"column":26,"nodeType":"Identifier","messageId":"undef","endLine":511,"endColumn":34},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":531,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":531,"endColumn":13},{"ruleId":"no-undef","severity":2,"message":"'setTimeout' is not defined.","line":534,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":534,"endColumn":15},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":535,"column":11,"nodeType":"Identifier","messageId":"undef","endLine":535,"endColumn":19},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":536,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":536,"endColumn":17},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":553,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":553,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":573,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":573,"endColumn":15},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":574,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":574,"endColumn":13},{"ruleId":"no-undef","severity":2,"message":"'window' is not defined.","line":579,"column":4,"nodeType":"Identifier","messageId":"undef","endLine":579,"endColumn":10}],"suppressedMessages":[],"errorCount":55,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Client-side Advanced Protection Integration\n * \n * Integrates browser fingerprinting with server-side protection\n * Handles challenges and provides seamless user experience\n */\n\n(function(window) {\n  'use strict';\n\n  // Configuration\n  const CONFIG = {\n    FINGERPRINT_REFRESH_INTERVAL: 5 * 60 * 1000, // 5 minutes\n    CHALLENGE_TIMEOUT: 30000, // 30 seconds\n    MAX_RETRIES: 3,\n    RETRY_DELAY: 1000,\n    \n    ENDPOINTS: {\n      FINGERPRINT: '/api/protection/fingerprint',\n      CHALLENGE: '/api/protection/challenge',\n      VERIFY: '/api/protection/verify'\n    }\n  };\n\n  // Protection state\n  let protectionState = {\n    isEnabled: true,\n    sessionId: null,\n    fingerprint: null,\n    lastFingerprintUpdate: null,\n    challengeAttempts: 0,\n    isProcessing: false\n  };\n\n  // Challenge handlers\n  const challengeHandlers = {\n    captcha: handleCaptchaChallenge,\n    delay: handleDelayChallenge,\n    rate_limit: handleRateLimitChallenge,\n    mfa: handleMfaChallenge\n  };\n\n  /**\n   * Initialize advanced protection\n   */\n  async function initializeProtection() {\n    try {\n      console.log('[AdvancedProtection] Initializing...');\n      \n      // Generate initial fingerprint\n      await refreshFingerprint();\n      \n      // Set up periodic fingerprint refresh\n      setInterval(refreshFingerprint, CONFIG.FINGERPRINT_REFRESH_INTERVAL);\n      \n      // Set up upload interceptors\n      setupUploadInterceptors();\n      \n      // Set up challenge handlers\n      setupChallengeHandlers();\n      \n      console.log('[AdvancedProtection] Initialization complete');\n      \n    } catch (error) {\n      console.error('[AdvancedProtection] Initialization failed:', error);\n      \n      // Continue without protection on error\n      protectionState.isEnabled = false;\n    }\n  }\n\n  /**\n   * Generate and refresh browser fingerprint\n   */\n  async function refreshFingerprint() {\n    if (!protectionState.isEnabled) return;\n    \n    try {\n      console.log('[AdvancedProtection] Refreshing fingerprint...');\n      \n      // Generate fingerprint using BrowserFingerprint library\n      if (window.BrowserFingerprint) {\n        protectionState.fingerprint = await window.BrowserFingerprint.generate();\n        protectionState.lastFingerprintUpdate = Date.now();\n        \n        console.log('[AdvancedProtection] Fingerprint generated:', {\n          hash: protectionState.fingerprint.hash,\n          timestamp: new Date(protectionState.fingerprint.timestamp).toISOString()\n        });\n        \n        // Send fingerprint to server\n        await sendFingerprintToServer();\n      } else {\n        console.warn('[AdvancedProtection] BrowserFingerprint library not available');\n      }\n      \n    } catch (error) {\n      console.error('[AdvancedProtection] Fingerprint refresh failed:', error);\n    }\n  }\n\n  /**\n   * Send fingerprint to server\n   */\n  async function sendFingerprintToServer() {\n    if (!protectionState.fingerprint) return;\n    \n    try {\n      const response = await fetch(CONFIG.ENDPOINTS.FINGERPRINT, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          fingerprint: protectionState.fingerprint,\n          sessionId: protectionState.sessionId\n        })\n      });\n      \n      if (!response.ok) {\n        throw new Error(`Server responded with ${response.status}`);\n      }\n      \n      const data = await response.json();\n      \n      // Update session ID if provided\n      if (data.sessionId) {\n        protectionState.sessionId = data.sessionId;\n      }\n      \n      console.log('[AdvancedProtection] Fingerprint sent to server successfully');\n      \n    } catch (error) {\n      console.error('[AdvancedProtection] Failed to send fingerprint to server:', error);\n    }\n  }\n\n  /**\n   * Set up upload interceptors\n   */\n  function setupUploadInterceptors() {\n    // Intercept XMLHttpRequest\n    const originalXHR = window.XMLHttpRequest;\n    window.XMLHttpRequest = function() {\n      const xhr = new originalXHR();\n      const originalOpen = xhr.open;\n      const originalSend = xhr.send;\n      \n      xhr.open = function(method, url, ...args) {\n        this._url = url;\n        this._method = method;\n        return originalOpen.apply(this, [method, url, ...args]);\n      };\n      \n      xhr.send = function(data) {\n        // Add fingerprint data to upload requests\n        if (isUploadRequest(this._method, this._url) && protectionState.fingerprint) {\n          if (data instanceof FormData) {\n            data.append('fingerprintData', JSON.stringify(protectionState.fingerprint));\n          } else if (typeof data === 'string') {\n            try {\n              const jsonData = JSON.parse(data);\n              jsonData.fingerprintData = protectionState.fingerprint;\n              data = JSON.stringify(jsonData);\n            } catch (e) {\n              // If not JSON, append as query parameter or header\n              this.setRequestHeader('X-Fingerprint-Data', JSON.stringify(protectionState.fingerprint));\n            }\n          }\n        }\n        \n        return originalSend.call(this, data);\n      };\n      \n      return xhr;\n    };\n    \n    // Intercept fetch API\n    const originalFetch = window.fetch;\n    window.fetch = async function(url, options = {}) {\n      if (isUploadRequest(options.method, url) && protectionState.fingerprint) {\n        // Clone options to avoid modifying original\n        options = { ...options };\n        \n        if (options.body instanceof FormData) {\n          options.body.append('fingerprintData', JSON.stringify(protectionState.fingerprint));\n        } else if (typeof options.body === 'string') {\n          try {\n            const jsonData = JSON.parse(options.body);\n            jsonData.fingerprintData = protectionState.fingerprint;\n            options.body = JSON.stringify(jsonData);\n          } catch (e) {\n            // If not JSON, add as header\n            options.headers = {\n              ...options.headers,\n              'X-Fingerprint-Data': JSON.stringify(protectionState.fingerprint)\n            };\n          }\n        }\n      }\n      \n      try {\n        const response = await originalFetch(url, options);\n        \n        // Handle challenge responses\n        if (response.status === 403) {\n          const data = await response.json();\n          if (data.challenge) {\n            return handleChallengeResponse(data.challenge, url, options);\n          }\n        }\n        \n        return response;\n        \n      } catch (error) {\n        console.error('[AdvancedProtection] Fetch error:', error);\n        throw error;\n      }\n    };\n  }\n\n  /**\n   * Check if request is an upload request\n   */\n  function isUploadRequest(method, url) {\n    if (!method || !url) return false;\n    \n    const uploadMethods = ['POST', 'PUT', 'PATCH'];\n    const uploadPatterns = [\n      '/upload',\n      '/file',\n      '/document',\n      '/image',\n      '/media'\n    ];\n    \n    return uploadMethods.includes(method.toUpperCase()) && \n           uploadPatterns.some(pattern => url.toLowerCase().includes(pattern));\n  }\n\n  /**\n   * Handle challenge response from server\n   */\n  async function handleChallengeResponse(challenge, originalUrl, originalOptions) {\n    console.log('[AdvancedProtection] Handling challenge:', challenge.type);\n    \n    try {\n      protectionState.isProcessing = true;\n      protectionState.challengeAttempts++;\n      \n      const handler = challengeHandlers[challenge.type];\n      if (!handler) {\n        throw new Error(`Unknown challenge type: ${challenge.type}`);\n      }\n      \n      // Execute challenge handler\n      const challengeResponse = await handler(challenge.data);\n      \n      // Send challenge response to server\n      const verifyResponse = await fetch(CONFIG.ENDPOINTS.VERIFY, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          challengeResponse: {\n            type: challenge.type,\n            ...challengeResponse\n          },\n          sessionId: challenge.sessionId || protectionState.sessionId\n        })\n      });\n      \n      if (verifyResponse.ok) {\n        console.log('[AdvancedProtection] Challenge passed, retrying original request');\n        \n        // Reset challenge attempts on success\n        protectionState.challengeAttempts = 0;\n        protectionState.isProcessing = false;\n        \n        // Retry original request\n        return window.fetch(originalUrl, originalOptions);\n        \n      } else {\n        throw new Error('Challenge verification failed');\n      }\n      \n    } catch (error) {\n      console.error('[AdvancedProtection] Challenge handling failed:', error);\n      \n      protectionState.isProcessing = false;\n      \n      // Retry with exponential backoff\n      if (protectionState.challengeAttempts < CONFIG.MAX_RETRIES) {\n        const delay = CONFIG.RETRY_DELAY * Math.pow(2, protectionState.challengeAttempts - 1);\n        console.log(`[AdvancedProtection] Retrying challenge in ${delay}ms...`);\n        \n        await new Promise(resolve => setTimeout(resolve, delay));\n        return handleChallengeResponse(challenge, originalUrl, originalOptions);\n      }\n      \n      // Max retries reached, show error to user\n      showChallengeError(challenge.type, error);\n      throw error;\n    }\n  }\n\n  /**\n   * Handle CAPTCHA challenge\n   */\n  async function handleCaptchaChallenge(data) {\n    console.log('[AdvancedProtection] Handling CAPTCHA challenge');\n    \n    return new Promise((resolve, reject) => {\n      // Create CAPTCHA container\n      const container = document.createElement('div');\n      container.id = 'advanced-protection-captcha';\n      container.style.cssText = `\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.8);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n      `;\n      \n      const content = document.createElement('div');\n      content.style.cssText = `\n        background: white;\n        padding: 20px;\n        border-radius: 8px;\n        text-align: center;\n        max-width: 400px;\n      `;\n      \n      content.innerHTML = `\n        <h3>Security Verification Required</h3>\n        <p>Please complete the CAPTCHA to continue.</p>\n        <div id=\"captcha-container\"></div>\n        <button id=\"captcha-submit\" style=\"margin-top: 10px; padding: 10px 20px;\">Submit</button>\n      `;\n      \n      container.appendChild(content);\n      document.body.appendChild(container);\n      \n      // Handle CAPTCHA completion\n      const submitButton = content.querySelector('#captcha-submit');\n      submitButton.addEventListener('click', () => {\n        const token = 'mock_captcha_token_' + Math.random().toString(36).substr(2, 9);\n        \n        // Clean up\n        document.body.removeChild(container);\n        \n        resolve({\n          token: token,\n          completed: true\n        });\n      });\n      \n      // Timeout handling\n      setTimeout(() => {\n        if (document.body.contains(container)) {\n          document.body.removeChild(container);\n          reject(new Error('CAPTCHA timeout'));\n        }\n      }, CONFIG.CHALLENGE_TIMEOUT);\n    });\n  }\n\n  /**\n   * Handle delay challenge\n   */\n  async function handleDelayChallenge(data) {\n    console.log('[AdvancedProtection] Handling delay challenge');\n    \n    return new Promise((resolve) => {\n      // Create delay notification\n      const notification = document.createElement('div');\n      notification.id = 'advanced-protection-delay';\n      notification.style.cssText = `\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        background: #f0f0f0;\n        border: 1px solid #ccc;\n        padding: 15px;\n        border-radius: 5px;\n        z-index: 10000;\n        max-width: 300px;\n      `;\n      \n      const delaySeconds = data.delaySeconds || 5;\n      let remaining = delaySeconds;\n      \n      const updateNotification = () => {\n        notification.innerHTML = `\n          <strong>Security Check</strong><br>\n          Please wait ${remaining} seconds...<br>\n          <small>This helps protect against automated uploads.</small>\n        `;\n      };\n      \n      updateNotification();\n      document.body.appendChild(notification);\n      \n      // Countdown\n      const interval = setInterval(() => {\n        remaining--;\n        updateNotification();\n        \n        if (remaining <= 0) {\n          clearInterval(interval);\n          document.body.removeChild(notification);\n          resolve({\n            completed: true,\n            waitedSeconds: delaySeconds\n          });\n        }\n      }, 1000);\n    });\n  }\n\n  /**\n   * Handle rate limit challenge\n   */\n  async function handleRateLimitChallenge(data) {\n    console.log('[AdvancedProtection] Handling rate limit challenge');\n    \n    return new Promise((resolve) => {\n      const maxRequests = data.maxRequests || 5;\n      const windowMinutes = data.windowMinutes || 1;\n      \n      // Show rate limit notification\n      const notification = document.createElement('div');\n      notification.id = 'advanced-protection-rate-limit';\n      notification.style.cssText = `\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        background: #fff3cd;\n        border: 1px solid #ffeaa7;\n        color: #856404;\n        padding: 15px;\n        border-radius: 5px;\n        z-index: 10000;\n        max-width: 300px;\n      `;\n      \n      notification.innerHTML = `\n        <strong>Rate Limit Notice</strong><br>\n        To prevent abuse, please limit uploads to ${maxRequests} requests per ${windowMinutes} minute${windowMinutes > 1 ? 's' : ''}.<br>\n        <small>Click to acknowledge and continue.</small>\n      `;\n      \n      document.body.appendChild(notification);\n      \n      // Auto-dismiss after acknowledgment\n      notification.addEventListener('click', () => {\n        document.body.removeChild(notification);\n        resolve({\n          acknowledged: true,\n          maxRequests: maxRequests,\n          windowMinutes: windowMinutes\n        });\n      });\n      \n      // Auto-dismiss after timeout\n      setTimeout(() => {\n        if (document.body.contains(notification)) {\n          document.body.removeChild(notification);\n          resolve({\n            acknowledged: true,\n            maxRequests: maxRequests,\n            windowMinutes: windowMinutes\n          });\n        }\n      }, CONFIG.CHALLENGE_TIMEOUT);\n    });\n  }\n\n  /**\n   * Handle MFA challenge (placeholder)\n   */\n  async function handleMfaChallenge(data) {\n    console.log('[AdvancedProtection] Handling MFA challenge');\n    \n    // This would implement MFA verification\n    // For now, simulate successful MFA\n    return {\n      completed: true,\n      method: 'simulated'\n    };\n  }\n\n  /**\n   * Set up challenge handlers\n   */\n  function setupChallengeHandlers() {\n    // Preload challenge resources if needed\n    // This could include CAPTCHA libraries, etc.\n  }\n\n  /**\n   * Show challenge error to user\n   */\n  function showChallengeError(challengeType, error) {\n    const notification = document.createElement('div');\n    notification.style.cssText = `\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      background: #f8d7da;\n      border: 1px solid #f5c6cb;\n      color: #721c24;\n      padding: 15px;\n      border-radius: 5px;\n      z-index: 10000;\n      max-width: 300px;\n    `;\n    \n    notification.innerHTML = `\n      <strong>Security Verification Failed</strong><br>\n      Unable to complete ${challengeType} verification.<br>\n      <small>Error: ${error.message}</small>\n    `;\n    \n    document.body.appendChild(notification);\n    \n    // Auto-dismiss after 5 seconds\n    setTimeout(() => {\n      if (document.body.contains(notification)) {\n        document.body.removeChild(notification);\n      }\n    }, 5000);\n  }\n\n  /**\n   * Get current protection state\n   */\n  function getProtectionState() {\n    return { ...protectionState };\n  }\n\n  /**\n   * Enable/disable protection\n   */\n  function setProtectionEnabled(enabled) {\n    protectionState.isEnabled = enabled;\n    console.log(`[AdvancedProtection] Protection ${enabled ? 'enabled' : 'disabled'}`);\n  }\n\n  /**\n   * Manually refresh fingerprint\n   */\n  function manualRefresh() {\n    return refreshFingerprint();\n  }\n\n  // Expose public API\n  window.AdvancedProtection = {\n    initialize: initializeProtection,\n    getState: getProtectionState,\n    setEnabled: setProtectionEnabled,\n    refreshFingerprint: manualRefresh,\n    CONFIG: CONFIG\n  };\n\n  // Auto-initialize if DOM is ready\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', initializeProtection);\n  } else {\n    initializeProtection();\n  }\n\n})(window);","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/behavioral-analysis.js","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'lastInteractionTime' is assigned a value but never used.","line":53,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":53,"endColumn":26},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":61,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":61,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":77,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":77,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":87,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":87,"endColumn":13},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":286,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":286,"endColumn":13},{"ruleId":"no-unused-vars","severity":2,"message":"'timingVariations' is assigned a value but never used.","line":360,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":360,"endColumn":25,"suggestions":[{"messageId":"removeVar","data":{"varName":"timingVariations"},"fix":{"range":[10352,10377],"text":""},"desc":"Remove unused variable 'timingVariations'."}]},{"ruleId":"no-control-regex","severity":2,"message":"Unexpected control character(s) in regular expression: \\x00, \\x1f.","line":384,"column":58,"nodeType":"Literal","messageId":"unexpected","endLine":384,"endColumn":71},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":447,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":447,"endColumn":13},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":452,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":452,"endColumn":13},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":457,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":457,"endColumn":13},{"ruleId":"no-unused-vars","severity":2,"message":"'totalPressure' is assigned a value but never used.","line":558,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":558,"endColumn":22},{"ruleId":"no-unused-vars","severity":2,"message":"'totalSize' is assigned a value but never used.","line":569,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":569,"endColumn":18},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":689,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":689,"endColumn":13},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":703,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":703,"endColumn":13},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":791,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":791,"endColumn":13},{"ruleId":"no-undef","severity":2,"message":"'setInterval' is not defined.","line":852,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":852,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":1032,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":1032,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'fetch' is not defined.","line":1054,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":1054,"endColumn":10},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":1062,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":1062,"endColumn":14},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":1094,"column":35,"nodeType":"Identifier","messageId":"undef","endLine":1094,"endColumn":43},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":1130,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":1130,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":1134,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":1134,"endColumn":15},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":1135,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":1135,"endColumn":13},{"ruleId":"no-undef","severity":2,"message":"'window' is not defined.","line":1149,"column":4,"nodeType":"Identifier","messageId":"undef","endLine":1149,"endColumn":10}],"suppressedMessages":[],"errorCount":24,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Advanced Behavioral Analysis Library\n * \n * Client-side behavioral fingerprinting for sophisticated threat detection\n * Captures mouse movements, keystroke dynamics, touch patterns, and timing analysis\n */\n\n(function(window) {\n  'use strict';\n\n  // Configuration\n  const CONFIG = {\n    // Data collection intervals\n    MOUSE_SAMPLE_INTERVAL: 50, // ms\n    KEYSTROKE_SAMPLE_INTERVAL: 10, // ms\n    TOUCH_SAMPLE_INTERVAL: 25, // ms\n    \n    // Analysis thresholds\n    MIN_MOUSE_MOVEMENTS: 50,\n    MIN_KEYSTROKES: 10,\n    MIN_TOUCH_EVENTS: 20,\n    \n    // Behavioral patterns\n    BOT_DETECTION: {\n      MOUSE_LINEARITY_THRESHOLD: 0.95, // Perfectly straight lines\n      MOUSE_SPEED_THRESHOLD: 5000, // Pixels per second (too fast)\n      MOUSE_CONSISTENCY_THRESHOLD: 0.98, // Too consistent movements\n      KEYSTROKE_TIMING_THRESHOLD: 0.95, // Too consistent timing\n      TOUCH_PATTERN_THRESHOLD: 0.99, // Too perfect touch patterns\n      REACTION_TIME_THRESHOLD: 100 // Too fast reaction (<100ms)\n    },\n    \n    // Privacy settings\n    MAX_DATA_POINTS: 1000,\n    DATA_RETENTION_MS: 5 * 60 * 1000, // 5 minutes\n    ANONYMIZE_DATA: true\n  };\n\n  // Behavioral data collectors\n  let behavioralData = {\n    mouseMovements: [],\n    keystrokeDynamics: [],\n    touchPatterns: [],\n    timingAnalysis: {},\n    deviceInteraction: {},\n    behavioralScore: 0,\n    isHuman: true,\n    confidence: 0.8\n  };\n\n  let isCollecting = false;\n  let collectionStartTime = null;\n  let lastInteractionTime = null;\n\n  /**\n   * Initialize behavioral analysis\n   */\n  function initializeBehavioralAnalysis() {\n    if (isCollecting) return;\n    \n    console.log('[BehavioralAnalysis] Initializing...');\n    \n    collectionStartTime = Date.now();\n    lastInteractionTime = Date.now();\n    isCollecting = true;\n    \n    // Set up event listeners\n    setupMouseTracking();\n    setupKeystrokeTracking();\n    setupTouchTracking();\n    setupTimingAnalysis();\n    setupDeviceInteractionTracking();\n    \n    // Start periodic analysis\n    startBehavioralAnalysis();\n    \n    console.log('[BehavioralAnalysis] Initialization complete');\n  }\n\n  /**\n   * Mouse movement tracking with advanced metrics\n   */\n  function setupMouseTracking() {\n    let lastMouseEvent = null;\n    let mouseMovementBuffer = [];\n    \n    document.addEventListener('mousemove', function(event) {\n      if (!isCollecting) return;\n      \n      const timestamp = Date.now();\n      const position = { x: event.clientX, y: event.clientY };\n      \n      // Calculate movement metrics\n      let velocity = 0;\n      let acceleration = 0;\n      let angle = 0;\n      let distance = 0;\n      \n      if (lastMouseEvent) {\n        const timeDiff = timestamp - lastMouseEvent.timestamp;\n        const distancePixels = Math.sqrt(\n          Math.pow(position.x - lastMouseEvent.position.x, 2) + \n          Math.pow(position.y - lastMouseEvent.position.y, 2)\n        );\n        \n        velocity = timeDiff > 0 ? distancePixels / timeDiff : 0;\n        distance = distancePixels;\n        \n        // Calculate movement angle\n        angle = Math.atan2(\n          position.y - lastMouseEvent.position.y,\n          position.x - lastMouseEvent.position.x\n        );\n        \n        // Calculate acceleration\n        if (lastMouseEvent.velocity > 0) {\n          acceleration = (velocity - lastMouseEvent.velocity) / timeDiff;\n        }\n      }\n      \n      const mouseEvent = {\n        timestamp,\n        position,\n        velocity,\n        acceleration,\n        angle,\n        distance,\n        target: event.target?.tagName || 'unknown',\n        path: getElementPath(event.target)\n      };\n      \n      mouseMovementBuffer.push(mouseEvent);\n      lastMouseEvent = mouseEvent;\n      \n      // Process buffer periodically\n      if (mouseMovementBuffer.length >= 10) {\n        processMouseMovements(mouseMovementBuffer);\n        mouseMovementBuffer = [];\n      }\n      \n      // Maintain data limits\n      if (behavioralData.mouseMovements.length >= CONFIG.MAX_DATA_POINTS) {\n        behavioralData.mouseMovements = behavioralData.mouseMovements.slice(-CONFIG.MAX_DATA_POINTS / 2);\n      }\n    });\n  }\n\n  /**\n   * Process mouse movement patterns for bot detection\n   */\n  function processMouseMovements(movements) {\n    if (movements.length < 3) return;\n    \n    // Calculate movement patterns\n    const patterns = analyzeMousePatterns(movements);\n    \n    // Detect bot-like behavior\n    const botIndicators = detectBotMouseBehavior(patterns);\n    \n    behavioralData.mouseMovements.push({\n      timestamp: Date.now(),\n      movements: movements,\n      patterns: patterns,\n      botIndicators: botIndicators,\n      isSuspicious: botIndicators.length > 0\n    });\n    \n    // Update behavioral score\n    updateBehavioralScore('mouse', botIndicators.length > 0 ? -10 : 2);\n  }\n\n  /**\n   * Analyze mouse movement patterns\n   */\n  function analyzeMousePatterns(movements) {\n    const patterns = {\n      linearity: 0,\n      speed: 0,\n      consistency: 0,\n      curvature: 0,\n      acceleration: 0,\n      deceleration: 0,\n      stops: 0,\n      directionChanges: 0\n    };\n    \n    if (movements.length < 3) return patterns;\n    \n    let totalVelocity = 0;\n    let maxVelocity = 0;\n    let velocityVariations = 0;\n    let directionChanges = 0;\n    let stops = 0;\n    let linearSegments = 0;\n    \n    for (let i = 1; i < movements.length; i++) {\n      const current = movements[i];\n      const previous = movements[i - 1];\n      \n      // Velocity analysis\n      totalVelocity += current.velocity;\n      maxVelocity = Math.max(maxVelocity, current.velocity);\n      \n      // Consistency analysis\n      if (i > 1) {\n        const velocityDiff = Math.abs(current.velocity - previous.velocity);\n        velocityVariations += velocityDiff;\n        \n        // Direction change detection\n        const angleDiff = Math.abs(current.angle - previous.angle);\n        if (angleDiff > Math.PI / 4) { // 45 degrees\n          directionChanges++;\n        }\n      }\n      \n      // Stop detection\n      if (current.velocity < 10) { // Less than 10 pixels/second\n        stops++;\n      }\n      \n      // Linearity detection\n      if (i > 1) {\n        const angleConsistency = Math.abs(current.angle - movements[i - 2].angle);\n        if (angleConsistency < 0.1) {\n          linearSegments++;\n        }\n      }\n    }\n    \n    patterns.speed = totalVelocity / movements.length;\n    patterns.consistency = 1 - (velocityVariations / (movements.length * maxVelocity));\n    patterns.directionChanges = directionChanges;\n    patterns.stops = stops;\n    patterns.linearity = linearSegments / (movements.length - 2);\n    \n    // Calculate acceleration patterns\n    const accelerations = movements.filter(m => m.acceleration > 0).length;\n    const decelerations = movements.filter(m => m.acceleration < 0).length;\n    patterns.acceleration = accelerations / movements.length;\n    patterns.deceleration = decelerations / movements.length;\n    \n    return patterns;\n  }\n\n  /**\n   * Detect bot-like mouse behavior\n   */\n  function detectBotMouseBehavior(patterns) {\n    const indicators = [];\n    \n    // Check for overly linear movements (robots move in straight lines)\n    if (patterns.linearity > CONFIG.BOT_DETECTION.MOUSE_LINEARITY_THRESHOLD) {\n      indicators.push('Excessively linear mouse movements');\n    }\n    \n    // Check for impossible speeds\n    if (patterns.speed > CONFIG.BOT_DETECTION.MOUSE_SPEED_THRESHOLD) {\n      indicators.push('Mouse movements too fast for human');\n    }\n    \n    // Check for overly consistent movements\n    if (patterns.consistency > CONFIG.BOT_DETECTION.MOUSE_CONSISTENCY_THRESHOLD) {\n      indicators.push('Mouse movement consistency too perfect');\n    }\n    \n    // Check for lack of natural stops\n    if (patterns.stops < 2 && patterns.speed > 100) {\n      indicators.push('No natural mouse stops detected');\n    }\n    \n    // Check for lack of direction changes\n    if (patterns.directionChanges < 1 && patterns.speed > 50) {\n      indicators.push('No natural direction changes');\n    }\n    \n    return indicators;\n  }\n\n  /**\n   * Keystroke dynamics tracking\n   */\n  function setupKeystrokeTracking() {\n    let keystrokeBuffer = [];\n    let lastKeyEvent = null;\n    \n    document.addEventListener('keydown', function(event) {\n      if (!isCollecting) return;\n      \n      const timestamp = Date.now();\n      const keyEvent = {\n        timestamp,\n        key: event.key,\n        code: event.code,\n        location: event.location,\n        repeat: event.repeat,\n        isTrusted: event.isTrusted,\n        target: event.target?.tagName || 'unknown'\n      };\n      \n      // Calculate timing metrics\n      if (lastKeyEvent) {\n        const timeDiff = timestamp - lastKeyEvent.timestamp;\n        keyEvent.flightTime = timeDiff; // Time between key releases\n        keyEvent.dwellTime = timeDiff; // Time key was held down (simplified)\n      }\n      \n      keystrokeBuffer.push(keyEvent);\n      lastKeyEvent = keyEvent;\n      \n      // Process buffer periodically\n      if (keystrokeBuffer.length >= CONFIG.MIN_KEYSTROKES) {\n        processKeystrokes(keystrokeBuffer);\n        keystrokeBuffer = [];\n      }\n      \n      // Maintain data limits\n      if (behavioralData.keystrokeDynamics.length >= CONFIG.MAX_DATA_POINTS) {\n        behavioralData.keystrokeDynamics = behavioralData.keystrokeDynamics.slice(-CONFIG.MAX_DATA_POINTS / 2);\n      }\n    });\n  }\n\n  /**\n   * Process keystroke dynamics\n   */\n  function processKeystrokes(keystrokes) {\n    const patterns = analyzeKeystrokePatterns(keystrokes);\n    const botIndicators = detectBotKeystrokeBehavior(patterns);\n    \n    behavioralData.keystrokeDynamics.push({\n      timestamp: Date.now(),\n      keystrokes: keystrokes,\n      patterns: patterns,\n      botIndicators: botIndicators,\n      isSuspicious: botIndicators.length > 0\n    });\n    \n    // Update behavioral score\n    updateBehavioralScore('keystroke', botIndicators.length > 0 ? -15 : 3);\n  }\n\n  /**\n   * Analyze keystroke patterns\n   */\n  function analyzeKeystrokePatterns(keystrokes) {\n    const patterns = {\n      averageDwellTime: 0,\n      averageFlightTime: 0,\n      timingConsistency: 0,\n      keyRepeatRate: 0,\n      typingSpeed: 0,\n      rhythmVariation: 0,\n      pausePatterns: []\n    };\n    \n    if (keystrokes.length < 2) return patterns;\n    \n    let totalDwellTime = 0;\n    let totalFlightTime = 0;\n    let timingVariations = 0;\n    let keyRepeats = 0;\n    let characterCount = 0;\n    const flightTimes = [];\n    \n    for (let i = 1; i < keystrokes.length; i++) {\n      const current = keystrokes[i];\n      const previous = keystrokes[i - 1];\n      \n      if (current.dwellTime) {\n        totalDwellTime += current.dwellTime;\n      }\n      \n      if (current.flightTime) {\n        totalFlightTime += current.flightTime;\n        flightTimes.push(current.flightTime);\n      }\n      \n      // Count key repeats\n      if (current.key === previous.key && current.repeat) {\n        keyRepeats++;\n      }\n      \n      // Count meaningful characters (exclude special keys)\n      if (current.key.length === 1 && !current.key.match(/[\\x00-\\x1F]/)) {\n        characterCount++;\n      }\n    }\n    \n    patterns.averageDwellTime = totalDwellTime / (keystrokes.length - 1);\n    patterns.averageFlightTime = totalFlightTime / (keystrokes.length - 1);\n    patterns.keyRepeatRate = keyRepeats / keystrokes.length;\n    patterns.typingSpeed = characterCount > 0 ? (characterCount / (keystrokes.length * 0.1)) : 0; // chars per second\n    \n    // Calculate timing consistency\n    if (flightTimes.length > 1) {\n      const avgFlight = patterns.averageFlightTime;\n      const variance = flightTimes.reduce((sum, time) => sum + Math.pow(time - avgFlight, 2), 0) / flightTimes.length;\n      patterns.timingConsistency = 1 - (Math.sqrt(variance) / avgFlight);\n    }\n    \n    // Detect pause patterns\n    const longPauses = flightTimes.filter(time => time > 500); // >500ms pauses\n    patterns.pausePatterns = {\n      pauseCount: longPauses.length,\n      averagePauseDuration: longPauses.length > 0 ? longPauses.reduce((a, b) => a + b, 0) / longPauses.length : 0\n    };\n    \n    return patterns;\n  }\n\n  /**\n   * Detect bot-like keystroke behavior\n   */\n  function detectBotKeystrokeBehavior(patterns) {\n    const indicators = [];\n    \n    // Check for overly consistent timing\n    if (patterns.timingConsistency > CONFIG.BOT_DETECTION.KEYSTROKE_TIMING_THRESHOLD) {\n      indicators.push('Keystroke timing too consistent for human');\n    }\n    \n    // Check for impossible typing speed\n    if (patterns.typingSpeed > 20) { // >20 chars per second\n      indicators.push('Typing speed impossible for human');\n    }\n    \n    // Check for lack of natural pauses\n    if (patterns.pausePatterns.pauseCount === 0 && patterns.typingSpeed > 10) {\n      indicators.push('No natural typing pauses detected');\n    }\n    \n    // Check for excessive key repeats\n    if (patterns.keyRepeatRate > 0.1) { // >10% key repeats\n      indicators.push('Excessive key repeat patterns');\n    }\n    \n    return indicators;\n  }\n\n  /**\n   * Touch pattern tracking for mobile devices\n   */\n  function setupTouchTracking() {\n    let touchBuffer = [];\n    let lastTouchEvent = null;\n    \n    document.addEventListener('touchstart', function(event) {\n      if (!isCollecting) return;\n      handleTouchEvent('start', event);\n    });\n    \n    document.addEventListener('touchmove', function(event) {\n      if (!isCollecting) return;\n      handleTouchEvent('move', event);\n    });\n    \n    document.addEventListener('touchend', function(event) {\n      if (!isCollecting) return;\n      handleTouchEvent('end', event);\n    });\n    \n    function handleTouchEvent(type, event) {\n      const timestamp = Date.now();\n      const touches = Array.from(event.touches || event.changedTouches).map(touch => ({\n        identifier: touch.identifier,\n        x: touch.clientX,\n        y: touch.clientY,\n        radiusX: touch.radiusX,\n        radiusY: touch.radiusY,\n        rotationAngle: touch.rotationAngle,\n        force: touch.force\n      }));\n      \n      const touchEvent = {\n        timestamp,\n        type,\n        touches: touches,\n        target: event.target?.tagName || 'unknown',\n        preventDefault: event.defaultPrevented\n      };\n      \n      // Calculate touch metrics\n      if (lastTouchEvent && touches.length > 0) {\n        const timeDiff = timestamp - lastTouchEvent.timestamp;\n        const movement = calculateTouchMovement(lastTouchEvent.touches, touches);\n        touchEvent.movement = movement;\n        touchEvent.duration = timeDiff;\n      }\n      \n      touchBuffer.push(touchEvent);\n      lastTouchEvent = touchEvent;\n      \n      // Process buffer periodically\n      if (touchBuffer.length >= CONFIG.MIN_TOUCH_EVENTS) {\n        processTouchPatterns(touchBuffer);\n        touchBuffer = [];\n      }\n      \n      // Maintain data limits\n      if (behavioralData.touchPatterns.length >= CONFIG.MAX_DATA_POINTS) {\n        behavioralData.touchPatterns = behavioralData.touchPatterns.slice(-CONFIG.MAX_DATA_POINTS / 2);\n      }\n    }\n  }\n\n  /**\n   * Process touch patterns\n   */\n  function processTouchPatterns(touches) {\n    const patterns = analyzeTouchPatterns(touches);\n    const botIndicators = detectBotTouchBehavior(patterns);\n    \n    behavioralData.touchPatterns.push({\n      timestamp: Date.now(),\n      touches: touches,\n      patterns: patterns,\n      botIndicators: botIndicators,\n      isSuspicious: botIndicators.length > 0\n    });\n    \n    // Update behavioral score\n    updateBehavioralScore('touch', botIndicators.length > 0 ? -12 : 4);\n  }\n\n  /**\n   * Analyze touch patterns\n   */\n  function analyzeTouchPatterns(touches) {\n    const patterns = {\n      averageTouchDuration: 0,\n      touchPressureVariance: 0,\n      touchSizeVariance: 0,\n      gestureComplexity: 0,\n      multiTouchCoordination: 0,\n      swipeVelocity: 0,\n      pinchZoomPatterns: []\n    };\n    \n    if (touches.length < 2) return patterns;\n    \n    let totalDuration = 0;\n    let totalPressure = 0;\n    let pressureVariations = 0;\n    let totalSize = 0;\n    let sizeVariations = 0;\n    let swipeVelocities = [];\n    \n    for (let i = 0; i < touches.length; i++) {\n      const touch = touches[i];\n      \n      if (touch.duration) {\n        totalDuration += touch.duration;\n      }\n      \n      // Pressure analysis\n      if (touch.touches[0] && touch.touches[0].force !== undefined) {\n        const pressure = touch.touches[0].force;\n        totalPressure += pressure;\n        \n        if (i > 0) {\n          const prevPressure = touches[i - 1].touches[0]?.force || 0;\n          pressureVariations += Math.abs(pressure - prevPressure);\n        }\n      }\n      \n      // Size analysis\n      if (touch.touches[0] && touch.touches[0].radiusX !== undefined) {\n        const size = touch.touches[0].radiusX * touch.touches[0].radiusY;\n        totalSize += size;\n        \n        if (i > 0) {\n          const prevSize = (touches[i - 1].touches[0]?.radiusX || 0) * (touches[i - 1].touches[0]?.radiusY || 0);\n          sizeVariations += Math.abs(size - prevSize);\n        }\n      }\n      \n      // Swipe velocity\n      if (touch.movement && touch.duration) {\n        const velocity = touch.movement.distance / touch.duration;\n        swipeVelocities.push(velocity);\n      }\n    }\n    \n    patterns.averageTouchDuration = totalDuration / touches.length;\n    patterns.touchPressureVariance = pressureVariations / touches.length;\n    patterns.touchSizeVariance = sizeVariations / touches.length;\n    \n    if (swipeVelocities.length > 0) {\n      patterns.swipeVelocity = swipeVelocities.reduce((a, b) => a + b, 0) / swipeVelocities.length;\n    }\n    \n    // Multi-touch coordination analysis\n    const multiTouchEvents = touches.filter(t => t.touches.length > 1);\n    if (multiTouchEvents.length > 0) {\n      patterns.multiTouchCoordination = analyzeMultiTouchCoordination(multiTouchEvents);\n    }\n    \n    return patterns;\n  }\n\n  /**\n   * Detect bot-like touch behavior\n   */\n  function detectBotTouchBehavior(patterns) {\n    const indicators = [];\n    \n    // Check for perfectly consistent touch patterns\n    if (patterns.touchPressureVariance < 0.01 && patterns.averageTouchDuration > 0) {\n      indicators.push('Touch pressure too consistent');\n    }\n    \n    // Check for impossible swipe velocities\n    if (patterns.swipeVelocity > 2000) { // 2000 pixels/second\n      indicators.push('Swipe velocity impossible for human');\n    }\n    \n    // Check for lack of natural touch size variation\n    if (patterns.touchSizeVariance < 0.01 && patterns.averageTouchDuration > 100) {\n      indicators.push('Touch size too consistent');\n    }\n    \n    // Check for perfect multi-touch coordination\n    if (patterns.multiTouchCoordination > CONFIG.BOT_DETECTION.TOUCH_PATTERN_THRESHOLD) {\n      indicators.push('Multi-touch coordination too perfect');\n    }\n    \n    return indicators;\n  }\n\n  /**\n   * Analyze multi-touch coordination\n   */\n  function analyzeMultiTouchCoordination(multiTouchEvents) {\n    let coordinationScore = 0;\n    let totalEvents = multiTouchEvents.length;\n    \n    for (const event of multiTouchEvents) {\n      if (event.touches.length >= 2) {\n        // Calculate distance between touch points\n        const touch1 = event.touches[0];\n        const touch2 = event.touches[1];\n        \n        const distance = Math.sqrt(\n          Math.pow(touch2.x - touch1.x, 2) + Math.pow(touch2.y - touch1.y, 2)\n        );\n        \n        // Perfect coordination would maintain exact distances\n        // Humans have slight variations\n        if (distance > 0) {\n          coordinationScore += 1 / distance; // Inverse relationship\n        }\n      }\n    }\n    \n    return totalEvents > 0 ? coordinationScore / totalEvents : 0;\n  }\n\n  /**\n   * Calculate touch movement between events\n   */\n  function calculateTouchMovement(previousTouches, currentTouches) {\n    if (previousTouches.length === 0 || currentTouches.length === 0) {\n      return { distance: 0, direction: 0 };\n    }\n    \n    // Use first touch point for movement calculation\n    const prev = previousTouches[0];\n    const curr = currentTouches[0];\n    \n    const distance = Math.sqrt(\n      Math.pow(curr.x - prev.x, 2) + Math.pow(curr.y - prev.y, 2)\n    );\n    \n    const direction = Math.atan2(curr.y - prev.y, curr.x - prev.x);\n    \n    return { distance, direction };\n  }\n\n  /**\n   * Timing analysis for reaction times and patterns\n   */\n  function setupTimingAnalysis() {\n    let pageLoadTime = Date.now();\n    let firstInteractionTime = null;\n    let interactionGaps = [];\n    let lastInteractionTime = null;\n    \n    // Track first interaction\n    document.addEventListener('click', function() {\n      if (!firstInteractionTime) {\n        firstInteractionTime = Date.now();\n        const reactionTime = firstInteractionTime - pageLoadTime;\n        \n        // Suspicious if reaction time is too fast (<100ms)\n        if (reactionTime < CONFIG.BOT_DETECTION.REACTION_TIME_THRESHOLD) {\n          behavioralData.timingAnalysis.fastReactionTime = reactionTime;\n          updateBehavioralScore('timing', -20);\n        }\n      }\n    }, { once: true });\n    \n    // Track interaction gaps\n    document.addEventListener('click', function() {\n      if (!isCollecting) return;\n      \n      const now = Date.now();\n      if (lastInteractionTime) {\n        const gap = now - lastInteractionTime;\n        interactionGaps.push(gap);\n        \n        // Keep only recent gaps\n        if (interactionGaps.length > 50) {\n          interactionGaps = interactionGaps.slice(-30);\n        }\n        \n        // Analyze interaction patterns\n        if (interactionGaps.length >= 10) {\n          analyzeInteractionPatterns(interactionGaps);\n        }\n      }\n      lastInteractionTime = now;\n    });\n  }\n\n  /**\n   * Analyze interaction timing patterns\n   */\n  function analyzeInteractionPatterns(gaps) {\n    const patterns = {\n      averageGap: gaps.reduce((a, b) => a + b, 0) / gaps.length,\n      gapVariance: 0,\n      rhythmicPattern: 0,\n      tooRegular: false\n    };\n    \n    // Calculate variance\n    const avgGap = patterns.averageGap;\n    const variance = gaps.reduce((sum, gap) => sum + Math.pow(gap - avgGap, 2), 0) / gaps.length;\n    patterns.gapVariance = variance;\n    \n    // Detect rhythmic patterns (too regular)\n    const coefficientOfVariation = Math.sqrt(variance) / avgGap;\n    if (coefficientOfVariation < 0.1) { // Less than 10% variation\n      patterns.tooRegular = true;\n      updateBehavioralScore('timing', -15);\n    }\n    \n    behavioralData.timingAnalysis.interactionPatterns = patterns;\n  }\n\n  /**\n   * Device interaction tracking\n   */\n  function setupDeviceInteractionTracking() {\n    // Track device orientation changes\n    window.addEventListener('orientationchange', function() {\n      if (!isCollecting) return;\n      \n      behavioralData.deviceInteraction.orientationChanges = \n        (behavioralData.deviceInteraction.orientationChanges || 0) + 1;\n      \n      updateBehavioralScore('device', 1);\n    });\n    \n    // Track device motion (mobile devices)\n    if (window.DeviceMotionEvent) {\n      let motionEvents = [];\n      \n      window.addEventListener('devicemotion', function(event) {\n        if (!isCollecting) return;\n        \n        const motionData = {\n          timestamp: Date.now(),\n          acceleration: event.acceleration,\n          accelerationIncludingGravity: event.accelerationIncludingGravity,\n          rotationRate: event.rotationRate,\n          interval: event.interval\n        };\n        \n        motionEvents.push(motionData);\n        \n        // Process motion patterns\n        if (motionEvents.length >= 20) {\n          analyzeMotionPatterns(motionEvents);\n          motionEvents = [];\n        }\n      });\n    }\n    \n    // Track visibility changes (tab switching)\n    document.addEventListener('visibilitychange', function() {\n      if (!isCollecting) return;\n      \n      behavioralData.deviceInteraction.visibilityChanges = \n        (behavioralData.deviceInteraction.visibilityChanges || 0) + 1;\n      \n      // Suspicious if too many rapid visibility changes\n      if (behavioralData.deviceInteraction.visibilityChanges > 10) {\n        updateBehavioralScore('device', -5);\n      }\n    });\n  }\n\n  /**\n   * Analyze device motion patterns\n   */\n  function analyzeMotionPatterns(motionEvents) {\n    const patterns = {\n      averageAcceleration: 0,\n      motionVariance: 0,\n      deviceStability: 0,\n      naturalMotion: true\n    };\n    \n    let totalAcceleration = 0;\n    let accelerations = [];\n    \n    for (const event of motionEvents) {\n      if (event.acceleration) {\n        const magnitude = Math.sqrt(\n          Math.pow(event.acceleration.x || 0, 2) +\n          Math.pow(event.acceleration.y || 0, 2) +\n          Math.pow(event.acceleration.z || 0, 2)\n        );\n        totalAcceleration += magnitude;\n        accelerations.push(magnitude);\n      }\n    }\n    \n    if (accelerations.length > 0) {\n      patterns.averageAcceleration = totalAcceleration / accelerations.length;\n      \n      // Calculate variance\n      const avg = patterns.averageAcceleration;\n      const variance = accelerations.reduce((sum, acc) => sum + Math.pow(acc - avg, 2), 0) / accelerations.length;\n      patterns.motionVariance = variance;\n      \n      // Detect if device is too stable (possibly on a stand/desk)\n      if (variance < 0.1 && avg < 0.5) {\n        patterns.naturalMotion = false;\n        updateBehavioralScore('device', -8);\n      }\n    }\n    \n    behavioralData.deviceInteraction.motionPatterns = patterns;\n  }\n\n  /**\n   * Start behavioral analysis\n   */\n  function startBehavioralAnalysis() {\n    setInterval(function() {\n      if (!isCollecting) return;\n      \n      // Comprehensive behavioral analysis\n      const analysis = performComprehensiveAnalysis();\n      \n      // Update overall behavioral assessment\n      behavioralData.behavioralScore = analysis.overallScore;\n      behavioralData.isHuman = analysis.isHuman;\n      behavioralData.confidence = analysis.confidence;\n      \n      // Send to server periodically\n      if (Math.random() < 0.1) { // 10% chance to send (reduce network load)\n        sendBehavioralData();\n      }\n      \n      // Clean up old data\n      cleanupOldData();\n      \n    }, 30000); // Analyze every 30 seconds\n  }\n\n  /**\n   * Perform comprehensive behavioral analysis\n   */\n  function performComprehensiveAnalysis() {\n    let overallScore = 100; // Start with perfect human score\n    let confidence = 0.8;\n    let isHuman = true;\n    \n    // Analyze mouse behavior\n    const mouseAnalysis = analyzeMouseBehavior();\n    overallScore += mouseAnalysis.scoreAdjustment;\n    confidence *= mouseAnalysis.confidenceMultiplier;\n    \n    // Analyze keystroke behavior\n    const keystrokeAnalysis = analyzeKeystrokeBehavior();\n    overallScore += keystrokeAnalysis.scoreAdjustment;\n    confidence *= keystrokeAnalysis.confidenceMultiplier;\n    \n    // Analyze touch behavior\n    const touchAnalysis = analyzeTouchBehavior();\n    overallScore += touchAnalysis.scoreAdjustment;\n    confidence *= touchAnalysis.confidenceMultiplier;\n    \n    // Analyze timing behavior\n    const timingAnalysis = analyzeTimingBehavior();\n    overallScore += timingAnalysis.scoreAdjustment;\n    confidence *= timingAnalysis.confidenceMultiplier;\n    \n    // Final assessment\n    overallScore = Math.max(0, Math.min(100, overallScore));\n    confidence = Math.max(0.1, Math.min(1.0, confidence));\n    isHuman = overallScore > 50; // Threshold for human vs bot\n    \n    return {\n      overallScore,\n      isHuman,\n      confidence,\n      breakdown: {\n        mouse: mouseAnalysis,\n        keystroke: keystrokeAnalysis,\n        touch: touchAnalysis,\n        timing: timingAnalysis\n      }\n    };\n  }\n\n  /**\n   * Analyze mouse behavior comprehensively\n   */\n  function analyzeMouseBehavior() {\n    const recentMouseData = behavioralData.mouseMovements.slice(-10);\n    let scoreAdjustment = 0;\n    let confidenceMultiplier = 1.0;\n    \n    if (recentMouseData.length === 0) {\n      return { scoreAdjustment: -10, confidenceMultiplier: 0.9, reason: 'No mouse data' };\n    }\n    \n    const suspiciousEvents = recentMouseData.filter(data => data.isSuspicious).length;\n    \n    if (suspiciousEvents > recentMouseData.length * 0.5) {\n      scoreAdjustment = -30;\n      confidenceMultiplier = 0.7;\n    } else if (suspiciousEvents > 0) {\n      scoreAdjustment = -15;\n      confidenceMultiplier = 0.85;\n    } else {\n      scoreAdjustment = 5;\n      confidenceMultiplier = 1.1;\n    }\n    \n    return { scoreAdjustment, confidenceMultiplier, suspiciousEvents };\n  }\n\n  /**\n   * Analyze keystroke behavior\n   */\n  function analyzeKeystrokeBehavior() {\n    const recentKeystrokeData = behavioralData.keystrokeDynamics.slice(-10);\n    let scoreAdjustment = 0;\n    let confidenceMultiplier = 1.0;\n    \n    if (recentKeystrokeData.length === 0) {\n      return { scoreAdjustment: -5, confidenceMultiplier: 0.95, reason: 'No keystroke data' };\n    }\n    \n    const suspiciousEvents = recentKeystrokeData.filter(data => data.isSuspicious).length;\n    \n    if (suspiciousEvents > recentKeystrokeData.length * 0.6) {\n      scoreAdjustment = -25;\n      confidenceMultiplier = 0.75;\n    } else if (suspiciousEvents > 0) {\n      scoreAdjustment = -12;\n      confidenceMultiplier = 0.88;\n    } else {\n      scoreAdjustment = 3;\n      confidenceMultiplier = 1.05;\n    }\n    \n    return { scoreAdjustment, confidenceMultiplier, suspiciousEvents };\n  }\n\n  /**\n   * Analyze touch behavior\n   */\n  function analyzeTouchBehavior() {\n    const recentTouchData = behavioralData.touchPatterns.slice(-10);\n    let scoreAdjustment = 0;\n    let confidenceMultiplier = 1.0;\n    \n    if (recentTouchData.length === 0) {\n      return { scoreAdjustment: 0, confidenceMultiplier: 1.0, reason: 'No touch data' };\n    }\n    \n    const suspiciousEvents = recentTouchData.filter(data => data.isSuspicious).length;\n    \n    if (suspiciousEvents > recentTouchData.length * 0.7) {\n      scoreAdjustment = -20;\n      confidenceMultiplier = 0.8;\n    } else if (suspiciousEvents > 0) {\n      scoreAdjustment = -10;\n      confidenceMultiplier = 0.9;\n    } else {\n      scoreAdjustment = 4;\n      confidenceMultiplier = 1.08;\n    }\n    \n    return { scoreAdjustment, confidenceMultiplier, suspiciousEvents };\n  }\n\n  /**\n   * Analyze timing behavior\n   */\n  function analyzeTimingBehavior() {\n    let scoreAdjustment = 0;\n    let confidenceMultiplier = 1.0;\n    \n    if (behavioralData.timingAnalysis.fastReactionTime) {\n      scoreAdjustment = -20;\n      confidenceMultiplier = 0.85;\n    }\n    \n    const interactionPatterns = behavioralData.timingAnalysis.interactionPatterns;\n    if (interactionPatterns && interactionPatterns.tooRegular) {\n      scoreAdjustment -= 15;\n      confidenceMultiplier *= 0.9;\n    }\n    \n    return { scoreAdjustment, confidenceMultiplier };\n  }\n\n  /**\n   * Update behavioral score\n   */\n  function updateBehavioralScore(type, adjustment) {\n    behavioralData.behavioralScore += adjustment;\n    behavioralData.behavioralScore = Math.max(0, Math.min(100, behavioralData.behavioralScore));\n    \n    console.log(`[BehavioralAnalysis] ${type} score updated: ${adjustment > 0 ? '+' : ''}${adjustment}, new score: ${behavioralData.behavioralScore}`);\n  }\n\n  /**\n   * Send behavioral data to server\n   */\n  function sendBehavioralData() {\n    if (!window.AdvancedProtection || !window.AdvancedProtection.isEnabled()) return;\n    \n    const data = {\n      timestamp: Date.now(),\n      behavioralScore: behavioralData.behavioralScore,\n      isHuman: behavioralData.isHuman,\n      confidence: behavioralData.confidence,\n      mouseMovements: behavioralData.mouseMovements.slice(-5), // Last 5 only\n      keystrokeDynamics: behavioralData.keystrokeDynamics.slice(-5),\n      touchPatterns: behavioralData.touchPatterns.slice(-5),\n      timingAnalysis: behavioralData.timingAnalysis,\n      deviceInteraction: behavioralData.deviceInteraction\n    };\n    \n    // Send via existing protection system\n    fetch('/api/protection/behavioral-data', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-Fingerprint-Session': window.AdvancedProtection.getSessionId() || ''\n      },\n      body: JSON.stringify(data)\n    }).catch(error => {\n      console.warn('[BehavioralAnalysis] Failed to send data:', error);\n    });\n  }\n\n  /**\n   * Clean up old data\n   */\n  function cleanupOldData() {\n    const cutoffTime = Date.now() - CONFIG.DATA_RETENTION_MS;\n    \n    behavioralData.mouseMovements = behavioralData.mouseMovements.filter(\n      data => data.timestamp > cutoffTime\n    );\n    \n    behavioralData.keystrokeDynamics = behavioralData.keystrokeDynamics.filter(\n      data => data.timestamp > cutoffTime\n    );\n    \n    behavioralData.touchPatterns = behavioralData.touchPatterns.filter(\n      data => data.timestamp > cutoffTime\n    );\n  }\n\n  /**\n   * Utility function to get element path\n   */\n  function getElementPath(element) {\n    if (!element) return 'unknown';\n    \n    const path = [];\n    let current = element;\n    \n    while (current && current !== document.body) {\n      let selector = current.tagName?.toLowerCase() || '';\n      if (current.id) {\n        selector += `#${current.id}`;\n      } else if (current.className) {\n        selector += `.${current.className.split(' ')[0]}`;\n      }\n      path.unshift(selector);\n      current = current.parentElement;\n    }\n    \n    return path.join(' > ');\n  }\n\n  /**\n   * Get current behavioral analysis\n   */\n  function getBehavioralAnalysis() {\n    return {\n      behavioralScore: behavioralData.behavioralScore,\n      isHuman: behavioralData.isHuman,\n      confidence: behavioralData.confidence,\n      dataPoints: {\n        mouseMovements: behavioralData.mouseMovements.length,\n        keystrokeDynamics: behavioralData.keystrokeDynamics.length,\n        touchPatterns: behavioralData.touchPatterns.length\n      },\n      collectionTime: collectionStartTime ? Date.now() - collectionStartTime : 0\n    };\n  }\n\n  /**\n   * Stop behavioral analysis\n   */\n  function stopBehavioralAnalysis() {\n    isCollecting = false;\n    console.log('[BehavioralAnalysis] Stopped collection');\n  }\n\n  // Auto-initialize\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', initializeBehavioralAnalysis);\n  } else {\n    initializeBehavioralAnalysis();\n  }\n\n  // Expose public API\n  window.BehavioralAnalysis = {\n    initialize: initializeBehavioralAnalysis,\n    stop: stopBehavioralAnalysis,\n    getAnalysis: getBehavioralAnalysis,\n    isCollecting: () => isCollecting,\n    CONFIG: CONFIG\n  };\n\n})(window);","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/browser-fingerprint.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'navigator' is not defined.","line":43,"column":18,"nodeType":"Identifier","messageId":"undef","endLine":43,"endColumn":27},{"ruleId":"no-undef","severity":2,"message":"'navigator' is not defined.","line":44,"column":17,"nodeType":"Identifier","messageId":"undef","endLine":44,"endColumn":26},{"ruleId":"no-undef","severity":2,"message":"'navigator' is not defined.","line":45,"column":18,"nodeType":"Identifier","messageId":"undef","endLine":45,"endColumn":27},{"ruleId":"no-undef","severity":2,"message":"'navigator' is not defined.","line":45,"column":42,"nodeType":"Identifier","messageId":"undef","endLine":45,"endColumn":51},{"ruleId":"no-undef","severity":2,"message":"'navigator' is not defined.","line":46,"column":17,"nodeType":"Identifier","messageId":"undef","endLine":46,"endColumn":26},{"ruleId":"no-undef","severity":2,"message":"'navigator' is not defined.","line":47,"column":22,"nodeType":"Identifier","messageId":"undef","endLine":47,"endColumn":31},{"ruleId":"no-undef","severity":2,"message":"'navigator' is not defined.","line":48,"column":19,"nodeType":"Identifier","messageId":"undef","endLine":48,"endColumn":28},{"ruleId":"no-undef","severity":2,"message":"'screen' is not defined.","line":52,"column":16,"nodeType":"Identifier","messageId":"undef","endLine":52,"endColumn":22},{"ruleId":"no-undef","severity":2,"message":"'screen' is not defined.","line":53,"column":17,"nodeType":"Identifier","messageId":"undef","endLine":53,"endColumn":23},{"ruleId":"no-undef","severity":2,"message":"'screen' is not defined.","line":54,"column":21,"nodeType":"Identifier","messageId":"undef","endLine":54,"endColumn":27},{"ruleId":"no-undef","severity":2,"message":"'screen' is not defined.","line":55,"column":22,"nodeType":"Identifier","messageId":"undef","endLine":55,"endColumn":28},{"ruleId":"no-undef","severity":2,"message":"'screen' is not defined.","line":56,"column":21,"nodeType":"Identifier","messageId":"undef","endLine":56,"endColumn":27},{"ruleId":"no-undef","severity":2,"message":"'screen' is not defined.","line":57,"column":21,"nodeType":"Identifier","messageId":"undef","endLine":57,"endColumn":27},{"ruleId":"no-undef","severity":2,"message":"'screen' is not defined.","line":58,"column":22,"nodeType":"Identifier","messageId":"undef","endLine":58,"endColumn":28},{"ruleId":"no-undef","severity":2,"message":"'navigator' is not defined.","line":72,"column":23,"nodeType":"Identifier","messageId":"undef","endLine":72,"endColumn":32},{"ruleId":"no-undef","severity":2,"message":"'navigator' is not defined.","line":73,"column":30,"nodeType":"Identifier","messageId":"undef","endLine":73,"endColumn":39},{"ruleId":"no-undef","severity":2,"message":"'navigator' is not defined.","line":74,"column":25,"nodeType":"Identifier","messageId":"undef","endLine":74,"endColumn":34},{"ruleId":"no-undef","severity":2,"message":"'navigator' is not defined.","line":79,"column":25,"nodeType":"Identifier","messageId":"undef","endLine":79,"endColumn":34},{"ruleId":"no-undef","severity":2,"message":"'navigator' is not defined.","line":113,"column":21,"nodeType":"Identifier","messageId":"undef","endLine":113,"endColumn":30},{"ruleId":"no-undef","severity":2,"message":"'navigator' is not defined.","line":114,"column":26,"nodeType":"Identifier","messageId":"undef","endLine":114,"endColumn":35},{"ruleId":"no-undef","severity":2,"message":"'navigator' is not defined.","line":115,"column":21,"nodeType":"Identifier","messageId":"undef","endLine":115,"endColumn":30},{"ruleId":"no-undef","severity":2,"message":"'navigator' is not defined.","line":116,"column":16,"nodeType":"Identifier","messageId":"undef","endLine":116,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":132,"column":22,"nodeType":"Identifier","messageId":"undef","endLine":132,"endColumn":30},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":175,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":175,"endColumn":14},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":185,"column":22,"nodeType":"Identifier","messageId":"undef","endLine":185,"endColumn":30},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":225,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":225,"endColumn":14},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":279,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":279,"endColumn":14},{"ruleId":"no-unused-vars","severity":2,"message":"'testString' is assigned a value but never used.","line":290,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":290,"endColumn":23,"suggestions":[{"messageId":"removeVar","data":{"varName":"testString"},"fix":{"range":[9284,9330],"text":""},"desc":"Remove unused variable 'testString'."}]},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":295,"column":27,"nodeType":"Identifier","messageId":"undef","endLine":295,"endColumn":35},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":300,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":300,"endColumn":15},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":327,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":327,"endColumn":15},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":338,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":338,"endColumn":14},{"ruleId":"no-undef","severity":2,"message":"'navigator' is not defined.","line":350,"column":11,"nodeType":"Identifier","messageId":"undef","endLine":350,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'navigator' is not defined.","line":351,"column":29,"nodeType":"Identifier","messageId":"undef","endLine":351,"endColumn":38},{"ruleId":"no-undef","severity":2,"message":"'navigator' is not defined.","line":352,"column":26,"nodeType":"Identifier","messageId":"undef","endLine":352,"endColumn":35},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":367,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":367,"endColumn":14},{"ruleId":"no-undef","severity":2,"message":"'MediaSource' is not defined.","line":379,"column":17,"nodeType":"Identifier","messageId":"undef","endLine":379,"endColumn":28},{"ruleId":"no-undef","severity":2,"message":"'MediaSource' is not defined.","line":380,"column":17,"nodeType":"Identifier","messageId":"undef","endLine":380,"endColumn":28},{"ruleId":"no-undef","severity":2,"message":"'MediaSource' is not defined.","line":381,"column":16,"nodeType":"Identifier","messageId":"undef","endLine":381,"endColumn":27},{"ruleId":"no-undef","severity":2,"message":"'Audio' is not defined.","line":384,"column":20,"nodeType":"Identifier","messageId":"undef","endLine":384,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'Audio' is not defined.","line":385,"column":20,"nodeType":"Identifier","messageId":"undef","endLine":385,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'Audio' is not defined.","line":386,"column":20,"nodeType":"Identifier","messageId":"undef","endLine":386,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'Audio' is not defined.","line":387,"column":20,"nodeType":"Identifier","messageId":"undef","endLine":387,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":393,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":393,"endColumn":14},{"ruleId":"no-undef","severity":2,"message":"'TextEncoder' is not defined.","line":414,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":414,"endColumn":42},{"ruleId":"no-undef","severity":2,"message":"'crypto' is not defined.","line":418,"column":32,"nodeType":"Identifier","messageId":"undef","endLine":418,"endColumn":38},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":424,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":424,"endColumn":14},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":442,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":442,"endColumn":14},{"ruleId":"no-undef","severity":2,"message":"'window' is not defined.","line":518,"column":4,"nodeType":"Identifier","messageId":"undef","endLine":518,"endColumn":10}],"suppressedMessages":[],"errorCount":49,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Client-side Browser Fingerprinting Library\n * \n * Generates comprehensive browser fingerprints for abuse detection\n * Compatible with all major browsers (Chrome, Firefox, Safari, Edge)\n * \n * Usage:\n * const fingerprint = await generateBrowserFingerprint();\n * console.log(fingerprint);\n */\n\n(function(window) {\n  'use strict';\n\n  // Configuration\n  const CONFIG = {\n    CANVAS_STRENGTH: 10,\n    WEBGL_STRENGTH: 10,\n    AUDIO_STRENGTH: 10,\n    FONT_LIST: [\n      'Arial', 'Arial Black', 'Arial Narrow', 'Calibri', 'Cambria', 'Cambria Math',\n      'Comic Sans MS', 'Consolas', 'Courier', 'Courier New', 'Georgia', 'Helvetica',\n      'Impact', 'Lucida Console', 'Lucida Sans Unicode', 'Microsoft Sans Serif',\n      'MS Gothic', 'MS PGothic', 'MS Sans Serif', 'MS Serif', 'Palatino Linotype',\n      'Segoe Print', 'Segoe Script', 'Segoe UI', 'Segoe UI Light', 'Segoe UI Semibold',\n      'Segoe UI Symbol', 'Tahoma', 'Times', 'Times New Roman', 'Trebuchet MS',\n      'Verdana', 'Wingdings', 'Wingdings 2', 'Wingdings 3'\n    ],\n    PLUGIN_LIST: [\n      'Chrome PDF Plugin', 'Chrome PDF Viewer', 'Native Client', 'Shockwave Flash',\n      'QuickTime Plug-in', 'Java Applet Plug-in', 'Windows Media Player Plug-in'\n    ]\n  };\n\n  /**\n   * Generate comprehensive browser fingerprint\n   */\n  async function generateBrowserFingerprint() {\n    const fingerprint = {\n      timestamp: Date.now(),\n      \n      // Basic browser info\n      userAgent: navigator.userAgent,\n      language: navigator.language,\n      languages: navigator.languages || [navigator.language],\n      platform: navigator.platform,\n      cookieEnabled: navigator.cookieEnabled,\n      doNotTrack: navigator.doNotTrack,\n      \n      // Screen and display info\n      screen: {\n        width: screen.width,\n        height: screen.height,\n        availWidth: screen.availWidth,\n        availHeight: screen.availHeight,\n        colorDepth: screen.colorDepth,\n        pixelDepth: screen.pixelDepth,\n        orientation: screen.orientation?.type || 'unknown'\n      },\n      \n      // Window info\n      window: {\n        innerWidth: window.innerWidth,\n        innerHeight: window.innerHeight,\n        outerWidth: window.outerWidth,\n        outerHeight: window.outerHeight,\n        devicePixelRatio: window.devicePixelRatio || 1\n      },\n      \n      // Hardware info\n      hardware: {\n        deviceMemory: navigator.deviceMemory || 0,\n        hardwareConcurrency: navigator.hardwareConcurrency || 0,\n        maxTouchPoints: navigator.maxTouchPoints || 0\n      },\n      \n      // Touch support\n      touch: {\n        maxTouchPoints: navigator.maxTouchPoints || 0,\n        touchEvent: 'ontouchstart' in window,\n        touchStart: 'ontouchstart' in window,\n        touchEnd: 'ontouchend' in window,\n        touchMove: 'ontouchmove' in window\n      },\n      \n      // Canvas fingerprint\n      canvas: await getCanvasFingerprint(),\n      \n      // WebGL fingerprint\n      webgl: await getWebGLFingerprint(),\n      \n      // Audio fingerprint\n      audio: await getAudioFingerprint(),\n      \n      // Font detection\n      fonts: await getInstalledFonts(),\n      \n      // Plugin detection\n      plugins: getPlugins(),\n      \n      // Timezone info\n      timezone: {\n        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,\n        offset: new Date().getTimezoneOffset(),\n        dst: isDST()\n      },\n      \n      // Media capabilities\n      mediaCapabilities: getMediaCapabilities(),\n      \n      // Network info\n      network: {\n        connection: navigator.connection ? {\n          effectiveType: navigator.connection.effectiveType,\n          downlink: navigator.connection.downlink,\n          rtt: navigator.connection.rtt\n        } : null\n      }\n    };\n\n    // Generate hash\n    fingerprint.hash = await generateHash(fingerprint);\n    \n    return fingerprint;\n  }\n\n  /**\n   * Generate canvas fingerprint\n   */\n  async function getCanvasFingerprint() {\n    try {\n      const canvas = document.createElement('canvas');\n      const ctx = canvas.getContext('2d');\n      \n      canvas.width = 200;\n      canvas.height = 50;\n      \n      // Draw text with different fonts and styles\n      ctx.textBaseline = 'top';\n      ctx.font = '14px Arial';\n      ctx.fillStyle = '#f60';\n      ctx.fillRect(125, 1, 62, 20);\n      \n      ctx.fillStyle = '#069';\n      ctx.font = '16px Arial';\n      ctx.fillText('Browser Fingerprint', 2, 15);\n      \n      ctx.fillStyle = 'rgba(102, 204, 0, 0.7)';\n      ctx.font = '18px Arial';\n      ctx.fillText('Canvas Test', 4, 45);\n      \n      // Add some randomness\n      for (let i = 0; i < CONFIG.CANVAS_STRENGTH; i++) {\n        ctx.fillStyle = `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255}, 0.5)`;\n        ctx.fillRect(Math.random() * canvas.width, Math.random() * canvas.height, 2, 2);\n      }\n      \n      // Get image data and create hash\n      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n      const data = imageData.data;\n      \n      // Create hash from image data\n      const hash = await hashData(data);\n      \n      // Clean up\n      canvas.remove();\n      \n      return {\n        hash: hash,\n        width: canvas.width,\n        height: canvas.height,\n        textMetrics: ctx.measureText('Browser Fingerprint').width\n      };\n    } catch (error) {\n      console.warn('Canvas fingerprint failed:', error);\n      return { hash: 'error', width: 0, height: 0, textMetrics: 0 };\n    }\n  }\n\n  /**\n   * Generate WebGL fingerprint\n   */\n  async function getWebGLFingerprint() {\n    try {\n      const canvas = document.createElement('canvas');\n      const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');\n      \n      if (!gl) {\n        return { vendor: 'unknown', renderer: 'unknown', version: 'unknown', extensions: [] };\n      }\n      \n      const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');\n      const vendor = debugInfo ? gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL) : 'unknown';\n      const renderer = debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : 'unknown';\n      const version = gl.getParameter(gl.VERSION);\n      \n      // Get extensions\n      const extensions = gl.getSupportedExtensions() || [];\n      \n      // Create hash from WebGL info\n      const webglHash = await hashData({ vendor, renderer, version, extensions });\n      \n      // Add some WebGL rendering to make it more unique\n      gl.clearColor(Math.random(), Math.random(), Math.random(), 1);\n      gl.clear(gl.COLOR_BUFFER_BIT);\n      \n      // Get pixel data for additional uniqueness\n      const pixels = new Uint8Array(4);\n      gl.readPixels(0, 0, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\n      \n      const pixelHash = await hashData(pixels);\n      \n      // Clean up\n      canvas.remove();\n      \n      return {\n        vendor,\n        renderer,\n        version,\n        extensions: extensions.slice(0, 10), // Limit to avoid too much data\n        webglHash,\n        pixelHash\n      };\n    } catch (error) {\n      console.warn('WebGL fingerprint failed:', error);\n      return { vendor: 'error', renderer: 'error', version: 'error', extensions: [] };\n    }\n  }\n\n  /**\n   * Generate audio fingerprint\n   */\n  async function getAudioFingerprint() {\n    try {\n      if (!window.AudioContext && !window.webkitAudioContext) {\n        return { oscillator: 'unsupported', dynamics: 'unsupported', frequency: 0 };\n      }\n      \n      const audioContext = new (window.AudioContext || window.webkitAudioContext)();\n      \n      // Create oscillator\n      const oscillator = audioContext.createOscillator();\n      oscillator.type = 'triangle';\n      oscillator.frequency.setValueAtTime(10000, audioContext.currentTime);\n      \n      // Create compressor\n      const compressor = audioContext.createDynamicsCompressor();\n      compressor.threshold.setValueAtTime(-50, audioContext.currentTime);\n      compressor.knee.setValueAtTime(40, audioContext.currentTime);\n      compressor.ratio.setValueAtTime(12, audioContext.currentTime);\n      compressor.attack.setValueAtTime(0, audioContext.currentTime);\n      compressor.release.setValueAtTime(0.25, audioContext.currentTime);\n      \n      // Connect and process\n      oscillator.connect(compressor);\n      compressor.connect(audioContext.destination);\n      \n      oscillator.start();\n      \n      // Get frequency response\n      const frequencyData = new Float32Array(32);\n      compressor.frequencyResponse(new Float32Array([1000, 2000, 3000]), frequencyData, new Float32Array(32));\n      \n      // Create hash from audio data\n      const oscillatorHash = await hashData(oscillator);\n      const dynamicsHash = await hashData(compressor);\n      const frequencyHash = await hashData(frequencyData);\n      \n      oscillator.stop();\n      audioContext.close();\n      \n      return {\n        oscillator: oscillatorHash,\n        dynamics: dynamicsHash,\n        frequency: frequencyHash,\n        sampleRate: audioContext.sampleRate\n      };\n    } catch (error) {\n      console.warn('Audio fingerprint failed:', error);\n      return { oscillator: 'error', dynamics: 'error', frequency: 'error', sampleRate: 0 };\n    }\n  }\n\n  /**\n   * Detect installed fonts\n   */\n  async function getInstalledFonts() {\n    try {\n      const availableFonts = [];\n      const testString = 'Browser Fingerprint Test';\n      const testSize = '72px';\n      const baseFonts = ['monospace', 'serif', 'sans-serif'];\n      \n      // Create test element\n      const testElement = document.createElement('span');\n      testElement.style.position = 'absolute';\n      testElement.style.left = '-9999px';\n      testElement.style.fontSize = testSize;\n      testElement.style.lineHeight = 'normal';\n      document.body.appendChild(testElement);\n      \n      // Test each font\n      for (const font of CONFIG.FONT_LIST) {\n        let isAvailable = false;\n        \n        for (const baseFont of baseFonts) {\n          testElement.style.fontFamily = `'${font}', ${baseFont}`;\n          const testWidth = testElement.offsetWidth;\n          const testHeight = testElement.offsetHeight;\n          \n          testElement.style.fontFamily = baseFont;\n          const baseWidth = testElement.offsetWidth;\n          const baseHeight = testElement.offsetHeight;\n          \n          if (testWidth !== baseWidth || testHeight !== baseHeight) {\n            isAvailable = true;\n            break;\n          }\n        }\n        \n        if (isAvailable) {\n          availableFonts.push(font);\n        }\n      }\n      \n      // Clean up\n      document.body.removeChild(testElement);\n      \n      // Create hash from font list\n      const fontHash = await hashData(availableFonts);\n      \n      return {\n        count: availableFonts.length,\n        fonts: availableFonts,\n        hash: fontHash\n      };\n    } catch (error) {\n      console.warn('Font detection failed:', error);\n      return { count: 0, fonts: [], hash: 'error' };\n    }\n  }\n\n  /**\n   * Get browser plugins\n   */\n  function getPlugins() {\n    try {\n      const plugins = [];\n      \n      if (navigator.plugins) {\n        for (let i = 0; i < navigator.plugins.length; i++) {\n          const plugin = navigator.plugins[i];\n          plugins.push({\n            name: plugin.name,\n            filename: plugin.filename,\n            description: plugin.description,\n            version: plugin.version || 'unknown'\n          });\n        }\n      }\n      \n      return {\n        count: plugins.length,\n        plugins: plugins\n      };\n    } catch (error) {\n      console.warn('Plugin detection failed:', error);\n      return { count: 0, plugins: [] };\n    }\n  }\n\n  /**\n   * Get media capabilities\n   */\n  function getMediaCapabilities() {\n    try {\n      const capabilities = {\n        video: {\n          h264: MediaSource.isTypeSupported('video/mp4; codecs=\"avc1.42E01E\"'),\n          webm: MediaSource.isTypeSupported('video/webm; codecs=\"vp8, vorbis\"'),\n          ogg: MediaSource.isTypeSupported('video/ogg; codecs=\"theora\"')\n        },\n        audio: {\n          mp3: new Audio().canPlayType('audio/mpeg') !== '',\n          ogg: new Audio().canPlayType('audio/ogg') !== '',\n          wav: new Audio().canPlayType('audio/wav') !== '',\n          m4a: new Audio().canPlayType('audio/x-m4a') !== ''\n        }\n      };\n      \n      return capabilities;\n    } catch (error) {\n      console.warn('Media capabilities detection failed:', error);\n      return { video: {}, audio: {} };\n    }\n  }\n\n  /**\n   * Check if daylight saving time is active\n   */\n  function isDST() {\n    const date = new Date();\n    const january = new Date(date.getFullYear(), 0, 1);\n    const july = new Date(date.getFullYear(), 6, 1);\n    \n    return Math.max(january.getTimezoneOffset(), july.getTimezoneOffset()) !== date.getTimezoneOffset();\n  }\n\n  /**\n   * Generate hash from data\n   */\n  async function hashData(data) {\n    try {\n      const textEncoder = new TextEncoder();\n      const dataString = JSON.stringify(data);\n      const dataBuffer = textEncoder.encode(dataString);\n      \n      const hashBuffer = await crypto.subtle.digest('SHA-256', dataBuffer);\n      const hashArray = Array.from(new Uint8Array(hashBuffer));\n      const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n      \n      return hashHex;\n    } catch (error) {\n      console.warn('Hash generation failed:', error);\n      return 'hash_error';\n    }\n  }\n\n  /**\n   * Generate overall hash from fingerprint\n   */\n  async function generateHash(fingerprint) {\n    try {\n      // Create a stable representation by sorting keys\n      const sortedFingerprint = {};\n      Object.keys(fingerprint).sort().forEach(key => {\n        sortedFingerprint[key] = fingerprint[key];\n      });\n      \n      return await hashData(sortedFingerprint);\n    } catch (error) {\n      console.warn('Overall hash generation failed:', error);\n      return 'overall_hash_error';\n    }\n  }\n\n  // Utility functions\n  const utils = {\n    // Check if fingerprint is valid\n    isValidFingerprint: function(fingerprint) {\n      return fingerprint && fingerprint.hash && fingerprint.timestamp;\n    },\n    \n    // Compare two fingerprints\n    compareFingerprints: async function(fp1, fp2) {\n      if (!fp1 || !fp2) return 0;\n      \n      let similarity = 0;\n      let total = 0;\n      \n      // Compare basic properties\n      const basicProps = ['userAgent', 'language', 'platform', 'cookieEnabled'];\n      basicProps.forEach(prop => {\n        total++;\n        if (fp1[prop] === fp2[prop]) similarity++;\n      });\n      \n      // Compare hashes\n      if (fp1.hash === fp2.hash) similarity += 5;\n      \n      // Compare canvas hashes\n      if (fp1.canvas?.hash === fp2.canvas?.hash) similarity += 3;\n      \n      // Compare WebGL hashes\n      if (fp1.webgl?.webglHash === fp2.webgl?.webglHash) similarity += 3;\n      \n      // Compare audio hashes\n      if (fp1.audio?.oscillator === fp2.audio?.oscillator) similarity += 2;\n      \n      return similarity / (total + 13); // Normalized to 0-1\n    },\n    \n    // Detect anomalies\n    detectAnomalies: function(fingerprint) {\n      const anomalies = [];\n      \n      // Check for headless browser\n      if (fingerprint.userAgent.includes('HeadlessChrome')) {\n        anomalies.push('Headless browser detected');\n      }\n      \n      // Check for minimal fingerprint\n      if (!fingerprint.canvas || fingerprint.canvas.hash === 'error') {\n        anomalies.push('Canvas fingerprint failed');\n      }\n      \n      // Check for plugin inconsistencies\n      if (fingerprint.plugins.count === 0 && fingerprint.userAgent.includes('Chrome')) {\n        anomalies.push('Chrome with no plugins detected');\n      }\n      \n      // Check for mobile inconsistencies\n      if (fingerprint.userAgent.includes('Mobile') && fingerprint.touch.maxTouchPoints === 0) {\n        anomalies.push('Mobile UA but no touch support');\n      }\n      \n      return anomalies;\n    }\n  };\n\n  // Expose the library\n  window.BrowserFingerprint = {\n    generate: generateBrowserFingerprint,\n    utils: utils,\n    CONFIG: CONFIG\n  };\n\n})(window);","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/AdvancedAnalysisResults.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ComparisonView.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[439,442],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[439,442],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[517,520],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[517,520],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[539,542],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[539,542],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[828,831],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[828,831],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { ArrowLeftRight, Equal, Info, AlertTriangle, Download } from \"lucide-react\";\n\ninterface FileMetadata {\n    filename: string;\n    fields: Record<string, any>;\n}\n\ninterface ComparisonDifference {\n    field: string;\n    file1_value: any;\n    file2_value: any;\n    status: \"match\" | \"different\" | \"only_in_file1\" | \"only_in_file2\";\n}\n\ninterface ComparisonViewProps {\n    file1: FileMetadata;\n    file2: FileMetadata;\n    differences: ComparisonDifference[];\n    similarityScore: number;\n    onExport?: () => void;\n}\n\nfunction formatValue(value: any): string {\n    if (value === null || value === undefined) return \"\";\n    if (typeof value === \"object\") return JSON.stringify(value);\n    return String(value);\n}\n\nfunction DifferenceRow({ diff }: { diff: ComparisonDifference }) {\n    const getStatusIcon = () => {\n        switch (diff.status) {\n            case \"match\":\n                return <Equal className=\"w-4 h-4 text-emerald-500\" />;\n            case \"different\":\n                return <AlertTriangle className=\"w-4 h-4 text-yellow-500\" />;\n            case \"only_in_file1\":\n            case \"only_in_file2\":\n                return <Info className=\"w-4 h-4 text-blue-500\" />;\n        }\n    };\n\n    const getBgColor = () => {\n        switch (diff.status) {\n            case \"match\":\n                return \"bg-emerald-500/5\";\n            case \"different\":\n                return \"bg-yellow-500/10\";\n            case \"only_in_file1\":\n            case \"only_in_file2\":\n                return \"bg-blue-500/5\";\n        }\n    };\n\n    return (\n        <div className={`grid grid-cols-3 gap-4 p-3 border-b border-white/5 ${getBgColor()}`}>\n            <div className=\"flex items-center gap-2\">\n                {getStatusIcon()}\n                <span className=\"text-sm font-mono text-slate-200 truncate\">{diff.field}</span>\n            </div>\n            <div className=\"text-sm text-white truncate\" title={formatValue(diff.file1_value)}>\n                {diff.status === \"only_in_file2\" ? (\n                    <span className=\"text-slate-500\"></span>\n                ) : (\n                    formatValue(diff.file1_value)\n                )}\n            </div>\n            <div className=\"text-sm text-white truncate\" title={formatValue(diff.file2_value)}>\n                {diff.status === \"only_in_file1\" ? (\n                    <span className=\"text-slate-500\"></span>\n                ) : (\n                    formatValue(diff.file2_value)\n                )}\n            </div>\n        </div>\n    );\n}\n\nexport function ComparisonView({\n    file1,\n    file2,\n    differences,\n    similarityScore,\n    onExport,\n}: ComparisonViewProps) {\n    const matchCount = differences.filter((d) => d.status === \"match\").length;\n    const diffCount = differences.filter((d) => d.status === \"different\").length;\n    const file1OnlyCount = differences.filter((d) => d.status === \"only_in_file1\").length;\n    const file2OnlyCount = differences.filter((d) => d.status === \"only_in_file2\").length;\n\n    return (\n        <Card className=\"bg-card border-white/10\">\n            <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                    <div>\n                        <CardTitle className=\"flex items-center gap-2 text-white\">\n                            <ArrowLeftRight className=\"w-5 h-5 text-primary\" />\n                            Metadata Comparison\n                        </CardTitle>\n                        <CardDescription className=\"text-slate-300\">\n                            Side-by-side analysis of {file1.filename} vs {file2.filename}\n                        </CardDescription>\n                    </div>\n                    {onExport && (\n                        <Button variant=\"outline\" size=\"sm\" onClick={onExport} className=\"gap-2\">\n                            <Download className=\"w-4 h-4\" />\n                            Export\n                        </Button>\n                    )}\n                </div>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n                {/* Similarity Score */}\n                <div className=\"flex items-center justify-between p-4 bg-muted/30 rounded-lg\">\n                    <div className=\"space-y-1\">\n                        <p className=\"text-sm text-slate-300\">Similarity Score</p>\n                        <p className=\"text-3xl font-bold text-white\">{similarityScore}%</p>\n                    </div>\n                    <div className=\"grid grid-cols-2 gap-4 text-center\">\n                        <div>\n                            <p className=\"text-2xl font-bold text-emerald-500\">{matchCount}</p>\n                            <p className=\"text-xs text-slate-300\">Matching</p>\n                        </div>\n                        <div>\n                            <p className=\"text-2xl font-bold text-yellow-500\">{diffCount}</p>\n                            <p className=\"text-xs text-slate-300\">Different</p>\n                        </div>\n                    </div>\n                </div>\n\n                {/* Stats */}\n                <div className=\"flex gap-2 flex-wrap\">\n                    <Badge variant=\"secondary\" className=\"bg-emerald-500/20 text-emerald-400 border-emerald-500/30\">\n                        {matchCount} Matching\n                    </Badge>\n                    <Badge variant=\"secondary\" className=\"bg-yellow-500/20 text-yellow-400 border-yellow-500/30\">\n                        {diffCount} Different\n                    </Badge>\n                    {file1OnlyCount > 0 && (\n                        <Badge variant=\"secondary\" className=\"bg-blue-500/20 text-blue-400 border-blue-500/30\">\n                            {file1OnlyCount} Only in File 1\n                        </Badge>\n                    )}\n                    {file2OnlyCount > 0 && (\n                        <Badge variant=\"secondary\" className=\"bg-purple-500/20 text-purple-400 border-purple-500/30\">\n                            {file2OnlyCount} Only in File 2\n                        </Badge>\n                    )}\n                </div>\n\n                {/* Comparison Table */}\n                <div className=\"border border-white/10 rounded-lg overflow-hidden\">\n                    {/* Header */}\n                    <div className=\"grid grid-cols-3 gap-4 p-3 bg-muted/50 border-b border-white/10\">\n                        <span className=\"text-xs font-semibold text-slate-300 uppercase\">Field</span>\n                        <span className=\"text-xs font-semibold text-slate-300 uppercase truncate\" title={file1.filename}>\n                            {file1.filename}\n                        </span>\n                        <span className=\"text-xs font-semibold text-slate-300 uppercase truncate\" title={file2.filename}>\n                            {file2.filename}\n                        </span>\n                    </div>\n\n                    {/* Rows */}\n                    <ScrollArea className=\"h-[400px]\">\n                        {differences.map((diff, i) => (\n                            <DifferenceRow key={i} diff={diff} />\n                        ))}\n                    </ScrollArea>\n                </div>\n            </CardContent>\n        </Card>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ForensicReport.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/MonitoringDashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/TimelineVisualization.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/a11y/index.tsx","messages":[{"ruleId":"jsx-a11y/click-events-have-key-events","severity":1,"message":"Visible, non-interactive elements with click handlers must have at least one keyboard listener.","line":339,"column":7,"nodeType":"JSXOpeningElement","endLine":342,"endColumn":8},{"ruleId":"jsx-a11y/no-static-element-interactions","severity":1,"message":"Avoid non-native interactive elements. If using native HTML is not possible, add an appropriate role and support for tabbing, mouse, keyboard, and touch inputs to an interactive content element.","line":339,"column":7,"nodeType":"JSXOpeningElement","endLine":342,"endColumn":8},{"ruleId":"jsx-a11y/click-events-have-key-events","severity":1,"message":"Visible, non-interactive elements with click handlers must have at least one keyboard listener.","line":343,"column":9,"nodeType":"JSXOpeningElement","endLine":352,"endColumn":10},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":385,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":385,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10188,10191],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10188,10191],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Accessibility Component Library - Reusable a11y patterns\n */\n\nimport React, { useState, useEffect, useRef, createContext, useContext, ReactNode } from 'react';\n\n// Skip Links Component\nexport const SkipLinks: React.FC = () => {\n  return (\n    <nav className=\"skip-links\" aria-label=\"Skip navigation\">\n      <a href=\"#main-content\" className=\"skip-link\">\n        Skip to main content\n      </a>\n      <a href=\"#main-navigation\" className=\"skip-link\">\n        Skip to navigation\n      </a>\n      <a href=\"#search\" className=\"skip-link\">\n        Skip to search\n      </a>\n    </nav>\n  );\n};\n\n// Live Region Component\ninterface LiveRegionProps {\n  children: ReactNode;\n  ariaLive?: 'polite' | 'assertive';\n  id?: string;\n}\n\nexport const LiveRegion: React.FC<LiveRegionProps> = ({ \n  children, \n  ariaLive = 'polite', \n  id \n}) => {\n  return (\n    <div\n      id={id}\n      role=\"status\"\n      aria-live={ariaLive}\n      aria-atomic=\"true\"\n      className=\"sr-only\"\n    >\n      {children}\n    </div>\n  );\n};\n\n// Focus Trap Component\ninterface FocusTrapProps {\n  children: ReactNode;\n  isActive?: boolean;\n  returnFocus?: boolean;\n}\n\nexport const FocusTrap: React.FC<FocusTrapProps> = ({ \n  children, \n  isActive = true,\n  returnFocus = true \n}) => {\n  const wrapperRef = useRef<HTMLDivElement>(null);\n  const previousActiveElement = useRef<HTMLElement | null>(null);\n\n  useEffect(() => {\n    if (!isActive) return;\n\n    previousActiveElement.current = document.activeElement as HTMLElement;\n    const focusableElements = getFocusableElements(wrapperRef.current);\n    \n    if (focusableElements.length > 0) {\n      focusableElements[0].focus();\n    }\n\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key !== 'Tab') return;\n\n      const focusableElements = getFocusableElements(wrapperRef.current);\n      if (focusableElements.length === 0) return;\n\n      const firstElement = focusableElements[0];\n      const lastElement = focusableElements[focusableElements.length - 1];\n\n      if (e.shiftKey && document.activeElement === firstElement) {\n        lastElement.focus();\n        e.preventDefault();\n      } else if (!e.shiftKey && document.activeElement === lastElement) {\n        firstElement.focus();\n        e.preventDefault();\n      }\n    };\n\n    document.addEventListener('keydown', handleKeyDown);\n\n    return () => {\n      document.removeEventListener('keydown', handleKeyDown);\n      if (returnFocus && previousActiveElement.current) {\n        previousActiveElement.current.focus();\n      }\n    };\n  }, [isActive, returnFocus]);\n\n  return <div ref={wrapperRef} tabIndex={-1}>{children}</div>;\n};\n\n// Helper function to get focusable elements\nfunction getFocusableElements(container: HTMLElement | null): HTMLElement[] {\n  if (!container) return [];\n  \n  return Array.from(\n    container.querySelectorAll(\n      'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n    )\n  ).filter(el => {\n    const isVisible = (el as HTMLElement).offsetWidth > 0 || (el as HTMLElement).offsetHeight > 0;\n    const isEnabled = !(el as HTMLButtonElement).disabled;\n    return isVisible && isEnabled;\n  }) as HTMLElement[];\n}\n\n// Announcer Component\ninterface AnnouncerProps {\n  children: ReactNode;\n  priority?: 'polite' | 'assertive';\n}\n\nexport const Announcer: React.FC<AnnouncerProps> = ({ children, priority = 'polite' }) => {\n  const [announcement, setAnnouncement] = useState<string | null>(null);\n  const [id] = useState(() => `announcer-${Math.random().toString(36).substr(2, 9)}`);\n\n  useEffect(() => {\n    if (children) {\n      setAnnouncement(children as string);\n      \n      // Clear announcement after a delay\n      const timer = setTimeout(() => {\n        setAnnouncement(null);\n      }, 1000);\n\n      return () => clearTimeout(timer);\n    }\n  }, [children]);\n\n  return (\n    <div\n      id={id}\n      role=\"alert\"\n      aria-live={priority}\n      aria-atomic=\"true\"\n      className=\"sr-only\"\n    >\n      {announcement}\n    </div>\n  );\n};\n\n// Accessibility Context\ninterface AccessibilityContextType {\n  reducedMotion: boolean;\n  highContrast: boolean;\n  fontSize: 'normal' | 'large' | 'larger';\n  toggleReducedMotion: () => void;\n  toggleHighContrast: () => void;\n  setFontSize: (size: 'normal' | 'large' | 'larger') => void;\n}\n\nconst AccessibilityContext = createContext<AccessibilityContextType | undefined>(undefined);\n\nexport const AccessibilityProvider: React.FC<{ children: ReactNode }> = ({ children }) => {\n  const [reducedMotion, setReducedMotion] = useState(false);\n  const [highContrast, setHighContrast] = useState(false);\n  const [fontSize, setFontSize] = useState<'normal' | 'large' | 'larger'>('normal');\n\n  useEffect(() => {\n    // Check for user preference for reduced motion\n    const mediaQuery = window.matchMedia('(prefers-reduced-motion: reduce)');\n    setReducedMotion(mediaQuery.matches);\n\n    const handleChange = (e: MediaQueryListEvent) => {\n      setReducedMotion(e.matches);\n    };\n\n    mediaQuery.addEventListener('change', handleChange);\n    return () => mediaQuery.removeEventListener('change', handleChange);\n  }, []);\n\n  const toggleReducedMotion = () => {\n    setReducedMotion(prev => !prev);\n  };\n\n  const toggleHighContrast = () => {\n    setHighContrast(prev => !prev);\n  };\n\n  const value: AccessibilityContextType = {\n    reducedMotion,\n    highContrast,\n    fontSize,\n    toggleReducedMotion,\n    toggleHighContrast,\n    setFontSize,\n  };\n\n  return (\n    <AccessibilityContext.Provider value={value}>\n      <div \n        className={`\n          ${highContrast ? 'high-contrast' : ''}\n          ${fontSize === 'large' ? 'font-size-large' : ''}\n          ${fontSize === 'larger' ? 'font-size-larger' : ''}\n          ${reducedMotion ? 'reduced-motion' : ''}\n        `}\n      >\n        {children}\n      </div>\n    </AccessibilityContext.Provider>\n  );\n};\n\nexport const useAccessibility = () => {\n  const context = useContext(AccessibilityContext);\n  if (!context) {\n    throw new Error('useAccessibility must be used within AccessibilityProvider');\n  }\n  return context;\n};\n\n// Accessible Button Component\ninterface AccessibleButtonProps {\n  children: ReactNode;\n  onClick: () => void;\n  variant?: 'primary' | 'secondary' | 'outline';\n  disabled?: boolean;\n  ariaLabel?: string;\n  className?: string;\n}\n\nexport const AccessibleButton: React.FC<AccessibleButtonProps> = ({\n  children,\n  onClick,\n  variant = 'primary',\n  disabled = false,\n  ariaLabel,\n  className = ''\n}) => {\n  const handleClick = () => {\n    if (!disabled) {\n      onClick();\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' || e.key === ' ') {\n      e.preventDefault();\n      if (!disabled) {\n        onClick();\n      }\n    }\n  };\n\n  const variantClasses = {\n    primary: 'bg-blue-600 hover:bg-blue-700 text-white',\n    secondary: 'bg-gray-600 hover:bg-gray-700 text-white',\n    outline: 'border border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200'\n  };\n\n  const disabledClasses = disabled \n    ? 'opacity-50 cursor-not-allowed' \n    : 'cursor-pointer';\n\n  return (\n    <button\n      onClick={handleClick}\n      onKeyDown={handleKeyDown}\n      disabled={disabled}\n      aria-label={ariaLabel}\n      aria-disabled={disabled}\n      tabIndex={disabled ? -1 : 0}\n      className={`\n        px-4 py-2 rounded-md font-medium transition-colors\n        ${variantClasses[variant]} \n        ${disabledClasses} \n        ${className}\n      `}\n    >\n      {children}\n    </button>\n  );\n};\n\n// Accessible Modal Component\ninterface AccessibleModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  title: string;\n  children: ReactNode;\n  ariaLabel?: string;\n}\n\nexport const AccessibleModal: React.FC<AccessibleModalProps> = ({\n  isOpen,\n  onClose,\n  title,\n  children,\n  ariaLabel\n}) => {\n  const modalRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (isOpen && modalRef.current) {\n      // Focus the modal when it opens\n      modalRef.current.focus();\n    }\n  }, [isOpen]);\n\n  useEffect(() => {\n    if (isOpen) {\n      // Prevent background scrolling\n      document.body.style.overflow = 'hidden';\n      \n      // Handle escape key\n      const handleEscape = (e: KeyboardEvent) => {\n        if (e.key === 'Escape') {\n          onClose();\n        }\n      };\n      \n      document.addEventListener('keydown', handleEscape);\n      return () => {\n        document.removeEventListener('keydown', handleEscape);\n        document.body.style.overflow = '';\n      };\n    }\n  }, [isOpen, onClose]);\n\n  if (!isOpen) return null;\n\n  return (\n    <FocusTrap isActive={isOpen}>\n      <div\n        className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50\"\n        onClick={onClose}\n      >\n        <div\n          ref={modalRef}\n          role=\"dialog\"\n          aria-modal=\"true\"\n          aria-labelledby={ariaLabel ? undefined : \"modal-title\"}\n          aria-describedby=\"modal-description\"\n          tabIndex={-1}\n          className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md\"\n          onClick={e => e.stopPropagation()}\n        >\n          <div className=\"p-6\">\n            <div className=\"flex justify-between items-center mb-4\">\n              <h2 \n                id=\"modal-title\"\n                className=\"text-xl font-bold text-gray-900 dark:text-white\"\n              >\n                {title}\n              </h2>\n              <button\n                onClick={onClose}\n                aria-label=\"Close modal\"\n                className=\"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200\"\n              >\n                <span className=\"sr-only\">Close</span>\n                <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M6 18L18 6M6 6l12 12\" />\n                </svg>\n              </button>\n            </div>\n            <div id=\"modal-description\">\n              {children}\n            </div>\n          </div>\n        </div>\n      </div>\n    </FocusTrap>\n  );\n};\n\n// Accessible Table Component\ninterface AccessibleTableProps {\n  headers: string[];\n  data: any[][];\n  caption?: string;\n  className?: string;\n}\n\nexport const AccessibleTable: React.FC<AccessibleTableProps> = ({\n  headers,\n  data,\n  caption,\n  className = ''\n}) => {\n  return (\n    <div className=\"overflow-x-auto\">\n      <table className={`min-w-full divide-y divide-gray-200 dark:divide-gray-700 ${className}`}>\n        {caption && (\n          <caption className=\"sr-only\">\n            {caption}\n          </caption>\n        )}\n        <thead className=\"bg-gray-50 dark:bg-gray-700\">\n          <tr>\n            {headers.map((header, index) => (\n              <th\n                key={index}\n                scope=\"col\"\n                className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\"\n              >\n                {header}\n              </th>\n            ))}\n          </tr>\n        </thead>\n        <tbody className=\"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700\">\n          {data.map((row, rowIndex) => (\n            <tr key={rowIndex} className={rowIndex % 2 === 0 ? 'bg-white dark:bg-gray-800' : 'bg-gray-50 dark:bg-gray-700'}>\n              {row.map((cell, cellIndex) => (\n                <td\n                  key={cellIndex}\n                  className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300\"\n                >\n                  {cell}\n                </td>\n              ))}\n            </tr>\n          ))}\n        </tbody>\n      </table>\n    </div>\n  );\n};\n\n// Accessible Form Components\ninterface AccessibleInputProps {\n  id: string;\n  label: string;\n  type?: string;\n  value: string;\n  onChange: (value: string) => void;\n  error?: string;\n  required?: boolean;\n  className?: string;\n}\n\nexport const AccessibleInput: React.FC<AccessibleInputProps> = ({\n  id,\n  label,\n  type = 'text',\n  value,\n  onChange,\n  error,\n  required = false,\n  className = ''\n}) => {\n  return (\n    <div className=\"mb-4\">\n      <label\n        htmlFor={id}\n        className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\"\n      >\n        {label} {required && <span className=\"text-red-500\">*</span>}\n      </label>\n      <input\n        id={id}\n        type={type}\n        value={value}\n        onChange={(e) => onChange(e.target.value)}\n        required={required}\n        aria-invalid={!!error}\n        aria-describedby={error ? `${id}-error` : undefined}\n        className={`\n          w-full px-3 py-2 border rounded-md shadow-sm\n          focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500\n          ${error ? 'border-red-500' : 'border-gray-300 dark:border-gray-600'}\n          ${className}\n        `}\n      />\n      {error && (\n        <p id={`${id}-error`} className=\"mt-1 text-sm text-red-600\">\n          {error}\n        </p>\n      )}\n    </div>\n  );\n};\n\n// Accessible Select Component\ninterface AccessibleSelectProps {\n  id: string;\n  label: string;\n  value: string;\n  onChange: (value: string) => void;\n  options: { value: string; label: string }[];\n  error?: string;\n  required?: boolean;\n}\n\nexport const AccessibleSelect: React.FC<AccessibleSelectProps> = ({\n  id,\n  label,\n  value,\n  onChange,\n  options,\n  error,\n  required = false\n}) => {\n  return (\n    <div className=\"mb-4\">\n      <label\n        htmlFor={id}\n        className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\"\n      >\n        {label} {required && <span className=\"text-red-500\">*</span>}\n      </label>\n      <select\n        id={id}\n        value={value}\n        onChange={(e) => onChange(e.target.value)}\n        required={required}\n        aria-invalid={!!error}\n        aria-describedby={error ? `${id}-error` : undefined}\n        className={`\n          w-full px-3 py-2 border rounded-md shadow-sm\n          focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500\n          ${error ? 'border-red-500' : 'border-gray-300 dark:border-gray-600'}\n        `}\n      >\n        {options.map(option => (\n          <option key={option.value} value={option.value}>\n            {option.label}\n          </option>\n        ))}\n      </select>\n      {error && (\n        <p id={`${id}-error`} className=\"mt-1 text-sm text-red-600\">\n          {error}\n        </p>\n      )}\n    </div>\n  );\n};\n\n// Accessible Checkbox Component\ninterface AccessibleCheckboxProps {\n  id: string;\n  label: string;\n  checked: boolean;\n  onChange: (checked: boolean) => void;\n  error?: string;\n  required?: boolean;\n}\n\nexport const AccessibleCheckbox: React.FC<AccessibleCheckboxProps> = ({\n  id,\n  label,\n  checked,\n  onChange,\n  error,\n  required = false\n}) => {\n  return (\n    <div className=\"flex items-start mb-4\">\n      <div className=\"flex items-center h-5\">\n        <input\n          id={id}\n          type=\"checkbox\"\n          checked={checked}\n          onChange={(e) => onChange(e.target.checked)}\n          required={required}\n          aria-invalid={!!error}\n          aria-describedby={error ? `${id}-error` : undefined}\n          className=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n        />\n      </div>\n      <div className=\"ml-3 text-sm\">\n        <label\n          htmlFor={id}\n          className=\"font-medium text-gray-700 dark:text-gray-300\"\n        >\n          {label} {required && <span className=\"text-red-500\">*</span>}\n        </label>\n        {error && (\n          <p id={`${id}-error`} className=\"text-red-600\">\n            {error}\n          </p>\n        )}\n      </div>\n    </div>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/account-menu.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":74,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":74,"endColumn":22,"suggestions":[{"fix":{"range":[1857,1906],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * AccountMenu Component - Enhanced Version\n * \n * Premium UX improvements:\n * - Loading skeleton for credits\n * - Low balance warning indicator\n * - Smooth animations\n * - Better hover states\n * - Tooltip for quick actions\n * - Visual hierarchy with colors\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useAuth } from '@/lib/auth';\nimport { Button } from '@/components/ui/button';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { Avatar, AvatarFallback } from '@/components/ui/avatar';\nimport { Badge } from '@/components/ui/badge';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from '@/components/ui/tooltip';\nimport {\n  Settings,\n  CreditCard,\n  Upload,\n  LogOut,\n  ChevronDown,\n  Coins,\n  Zap,\n  AlertTriangle,\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\ninterface CreditsResponse {\n  credits: number;\n  tier: string;\n}\n\nconst LOW_CREDIT_THRESHOLD = 10;\nconst CRITICAL_CREDIT_THRESHOLD = 5;\n\nexport function AccountMenu() {\n  const { user, logout } = useAuth();\n  const navigate = useNavigate();\n  const [credits, setCredits] = useState<number | null>(null);\n  const [isLoadingCredits, setIsLoadingCredits] = useState(true);\n  const [isDropdownOpen, setIsDropdownOpen] = useState(false);\n\n  // Fetch credits balance\n  useEffect(() => {\n    if (!user) return;\n\n    const fetchCredits = async () => {\n      try {\n        const response = await fetch('/api/images_mvp/credits/balance', {\n          credentials: 'include',\n        });\n        if (response.ok) {\n          const data: CreditsResponse = await response.json();\n          setCredits(data.credits);\n        }\n      } catch (error) {\n        console.error('Failed to fetch credits:', error);\n      } finally {\n        setIsLoadingCredits(false);\n      }\n    };\n\n    void fetchCredits();\n  }, [user]);\n\n  if (!user) return null;\n\n  const handleLogout = async () => {\n    await logout();\n    navigate('/images_mvp');\n  };\n\n  // Get user initials for avatar\n  const initials = user.username\n    .split(' ')\n    .map(n => n[0])\n    .join('')\n    .toUpperCase()\n    .slice(0, 2);\n\n  // Format tier display\n  const tierDisplay = user.tier\n    .split('_')\n    .map(word => word.charAt(0).toUpperCase() + word.slice(1))\n    .join(' ');\n\n  // Credit status helpers\n  const isLowCredits = credits !== null && credits <= LOW_CREDIT_THRESHOLD;\n  const isCriticalCredits = credits !== null && credits <= CRITICAL_CREDIT_THRESHOLD;\n\n  const creditsBadgeColor = isCriticalCredits\n    ? 'text-red-400'\n    : isLowCredits\n      ? 'text-amber-400'\n      : 'text-primary';\n\n  const creditsIcon = isCriticalCredits ? (\n    <AlertTriangle className=\"w-4 h-4 text-red-400 animate-pulse\" />\n  ) : isLowCredits ? (\n    <AlertTriangle className=\"w-4 h-4 text-amber-400\" />\n  ) : (\n    <Coins className=\"w-4 h-4 text-primary\" />\n  );\n\n  return (\n    <div className=\"flex items-center gap-2\">\n      {/* Credits Pill - Enhanced with Tooltip */}\n      <TooltipProvider delayDuration={300}>\n        <Tooltip>\n          <TooltipTrigger asChild>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => navigate('/credits')}\n              className={cn(\n                'hidden md:flex items-center gap-1.5 px-3 py-1.5 h-auto transition-all duration-200',\n                'border hover:bg-white/10',\n                isCriticalCredits\n                  ? 'border-red-400/30 hover:border-red-400/50 text-red-400'\n                  : isLowCredits\n                    ? 'border-amber-400/30 hover:border-amber-400/50 text-amber-400'\n                    : 'border-white/10 hover:border-primary/30 text-slate-200 hover:text-white'\n              )}\n              title={isLowCredits ? 'Low credits - Click to top up' : 'View credits'}\n            >\n              {creditsIcon}\n              <span className={cn('font-mono text-sm font-semibold', creditsBadgeColor)}>\n                {isLoadingCredits ? (\n                  <span className=\"inline-block w-6 h-4 bg-white/10 rounded animate-pulse\" />\n                ) : (\n                  credits !== null ? credits : '0'\n                )}\n              </span>\n            </Button>\n          </TooltipTrigger>\n          <TooltipContent\n            side=\"bottom\"\n            className=\"bg-[#0a0a0f] border-white/10 text-slate-200\"\n          >\n            <div className=\"text-xs\">\n              {isCriticalCredits ? (\n                <div className=\"flex items-center gap-1 text-red-400\">\n                  <AlertTriangle className=\"w-3 h-3\" />\n                  <span>Critical: Top up now</span>\n                </div>\n              ) : isLowCredits ? (\n                <div className=\"flex items-center gap-1 text-amber-400\">\n                  <AlertTriangle className=\"w-3 h-3\" />\n                  <span>Running low: Add credits</span>\n                </div>\n              ) : (\n                'Click to manage credits'\n              )}\n            </div>\n          </TooltipContent>\n        </Tooltip>\n      </TooltipProvider>\n\n      {/* Account Dropdown */}\n      <DropdownMenu open={isDropdownOpen} onOpenChange={setIsDropdownOpen}>\n        <DropdownMenuTrigger asChild>\n          <Button\n            variant=\"ghost\"\n            className={cn(\n              'flex items-center gap-2 hover:bg-white/10 px-2 py-1.5 h-auto transition-colors',\n              isDropdownOpen && 'bg-white/10'\n            )}\n          >\n            <Avatar className=\"h-8 w-8 ring-2 ring-white/10\">\n              <AvatarFallback className=\"bg-gradient-to-br from-primary/30 to-purple-500/30 text-primary text-sm font-bold\">\n                {initials}\n              </AvatarFallback>\n            </Avatar>\n            <div className=\"hidden md:flex flex-col items-start text-left\">\n              <span className=\"text-sm font-medium text-white leading-none\">\n                {user.username}\n              </span>\n              <span className=\"text-xs text-slate-400 leading-none mt-0.5\">\n                {tierDisplay}\n              </span>\n            </div>\n            <ChevronDown\n              className={cn(\n                'w-4 h-4 text-slate-400 transition-transform duration-200',\n                isDropdownOpen && 'rotate-180'\n              )}\n            />\n          </Button>\n        </DropdownMenuTrigger>\n\n        <DropdownMenuContent\n          align=\"end\"\n          className=\"w-64 bg-[#0a0a0f] border-white/10 shadow-xl\"\n          sideOffset={8}\n        >\n          {/* User Info Header */}\n          <DropdownMenuLabel className=\"pb-3\">\n            <div className=\"flex items-start gap-3\">\n              <Avatar className=\"h-12 w-12 ring-2 ring-white/10\">\n                <AvatarFallback className=\"bg-gradient-to-br from-primary/30 to-purple-500/30 text-primary text-base font-bold\">\n                  {initials}\n                </AvatarFallback>\n              </Avatar>\n              <div className=\"flex-1 min-w-0\">\n                <p className=\"text-sm font-semibold text-white truncate\">\n                  {user.username}\n                </p>\n                <p className=\"text-xs text-slate-400 truncate\">{user.email}</p>\n                <div className=\"flex items-center gap-2 mt-1.5\">\n                  <Badge\n                    variant=\"outline\"\n                    className=\"text-xs border-primary/30 text-primary px-2 py-0\"\n                  >\n                    {tierDisplay}\n                  </Badge>\n                  {user.subscriptionStatus === 'active' && (\n                    <Badge\n                      variant=\"outline\"\n                      className=\"text-xs border-emerald-500/30 text-emerald-400 px-2 py-0\"\n                    >\n                      <Zap className=\"w-2.5 h-2.5 mr-1\" />\n                      Active\n                    </Badge>\n                  )}\n                </div>\n              </div>\n            </div>\n          </DropdownMenuLabel>\n\n          <DropdownMenuSeparator className=\"bg-white/10\" />\n\n          {/* Credits Display (Mobile + Visual Enhancement) */}\n          <div className=\"px-2 py-3 border-b border-white/10 mb-1\">\n            <div className=\"flex items-center justify-between p-2 rounded-md bg-white/5 hover:bg-white/10 transition-colors\">\n              <div className=\"flex items-center gap-2\">\n                {creditsIcon}\n                <span className=\"text-sm text-slate-300 font-medium\">Credits</span>\n                {isLowCredits && (\n                  <Badge\n                    variant=\"outline\"\n                    className={cn(\n                      'text-[10px] px-1.5 py-0',\n                      isCriticalCredits\n                        ? 'border-red-400/30 text-red-400'\n                        : 'border-amber-400/30 text-amber-400'\n                    )}\n                  >\n                    Low\n                  </Badge>\n                )}\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <span className={cn('font-mono font-bold text-base', creditsBadgeColor)}>\n                  {isLoadingCredits ? (\n                    <span className=\"inline-block w-8 h-4 bg-white/10 rounded animate-pulse\" />\n                  ) : (\n                    credits !== null ? credits : '0'\n                  )}\n                </span>\n                <ChevronDown className=\"w-3 h-3 text-slate-500 -rotate-90\" />\n              </div>\n            </div>\n          </div>\n\n          {/* Navigation Items */}\n          <DropdownMenuItem\n            onClick={() => {\n              setIsDropdownOpen(false);\n              navigate('/images_mvp');\n            }}\n            className=\"cursor-pointer text-slate-200 hover:text-white hover:bg-white/5 focus:bg-white/5 my-0.5\"\n          >\n            <Upload className=\"w-4 h-4 mr-3 text-primary\" />\n            <span className=\"font-medium\">Extract Metadata</span>\n          </DropdownMenuItem>\n\n          <DropdownMenuItem\n            onClick={() => {\n              setIsDropdownOpen(false);\n              navigate('/credits');\n            }}\n            className=\"cursor-pointer text-slate-200 hover:text-white hover:bg-white/5 focus:bg-white/5 my-0.5\"\n          >\n            <CreditCard className=\"w-4 h-4 mr-3 text-emerald-400\" />\n            <div className=\"flex items-center justify-between flex-1\">\n              <span className=\"font-medium\">Credits & Billing</span>\n              {isLowCredits && (\n                <span className=\"text-xs text-amber-400\">Top up</span>\n              )}\n            </div>\n          </DropdownMenuItem>\n\n          <DropdownMenuItem\n            onClick={() => {\n              setIsDropdownOpen(false);\n              navigate('/settings');\n            }}\n            className=\"cursor-pointer text-slate-200 hover:text-white hover:bg-white/5 focus:bg-white/5 my-0.5\"\n          >\n            <Settings className=\"w-4 h-4 mr-3 text-slate-400\" />\n            <span className=\"font-medium\">Settings</span>\n          </DropdownMenuItem>\n\n          <DropdownMenuSeparator className=\"bg-white/10 my-2\" />\n\n          <DropdownMenuItem\n            onClick={handleLogout}\n            className=\"cursor-pointer text-slate-200 hover:text-red-400 hover:bg-red-400/10 focus:bg-red-400/10 my-0.5\"\n          >\n            <LogOut className=\"w-4 h-4 mr-3\" />\n            <span className=\"font-medium\">Sign Out</span>\n          </DropdownMenuItem>\n        </DropdownMenuContent>\n      </DropdownMenu>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/advanced-analysis-results.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/advanced-results-integration.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[824,827],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[824,827],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[882,885],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[882,885],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[908,911],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[908,911],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[932,935],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[932,935],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[956,959],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[956,959],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":122,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3487,3490],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3487,3490],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Badge } from '@/components/ui/badge';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport {\n  Shield,\n  Zap,\n  Eye,\n  Clock,\n  GitCompare,\n  FileText,\n  Upload,\n  CheckCircle,\n  TrendingUp,\n} from 'lucide-react';\n\nimport { AdvancedAnalysisResults } from './advanced-analysis-results';\nimport { ComparisonView } from './comparison-view';\nimport { TimelineVisualization } from './timeline-visualization';\nimport { ForensicReport } from './forensic-report';\n\ninterface AdvancedResultsIntegrationProps {\n  // Standard metadata result\n  metadata?: any;\n\n  // Advanced analysis results\n  advancedAnalysis?: any;\n  comparisonResult?: any;\n  timelineResult?: any;\n  forensicReport?: any;\n\n  // UI state\n  tier: string;\n  onUpgrade?: () => void;\n  onRunAdvancedAnalysis?: () => void;\n  onRunComparison?: (files: FileList) => void;\n  onRunTimeline?: (files: FileList) => void;\n  onGenerateReport?: (files: FileList) => void;\n}\n\nexport function AdvancedResultsIntegration({\n  metadata,\n  advancedAnalysis,\n  comparisonResult,\n  timelineResult,\n  forensicReport,\n  tier,\n  onUpgrade,\n  onRunAdvancedAnalysis,\n  onRunComparison,\n  onRunTimeline,\n  onGenerateReport,\n}: AdvancedResultsIntegrationProps) {\n  const [activeTab, setActiveTab] = useState('standard');\n  const [isProcessing, setIsProcessing] = useState(false);\n\n  // DEV MODE: Always enable all features in development\n  const isDev = import.meta.env.DEV;\n  const canUseAdvanced = isDev || tier !== 'free';\n  const canUseReports = isDev || tier === 'enterprise';\n\n  const handleFileUpload = (action: 'comparison' | 'timeline' | 'report') => {\n    const input = document.createElement('input');\n    input.type = 'file';\n    input.multiple = true;\n    input.accept = 'image/*,video/*,audio/*,.pdf';\n\n    input.onchange = (e) => {\n      const files = (e.target as HTMLInputElement).files;\n      if (files && files.length > 0) {\n        setIsProcessing(true);\n\n        switch (action) {\n          case 'comparison':\n            onRunComparison?.(files);\n            break;\n          case 'timeline':\n            onRunTimeline?.(files);\n            break;\n          case 'report':\n            onGenerateReport?.(files);\n            break;\n        }\n\n        // Simulate processing time\n        setTimeout(() => setIsProcessing(false), 3000);\n      }\n    };\n\n    input.click();\n  };\n\n  const getTabCount = () => {\n    let count = 1; // Standard tab always available\n    if (advancedAnalysis) count++;\n    if (comparisonResult) count++;\n    if (timelineResult) count++;\n    if (forensicReport) count++;\n    return count;\n  };\n\n  // Defensive derived values (API responses can be partial / evolving)\n  const forensicScore =\n    advancedAnalysis?.forensic_score ??\n    advancedAnalysis?.advanced_analysis?.forensic_score ??\n    null;\n\n  const comparisonTotalFiles =\n    comparisonResult?.total_files ??\n    (Array.isArray(comparisonResult?.files)\n      ? comparisonResult.files.length\n      : null);\n\n  const timelineEventsCount =\n    timelineResult?.timeline?.events?.length ??\n    (Array.isArray(timelineResult?.events) ? timelineResult.events.length : 0);\n\n  const reportAssessmentRaw =\n    forensicReport?.conclusions?.overall_assessment ??\n    (forensicReport as any)?.overall_assessment ??\n    null;\n\n  const reportAssessment =\n    reportAssessmentRaw == null ? null : String(reportAssessmentRaw);\n\n  const hasTimeline = timelineEventsCount > 0;\n\n  return (\n    <div className='space-y-6'>\n      {/* Advanced Features Header */}\n      <Card className='border-purple-200 bg-purple-50'>\n        <CardHeader>\n          <CardTitle className='flex items-center gap-2 text-purple-900'>\n            <Shield className='h-6 w-6' />\n            Advanced Forensic Analysis Suite\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className='grid grid-cols-1 md:grid-cols-4 gap-4'>\n            {/* Advanced Analysis */}\n            <div className='text-center'>\n              <div className='flex items-center justify-center mb-2'>\n                <Eye className='h-8 w-8 text-blue-600' />\n              </div>\n              <h4 className='font-medium mb-1'>Advanced Analysis</h4>\n              <p className='text-xs text-gray-600 mb-2'>\n                Steganography, manipulation & AI detection\n              </p>\n              {canUseAdvanced ? (\n                <Button\n                  size='sm'\n                  onClick={onRunAdvancedAnalysis}\n                  disabled={isProcessing || !metadata}\n                  className='w-full'\n                >\n                  {advancedAnalysis ? 'Re-analyze' : 'Analyze'}\n                </Button>\n              ) : (\n                <Button\n                  size='sm'\n                  variant='outline'\n                  onClick={onUpgrade}\n                  className='w-full'\n                >\n                  Upgrade\n                </Button>\n              )}\n            </div>\n\n            {/* Batch Comparison */}\n            <div className='text-center'>\n              <div className='flex items-center justify-center mb-2'>\n                <GitCompare className='h-8 w-8 text-green-600' />\n              </div>\n              <h4 className='font-medium mb-1'>Batch Comparison</h4>\n              <p className='text-xs text-gray-600 mb-2'>\n                Compare metadata across multiple files\n              </p>\n              {canUseAdvanced ? (\n                <Button\n                  size='sm'\n                  onClick={() => handleFileUpload('comparison')}\n                  disabled={isProcessing}\n                  className='w-full'\n                >\n                  <Upload className='h-4 w-4 mr-1' />\n                  Compare\n                </Button>\n              ) : (\n                <Button\n                  size='sm'\n                  variant='outline'\n                  onClick={onUpgrade}\n                  className='w-full'\n                >\n                  Upgrade\n                </Button>\n              )}\n            </div>\n\n            {/* Timeline Reconstruction */}\n            <div className='text-center'>\n              <div className='flex items-center justify-center mb-2'>\n                <Clock className='h-8 w-8 text-orange-600' />\n              </div>\n              <h4 className='font-medium mb-1'>Timeline Analysis</h4>\n              <p className='text-xs text-gray-600 mb-2'>\n                Reconstruct chronological timeline\n              </p>\n              {canUseAdvanced ? (\n                <Button\n                  size='sm'\n                  onClick={() => handleFileUpload('timeline')}\n                  disabled={isProcessing}\n                  className='w-full'\n                >\n                  <Upload className='h-4 w-4 mr-1' />\n                  Timeline\n                </Button>\n              ) : (\n                <Button\n                  size='sm'\n                  variant='outline'\n                  onClick={onUpgrade}\n                  className='w-full'\n                >\n                  Upgrade\n                </Button>\n              )}\n            </div>\n\n            {/* Forensic Report */}\n            <div className='text-center'>\n              <div className='flex items-center justify-center mb-2'>\n                <FileText className='h-8 w-8 text-red-600' />\n              </div>\n              <h4 className='font-medium mb-1'>Forensic Report</h4>\n              <p className='text-xs text-gray-600 mb-2'>\n                Professional court-ready reports\n              </p>\n              {canUseReports ? (\n                <Button\n                  size='sm'\n                  onClick={() => handleFileUpload('report')}\n                  disabled={isProcessing}\n                  className='w-full'\n                >\n                  <Upload className='h-4 w-4 mr-1' />\n                  Generate\n                </Button>\n              ) : (\n                <Button\n                  size='sm'\n                  variant='outline'\n                  onClick={onUpgrade}\n                  className='w-full'\n                >\n                  Enterprise\n                </Button>\n              )}\n            </div>\n          </div>\n\n          {/* Processing Indicator */}\n          {isProcessing && (\n            <Alert className='mt-4 border-blue-200 bg-blue-50'>\n              <Zap className='h-4 w-4 text-blue-600 animate-pulse' />\n              <AlertDescription className='text-blue-800'>\n                Processing advanced analysis... This may take up to 5 minutes\n                for comprehensive forensic analysis.\n              </AlertDescription>\n            </Alert>\n          )}\n\n          {/* Tier Information */}\n          <div className='mt-4 flex items-center justify-between'>\n            <div className='flex items-center gap-2'>\n              <Badge variant='outline' className='capitalize'>\n                {tier} Tier\n              </Badge>\n              <span className='text-sm text-gray-600'>\n                {getTabCount()} analysis type{getTabCount() !== 1 ? 's' : ''}{' '}\n                available\n              </span>\n            </div>\n            {!canUseAdvanced && (\n              <Button size='sm' onClick={onUpgrade}>\n                <TrendingUp className='h-4 w-4 mr-2' />\n                Upgrade for Advanced Features\n              </Button>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Results Tabs */}\n      <Tabs value={activeTab} onValueChange={setActiveTab} className='w-full'>\n        <TabsList className='grid w-full grid-cols-5'>\n          <TabsTrigger value='standard'>Standard Analysis</TabsTrigger>\n          <TabsTrigger value='advanced' disabled={!advancedAnalysis}>\n            Advanced Analysis\n            {forensicScore != null && (\n              <Badge className='ml-2 h-4 text-xs'>{forensicScore}</Badge>\n            )}\n          </TabsTrigger>\n          <TabsTrigger value='comparison' disabled={!comparisonResult}>\n            Comparison\n            {comparisonTotalFiles != null && (\n              <Badge className='ml-2 h-4 text-xs'>{comparisonTotalFiles}</Badge>\n            )}\n          </TabsTrigger>\n          <TabsTrigger value='timeline' disabled={!hasTimeline}>\n            Timeline\n            {hasTimeline && (\n              <Badge className='ml-2 h-4 text-xs'>{timelineEventsCount}</Badge>\n            )}\n          </TabsTrigger>\n          <TabsTrigger value='report' disabled={!forensicReport}>\n            Report\n            {reportAssessment && (\n              <Badge className='ml-2 h-4 text-xs'>\n                {reportAssessment.length > 16\n                  ? `${reportAssessment.slice(0, 16)}`\n                  : reportAssessment}\n              </Badge>\n            )}\n          </TabsTrigger>\n        </TabsList>\n\n        {/* Standard Analysis Tab */}\n        <TabsContent value='standard' className='space-y-4'>\n          {metadata ? (\n            <Card>\n              <CardHeader>\n                <CardTitle className='flex items-center gap-2'>\n                  <FileText className='h-5 w-5' />\n                  Standard Metadata Analysis\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className='grid grid-cols-2 md:grid-cols-4 gap-4 mb-4'>\n                  <div className='text-center'>\n                    <div className='text-2xl font-bold text-blue-600'>\n                      {metadata.fields_extracted || 0}\n                    </div>\n                    <div className='text-sm text-gray-600'>\n                      Fields Extracted\n                    </div>\n                  </div>\n                  <div className='text-center'>\n                    <div className='text-2xl font-bold text-green-600'>\n                      {metadata.filetype || 'Unknown'}\n                    </div>\n                    <div className='text-sm text-gray-600'>File Type</div>\n                  </div>\n                  <div className='text-center'>\n                    <div className='text-2xl font-bold text-purple-600'>\n                      {metadata.filesize || 'Unknown'}\n                    </div>\n                    <div className='text-sm text-gray-600'>File Size</div>\n                  </div>\n                  <div className='text-center'>\n                    <div className='text-2xl font-bold text-orange-600'>\n                      {metadata.processing_ms\n                        ? `${(metadata.processing_ms / 1000).toFixed(1)}s`\n                        : 'N/A'}\n                    </div>\n                    <div className='text-sm text-gray-600'>Processing Time</div>\n                  </div>\n                </div>\n\n                {/* Quick Actions */}\n                <div className='flex gap-2'>\n                  {canUseAdvanced && !advancedAnalysis && (\n                    <Button onClick={onRunAdvancedAnalysis} size='sm'>\n                      <Eye className='h-4 w-4 mr-2' />\n                      Run Advanced Analysis\n                    </Button>\n                  )}\n                  {!canUseAdvanced && (\n                    <Button onClick={onUpgrade} variant='outline' size='sm'>\n                      <TrendingUp className='h-4 w-4 mr-2' />\n                      Upgrade for Advanced Features\n                    </Button>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          ) : (\n            <Card>\n              <CardContent className='pt-6 text-center'>\n                <Upload className='h-12 w-12 text-gray-400 mx-auto mb-4' />\n                <p className='text-gray-600'>Upload a file to begin analysis</p>\n              </CardContent>\n            </Card>\n          )}\n        </TabsContent>\n\n        {/* Advanced Analysis Tab */}\n        <TabsContent value='advanced'>\n          {advancedAnalysis ? (\n            <AdvancedAnalysisResults\n              advancedAnalysis={advancedAnalysis}\n              steganographyAnalysis={metadata.steganography_analysis}\n              manipulationDetection={metadata.manipulation_detection}\n              aiDetection={metadata.ai_detection}\n            />\n          ) : (\n            <Card>\n              <CardContent className='pt-6 text-center'>\n                <Eye className='h-12 w-12 text-gray-400 mx-auto mb-4' />\n                <p className='text-gray-600 mb-4'>\n                  No advanced analysis results available\n                </p>\n                {canUseAdvanced && metadata && (\n                  <Button onClick={onRunAdvancedAnalysis}>\n                    Run Advanced Analysis\n                  </Button>\n                )}\n              </CardContent>\n            </Card>\n          )}\n        </TabsContent>\n\n        {/* Comparison Tab */}\n        <TabsContent value='comparison'>\n          {comparisonResult ? (\n            <ComparisonView comparisonResult={comparisonResult} />\n          ) : (\n            <Card>\n              <CardContent className='pt-6 text-center'>\n                <GitCompare className='h-12 w-12 text-gray-400 mx-auto mb-4' />\n                <p className='text-gray-600 mb-4'>\n                  No comparison results available\n                </p>\n                {canUseAdvanced && (\n                  <Button onClick={() => handleFileUpload('comparison')}>\n                    <Upload className='h-4 w-4 mr-2' />\n                    Upload Files to Compare\n                  </Button>\n                )}\n              </CardContent>\n            </Card>\n          )}\n        </TabsContent>\n\n        {/* Timeline Tab */}\n        <TabsContent value='timeline'>\n          {hasTimeline ? (\n            <TimelineVisualization timelineResult={timelineResult} />\n          ) : (\n            <Card>\n              <CardContent className='pt-6 text-center'>\n                <Clock className='h-12 w-12 text-gray-400 mx-auto mb-4' />\n                <p className='text-gray-600 mb-4'>\n                  No timeline analysis available\n                </p>\n                {canUseAdvanced && (\n                  <Button onClick={() => handleFileUpload('timeline')}>\n                    <Upload className='h-4 w-4 mr-2' />\n                    Upload Files for Timeline\n                  </Button>\n                )}\n              </CardContent>\n            </Card>\n          )}\n        </TabsContent>\n\n        {/* Report Tab */}\n        <TabsContent value='report'>\n          {forensicReport ? (\n            <ForensicReport reportData={forensicReport} />\n          ) : (\n            <Card>\n              <CardContent className='pt-6 text-center'>\n                <FileText className='h-12 w-12 text-gray-400 mx-auto mb-4' />\n                <p className='text-gray-600 mb-4'>\n                  No forensic report available\n                </p>\n                {canUseReports ? (\n                  <Button onClick={() => handleFileUpload('report')}>\n                    <Upload className='h-4 w-4 mr-2' />\n                    Upload Files for Report\n                  </Button>\n                ) : (\n                  <div>\n                    <p className='text-sm text-gray-500 mb-2'>\n                      Forensic reports require Enterprise tier\n                    </p>\n                    <Button onClick={onUpgrade} variant='outline'>\n                      Upgrade to Enterprise\n                    </Button>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          )}\n        </TabsContent>\n      </Tabs>\n\n      {/* Success Indicators */}\n      {(advancedAnalysis ||\n        comparisonResult ||\n        timelineResult ||\n        forensicReport) && (\n          <Alert className='border-green-200 bg-green-50'>\n            <CheckCircle className='h-4 w-4 text-green-600' />\n            <AlertDescription className='text-green-800'>\n              <strong>Advanced Analysis Complete:</strong>\n              {advancedAnalysis && ' Forensic analysis'}\n              {comparisonResult && '  Batch comparison'}\n              {timelineResult && '  Timeline reconstruction'}\n              {forensicReport && '  Professional report'}\n              {' completed successfully.'}\n            </AlertDescription>\n          </Alert>\n        )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/animated-theme-provider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/auth-modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/batch/BatchExportDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[664,667],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[664,667],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":102,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":102,"endColumn":20,"suggestions":[{"fix":{"range":[3326,3364],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { useToast } from '@/hooks/use-toast';\nimport { FileJson, FileSpreadsheet, Download, Loader2 } from 'lucide-react';\n\ninterface BatchResult {\n  id: string;\n  filename: string;\n  status: 'success' | 'error' | 'processing' | 'pending';\n  extractionDate: string;\n  fieldsExtracted: number;\n  fileSize: number;\n  fileType: string;\n  authenticityScore?: number;\n  metadata: Record<string, any>;\n  processingTime?: number;\n  errorMessage?: string;\n  batchId?: string;\n}\n\ninterface BatchExportDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  results: BatchResult[];\n  selectedFiles: string[];\n}\n\nexport const BatchExportDialog: React.FC<BatchExportDialogProps> = ({\n  open,\n  onOpenChange,\n  results,\n  selectedFiles,\n}) => {\n  const { toast } = useToast();\n  const [exportFormat, setExportFormat] = useState<'json' | 'csv'>('json');\n  const [isExporting, setIsExporting] = useState(false);\n  const [exportScope, setExportScope] = useState<'all' | 'selected'>('all');\n\n  const handleExport = async () => {\n    setIsExporting(true);\n    \n    try {\n      const dataToExport = exportScope === 'selected' && selectedFiles.length > 0\n        ? results.filter(result => selectedFiles.includes(result.id))\n        : results;\n\n      if (exportFormat === 'json') {\n        // Export as JSON\n        const jsonString = JSON.stringify(dataToExport, null, 2);\n        const blob = new Blob([jsonString], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n        const link = document.createElement('a');\n        link.href = url;\n        link.download = `batch-results-${new Date().toISOString().split('T')[0]}.json`;\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n        URL.revokeObjectURL(url);\n      } else {\n        // Export as CSV\n        const headers = ['Filename', 'Status', 'Fields Extracted', 'File Size (KB)', 'File Type', 'Extraction Date', 'Processing Time (ms)'];\n        const csvContent = [\n          headers.join(','),\n          ...dataToExport.map(result => [\n            `\"${result.filename}\"`,\n            result.status,\n            result.fieldsExtracted,\n            Math.round(result.fileSize / 1024),\n            `\"${result.fileType}\"`,\n            `\"${new Date(result.extractionDate).toISOString()}\"`,\n            result.processingTime || ''\n          ].join(','))\n        ].join('\\n');\n\n        const blob = new Blob([csvContent], { type: 'text/csv' });\n        const url = URL.createObjectURL(blob);\n        const link = document.createElement('a');\n        link.href = url;\n        link.download = `batch-results-${new Date().toISOString().split('T')[0]}.csv`;\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n        URL.revokeObjectURL(url);\n      }\n\n      toast({\n        title: 'Export Complete',\n        description: `${dataToExport.length} results exported as ${exportFormat.toUpperCase()}`,\n      });\n      \n      onOpenChange(false);\n    } catch (error) {\n      console.error('Export error:', error);\n      toast({\n        title: 'Export Failed',\n        description: 'An error occurred while exporting the results.',\n        variant: 'destructive',\n      });\n    } finally {\n      setIsExporting(false);\n    }\n  };\n\n  const exportableCount = exportScope === 'selected' && selectedFiles.length > 0 \n    ? selectedFiles.length \n    : results.length;\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-md\">\n        <DialogHeader>\n          <DialogTitle>Export Batch Results</DialogTitle>\n          <DialogDescription>\n            Choose the format and scope for exporting your batch processing results.\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-4 py-4\">\n          {/* Export Scope */}\n          <div className=\"space-y-2\">\n            <label className=\"text-sm font-medium\">Export Scope</label>\n            <div className=\"flex gap-2\">\n              <Button\n                variant={exportScope === 'all' ? 'default' : 'outline'}\n                onClick={() => setExportScope('all')}\n                className=\"flex-1\"\n              >\n                All Results ({results.length})\n              </Button>\n              <Button\n                variant={exportScope === 'selected' ? 'default' : 'outline'}\n                onClick={() => setExportScope('selected')}\n                className=\"flex-1\"\n                disabled={selectedFiles.length === 0}\n              >\n                Selected ({selectedFiles.length})\n              </Button>\n            </div>\n          </div>\n\n          {/* Export Format */}\n          <div className=\"space-y-2\">\n            <label className=\"text-sm font-medium\">Export Format</label>\n            <div className=\"flex gap-2\">\n              <Button\n                variant={exportFormat === 'json' ? 'default' : 'outline'}\n                onClick={() => setExportFormat('json')}\n                className=\"flex-1 gap-2\"\n              >\n                <FileJson className=\"w-4 h-4\" />\n                JSON\n              </Button>\n              <Button\n                variant={exportFormat === 'csv' ? 'default' : 'outline'}\n                onClick={() => setExportFormat('csv')}\n                className=\"flex-1 gap-2\"\n              >\n                <FileSpreadsheet className=\"w-4 h-4\" />\n                CSV\n              </Button>\n            </div>\n          </div>\n\n          {/* Export Preview */}\n          <div className=\"rounded-lg border bg-muted/20 p-3 text-sm\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-slate-300\">Files to export:</span>\n              <Badge variant=\"secondary\">{exportableCount}</Badge>\n            </div>\n            <div className=\"mt-2 text-slate-400\">\n              Format: <span className=\"text-white\">{exportFormat.toUpperCase()}</span>\n            </div>\n          </div>\n        </div>\n\n        <DialogFooter>\n          <Button\n            variant=\"outline\"\n            onClick={() => onOpenChange(false)}\n            disabled={isExporting}\n          >\n            Cancel\n          </Button>\n          <Button\n            onClick={handleExport}\n            disabled={isExporting || exportableCount === 0}\n            className=\"gap-2\"\n          >\n            {isExporting ? (\n              <Loader2 className=\"w-4 h-4 animate-spin\" />\n            ) : (\n              <Download className=\"w-4 h-4\" />\n            )}\n            {isExporting ? 'Exporting...' : 'Export'}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/batch/BatchFilters.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[884,887],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[884,887],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { \n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover';\nimport { \n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select';\nimport { Calendar } from '@/components/ui/calendar';\nimport { Calendar as CalendarIcon, FileText, Image as ImageIcon, FileSpreadsheet, Database } from 'lucide-react';\nimport { format } from 'date-fns';\nimport { cn } from '@/lib/utils';\nimport type { DateRange } from 'react-day-picker';\n\ninterface BatchResult {\n  id: string;\n  filename: string;\n  status: 'success' | 'error' | 'processing' | 'pending';\n  extractionDate: string;\n  fieldsExtracted: number;\n  fileSize: number;\n  fileType: string;\n  authenticityScore?: number;\n  metadata: Record<string, any>;\n}\n\ninterface BatchFiltersState {\n  status?: string;\n  fileType?: string;\n  dateRange?: { start: Date; end: Date };\n  minFields?: number;\n  maxFields?: number;\n}\n\ninterface BatchFiltersProps {\n  filters: BatchFiltersState;\n  onFiltersChange: (filters: BatchFiltersState) => void;\n  results: BatchResult[];\n}\n\nexport const BatchFilters: React.FC<BatchFiltersProps> = ({ filters, onFiltersChange, results }) => {\n  const [dateRange, setDateRange] = React.useState<DateRange | undefined>();\n\n  // Get unique file types from results\n  const fileTypes = React.useMemo(() => {\n    const types = new Set<string>();\n    results.forEach(result => {\n      const mainType = result.fileType.split('/')[0];\n      types.add(mainType);\n    });\n    return Array.from(types).sort();\n  }, [results]);\n\n  const handleStatusChange = (status: string) => {\n    onFiltersChange({ ...filters, status: status === 'all' ? undefined : status });\n  };\n\n  const handleFileTypeChange = (fileType: string) => {\n    onFiltersChange({ ...filters, fileType: fileType === 'all' ? undefined : fileType });\n  };\n\n  const handleDateRangeSelect = (range: DateRange | undefined) => {\n    setDateRange(range);\n    if (range?.from && range?.to) {\n      onFiltersChange({\n        ...filters,\n        dateRange: { start: range.from, end: range.to },\n      });\n    } else {\n      onFiltersChange({ ...filters, dateRange: undefined });\n    }\n  };\n\n  const handleMinFieldsChange = (value: string) => {\n    const minFields = value === 'all' ? undefined : parseInt(value);\n    onFiltersChange({ ...filters, minFields });\n  };\n\n  const handleMaxFieldsChange = (value: string) => {\n    const maxFields = value === 'all' ? undefined : parseInt(value);\n    onFiltersChange({ ...filters, maxFields });\n  };\n\n  const getFileTypeIcon = (type: string) => {\n    switch (type) {\n      case 'image': return <ImageIcon className=\"w-4 h-4\" aria-hidden=\"true\" />;\n      case 'application': return <FileSpreadsheet className=\"w-4 h-4\" />;\n      case 'text': return <FileText className=\"w-4 h-4\" />;\n      case 'video': return <Database className=\"w-4 h-4\" />;\n      default: return <FileText className=\"w-4 h-4\" />;\n    }\n  };\n\n  const getFileTypeLabel = (type: string) => {\n    switch (type) {\n      case 'image': return 'Images';\n      case 'application': return 'Documents';\n      case 'text': return 'Text Files';\n      case 'video': return 'Videos';\n      default: return type.charAt(0).toUpperCase() + type.slice(1);\n    }\n  };\n\n  return (\n    <div className=\"flex flex-wrap gap-2\">\n      {/* Status Filter */}\n      <Select value={filters.status || 'all'} onValueChange={handleStatusChange}>\n        <SelectTrigger className=\"w-32\">\n          <SelectValue placeholder=\"Status\" />\n        </SelectTrigger>\n        <SelectContent>\n          <SelectItem value=\"all\">All Status</SelectItem>\n          <SelectItem value=\"success\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"w-2 h-2 rounded-full bg-emerald-500\"></div>\n              Success\n            </div>\n          </SelectItem>\n          <SelectItem value=\"error\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"w-2 h-2 rounded-full bg-red-500\"></div>\n              Error\n            </div>\n          </SelectItem>\n          <SelectItem value=\"processing\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"w-2 h-2 rounded-full bg-yellow-500\"></div>\n              Processing\n            </div>\n          </SelectItem>\n          <SelectItem value=\"pending\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"w-2 h-2 rounded-full bg-blue-500\"></div>\n              Pending\n            </div>\n          </SelectItem>\n        </SelectContent>\n      </Select>\n\n      {/* File Type Filter */}\n      <Select value={filters.fileType || 'all'} onValueChange={handleFileTypeChange}>\n        <SelectTrigger className=\"w-40\">\n          <SelectValue placeholder=\"File Type\" />\n        </SelectTrigger>\n        <SelectContent>\n          <SelectItem value=\"all\">All Types</SelectItem>\n          {fileTypes.map(type => (\n            <SelectItem key={type} value={type}>\n              <div className=\"flex items-center gap-2\">\n                {getFileTypeIcon(type)}\n                {getFileTypeLabel(type)}\n              </div>\n            </SelectItem>\n          ))}\n        </SelectContent>\n      </Select>\n\n      {/* Fields Range Filter */}\n      <div className=\"flex items-center gap-2\">\n        <Select \n          value={filters.minFields?.toString() || 'all'} \n          onValueChange={handleMinFieldsChange}\n        >\n          <SelectTrigger className=\"w-28\">\n            <SelectValue placeholder=\"Min Fields\" />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"all\">Min: Any</SelectItem>\n            <SelectItem value=\"0\">0+</SelectItem>\n            <SelectItem value=\"50\">50+</SelectItem>\n            <SelectItem value=\"100\">100+</SelectItem>\n            <SelectItem value=\"200\">200+</SelectItem>\n          </SelectContent>\n        </Select>\n        \n        <span className=\"text-slate-400\">to</span>\n        \n        <Select \n          value={filters.maxFields?.toString() || 'all'} \n          onValueChange={handleMaxFieldsChange}\n        >\n          <SelectTrigger className=\"w-28\">\n            <SelectValue placeholder=\"Max Fields\" />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"all\">Max: Any</SelectItem>\n            <SelectItem value=\"50\">50</SelectItem>\n            <SelectItem value=\"100\">100</SelectItem>\n            <SelectItem value=\"200\">200</SelectItem>\n            <SelectItem value=\"500\">500+</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n\n      {/* Date Range Filter */}\n      <Popover>\n        <PopoverTrigger asChild>\n          <Button variant=\"outline\" className={cn(\n            \"w-48 justify-start text-left font-normal\",\n            !dateRange?.from && \"text-muted-foreground\"\n          )}>\n            <CalendarIcon className=\"mr-2 h-4 w-4\" />\n            {dateRange?.from ? (\n              dateRange?.to ? (\n                <>\n                  {format(dateRange.from, \"LLL dd, y\")} -{\" \"}\n                  {format(dateRange.to, \"LLL dd, y\")}\n                </>\n              ) : (\n                format(dateRange.from, \"LLL dd, y\")\n              )\n            ) : (\n              <span>Pick a date range</span>\n            )}\n          </Button>\n        </PopoverTrigger>\n        <PopoverContent className=\"w-auto p-0\" align=\"start\">\n          <Calendar\n            initialFocus\n            mode=\"range\"\n            defaultMonth={dateRange?.from}\n            selected={dateRange}\n            onSelect={handleDateRangeSelect}\n            numberOfMonths={2}\n          />\n        </PopoverContent>\n      </Popover>\n\n      {/* Active Filters Display */}\n      {(filters.status || filters.fileType || filters.dateRange || filters.minFields !== undefined || filters.maxFields !== undefined) && (\n        <div className=\"flex items-center gap-2\">\n          <span className=\"text-sm text-slate-400\">Active:</span>\n          {filters.status && (\n            <Badge variant=\"secondary\" className=\"gap-1\">\n              Status: {filters.status}\n              <button\n                onClick={() => handleStatusChange('all')}\n                className=\"ml-1 hover:text-destructive\"\n              >\n                \n              </button>\n            </Badge>\n          )}\n          {filters.fileType && (\n            <Badge variant=\"secondary\" className=\"gap-1\">\n              {getFileTypeLabel(filters.fileType)}\n              <button\n                onClick={() => handleFileTypeChange('all')}\n                className=\"ml-1 hover:text-destructive\"\n              >\n                \n              </button>\n            </Badge>\n          )}\n          {(filters.minFields !== undefined || filters.maxFields !== undefined) && (\n            <Badge variant=\"secondary\" className=\"gap-1\">\n              Fields: {filters.minFields || 0}-{filters.maxFields || ''}\n              <button\n                onClick={() => {\n                  onFiltersChange({\n                    ...filters,\n                    minFields: undefined,\n                    maxFields: undefined,\n                  });\n                }}\n                className=\"ml-1 hover:text-destructive\"\n              >\n                \n              </button>\n            </Badge>\n          )}\n          {filters.dateRange && (\n            <Badge variant=\"secondary\" className=\"gap-1\">\n              {format(filters.dateRange.start, \"MMM dd\")} - {format(filters.dateRange.end, \"MMM dd\")}\n              <button\n                onClick={() => {\n                  setDateRange(undefined);\n                  onFiltersChange({ ...filters, dateRange: undefined });\n                }}\n                className=\"ml-1 hover:text-destructive\"\n              >\n                \n              </button>\n            </Badge>\n          )}\n        </div>\n      )}\n    </div>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/batch/BatchGrid.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[902,905],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[902,905],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"jsx-a11y/click-events-have-key-events","severity":1,"message":"Visible, non-interactive elements with click handlers must have at least one keyboard listener.","line":292,"column":9,"nodeType":"JSXOpeningElement","endLine":292,"endColumn":132},{"ruleId":"jsx-a11y/no-static-element-interactions","severity":1,"message":"Avoid non-native interactive elements. If using native HTML is not possible, add an appropriate role and support for tabbing, mouse, keyboard, and touch inputs to an interactive content element.","line":292,"column":9,"nodeType":"JSXOpeningElement","endLine":292,"endColumn":132},{"ruleId":"jsx-a11y/click-events-have-key-events","severity":1,"message":"Visible, non-interactive elements with click handlers must have at least one keyboard listener.","line":296,"column":9,"nodeType":"JSXOpeningElement","endLine":296,"endColumn":130},{"ruleId":"jsx-a11y/no-static-element-interactions","severity":1,"message":"Avoid non-native interactive elements. If using native HTML is not possible, add an appropriate role and support for tabbing, mouse, keyboard, and touch inputs to an interactive content element.","line":296,"column":9,"nodeType":"JSXOpeningElement","endLine":296,"endColumn":130},{"ruleId":"jsx-a11y/click-events-have-key-events","severity":1,"message":"Visible, non-interactive elements with click handlers must have at least one keyboard listener.","line":300,"column":9,"nodeType":"JSXOpeningElement","endLine":300,"endColumn":130},{"ruleId":"jsx-a11y/no-static-element-interactions","severity":1,"message":"Avoid non-native interactive elements. If using native HTML is not possible, add an appropriate role and support for tabbing, mouse, keyboard, and touch inputs to an interactive content element.","line":300,"column":9,"nodeType":"JSXOpeningElement","endLine":300,"endColumn":130},{"ruleId":"jsx-a11y/click-events-have-key-events","severity":1,"message":"Visible, non-interactive elements with click handlers must have at least one keyboard listener.","line":304,"column":9,"nodeType":"JSXOpeningElement","endLine":304,"endColumn":128},{"ruleId":"jsx-a11y/no-static-element-interactions","severity":1,"message":"Avoid non-native interactive elements. If using native HTML is not possible, add an appropriate role and support for tabbing, mouse, keyboard, and touch inputs to an interactive content element.","line":304,"column":9,"nodeType":"JSXOpeningElement","endLine":304,"endColumn":128},{"ruleId":"jsx-a11y/click-events-have-key-events","severity":1,"message":"Visible, non-interactive elements with click handlers must have at least one keyboard listener.","line":308,"column":9,"nodeType":"JSXOpeningElement","endLine":308,"endColumn":128},{"ruleId":"jsx-a11y/no-static-element-interactions","severity":1,"message":"Avoid non-native interactive elements. If using native HTML is not possible, add an appropriate role and support for tabbing, mouse, keyboard, and touch inputs to an interactive content element.","line":308,"column":9,"nodeType":"JSXOpeningElement","endLine":308,"endColumn":128}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { \n  FileText, \n  CheckCircle, \n  XCircle, \n  FileImage,\n  File,\n  Database,\n  Eye,\n  Hash,\n  ArrowUpDown,\n  ArrowUp,\n  ArrowDown,\n  Download,\n  MoreVertical,\n  Clock,\n  RefreshCw\n} from 'lucide-react';\nimport { formatFileSize } from '@/lib/utils';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\n\ninterface BatchResult {\n  id: string;\n  filename: string;\n  status: 'success' | 'error' | 'processing' | 'pending';\n  extractionDate: string;\n  fieldsExtracted: number;\n  fileSize: number;\n  fileType: string;\n  authenticityScore?: number;\n  metadata: Record<string, any>;\n  processingTime?: number;\n  errorMessage?: string;\n  batchId?: string;\n}\n\ninterface BatchGridProps {\n  results: BatchResult[];\n  selectedFiles: string[];\n  onSelectFile: (id: string) => void;\n  onSelectAll: () => void;\n  allSelected: boolean;\n  viewMode: 'grid' | 'list';\n  sortBy?: 'filename' | 'date' | 'fields' | 'size' | 'status';\n  sortOrder?: 'asc' | 'desc';\n  onSortChange?: (field: 'filename' | 'date' | 'fields' | 'size' | 'status', order: 'asc' | 'desc') => void;\n  onFileAction?: (action: 'download' | 'view' | 'reprocess', fileId: string) => void;\n}\n\nexport const BatchGrid: React.FC<BatchGridProps> = ({\n  results,\n  selectedFiles,\n  onSelectFile,\n  onSelectAll,\n  allSelected,\n  viewMode,\n  sortBy = 'date',\n  sortOrder = 'desc',\n  onSortChange,\n  onFileAction\n}) => {\n  const [expandedCards, setExpandedCards] = useState<Set<string>>(new Set());\n\n  const getStatusIcon = (status: BatchResult['status']) => {\n    switch (status) {\n      case 'success': return <CheckCircle className=\"w-4 h-4 text-emerald-500\" />;\n      case 'error': return <XCircle className=\"w-4 h-4 text-red-500\" />;\n      case 'processing': return <RefreshCw className=\"w-4 h-4 text-yellow-500 animate-spin\" />;\n      case 'pending': return <Clock className=\"w-4 h-4 text-blue-500\" />;\n      default: return null;\n    }\n  };\n\n  const getStatusBadge = (status: BatchResult['status']) => {\n    switch (status) {\n      case 'success': \n        return <Badge variant=\"secondary\" className=\"bg-emerald-500/20 text-emerald-400 border-emerald-500/30\">Success</Badge>;\n      case 'error': \n        return <Badge variant=\"secondary\" className=\"bg-red-500/20 text-red-400 border-red-500/30\">Error</Badge>;\n      case 'processing': \n        return <Badge variant=\"secondary\" className=\"bg-yellow-500/20 text-yellow-400 border-yellow-500/30 animate-pulse\">Processing</Badge>;\n      case 'pending': \n        return <Badge variant=\"secondary\" className=\"bg-blue-500/20 text-blue-400 border-blue-500/30\">Pending</Badge>;\n      default: \n        return <Badge variant=\"outline\">Unknown</Badge>;\n    }\n  };\n\n  const getFileTypeIcon = (fileType: string) => {\n    if (fileType.includes('image')) return <FileImage className=\"w-4 h-4 text-blue-500\" />;\n    if (fileType.includes('pdf')) return <FileText className=\"w-4 h-4 text-red-500\" />;\n    if (fileType.includes('dicom')) return <Database className=\"w-4 h-4 text-purple-500\" />;\n    return <File className=\"w-4 h-4 text-slate-500\" />;\n  };\n\n  const toggleExpanded = (id: string) => {\n    setExpandedCards((prev: Set<string>) => {\n      const newSet = new Set(prev);\n      if (newSet.has(id)) {\n        newSet.delete(id);\n      } else {\n        newSet.add(id);\n      }\n      return newSet;\n    });\n  };\n\n  const getSortIcon = (field: string) => {\n    if (sortBy !== field) return <ArrowUpDown className=\"w-4 h-4\" />;\n    return sortOrder === 'asc' ? <ArrowUp className=\"w-4 h-4\" /> : <ArrowDown className=\"w-4 h-4\" />;\n  };\n\n  const handleSort = (field: 'filename' | 'date' | 'fields' | 'size' | 'status') => {\n    if (!onSortChange) return;\n    \n    if (sortBy === field) {\n      onSortChange(field, sortOrder === 'asc' ? 'desc' : 'asc');\n    } else {\n      onSortChange(field, 'asc');\n    }\n  };\n\n  const renderGridView = () => (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4\">\n      {results.map((result) => {\n        const isExpanded = expandedCards.has(result.id);\n        \n        return (\n          <Card \n            key={result.id} \n            className={`bg-card border-white/10 hover:bg-muted/20 transition-all duration-200 ${\n              selectedFiles.includes(result.id) ? 'ring-2 ring-primary/50 shadow-lg' : ''\n            } ${result.status === 'processing' ? 'animate-pulse' : ''}`}\n          >\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-start gap-3\">\n                <Checkbox\n                  checked={selectedFiles.includes(result.id)}\n                  onCheckedChange={() => onSelectFile(result.id)}\n                  className=\"mt-1 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\"\n                />\n                \n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"flex items-start justify-between gap-2 mb-3\">\n                    <div className=\"flex items-center gap-2 flex-1 min-w-0\">\n                      {getFileTypeIcon(result.fileType)}\n                      <h3 className=\"font-medium text-white truncate\" title={result.filename}>\n                        {result.filename}\n                      </h3>\n                    </div>\n                    <div className=\"flex items-center gap-1\">\n                      {getStatusIcon(result.status)}\n                      <DropdownMenu>\n                        <DropdownMenuTrigger asChild>\n                          <Button variant=\"ghost\" size=\"sm\" className=\"h-6 w-6 p-0\">\n                            <MoreVertical className=\"w-3 h-3\" />\n                          </Button>\n                        </DropdownMenuTrigger>\n                        <DropdownMenuContent align=\"end\">\n                          <DropdownMenuItem onClick={() => onFileAction?.('view', result.id)}>\n                            <Eye className=\"w-4 h-4 mr-2\" />\n                            View Details\n                          </DropdownMenuItem>\n                          {result.status === 'success' && (\n                            <DropdownMenuItem onClick={() => onFileAction?.('download', result.id)}>\n                              <Download className=\"w-4 h-4 mr-2\" />\n                              Download Metadata\n                            </DropdownMenuItem>\n                          )}\n                          {result.status === 'error' && (\n                            <DropdownMenuItem onClick={() => onFileAction?.('reprocess', result.id)}>\n                              <RefreshCw className=\"w-4 h-4 mr-2\" />\n                              Reprocess File\n                            </DropdownMenuItem>\n                          )}\n                        </DropdownMenuContent>\n                      </DropdownMenu>\n                    </div>\n                  </div>\n                  \n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center gap-2 text-xs text-slate-300\">\n                      <span>{result.fileType.split('/')[1]?.toUpperCase() || result.fileType}</span>\n                      <span></span>\n                      <span>{formatFileSize(result.fileSize)}</span>\n                    </div>\n                    \n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-2\">\n                        <Hash className=\"w-3 h-3 text-slate-400\" />\n                        <span className=\"text-xs text-slate-300\">Fields:</span>\n                        <span className=\"text-sm font-medium text-white\">{result.fieldsExtracted}</span>\n                      </div>\n                      {result.processingTime && (\n                        <div className=\"flex items-center gap-1 text-xs text-slate-400\">\n                          <Clock className=\"w-3 h-3\" />\n                          {Math.round(result.processingTime / 1000)}s\n                        </div>\n                      )}\n                    </div>\n                    \n                    {result.authenticityScore !== undefined && (\n                      <div className=\"flex items-center gap-2\">\n                        <Eye className=\"w-3 h-3 text-primary\" />\n                        <span className=\"text-xs text-slate-300\">Authenticity:</span>\n                        <Badge \n                          variant=\"secondary\" \n                          className={`text-xs ${\n                            result.authenticityScore >= 80 \n                              ? 'bg-emerald-500/20 text-emerald-400' \n                              : result.authenticityScore >= 50 \n                              ? 'bg-yellow-500/20 text-yellow-400'\n                              : 'bg-red-500/20 text-red-400'\n                          }`}\n                        >\n                          {result.authenticityScore}%\n                        </Badge>\n                      </div>\n                    )}\n                    \n                    {result.errorMessage && (\n                      <div className=\"p-2 bg-red-500/10 border border-red-500/20 rounded text-xs text-red-400\">\n                        {result.errorMessage}\n                      </div>\n                    )}\n                    \n                    <div className=\"text-xs text-slate-400\">\n                      {new Date(result.extractionDate).toLocaleString()}\n                    </div>\n                  </div>\n                  \n                  {isExpanded && (\n                    <div className=\"mt-3 pt-3 border-t border-white/10 space-y-2\">\n                      <div className=\"text-xs\">\n                        <span className=\"text-slate-400\">File ID:</span>\n                        <span className=\"text-white font-mono ml-2\">{result.id.slice(0, 8)}...</span>\n                      </div>\n                      {Object.entries(result.metadata).slice(0, 3).map(([key, value]) => (\n                        <div key={key} className=\"text-xs\">\n                          <span className=\"text-slate-400 capitalize\">{key.replace(/_/g, ' ')}:</span>\n                          <span className=\"text-white ml-2 truncate\">{String(value)}</span>\n                        </div>\n                      ))}\n                      {Object.keys(result.metadata).length > 3 && (\n                        <div className=\"text-xs text-slate-400\">\n                          +{Object.keys(result.metadata).length - 3} more fields\n                        </div>\n                      )}\n                    </div>\n                  )}\n                </div>\n              </div>\n              \n              <div className=\"mt-3 pt-3 border-t border-white/10 flex items-center justify-between\">\n                {getStatusBadge(result.status)}\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => toggleExpanded(result.id)}\n                  className=\"h-6 text-xs text-slate-400 hover:text-white\"\n                >\n                  {isExpanded ? 'Show Less' : 'Show More'}\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        );\n      })}\n    </div>\n  );\n\n  const renderListView = () => (\n    <div className=\"space-y-2\">\n      {/* List Header */}\n      <div className=\"grid grid-cols-12 gap-4 p-3 bg-muted/30 rounded-lg text-sm font-medium text-slate-300\">\n        <div className=\"col-span-1\">\n          <Checkbox\n            checked={allSelected}\n            onCheckedChange={onSelectAll}\n            className=\"data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\"\n          />\n        </div>\n        <div className=\"col-span-4 flex items-center gap-2 cursor-pointer hover:text-white\" onClick={() => handleSort('filename')}>\n          File\n          {getSortIcon('filename')}\n        </div>\n        <div className=\"col-span-1 flex items-center gap-2 cursor-pointer hover:text-white\" onClick={() => handleSort('status')}>\n          Status\n          {getSortIcon('status')}\n        </div>\n        <div className=\"col-span-1 flex items-center gap-2 cursor-pointer hover:text-white\" onClick={() => handleSort('fields')}>\n          Fields\n          {getSortIcon('fields')}\n        </div>\n        <div className=\"col-span-1 flex items-center gap-2 cursor-pointer hover:text-white\" onClick={() => handleSort('size')}>\n          Size\n          {getSortIcon('size')}\n        </div>\n        <div className=\"col-span-2 flex items-center gap-2 cursor-pointer hover:text-white\" onClick={() => handleSort('date')}>\n          Date\n          {getSortIcon('date')}\n        </div>\n        <div className=\"col-span-2\">Authenticity</div>\n        <div className=\"col-span-1\">Actions</div>\n      </div>\n\n      {/* List Items */}\n      {results.map((result) => (\n        <div\n          key={result.id}\n          className={`grid grid-cols-12 gap-4 p-3 bg-card border border-white/10 rounded-lg hover:bg-muted/20 transition-colors ${\n            selectedFiles.includes(result.id) ? 'ring-2 ring-primary/50' : ''\n          } ${result.status === 'processing' ? 'animate-pulse' : ''}`}\n        >\n          <div className=\"col-span-1 flex items-center\">\n            <Checkbox\n              checked={selectedFiles.includes(result.id)}\n              onCheckedChange={() => onSelectFile(result.id)}\n              className=\"data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\"\n            />\n          </div>\n          \n          <div className=\"col-span-4 flex items-center gap-3 min-w-0\">\n            {getFileTypeIcon(result.fileType)}\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"text-white font-medium truncate\" title={result.filename}>\n                {result.filename}\n              </p>\n              <p className=\"text-xs text-slate-400\">\n                {result.fileType}  {new Date(result.extractionDate).toLocaleDateString()}\n              </p>\n            </div>\n          </div>\n          \n          <div className=\"col-span-1 flex items-center\">\n            {getStatusIcon(result.status)}\n          </div>\n          \n          <div className=\"col-span-1 flex items-center\">\n            <div className=\"flex items-center gap-1\">\n              <Hash className=\"w-3 h-3 text-slate-400\" />\n              <span className=\"text-white\">{result.fieldsExtracted}</span>\n            </div>\n          </div>\n          \n          <div className=\"col-span-1 flex items-center text-slate-300\">\n            {formatFileSize(result.fileSize)}\n          </div>\n          \n          <div className=\"col-span-2 flex items-center text-slate-300 text-sm\">\n            <Clock className=\"w-3 h-3 mr-1\" />\n            {new Date(result.extractionDate).toLocaleString()}\n          </div>\n          \n          <div className=\"col-span-2 flex items-center\">\n            {result.authenticityScore !== undefined ? (\n              <Badge \n                variant=\"secondary\" \n                className={`text-xs ${\n                  result.authenticityScore >= 80 \n                    ? 'bg-emerald-500/20 text-emerald-400' \n                    : result.authenticityScore >= 50 \n                    ? 'bg-yellow-500/20 text-yellow-400'\n                    : 'bg-red-500/20 text-red-400'\n                }`}\n              >\n                {result.authenticityScore}%\n              </Badge>\n            ) : (\n              <span className=\"text-slate-400 text-sm\">N/A</span>\n            )}\n          </div>\n          \n          <div className=\"col-span-1 flex items-center\">\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button variant=\"ghost\" size=\"sm\" className=\"h-6 w-6 p-0\">\n                  <MoreVertical className=\"w-3 h-3\" />\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\">\n                <DropdownMenuItem onClick={() => onFileAction?.('view', result.id)}>\n                  <Eye className=\"w-4 h-4 mr-2\" />\n                  View Details\n                </DropdownMenuItem>\n                {result.status === 'success' && (\n                  <DropdownMenuItem onClick={() => onFileAction?.('download', result.id)}>\n                    <Download className=\"w-4 h-4 mr-2\" />\n                    Download Metadata\n                  </DropdownMenuItem>\n                )}\n                {result.status === 'error' && (\n                  <DropdownMenuItem onClick={() => onFileAction?.('reprocess', result.id)}>\n                    <RefreshCw className=\"w-4 h-4 mr-2\" />\n                    Reprocess File\n                  </DropdownMenuItem>\n                )}\n              </DropdownMenuContent>\n            </DropdownMenu>\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Controls */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-3 p-3 bg-muted/30 rounded-lg flex-1\">\n          <Checkbox\n            checked={allSelected}\n            onCheckedChange={onSelectAll}\n            className=\"data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\"\n          />\n          <span className=\"text-sm font-medium text-white\">Select All</span>\n          <span className=\"text-sm text-slate-300\">\n            ({selectedFiles.length} of {results.length} selected)\n          </span>\n          {results.length > 0 && (\n            <Badge variant=\"secondary\" className=\"ml-auto\">\n              {viewMode === 'grid' ? 'Grid View' : 'List View'}\n            </Badge>\n          )}\n        </div>\n      </div>\n\n      {/* Results */}\n      {viewMode === 'grid' ? renderGridView() : renderListView()}\n      \n      {results.length === 0 && (\n        <div className=\"text-center py-12 text-slate-500\">\n          <FileText className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\n          <p className=\"text-white mb-2\">No batch results to display</p>\n          <p className=\"text-sm text-slate-300\">\n            {viewMode === 'grid' \n              ? 'Upload multiple files to see batch processing results in grid view'\n              : 'Upload multiple files to see batch processing results in list view'\n            }\n          </p>\n        </div>\n      )}\n    </div>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/batch/BatchStats.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[847,850],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[847,850],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport {\n  BarChart3,\n  FileText,\n  FileImage,\n  Hash,\n  Eye,\n  Clock,\n} from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\nimport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n} from '@/components/ui/chart';\nimport {\n  BarChart,\n  Bar,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  PieChart,\n  Pie,\n  Cell,\n} from 'recharts';\nimport { cn } from '@/lib/utils';\n\ninterface BatchResult {\n  id: string;\n  filename: string;\n  status: 'success' | 'error' | 'processing' | 'pending';\n  extractionDate: string;\n  fieldsExtracted: number;\n  fileSize: number;\n  fileType: string;\n  authenticityScore?: number;\n  metadata: Record<string, any>;\n}\n\ninterface BatchJob {\n  id: string;\n  name: string;\n  createdAt: string;\n  status: 'pending' | 'processing' | 'completed' | 'failed';\n  totalFiles: number;\n  processedFiles: number;\n  results: BatchResult[];\n}\n\ninterface BatchStatsProps {\n  results: BatchResult[];\n  batchJob?: BatchJob;\n}\n\nexport const BatchStats: React.FC<BatchStatsProps> = ({ results, batchJob }) => {\n  // Calculate statistics\n  const totalFiles = results.length;\n  const successfulFiles = results.filter(r => r.status === 'success').length;\n  const errorFiles = results.filter(r => r.status === 'error').length;\n  const processingFiles = results.filter(r => r.status === 'processing').length;\n  \n  const totalFields = results.reduce((sum, r) => sum + r.fieldsExtracted, 0);\n  const avgFields = totalFiles > 0 ? Math.round(totalFields / totalFiles) : 0;\n  \n  const totalSize = results.reduce((sum, r) => sum + r.fileSize, 0);\n  const avgSize = totalFiles > 0 ? totalSize / totalFiles : 0;\n  \n  // File type distribution\n  const fileTypeCounts: Record<string, number> = {};\n  results.forEach(r => {\n    const type = r.fileType.split('/')[0] || r.fileType;\n    fileTypeCounts[type] = (fileTypeCounts[type] || 0) + 1;\n  });\n  \n  const fileTypeData = Object.entries(fileTypeCounts).map(([type, count]) => ({\n    name: type,\n    count,\n    fill: getFileTypeColor(type)\n  }));\n  \n  // Status distribution\n  const statusData = [\n    { name: 'Success', value: successfulFiles, fill: '#10b981' },\n    { name: 'Error', value: errorFiles, fill: '#ef4444' },\n    { name: 'Processing', value: processingFiles, fill: '#f59e0b' }\n  ];\n  \n  // File size distribution\n  const sizeRanges = [\n    { name: '< 1MB', count: results.filter(r => r.fileSize < 1024 * 1024).length },\n    { name: '1-10MB', count: results.filter(r => r.fileSize >= 1024 * 1024 && r.fileSize < 10 * 1024 * 1024).length },\n    { name: '10-100MB', count: results.filter(r => r.fileSize >= 10 * 1024 * 1024 && r.fileSize < 100 * 1024 * 1024).length },\n    { name: '> 100MB', count: results.filter(r => r.fileSize >= 100 * 1024 * 1024).length }\n  ];\n  \n  // Fields extracted distribution\n  const fieldsRanges = [\n    { name: '0-50', count: results.filter(r => r.fieldsExtracted >= 0 && r.fieldsExtracted <= 50).length },\n    { name: '51-100', count: results.filter(r => r.fieldsExtracted > 50 && r.fieldsExtracted <= 100).length },\n    { name: '101-200', count: results.filter(r => r.fieldsExtracted > 100 && r.fieldsExtracted <= 200).length },\n    { name: '200+', count: results.filter(r => r.fieldsExtracted > 200).length }\n  ];\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Batch Job Information */}\n      {batchJob && (\n        <Card className=\"bg-card border-white/10\">\n          <CardHeader>\n            <CardTitle className=\"text-white flex items-center gap-2\">\n              <Clock className=\"w-5 h-5 text-primary\" />\n              Batch Job Information\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n              <div className=\"space-y-1\">\n                <p className=\"text-xs text-slate-300\">Job ID</p>\n                <p className=\"text-sm font-mono text-white\">{batchJob.id.slice(0, 8)}...</p>\n              </div>\n              <div className=\"space-y-1\">\n                <p className=\"text-xs text-slate-300\">Created</p>\n                <p className=\"text-sm text-white\">\n                  {new Date(batchJob.createdAt).toLocaleDateString()}\n                </p>\n              </div>\n              <div className=\"space-y-1\">\n                <p className=\"text-xs text-slate-300\">Status</p>\n                <Badge \n                  variant=\"secondary\" \n                  className={cn(\n                    \"capitalize\",\n                    batchJob.status === 'completed' && \"bg-emerald-500/20 text-emerald-400\",\n                    batchJob.status === 'failed' && \"bg-red-500/20 text-red-400\",\n                    batchJob.status === 'processing' && \"bg-yellow-500/20 text-yellow-400 animate-pulse\",\n                    batchJob.status === 'pending' && \"bg-blue-500/20 text-blue-400\"\n                  )}\n                >\n                  {batchJob.status}\n                </Badge>\n              </div>\n              <div className=\"space-y-1\">\n                <p className=\"text-xs text-slate-300\">Progress</p>\n                <div className=\"flex items-center gap-2\">\n                  <Progress \n                    value={(batchJob.processedFiles / batchJob.totalFiles) * 100} \n                    className=\"h-2 flex-1\"\n                  />\n                  <span className=\"text-sm text-white\">\n                    {batchJob.processedFiles}/{batchJob.totalFiles}\n                  </span>\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Summary Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card className=\"bg-card border-white/10\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-primary/10 rounded-lg\">\n                <FileText className=\"w-6 h-6 text-primary\" />\n              </div>\n              <div>\n                <p className=\"text-xs text-slate-300\">Total Files</p>\n                <p className=\"text-xl font-bold text-white\">{totalFiles}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"bg-card border-white/10\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-emerald-500/10 rounded-lg\">\n                <BarChart3 className=\"w-6 h-6 text-emerald-500\" />\n              </div>\n              <div>\n                <p className=\"text-xs text-slate-300\">Avg Fields</p>\n                <p className=\"text-xl font-bold text-white\">{avgFields}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"bg-card border-white/10\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-blue-500/10 rounded-lg\">\n                <Hash className=\"w-6 h-6 text-blue-500\" />\n              </div>\n              <div>\n                <p className=\"text-xs text-slate-300\">Avg Size</p>\n                <p className=\"text-xl font-bold text-white\">{formatFileSize(avgSize)}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"bg-card border-white/10\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-purple-500/10 rounded-lg\">\n                <Eye className=\"w-6 h-6 text-purple-500\" />\n              </div>\n              <div>\n                <p className=\"text-xs text-slate-300\">Success Rate</p>\n                <p className=\"text-xl font-bold text-white\">\n                  {totalFiles > 0 ? Math.round((successfulFiles / totalFiles) * 100) : 0}%\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Charts Row 1 */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Status Distribution */}\n        <Card className=\"bg-card border-white/10\">\n          <CardHeader>\n            <CardTitle className=\"text-white flex items-center gap-2\">\n              <BarChart3 className=\"w-5 h-5 text-primary\" />\n              Status Distribution\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <ChartContainer config={{}} className=\"h-64\">\n              <PieChart>\n                <ChartTooltip content={<ChartTooltipContent hideLabel />} />\n                <Pie\n                  data={statusData}\n                  cx=\"50%\"\n                  cy=\"50%\"\n                  labelLine={false}\n                  outerRadius={80}\n                  fill=\"#8884d8\"\n                  dataKey=\"value\"\n                  nameKey=\"name\"\n                >\n                  {statusData.map((entry, index) => (\n                    <Cell key={`cell-${index}`} fill={entry.fill} />\n                  ))}\n                </Pie>\n                <ChartLegend content={<ChartLegendContent />} />\n              </PieChart>\n            </ChartContainer>\n          </CardContent>\n        </Card>\n\n        {/* File Type Distribution */}\n        <Card className=\"bg-card border-white/10\">\n          <CardHeader>\n            <CardTitle className=\"text-white flex items-center gap-2\">\n              <FileImage className=\"w-5 h-5 text-primary\" />\n              File Type Distribution\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <ChartContainer config={{}} className=\"h-64\">\n              <PieChart>\n                <ChartTooltip content={<ChartTooltipContent hideLabel />} />\n                <Pie\n                  data={fileTypeData}\n                  cx=\"50%\"\n                  cy=\"50%\"\n                  labelLine={false}\n                  outerRadius={80}\n                  fill=\"#8884d8\"\n                  dataKey=\"count\"\n                  nameKey=\"name\"\n                >\n                  {fileTypeData.map((entry, index) => (\n                    <Cell key={`cell-${index}`} fill={entry.fill} />\n                  ))}\n                </Pie>\n                <ChartLegend content={<ChartLegendContent />} />\n              </PieChart>\n            </ChartContainer>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Charts Row 2 */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* File Size Distribution */}\n        <Card className=\"bg-card border-white/10\">\n          <CardHeader>\n            <CardTitle className=\"text-white flex items-center gap-2\">\n              <BarChart3 className=\"w-5 h-5 text-primary\" />\n              File Size Distribution\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <ChartContainer config={{}} className=\"h-64\">\n              <BarChart data={sizeRanges}>\n                <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#374151\" />\n                <XAxis dataKey=\"name\" stroke=\"#9CA3AF\" />\n                <YAxis stroke=\"#9CA3AF\" />\n                <ChartTooltip content={<ChartTooltipContent />} />\n                <Bar dataKey=\"count\" fill=\"#3b82f6\" />\n              </BarChart>\n            </ChartContainer>\n          </CardContent>\n        </Card>\n\n        {/* Fields Extracted Distribution */}\n        <Card className=\"bg-card border-white/10\">\n          <CardHeader>\n            <CardTitle className=\"text-white flex items-center gap-2\">\n              <BarChart3 className=\"w-5 h-5 text-primary\" />\n              Fields Extracted Distribution\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <ChartContainer config={{}} className=\"h-64\">\n              <BarChart data={fieldsRanges}>\n                <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#374151\" />\n                <XAxis dataKey=\"name\" stroke=\"#9CA3AF\" />\n                <YAxis stroke=\"#9CA3AF\" />\n                <ChartTooltip content={<ChartTooltipContent />} />\n                <Bar dataKey=\"count\" fill=\"#8b5cf6\" />\n              </BarChart>\n            </ChartContainer>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Detailed Stats */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card className=\"bg-card border-white/10\">\n          <CardContent className=\"p-4\">\n            <p className=\"text-sm text-slate-300 mb-2\">Total Files Processed</p>\n            <p className=\"text-2xl font-bold text-white\">{totalFiles}</p>\n            <div className=\"mt-2 space-y-1\">\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-emerald-400\">Success</span>\n                <span className=\"text-white\">{successfulFiles} ({totalFiles > 0 ? Math.round((successfulFiles / totalFiles) * 100) : 0}%)</span>\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-red-400\">Errors</span>\n                <span className=\"text-white\">{errorFiles} ({totalFiles > 0 ? Math.round((errorFiles / totalFiles) * 100) : 0}%)</span>\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-yellow-400\">Processing</span>\n                <span className=\"text-white\">{processingFiles} ({totalFiles > 0 ? Math.round((processingFiles / totalFiles) * 100) : 0}%)</span>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"bg-card border-white/10\">\n          <CardContent className=\"p-4\">\n            <p className=\"text-sm text-slate-300 mb-2\">Total Data Processed</p>\n            <p className=\"text-2xl font-bold text-white\">{formatFileSize(totalSize)}</p>\n            <div className=\"mt-2 space-y-1\">\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-slate-300\">Avg Size</span>\n                <span className=\"text-white\">{formatFileSize(avgSize)}</span>\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-slate-300\">Total Fields</span>\n                <span className=\"text-white\">{totalFields}</span>\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-slate-300\">Avg Fields</span>\n                <span className=\"text-white\">{avgFields}</span>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"bg-card border-white/10\">\n          <CardContent className=\"p-4\">\n            <p className=\"text-sm text-slate-300 mb-2\">Authenticity Analysis</p>\n            <p className=\"text-2xl font-bold text-white\">\n              {results.filter(r => r.authenticityScore !== undefined).length} files\n            </p>\n            <div className=\"mt-2 space-y-1\">\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-slate-300\">Avg Score</span>\n                <span className=\"text-white\">\n                  {results.filter(r => r.authenticityScore !== undefined).length > 0\n                    ? Math.round(results.reduce((sum, r) => r.authenticityScore ? sum + r.authenticityScore : sum, 0) / \n                      results.filter(r => r.authenticityScore !== undefined).length)\n                    : 0}%\n                </span>\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-slate-300\">High Confidence</span>\n                <span className=\"text-white\">\n                  {results.filter(r => r.authenticityScore && r.authenticityScore >= 80).length}\n                </span>\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-slate-300\">Low Confidence</span>\n                <span className=\"text-white\">\n                  {results.filter(r => r.authenticityScore && r.authenticityScore < 50).length}\n                </span>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n};\n\n// Helper function to format file size\nfunction formatFileSize(bytes: number): string {\n  if (bytes === 0) return '0 Bytes';\n  const k = 1024;\n  const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n}\n\n// Helper function to get color for file types\nfunction getFileTypeColor(type: string): string {\n  switch (type) {\n    case 'image': return '#3b82f6'; // blue\n    case 'application': return '#ef4444'; // red\n    case 'text': return '#10b981'; // green\n    case 'video': return '#8b5cf6'; // purple\n    case 'audio': return '#f59e0b'; // yellow\n    default: return '#6b7280'; // gray\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/batch/BatchTimeline.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[816,819],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[816,819],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { \n  Timeline,\n  TimelineItem,\n  TimelineConnector,\n  TimelineHeader,\n  TimelineTitle,\n  TimelineTime,\n  TimelineIcon,\n  TimelineContent,\n} from '@/components/ui/timeline';\nimport { \n  Clock, \n  CheckCircle, \n  XCircle, \n  AlertCircle, \n  FileText,\n  TrendingUp,\n  Calendar\n} from 'lucide-react';\nimport { format, differenceInSeconds } from 'date-fns';\nimport { cn } from '@/lib/utils';\n\ninterface BatchResult {\n  id: string;\n  filename: string;\n  status: 'success' | 'error' | 'processing' | 'pending';\n  extractionDate: string;\n  fieldsExtracted: number;\n  fileSize: number;\n  fileType: string;\n  authenticityScore?: number;\n  metadata: Record<string, any>;\n  processingTime?: number;\n  errorMessage?: string;\n}\n\ninterface BatchJob {\n  id: string;\n  name: string;\n  createdAt: string;\n  status: 'pending' | 'processing' | 'completed' | 'failed';\n  totalFiles: number;\n  processedFiles: number;\n  results: BatchResult[];\n}\n\ninterface BatchTimelineProps {\n  results: BatchResult[];\n  batchJob: BatchJob;\n}\n\nexport const BatchTimeline: React.FC<BatchTimelineProps> = ({ results, batchJob }) => {\n  const getStatusIcon = (status: BatchResult['status']) => {\n    switch (status) {\n      case 'success': \n        return <CheckCircle className=\"w-4 h-4 text-emerald-500\" />;\n      case 'error': \n        return <XCircle className=\"w-4 h-4 text-red-500\" />;\n      case 'processing': \n        return <Clock className=\"w-4 h-4 text-yellow-500 animate-spin\" />;\n      case 'pending': \n        return <AlertCircle className=\"w-4 h-4 text-blue-500\" />;\n      default: \n        return <FileText className=\"w-4 h-4 text-slate-500\" />;\n    }\n  };\n\n  const getStatusColor = (status: BatchResult['status']) => {\n    switch (status) {\n      case 'success': return 'emerald';\n      case 'error': return 'red';\n      case 'processing': return 'yellow';\n      case 'pending': return 'blue';\n      default: return 'slate';\n    }\n  };\n\n  const formatProcessingTime = (ms: number) => {\n    if (ms < 1000) return `${ms}ms`;\n    if (ms < 60000) return `${(ms / 1000).toFixed(1)}s`;\n    return `${(ms / 60000).toFixed(1)}m`;\n  };\n\n  const getTimelineStats = () => {\n    if (results.length === 0) return null;\n\n    const sortedResults = [...results].sort((a, b) => \n      new Date(a.extractionDate).getTime() - new Date(b.extractionDate).getTime()\n    );\n\n    const startTime = new Date(sortedResults[0].extractionDate);\n    const endTime = new Date(sortedResults[sortedResults.length - 1].extractionDate);\n    const totalDuration = differenceInSeconds(endTime, startTime);\n    \n    const processingTimes = results.flatMap(result =>\n      typeof result.processingTime === 'number' ? [result.processingTime] : []\n    );\n    const avgProcessingTime = processingTimes.length > 0 \n      ? processingTimes.reduce((sum, time) => sum + time, 0) / processingTimes.length \n      : 0;\n    const fastestProcessing =\n      processingTimes.length > 0 ? Math.min(...processingTimes) : 0;\n    const slowestProcessing =\n      processingTimes.length > 0 ? Math.max(...processingTimes) : 0;\n\n    const successRate = (results.filter(r => r.status === 'success').length / results.length) * 100;\n\n    return {\n      startTime,\n      endTime,\n      totalDuration,\n      avgProcessingTime,\n      fastestProcessing,\n      slowestProcessing,\n      successRate,\n      totalFiles: results.length,\n      successfulFiles: results.filter(r => r.status === 'success').length,\n      errorFiles: results.filter(r => r.status === 'error').length,\n    };\n  };\n\n  const stats = getTimelineStats();\n\n  if (!stats) {\n    return (\n      <Card className=\"bg-card border-white/10\">\n        <CardContent className=\"py-12 text-center\">\n          <Calendar className=\"w-12 h-12 mx-auto mb-4 text-slate-500\" />\n          <p className=\"text-white\">No timeline data available</p>\n          <p className=\"text-sm text-slate-300 mt-1\">\n            Process some files to see the timeline\n          </p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Timeline Overview */}\n      <Card className=\"bg-card border-white/10\">\n        <CardHeader>\n          <CardTitle className=\"text-white flex items-center gap-2\">\n            <Calendar className=\"w-5 h-5 text-primary\" />\n            Processing Timeline\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6\">\n            <div className=\"p-4 bg-muted/20 rounded-lg\">\n              <p className=\"text-sm text-slate-300 mb-1\">Start Time</p>\n              <p className=\"text-lg font-bold text-white\">\n                {format(stats.startTime, 'HH:mm:ss')}\n              </p>\n              <p className=\"text-xs text-slate-400\">\n                {format(stats.startTime, 'MMM dd, yyyy')}\n              </p>\n            </div>\n            \n            <div className=\"p-4 bg-muted/20 rounded-lg\">\n              <p className=\"text-sm text-slate-300 mb-1\">End Time</p>\n              <p className=\"text-lg font-bold text-white\">\n                {format(stats.endTime, 'HH:mm:ss')}\n              </p>\n              <p className=\"text-xs text-slate-400\">\n                {format(stats.endTime, 'MMM dd, yyyy')}\n              </p>\n            </div>\n            \n            <div className=\"p-4 bg-muted/20 rounded-lg\">\n              <p className=\"text-sm text-slate-300 mb-1\">Total Duration</p>\n              <p className=\"text-lg font-bold text-white\">\n                {stats.totalDuration < 60 \n                  ? `${stats.totalDuration}s`\n                  : `${Math.round(stats.totalDuration / 60)}m ${stats.totalDuration % 60}s`\n                }\n              </p>\n              <p className=\"text-xs text-slate-400\">\n                for {stats.totalFiles} files\n              </p>\n            </div>\n            \n            <div className=\"p-4 bg-muted/20 rounded-lg\">\n              <p className=\"text-sm text-slate-300 mb-1\">Success Rate</p>\n              <p className=\"text-lg font-bold text-white\">\n                {Math.round(stats.successRate)}%\n              </p>\n              <p className=\"text-xs text-slate-400\">\n                {stats.successfulFiles}/{stats.totalFiles} files\n              </p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Detailed Timeline */}\n      <Card className=\"bg-card border-white/10\">\n        <CardHeader>\n          <CardTitle className=\"text-white flex items-center gap-2\">\n            <TrendingUp className=\"w-5 h-5 text-primary\" />\n            File Processing Timeline\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <Timeline>\n            {results\n              .sort((a, b) => new Date(b.extractionDate).getTime() - new Date(a.extractionDate).getTime())\n              .map((result, index) => {\n                const processingTime = result.processingTime || 0;\n                const isLast = index === results.length - 1;\n                \n                return (\n                  <TimelineItem key={result.id}>\n                    {!isLast && <TimelineConnector />}\n                    \n                    <TimelineHeader>\n                      <TimelineIcon color={getStatusColor(result.status)}>\n                        {getStatusIcon(result.status)}\n                      </TimelineIcon>\n                      <div className=\"flex-1\">\n                        <TimelineTitle className=\"text-white\">\n                          {result.filename}\n                        </TimelineTitle>\n                        <TimelineTime className=\"text-slate-400\">\n                          {format(new Date(result.extractionDate), 'MMM dd, yyyy HH:mm:ss')}\n                        </TimelineTime>\n                      </div>\n                      <Badge \n                        variant=\"secondary\" \n                        className={cn(\n                          \"capitalize\",\n                          result.status === 'success' && \"bg-emerald-500/20 text-emerald-400\",\n                          result.status === 'error' && \"bg-red-500/20 text-red-400\",\n                          result.status === 'processing' && \"bg-yellow-500/20 text-yellow-400 animate-pulse\",\n                          result.status === 'pending' && \"bg-blue-500/20 text-blue-400\"\n                        )}\n                      >\n                        {result.status}\n                      </Badge>\n                    </TimelineHeader>\n                    \n                    <TimelineContent className=\"space-y-2\">\n                      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm\">\n                        <div>\n                          <span className=\"text-slate-400\">Type:</span>\n                          <span className=\"text-white ml-2\">{result.fileType}</span>\n                        </div>\n                        <div>\n                          <span className=\"text-slate-400\">Size:</span>\n                          <span className=\"text-white ml-2\">{formatFileSize(result.fileSize)}</span>\n                        </div>\n                        <div>\n                          <span className=\"text-slate-400\">Fields:</span>\n                          <span className=\"text-white ml-2\">{result.fieldsExtracted}</span>\n                        </div>\n                        <div>\n                          <span className=\"text-slate-400\">Time:</span>\n                          <span className=\"text-white ml-2\">\n                            {formatProcessingTime(processingTime)}\n                          </span>\n                        </div>\n                      </div>\n                      \n                      {result.authenticityScore !== undefined && (\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"text-slate-400\">Authenticity Score:</span>\n                          <Badge \n                            variant=\"secondary\" \n                            className={cn(\n                              result.authenticityScore >= 80 && \"bg-emerald-500/20 text-emerald-400\",\n                              result.authenticityScore >= 50 && result.authenticityScore < 80 && \"bg-yellow-500/20 text-yellow-400\",\n                              result.authenticityScore < 50 && \"bg-red-500/20 text-red-400\"\n                            )}\n                          >\n                            {result.authenticityScore}%\n                          </Badge>\n                        </div>\n                      )}\n                      \n                      {result.errorMessage && (\n                        <div className=\"p-3 bg-red-500/10 border border-red-500/20 rounded-lg\">\n                          <p className=\"text-sm text-red-400\">{result.errorMessage}</p>\n                        </div>\n                      )}\n                      \n                      {result.status === 'processing' && (\n                        <div className=\"flex items-center gap-2 text-sm text-yellow-400\">\n                          <Clock className=\"w-4 h-4 animate-spin\" />\n                          Processing... This may take a few moments\n                        </div>\n                      )}\n                      \n                      {result.status === 'pending' && (\n                        <div className=\"flex items-center gap-2 text-sm text-blue-400\">\n                          <Clock className=\"w-4 h-4\" />\n                          Waiting in queue...\n                        </div>\n                      )}\n                    </TimelineContent>\n                  </TimelineItem>\n                );\n              })}\n          </Timeline>\n        </CardContent>\n      </Card>\n\n      {/* Processing Statistics */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card className=\"bg-card border-white/10\">\n          <CardHeader>\n            <CardTitle className=\"text-white text-sm\">Processing Times</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-2 text-sm\">\n              <div className=\"flex justify-between\">\n                <span className=\"text-slate-300\">Average:</span>\n                <span className=\"text-white\">\n                  {formatProcessingTime(stats.avgProcessingTime)}\n                </span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-slate-300\">Fastest:</span>\n                <span className=\"text-white\">\n                  {formatProcessingTime(stats.fastestProcessing)}\n                </span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-slate-300\">Slowest:</span>\n                <span className=\"text-white\">\n                  {formatProcessingTime(stats.slowestProcessing)}\n                </span>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"bg-card border-white/10\">\n          <CardHeader>\n            <CardTitle className=\"text-white text-sm\">Status Breakdown</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-2 text-sm\">\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-slate-300\">Successful:</span>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-emerald-400 font-medium\">{stats.successfulFiles}</span>\n                  <Badge variant=\"secondary\" className=\"bg-emerald-500/20 text-emerald-400\">\n                    {Math.round((stats.successfulFiles / stats.totalFiles) * 100)}%\n                  </Badge>\n                </div>\n              </div>\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-slate-300\">Errors:</span>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-red-400 font-medium\">{stats.errorFiles}</span>\n                  <Badge variant=\"secondary\" className=\"bg-red-500/20 text-red-400\">\n                    {Math.round((stats.errorFiles / stats.totalFiles) * 100)}%\n                  </Badge>\n                </div>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-slate-300\">Total:</span>\n                <span className=\"text-white font-medium\">{stats.totalFiles}</span>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"bg-card border-white/10\">\n          <CardHeader>\n            <CardTitle className=\"text-white text-sm\">Batch Info</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-2 text-sm\">\n              <div className=\"flex justify-between\">\n                <span className=\"text-slate-300\">Batch ID:</span>\n                <span className=\"text-white font-mono text-xs\">\n                  {batchJob.id.slice(0, 8)}...\n                </span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-slate-300\">Created:</span>\n                <span className=\"text-white\">\n                  {format(new Date(batchJob.createdAt), 'MMM dd, HH:mm')}\n                </span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-slate-300\">Status:</span>\n                <Badge \n                  variant=\"secondary\" \n                  className={cn(\n                    \"capitalize\",\n                    batchJob.status === 'completed' && \"bg-emerald-500/20 text-emerald-400\",\n                    batchJob.status === 'failed' && \"bg-red-500/20 text-red-400\",\n                    batchJob.status === 'processing' && \"bg-yellow-500/20 text-yellow-400 animate-pulse\",\n                    batchJob.status === 'pending' && \"bg-blue-500/20 text-blue-400\"\n                  )}\n                >\n                  {batchJob.status}\n                </Badge>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n};\n\n// Helper function to format file size\nfunction formatFileSize(bytes: number): string {\n  if (bytes === 0) return '0 Bytes';\n  const k = 1024;\n  const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/batch/BatchUploadZone.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/batch/FileComparison.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[625,628],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[625,628],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":142,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5180,5183],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5180,5183],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport {\n  FileText,\n  FileImage,\n  AlertTriangle,\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\ninterface BatchResult {\n  id: string;\n  filename: string;\n  status: 'success' | 'error' | 'processing' | 'pending';\n  extractionDate: string;\n  fieldsExtracted: number;\n  fileSize: number;\n  fileType: string;\n  authenticityScore?: number;\n  metadata: Record<string, any>;\n}\n\ninterface FileComparisonProps {\n  results: BatchResult[];\n}\n\nexport const FileComparison: React.FC<FileComparisonProps> = ({ results }) => {\n  const [selectedComparison, setSelectedComparison] = useState('camera');\n  \n  if (results.length < 2) {\n    return (\n      <Card className=\"bg-card border-white/10\">\n        <CardContent className=\"py-12 text-center\">\n          <FileText className=\"w-12 h-12 mx-auto mb-4 text-slate-500\" />\n          <p className=\"text-white\">Select at least 2 files to compare</p>\n          <p className=\"text-sm text-slate-300 mt-1\">Select files in the grid view to enable comparison</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  // Get common metadata keys across all selected files\n  const allKeys = new Set<string>();\n  results.forEach(result => {\n    Object.keys(result.metadata).forEach(key => allKeys.add(key));\n  });\n  \n  const commonKeys = Array.from(allKeys).filter(key => {\n    return results.every(result =>\n      Object.prototype.hasOwnProperty.call(result.metadata, key)\n    );\n  });\n\n  // Camera-specific keys\n  const cameraKeys = [\n    'make', 'model', 'lens_model', 'iso', 'focal_length', 'aperture', 'exposure_time', \n    'flash', 'white_balance', 'metering_mode', 'exposure_program'\n  ].filter(key => commonKeys.includes(key));\n  \n  // Location-specific keys\n  const locationKeys = [\n    'gps_latitude', 'gps_longitude', 'gps_altitude', 'gps_date_stamp', 'gps_time_stamp'\n  ].filter(key => commonKeys.includes(key));\n  \n  // File-specific keys\n  const fileKeys = [\n    'file_size', 'file_type', 'datetime_original', 'datetime_digitized', 'modify_date'\n  ].filter(key => commonKeys.includes(key));\n\n  const renderComparisonTable = (keys: string[]) => {\n    if (keys.length === 0) {\n      return (\n        <div className=\"text-center py-8 text-slate-500\">\n          <AlertTriangle className=\"w-8 h-8 mx-auto mb-2\" />\n          <p>No common metadata fields to compare</p>\n          <p className=\"text-sm mt-1\">The selected files don't share metadata in this category</p>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"overflow-x-auto\">\n        <table className=\"w-full\">\n          <thead>\n            <tr className=\"border-b border-white/10\">\n              <th className=\"text-left py-3 px-4 text-slate-300 font-medium\">Field</th>\n              {results.map((result, idx) => (\n                <th key={idx} className=\"text-left py-3 px-4 text-slate-300 font-medium\">\n                  <div className=\"flex items-center gap-2\">\n                    <FileImage className=\"w-4 h-4 text-primary\" />\n                    <div className=\"min-w-0\">\n                      <div className=\"truncate max-w-[120px] text-white\">{result.filename}</div>\n                      <div className=\"text-xs text-slate-400\">\n                        {result.fieldsExtracted} fields\n                      </div>\n                    </div>\n                  </div>\n                </th>\n              ))}\n            </tr>\n          </thead>\n          <tbody>\n            {keys.map((key, idx) => {\n              const values = results.map(r => r.metadata[key]);\n              const uniqueValues = new Set(values.map(v => JSON.stringify(v)));\n              const hasDifferences = uniqueValues.size > 1;\n              \n              return (\n                <tr key={key} className={`border-b border-white/5 ${idx % 2 === 0 ? 'bg-muted/10' : ''}`}>\n                  <td className=\"py-3 px-4\">\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"text-white font-medium capitalize\">\n                        {key.replace(/_/g, ' ')}\n                      </span>\n                      {hasDifferences && (\n                        <Badge variant=\"secondary\" className=\"bg-yellow-500/20 text-yellow-400 text-xs\">\n                          Different\n                        </Badge>\n                      )}\n                    </div>\n                  </td>\n                  {results.map((result, idx) => (\n                    <td key={idx} className=\"py-3 px-4\">\n                      <div className={cn(\n                        \"text-slate-200\",\n                        hasDifferences && \"bg-yellow-500/10 p-1 rounded border border-yellow-500/20\"\n                      )}>\n                        {formatValue(result.metadata[key])}\n                      </div>\n                    </td>\n                  ))}\n                </tr>\n              );\n            })}\n          </tbody>\n        </table>\n      </div>\n    );\n  };\n\n  const formatValue = (value: any): string => {\n    if (value === null || value === undefined) return 'N/A';\n    if (typeof value === 'object') return JSON.stringify(value);\n    if (typeof value === 'boolean') return value ? 'Yes' : 'No';\n    return String(value);\n  };\n\n  const renderFileCards = () => {\n    return (\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n        {results.map(result => (\n          <Card key={result.id} className=\"bg-card border-white/10\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-start gap-3\">\n                <FileImage className=\"w-8 h-8 text-primary mt-1\" />\n                <div className=\"flex-1\">\n                  <h3 className=\"font-medium text-white truncate\">{result.filename}</h3>\n                  <div className=\"mt-2 space-y-1 text-sm\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-slate-300\">Type:</span>\n                      <span className=\"text-white\">{result.fileType}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-slate-300\">Size:</span>\n                      <span className=\"text-white\">{formatFileSize(result.fileSize)}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-slate-300\">Fields:</span>\n                      <span className=\"text-white\">{result.fieldsExtracted}</span>\n                    </div>\n                    {result.authenticityScore !== undefined && (\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-slate-300\">Authenticity:</span>\n                        <span className=\"text-white\">{result.authenticityScore}%</span>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <Card className=\"bg-card border-white/10\">\n        <CardHeader>\n          <CardTitle className=\"text-white flex items-center gap-2\">\n            <FileText className=\"w-5 h-5 text-primary\" />\n            Compare {results.length} Files\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <Tabs value={selectedComparison} onValueChange={setSelectedComparison}>\n            <TabsList className=\"grid w-full grid-cols-4 bg-muted/50\">\n              <TabsTrigger value=\"overview\" className=\"text-xs\">Overview</TabsTrigger>\n              <TabsTrigger value=\"camera\" className=\"text-xs\">Camera Settings</TabsTrigger>\n              <TabsTrigger value=\"location\" className=\"text-xs\">Location</TabsTrigger>\n              <TabsTrigger value=\"file\" className=\"text-xs\">File Details</TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"overview\" className=\"mt-4\">\n              {renderFileCards()}\n            </TabsContent>\n\n            <TabsContent value=\"camera\" className=\"mt-4\">\n              {renderComparisonTable(cameraKeys)}\n            </TabsContent>\n\n            <TabsContent value=\"location\" className=\"mt-4\">\n              {renderComparisonTable(locationKeys)}\n            </TabsContent>\n\n            <TabsContent value=\"file\" className=\"mt-4\">\n              {renderComparisonTable(fileKeys)}\n            </TabsContent>\n          </Tabs>\n        </CardContent>\n      </Card>\n\n      {/* Summary Card */}\n      <Card className=\"bg-card border-white/10\">\n        <CardHeader>\n          <CardTitle className=\"text-white flex items-center gap-2\">\n            <FileText className=\"w-5 h-5 text-primary\" />\n            Comparison Summary\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div className=\"p-4 bg-muted/20 rounded-lg\">\n              <p className=\"text-sm text-slate-300 mb-1\">Files Compared</p>\n              <p className=\"text-xl font-bold text-white\">{results.length}</p>\n            </div>\n            \n            <div className=\"p-4 bg-muted/20 rounded-lg\">\n              <p className=\"text-sm text-slate-300 mb-1\">Common Fields</p>\n              <p className=\"text-xl font-bold text-white\">{commonKeys.length}</p>\n            </div>\n            \n            <div className=\"p-4 bg-muted/20 rounded-lg\">\n              <p className=\"text-sm text-slate-300 mb-1\">Total Fields</p>\n              <p className=\"text-xl font-bold text-white\">\n                {results.reduce((sum, r) => sum + r.fieldsExtracted, 0)}\n              </p>\n            </div>\n          </div>\n          \n          <div className=\"mt-4 pt-4 border-t border-white/10\">\n            <h4 className=\"font-medium text-white mb-2\">Key Differences</h4>\n            <div className=\"space-y-2\">\n              {commonKeys.slice(0, 5).map(key => {\n                const values = results.map(r => r.metadata[key]);\n                const uniqueValues = new Set(values.map(v => JSON.stringify(v)));\n                \n                if (uniqueValues.size > 1) {\n                  return (\n                    <div key={key} className=\"flex items-center gap-2 text-sm\">\n                      <div className=\"w-2 h-2 rounded-full bg-yellow-500\"></div>\n                      <span className=\"text-slate-300 capitalize\">{key.replace(/_/g, ' ')}:</span>\n                      <div className=\"flex gap-2\">\n                        {Array.from(uniqueValues).map((value, idx) => (\n                          <Badge key={idx} variant=\"outline\" className=\"text-xs\">\n                            {value}\n                          </Badge>\n                        ))}\n                      </div>\n                    </div>\n                  );\n                }\n                return null;\n              })}\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n};\n\n// Helper function to format file size\nfunction formatFileSize(bytes: number): string {\n  if (bytes === 0) return '0 Bytes';\n  const k = 1024;\n  const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/burned-metadata-display.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/comparison-view.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1130,1133],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1130,1133],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { \n  GitCompare, \n  CheckCircle, \n  XCircle, \n  AlertTriangle,\n  FileText,\n  Calendar,\n  MapPin,\n  Camera,\n  Hash,\n  Download,\n  Eye,\n  EyeOff\n} from 'lucide-react';\n\ninterface ComparisonResult {\n  comparison_id: string;\n  total_files: number;\n  file_names: string[];\n  processing_time_ms: number;\n  comparison_result: {\n    summary: {\n      total_comparisons: number;\n      identical_files: number;\n      similar_files: number;\n      different_files: number;\n      overall_similarity: number;\n    };\n    field_comparisons: {\n      [fieldName: string]: {\n        identical_count: number;\n        different_count: number;\n        similarity_score: number;\n        variations: Array<{\n          file_index: number;\n          file_name: string;\n          value: any;\n        }>;\n      };\n    };\n    file_pairs: Array<{\n      file1_index: number;\n      file2_index: number;\n      file1_name: string;\n      file2_name: string;\n      similarity_score: number;\n      matching_fields: string[];\n      differing_fields: string[];\n    }>;\n    suspicious_patterns: string[];\n    recommendations: string[];\n  };\n}\n\ninterface ComparisonViewProps {\n  comparisonResult: ComparisonResult;\n}\n\nexport function ComparisonView({ comparisonResult }: ComparisonViewProps) {\n  const [selectedFields] = useState<string[]>([]);\n  const [showOnlyDifferences, setShowOnlyDifferences] = useState(false);\n\n  const { comparison_result: result } = comparisonResult;\n\n  const getSimilarityColor = (score: number) => {\n    if (score >= 0.9) return 'text-green-600 bg-green-50 border-green-200';\n    if (score >= 0.7) return 'text-yellow-600 bg-yellow-50 border-yellow-200';\n    return 'text-red-600 bg-red-50 border-red-200';\n  };\n\n  const getSimilarityIcon = (score: number) => {\n    if (score >= 0.9) return <CheckCircle className=\"h-4 w-4 text-green-600\" />;\n    if (score >= 0.7) return <AlertTriangle className=\"h-4 w-4 text-yellow-600\" />;\n    return <XCircle className=\"h-4 w-4 text-red-600\" />;\n  };\n\n  const getFieldIcon = (fieldName: string) => {\n    if (fieldName.includes('gps') || fieldName.includes('location')) {\n      return <MapPin className=\"h-4 w-4\" />;\n    }\n    if (fieldName.includes('date') || fieldName.includes('time')) {\n      return <Calendar className=\"h-4 w-4\" />;\n    }\n    if (fieldName.includes('camera') || fieldName.includes('exif')) {\n      return <Camera className=\"h-4 w-4\" />;\n    }\n    if (fieldName.includes('hash') || fieldName.includes('checksum')) {\n      return <Hash className=\"h-4 w-4\" />;\n    }\n    return <FileText className=\"h-4 w-4\" />;\n  };\n\n  const filteredFields = Object.entries(result.field_comparisons).filter(([fieldName, comparison]) => {\n    if (showOnlyDifferences && comparison.similarity_score >= 0.99) {\n      return false;\n    }\n    if (selectedFields.length > 0 && !selectedFields.includes(fieldName)) {\n      return false;\n    }\n    return true;\n  });\n\n  const exportComparison = () => {\n    const exportData = {\n      comparison_id: comparisonResult.comparison_id,\n      generated_at: new Date().toISOString(),\n      files: comparisonResult.file_names,\n      summary: result.summary,\n      detailed_comparison: result.field_comparisons,\n      file_pairs: result.file_pairs,\n      suspicious_patterns: result.suspicious_patterns,\n      recommendations: result.recommendations\n    };\n\n    const blob = new Blob([JSON.stringify(exportData, null, 2)], { \n      type: 'application/json' \n    });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `metadata-comparison-${comparisonResult.comparison_id}.json`;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <Card className=\"border-blue-200 bg-blue-50\">\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <CardTitle className=\"flex items-center gap-2 text-blue-900\">\n              <GitCompare className=\"h-6 w-6\" />\n              Metadata Comparison Analysis\n            </CardTitle>\n            <Button onClick={exportComparison} variant=\"outline\" size=\"sm\">\n              <Download className=\"h-4 w-4 mr-2\" />\n              Export Report\n            </Button>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold text-blue-700\">\n                {comparisonResult.total_files}\n              </div>\n              <div className=\"text-sm text-blue-600\">Files Compared</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold text-green-700\">\n                {(result.summary.overall_similarity * 100).toFixed(1)}%\n              </div>\n              <div className=\"text-sm text-green-600\">Overall Similarity</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold text-gray-700\">\n                {result.summary.total_comparisons}\n              </div>\n              <div className=\"text-sm text-gray-600\">Field Comparisons</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold text-purple-700\">\n                {(comparisonResult.processing_time_ms / 1000).toFixed(1)}s\n              </div>\n              <div className=\"text-sm text-purple-600\">Processing Time</div>\n            </div>\n          </div>\n\n          {/* File List */}\n          <div className=\"mt-4\">\n            <h4 className=\"font-medium text-gray-700 mb-2\">Files Analyzed</h4>\n            <div className=\"flex flex-wrap gap-2\">\n              {comparisonResult.file_names.map((fileName, index) => (\n                <Badge key={index} variant=\"outline\" className=\"text-xs\">\n                  {fileName}\n                </Badge>\n              ))}\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Suspicious Patterns Alert */}\n      {result.suspicious_patterns.length > 0 && (\n        <Alert className=\"border-red-200 bg-red-50\">\n          <AlertTriangle className=\"h-4 w-4 text-red-600\" />\n          <AlertDescription className=\"text-red-800\">\n            <strong>Suspicious Patterns Detected:</strong>\n            <ul className=\"mt-2 list-disc list-inside\">\n              {result.suspicious_patterns.map((pattern, index) => (\n                <li key={index}>{pattern}</li>\n              ))}\n            </ul>\n          </AlertDescription>\n        </Alert>\n      )}\n\n      {/* Main Comparison Tabs */}\n      <Tabs defaultValue=\"overview\" className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-3\">\n          <TabsTrigger value=\"overview\">Overview</TabsTrigger>\n          <TabsTrigger value=\"fields\">Field Analysis</TabsTrigger>\n          <TabsTrigger value=\"pairs\">File Pairs</TabsTrigger>\n        </TabsList>\n\n        {/* Overview Tab */}\n        <TabsContent value=\"overview\" className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <Card>\n              <CardHeader className=\"pb-3\">\n                <CardTitle className=\"text-lg flex items-center gap-2\">\n                  <CheckCircle className=\"h-5 w-5 text-green-600\" />\n                  Identical Files\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-3xl font-bold text-green-700\">\n                  {result.summary.identical_files}\n                </div>\n                <div className=\"text-sm text-gray-600\">\n                  {((result.summary.identical_files / comparisonResult.total_files) * 100).toFixed(1)}% of total\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader className=\"pb-3\">\n                <CardTitle className=\"text-lg flex items-center gap-2\">\n                  <AlertTriangle className=\"h-5 w-5 text-yellow-600\" />\n                  Similar Files\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-3xl font-bold text-yellow-700\">\n                  {result.summary.similar_files}\n                </div>\n                <div className=\"text-sm text-gray-600\">\n                  {((result.summary.similar_files / comparisonResult.total_files) * 100).toFixed(1)}% of total\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader className=\"pb-3\">\n                <CardTitle className=\"text-lg flex items-center gap-2\">\n                  <XCircle className=\"h-5 w-5 text-red-600\" />\n                  Different Files\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-3xl font-bold text-red-700\">\n                  {result.summary.different_files}\n                </div>\n                <div className=\"text-sm text-gray-600\">\n                  {((result.summary.different_files / comparisonResult.total_files) * 100).toFixed(1)}% of total\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Recommendations */}\n          {result.recommendations.length > 0 && (\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-lg\">Recommendations</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <ul className=\"space-y-2\">\n                  {result.recommendations.map((recommendation, index) => (\n                    <li key={index} className=\"flex items-start gap-2\">\n                      <CheckCircle className=\"h-4 w-4 text-blue-600 mt-0.5 flex-shrink-0\" />\n                      <span className=\"text-sm\">{recommendation}</span>\n                    </li>\n                  ))}\n                </ul>\n              </CardContent>\n            </Card>\n          )}\n        </TabsContent>\n\n        {/* Field Analysis Tab */}\n        <TabsContent value=\"fields\" className=\"space-y-4\">\n          {/* Field Filters */}\n          <Card>\n            <CardContent className=\"pt-6\">\n              <div className=\"flex items-center gap-4 mb-4\">\n                <Button\n                  variant={showOnlyDifferences ? \"default\" : \"outline\"}\n                  size=\"sm\"\n                  onClick={() => setShowOnlyDifferences(!showOnlyDifferences)}\n                >\n                  {showOnlyDifferences ? <Eye className=\"h-4 w-4 mr-2\" /> : <EyeOff className=\"h-4 w-4 mr-2\" />}\n                  {showOnlyDifferences ? 'Show All Fields' : 'Show Only Differences'}\n                </Button>\n              </div>\n\n              <div className=\"text-sm text-gray-600 mb-2\">\n                Showing {filteredFields.length} of {Object.keys(result.field_comparisons).length} fields\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Field Comparison Results */}\n          <div className=\"space-y-3\">\n            {filteredFields.map(([fieldName, comparison]) => (\n              <Card key={fieldName} className={getSimilarityColor(comparison.similarity_score)}>\n                <CardContent className=\"pt-4\">\n                  <div className=\"flex items-center justify-between mb-3\">\n                    <div className=\"flex items-center gap-2\">\n                      {getFieldIcon(fieldName)}\n                      <span className=\"font-medium\">{fieldName}</span>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      {getSimilarityIcon(comparison.similarity_score)}\n                      <span className=\"font-bold\">\n                        {(comparison.similarity_score * 100).toFixed(1)}%\n                      </span>\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                    <div>\n                      <span className=\"font-medium\">Identical: </span>\n                      <span>{comparison.identical_count}</span>\n                    </div>\n                    <div>\n                      <span className=\"font-medium\">Different: </span>\n                      <span>{comparison.different_count}</span>\n                    </div>\n                  </div>\n\n                  {comparison.variations.length > 0 && (\n                    <div className=\"mt-3\">\n                      <span className=\"font-medium text-sm\">Variations:</span>\n                      <div className=\"mt-1 space-y-1\">\n                        {comparison.variations.map((variation, index) => (\n                          <div key={index} className=\"text-xs bg-white bg-opacity-50 p-2 rounded\">\n                            <span className=\"font-medium\">{variation.file_name}:</span>\n                            <span className=\"ml-2\">{JSON.stringify(variation.value)}</span>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </TabsContent>\n\n        {/* File Pairs Tab */}\n        <TabsContent value=\"pairs\" className=\"space-y-4\">\n          <div className=\"grid gap-4\">\n            {result.file_pairs.map((pair, index) => (\n              <Card key={index} className={getSimilarityColor(pair.similarity_score)}>\n                <CardContent className=\"pt-4\">\n                  <div className=\"flex items-center justify-between mb-3\">\n                    <div className=\"flex items-center gap-2\">\n                      <GitCompare className=\"h-4 w-4\" />\n                      <span className=\"font-medium\">\n                        {pair.file1_name}  {pair.file2_name}\n                      </span>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      {getSimilarityIcon(pair.similarity_score)}\n                      <span className=\"font-bold\">\n                        {(pair.similarity_score * 100).toFixed(1)}%\n                      </span>\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\n                    <div>\n                      <span className=\"font-medium\">Matching Fields ({pair.matching_fields.length}):</span>\n                      <div className=\"mt-1 flex flex-wrap gap-1\">\n                        {pair.matching_fields.slice(0, 5).map((field, idx) => (\n                          <Badge key={idx} variant=\"outline\" className=\"text-xs\">\n                            {field}\n                          </Badge>\n                        ))}\n                        {pair.matching_fields.length > 5 && (\n                          <Badge variant=\"outline\" className=\"text-xs\">\n                            +{pair.matching_fields.length - 5} more\n                          </Badge>\n                        )}\n                      </div>\n                    </div>\n\n                    <div>\n                      <span className=\"font-medium\">Differing Fields ({pair.differing_fields.length}):</span>\n                      <div className=\"mt-1 flex flex-wrap gap-1\">\n                        {pair.differing_fields.slice(0, 5).map((field, idx) => (\n                          <Badge key={idx} variant=\"destructive\" className=\"text-xs\">\n                            {field}\n                          </Badge>\n                        ))}\n                        {pair.differing_fields.length > 5 && (\n                          <Badge variant=\"destructive\" className=\"text-xs\">\n                            +{pair.differing_fields.length - 5} more\n                          </Badge>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/dashboard-layout.tsx","messages":[{"ruleId":"jsx-a11y/click-events-have-key-events","severity":1,"message":"Visible, non-interactive elements with click handlers must have at least one keyboard listener.","line":57,"column":13,"nodeType":"JSXOpeningElement","endLine":60,"endColumn":15},{"ruleId":"jsx-a11y/no-static-element-interactions","severity":1,"message":"Avoid non-native interactive elements. If using native HTML is not possible, add an appropriate role and support for tabbing, mouse, keyboard, and touch inputs to an interactive content element.","line":57,"column":13,"nodeType":"JSXOpeningElement","endLine":60,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Outlet } from 'react-router-dom';\n\n/**\n * Dashboard Layout Component\n * \n * Provides a consistent layout structure for dashboard pages with:\n * - Responsive sidebar navigation\n * - Top navigation bar with user menu\n * - Main content area with proper spacing\n * - Mobile-friendly collapsible sidebar\n * - Breadcrumb navigation\n * - Quick actions menu\n * \n * Used by: Dashboard, Analytics, Settings, and other authenticated pages\n */\n\ninterface DashboardLayoutProps {\n  children?: React.ReactNode;\n  sidebar?: React.ReactNode;\n  header?: React.ReactNode;\n  breadcrumbs?: Array<{ label: string; href?: string }>;\n  actions?: React.ReactNode;\n}\n\nexport function DashboardLayout({\n  children,\n  sidebar,\n  header,\n  breadcrumbs,\n  actions,\n}: DashboardLayoutProps) {\n  const [sidebarOpen, setSidebarOpen] = React.useState(true);\n  const [isMobile, setIsMobile] = React.useState(false);\n\n  // Detect mobile viewport\n  React.useEffect(() => {\n    const checkMobile = () => {\n      setIsMobile(window.innerWidth < 768);\n      if (window.innerWidth < 768) {\n        setSidebarOpen(false);\n      }\n    };\n\n    checkMobile();\n    window.addEventListener('resize', checkMobile);\n    return () => window.removeEventListener('resize', checkMobile);\n  }, []);\n\n  return (\n    <div className=\"dashboard-layout min-h-screen bg-gray-50 dark:bg-gray-900\">\n      {/* Sidebar */}\n      {sidebar && (\n        <>\n          {/* Mobile overlay */}\n          {isMobile && sidebarOpen && (\n            <div\n              className=\"fixed inset-0 bg-black/50 z-40\"\n              onClick={() => setSidebarOpen(false)}\n            />\n          )}\n\n          {/* Sidebar content */}\n          <aside\n            className={`\n              fixed top-0 left-0 h-full bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700\n              transition-transform duration-300 z-50\n              ${sidebarOpen ? 'translate-x-0' : '-translate-x-full'}\n              ${isMobile ? 'w-64' : 'w-64 md:w-72'}\n            `}\n          >\n            <div className=\"h-full flex flex-col\">\n              {/* Sidebar header */}\n              <div className=\"p-4 border-b border-gray-200 dark:border-gray-700\">\n                <div className=\"flex items-center justify-between\">\n                  <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                    MetaExtract\n                  </h2>\n                  {isMobile && (\n                    <button\n                      onClick={() => setSidebarOpen(false)}\n                      className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded\"\n                    >\n                      <svg\n                        className=\"w-5 h-5\"\n                        fill=\"none\"\n                        stroke=\"currentColor\"\n                        viewBox=\"0 0 24 24\"\n                      >\n                        <path\n                          strokeLinecap=\"round\"\n                          strokeLinejoin=\"round\"\n                          strokeWidth={2}\n                          d=\"M6 18L18 6M6 6l12 12\"\n                        />\n                      </svg>\n                    </button>\n                  )}\n                </div>\n              </div>\n\n              {/* Sidebar content */}\n              <div className=\"flex-1 overflow-y-auto p-4\">\n                {sidebar}\n              </div>\n            </div>\n          </aside>\n        </>\n      )}\n\n      {/* Main content area */}\n      <div\n        className={`\n          transition-all duration-300\n          ${sidebarOpen && !isMobile ? 'md:ml-64 lg:ml-72' : ''}\n        `}\n      >\n        {/* Top bar */}\n        <header className=\"sticky top-0 z-30 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700\">\n          <div className=\"px-4 py-3 flex items-center justify-between\">\n            {/* Left section - Menu toggle */}\n            <div className=\"flex items-center gap-4\">\n              <button\n                onClick={() => setSidebarOpen(!sidebarOpen)}\n                className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded\"\n                aria-label=\"Toggle sidebar\"\n              >\n                <svg\n                  className=\"w-5 h-5\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth={2}\n                    d=\"M4 6h16M4 12h16M4 18h16\"\n                  />\n                </svg>\n              </button>\n\n              {/* Breadcrumbs */}\n              {breadcrumbs && breadcrumbs.length > 0 && (\n                <nav className=\"flex items-center text-sm\">\n                  {breadcrumbs.map((crumb, index) => (\n                    <React.Fragment key={index}>\n                      {index > 0 && (\n                        <span className=\"mx-2 text-gray-400\">/</span>\n                      )}\n                      {crumb.href ? (\n                        <a\n                          href={crumb.href}\n                          className=\"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white\"\n                        >\n                          {crumb.label}\n                        </a>\n                      ) : (\n                        <span className=\"text-gray-900 dark:text-white font-medium\">\n                          {crumb.label}\n                        </span>\n                      )}\n                    </React.Fragment>\n                  ))}\n                </nav>\n              )}\n            </div>\n\n            {/* Right section - Actions & Header */}\n            <div className=\"flex items-center gap-4\">\n              {actions}\n              {header}\n            </div>\n          </div>\n        </header>\n\n        {/* Page content */}\n        <main className=\"p-4 md:p-6 lg:p-8\">\n          {children || <Outlet />}\n        </main>\n      </div>\n    </div>\n  );\n}\n\n// Example usage:\n// import { DashboardLayout } from '@/components/dashboard-layout';\n//\n// function DashboardPage() {\n//   return (\n//     <DashboardLayout\n//       sidebar={<DashboardSidebar />}\n//       header={<UserMenu />}\n//       breadcrumbs={[\n//         { label: 'Dashboard', href: '/dashboard' },\n//         { label: 'Analytics' }\n//       ]}\n//       actions={\n//         <button>New Extraction</button>\n//       }\n//     >\n//       <YourPageContent />\n//     </DashboardLayout>\n//   );\n// }\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/educational-examples.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/enhanced-results-display-v2.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1157,1160],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1157,1160],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1192,1195],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1192,1195],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1220,1223],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1220,1223],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1259,1262],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1259,1262],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1292,1295],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1292,1295],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":65,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1321,1324],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1321,1324],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1351,1354],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1351,1354],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1388,1391],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1388,1391],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1425,1428],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1425,1428],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":69,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1460,1463],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1460,1463],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1495,1498],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1495,1498],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1536,1539],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1536,1539],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1572,1575],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1572,1575],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1607,1610],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1607,1610],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":74,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1650,1653],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1650,1653],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1695,1698],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1695,1698],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":76,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1740,1743],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1740,1743],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1788,1791],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1788,1791],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1838,1841],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1838,1841],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1884,1887],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1884,1887],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":80,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1933,1936],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1933,1936],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":81,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1978,1981],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1978,1981],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2025,2028],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2025,2028],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2072,2075],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2072,2075],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2127,2130],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2127,2130],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2182,2185],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2182,2185],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":86,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2227,2230],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2227,2230],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2277,2280],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2277,2280],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2318,2321],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2318,2321],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":89,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2358,2361],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2358,2361],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2400,2403],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2400,2403],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2450,2453],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2450,2453],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2525,2528],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2525,2528],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2577,2580],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2577,2580],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2832,2835],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2832,2835],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":104,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2882,2885],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2882,2885],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2934,2937],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2934,2937],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":106,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2989,2992],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2989,2992],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":107,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3037,3040],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3037,3040],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3091,3094],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3091,3094],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":109,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3143,3146],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3143,3146],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":110,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3193,3196],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3193,3196],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":111,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3245,3248],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3245,3248],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":112,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3302,3305],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3302,3305],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":113,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3359,3362],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3359,3362],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3410,3413],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3410,3413],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":115,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3461,3464],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3461,3464],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":116,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3518,3521],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3518,3521],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":117,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3569,3572],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3569,3572],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":118,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3618,3621],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3618,3621],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":119,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3679,3682],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3679,3682],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":120,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3732,3735],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3732,3735],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":121,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3785,3788],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3785,3788],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":123,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3843,3846],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3843,3846],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":124,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3873,3876],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3873,3876],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":203,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":203,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6383,6386],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6383,6386],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":441,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":441,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15095,15098],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15095,15098],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":453,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":453,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15478,15481],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15478,15481],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":478,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":478,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16448,16451],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16448,16451],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":490,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":490,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16879,16882],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16879,16882],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":525,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":525,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18160,18163],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18160,18163],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":538,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":538,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18650,18653],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18650,18653],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":62,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from '@/components/ui/card';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport {\n  Accordion,\n  AccordionContent,\n  AccordionItem,\n  AccordionTrigger,\n} from '@/components/ui/accordion';\nimport {\n  Search,\n  Download,\n  Copy,\n  Eye,\n  EyeOff,\n  Filter,\n  FileJson,\n  Database,\n  Image as ImageIcon,\n  Video,\n  Music,\n  FileText,\n  Globe,\n  Shield,\n  MapPin,\n  Camera,\n  Smartphone,\n  Hash,\n  EyeIcon,\n  Mail,\n} from 'lucide-react';\nimport { Input } from '@/components/ui/input';\nimport { ScrollArea } from '@/components/ui/scroll-area';\n\ninterface MetadataResult {\n  filename: string;\n  filesize: string;\n  filetype: string;\n  mime_type: string;\n  tier: string;\n  fields_extracted: number;\n  processing_ms: number;\n  file_integrity: Record<string, string>;\n  filesystem: Record<string, any>;\n  calculated: Record<string, any>;\n  gps: Record<string, any> | null;\n  summary: Record<string, any>;\n  forensic: Record<string, any>;\n  exif: Record<string, any>;\n  image: Record<string, any> | null;\n  video: Record<string, any> | null;\n  audio: Record<string, any> | null;\n  pdf: Record<string, any> | null;\n  svg: Record<string, any> | null;\n  makernote: Record<string, any> | null;\n  iptc: Record<string, any> | null;\n  xmp: Record<string, any> | null;\n  normalized?: Record<string, any> | null;\n  web_metadata?: Record<string, any> | null;\n  social_media?: Record<string, any> | null;\n  mobile_metadata?: Record<string, any> | null;\n  forensic_security?: Record<string, any> | null;\n  action_camera?: Record<string, any> | null;\n  print_publishing?: Record<string, any> | null;\n  workflow_dam?: Record<string, any> | null;\n  audio_advanced?: Record<string, any> | null;\n  video_advanced?: Record<string, any> | null;\n  steganography_analysis?: Record<string, any> | null;\n  manipulation_detection?: Record<string, any> | null;\n  ai_detection?: Record<string, any> | null;\n  timeline_analysis?: Record<string, any> | null;\n  iptc_raw?: Record<string, any> | null;\n  xmp_raw?: Record<string, any> | null;\n  thumbnail?: Record<string, any> | null;\n  perceptual_hashes?: Record<string, any> | null;\n  locked_fields: string[];\n  burned_metadata?: Record<string, any> | null;\n  metadata_comparison?: Record<string, any> | null;\n  advanced_analysis?: {\n    enabled: boolean;\n    processing_time_ms: number;\n    modules_run: string[];\n    forensic_score: number;\n    authenticity_assessment: string;\n  } | null;\n  // Specialized Modules\n  medical_imaging?: Record<string, any> | null;\n  astronomical_data?: Record<string, any> | null;\n  geospatial_analysis?: Record<string, any> | null;\n  scientific_instruments?: Record<string, any> | null;\n  drone_telemetry?: Record<string, any> | null;\n  blockchain_provenance?: Record<string, any> | null;\n  emerging_technology?: Record<string, any> | null;\n  document_analysis?: Record<string, any> | null;\n  scientific_research?: Record<string, any> | null;\n  multimedia_entertainment?: Record<string, any> | null;\n  industrial_manufacturing?: Record<string, any> | null;\n  financial_business?: Record<string, any> | null;\n  healthcare_medical?: Record<string, any> | null;\n  transportation_logistics?: Record<string, any> | null;\n  education_academic?: Record<string, any> | null;\n  legal_compliance?: Record<string, any> | null;\n  environmental_sustainability?: Record<string, any> | null;\n  social_media_digital?: Record<string, any> | null;\n  gaming_entertainment?: Record<string, any> | null;\n  // Email metadata\n  email?: Record<string, any> | null;\n  [key: string]: any;\n}\n\ninterface EnhancedResultsDisplayProps {\n  result: MetadataResult;\n}\n\n/**\n * Enhanced Results Display Component\n * Provides an improved interface for displaying metadata extraction results\n * with better organization, filtering, and visualization.\n */\nexport function EnhancedResultsDisplayV2({\n  result,\n}: EnhancedResultsDisplayProps) {\n  const [searchTerm, setSearchTerm] = useState('');\n  const [activeTab, setActiveTab] = useState('summary');\n  const [visibleFields, setVisibleFields] = useState<Record<string, boolean>>(\n    {}\n  );\n\n  // Toggle field visibility\n  const toggleFieldVisibility = (category: string, field: string) => {\n    const key = `${category}.${field}`;\n    setVisibleFields(prev => ({\n      ...prev,\n      [key]: !prev[key],\n    }));\n  };\n\n  // Filter metadata based on search term\n  // Get category icon\n  const getCategoryIcon = (category: string) => {\n    switch (category.toLowerCase()) {\n      case 'exif':\n        return <Camera className=\"w-4 h-4\" />;\n      case 'gps':\n        return <MapPin className=\"w-4 h-4\" />;\n      case 'image':\n        return <ImageIcon className=\"w-4 h-4\" aria-hidden=\"true\" />;\n      case 'video':\n        return <Video className=\"w-4 h-4\" />;\n      case 'audio':\n        return <Music className=\"w-4 h-4\" />;\n      case 'pdf':\n        return <FileText className=\"w-4 h-4\" />;\n      case 'file_integrity':\n        return <Shield className=\"w-4 h-4\" />;\n      case 'forensic':\n        return <EyeIcon className=\"w-4 h-4\" />;\n      case 'makernote':\n        return <Smartphone className=\"w-4 h-4\" />;\n      case 'iptc':\n      case 'xmp':\n        return <Database className=\"w-4 h-4\" />;\n      case 'web_metadata':\n        return <Globe className=\"w-4 h-4\" />;\n      case 'social_media':\n        return <Globe className=\"w-4 h-4\" />;\n      case 'mobile_metadata':\n        return <Smartphone className=\"w-4 h-4\" />;\n      case 'blockchain_provenance':\n        return <Hash className=\"w-4 h-4\" />;\n      case 'medical_imaging':\n        return <Shield className=\"w-4 h-4\" />;\n      case 'astronomical_data':\n        return <Globe className=\"w-4 h-4\" />;\n      case 'geospatial_analysis':\n        return <MapPin className=\"w-4 h-4\" />;\n      case 'drone_telemetry':\n        return <MapPin className=\"w-4 h-4\" />;\n      case 'email':\n        return <Mail className=\"w-4 h-4\" />;\n      default:\n        return <Database className=\"w-4 h-4\" />;\n    }\n  };\n\n  // Render metadata table for a category\n  const renderMetadataTable = (data: Record<string, any>, category: string) => {\n    if (!data || typeof data !== 'object') return null;\n\n    const entries = Object.entries(data).filter(\n      ([key, value]) =>\n        key.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        String(value).toLowerCase().includes(searchTerm.toLowerCase())\n    );\n\n    if (entries.length === 0) return null;\n\n    return (\n      <Table>\n        <TableHeader>\n          <TableRow>\n            <TableHead className=\"w-1/3\">Field</TableHead>\n            <TableHead>Value</TableHead>\n          </TableRow>\n        </TableHeader>\n        <TableBody>\n          {entries.map(([key, value]) => (\n            <TableRow key={key}>\n              <TableCell className=\"font-medium\">\n                <div className=\"flex items-center gap-2\">\n                  <span>{key}</span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => toggleFieldVisibility(category, key)}\n                  >\n                    {visibleFields[`${category}.${key}`] ? (\n                      <Eye className=\"w-3 h-3\" />\n                    ) : (\n                      <EyeOff className=\"w-3 h-3\" />\n                    )}\n                  </Button>\n                </div>\n              </TableCell>\n              <TableCell>\n                {visibleFields[`${category}.${key}`] !== false ? (\n                  <pre className=\"text-sm max-w-full overflow-x-auto whitespace-pre-wrap break-words\">\n                    {typeof value === 'object'\n                      ? JSON.stringify(value, null, 2)\n                      : String(value)}\n                  </pre>\n                ) : (\n                  <span className=\"text-muted-foreground italic\">Hidden</span>\n                )}\n              </TableCell>\n            </TableRow>\n          ))}\n        </TableBody>\n      </Table>\n    );\n  };\n\n  // Get all metadata categories\n  const metadataCategories = Object.keys(result).filter(\n    key =>\n      typeof result[key as keyof MetadataResult] === 'object' &&\n      result[key as keyof MetadataResult] !== null &&\n      !['locked_fields', 'error'].includes(key) &&\n      !Array.isArray(result[key as keyof MetadataResult])\n  );\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header Section */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n            <div>\n              <CardTitle className=\"flex items-center gap-2\">\n                <FileJson className=\"w-5 h-5\" />\n                Metadata Extraction Results\n              </CardTitle>\n              <CardDescription>\n                Detailed analysis of {result.filename} (\n                {result.fields_extracted} fields extracted)\n              </CardDescription>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Badge variant=\"outline\">Tier: {result.tier.toUpperCase()}</Badge>\n              <Badge variant=\"secondary\">\n                {result.fields_extracted} fields\n              </Badge>\n              <Badge variant=\"secondary\">{result.processing_ms}ms</Badge>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex flex-col sm:flex-row gap-4 mb-4\">\n            <div className=\"relative flex-1\">\n              <Search className=\"absolute left-2 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4\" />\n              <Input\n                placeholder=\"Search metadata fields...\"\n                value={searchTerm}\n                onChange={e => setSearchTerm(e.target.value)}\n                className=\"pl-8\"\n              />\n            </div>\n            <Button variant=\"outline\">\n              <Filter className=\"w-4 h-4 mr-2\" />\n              Filter\n            </Button>\n            <Button variant=\"outline\">\n              <Download className=\"w-4 h-4 mr-2\" />\n              Export\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Summary Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">File Info</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-1\">\n              <p className=\"text-sm\">\n                <span className=\"font-medium\">Name:</span> {result.filename}\n              </p>\n              <p className=\"text-sm\">\n                <span className=\"font-medium\">Size:</span> {result.filesize}\n              </p>\n              <p className=\"text-sm\">\n                <span className=\"font-medium\">Type:</span> {result.filetype}\n              </p>\n              <p className=\"text-sm\">\n                <span className=\"font-medium\">MIME:</span> {result.mime_type}\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Processing</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-1\">\n              <p className=\"text-sm\">\n                <span className=\"font-medium\">Fields:</span>{' '}\n                {result.fields_extracted}\n              </p>\n              <p className=\"text-sm\">\n                <span className=\"font-medium\">Time:</span>{' '}\n                {result.processing_ms}ms\n              </p>\n              <p className=\"text-sm\">\n                <span className=\"font-medium\">Tier:</span> {result.tier}\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Integrity</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-1\">\n              {result.file_integrity &&\n                Object.entries(result.file_integrity).map(([key, value]) => (\n                  <p key={key} className=\"text-sm\">\n                    <span className=\"font-medium\">{key}:</span> {String(value)}\n                  </p>\n                ))}\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Categories</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-1\">\n              <p className=\"text-sm\">\n                <span className=\"font-medium\">Available:</span>{' '}\n                {metadataCategories.length}\n              </p>\n              <p className=\"text-sm\">\n                <span className=\"font-medium\">Locked:</span>{' '}\n                {result.locked_fields.length}\n              </p>\n              <p className=\"text-sm\">\n                <span className=\"font-medium\">Status:</span>\n                <Badge\n                  variant={result.error ? 'destructive' : 'default'}\n                  className=\"ml-2\"\n                >\n                  {result.error ? 'Error' : 'Success'}\n                </Badge>\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Metadata Categories Tabs */}\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-6 overflow-x-auto\">\n          {metadataCategories.slice(0, 6).map(category => (\n            <TabsTrigger\n              key={category}\n              value={category}\n              className=\"whitespace-nowrap\"\n            >\n              <div className=\"flex items-center gap-1\">\n                {getCategoryIcon(category)}\n                <span className=\"capitalize\">{category.replace('_', ' ')}</span>\n              </div>\n            </TabsTrigger>\n          ))}\n          {metadataCategories.length > 6 && (\n            <TabsTrigger value=\"more\" className=\"whitespace-nowrap\">\n              More...\n            </TabsTrigger>\n          )}\n        </TabsList>\n\n        {metadataCategories.map(category => (\n          <TabsContent key={category} value={category} className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  {getCategoryIcon(category)}\n                  <span className=\"capitalize\">\n                    {category.replace('_', ' ')}\n                  </span>\n                  <Badge variant=\"secondary\" className=\"ml-2\">\n                    {\n                      Object.keys(\n                        result[category as keyof MetadataResult] as Record<\n                          string,\n                          any\n                        >\n                      ).length\n                    }{' '}\n                    fields\n                  </Badge>\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                {renderMetadataTable(\n                  result[category as keyof MetadataResult] as Record<\n                    string,\n                    any\n                  >,\n                  category\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n        ))}\n\n        {metadataCategories.length > 6 && (\n          <TabsContent value=\"more\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              {metadataCategories.slice(6).map(category => (\n                <Card key={category}>\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2\">\n                      {getCategoryIcon(category)}\n                      <span className=\"capitalize\">\n                        {category.replace('_', ' ')}\n                      </span>\n                      <Badge variant=\"secondary\" className=\"ml-2\">\n                        {\n                          Object.keys(\n                            result[category as keyof MetadataResult] as Record<\n                              string,\n                              any\n                            >\n                          ).length\n                        }{' '}\n                        fields\n                      </Badge>\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    {renderMetadataTable(\n                      result[category as keyof MetadataResult] as Record<\n                        string,\n                        any\n                      >,\n                      category\n                    )}\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </TabsContent>\n        )}\n      </Tabs>\n\n      {/* Collapsible Categories View */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Expandable Categories View</CardTitle>\n          <CardDescription>\n            Expand each category to view its metadata fields\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Accordion type=\"single\" collapsible className=\"w-full\">\n            {metadataCategories.map(category => (\n              <AccordionItem key={category} value={category}>\n                <AccordionTrigger className=\"flex items-center gap-2\">\n                  <div className=\"flex items-center gap-2\">\n                    {getCategoryIcon(category)}\n                    <span className=\"capitalize\">\n                      {category.replace('_', ' ')}\n                    </span>\n                    <Badge variant=\"secondary\" className=\"ml-2\">\n                      {\n                        Object.keys(\n                          result[category as keyof MetadataResult] as Record<\n                            string,\n                            any\n                          >\n                        ).length\n                      }{' '}\n                      fields\n                    </Badge>\n                  </div>\n                </AccordionTrigger>\n                <AccordionContent>\n                  <ScrollArea className=\"h-80 rounded-md border p-4\">\n                    {renderMetadataTable(\n                      result[category as keyof MetadataResult] as Record<\n                        string,\n                        any\n                      >,\n                      category\n                    )}\n                  </ScrollArea>\n                </AccordionContent>\n              </AccordionItem>\n            ))}\n          </Accordion>\n        </CardContent>\n      </Card>\n\n      {/* Action Buttons */}\n      <div className=\"flex flex-wrap gap-2 justify-end pt-4\">\n        <Button variant=\"outline\">\n          <Copy className=\"w-4 h-4 mr-2\" />\n          Copy All Data\n        </Button>\n        <Button variant=\"outline\">\n          <Download className=\"w-4 h-4 mr-2\" />\n          Export JSON\n        </Button>\n        <Button variant=\"outline\">\n          <Download className=\"w-4 h-4 mr-2\" />\n          Export CSV\n        </Button>\n        <Button>\n          <FileJson className=\"w-4 h-4 mr-2\" />\n          View Raw\n        </Button>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/enhanced-upload-zone-v2.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1077,1080],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1077,1080],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1222,1225],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1222,1225],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1982,1985],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1982,1985],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2223,2226],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2223,2226],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":196,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":196,"endColumn":20,"suggestions":[{"fix":{"range":[5735,5777],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useCallback, useRef } from 'react';\nimport { useDropzone } from 'react-dropzone';\nimport { Button } from '@/components/ui/button';\nimport { Progress } from '@/components/ui/progress';\nimport { Card } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport {\n  Upload,\n  File,\n  Image as ImageIcon,\n  Video,\n  Music,\n  FileText,\n  X,\n  CheckCircle2,\n  AlertCircle,\n  Loader2,\n  Zap,\n  Clock,\n  Info,\n  Sparkles,\n  Trophy,\n  Star\n} from 'lucide-react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { cn } from '@/lib/utils';\nimport { useToast } from '@/hooks/use-toast';\nimport { analyzeFile, type FileAnalysis } from '@/utils/fileAnalysis';\nimport {\n  estimateProcessingTime,\n  type ProcessingEstimate,\n} from '@/utils/processingEstimates';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from '@/components/ui/tooltip';\n\ninterface FileState {\n  file: File;\n  id: string;\n  preview?: string;\n  status: 'pending' | 'uploading' | 'processing' | 'complete' | 'error';\n  progress: number;\n  result?: any;\n  error?: string;\n  analysis?: FileAnalysis;\n  estimate?: ProcessingEstimate;\n}\n\ninterface EnhancedUploadZoneProps {\n  onResults: (results: any[]) => void;\n  tier: string;\n  maxFiles?: number;\n  className?: string;\n  advanced?: boolean;\n  showTierInfo?: boolean;\n}\n\n/**\n * Enhanced Upload Zone Component\n * Provides an improved drag-and-drop interface with better UX, real-time feedback,\n * and detailed file analysis information.\n */\nexport function EnhancedUploadZoneV2({ \n  onResults, \n  tier, \n  maxFiles = 10, \n  className,\n  advanced = false,\n  showTierInfo = true\n}: EnhancedUploadZoneProps) {\n  const [files, setFiles] = useState<FileState[]>([]);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const { toast } = useToast();\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  // Handle file drop\n  const onDrop = useCallback(async (acceptedFiles: File[], fileRejections: any[]) => {\n    // Show toast for rejected files\n    if (fileRejections.length > 0) {\n      fileRejections.forEach(({ file, errors }) => {\n        toast({\n          title: `File Rejected: ${file.name}`,\n          description: errors.map((e: any) => e.message).join(', '),\n          variant: 'destructive',\n        });\n      });\n    }\n\n    // Process accepted files\n    const validTiers = ['free', 'professional', 'forensic', 'enterprise'] as const;\n    const tierKey = validTiers.includes(tier as (typeof validTiers)[number])\n      ? (tier as (typeof validTiers)[number])\n      : 'free';\n\n    const newFiles = await Promise.all(\n      acceptedFiles\n        .slice(0, maxFiles - files.length)\n        .map(async (file) => {\n          const id = `${Date.now()}-${Math.random()}`;\n          const analysis = await analyzeFile(file);\n          const estimate = estimateProcessingTime(file, tierKey);\n\n          const newFile: FileState = {\n            file,\n            id,\n            status: 'pending' as const,\n            progress: 0,\n            analysis,\n            estimate,\n          };\n          return newFile;\n        })\n    );\n\n    if (newFiles.length > 0) {\n      setFiles(prev => [...prev, ...newFiles] as FileState[]);\n    }\n\n    if (files.length + newFiles.length >= maxFiles) {\n      toast({\n        title: 'Maximum files reached',\n        description: `You can only upload up to ${maxFiles} files at a time.`,\n      });\n    }\n  }, [files.length, maxFiles, tier, toast]);\n\n  // Configure dropzone\n  const { getRootProps, getInputProps, isDragActive } = useDropzone({\n    onDrop,\n    accept: {\n      'image/*': ['.jpg', '.jpeg', '.png', '.gif', '.webp', '.bmp', '.svg', '.tiff', '.heic', '.heif'],\n      'video/*': ['.mp4', '.mov', '.avi', '.mkv', '.wmv', '.flv', '.webm', '.m4v', '.3gp'],\n      'audio/*': ['.mp3', '.wav', '.flac', '.aac', '.ogg', '.m4a', '.wma'],\n      'application/pdf': ['.pdf'],\n      'text/plain': ['.txt'],\n      'application/zip': ['.zip', '.rar', '.7z'],\n    },\n    maxFiles: maxFiles - files.length,\n    maxSize: 200 * 1024 * 1024, // 200MB\n  });\n\n  // Handle file removal\n  const removeFile = (id: string) => {\n    setFiles(prev => prev.filter(f => f.id !== id));\n  };\n\n  // Handle file submission\n  const handleSubmit = async () => {\n    if (files.length === 0) return;\n\n    setIsSubmitting(true);\n    \n    try {\n      // Simulate processing for demo purposes\n      const updatedFiles = [...files];\n      \n      for (let i = 0; i < updatedFiles.length; i++) {\n        const fileState = updatedFiles[i];\n        \n        // Update status to uploading\n        setFiles(prev => prev.map(f => \n          f.id === fileState.id ? { ...f, status: 'uploading', progress: 10 } : f\n        ));\n        \n        // Simulate upload progress\n        for (let progress = 10; progress <= 60; progress += 10) {\n          await new Promise(resolve => setTimeout(resolve, 200));\n          setFiles(prev => prev.map(f => \n            f.id === fileState.id ? { ...f, progress } : f\n          ));\n        }\n        \n        // Update status to processing\n        setFiles(prev => prev.map(f => \n          f.id === fileState.id ? { ...f, status: 'processing', progress: 70 } : f\n        ));\n        \n        // Simulate processing\n        await new Promise(resolve => setTimeout(resolve, 1000));\n        \n        // Update to complete\n        setFiles(prev => prev.map(f => \n          f.id === fileState.id ? { ...f, status: 'complete', progress: 100, result: { fields: 1500 } } : f\n        ));\n      }\n      \n      // Call the results handler after all files are processed\n      setTimeout(() => {\n        onResults(updatedFiles.map(f => f.result));\n        setIsSubmitting(false);\n      }, 500);\n      \n    } catch (error) {\n      console.error('Submission error:', error);\n      toast({\n        title: 'Submission Error',\n        description: 'There was an error processing your files. Please try again.',\n        variant: 'destructive',\n      });\n      setIsSubmitting(false);\n    }\n  };\n\n  // Clear all files\n  const clearAllFiles = () => {\n    setFiles([]);\n  };\n\n  // Get file icon based on type\n  const getFileIcon = (file: File) => {\n    const type = file.type.split('/')[0];\n    const ext = file.name.split('.').pop()?.toLowerCase();\n\n    if (type === 'image') return <ImageIcon className=\"w-5 h-5\" aria-hidden=\"true\" />;\n    if (type === 'video') return <Video className=\"w-5 h-5\" />;\n    if (type === 'audio') return <Music className=\"w-5 h-5\" />;\n    if (ext === 'pdf') return <FileText className=\"w-5 h-5\" />;\n    return <File className=\"w-5 h-5\" />;\n  };\n\n  // Get status badge\n  const getStatusBadge = (status: FileState['status']) => {\n    switch (status) {\n      case 'pending':\n        return <Badge variant=\"secondary\">Pending</Badge>;\n      case 'uploading':\n        return <Badge variant=\"secondary\">Uploading</Badge>;\n      case 'processing':\n        return <Badge variant=\"secondary\">Processing</Badge>;\n      case 'complete':\n        return <Badge variant=\"default\"><CheckCircle2 className=\"w-3 h-3 mr-1\" /> Complete</Badge>;\n      case 'error':\n        return <Badge variant=\"destructive\">Error</Badge>;\n      default:\n        return <Badge variant=\"secondary\">{status}</Badge>;\n    }\n  };\n\n  // Get processing time estimate\n  const getProcessingEstimate = (estimate?: ProcessingEstimate) => {\n    if (!estimate) return 'Calculating...';\n    if (estimate.displayText) return estimate.displayText;\n\n    const estimatedTime = estimate.estimatedSeconds || 0;\n    if (estimatedTime < 60) {\n      return `${Math.round(estimatedTime)}s`;\n    }\n    const minutes = Math.floor(estimatedTime / 60);\n    const seconds = Math.round(estimatedTime % 60);\n    return `${minutes}m ${seconds}s`;\n  };\n\n  return (\n    <div className={cn(\"space-y-6\", className)}>\n      {/* Upload Area */}\n      <Card \n        {...getRootProps()} \n        className={cn(\n          \"border-2 border-dashed rounded-xl p-8 text-center transition-all duration-200 cursor-pointer hover:border-primary/50\",\n          isDragActive ? \"border-primary bg-primary/5 scale-[1.02]\" : \"border-gray-300 dark:border-gray-600\",\n          files.length > 0 ? \"mt-0\" : \"\"\n        )}\n      >\n        <input {...getInputProps()} />\n        \n        <div className=\"flex flex-col items-center justify-center gap-4\">\n          <motion.div\n            animate={{ scale: isDragActive ? 1.1 : 1 }}\n            transition={{ type: \"spring\", stiffness: 300, damping: 20 }}\n          >\n            <Upload className=\"w-12 h-12 mx-auto text-muted-foreground\" />\n          </motion.div>\n          \n          <div className=\"space-y-2\">\n            <h3 className=\"text-lg font-semibold\">\n              Drop files here or click to browse\n            </h3>\n            <p className=\"text-sm text-muted-foreground\">\n              Support for images, videos, audio, PDFs, and more. Max file size: 200MB.\n            </p>\n          </div>\n          \n          <Button \n            type=\"button\" \n            variant=\"outline\" \n            className=\"mt-2\"\n            onClick={(e) => {\n              e.stopPropagation();\n              if (fileInputRef.current) {\n                fileInputRef.current.click();\n              }\n            }}\n          >\n            Browse Files\n          </Button>\n        </div>\n      </Card>\n\n      {/* Tier Information */}\n      {showTierInfo && (\n        <motion.div\n          initial={{ opacity: 0, y: 10 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"bg-gradient-to-r from-blue-500/10 to-purple-500/10 dark:from-blue-500/5 dark:to-purple-500/5 p-4 rounded-lg border border-blue-200/30 dark:border-blue-800/30\"\n        >\n          <div className=\"flex items-start gap-3\">\n            <Star className=\"w-5 h-5 text-yellow-500 mt-0.5 flex-shrink-0\" />\n            <div>\n              <h4 className=\"font-medium text-foreground\">Current Tier: {tier.toUpperCase()}</h4>\n              <p className=\"text-sm text-muted-foreground mt-1\">\n                {tier === 'free' && 'Extract up to 50 metadata fields'}\n                {tier === 'starter' && 'Extract up to 200 metadata fields'}\n                {tier === 'pro' && 'Extract up to 7,000+ metadata fields including MakerNotes, IPTC, XMP'}\n                {tier === 'super' && 'Extract all 15,000+ metadata fields with advanced analysis'}\n              </p>\n            </div>\n          </div>\n        </motion.div>\n      )}\n\n      {/* File List */}\n      <AnimatePresence>\n        {files.length > 0 && (\n          <motion.div\n            initial={{ opacity: 0, height: 0 }}\n            animate={{ opacity: 1, height: 'auto' }}\n            exit={{ opacity: 0, height: 0 }}\n            className=\"space-y-4\"\n          >\n            <div className=\"flex justify-between items-center\">\n              <h3 className=\"text-lg font-medium\">\n                Files ({files.length}/{maxFiles})\n              </h3>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={clearAllFiles}\n                className=\"text-destructive hover:text-destructive\"\n              >\n                Clear All\n              </Button>\n            </div>\n\n            <div className=\"grid gap-4\">\n              {files.map((fileState) => (\n                <motion.div\n                  key={fileState.id}\n                  layout\n                  initial={{ opacity: 0, y: 20 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  exit={{ opacity: 0, y: -20 }}\n                  className=\"border rounded-lg p-4 bg-background\"\n                >\n                  <div className=\"flex items-center justify-between gap-4\">\n                    <div className=\"flex items-center gap-3 flex-1 min-w-0\">\n                      <div className=\"text-primary\">\n                        {getFileIcon(fileState.file)}\n                      </div>\n                      \n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-center gap-2\">\n                          <p className=\"font-medium truncate\">{fileState.file.name}</p>\n                          {fileState.analysis && fileState.analysis.warnings && fileState.analysis.warnings.length > 0 && (\n                            <Tooltip>\n                              <TooltipTrigger>\n                                <AlertCircle className=\"w-4 h-4 text-yellow-500\" />\n                              </TooltipTrigger>\n                              <TooltipContent>\n                                <p>{fileState.analysis.warnings.join(', ')}</p>\n                              </TooltipContent>\n                            </Tooltip>\n                          )}\n                        </div>\n                        \n                        <div className=\"flex items-center gap-4 mt-1 text-sm text-muted-foreground\">\n                          <span>{(fileState.file.size / 1024 / 1024).toFixed(2)} MB</span>\n                          <span>{fileState.file.type || 'Unknown type'}</span>\n                          {fileState.estimate && (\n                            <div className=\"flex items-center gap-1\">\n                              <Clock className=\"w-3 h-3\" />\n                              <span>{getProcessingEstimate(fileState.estimate)}</span>\n                            </div>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                    \n                    <div className=\"flex items-center gap-3\">\n                      {getStatusBadge(fileState.status)}\n                      \n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={() => removeFile(fileState.id)}\n                        className=\"text-destructive hover:text-destructive\"\n                      >\n                        <X className=\"w-4 h-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                  \n                  {(fileState.status === 'uploading' || fileState.status === 'processing') && (\n                    <div className=\"mt-3\">\n                      <div className=\"flex justify-between text-sm mb-1\">\n                        <span>\n                          {fileState.status === 'uploading' ? 'Uploading...' : 'Processing...'}\n                        </span>\n                        <span>{fileState.progress}%</span>\n                      </div>\n                      <Progress value={fileState.progress} className=\"h-2\" />\n                    </div>\n                  )}\n                  \n                  {fileState.status === 'complete' && fileState.result && (\n                    <div className=\"mt-3 p-3 bg-green-50 dark:bg-green-950/20 rounded-md\">\n                      <div className=\"flex items-center gap-2 text-green-700 dark:text-green-300\">\n                        <CheckCircle2 className=\"w-4 h-4\" />\n                        <span className=\"font-medium\">\n                          {fileState.result.fields} metadata fields extracted\n                        </span>\n                      </div>\n                    </div>\n                  )}\n                  \n                  {fileState.analysis && fileState.analysis.suggestions && fileState.analysis.suggestions.length > 0 && (\n                    <div className=\"mt-2 text-xs text-blue-600 dark:text-blue-400\">\n                      <p>Suggestions: {fileState.analysis.suggestions.join(', ')}</p>\n                    </div>\n                  )}\n                </motion.div>\n              ))}\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Submit Button */}\n      {files.length > 0 && (\n        <motion.div\n          initial={{ opacity: 0, y: 10 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"flex flex-col sm:flex-row gap-3 pt-4\"\n        >\n          <Button\n            onClick={handleSubmit}\n            disabled={isSubmitting || files.some(f => f.status !== 'pending')}\n            className=\"flex-1 relative\"\n          >\n            {isSubmitting ? (\n              <>\n                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                Processing...\n              </>\n            ) : (\n              <>\n                <Sparkles className=\"mr-2 h-4 w-4\" />\n                Extract Metadata\n              </>\n            )}\n            \n            {advanced && (\n              <Badge variant=\"secondary\" className=\"ml-2\">\n                Advanced Mode\n              </Badge>\n            )}\n          </Button>\n          \n          <Button\n            variant=\"outline\"\n            onClick={clearAllFiles}\n            disabled={isSubmitting}\n          >\n            Cancel\n          </Button>\n        </motion.div>\n      )}\n\n      {/* Empty State Tips */}\n      {files.length === 0 && (\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mt-8\"\n        >\n          <div className=\"p-4 bg-muted/50 rounded-lg border\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <Trophy className=\"w-5 h-5 text-amber-500\" />\n              <h4 className=\"font-medium\">Best Results</h4>\n            </div>\n            <p className=\"text-sm text-muted-foreground\">\n              Upload original files without compression for maximum metadata extraction.\n            </p>\n          </div>\n          \n          <div className=\"p-4 bg-muted/50 rounded-lg border\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <Info className=\"w-5 h-5 text-blue-500\" />\n              <h4 className=\"font-medium\">Supported Formats</h4>\n            </div>\n            <p className=\"text-sm text-muted-foreground\">\n              JPG, PNG, TIFF, MP4, MOV, MP3, PDF, and 50+ other formats.\n            </p>\n          </div>\n          \n          <div className=\"p-4 bg-muted/50 rounded-lg border\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <Zap className=\"w-5 h-5 text-purple-500\" />\n              <h4 className=\"font-medium\">Fast Processing</h4>\n            </div>\n            <p className=\"text-sm text-muted-foreground\">\n              Most files process in under 30 seconds with our optimized engines.\n            </p>\n          </div>\n        </motion.div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/enhanced-upload-zone.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1130,1133],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1130,1133],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1351,1354],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1351,1354],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":407,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":407,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9181,9184],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9181,9184],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":410,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":410,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9307,9310],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9307,9310],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":452,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":452,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10703,10706],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10703,10706],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":551,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":551,"endColumn":20,"suggestions":[{"fix":{"range":[13485,13547],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":623,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":623,"endColumn":18,"suggestions":[{"fix":{"range":[15568,15623],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":625,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":625,"endColumn":20,"suggestions":[{"fix":{"range":[15651,15712],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":628,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":628,"endColumn":20,"suggestions":[{"fix":{"range":[15814,15940],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":642,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":642,"endColumn":20,"suggestions":[{"fix":{"range":[16218,16260],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useCallback, useRef } from 'react';\nimport { useDropzone } from 'react-dropzone';\nimport { useNavigate } from 'react-router-dom';\nimport { Button } from '@/components/ui/button';\nimport { Progress } from '@/components/ui/progress';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport {\n  Upload,\n  File,\n  Image,\n  Video,\n  Music,\n  FileText,\n  X,\n  CheckCircle2,\n  AlertCircle,\n  Loader2,\n  Zap,\n  Clock,\n  Timer,\n} from 'lucide-react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { cn } from '@/lib/utils';\nimport { useToast } from '@/hooks/use-toast';\nimport { validateUploadFile } from '@/lib/upload-guards';\nimport { analyzeFile, type FileAnalysis } from '@/utils/fileAnalysis';\nimport {\n  estimateProcessingTime,\n  type ProcessingEstimate,\n} from '@/utils/processingEstimates';\n\ninterface FileState {\n  file: File;\n  id: string;\n  preview?: string;\n  status: 'pending' | 'uploading' | 'processing' | 'complete' | 'error';\n  progress: number;\n  result?: any;\n  error?: string;\n  analysis?: FileAnalysis; // File type analysis with warnings/suggestions\n  estimate?: ProcessingEstimate; // Processing time estimate\n}\n\ninterface EnhancedUploadZoneProps {\n  onResults: (results: any[]) => void;\n  tier: string;\n  maxFiles?: number;\n  className?: string;\n  advanced?: boolean;\n  useV2?: boolean; // New prop to enable V2 navigation\n}\n\nconst ACCEPTED_TYPES = {\n  // Standard media types\n  'image/*': [\n    '.jpg',\n    '.jpeg',\n    '.png',\n    '.gif',\n    '.webp',\n    '.tiff',\n    '.tif',\n    '.bmp',\n    '.heic',\n    '.heif',\n    '.svg',\n    '.psd',\n  ],\n  'video/*': [\n    '.mp4',\n    '.mov',\n    '.avi',\n    '.mkv',\n    '.webm',\n    '.m4v',\n    '.3gp',\n    '.flv',\n    '.wmv',\n    '.asf',\n    '.rm',\n    '.rmvb',\n  ],\n  'audio/*': [\n    '.mp3',\n    '.flac',\n    '.wav',\n    '.ogg',\n    '.m4a',\n    '.aac',\n    '.aiff',\n    '.opus',\n    '.wma',\n    '.ac3',\n    '.dts',\n  ],\n\n  // Documents\n  'application/pdf': ['.pdf'],\n  'application/msword': ['.doc'],\n  'application/vnd.openxmlformats-officedocument.wordprocessingml.document': [\n    '.docx',\n  ],\n  'application/vnd.ms-excel': ['.xls'],\n  'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': [\n    '.xlsx',\n  ],\n  'application/vnd.ms-powerpoint': ['.ppt'],\n  'application/vnd.openxmlformats-officedocument.presentationml.presentation': [\n    '.pptx',\n  ],\n  'text/plain': ['.txt', '.md'],\n  'text/csv': ['.csv'],\n  'text/html': ['.html', '.htm'],\n  'application/xml': ['.xml'],\n  'application/json': ['.json'],\n\n  // Medical imaging\n  'application/dicom': ['.dcm', '.dicom'],\n\n  // Astronomical data\n  'application/fits': ['.fits', '.fit', '.fts'],\n\n  // Scientific data\n  'application/x-hdf': ['.h5', '.hdf5', '.he5'],\n  'application/x-netcdf': ['.nc', '.netcdf', '.nc4'],\n\n  // Geospatial\n  'application/x-shapefile': ['.shp'],\n\n  // Emerging technology formats\n  'application/x-ai-model': [\n    '.ai',\n    '.ml',\n    '.model',\n    '.h5',\n    '.pb',\n    '.onnx',\n    '.tflite',\n    '.pt',\n    '.pth',\n    '.ckpt',\n    '.pkl',\n    '.joblib',\n  ],\n  'application/x-blockchain': [\n    '.blockchain',\n    '.chain',\n    '.ledger',\n    '.crypto',\n    '.nft',\n    '.token',\n  ],\n  'application/x-ar-vr': [\n    '.ar',\n    '.vr',\n    '.xr',\n    '.gltf',\n    '.glb',\n    '.usdz',\n    '.reality',\n  ],\n  'application/x-iot': ['.iot', '.device', '.sensor'],\n  'application/x-quantum': ['.quantum', '.qasm', '.qisk', '.cirq', '.qubit'],\n  'application/x-neural': ['.neural', '.nn', '.dl'],\n  'application/x-robotics': ['.robot', '.urdf', '.sdf', '.xacro'],\n  'application/x-biotech': ['.bio', '.dna', '.rna', '.protein', '.genome'],\n  'application/x-nano': ['.nano'],\n  'application/x-space': ['.space', '.satellite', '.tle'],\n  'application/x-renewable': ['.renewable', '.grid'],\n  'application/x-autonomous': ['.autonomous', '.vehicle'],\n  'application/x-telecom': ['.telecom', '.5g', '.6g'],\n  'application/x-security': ['.security', '.encrypt'],\n  'application/x-digital-twin': ['.digital', '.twin', '.sim'],\n\n  // Archive formats\n  'application/zip': ['.zip'],\n  'application/x-tar': ['.tar', '.tar.gz', '.tgz'],\n  'application/x-rar-compressed': ['.rar'],\n  'application/x-7z-compressed': ['.7z'],\n};\n\nconst CORE_ALLOWED_MIMES = [\n  'image/jpeg',\n  'image/jpg',\n  'image/png',\n  'image/gif',\n  'image/webp',\n  'image/tiff',\n  'image/bmp',\n  'image/heic',\n  'image/heif',\n  'image/svg+xml',\n  'video/mp4',\n  'video/quicktime',\n  'video/x-msvideo',\n  'video/x-matroska',\n  'video/webm',\n  'video/x-ms-wmv',\n  'video/x-flv',\n  'video/3gpp',\n  'audio/mpeg',\n  'audio/flac',\n  'audio/wav',\n  'audio/ogg',\n  'audio/mp4',\n  'audio/aac',\n  'audio/x-aiff',\n  'application/pdf',\n  'application/msword',\n  'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n  'application/vnd.ms-excel',\n  'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n  'application/vnd.ms-powerpoint',\n  'application/vnd.openxmlformats-officedocument.presentationml.presentation',\n  'text/plain',\n  'text/markdown',\n  'text/html',\n  'application/xml',\n  'application/json',\n  'text/csv',\n];\nconst CORE_ALLOWED_EXTENSIONS = Array.from(\n  new Set(Object.values(ACCEPTED_TYPES).flat())\n);\n\nconst getFileIcon = (file?: File) => {\n  const name = file?.name ? String(file.name) : '';\n  const ext = name ? name.toLowerCase().split('.').pop() : '';\n\n  if (file?.type?.startsWith('image/') || ['.psd'].includes(`.${ext}`))\n    return Image;\n  if (file?.type?.startsWith('video/')) return Video;\n  if (file?.type?.startsWith('audio/')) return Music;\n  if (file?.type === 'application/pdf' || ext === 'pdf') return FileText;\n\n  // Medical/Scientific\n  if (\n    [\n      '.dcm',\n      '.dicom',\n      '.fits',\n      '.fit',\n      '.fts',\n      '.h5',\n      '.hdf5',\n      '.he5',\n      '.nc',\n      '.netcdf',\n      '.nc4',\n    ].includes(`.${ext}`)\n  ) {\n    return FileText; // Could use a specialized icon\n  }\n\n  // Emerging tech\n  if (\n    [\n      '.ai',\n      '.ml',\n      '.model',\n      '.blockchain',\n      '.ar',\n      '.vr',\n      '.iot',\n      '.quantum',\n      '.neural',\n      '.robot',\n      '.bio',\n      '.nano',\n      '.space',\n    ].includes(`.${ext}`)\n  ) {\n    return Zap; // Tech icon for emerging formats\n  }\n\n  // Documents\n  if (\n    [\n      '.doc',\n      '.docx',\n      '.xls',\n      '.xlsx',\n      '.ppt',\n      '.pptx',\n      '.txt',\n      '.md',\n      '.html',\n      '.xml',\n      '.json',\n    ].includes(`.${ext}`)\n  ) {\n    return FileText;\n  }\n\n  return File;\n};\n\nconst getFileTypeColor = (file?: File) => {\n  const name = file?.name ? String(file.name) : '';\n  const ext = name ? name.toLowerCase().split('.').pop() : '';\n\n  if (file?.type?.startsWith('image/') || ['.psd'].includes(`.${ext}`))\n    return 'bg-blue-500/10 text-blue-600 border-blue-200';\n  if (file?.type?.startsWith('video/'))\n    return 'bg-purple-500/10 text-purple-600 border-purple-200';\n  if (file?.type?.startsWith('audio/'))\n    return 'bg-green-500/10 text-green-600 border-green-200';\n  if (file?.type === 'application/pdf' || ext === 'pdf')\n    return 'bg-red-500/10 text-red-600 border-red-200';\n\n  // Medical/Scientific - cyan\n  if (\n    [\n      '.dcm',\n      '.dicom',\n      '.fits',\n      '.fit',\n      '.fts',\n      '.h5',\n      '.hdf5',\n      '.he5',\n      '.nc',\n      '.netcdf',\n      '.nc4',\n      '.shp',\n    ].includes(`.${ext}`)\n  ) {\n    return 'bg-cyan-500/10 text-cyan-600 border-cyan-200';\n  }\n\n  // Emerging tech - orange\n  if (\n    [\n      '.ai',\n      '.ml',\n      '.model',\n      '.blockchain',\n      '.ar',\n      '.vr',\n      '.iot',\n      '.quantum',\n      '.neural',\n      '.robot',\n      '.bio',\n      '.nano',\n      '.space',\n      '.renewable',\n      '.autonomous',\n      '.telecom',\n      '.security',\n      '.digital',\n      '.twin',\n    ].includes(`.${ext}`)\n  ) {\n    return 'bg-orange-500/10 text-orange-600 border-orange-200';\n  }\n\n  // Documents - indigo\n  if (\n    [\n      '.doc',\n      '.docx',\n      '.xls',\n      '.xlsx',\n      '.ppt',\n      '.pptx',\n      '.txt',\n      '.md',\n      '.html',\n      '.xml',\n      '.json',\n      '.csv',\n    ].includes(`.${ext}`)\n  ) {\n    return 'bg-indigo-500/10 text-indigo-600 border-indigo-200';\n  }\n\n  return 'bg-gray-500/10 text-gray-600 border-gray-200';\n};\n\nconst formatFileSize = (bytes: number) => {\n  if (bytes === 0) return '0 B';\n  const k = 1024;\n  const sizes = ['B', 'KB', 'MB', 'GB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];\n};\n\nexport function EnhancedUploadZone({\n  onResults,\n  tier,\n  maxFiles = 10,\n  className,\n  advanced = false,\n  useV2 = false,\n}: EnhancedUploadZoneProps) {\n  const navigate = useNavigate();\n  const [files, setFiles] = useState<FileState[]>([]);\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [dragActive, setDragActive] = useState(false);\n  const { toast } = useToast();\n  const abortControllerRef = useRef<AbortController | null>(null);\n\n  const onDrop = useCallback(\n    async (acceptedFiles: File[], rejectedFiles: any[]) => {\n      // Handle rejected files\n      rejectedFiles.forEach(({ file, errors }) => {\n        errors.forEach((error: any) => {\n          toast({\n            title: 'File rejected',\n            description: `${file.name}: ${error.message}`,\n            variant: 'destructive',\n          });\n        });\n      });\n\n      const maxBytes =\n        tier === 'enterprise' || tier === 'super'\n          ? 2000 * 1024 * 1024\n          : tier === 'forensic' || tier === 'premium'\n            ? 500 * 1024 * 1024\n            : tier === 'professional' || tier === 'starter'\n              ? 100 * 1024 * 1024\n              : 10 * 1024 * 1024;\n      const guardConfig = {\n        maxBytes,\n        allowedMimes: CORE_ALLOWED_MIMES,\n        allowedExtensions: CORE_ALLOWED_EXTENSIONS,\n      };\n\n      const preflightPassed: File[] = [];\n      acceptedFiles.forEach(file => {\n        const guard = validateUploadFile(file, guardConfig);\n        if (!guard.ok) {\n          toast({\n            title: 'Upload blocked',\n            description: guard.message || 'Unsupported file.',\n            variant: 'destructive',\n          });\n          return;\n        }\n        preflightPassed.push(file);\n      });\n\n      // Add accepted files with analysis and estimates\n      const newFilesPromises = preflightPassed.map(async file => {\n        // Run analysis and estimation in parallel\n        const [analysis, estimate] = await Promise.all([\n          analyzeFile(file),\n          Promise.resolve(estimateProcessingTime(file, tier as any)), // Sync but wrapped for consistency\n        ]);\n\n        return {\n          file,\n          id: crypto.randomUUID(),\n          status: 'pending' as const,\n          progress: 0,\n          preview: file.type.startsWith('image/')\n            ? URL.createObjectURL(file)\n            : undefined,\n          analysis,\n          estimate,\n        };\n      });\n\n      const newFiles = await Promise.all(newFilesPromises);\n      setFiles(prev => [...prev, ...newFiles].slice(0, maxFiles));\n    },\n    [maxFiles, toast, tier]\n  );\n\n  const { getRootProps, getInputProps, isDragActive } = useDropzone({\n    onDrop,\n    accept: ACCEPTED_TYPES,\n    maxFiles,\n    maxSize:\n      tier === 'enterprise' || tier === 'super'\n        ? 2000 * 1024 * 1024\n        : tier === 'forensic' || tier === 'premium'\n          ? 500 * 1024 * 1024\n          : tier === 'professional' || tier === 'starter'\n            ? 100 * 1024 * 1024\n            : 10 * 1024 * 1024,\n    onDragEnter: () => setDragActive(true),\n    onDragLeave: () => setDragActive(false),\n    onDropAccepted: () => setDragActive(false),\n    onDropRejected: () => setDragActive(false),\n  });\n\n  const removeFile = (fileId: string) => {\n    setFiles(prev => {\n      const fileState = prev.find(f => f.id === fileId);\n      if (fileState?.preview) {\n        URL.revokeObjectURL(fileState.preview);\n      }\n      return prev.filter(f => f.id !== fileId);\n    });\n  };\n\n  const processFiles = async () => {\n    if (files.length === 0) return;\n\n    setIsProcessing(true);\n    abortControllerRef.current = new AbortController();\n\n    try {\n      const results = [];\n\n      if (files.length === 1) {\n        // Single file processing\n        const fileState = files[0];\n        setFiles(prev =>\n          prev.map(f =>\n            f.id === fileState.id\n              ? { ...f, status: 'uploading', progress: 0 }\n              : f\n          )\n        );\n\n        const formData = new FormData();\n        formData.append('file', fileState.file);\n        if (fileState.file.lastModified) {\n          formData.append(\n            'client_last_modified',\n            String(fileState.file.lastModified)\n          );\n        }\n\n        const endpoint = advanced ? '/api/extract/advanced' : '/api/extract';\n        const response = await fetch(`${endpoint}?tier=${tier}`, {\n          method: 'POST',\n          body: formData,\n          signal: abortControllerRef.current.signal,\n        });\n\n        if (!response.ok) {\n          throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n        }\n\n        setFiles(prev =>\n          prev.map(f =>\n            f.id === fileState.id\n              ? { ...f, status: 'processing', progress: 50 }\n              : f\n          )\n        );\n\n        const result = await response.json();\n        console.log('[EnhancedUploadZone] extracted result:', result);\n\n        setFiles(prev =>\n          prev.map(f =>\n            f.id === fileState.id\n              ? {\n                  ...f,\n                  status: 'complete',\n                  progress: 100,\n                  result,\n                }\n              : f\n          )\n        );\n\n        results.push(result);\n\n        // V2 Navigation: Navigate immediately for single file\n        if (useV2) {\n          navigate('/images_mvp/results', { state: { metadata: result } });\n        }\n      } else {\n        // Batch processing\n        const formData = new FormData();\n        files.forEach(fileState => {\n          formData.append('files', fileState.file);\n          if (fileState.file.lastModified) {\n            formData.append(\n              'client_last_modified',\n              String(fileState.file.lastModified)\n            );\n          }\n        });\n\n        setFiles(prev =>\n          prev.map(f => ({ ...f, status: 'uploading', progress: 0 }))\n        );\n\n        const response = await fetch(`/api/extract/batch?tier=${tier}`, {\n          method: 'POST',\n          body: formData,\n          signal: abortControllerRef.current.signal,\n        });\n\n        if (!response.ok) {\n          throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n        }\n\n        setFiles(prev =>\n          prev.map(f => ({ ...f, status: 'processing', progress: 50 }))\n        );\n\n        const batchResult = await response.json();\n\n        // Update individual file statuses\n        setFiles(prev =>\n          prev.map(fileState => {\n            const result = batchResult.results[fileState.file.name];\n            return {\n              ...fileState,\n              status: result ? 'complete' : 'error',\n              progress: 100,\n              result,\n              error: result ? undefined : 'Processing failed',\n            };\n          })\n        );\n\n        results.push(...Object.values(batchResult.results));\n      }\n\n      // V2 Navigation: Navigate to V2 results page instead of calling onResults\n      console.log('[EnhancedUploadZone] useV2 flag:', useV2);\n      if (useV2) {\n        console.log('[EnhancedUploadZone] Navigating to V2 results');\n        navigate('/images_mvp/results', { state: { metadata: results[0] } });\n      } else {\n        console.log(\n          '[EnhancedUploadZone] Calling onResults with',\n          results.length,\n          'results'\n        );\n        // Pass single result object, not array\n        onResults(results);\n      }\n\n      toast({\n        title: 'Processing complete',\n        description: `Successfully processed ${results.length} file${results.length > 1 ? 's' : ''}`,\n      });\n    } catch (error) {\n      console.error('Processing error:', error);\n\n      setFiles(prev =>\n        prev.map(f => ({\n          ...f,\n          status: 'error',\n          progress: 0,\n          error: error instanceof Error ? error.message : 'Processing failed',\n        }))\n      );\n\n      toast({\n        title: 'Processing failed',\n        description:\n          error instanceof Error ? error.message : 'Unknown error occurred',\n        variant: 'destructive',\n      });\n    } finally {\n      setIsProcessing(false);\n      abortControllerRef.current = null;\n    }\n  };\n\n  const cancelProcessing = () => {\n    if (abortControllerRef.current) {\n      abortControllerRef.current.abort();\n      setIsProcessing(false);\n      setFiles(prev =>\n        prev.map(f => ({ ...f, status: 'pending', progress: 0 }))\n      );\n      toast({\n        title: 'Processing cancelled',\n        description: 'File processing has been cancelled',\n      });\n    }\n  };\n\n  const clearAll = () => {\n    files.forEach(fileState => {\n      if (fileState.preview) {\n        URL.revokeObjectURL(fileState.preview);\n      }\n    });\n    setFiles([]);\n  };\n\n  return (\n    <div className={cn('space-y-4', className)}>\n      {/* Drop Zone */}\n      <Card\n        className={cn(\n          'border-2 border-dashed transition-all duration-200',\n          dragActive || isDragActive\n            ? 'border-primary bg-primary/5 scale-[1.02]'\n            : 'border-muted-foreground/25 hover:border-muted-foreground/50'\n        )}\n      >\n        <CardContent className=\"p-8\">\n          <div\n            {...getRootProps()}\n            className=\"text-center cursor-pointer\"\n            role=\"button\"\n            aria-label=\"Upload files for metadata extraction\"\n            tabIndex={0}\n          >\n            <input {...getInputProps()} />\n\n            <motion.div\n              animate={{\n                scale: dragActive ? 1.1 : 1,\n                rotate: dragActive ? 5 : 0,\n              }}\n              className=\"mx-auto mb-4 w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center\"\n              aria-hidden=\"true\"\n            >\n              <Upload\n                className={cn(\n                  'w-8 h-8 transition-colors',\n                  dragActive ? 'text-primary' : 'text-muted-foreground'\n                )}\n              />\n            </motion.div>\n\n            <h3 className=\"text-lg font-semibold mb-2\">\n              {dragActive ? 'Drop files here' : 'Upload files for analysis'}\n            </h3>\n\n            <p className=\"text-muted-foreground mb-4\">\n              Drag & drop files or click to browse  Supports 500+ file formats\n            </p>\n\n            <div className=\"flex flex-wrap justify-center gap-2 mb-4\">\n              <Badge variant=\"outline\" className=\"text-xs\">\n                Images\n              </Badge>\n              <Badge variant=\"outline\" className=\"text-xs\">\n                Video\n              </Badge>\n              <Badge variant=\"outline\" className=\"text-xs\">\n                Audio\n              </Badge>\n              <Badge variant=\"outline\" className=\"text-xs\">\n                Documents\n              </Badge>\n              <Badge variant=\"outline\" className=\"text-xs\">\n                Medical\n              </Badge>\n              <Badge variant=\"outline\" className=\"text-xs\">\n                Scientific\n              </Badge>\n              <Badge variant=\"outline\" className=\"text-xs\">\n                AI/ML\n              </Badge>\n              <Badge variant=\"outline\" className=\"text-xs\">\n                Blockchain\n              </Badge>\n              <Badge variant=\"outline\" className=\"text-xs\">\n                AR/VR\n              </Badge>\n              <Badge variant=\"outline\" className=\"text-xs\">\n                IoT\n              </Badge>\n              <Badge variant=\"outline\" className=\"text-xs\">\n                +More\n              </Badge>\n            </div>\n\n            <p className=\"text-xs text-muted-foreground\">\n              Max {maxFiles} files  Up to{' '}\n              {tier === 'enterprise' || tier === 'super'\n                ? '2GB'\n                : tier === 'forensic' || tier === 'premium'\n                  ? '500MB'\n                  : tier === 'professional' || tier === 'starter'\n                    ? '100MB'\n                    : '10MB'}{' '}\n              per file\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* File List */}\n      <AnimatePresence>\n        {files.length > 0 && (\n          <motion.div\n            initial={{ opacity: 0, height: 0 }}\n            animate={{ opacity: 1, height: 'auto' }}\n            exit={{ opacity: 0, height: 0 }}\n            className=\"space-y-2\"\n          >\n            <div className=\"flex items-center justify-between\">\n              <h4 className=\"font-medium\">Files ({files.length})</h4>\n              <div className=\"flex gap-2\">\n                {!isProcessing && files.length > 0 && (\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={clearAll}\n                    aria-label=\"Clear all files from upload list\"\n                  >\n                    Clear All\n                  </Button>\n                )}\n                {isProcessing && (\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={cancelProcessing}\n                    aria-label=\"Cancel file processing\"\n                  >\n                    Cancel\n                  </Button>\n                )}\n              </div>\n            </div>\n\n            <div className=\"space-y-2 max-h-64 overflow-y-auto\">\n              {files.map(fileState => {\n                const FileTypeIcon = getFileIcon(fileState.file);\n\n                return (\n                  <motion.div\n                    key={fileState.id}\n                    initial={{ opacity: 0, x: -20 }}\n                    animate={{ opacity: 1, x: 0 }}\n                    exit={{ opacity: 0, x: 20 }}\n                    className=\"flex items-center gap-3 p-3 border rounded-lg bg-card\"\n                  >\n                    {/* File Icon/Preview */}\n                    <div className=\"flex-shrink-0\">\n                      {fileState.preview ? (\n                        <img\n                          src={fileState.preview}\n                          alt={fileState.file.name}\n                          className=\"w-10 h-10 object-cover rounded\"\n                        />\n                      ) : (\n                        <div\n                          className={cn(\n                            'w-10 h-10 rounded flex items-center justify-center border',\n                            getFileTypeColor(fileState.file)\n                          )}\n                        >\n                          <FileTypeIcon className=\"w-5 h-5\" />\n                        </div>\n                      )}\n                    </div>\n\n                    {/* File Info */}\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center gap-2\">\n                        <p className=\"font-medium truncate\">\n                          {fileState.file.name}\n                        </p>\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          {formatFileSize(fileState.file.size)}\n                        </Badge>\n                        {fileState.estimate &&\n                          fileState.status === 'pending' && (\n                            <Badge\n                              variant=\"secondary\"\n                              className=\"text-xs flex items-center gap-1\"\n                            >\n                              <Timer className=\"w-3 h-3\" />\n                              {fileState.estimate.displayText}\n                            </Badge>\n                          )}\n                      </div>\n\n                      {/* Progress Bar */}\n                      <div className=\"mt-2\">\n                        <Progress value={fileState.progress} className=\"h-1\" />\n                        <div className=\"flex items-center gap-2 mt-1\">\n                          {fileState.status === 'pending' && (\n                            <>\n                              <Clock className=\"w-3 h-3 text-slate-300\" />\n                              <span className=\"text-xs text-muted-foreground\">\n                                Ready\n                              </span>\n                            </>\n                          )}\n                          {fileState.status === 'uploading' && (\n                            <>\n                              <Upload className=\"w-3 h-3 text-blue-500\" />\n                              <span className=\"text-xs text-muted-foreground\">\n                                Uploading...\n                              </span>\n                            </>\n                          )}\n                          {fileState.status === 'processing' && (\n                            <>\n                              <Loader2 className=\"w-3 h-3 text-yellow-500 animate-spin\" />\n                              <span className=\"text-xs text-muted-foreground\">\n                                Processing...\n                              </span>\n                            </>\n                          )}\n                          {fileState.status === 'complete' && (\n                            <>\n                              <CheckCircle2 className=\"w-3 h-3 text-green-500\" />\n                              <span className=\"text-xs text-green-600\">\n                                Complete\n                              </span>\n                            </>\n                          )}\n                          {fileState.status === 'error' && (\n                            <>\n                              <AlertCircle className=\"w-3 h-3 text-red-500\" />\n                              <span className=\"text-xs text-red-600\">\n                                {fileState.error || 'Error'}\n                              </span>\n                            </>\n                          )}\n                        </div>\n                      </div>\n\n                      {/* File Analysis Warnings/Suggestions */}\n                      {fileState.analysis &&\n                        (fileState.analysis.warnings.length > 0 ||\n                          fileState.analysis.suggestions.length > 0) && (\n                          <div className=\"mt-3 space-y-2\">\n                            {fileState.analysis.warnings.map((warning, idx) => (\n                              <Alert\n                                key={`warn-${idx}`}\n                                variant=\"destructive\"\n                                className=\"py-2\"\n                              >\n                                <AlertDescription className=\"text-xs\">\n                                  {warning}\n                                </AlertDescription>\n                              </Alert>\n                            ))}\n                            {fileState.analysis.suggestions.map(\n                              (suggestion, idx) => (\n                                <Alert\n                                  key={`sug-${idx}`}\n                                  className=\"py-2 border-blue-200 bg-blue-50 dark:bg-blue-950/20\"\n                                >\n                                  <AlertDescription className=\"text-xs text-blue-900 dark:text-blue-100\">\n                                    {suggestion}\n                                  </AlertDescription>\n                                </Alert>\n                              )\n                            )}\n                          </div>\n                        )}\n                    </div>\n\n                    {/* Actions */}\n                    <div className=\"flex-shrink-0\">\n                      {!isProcessing && (\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => removeFile(fileState.id)}\n                          className=\"h-8 w-8 p-0\"\n                          aria-label={`Remove ${fileState.file.name}`}\n                        >\n                          <X className=\"w-4 h-4\" aria-hidden=\"true\" />\n                        </Button>\n                      )}\n                    </div>\n                  </motion.div>\n                );\n              })}\n            </div>\n\n            {/* Process Button */}\n            {files.length > 0 &&\n              !isProcessing &&\n              files.some(f => f.status === 'pending') && (\n                <motion.div\n                  initial={{ opacity: 0, y: 20 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  className=\"pt-4\"\n                >\n                  <Button\n                    onClick={processFiles}\n                    className=\"w-full\"\n                    size=\"lg\"\n                    aria-label={`Extract metadata from ${files.filter(f => f.status === 'pending').length} files`}\n                  >\n                    <Zap className=\"w-4 h-4 mr-2\" aria-hidden=\"true\" />\n                    Extract Metadata (\n                    {files.filter(f => f.status === 'pending').length} files)\n                  </Button>\n                </motion.div>\n              )}\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/error-boundary.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":69,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":69,"endColumn":20,"suggestions":[{"fix":{"range":[1832,1898],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":324,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":324,"endColumn":22,"suggestions":[{"fix":{"range":[9921,9972],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":345,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":345,"endColumn":22,"suggestions":[{"fix":{"range":[10481,10530],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":367,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":367,"endColumn":24,"suggestions":[{"fix":{"range":[11127,11166],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":395,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":395,"endColumn":16,"suggestions":[{"fix":{"range":[11944,11986],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Error Boundary Components\n * \n * Provides graceful error handling and recovery for React components.\n */\n\nimport React, { Component, ErrorInfo, ReactNode } from 'react';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport {\n  AlertTriangle,\n  RefreshCw,\n  Bug,\n  FileX,\n  Wifi,\n  Server\n} from 'lucide-react';\n\n// ============================================================================\n// Types\n// ============================================================================\n\ninterface ErrorBoundaryState {\n  hasError: boolean;\n  error: Error | null;\n  errorInfo: ErrorInfo | null;\n  errorId: string;\n}\n\ninterface ErrorBoundaryProps {\n  children: ReactNode;\n  fallback?: ReactNode;\n  onError?: (error: Error, errorInfo: ErrorInfo) => void;\n  level?: 'page' | 'section' | 'component';\n}\n\n// ============================================================================\n// Main Error Boundary\n// ============================================================================\n\nexport class ErrorBoundary extends Component<ErrorBoundaryProps, ErrorBoundaryState> {\n  constructor(props: ErrorBoundaryProps) {\n    super(props);\n    this.state = {\n      hasError: false,\n      error: null,\n      errorInfo: null,\n      errorId: '',\n    };\n  }\n\n  static getDerivedStateFromError(error: Error): Partial<ErrorBoundaryState> {\n    return {\n      hasError: true,\n      error,\n      errorId: `error_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n    };\n  }\n\n  componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n    this.setState({\n      error,\n      errorInfo,\n    });\n\n    // Log error to console in development\n    if (process.env.NODE_ENV === 'development') {\n      console.error('ErrorBoundary caught an error:', error, errorInfo);\n    }\n\n    // Call custom error handler\n    this.props.onError?.(error, errorInfo);\n\n    // In production, you might want to send this to an error reporting service\n    // reportError(error, errorInfo, this.state.errorId);\n  }\n\n  handleRetry = () => {\n    this.setState({\n      hasError: false,\n      error: null,\n      errorInfo: null,\n      errorId: '',\n    });\n  };\n\n  render() {\n    if (this.state.hasError) {\n      if (this.props.fallback) {\n        return this.props.fallback;\n      }\n\n      return (\n        <ErrorDisplay\n          error={this.state.error}\n          errorInfo={this.state.errorInfo}\n          errorId={this.state.errorId}\n          level={this.props.level || 'component'}\n          onRetry={this.handleRetry}\n        />\n      );\n    }\n\n    return this.props.children;\n  }\n}\n\n// ============================================================================\n// Error Display Component\n// ============================================================================\n\ninterface ErrorDisplayProps {\n  error: Error | null;\n  errorInfo: ErrorInfo | null;\n  errorId: string;\n  level: 'page' | 'section' | 'component';\n  onRetry: () => void;\n}\n\nfunction ErrorDisplay({ error, errorInfo: _errorInfo, errorId, level, onRetry }: ErrorDisplayProps) {\n  const getErrorType = (error: Error | null) => {\n    if (!error) return 'unknown';\n    \n    const message = error.message.toLowerCase();\n    if (message.includes('network') || message.includes('fetch')) return 'network';\n    if (message.includes('chunk') || message.includes('loading')) return 'loading';\n    if (message.includes('permission') || message.includes('unauthorized')) return 'permission';\n    if (message.includes('not found') || message.includes('404')) return 'notfound';\n    return 'runtime';\n  };\n\n  const errorType = getErrorType(error);\n\n  const getErrorIcon = () => {\n    switch (errorType) {\n      case 'network':\n        return <Wifi className=\"h-6 w-6\" />;\n      case 'loading':\n        return <Server className=\"h-6 w-6\" />;\n      case 'permission':\n        return <FileX className=\"h-6 w-6\" />;\n      case 'notfound':\n        return <FileX className=\"h-6 w-6\" />;\n      default:\n        return <Bug className=\"h-6 w-6\" />;\n    }\n  };\n\n  const getErrorTitle = () => {\n    switch (errorType) {\n      case 'network':\n        return 'Network Error';\n      case 'loading':\n        return 'Loading Error';\n      case 'permission':\n        return 'Permission Error';\n      case 'notfound':\n        return 'Resource Not Found';\n      default:\n        return 'Something went wrong';\n    }\n  };\n\n  const getErrorMessage = () => {\n    switch (errorType) {\n      case 'network':\n        return 'Unable to connect to the server. Please check your internet connection and try again.';\n      case 'loading':\n        return 'Failed to load the required resources. This might be a temporary issue.';\n      case 'permission':\n        return 'You don\\'t have permission to access this resource.';\n      case 'notfound':\n        return 'The requested resource could not be found.';\n      default:\n        return 'An unexpected error occurred while processing your request.';\n    }\n  };\n\n  const getSuggestions = () => {\n    switch (errorType) {\n      case 'network':\n        return [\n          'Check your internet connection',\n          'Try refreshing the page',\n          'Contact support if the problem persists'\n        ];\n      case 'loading':\n        return [\n          'Try refreshing the page',\n          'Clear your browser cache',\n          'Try again in a few minutes'\n        ];\n      case 'permission':\n        return [\n          'Make sure you\\'re logged in',\n          'Contact an administrator for access',\n          'Try logging out and back in'\n        ];\n      default:\n        return [\n          'Try refreshing the page',\n          'Report this issue if it continues',\n          'Try using a different browser'\n        ];\n    }\n  };\n\n  if (level === 'page') {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background p-4\">\n        <Card className=\"w-full max-w-md\">\n          <CardHeader className=\"text-center\">\n            <div className=\"flex justify-center mb-4 text-destructive\">\n              {getErrorIcon()}\n            </div>\n            <CardTitle className=\"text-xl\">{getErrorTitle()}</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <p className=\"text-muted-foreground text-center\">\n              {getErrorMessage()}\n            </p>\n            \n            <div className=\"space-y-2\">\n              <h4 className=\"font-medium text-sm\">Try these steps:</h4>\n              <ul className=\"text-sm text-muted-foreground space-y-1\">\n                {getSuggestions().map((suggestion, index) => (\n                  <li key={index} className=\"flex items-start gap-2\">\n                    <span className=\"text-primary\"></span>\n                    {suggestion}\n                  </li>\n                ))}\n              </ul>\n            </div>\n            \n            <div className=\"flex gap-2\">\n              <Button onClick={onRetry} className=\"flex-1\">\n                <RefreshCw className=\"h-4 w-4 mr-2\" />\n                Try Again\n              </Button>\n              <Button \n                variant=\"outline\" \n                onClick={() => window.location.reload()}\n                className=\"flex-1\"\n              >\n                Refresh Page\n              </Button>\n            </div>\n            \n            {process.env.NODE_ENV === 'development' && error && (\n              <details className=\"mt-4\">\n                <summary className=\"cursor-pointer text-sm font-medium\">\n                  Technical Details\n                </summary>\n                <div className=\"mt-2 p-3 bg-muted rounded text-xs font-mono\">\n                  <div className=\"mb-2\">\n                    <strong>Error ID:</strong> {errorId}\n                  </div>\n                  <div className=\"mb-2\">\n                    <strong>Error:</strong> {error.message}\n                  </div>\n                  {error.stack && (\n                    <div>\n                      <strong>Stack:</strong>\n                      <pre className=\"mt-1 whitespace-pre-wrap\">{error.stack}</pre>\n                    </div>\n                  )}\n                </div>\n              </details>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (level === 'section') {\n    return (\n      <Alert className=\"my-4\">\n        <AlertTriangle className=\"h-4 w-4\" />\n        <AlertDescription>\n          <div className=\"space-y-2\">\n            <div className=\"font-medium\">{getErrorTitle()}</div>\n            <div className=\"text-sm\">{getErrorMessage()}</div>\n            <Button size=\"sm\" onClick={onRetry} className=\"mt-2\">\n              <RefreshCw className=\"h-3 w-3 mr-1\" />\n              Retry\n            </Button>\n          </div>\n        </AlertDescription>\n      </Alert>\n    );\n  }\n\n  // Component level\n  return (\n    <div className=\"p-4 border border-destructive/20 rounded-lg bg-destructive/5\">\n      <div className=\"flex items-start gap-3\">\n        <div className=\"text-destructive mt-0.5\">\n          <AlertTriangle className=\"h-4 w-4\" />\n        </div>\n        <div className=\"flex-1 space-y-2\">\n          <div className=\"font-medium text-sm\">{getErrorTitle()}</div>\n          <div className=\"text-xs text-muted-foreground\">{getErrorMessage()}</div>\n          <Button size=\"sm\" variant=\"outline\" onClick={onRetry}>\n            <RefreshCw className=\"h-3 w-3 mr-1\" />\n            Retry\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// ============================================================================\n// Specialized Error Boundaries\n// ============================================================================\n\nexport function MetadataErrorBoundary({ children }: { children: ReactNode }) {\n  return (\n    <ErrorBoundary\n      level=\"section\"\n      onError={(error, _errorInfo) => {\n        console.error('Metadata processing error:', error);\n      }}\n      fallback={\n        <Alert>\n          <AlertTriangle className=\"h-4 w-4\" />\n          <AlertDescription>\n            Unable to display metadata. The file may be corrupted or in an unsupported format.\n          </AlertDescription>\n        </Alert>\n      }\n    >\n      {children}\n    </ErrorBoundary>\n  );\n}\n\nexport function AdvancedAnalysisErrorBoundary({ children }: { children: ReactNode }) {\n  return (\n    <ErrorBoundary\n      level=\"section\"\n      onError={(error, _errorInfo) => {\n        console.error('Advanced analysis error:', error);\n      }}\n      fallback={\n        <Alert>\n          <AlertTriangle className=\"h-4 w-4\" />\n          <AlertDescription>\n            Advanced analysis features are temporarily unavailable. Basic metadata is still accessible.\n          </AlertDescription>\n        </Alert>\n      }\n    >\n      {children}\n    </ErrorBoundary>\n  );\n}\n\nexport function NetworkErrorBoundary({ children }: { children: ReactNode }) {\n  return (\n    <ErrorBoundary\n      level=\"component\"\n      onError={(error, _errorInfo) => {\n        if (error.message.includes('fetch') || error.message.includes('network')) {\n          console.error('Network error:', error);\n        }\n      }}\n    >\n      {children}\n    </ErrorBoundary>\n  );\n}\n\n// ============================================================================\n// Error Reporting Utilities\n// ============================================================================\n\nexport function reportError(error: Error, errorInfo: ErrorInfo, errorId: string) {\n  // In a real application, you would send this to your error reporting service\n  // Example: Sentry, LogRocket, Bugsnag, etc.\n  \n  const errorReport = {\n    errorId,\n    message: error.message,\n    stack: error.stack,\n    componentStack: errorInfo.componentStack,\n    timestamp: new Date().toISOString(),\n    userAgent: navigator.userAgent,\n    url: window.location.href,\n  };\n  \n  if (process.env.NODE_ENV === 'development') {\n    console.log('Error report:', errorReport);\n  } else {\n    // Send to error reporting service\n    // fetch('/api/errors', {\n    //   method: 'POST',\n    //   headers: { 'Content-Type': 'application/json' },\n    //   body: JSON.stringify(errorReport)\n    // });\n  }\n}\n\n// ============================================================================\n// HOC for Error Boundaries\n// ============================================================================\n\nexport function withErrorBoundary<P extends object>(\n  Component: React.ComponentType<P>,\n  errorBoundaryProps?: Partial<ErrorBoundaryProps>\n) {\n  const WrappedComponent = (props: P) => (\n    <ErrorBoundary {...errorBoundaryProps}>\n      <Component {...props} />\n    </ErrorBoundary>\n  );\n  \n  WrappedComponent.displayName = `withErrorBoundary(${Component.displayName || Component.name})`;\n  \n  return WrappedComponent;\n}","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/error-display.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/extraction-progress-tracker.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1358,1361],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1358,1361],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Extraction Progress Tracker Component\n * Real-time progress updates during metadata extraction\n */\n\nimport React from 'react';\n\n/**\n * DEPRECATED: ExtractionProgressTracker\n *\n * This implementation has been temporarily disabled in favor of the\n * images-mvp specific `ProgressTracker` component located at:\n * `client/src/components/images-mvp/progress-tracker.tsx`.\n *\n * Reason: Using both components caused duplicate progress UIs in the\n * Images MVP flow. To avoid regressions while we consolidate the\n * logic, this component now exports a no-op placeholder that returns\n * `null` and logs a deprecation warning. Keep the file for future\n * refactor and re-implementation if needed.\n */\n/**\n * Deprecated and removed\n *\n * ExtractionProgressTracker was intentionally removed and replaced by\n * `client/src/components/images-mvp/progress-tracker.tsx`. This file no\n * longer exports a React component to avoid accidental imports and the\n * duplicate progress UI issue. Keep this file as documentation of the\n * previous implementation; do not import `ExtractionProgressTracker`.\n */\n\n// NOTE: QualityIndicators and helpers remain available in this file if\n// needed in future, but the ExtractionProgressTracker component has been\n// removed on purpose.\n\n// Quality Indicators Component\nexport function QualityIndicators({ metadata }: { metadata: any }) {\n  const getQualityScore = () => {\n    if (!metadata) return 0;\n\n    let score = 100;\n\n    // Deduct for missing critical fields\n    if (!metadata.gps) score -= 10;\n    if (!metadata.exif || Object.keys(metadata.exif).length < 5) score -= 15;\n    if (!metadata.iptc) score -= 5;\n    if (!metadata.xmp) score -= 5;\n\n    // Award for comprehensive data\n    if (metadata.ai_quality_assessment) score += 5;\n    if (metadata.perceptual_hashes) score += 5;\n    if (metadata.specialized_modules) score += 10;\n\n    return Math.min(100, Math.max(0, score));\n  };\n\n  const getQualityLevel = (score: number) => {\n    if (score >= 90) return { level: 'Excellent', color: 'green' };\n    if (score >= 70) return { level: 'Good', color: 'blue' };\n    if (score >= 50) return { level: 'Fair', color: 'yellow' };\n    return { level: 'Poor', color: 'red' };\n  };\n\n  const score = getQualityScore();\n  const { level, color } = getQualityLevel(score);\n\n  return (\n    <div className=\"flex items-center gap-4\">\n      <div className=\"text-center\">\n        <div className={`text-3xl font-bold text-${color}-600`}>{score}</div>\n        <div className=\"text-xs text-gray-500\">Quality Score</div>\n      </div>\n      <div\n        className={`px-3 py-1 rounded-full bg-${color}-100 text-${color}-800 text-sm font-medium`}\n      >\n        {level}\n      </div>\n      <div className=\"flex-1\">\n        <div className=\"flex gap-2 text-xs\">\n          <QualityBadge present={!!metadata.gps} label=\"GPS\" />\n          <QualityBadge present={!!metadata.exif} label=\"EXIF\" />\n          <QualityBadge present={!!metadata.iptc} label=\"IPTC\" />\n          <QualityBadge present={!!metadata.xmp} label=\"XMP\" />\n          <QualityBadge present={!!metadata.ai_quality_assessment} label=\"AI\" />\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction QualityBadge({ present, label }: { present: boolean; label: string }) {\n  return (\n    <span\n      className={`px-2 py-1 rounded ${\n        present ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-400'\n      }`}\n    >\n      {label}\n    </span>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/forensic-report.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[696,699],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[696,699],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1051,1054],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1051,1054],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":220,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":220,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6725,6728],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6725,6728],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":236,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":236,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7202,7205],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7202,7205],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { \n  FileText, \n  Shield, \n  AlertTriangle, \n  CheckCircle, \n  XCircle,\n  Download,\n  Printer,\n  Share,\n  Calendar,\n  User,\n  Scale,\n  Eye,\n  TrendingDown,\n  TrendingUp\n} from 'lucide-react';\nimport jsPDF from 'jspdf';\nimport 'jspdf-autotable';\n\ninterface FileAnalysis {\n  file_name: string;\n  file_size: number;\n  metadata: any;\n  forensic_findings: string[];\n  authenticity_score: number;\n  risk_level: 'low' | 'medium' | 'high';\n}\n\ninterface ForensicReportData {\n  report_id: string;\n  generated_at: string;\n  analyst: string;\n  case_summary: {\n    total_files: number;\n    file_names: string[];\n    analysis_scope: string;\n  };\n  files: FileAnalysis[];\n  cross_file_analysis: any;\n  conclusions: {\n    overall_assessment: 'low' | 'medium' | 'high';\n    files_analyzed: number;\n    high_risk_files: number;\n    medium_risk_files: number;\n    average_authenticity_score: number;\n  };\n  recommendations: string[];\n  processing_time_ms: number;\n}\n\ninterface ForensicReportProps {\n  reportData: ForensicReportData;\n}\n\nexport function ForensicReport({ reportData }: ForensicReportProps) {\n  const [selectedTab, setSelectedTab] = useState('summary');\n\n  const getRiskColor = (riskLevel: string) => {\n    switch (riskLevel) {\n      case 'low':\n        return 'text-green-700 bg-green-100 border-green-300';\n      case 'medium':\n        return 'text-yellow-700 bg-yellow-100 border-yellow-300';\n      case 'high':\n        return 'text-red-700 bg-red-100 border-red-300';\n      default:\n        return 'text-gray-700 bg-gray-100 border-gray-300';\n    }\n  };\n\n  const getRiskIcon = (riskLevel: string) => {\n    switch (riskLevel) {\n      case 'low':\n        return <CheckCircle className=\"h-4 w-4 text-green-600\" />;\n      case 'medium':\n        return <AlertTriangle className=\"h-4 w-4 text-yellow-600\" />;\n      case 'high':\n        return <XCircle className=\"h-4 w-4 text-red-600\" />;\n      default:\n        return <Shield className=\"h-4 w-4 text-gray-600\" />;\n    }\n  };\n\n  const getScoreColor = (score: number) => {\n    if (score >= 80) return 'text-green-600';\n    if (score >= 50) return 'text-yellow-600';\n    return 'text-red-600';\n  };\n\n  const exportReport = (format: 'json' | 'pdf') => {\n    if (format === 'json') {\n      const blob = new Blob([JSON.stringify(reportData, null, 2)], { \n        type: 'application/json' \n      });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `forensic-report-${reportData.report_id}.json`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n    } else {\n      generatePDFReport();\n    }\n  };\n\n  const generatePDFReport = () => {\n    const doc = new jsPDF();\n    const pageWidth = doc.internal.pageSize.width;\n    const pageHeight = doc.internal.pageSize.height;\n    let yPosition = 20;\n\n    // Helper function to add text with word wrapping\n    const addWrappedText = (text: string, x: number, y: number, maxWidth: number, fontSize: number = 10) => {\n      doc.setFontSize(fontSize);\n      const lines = doc.splitTextToSize(text, maxWidth);\n      doc.text(lines, x, y);\n      return y + (lines.length * fontSize * 0.4);\n    };\n\n    // Helper function to check if we need a new page\n    const checkNewPage = (requiredSpace: number) => {\n      if (yPosition + requiredSpace > pageHeight - 20) {\n        doc.addPage();\n        yPosition = 20;\n      }\n    };\n\n    // Title\n    doc.setFontSize(20);\n    doc.setFont('helvetica', 'bold');\n    doc.text('FORENSIC ANALYSIS REPORT', pageWidth / 2, yPosition, { align: 'center' });\n    yPosition += 15;\n\n    // Report Info\n    doc.setFontSize(12);\n    doc.setFont('helvetica', 'normal');\n    doc.text(`Report ID: ${reportData.report_id}`, 20, yPosition);\n    yPosition += 8;\n    doc.text(`Generated: ${new Date(reportData.generated_at).toLocaleString()}`, 20, yPosition);\n    yPosition += 8;\n    doc.text(`Analyst: ${reportData.analyst}`, 20, yPosition);\n    yPosition += 15;\n\n    // Case Summary\n    doc.setFontSize(14);\n    doc.setFont('helvetica', 'bold');\n    doc.text('CASE SUMMARY', 20, yPosition);\n    yPosition += 10;\n\n    doc.setFontSize(10);\n    doc.setFont('helvetica', 'normal');\n    doc.text(`Total Files Analyzed: ${reportData.case_summary.total_files}`, 20, yPosition);\n    yPosition += 8;\n    yPosition = addWrappedText(`Analysis Scope: ${reportData.case_summary.analysis_scope}`, 20, yPosition, pageWidth - 40);\n    yPosition += 10;\n\n    // File List\n    checkNewPage(60);\n    doc.setFontSize(12);\n    doc.setFont('helvetica', 'bold');\n    doc.text('FILES ANALYZED', 20, yPosition);\n    yPosition += 10;\n\n    doc.setFontSize(9);\n    reportData.case_summary.file_names.forEach((fileName, index) => {\n      if (yPosition > pageHeight - 30) {\n        doc.addPage();\n        yPosition = 20;\n      }\n      doc.text(`${index + 1}. ${fileName}`, 25, yPosition);\n      yPosition += 6;\n    });\n    yPosition += 10;\n\n    // Conclusions\n    checkNewPage(80);\n    doc.setFontSize(14);\n    doc.setFont('helvetica', 'bold');\n    doc.text('CONCLUSIONS', 20, yPosition);\n    yPosition += 10;\n\n    doc.setFontSize(10);\n    doc.setFont('helvetica', 'normal');\n    const assessmentText = `Overall Assessment: ${reportData.conclusions.overall_assessment.toUpperCase()}`;\n    doc.text(assessmentText, 20, yPosition);\n    yPosition += 8;\n\n    doc.text(`Files Analyzed: ${reportData.conclusions.files_analyzed}`, 20, yPosition);\n    yPosition += 6;\n    doc.text(`High Risk Files: ${reportData.conclusions.high_risk_files}`, 20, yPosition);\n    yPosition += 6;\n    doc.text(`Medium Risk Files: ${reportData.conclusions.medium_risk_files}`, 20, yPosition);\n    yPosition += 6;\n    doc.text(`Average Authenticity Score: ${reportData.conclusions.average_authenticity_score.toFixed(1)}%`, 20, yPosition);\n    yPosition += 15;\n\n    // File Analysis Table\n    checkNewPage(100);\n    doc.setFontSize(12);\n    doc.setFont('helvetica', 'bold');\n    doc.text('DETAILED FILE ANALYSIS', 20, yPosition);\n    yPosition += 10;\n\n    const tableData = reportData.files.map(file => [\n      file.file_name,\n      `${(file.file_size / 1024).toFixed(1)} KB`,\n      file.authenticity_score.toFixed(1) + '%',\n      file.risk_level.toUpperCase(),\n      file.forensic_findings.length > 0 ? file.forensic_findings.join('; ') : 'None'\n    ]);\n\n    (doc as any).autoTable({\n      startY: yPosition,\n      head: [['File Name', 'Size', 'Authenticity', 'Risk Level', 'Findings']],\n      body: tableData,\n      theme: 'grid',\n      styles: { fontSize: 8 },\n      headStyles: { fillColor: [41, 128, 185], textColor: 255 },\n      columnStyles: {\n        0: { cellWidth: 40 },\n        1: { cellWidth: 20 },\n        2: { cellWidth: 25 },\n        3: { cellWidth: 25 },\n        4: { cellWidth: 'auto' }\n      }\n    });\n\n    yPosition = (doc as any).lastAutoTable.finalY + 15;\n\n    // Recommendations\n    if (reportData.recommendations && reportData.recommendations.length > 0) {\n      checkNewPage(60);\n      doc.setFontSize(12);\n      doc.setFont('helvetica', 'bold');\n      doc.text('RECOMMENDATIONS', 20, yPosition);\n      yPosition += 10;\n\n      doc.setFontSize(9);\n      doc.setFont('helvetica', 'normal');\n      reportData.recommendations.forEach((rec, index) => {\n        checkNewPage(10);\n        yPosition = addWrappedText(`${index + 1}. ${rec}`, 20, yPosition, pageWidth - 40, 9);\n        yPosition += 3;\n      });\n    }\n\n    // Footer\n    const totalPages = doc.getNumberOfPages();\n    for (let i = 1; i <= totalPages; i++) {\n      doc.setPage(i);\n      doc.setFontSize(8);\n      doc.setFont('helvetica', 'italic');\n      doc.text(`Generated by MetaExtract Forensic Suite - Page ${i} of ${totalPages}`, pageWidth / 2, pageHeight - 10, { align: 'center' });\n    }\n\n    // Save the PDF\n    doc.save(`forensic-report-${reportData.report_id}.pdf`);\n  };\n\n  const printReport = () => {\n    window.print();\n  };\n\n  const shareReport = () => {\n    if (navigator.share) {\n      navigator.share({\n        title: `Forensic Analysis Report - ${reportData.report_id}`,\n        text: `Forensic analysis completed for ${reportData.case_summary.total_files} files`,\n        url: window.location.href\n      });\n    } else {\n      navigator.clipboard.writeText(window.location.href);\n      alert('Report URL copied to clipboard');\n    }\n  };\n\n  return (\n    <div className=\"space-y-6 print:space-y-4\">\n      {/* Report Header */}\n      <Card className=\"border-blue-200 bg-blue-50 print:bg-white print:border-gray-300\">\n        <CardHeader>\n          <div className=\"flex items-center justify-between print:block\">\n            <div>\n              <CardTitle className=\"flex items-center gap-2 text-blue-900 print:text-black\">\n                <Scale className=\"h-6 w-6\" />\n                Forensic Analysis Report\n              </CardTitle>\n              <div className=\"text-sm text-blue-700 print:text-gray-600 mt-2\">\n                Report ID: {reportData.report_id}\n              </div>\n            </div>\n            <div className=\"flex gap-2 print:hidden\">\n              <Button onClick={() => exportReport('json')} variant=\"outline\" size=\"sm\">\n                <Download className=\"h-4 w-4 mr-2\" />\n                JSON\n              </Button>\n              <Button onClick={() => exportReport('pdf')} variant=\"outline\" size=\"sm\">\n                <FileText className=\"h-4 w-4 mr-2\" />\n                PDF\n              </Button>\n              <Button onClick={printReport} variant=\"outline\" size=\"sm\">\n                <Printer className=\"h-4 w-4 mr-2\" />\n                Print\n              </Button>\n              <Button onClick={shareReport} variant=\"outline\" size=\"sm\">\n                <Share className=\"h-4 w-4 mr-2\" />\n                Share\n              </Button>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 print:grid-cols-4\">\n            <div className=\"text-center\">\n              <div className=\"flex items-center justify-center gap-1 mb-1\">\n                <Calendar className=\"h-4 w-4 text-blue-600\" />\n                <span className=\"text-sm font-medium\">Generated</span>\n              </div>\n              <div className=\"text-sm\">\n                {new Date(reportData.generated_at).toLocaleDateString()}\n              </div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"flex items-center justify-center gap-1 mb-1\">\n                <User className=\"h-4 w-4 text-blue-600\" />\n                <span className=\"text-sm font-medium\">Analyst</span>\n              </div>\n              <div className=\"text-sm\">{reportData.analyst}</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"flex items-center justify-center gap-1 mb-1\">\n                <FileText className=\"h-4 w-4 text-blue-600\" />\n                <span className=\"text-sm font-medium\">Files</span>\n              </div>\n              <div className=\"text-sm\">{reportData.case_summary.total_files}</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"flex items-center justify-center gap-1 mb-1\">\n                <Shield className=\"h-4 w-4 text-blue-600\" />\n                <span className=\"text-sm font-medium\">Scope</span>\n              </div>\n              <div className=\"text-sm\">Comprehensive</div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Executive Summary */}\n      <Card className=\"print:break-inside-avoid\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <TrendingUp className=\"h-5 w-5\" />\n            Executive Summary\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6\">\n            <div className=\"text-center p-4 rounded-lg border\">\n              <div className={`text-3xl font-bold ${getRiskColor(reportData.conclusions.overall_assessment).split(' ')[0]}`}>\n                {reportData.conclusions.overall_assessment.toUpperCase()}\n              </div>\n              <div className=\"text-sm text-gray-600 mt-1\">Overall Risk Assessment</div>\n            </div>\n            <div className=\"text-center p-4 rounded-lg border\">\n              <div className={`text-3xl font-bold ${getScoreColor(reportData.conclusions.average_authenticity_score)}`}>\n                {reportData.conclusions.average_authenticity_score.toFixed(0)}%\n              </div>\n              <div className=\"text-sm text-gray-600 mt-1\">Average Authenticity Score</div>\n            </div>\n            <div className=\"text-center p-4 rounded-lg border\">\n              <div className=\"text-3xl font-bold text-red-600\">\n                {reportData.conclusions.high_risk_files}\n              </div>\n              <div className=\"text-sm text-gray-600 mt-1\">High Risk Files</div>\n            </div>\n          </div>\n\n          <div className=\"prose max-w-none\">\n            <p className=\"text-gray-700\">\n              This forensic analysis examined {reportData.conclusions.files_analyzed} digital files \n              using advanced metadata extraction and authenticity verification techniques. \n              The analysis identified {reportData.conclusions.high_risk_files} high-risk files \n              and {reportData.conclusions.medium_risk_files} medium-risk files requiring further investigation.\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Main Content Tabs */}\n      <Tabs value={selectedTab} onValueChange={setSelectedTab} className=\"print:hidden\">\n        <TabsList className=\"grid w-full grid-cols-4\">\n          <TabsTrigger value=\"summary\">Summary</TabsTrigger>\n          <TabsTrigger value=\"files\">File Analysis</TabsTrigger>\n          <TabsTrigger value=\"findings\">Key Findings</TabsTrigger>\n          <TabsTrigger value=\"recommendations\">Recommendations</TabsTrigger>\n        </TabsList>\n\n        {/* Summary Tab */}\n        <TabsContent value=\"summary\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Case Information</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <h4 className=\"font-medium mb-2\">Analysis Scope</h4>\n                  <p className=\"text-sm text-gray-600\">{reportData.case_summary.analysis_scope}</p>\n                </div>\n                <div>\n                  <h4 className=\"font-medium mb-2\">Processing Time</h4>\n                  <p className=\"text-sm text-gray-600\">\n                    {(reportData.processing_time_ms / 1000).toFixed(1)} seconds\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"mt-4\">\n                <h4 className=\"font-medium mb-2\">Files Analyzed</h4>\n                <div className=\"flex flex-wrap gap-2\">\n                  {reportData.case_summary.file_names.map((fileName, index) => (\n                    <Badge key={index} variant=\"outline\" className=\"text-xs\">\n                      {fileName}\n                    </Badge>\n                  ))}\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Risk Distribution</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-3\">\n                {['high', 'medium', 'low'].map(risk => {\n                  const count = reportData.files.filter(f => f.risk_level === risk).length;\n                  const percentage = (count / reportData.files.length) * 100;\n                  \n                  return (\n                    <div key={risk} className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-2\">\n                        {getRiskIcon(risk)}\n                        <span className=\"capitalize font-medium\">{risk} Risk</span>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <div className=\"w-32 bg-gray-200 rounded-full h-2\">\n                          <div \n                            className={`h-2 rounded-full ${getRiskColor(risk).split(' ')[1]}`}\n                            style={{ width: `${percentage}%` }}\n                          ></div>\n                        </div>\n                        <span className=\"text-sm font-medium w-12 text-right\">\n                          {count} ({percentage.toFixed(0)}%)\n                        </span>\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* File Analysis Tab */}\n        <TabsContent value=\"files\" className=\"space-y-4\">\n          {reportData.files.map((file, index) => (\n            <Card key={index} className={getRiskColor(file.risk_level)}>\n              <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle className=\"text-lg flex items-center gap-2\">\n                    {getRiskIcon(file.risk_level)}\n                    {file.file_name}\n                  </CardTitle>\n                  <Badge className={getRiskColor(file.risk_level)}>\n                    {file.risk_level.toUpperCase()} RISK\n                  </Badge>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4\">\n                  <div>\n                    <span className=\"font-medium\">File Size:</span>\n                    <div className=\"text-sm\">{(file.file_size / 1024).toFixed(1)} KB</div>\n                  </div>\n                  <div>\n                    <span className=\"font-medium\">Authenticity Score:</span>\n                    <div className={`text-sm font-bold ${getScoreColor(file.authenticity_score)}`}>\n                      {file.authenticity_score}%\n                    </div>\n                  </div>\n                  <div>\n                    <span className=\"font-medium\">Findings:</span>\n                    <div className=\"text-sm\">{file.forensic_findings.length} issues</div>\n                  </div>\n                </div>\n\n                {file.forensic_findings.length > 0 && (\n                  <div>\n                    <h5 className=\"font-medium mb-2\">Forensic Findings:</h5>\n                    <ul className=\"space-y-1\">\n                      {file.forensic_findings.map((finding, idx) => (\n                        <li key={idx} className=\"flex items-start gap-2 text-sm\">\n                          <AlertTriangle className=\"h-4 w-4 text-red-500 mt-0.5 flex-shrink-0\" />\n                          <span>{finding}</span>\n                        </li>\n                      ))}\n                    </ul>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          ))}\n        </TabsContent>\n\n        {/* Key Findings Tab */}\n        <TabsContent value=\"findings\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Analysis Results</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                <div className=\"p-4 border rounded-lg\">\n                  <h4 className=\"font-medium mb-2 flex items-center gap-2\">\n                    <Eye className=\"h-4 w-4\" />\n                    Authenticity Assessment\n                  </h4>\n                  <p className=\"text-sm text-gray-600\">\n                    Based on comprehensive metadata analysis, steganography detection, \n                    manipulation detection, and AI content analysis across all submitted files.\n                  </p>\n                </div>\n\n                <div className=\"p-4 border rounded-lg\">\n                  <h4 className=\"font-medium mb-2 flex items-center gap-2\">\n                    <Shield className=\"h-4 w-4\" />\n                    Chain of Custody\n                  </h4>\n                  <p className=\"text-sm text-gray-600\">\n                    Temporal analysis of file creation, modification, and access patterns \n                    to establish digital evidence integrity.\n                  </p>\n                </div>\n\n                <div className=\"p-4 border rounded-lg\">\n                  <h4 className=\"font-medium mb-2 flex items-center gap-2\">\n                    <TrendingDown className=\"h-4 w-4\" />\n                    Risk Factors Identified\n                  </h4>\n                  <ul className=\"text-sm text-gray-600 space-y-1\">\n                    {reportData.files.flatMap(f => f.forensic_findings).slice(0, 5).map((finding, idx) => (\n                      <li key={idx}> {finding}</li>\n                    ))}\n                  </ul>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Recommendations Tab */}\n        <TabsContent value=\"recommendations\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Professional Recommendations</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-3\">\n                {reportData.recommendations.map((recommendation, index) => (\n                  <div key={index} className=\"flex items-start gap-3 p-3 border rounded-lg\">\n                    <CheckCircle className=\"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0\" />\n                    <div>\n                      <p className=\"text-sm\">{recommendation}</p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n\n          <Alert>\n            <Scale className=\"h-4 w-4\" />\n            <AlertDescription>\n              <strong>Legal Notice:</strong> This forensic analysis is provided for informational purposes. \n              For legal proceedings, consult with qualified digital forensics experts and legal counsel \n              regarding admissibility and chain of custody requirements.\n            </AlertDescription>\n          </Alert>\n        </TabsContent>\n      </Tabs>\n\n      {/* Print-only Full Report */}\n      <div className=\"hidden print:block space-y-6\">\n        {/* All content would be rendered here for printing */}\n        <div className=\"space-y-4\">\n          <h2 className=\"text-xl font-bold\">File Analysis Details</h2>\n          {reportData.files.map((file, index) => (\n            <div key={index} className=\"border p-4 break-inside-avoid\">\n              <h3 className=\"font-medium mb-2\">{file.file_name}</h3>\n              <div className=\"grid grid-cols-3 gap-4 text-sm mb-2\">\n                <div>Risk Level: {file.risk_level}</div>\n                <div>Authenticity: {file.authenticity_score}%</div>\n                <div>Size: {(file.file_size / 1024).toFixed(1)} KB</div>\n              </div>\n              {file.forensic_findings.length > 0 && (\n                <div>\n                  <strong>Findings:</strong>\n                  <ul className=\"list-disc list-inside text-sm mt-1\">\n                    {file.forensic_findings.map((finding, idx) => (\n                      <li key={idx}>{finding}</li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n            </div>\n          ))}\n        </div>\n\n        <div className=\"space-y-4\">\n          <h2 className=\"text-xl font-bold\">Recommendations</h2>\n          <ul className=\"space-y-2\">\n            {reportData.recommendations.map((rec, index) => (\n              <li key={index} className=\"text-sm\"> {rec}</li>\n            ))}\n          </ul>\n        </div>\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/images-mvp/extraction-header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/images-mvp/pricing-modal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":146,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3985,3988],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3985,3988],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useMemo, useState } from 'react';\nimport { PRICING_TITLE, PRICING_SUBTITLE } from './strings';\nimport {\n  Dialog,\n  DialogContent,\n  DialogTitle,\n  DialogDescription,\n} from '@/components/ui/dialog';\nimport * as VisuallyHidden from '@radix-ui/react-visually-hidden';\nimport { Button } from '@/components/ui/button';\nimport { Loader2, CreditCard } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { useAuth } from '@/lib/auth';\nimport { AuthModal } from '@/components/auth-modal';\n\ninterface PricingModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  defaultEmail?: string;\n}\n\ninterface CreditPack {\n  id: string;\n  credits: number;\n  priceDisplay: string;\n  name: string;\n  description: string;\n}\n\nexport function PricingModal({\n  isOpen,\n  onClose,\n  defaultEmail,\n}: PricingModalProps) {\n  const isLocalhost =\n    typeof window !== 'undefined' &&\n    (window.location.hostname === 'localhost' ||\n      window.location.hostname === '127.0.0.1');\n  const [packs, setPacks] = useState<CreditPack[]>([]);\n  const [loadingPacks, setLoadingPacks] = useState(false);\n  const [purchaseLoading, setPurchaseLoading] = useState<string | null>(null);\n  const [email, setEmail] = useState(defaultEmail || '');\n  const [showAuthModal, setShowAuthModal] = useState(false);\n  const [pendingPackId, setPendingPackId] = useState<string | null>(null);\n  const [pendingCheckoutUrl, setPendingCheckoutUrl] = useState<string | null>(\n    null\n  );\n  const { toast } = useToast();\n  const { isAuthenticated } = useAuth();\n\n  useEffect(() => {\n    setEmail(defaultEmail || '');\n  }, [defaultEmail]);\n\n  useEffect(() => {\n    if (isOpen) setPendingCheckoutUrl(null);\n  }, [isOpen]);\n\n  useEffect(() => {\n    if (!isOpen) return;\n    const loadPacks = async () => {\n      setLoadingPacks(true);\n      try {\n        const res = await fetch('/api/images_mvp/credits/packs');\n        if (!res.ok) {\n          throw new Error('Failed to load packs');\n        }\n        const data = await res.json();\n        const packEntries = Object.entries(data.packs || {}).map(\n          ([id, pack]) => ({ id, ...(pack as Omit<CreditPack, 'id'>) })\n        );\n        setPacks(packEntries);\n      } catch {\n        toast({\n          title: 'Unable to load pricing',\n          description: 'Please try again in a moment.',\n          variant: 'destructive',\n        });\n      } finally {\n        setLoadingPacks(false);\n      }\n    };\n\n    loadPacks();\n  }, [isOpen, toast]);\n\n  const sortedPacks = useMemo(\n    () => [...packs].sort((a, b) => a.credits - b.credits),\n    [packs]\n  );\n\n  const handlePurchase = async (packId: string) => {\n    if (purchaseLoading) return;\n    if (!isAuthenticated) {\n      setPendingPackId(packId);\n      setShowAuthModal(true);\n      return;\n    }\n    setPurchaseLoading(packId);\n    try {\n      const res = await fetch('/api/images_mvp/credits/purchase', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({\n          pack: packId,\n          email: email || undefined,\n        }),\n      });\n\n      const data = await res.json();\n      if (!res.ok) {\n        throw new Error(data?.error || 'Purchase failed');\n      }\n\n      if (!data.checkout_url) {\n        throw new Error('Checkout URL missing');\n      }\n\n      try {\n        localStorage.setItem(\n          'metaextract_images_mvp_purchase_in_progress',\n          String(Date.now())\n        );\n      } catch {\n        // Best-effort only\n      }\n\n      const opened = window.open(\n        data.checkout_url,\n        '_blank',\n        'noopener,noreferrer'\n      );\n      if (!opened) {\n        setPendingCheckoutUrl(data.checkout_url);\n        toast({\n          title: 'Popup blocked',\n          description:\n            'Allow popups for this site, then click Open Checkout.',\n          variant: 'destructive',\n        });\n        return;\n      }\n\n      onClose();\n    } catch (error: any) {\n      toast({\n        title: 'Payment failed',\n        description: error?.message || 'Unable to start checkout.',\n        variant: 'destructive',\n      });\n    } finally {\n      setPurchaseLoading(null);\n    }\n  };\n\n  return (\n    <Dialog\n      open={isOpen}\n      modal={true}\n      onOpenChange={open => {\n        if (!open) onClose();\n      }}\n    >\n      <AuthModal\n        isOpen={showAuthModal}\n        onClose={() => setShowAuthModal(false)}\n        defaultTab=\"login\"\n        onSuccess={() => {\n          setShowAuthModal(false);\n          const packId = pendingPackId;\n          setPendingPackId(null);\n          if (packId) void handlePurchase(packId);\n        }}\n      />\n      <DialogContent\n        className=\"sm:max-w-[520px] p-0 overflow-hidden bg-[#0A0A0A] border border-white/10 shadow-2xl text-white\"\n        onOpenAutoFocus={(event) => {\n          event.preventDefault();\n          setTimeout(() => {\n            const emailInput = document.getElementById('pricing-email');\n            emailInput?.focus();\n          }, 100);\n        }}\n      >\n        <VisuallyHidden.Root>\n          <DialogTitle>Buy Credits</DialogTitle>\n          <DialogDescription>\n            Purchase credits to analyze more images.\n          </DialogDescription>\n        </VisuallyHidden.Root>\n\n        <div className=\"p-6 border-b border-white/10 flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-8 h-8 rounded-full bg-white/10 flex items-center justify-center\">\n              <CreditCard className=\"w-4 h-4 text-primary\" />\n            </div>\n            <div>\n              <div className=\"font-semibold\">{PRICING_TITLE}</div>\n\n              <div className=\"text-xs text-slate-200\">{PRICING_SUBTITLE}</div>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"p-6 space-y-5\">\n        {pendingCheckoutUrl && (\n          <div className=\"rounded-lg border border-white/10 bg-white/5 p-4\">\n            <div className=\"text-sm font-semibold text-white\">\n              Open Checkout\n            </div>\n            <div className=\"text-xs text-slate-300 mt-1\">\n              Your browser blocked the checkout popup. Enable popups, then click\n              below.\n            </div>\n            <div className=\"mt-3 flex gap-2\">\n              <Button\n                className=\"bg-primary text-black hover:bg-primary/90 font-semibold\"\n                onClick={() => {\n                  const opened = window.open(\n                    pendingCheckoutUrl,\n                    '_blank',\n                    'noopener,noreferrer'\n                  );\n                  if (opened) onClose();\n                }}\n              >\n                Open Checkout\n              </Button>\n              <Button\n                variant=\"outline\"\n                className=\"border-white/20 text-slate-200 hover:text-white hover:bg-white/10\"\n                onClick={() => setPendingCheckoutUrl(null)}\n              >\n                Cancel\n              </Button>\n            </div>\n          </div>\n        )}\n        {isLocalhost && (\n          <div className=\"rounded-lg border border-amber-500/20 bg-amber-500/10 p-4\">\n            <div className=\"text-xs text-amber-200\">\n              Local dev uses Dodo test mode. No real money is charged.\n            </div>\n          </div>\n        )}\n        <div className=\"space-y-2\">\n          <label htmlFor=\"pricing-email\" className=\"text-xs font-medium text-slate-200\">\n            Email (optional)\n          </label>\n          <input\n            id=\"pricing-email\"\n            type=\"email\"\n            value={email}\n            onChange={e => setEmail(e.target.value)}\n            placeholder=\"name@example.com\"\n            autoComplete=\"email\"\n            className=\"w-full px-3 py-2 bg-[#1A1A1A] border border-white/10 rounded-md text-sm text-white focus:ring-1 focus:ring-primary outline-none transition-all placeholder:text-slate-500\"\n          />\n        </div>\n\n        {loadingPacks ? (\n          <div className=\"flex items-center justify-center py-6\">\n            <Loader2 className=\"w-5 h-5 animate-spin text-primary\" />\n          </div>\n        ) : (\n          <div className=\"grid gap-4\">\n            {sortedPacks.map(pack => (\n              <div\n                key={pack.id}\n                className=\"border border-white/10 rounded-lg p-4 flex items-center justify-between gap-4\"\n              >\n                <div>\n                  <div className=\"text-sm font-semibold text-white\">\n                    {pack.name}\n                  </div>\n                  <div className=\"text-xs text-slate-200\">\n                    {pack.description}\n                  </div>\n                  <div className=\"text-xs text-primary mt-1\">\n                    {pack.credits} credits\n                  </div>\n                </div>\n                <Button\n                  onClick={() => handlePurchase(pack.id)}\n                  disabled={!!purchaseLoading}\n                  className=\"bg-primary text-black hover:bg-primary/90 font-semibold\"\n                >\n                  {purchaseLoading === pack.id ? (\n                    <Loader2 className=\"w-4 h-4 animate-spin\" />\n                  ) : (\n                    pack.priceDisplay\n                  )}\n                </Button>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/images-mvp/progress-bar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/images-mvp/progress-tracker.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":57,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":57,"endColumn":20,"suggestions":[{"fix":{"range":[1783,1825],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":100,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":100,"endColumn":24,"suggestions":[{"fix":{"range":[3341,3396],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":105,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":105,"endColumn":22,"suggestions":[{"fix":{"range":[3457,3498],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":111,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":111,"endColumn":20,"suggestions":[{"fix":{"range":[3654,3703],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":120,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":120,"endColumn":24,"suggestions":[{"fix":{"range":[4124,4185],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":126,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":126,"endColumn":26,"suggestions":[{"fix":{"range":[4370,4419],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":138,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":138,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { motion, useReducedMotion } from 'framer-motion';\nimport { Zap, Clock, CheckCircle } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { ProgressBar } from './progress-bar';\n\ninterface ProgressData {\n  percentage: number;\n  stage: string;\n  eta?: number;\n  quality_metrics?: {\n    confidence_score: number;\n    extraction_completeness: number;\n  };\n}\n\ninterface ProgressTrackerProps {\n  sessionId: string;\n  className?: string;\n  uploadComplete?: boolean;\n  fallbackPercentage?: number;\n  fallbackStage?: string;\n  onConnected?: () => void;\n  onProgressUpdate?: (hasUpdate: boolean) => void;\n}\n\nexport function ProgressTracker({\n  sessionId,\n  className,\n  uploadComplete = false,\n  fallbackPercentage,\n  fallbackStage,\n  onConnected,\n  onProgressUpdate,\n}: ProgressTrackerProps) {\n  const shouldReduceMotion = useReducedMotion();\n  const [progress, setProgress] = useState<ProgressData>({\n    percentage: 0,\n    stage: 'Initializing extraction...',\n  });\n  const [isComplete, setIsComplete] = useState(false);\n  const [wsConnected, setWsConnected] = useState(false);\n  const [hasProgressUpdate, setHasProgressUpdate] = useState(false);\n\n  useEffect(() => {\n    // WebSocket connection for real-time progress updates\n    // Uses Vite proxy with ws: true, no need for hardcoded port\n    const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n    // Try Vite proxy first (uses same host), if it closes before connecting try backend directly (port 3000)\n    let attemptedFallback = false;\n    let ws = new WebSocket(\n      `${wsProtocol}//${window.location.host}/api/images_mvp/progress/${sessionId}`\n    );\n\n    const setupHandlers = (sock: WebSocket) => {\n      sock.onopen = () => {\n        console.log('Progress tracker connected');\n        setWsConnected(true);\n        if (typeof onConnected === 'function') onConnected();\n      };\n\n      sock.onmessage = event => {\n        try {\n          const data = JSON.parse(event.data);\n          if (data.type === 'progress') {\n            setHasProgressUpdate(true);\n            if (typeof onProgressUpdate === 'function') onProgressUpdate(true);\n            setProgress({\n              percentage: data.percentage ?? 0,\n              stage: data.stage,\n              eta: data.estimated_time_remaining,\n              quality_metrics: data.quality_metrics,\n            });\n\n            // Check if extraction is complete\n            if ((data.percentage ?? 0) >= 100) {\n              setIsComplete(true);\n              setTimeout(() => {\n                sock.close();\n              }, 1000);\n            }\n          } else if (data.type === 'complete') {\n            setHasProgressUpdate(true);\n            if (typeof onProgressUpdate === 'function') onProgressUpdate(true);\n            setIsComplete(true);\n            setProgress(prev => ({\n              ...prev,\n              percentage: 100,\n              stage: 'Processing complete',\n            }));\n          } else if (data.type === 'error') {\n            setHasProgressUpdate(true);\n            if (typeof onProgressUpdate === 'function') onProgressUpdate(true);\n            setProgress(prev => ({\n              ...prev,\n              stage: data.error || 'Extraction failed',\n            }));\n          }\n        } catch (error) {\n          console.error('Error parsing progress update:', error);\n        }\n      };\n\n      sock.onerror = error => {\n        console.error('WebSocket error:', error);\n        setWsConnected(false);\n        if (typeof onProgressUpdate === 'function') onProgressUpdate(false);\n      };\n\n      sock.onclose = ev => {\n        console.log('Progress tracker disconnected', ev);\n        setWsConnected(false);\n        if (typeof onProgressUpdate === 'function') onProgressUpdate(false);\n\n        // If the socket closed before opening and we haven't tried fallback, try backend host directly\n        if (!attemptedFallback && ev && ev.code === 1006) {\n          attemptedFallback = true;\n          try {\n            const backendHost = `${wsProtocol}//${window.location.hostname}:3000`;\n            console.log('Attempting fallback WebSocket to', backendHost);\n            ws = new WebSocket(\n              `${backendHost}/api/images_mvp/progress/${sessionId}`\n            );\n            setupHandlers(ws);\n          } catch (err) {\n            console.error('Fallback WebSocket failed:', err);\n          }\n        }\n      };\n    };\n\n    setupHandlers(ws);\n\n    // Cleanup on unmount\n    return () => {\n      try {\n        ws.close();\n      } catch (e) {\n        // ignore\n      }\n    };\n  }, [sessionId]);\n\n  const getStageIcon = (stage: string) => {\n    if (stage.toLowerCase().includes('complete'))\n      return <CheckCircle className=\"w-4 h-4\" />;\n    if (stage.toLowerCase().includes('analyzing'))\n      return <Zap className=\"w-4 h-4\" />;\n    return <Clock className=\"w-4 h-4\" />;\n  };\n\n  const formatStageLabel = (stage: string) => {\n    const normalized = stage.trim().toLowerCase();\n    const mapped = {\n      extraction_start: 'Starting extraction',\n      extraction_complete: 'Finalizing metadata',\n      upload_complete: 'Upload complete',\n      extraction_starting: 'Starting extraction',\n      processing: 'Processing metadata',\n      complete: 'Processing complete',\n    } as Record<string, string>;\n    if (mapped[normalized]) return mapped[normalized];\n    return stage.replace(/_/g, ' ').replace(/\\b\\w/g, c => c.toUpperCase());\n  };\n\n  const effectivePercentage = hasProgressUpdate\n    ? (progress.percentage ?? 0)\n    : (fallbackPercentage ?? progress.percentage ?? 0);\n  const effectiveStage = hasProgressUpdate\n    ? progress.stage\n    : (fallbackStage ?? progress.stage);\n  const showFinalizing = uploadComplete && !hasProgressUpdate && !isComplete;\n  const showConnecting = !wsConnected && !isComplete && !showFinalizing;\n  const isUploadPhase = !hasProgressUpdate && !isComplete;\n  const headline = isComplete\n    ? 'Extraction Complete!'\n    : isUploadPhase\n      ? 'Uploading image...'\n      : 'Extracting Metadata...';\n  const displayStage = formatStageLabel(effectiveStage || 'Processing');\n\n  return (\n    <div>\n      <div\n        className={cn(\n          'w-full space-y-4 p-4 bg-gradient-to-br from-white/10 via-white/5 to-transparent backdrop-blur-sm rounded-lg border border-white/10 shadow-[0_12px_30px_rgba(0,0,0,0.35)]',\n          className\n        )}\n        role=\"status\"\n        aria-live=\"polite\"\n      >\n        {/* Progress Header */}\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center space-x-2\">\n            <motion.div\n              animate={{\n                rotate: isComplete ? 0 : shouldReduceMotion ? 0 : 360,\n              }}\n              transition={{\n                duration: 2,\n                repeat: isComplete ? 0 : Infinity,\n                ease: 'linear',\n                repeatType: 'loop',\n              }}\n              style={{ originX: 0.5, originY: 0.5 }}\n            >\n              {getStageIcon(displayStage)}\n            </motion.div>\n            <span className=\"text-sm font-medium text-slate-200\">\n              {headline}\n            </span>\n          </div>\n          <span className=\"text-sm font-mono text-slate-200\">\n            {effectivePercentage.toFixed(0)}%\n          </span>\n        </div>\n\n        {/* Progress Bar */}\n        <ProgressBar\n          percentage={effectivePercentage}\n          className=\"h-2.5\"\n          tone=\"emerald\"\n        />\n\n        {/* Current Stage */}\n        <div className=\"text-center\">\n          <p className=\"text-sm text-slate-200 mb-1\">{displayStage}</p>\n          {progress.eta && progress.eta > 0 && (\n            <p className=\"text-xs text-slate-300\">\n              Estimated time remaining: {Math.ceil(progress.eta / 1000)}s\n            </p>\n          )}\n        </div>\n\n        {/* Quality Metrics */}\n        {progress.quality_metrics && (\n          <div className=\"grid grid-cols-2 gap-3 pt-3 border-t border-white/10\">\n            <div className=\"text-center\">\n              <div className=\"text-xs text-slate-200 mb-1\">Confidence</div>\n              <div className=\"text-lg font-bold text-green-400\">\n                {(progress.quality_metrics.confidence_score * 100).toFixed(0)}%\n              </div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-xs text-slate-200 mb-1\">Completeness</div>\n              <div className=\"text-lg font-bold text-blue-400\">\n                {(\n                  progress.quality_metrics.extraction_completeness * 100\n                ).toFixed(0)}\n                %\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Connection Status */}\n        {showFinalizing && (\n          <div className=\"flex items-center justify-center space-x-2 text-blue-300 text-xs\">\n            <div className=\"w-2 h-2 bg-blue-300 rounded-full animate-pulse\" />\n            <span>Finalizing upload...</span>\n          </div>\n        )}\n\n        {showConnecting && (\n          <div className=\"flex items-center justify-center space-x-2 text-yellow-400 text-xs\">\n            <div className=\"w-2 h-2 bg-yellow-400 rounded-full animate-pulse\" />\n            <span>Preparing live updates...</span>\n          </div>\n        )}\n\n        {/* Completion Animation */}\n        {isComplete && (\n          <motion.div\n            initial={{ scale: 0 }}\n            animate={{ scale: 1 }}\n            className=\"flex items-center justify-center space-x-2 text-green-400\"\n          >\n            <CheckCircle className=\"w-5 h-5\" />\n            <span className=\"text-sm font-medium\">Ready to view results!</span>\n          </motion.div>\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/images-mvp/quality-indicator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/images-mvp/simple-upload.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":466,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":466,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14698,14701],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14698,14701],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":542,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":542,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17287,17290],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17287,17290],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":543,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":543,"endColumn":20,"suggestions":[{"fix":{"range":[17300,17319],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useCallback, useEffect, useRef } from 'react';\nimport { useNavigate, useSearchParams } from 'react-router-dom';\nimport { Upload, Zap } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { Button } from '@/components/ui/button';\nimport { useToast } from '@/hooks/use-toast';\nimport { PricingModal } from '@/components/images-mvp/pricing-modal';\nimport { ProgressTracker } from '@/components/images-mvp/progress-tracker';\nimport {\n  getFileSizeBucket,\n  getImagesMvpSessionId,\n  trackImagesMvpEvent,\n} from '@/lib/images-mvp-analytics';\nimport {\n  createDefaultQuoteOps,\n  fetchImagesMvpQuote,\n  type ImagesMvpQuoteOps,\n  type ImagesMvpQuoteResponse,\n} from '@/lib/images-mvp-quote';\nimport { useAuth } from '@/lib/auth';\n\nexport function SimpleUploadZone() {\n  const { isAuthenticated } = useAuth();\n  const [isDragActive, setIsDragActive] = useState(false);\n  const [isUploading, setIsUploading] = useState(false);\n  const [uploadError, setUploadError] = useState(false);\n  const [uploadProgress, setUploadProgress] = useState(0);\n  const [pendingFile, setPendingFile] = useState<File | null>(null);\n  const [pendingFileId, setPendingFileId] = useState<string | null>(null);\n  const [pendingDimensions, setPendingDimensions] = useState<{\n    width: number;\n    height: number;\n  } | null>(null);\n  const [showPricingModal, setShowPricingModal] = useState(false);\n  const [paywallShownAt, setPaywallShownAt] = useState<number | null>(null);\n  const [pricingDismissed, setPricingDismissed] = useState(false);\n  const [currentSessionId, setCurrentSessionId] = useState<string>('');\n  const [showProgressTracker, setShowProgressTracker] = useState(false);\n  const [resumeRequested, setResumeRequested] = useState(false);\n  const [isMobile, setIsMobile] = useState(window.innerWidth < 640);\n  const [quoteOps, setQuoteOps] = useState<ImagesMvpQuoteOps>(\n    createDefaultQuoteOps()\n  );\n  const [ocrAutoApplied, setOcrAutoApplied] = useState(false);\n  const [ocrUserOverride, setOcrUserOverride] = useState(false);\n  const [quoteData, setQuoteData] = useState<ImagesMvpQuoteResponse | null>(\n    null\n  );\n  const [quoteLoading, setQuoteLoading] = useState(false);\n  const [quoteError, setQuoteError] = useState<string | null>(null);\n  const inputRef = useRef<HTMLInputElement | null>(null);\n  const openedFromQueryRef = useRef(false);\n  const ocrFromQueryRef = useRef(false);\n  const navigate = useNavigate();\n  const [searchParams, setSearchParams] = useSearchParams();\n  const { toast } = useToast();\n  const maxBytesDisplay =\n    typeof quoteData?.limits?.maxBytes === 'number'\n      ? quoteData.limits.maxBytes\n      : null;\n\n  const getExtension = (name: string): string | null => {\n    const index = name.lastIndexOf('.');\n    if (index <= 0) return null;\n    return name.slice(index).toLowerCase();\n  };\n\n  const looksLikeMapCapture = (name: string): boolean =>\n    /gps|map|location|coords|coordinate|geotag/i.test(name);\n\n  const probeImageDimensions = async (\n    file: File\n  ): Promise<{ width: number; height: number } | null> => {\n    try {\n      const objectUrl = URL.createObjectURL(file);\n      const result = await new Promise<{\n        width: number;\n        height: number;\n      } | null>(resolve => {\n        const img = new Image();\n        img.onload = () => {\n          resolve({ width: img.width, height: img.height });\n          URL.revokeObjectURL(objectUrl);\n        };\n        img.onerror = () => {\n          resolve(null);\n          URL.revokeObjectURL(objectUrl);\n        };\n        img.src = objectUrl;\n      });\n      return result;\n    } catch {\n      return null;\n    }\n  };\n\n  const requestQuote = useCallback(\n    async (\n      file: File,\n      fileId: string,\n      dimensions: { width: number; height: number } | null,\n      ops: ImagesMvpQuoteOps\n    ) => {\n      setQuoteLoading(true);\n      setQuoteError(null);\n      try {\n        const response = await fetchImagesMvpQuote(\n          [\n            {\n              id: fileId,\n              name: file.name,\n              mime: file.type || null,\n              sizeBytes: file.size,\n              width: dimensions?.width ?? null,\n              height: dimensions?.height ?? null,\n            },\n          ],\n          ops\n        );\n        setQuoteData(response);\n        return response;\n      } catch (error) {\n        const message =\n          error instanceof Error ? error.message : 'Failed to get quote';\n        setQuoteError(message);\n        setQuoteData(null);\n        return null;\n      } finally {\n        setQuoteLoading(false);\n      }\n    },\n    []\n  );\n\n  const checkCreditsAndMaybeResume = useCallback(async () => {\n    if (!resumeRequested) return;\n    if (!pendingFile || isUploading) return;\n    try {\n      const res = await fetch('/api/images_mvp/credits/balance', {\n        credentials: 'include',\n      });\n      if (!res.ok) return;\n      const data = await res.json();\n      const credits =\n        typeof data?.credits === 'number' ? (data.credits as number) : 0;\n      if (credits >= 1) {\n        if (!pendingFileId) {\n          toast({\n            title: 'Quote expired',\n            description:\n              'Quote expired or file changed. Re-select the file to refresh.',\n            variant: 'destructive',\n          });\n          return;\n        }\n        const refreshed = await requestQuote(\n          pendingFile,\n          pendingFileId,\n          pendingDimensions,\n          quoteOps\n        );\n        if (!refreshed) {\n          toast({\n            title: 'Quote refresh failed',\n            description:\n              'Please select the file again to generate a fresh quote.',\n            variant: 'destructive',\n          });\n          return;\n        }\n        setShowPricingModal(false);\n        toast({\n          title: 'Credits available',\n          description: 'Ready to analyze. Click Analyze to continue.',\n        });\n      }\n    } catch {\n      // Best-effort only\n    }\n  }, [\n    pendingFile,\n    pendingFileId,\n    isUploading,\n    quoteOps,\n    pendingDimensions,\n    requestQuote,\n    resumeRequested,\n    toast,\n  ]);\n\n  useEffect(() => {\n    const onStorage = (e: StorageEvent) => {\n      if (e.key === 'metaextract_images_mvp_purchase_completed') {\n        void checkCreditsAndMaybeResume();\n      }\n    };\n    window.addEventListener('storage', onStorage);\n    return () => window.removeEventListener('storage', onStorage);\n  }, [checkCreditsAndMaybeResume]);\n\n  useEffect(() => {\n    const handleResize = () => {\n      setIsMobile(window.innerWidth < 640);\n    };\n    window.addEventListener('resize', handleResize);\n    return () => window.removeEventListener('resize', handleResize);\n  }, []);\n\n  useEffect(() => {\n    if (openedFromQueryRef.current) return;\n    const pricingFlag =\n      searchParams.get('pricing') || searchParams.get('credits');\n    if (!pricingFlag) return;\n    openedFromQueryRef.current = true;\n    setShowPricingModal(true);\n    setPricingDismissed(false);\n    const next = new URLSearchParams(searchParams);\n    next.delete('pricing');\n    next.delete('credits');\n    setSearchParams(next, { replace: true });\n  }, [searchParams, setSearchParams]);\n\n  useEffect(() => {\n    if (ocrFromQueryRef.current) return;\n    if (searchParams.get('ocr') !== '1') return;\n    ocrFromQueryRef.current = true;\n    setOcrUserOverride(true);\n    setOcrAutoApplied(false);\n    setQuoteOps(prev => ({ ...prev, ocr: true }));\n    if (pendingFile && pendingFileId) {\n      void requestQuote(pendingFile, pendingFileId, pendingDimensions, {\n        ...quoteOps,\n        ocr: true,\n      });\n    }\n    const next = new URLSearchParams(searchParams);\n    next.delete('ocr');\n    setSearchParams(next, { replace: true });\n  }, [\n    pendingDimensions,\n    pendingFile,\n    pendingFileId,\n    quoteOps,\n    requestQuote,\n    searchParams,\n    setSearchParams,\n  ]);\n\n  useEffect(() => {\n    if (!showPricingModal) return;\n    const active = document.activeElement as HTMLElement | null;\n    if (active && typeof active.blur === 'function') {\n      active.blur();\n    }\n  }, [showPricingModal]);\n\n  const onDragOver = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragActive(true);\n  }, []);\n\n  const onDragLeave = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragActive(false);\n  }, []);\n\n  const onDrop = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragActive(false);\n    const files = e.dataTransfer.files;\n    if (files.length > 0) handleFile(files[0]);\n  }, []);\n\n  const onKeyDown = useCallback((e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' || e.key === ' ') {\n      e.preventDefault();\n      inputRef.current?.click();\n    }\n  }, []);\n\n  const activeQuoteEntry =\n    quoteData?.quote?.perFile?.find(entry => entry.id === pendingFileId) ??\n    null;\n\n  const handleOpsToggle = (key: keyof ImagesMvpQuoteOps) => {\n    const nextOps = { ...quoteOps, [key]: !quoteOps[key] };\n    if (key === 'ocr') {\n      setOcrUserOverride(true);\n      setOcrAutoApplied(false);\n    }\n    setQuoteOps(nextOps);\n    if (pendingFile && pendingFileId) {\n      void requestQuote(pendingFile, pendingFileId, pendingDimensions, nextOps);\n    }\n  };\n\n  const handleFileSelect = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (!e.target.files || e.target.files.length === 0) {\n      e.target.value = '';\n      return;\n    }\n\n    const files = Array.from(e.target.files);\n\n    // If multiple files selected, request a batch quote and set UI to reflect batch selection\n    if (files.length > 1) {\n      setQuoteLoading(true);\n      setQuoteError(null);\n      try {\n        const entries = files.map(f => ({\n          id: crypto.randomUUID(),\n          name: f.name,\n          mime: f.type || null,\n          sizeBytes: f.size,\n          width: null as number | null,\n          height: null as number | null,\n        }));\n        const response = await fetchImagesMvpQuote(entries, quoteOps);\n        setQuoteData(response);\n        // keep first file as pending to preserve single-file flow for immediate actions\n        setPendingFile(files[0]);\n        setPendingFileId(entries[0].id);\n      } catch (err) {\n        const message = err instanceof Error ? err.message : 'Failed to get quote';\n        setQuoteError(message);\n        setQuoteData(null);\n      } finally {\n        setQuoteLoading(false);\n      }\n    } else {\n      handleFile(files[0]);\n    }\n\n    e.target.value = ''; // reset\n  };\n\n  const handleFile = async (file: File) => {\n    const ext = getExtension(file.name);\n    const mimeType = file.type || 'application/octet-stream';\n    const sizeBucket = getFileSizeBucket(file.size);\n    setOcrUserOverride(false);\n\n    trackImagesMvpEvent('upload_selected', {\n      extension: ext,\n      mime_type: mimeType,\n      size_bytes: file.size,\n      size_bucket: sizeBucket,\n      has_trial_email: false,\n    });\n\n    const fileId = crypto.randomUUID();\n    setPendingFile(file);\n    setPendingFileId(fileId);\n    setPendingDimensions(null);\n    sessionStorage.setItem('images_mvp_status', 'idle');\n    sessionStorage.removeItem('images_mvp_error');\n\n    const dimensions = await probeImageDimensions(file);\n    setPendingDimensions(dimensions);\n    const shouldSuggestOcr = looksLikeMapCapture(file.name);\n    const nextOps =\n      shouldSuggestOcr && !ocrUserOverride && !quoteOps.ocr\n        ? { ...quoteOps, ocr: true }\n        : quoteOps;\n    if (nextOps !== quoteOps) {\n      setQuoteOps(nextOps);\n      setOcrAutoApplied(true);\n    } else {\n      setOcrAutoApplied(false);\n    }\n\n    const quote = await requestQuote(file, fileId, dimensions, nextOps);\n    const fileQuote = quote?.quote?.perFile?.find(entry => entry.id === fileId);\n    if (!quote || !fileQuote) {\n      trackImagesMvpEvent('upload_rejected', {\n        extension: ext,\n        mime_type: mimeType,\n        size_bytes: file.size,\n        size_bucket: sizeBucket,\n        reason: 'quote_failed',\n      });\n      toast({\n        title: 'Quote failed',\n        description: 'We could not price this file. Please try again.',\n        variant: 'destructive',\n      });\n      setPendingFile(null);\n      setPendingFileId(null);\n      return;\n    }\n\n    if (!fileQuote.accepted) {\n      trackImagesMvpEvent('upload_rejected', {\n        extension: ext,\n        mime_type: mimeType,\n        size_bytes: file.size,\n        size_bucket: sizeBucket,\n        reason: fileQuote.reason || 'unsupported_format',\n      });\n      toast({\n        title: 'Upload blocked',\n        description:\n          fileQuote.reason === 'file_too_large'\n            ? 'File exceeds the maximum size limit.'\n            : fileQuote.reason === 'megapixels_exceed_limit'\n              ? 'Image resolution exceeds the supported limit.'\n              : 'Unsupported file type.',\n        variant: 'destructive',\n      });\n      setPendingFile(null);\n      setPendingFileId(null);\n      setQuoteData(null);\n      return;\n    }\n  };\n\n  const uploadFile = async (file: File) => {\n    if (!quoteData || !pendingFileId) {\n      toast({\n        title: 'Quote required',\n        description: 'Please select the file again to get a fresh quote.',\n        variant: 'destructive',\n      });\n      return;\n    }\n\n    setIsUploading(true);\n    setUploadProgress(0);\n    const startedAt = Date.now();\n\n    // Get session ID for WebSocket progress tracking\n    const sessionId =\n      getImagesMvpSessionId() ||\n      `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    setCurrentSessionId(sessionId);\n    setShowProgressTracker(true);\n    const formData = new FormData();\n    sessionStorage.setItem('images_mvp_status', 'processing');\n    sessionStorage.setItem('images_mvp_ocr', String(quoteOps.ocr));\n\n    // Append metadata fields BEFORE file to ensure streaming parsers see them first\n    formData.append('session_id', sessionId);\n    formData.append('quote_id', quoteData.quoteId);\n    formData.append('client_file_id', pendingFileId);\n    formData.append('op_embedding', String(quoteOps.embedding));\n    formData.append('op_ocr', String(quoteOps.ocr));\n    formData.append('op_forensics', String(quoteOps.forensics));\n    if (file.lastModified) {\n      formData.append('client_last_modified', String(file.lastModified));\n    }\n    formData.append('file', file);\n\n    const sizeBucket = getFileSizeBucket(file.size);\n    const mimeType = file.type || 'application/octet-stream';\n    const extension = getExtension(file.name);\n\n    trackImagesMvpEvent('analysis_started', {\n      extension,\n      mime_type: mimeType,\n      size_bytes: file.size,\n      size_bucket: sizeBucket,\n      has_trial_email: false,\n    });\n\n    try {\n      const data = await new Promise<any>((resolve, reject) => {\n        const xhr = new XMLHttpRequest();\n\n        xhr.upload.onprogress = event => {\n          if (event.lengthComputable) {\n            const percentComplete = (event.loaded / event.total) * 100;\n            setUploadProgress(percentComplete);\n          }\n        };\n\n        xhr.onload = () => {\n          let responseData;\n          try {\n            responseData = xhr.responseText\n              ? JSON.parse(xhr.responseText)\n              : null;\n          } catch {\n            responseData = null;\n          }\n\n          if (xhr.status >= 200 && xhr.status < 300) {\n            resolve(responseData);\n          } else {\n            const errorMessage =\n              typeof responseData?.error === 'string'\n                ? responseData.error\n                : responseData?.error?.message ||\n                  responseData?.message ||\n                  xhr.responseText ||\n                  'Extraction failed';\n\n            reject({\n              status: xhr.status,\n              message: errorMessage,\n              data: responseData,\n            });\n          }\n        };\n\n        xhr.onerror = () => reject({ message: 'Network error' });\n\n        xhr.open('POST', '/api/images_mvp/extract');\n        // Add authentication headers and credentials\n        const authToken = localStorage.getItem('auth_token');\n        if (authToken) {\n          xhr.setRequestHeader('Authorization', 'Bearer ' + authToken);\n        }\n        xhr.withCredentials = true;\n        xhr.send(formData);\n      });\n\n      // Success\n      const processingMs =\n        typeof data?.processing_ms === 'number' ? data.processing_ms : null;\n      trackImagesMvpEvent('analysis_completed', {\n        success: true,\n        extension,\n        mime_type: mimeType,\n        size_bucket: sizeBucket,\n        processing_ms: processingMs,\n        elapsed_ms: Date.now() - startedAt,\n        fields_extracted: data?.fields_extracted ?? null,\n        trial_granted: data?.access?.trial_granted ?? null,\n        credits_charged: data?.access?.credits_charged ?? null,\n        credits_required: data?.access?.credits_required ?? null,\n      });\n\n      setUploadProgress(100);\n      sessionStorage.setItem('currentMetadata', JSON.stringify(data));\n      sessionStorage.setItem('images_mvp_status', 'success');\n      sessionStorage.removeItem('images_mvp_error');\n      // Hide progress tracker and navigate to results\n      setShowProgressTracker(false);\n      setTimeout(() => {\n        navigate('/images_mvp/results', { state: { metadata: data } });\n      }, 500);\n    } catch (err: any) {\n      console.error(err);\n\n      const errorMessage = err.message || 'Upload failed';\n      const status = err.status || 500;\n      const body = err.data || null;\n      sessionStorage.setItem('images_mvp_status', 'fail');\n      sessionStorage.setItem(\n        'images_mvp_error',\n        JSON.stringify({\n          status,\n          message: errorMessage,\n        })\n      );\n\n      trackImagesMvpEvent('analysis_completed', {\n        success: false,\n        status,\n        error_message: errorMessage,\n        extension,\n        mime_type: mimeType,\n        size_bucket: sizeBucket,\n        elapsed_ms: Date.now() - startedAt,\n      });\n\n      const isPaywall =\n        status === 402 ||\n        (status === 429 &&\n          (body?.credits_required ||\n            String(body?.error || '')\n              .toLowerCase()\n              .includes('quota') ||\n            String(body?.message || '')\n              .toLowerCase()\n              .includes('purchase credits')));\n\n      if (isPaywall) {\n        // Trigger Credit Purchase Flow\n        trackImagesMvpEvent('paywall_viewed', {\n          reason: 'free_quota_exhausted_or_insufficient_credits',\n          extension,\n          mime_type: mimeType,\n        });\n        toast({\n          title: 'Free checks used',\n          description: 'Buy credits to continue analyzing images.',\n          variant: 'destructive',\n        });\n        if (!showPricingModal && !pricingDismissed) {\n          setShowPricingModal(true);\n          setPaywallShownAt(Date.now());\n        }\n        setResumeRequested(true);\n        return;\n      }\n\n      setUploadError(true);\n      setShowProgressTracker(false); // Hide progress tracker on error\n      setTimeout(() => setUploadError(false), 3000);\n\n      if (\n        errorMessage.toLowerCase().includes('failed to fetch') ||\n        errorMessage === 'Network error'\n      ) {\n        toast({\n          title: 'Backend unavailable',\n          description:\n            'API is not reachable. Start the server with `npm run dev:server`.',\n          variant: 'destructive',\n        });\n        return;\n      }\n      if (body?.code && String(body.code).startsWith('QUOTE_')) {\n        toast({\n          title: 'Quote expired',\n          description:\n            'Quote expired or file changed. Re-select the file to refresh.',\n          variant: 'destructive',\n        });\n        setPendingFile(null);\n        setPendingFileId(null);\n        setQuoteData(null);\n        return;\n      }\n      if (status === 413) {\n        const maxBytes = quoteData?.limits?.maxBytes ?? 100 * 1024 * 1024;\n        const maxMb = Math.round(maxBytes / (1024 * 1024));\n        toast({\n          title: 'File too large',\n          description: `Max ${maxMb} MB.`,\n          variant: 'destructive',\n        });\n        return;\n      }\n      if (status === 415) {\n        toast({\n          title: 'Unsupported file type',\n          description:\n            'Unsupported file type. Please upload a supported image.',\n          variant: 'destructive',\n        });\n        return;\n      }\n      if (status === 403) {\n        toast({\n          title: 'Upload blocked',\n          description:\n            body?.message ||\n            'For security reasons, this file type is not permitted.',\n          variant: 'destructive',\n        });\n        return;\n      }\n      toast({\n        title: 'Error',\n        description: errorMessage,\n        variant: 'destructive',\n      });\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  return (\n    <div className=\"w-full max-w-lg mx-auto px-4 sm:px-0\">\n      <PricingModal\n        isOpen={showPricingModal}\n        onClose={() => {\n          setShowPricingModal(false);\n          setPricingDismissed(true);\n        }}\n      />\n\n      {resumeRequested && pendingFile && (\n        <div className=\"mb-3 rounded-lg border border-white/10 bg-white/5 p-3 text-left\">\n          <div className=\"text-xs text-slate-200\">\n            Ready to analyze:{' '}\n            <span className=\"text-white font-semibold\">{pendingFile.name}</span>\n          </div>\n          <div className=\"mt-2 flex gap-2\">\n            <Button\n              variant=\"outline\"\n              className=\"border-white/20 text-slate-200 hover:text-white hover:bg-white/10\"\n              onClick={() => void checkCreditsAndMaybeResume()}\n              disabled={isUploading}\n            >\n              Refresh credits\n            </Button>\n            <Button\n              className=\"bg-primary hover:bg-primary/90 text-black font-semibold\"\n              onClick={() => {\n                setPricingDismissed(false);\n                setShowPricingModal(true);\n              }}\n              disabled={isUploading}\n            >\n              Buy credits\n            </Button>\n            <Button\n              variant=\"ghost\"\n              className=\"text-slate-300 hover:text-white hover:bg-white/10\"\n              onClick={() => {\n                setPendingFile(null);\n                setResumeRequested(false);\n              }}\n              disabled={isUploading}\n            >\n              Pick different file\n            </Button>\n          </div>\n          {paywallShownAt && (\n            <div className=\"mt-2 text-[10px] text-slate-500\">\n              If you completed checkout in another tab, come back here and well\n              continue automatically.\n            </div>\n          )}\n        </div>\n      )}\n\n      <div className=\"mb-4 sm:mb-6\">\n        {isUploading && showProgressTracker && currentSessionId ? (\n          <ProgressTracker\n            sessionId={currentSessionId}\n            uploadComplete={uploadProgress >= 100}\n            fallbackPercentage={uploadProgress}\n            fallbackStage={\n              uploadProgress < 100\n                ? 'Uploading file to analysis engine'\n                : 'Preparing extraction'\n            }\n          />\n        ) : (\n          <label\n            onDragOver={onDragOver}\n            onDragLeave={onDragLeave}\n            onDrop={onDrop}\n            onKeyDown={onKeyDown}\n            htmlFor=\"mvp-upload\"\n            role=\"button\"\n            tabIndex={0}\n            data-testid=\"image-dropzone\"\n            aria-label={\n              isMobile\n                ? 'Tap to select image'\n                : 'Upload image drop zone. Drag and drop a file here or click to browse.'\n            }\n            className={cn(\n              'relative block w-full border-2 border-dashed rounded-lg sm:rounded-xl p-6 sm:p-12 text-center transition-all cursor-pointer overflow-hidden group outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 focus:ring-offset-black min-h-[200px] sm:min-h-auto touch-manipulation select-none active:scale-[0.98]',\n              isUploading\n                ? 'border-primary/40 bg-black/40 backdrop-blur-sm'\n                : isDragActive\n                  ? 'border-primary bg-primary/5 bg-black/20 backdrop-blur-sm'\n                  : 'border-white/10 bg-black/20 backdrop-blur-sm hover:border-primary/50 hover:bg-white/5'\n            )}\n          >\n            <input\n              id=\"mvp-upload\"\n              ref={inputRef}\n              type=\"file\"\n              multiple\n              className=\"absolute inset-0 w-full h-full opacity-0 cursor-pointer\"\n              accept=\"image/*\"\n              disabled={isUploading}\n              onChange={handleFileSelect}\n              title=\"Upload image\"\n              data-testid=\"image-upload-input\"\n              aria-hidden={false}\n            />\n\n            {isUploading ? (\n              <div\n                className=\"relative flex flex-col items-center justify-center gap-2 sm:gap-3 w-full h-full\"\n                aria-live=\"polite\"\n              >\n                <p className=\"text-white font-mono text-xs sm:text-sm\">\n                  {uploadError ? 'Upload Failed' : 'Processing current upload'}\n                </p>\n                {!showProgressTracker && (\n                  <span\n                    className={`text-[11px] font-mono ${uploadError ? 'text-red-300' : 'text-emerald-300'}`}\n                  >\n                    {uploadError ? 'Error' : 'Uploading...'}\n                  </span>\n                )}\n              </div>\n            ) : (\n              <>\n                <div className=\"mb-3 sm:mb-4\">\n                  <div className=\"w-12 h-12 sm:w-16 sm:h-16 bg-gradient-to-tr from-primary/20 to-purple-500/20 rounded-full flex items-center justify-center mx-auto group-hover:scale-110 transition-transform\">\n                    <Upload\n                      className=\"w-6 h-6 sm:w-8 sm:h-8 text-primary\"\n                      aria-hidden=\"true\"\n                    />\n                  </div>\n                </div>\n\n                <h3 className=\"text-lg sm:text-xl font-bold text-white mb-1 sm:mb-2\">\n                  {isMobile ? 'Tap to select a photo' : 'Drop your image here'}\n                </h3>\n\n                <p className=\"text-slate-200 text-xs sm:text-sm mb-4 sm:mb-6\">\n                  {isMobile ? (\n                    <>\n                      JPG, PNG, HEIC, WebP\n                      {maxBytesDisplay\n                        ? ` (max ${Math.round(maxBytesDisplay / (1024 * 1024))} MB)`\n                        : ''}\n                      {!isAuthenticated && (\n                        <span className=\"text-primary text-xs font-mono mt-1 block\">\n                          <Zap\n                            className=\"w-3 h-3 inline mr-1\"\n                            aria-hidden=\"true\"\n                          />\n                          2 free checks (no signup)\n                        </span>\n                      )}\n                    </>\n                  ) : (\n                    <>\n                      Supports JPG, PNG, HEIC, WebP\n                      {maxBytesDisplay\n                        ? ` (max ${Math.round(maxBytesDisplay / (1024 * 1024))} MB)`\n                        : ''}{' '}\n                      <br className=\"hidden sm:block\" />\n                      {!isAuthenticated && (\n                        <span className=\"text-primary text-xs font-mono mt-1 block\">\n                          <Zap\n                            className=\"w-3 h-3 inline mr-1\"\n                            aria-hidden=\"true\"\n                          />\n                          2 free checks (no signup)\n                        </span>\n                      )}\n                    </>\n                  )}\n                </p>\n\n                <Button\n                  variant=\"outline\"\n                  size=\"default\"\n                  className=\"border-white/10 hover:bg-white/5 hover:text-white w-full sm:w-auto\"\n                >\n                  Browse Files\n                </Button>\n\n                <div className=\"mt-2 text-xs text-slate-400\">\n                  <span className=\"block\">Files are processed securely and deleted within 1 hour.</span>\n                </div>\n              </>\n            )}\n          </label>\n        )}\n      </div>\n\n      {pendingFile && (\n        <div className=\"mt-4 rounded-lg border border-white/10 bg-black/30 p-4 text-left overflow-hidden\">\n          <div className=\"flex flex-wrap items-center justify-between gap-2\">\n            <div className=\"flex-1 min-w-0 flex flex-col justify-center\">\n              <div\n                className=\"text-sm font-semibold text-white truncate\"\n                title={pendingFile.name}\n              >\n                {pendingFile.name}\n              </div>\n              <div className=\"text-[11px] text-slate-400\">\n                {(pendingFile.size / (1024 * 1024)).toFixed(2)} MB\n                {pendingDimensions\n                  ? `  ${pendingDimensions.width}${pendingDimensions.height}`\n                  : '  dimensions pending'}\n              </div>\n            </div>\n            <div className=\"text-xs text-slate-300 shrink-0 flex items-center gap-2\">\n              {quoteLoading\n                ? 'Calculating quote...'\n                : activeQuoteEntry?.accepted\n                  ? `Credits: ${activeQuoteEntry.creditsTotal}`\n                  : 'Quote unavailable'}\n\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={async () => {\n                  setResumeRequested(true);\n                  await checkCreditsAndMaybeResume();\n                  setResumeRequested(false);\n                  toast({ title: 'Checked for credits', description: 'Refreshed credit balance.' });\n                }}\n                className=\"ml-2\"\n              >\n                Check for Credits\n              </Button>\n            </div>\n          </div>\n\n          {quoteError && (\n            <div className=\"mt-2 text-xs text-red-300\">{quoteError}</div>\n          )}\n\n          {activeQuoteEntry?.accepted && activeQuoteEntry.breakdown && (\n            <div className=\"mt-3 space-y-2 text-xs text-slate-300\">\n              {/* Size badge - only show if not standard */}\n              {activeQuoteEntry.mpBucket &&\n                activeQuoteEntry.mpBucket !== 'standard' && (\n                  <div className=\"flex flex-wrap items-center gap-2\">\n                    <span className=\"rounded-full bg-white/10 px-2 py-1 text-[11px]\">\n                      {activeQuoteEntry.mpBucket === 'large'\n                        ? 'Large image'\n                        : activeQuoteEntry.mpBucket}\n                    </span>\n                    {activeQuoteEntry.warnings?.map(warning => (\n                      <span\n                        key={warning}\n                        className=\"rounded-full bg-amber-500/20 px-2 py-1 text-[11px] text-amber-200\"\n                      >\n                        {warning}\n                      </span>\n                    ))}\n                  </div>\n                )}\n\n              {/* User-friendly breakdown */}\n              <div className=\"grid gap-1.5 text-sm\">\n                <div className=\"flex justify-between items-center\">\n                  <span className=\"text-slate-300\">Base scan</span>\n                  <span className=\"text-white font-semibold\">\n                    {activeQuoteEntry.breakdown.base +\n                      activeQuoteEntry.breakdown.embedding}{' '}\n                    credits\n                  </span>\n                </div>\n\n                {activeQuoteEntry.breakdown.ocr > 0 && (\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-slate-300\">Text scan</span>\n                    <span className=\"text-white font-semibold\">\n                      +{activeQuoteEntry.breakdown.ocr} credits\n                    </span>\n                  </div>\n                )}\n\n                {activeQuoteEntry.breakdown.mp > 0 && (\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-slate-300\">Large image fee</span>\n                    <span className=\"text-white font-semibold\">\n                      +{activeQuoteEntry.breakdown.mp} credits\n                    </span>\n                  </div>\n                )}\n\n                <div className=\"h-px bg-white/10 my-1\"></div>\n\n                <div className=\"flex justify-between items-center\">\n                  <span className=\"text-white font-medium\">Total</span>\n                  <span className=\"text-white font-bold text-base\">\n                    {activeQuoteEntry.creditsTotal} credits\n                  </span>\n                </div>\n              </div>\n            </div>\n          )}\n\n          <div className=\"mt-4 grid gap-2 text-xs text-slate-300\">\n            <label className=\"flex items-center gap-2 cursor-pointer\">\n              <input\n                type=\"checkbox\"\n                checked={quoteOps.ocr}\n                onChange={() => handleOpsToggle('ocr')}\n                disabled={quoteLoading || isUploading}\n                className=\"cursor-pointer\"\n              />\n              <span className=\"select-none\">\n                Detect overlaid text{' '}\n                <span className=\"text-slate-400\">\n                  (+6 credits if text found)\n                </span>\n              </span>\n            </label>\n            {ocrAutoApplied && (\n              <div className=\"text-[11px] text-emerald-300\">\n                Text scan enabled because this looks like a map/GPS image. You\n                can turn it off.\n              </div>\n            )}\n          </div>\n\n          <div className=\"mt-4 flex flex-wrap gap-2\">\n            <Button\n              className=\"bg-primary hover:bg-primary/90 text-black font-semibold\"\n              onClick={() => void uploadFile(pendingFile)}\n              disabled={\n                isUploading ||\n                quoteLoading ||\n                !activeQuoteEntry?.accepted ||\n                !quoteData\n              }\n            >\n              Analyze\n            </Button>\n            <Button\n              variant=\"ghost\"\n              className=\"text-slate-300 hover:text-white hover:bg-white/10\"\n              onClick={() => {\n                setPendingFile(null);\n                setPendingFileId(null);\n                setPendingDimensions(null);\n                setQuoteData(null);\n                setQuoteError(null);\n              }}\n              disabled={isUploading}\n            >\n              Clear\n            </Button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/images-mvp/strings.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/layout.tsx","messages":[],"suppressedMessages":[{"ruleId":"jsx-a11y/anchor-is-valid","severity":2,"message":"Anchor used as a button. Anchors are primarily expected to navigate. Use the button element instead. Learn more: https://github.com/jsx-eslint/eslint-plugin-jsx-a11y/blob/HEAD/docs/rules/anchor-is-valid.md","line":187,"column":17,"nodeType":"JSXOpeningElement","endLine":191,"endColumn":18,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"jsx-a11y/anchor-is-valid","severity":2,"message":"Anchor used as a button. Anchors are primarily expected to navigate. Use the button element instead. Learn more: https://github.com/jsx-eslint/eslint-plugin-jsx-a11y/blob/HEAD/docs/rules/anchor-is-valid.md","line":216,"column":21,"nodeType":"JSXOpeningElement","endLine":225,"endColumn":22,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/loading-skeletons.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/medical-analysis-result.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[323,326],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[323,326],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[343,346],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[343,346],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[364,367],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[364,367],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[388,391],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[388,391],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[408,411],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[408,411],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[436,439],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[436,439],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[458,461],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[458,461],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[795,798],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[795,798],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1354,1357],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1354,1357],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport {\n  User,\n  Monitor,\n  Settings,\n  Calendar,\n  Layers,\n  HeartPulse,\n} from 'lucide-react';\n\ninterface MedicalAvailable {\n  available: boolean;\n  patient_info?: any;\n  study_info?: any;\n  series_info?: any;\n  equipment_info?: any;\n  image_info?: any;\n  acquisition_params?: any;\n  private_tags?: any;\n}\n\ninterface MedicalAnalysisResultProps {\n  data: MedicalAvailable;\n  isUnlocked: boolean;\n}\n\nexport function MedicalAnalysisResult({\n  data,\n  isUnlocked,\n}: MedicalAnalysisResultProps) {\n  if (!data || !data.available) return null;\n\n  const DetailRow = ({\n    label,\n    value,\n    unit = '',\n  }: {\n    label: string;\n    value: any;\n    unit?: string;\n  }) => {\n    if (value === undefined || value === null || value === '') return null;\n    return (\n      <div className=\"flex justify-between py-1 border-b border-gray-100 last:border-0\">\n        <span className=\"text-sm text-gray-500\">{label}</span>\n        <span className=\"text-sm font-medium text-gray-900 text-right\">\n          {String(value)}\n          {unit ? ` ${unit}` : ''}\n        </span>\n      </div>\n    );\n  };\n\n  const Section = ({\n    title,\n    icon: Icon,\n    children,\n    color,\n  }: {\n    title: string;\n    icon: any;\n    children: React.ReactNode;\n    color: string;\n  }) => (\n    <Card className={`border-${color}-200 bg-${color}-50/30 overflow-hidden`}>\n      <CardHeader\n        className={`bg-${color}-50/50 pb-3 border-b border-${color}-100`}\n      >\n        <CardTitle\n          className={`text-base flex items-center gap-2 text-${color}-900`}\n        >\n          <Icon className={`h-5 w-5 text-${color}-600`} />\n          {title}\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"pt-4 space-y-1 bg-white/50\">\n        {children}\n      </CardContent>\n    </Card>\n  );\n\n  return (\n    <div className=\"space-y-6 animate-in fade-in duration-500\">\n      <div className=\"flex items-center gap-3 mb-6\">\n        <div className=\"p-3 bg-blue-100 rounded-lg\">\n          <HeartPulse className=\"h-6 w-6 text-blue-600\" />\n        </div>\n        <div>\n          <h2 className=\"text-2xl font-bold text-gray-900\">\n            Medical Imaging Analysis\n          </h2>\n          <p className=\"text-gray-500\">DICOM Metadata Extraction</p>\n        </div>\n        {data.series_info?.modality && (\n          <Badge className=\"ml-auto text-lg px-3 py-1 bg-blue-600\">\n            {data.series_info.modality}\n          </Badge>\n        )}\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n        {/* Patient Information - SENSITIVE */}\n        {data.patient_info && (\n          <Section title=\"Patient Information\" icon={User} color=\"rose\">\n            <DetailRow label=\"ID\" value={data.patient_info.id} />\n            <DetailRow label=\"Sex\" value={data.patient_info.sex} />\n            <DetailRow label=\"Age\" value={data.patient_info.age} />\n            <DetailRow\n              label=\"Weight\"\n              value={data.patient_info.weight}\n              unit=\"kg\"\n            />\n            <DetailRow\n              label=\"Height\"\n              value={data.patient_info.height}\n              unit=\"m\"\n            />\n            <DetailRow\n              label=\"Birth Date\"\n              value={data.patient_info.birth_date}\n            />\n            {isUnlocked ? (\n              <DetailRow label=\"Name\" value={data.patient_info.name} />\n            ) : (\n              <div className=\"flex justify-between py-1 border-b border-gray-100 last:border-0 opacity-50\">\n                <span className=\"text-sm text-gray-500\">Name</span>\n                <span className=\"text-sm font-medium text-gray-900 text-right blur-sm select-none\">\n                  John Doe\n                </span>\n              </div>\n            )}\n          </Section>\n        )}\n\n        {/* Study Information */}\n        {data.study_info && (\n          <Section title=\"Study Details\" icon={Calendar} color=\"blue\">\n            <DetailRow\n              label=\"Description\"\n              value={data.study_info.description}\n            />\n            <DetailRow label=\"Date\" value={data.study_info.date} />\n            <DetailRow label=\"Time\" value={data.study_info.time} />\n            <DetailRow label=\"Study ID\" value={data.study_info.id} />\n            <DetailRow\n              label=\"Accession Number\"\n              value={data.study_info.accession_number}\n            />\n            <DetailRow\n              label=\"Referring Physician\"\n              value={data.study_info.referring_physician}\n            />\n          </Section>\n        )}\n\n        {/* Series & Image Info */}\n        <Section title=\"Image Parameters\" icon={Layers} color=\"indigo\">\n          {data.series_info && (\n            <>\n              <DetailRow label=\"Series # \" value={data.series_info.number} />\n              <DetailRow\n                label=\"Description\"\n                value={data.series_info.description}\n              />\n              <DetailRow label=\"Body Part\" value={data.series_info.body_part} />\n              <DetailRow\n                label=\"Position\"\n                value={data.series_info.patient_position}\n              />\n            </>\n          )}\n          {data.image_info && (\n            <>\n              <div className=\"my-2 border-t border-gray-100\"></div>\n              <DetailRow\n                label=\"Dimensions\"\n                value={`${data.image_info.width} x ${data.image_info.height}`}\n                unit=\"px\"\n              />\n              <DetailRow\n                label=\"Resolution\"\n                value={data.image_info.pixel_spacing}\n                unit=\"mm\"\n              />\n              <DetailRow\n                label=\"Slice Thickness\"\n                value={data.image_info.slice_thickness}\n                unit=\"mm\"\n              />\n              <DetailRow\n                label=\"Photometric\"\n                value={data.image_info.photometric_interpretation}\n              />\n            </>\n          )}\n        </Section>\n\n        {/* Equipment Details */}\n        {data.equipment_info && (\n          <Section title=\"Equipment\" icon={Monitor} color=\"slate\">\n            <DetailRow\n              label=\"Manufacturer\"\n              value={data.equipment_info.manufacturer}\n            />\n            <DetailRow label=\"Model\" value={data.equipment_info.model} />\n            <DetailRow\n              label=\"Software Version\"\n              value={data.equipment_info.software_version}\n            />\n            <DetailRow\n              label=\"Station\"\n              value={data.equipment_info.station_name}\n            />\n            <DetailRow\n              label=\"Institution\"\n              value={data.equipment_info.institution}\n            />\n          </Section>\n        )}\n\n        {/* Acquisition Params */}\n        {data.acquisition_params && (\n          <Section title=\"Acquisition Settings\" icon={Settings} color=\"amber\">\n            <DetailRow\n              label=\"KVP\"\n              value={data.acquisition_params.kvp}\n              unit=\"kV\"\n            />\n            <DetailRow\n              label=\"Tube Current\"\n              value={data.acquisition_params.tube_current}\n              unit=\"mA\"\n            />\n            <DetailRow\n              label=\"Exposure Time\"\n              value={data.acquisition_params.exposure_time}\n              unit=\"ms\"\n            />\n            <DetailRow\n              label=\"Filter\"\n              value={data.acquisition_params.filter_type}\n            />\n            <DetailRow label=\"Kernel\" value={data.acquisition_params.kernel} />\n            <DetailRow\n              label=\"Gantry Tilt\"\n              value={data.acquisition_params.gantry_tilt}\n            />\n          </Section>\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/metadata-comparison-display.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[394,397],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[394,397],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[414,417],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[414,417],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[438,441],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[438,441],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport {\n  AlertTriangle,\n  CheckCircle2,\n  AlertCircle,\n  Eye,\n  XCircle,\n} from 'lucide-react';\nimport { motion } from 'framer-motion';\n\ninterface MetadataComparisonDisplayProps {\n  comparison?: {\n    has_both: boolean;\n    has_embedded_only: boolean;\n    has_burned_only: boolean;\n    matches: Array<{\n      field: string;\n      matches: boolean;\n      embedded?: any;\n      burned?: any;\n      difference?: any;\n    }>;\n    discrepancies: Array<{ field: string; matches: boolean; warning?: string }>;\n    warnings: string[];\n    summary: {\n      embedded_metadata_present: boolean;\n      burned_metadata_present: boolean;\n      gps_comparison: string;\n      timestamp_comparison: string;\n      overall_status:\n        | 'verified'\n        | 'suspicious'\n        | 'stripped_exif'\n        | 'no_overlay'\n        | 'no_metadata';\n      sources?: {\n        exif: 'embedded' | 'burned' | 'both' | 'none';\n        gps: 'embedded' | 'burned' | 'both' | 'none';\n        location: 'embedded' | 'burned' | 'both' | 'none';\n        timestamp: 'embedded' | 'burned' | 'both' | 'none';\n      };\n    };\n  } | null;\n}\n\nconst statusConfig = {\n  verified: {\n    icon: CheckCircle2,\n    title: ' VERIFIED',\n    description: 'Embedded and burned metadata match',\n    color: 'emerald',\n    bg: 'bg-emerald-500/10 border-emerald-500/30',\n    textColor: 'text-emerald-400',\n  },\n  suspicious: {\n    icon: AlertTriangle,\n    title: ' SUSPICIOUS',\n    description: 'Metadata sources conflict - possible tampering',\n    color: 'rose',\n    bg: 'bg-rose-500/10 border-rose-500/30',\n    textColor: 'text-rose-400',\n  },\n  stripped_exif: {\n    icon: Eye,\n    title: ' NO EXIF FOUND',\n    description: 'No EXIF metadata detected, but visual overlay present',\n    color: 'amber',\n    bg: 'bg-amber-500/10 border-amber-500/30',\n    textColor: 'text-amber-400',\n  },\n  no_overlay: {\n    icon: AlertCircle,\n    title: ' STANDARD PHOTO',\n    description: 'No visible overlay detected',\n    color: 'slate',\n    bg: 'bg-slate-500/10 border-slate-500/30',\n    textColor: 'text-slate-300',\n  },\n  no_metadata: {\n    icon: XCircle,\n    title: ' NO METADATA',\n    description: 'Neither embedded nor burned metadata found',\n    color: 'slate',\n    bg: 'bg-slate-500/10 border-slate-500/30',\n    textColor: 'text-slate-300',\n  },\n};\n\nexport function MetadataComparisonDisplay({\n  comparison,\n}: MetadataComparisonDisplayProps) {\n  if (!comparison) {\n    return null;\n  }\n\n  const summary = comparison.summary ?? {\n    embedded_metadata_present: false,\n    burned_metadata_present: false,\n    gps_comparison: 'no_gps',\n    timestamp_comparison: 'no_timestamp',\n    overall_status: 'no_metadata',\n  };\n  const matches = comparison.matches ?? [];\n  const discrepancies = comparison.discrepancies ?? [];\n  const warnings = comparison.warnings ?? [];\n\n  const status = summary.overall_status || 'no_metadata';\n  const config = statusConfig[status] ?? statusConfig.no_metadata;\n  const Icon = config.icon;\n  const isSuspicious = status === 'suspicious';\n  const isVerified = status === 'verified';\n  const isStripped = status === 'stripped_exif';\n\n  return (\n    <motion.section\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.4 }}\n    >\n      <h4 className=\"flex items-center gap-2 text-xs font-bold mb-4 uppercase tracking-widest text-slate-200 border-b border-white/5 pb-2\">\n        <Eye className=\"w-3 h-3\" /> Metadata Comparison\n      </h4>\n\n      {/* Main Status Alert */}\n      <div className={`rounded-lg border p-4 mb-4 ${config.bg}`}>\n        <div className=\"flex items-start gap-3\">\n          <Icon className={`w-5 h-5 ${config.textColor} shrink-0 mt-0.5`} />\n          <div className=\"flex-1 min-w-0\">\n            <h5 className={`text-sm font-bold ${config.textColor}`}>\n              {config.title}\n            </h5>\n            <p className=\"text-xs text-slate-300 mt-1\">{config.description}</p>\n          </div>\n        </div>\n      </div>\n\n      {/* Detailed Comparisons */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 mb-4\">\n        {/* GPS Comparison */}\n        <div className=\"bg-black/40 border border-white/10 rounded-lg p-3\">\n          <h6 className=\"text-xs font-bold text-rose-400 mb-2\">\n             GPS Comparison\n          </h6>\n          <div\n            className={`text-xs px-2 py-1 rounded font-mono ${\n              summary.gps_comparison === 'match'\n                ? 'bg-emerald-500/20 text-emerald-300'\n                : summary.gps_comparison === 'mismatch'\n                  ? 'bg-rose-500/20 text-rose-300'\n                  : 'bg-slate-500/20 text-slate-200'\n            }`}\n          >\n            {summary.gps_comparison.toUpperCase()}\n          </div>\n\n          {/* Show GPS distance if mismatch */}\n          {matches.find(m => m.field === 'gps' && m.matches === true)\n            ?.difference && (\n            <div className=\"text-[10px] text-emerald-400 mt-2 font-mono\">\n               Match (\n              {matches\n                .find(m => m.field === 'gps')\n                ?.difference?.approx_meters?.toFixed(1)}\n              m)\n            </div>\n          )}\n\n          {discrepancies.find(d => d.field === 'gps') && (\n            <div className=\"text-[10px] text-rose-400 mt-2\">\n               {discrepancies.find(d => d.field === 'gps')?.warning}\n            </div>\n          )}\n        </div>\n\n        {/* Timestamp Comparison */}\n        <div className=\"bg-black/40 border border-white/10 rounded-lg p-3\">\n          <h6 className=\"text-xs font-bold text-purple-400 mb-2\">\n             Timestamp Comparison\n          </h6>\n          <div\n            className={`text-xs px-2 py-1 rounded font-mono ${\n              summary.timestamp_comparison === 'match'\n                ? 'bg-emerald-500/20 text-emerald-300'\n                : summary.timestamp_comparison === 'mismatch'\n                  ? 'bg-rose-500/20 text-rose-300'\n                  : 'bg-slate-500/20 text-slate-200'\n            }`}\n          >\n            {summary.timestamp_comparison.toUpperCase()}\n          </div>\n\n          {discrepancies.find(d => d.field === 'timestamp') && (\n            <div className=\"text-[10px] text-rose-400 mt-2\">\n               Timestamps don't match\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Metadata Sources Section */}\n      {summary.sources && (\n        <div className=\"bg-slate-800/50 border border-slate-600/30 rounded-lg p-3 mb-3\">\n          <h6 className=\"text-xs font-bold text-slate-200 mb-2\">\n             Data Sources\n          </h6>\n          <div className=\"grid grid-cols-2 gap-2 text-[11px]\">\n            {summary.sources.exif !== 'none' && (\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-slate-300\">EXIF:</span>\n                <span\n                  className={`font-mono px-1.5 py-0.5 rounded ${\n                    summary.sources.exif === 'embedded'\n                      ? 'bg-blue-500/20 text-blue-300'\n                      : 'bg-slate-500/20 text-slate-200'\n                  }`}\n                >\n                  {summary.sources.exif === 'embedded'\n                    ? ' Embedded'\n                    : summary.sources.exif}\n                </span>\n              </div>\n            )}\n            {summary.sources.gps !== 'none' && (\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-slate-300\">GPS:</span>\n                <span\n                  className={`font-mono px-1.5 py-0.5 rounded ${\n                    summary.sources.gps === 'both'\n                      ? 'bg-emerald-500/20 text-emerald-300'\n                      : summary.sources.gps === 'embedded'\n                        ? 'bg-blue-500/20 text-blue-300'\n                        : 'bg-amber-500/20 text-amber-300'\n                  }`}\n                >\n                  {summary.sources.gps === 'both'\n                    ? ' Both'\n                    : summary.sources.gps === 'embedded'\n                      ? ' Embedded'\n                      : ' Burned'}\n                </span>\n              </div>\n            )}\n            {summary.sources.location !== 'none' && (\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-slate-300\">Location:</span>\n                <span\n                  className={`font-mono px-1.5 py-0.5 rounded ${\n                    summary.sources.location === 'both'\n                      ? 'bg-emerald-500/20 text-emerald-300'\n                      : summary.sources.location === 'embedded'\n                        ? 'bg-blue-500/20 text-blue-300'\n                        : 'bg-amber-500/20 text-amber-300'\n                  }`}\n                >\n                  {summary.sources.location === 'both'\n                    ? ' Both'\n                    : summary.sources.location === 'embedded'\n                      ? ' Embedded'\n                      : ' Burned'}\n                </span>\n              </div>\n            )}\n            {summary.sources.timestamp !== 'none' && (\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-slate-300\">Timestamp:</span>\n                <span\n                  className={`font-mono px-1.5 py-0.5 rounded ${\n                    summary.sources.timestamp === 'both'\n                      ? 'bg-emerald-500/20 text-emerald-300'\n                      : summary.sources.timestamp === 'embedded'\n                        ? 'bg-blue-500/20 text-blue-300'\n                        : 'bg-amber-500/20 text-amber-300'\n                  }`}\n                >\n                  {summary.sources.timestamp === 'both'\n                    ? ' Both'\n                    : summary.sources.timestamp === 'embedded'\n                      ? ' Embedded'\n                      : ' Burned'}\n                </span>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* Matches Section */}\n      {matches.length > 0 && (\n        <div className=\"bg-emerald-500/10 border border-emerald-500/30 rounded-lg p-3 mb-3\">\n          <h6 className=\"text-xs font-bold text-emerald-400 mb-2 flex items-center gap-2\">\n            <CheckCircle2 className=\"w-3 h-3\" /> Verified Fields (\n            {matches.length})\n          </h6>\n          <div className=\"space-y-1\">\n            {matches.map((match, i) => (\n              <div\n                key={i}\n                className=\"text-xs text-emerald-300 font-mono flex items-center gap-2\"\n              >\n                <span className=\"text-emerald-500\"></span>\n                <span className=\"capitalize\">{match.field}:</span>\n                <span className=\"text-slate-300\">Both sources match</span>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Discrepancies Section */}\n      {discrepancies.length > 0 && (\n        <div className=\"bg-rose-500/10 border border-rose-500/30 rounded-lg p-3 mb-3\">\n          <h6 className=\"text-xs font-bold text-rose-400 mb-2 flex items-center gap-2\">\n            <AlertTriangle className=\"w-3 h-3\" /> Discrepancies (\n            {discrepancies.length})\n          </h6>\n          <div className=\"space-y-1\">\n            {discrepancies.map((disc, i) => (\n              <div key={i} className=\"text-xs text-rose-300 font-mono\">\n                <span className=\"text-rose-500\"></span>{' '}\n                {disc.warning || `${disc.field} mismatch detected`}\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Warnings Section */}\n      {warnings.length > 0 && (\n        <div className=\"bg-amber-500/10 border border-amber-500/30 rounded-lg p-3\">\n          <h6 className=\"text-xs font-bold text-amber-400 mb-2 flex items-center gap-2\">\n            <AlertCircle className=\"w-3 h-3\" /> Warnings\n          </h6>\n          <div className=\"space-y-1\">\n            {warnings.map((warning, i) => (\n              <div key={i} className=\"text-xs text-amber-300\">\n                 {warning}\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Interpretation Guide */}\n      {isSuspicious && (\n        <div className=\"bg-rose-500/10 border border-rose-500/20 rounded-lg p-3 mt-3 text-xs text-slate-300\">\n          <p className=\"font-semibold text-rose-400 mb-1\">What this means:</p>\n          <p>\n            The GPS or timestamp data in your image's EXIF tags differs from\n            what's visible in the overlay. This could indicate:\n          </p>\n          <ul className=\"list-disc list-inside space-y-0.5 mt-1 text-slate-500\">\n            <li>The image was edited after the overlay was added</li>\n            <li>Location/time was spoofed</li>\n            <li>Different devices/cameras contributed metadata</li>\n          </ul>\n        </div>\n      )}\n\n      {isStripped && (\n        <div className=\"bg-amber-500/10 border border-amber-500/20 rounded-lg p-3 mt-3 text-xs text-slate-300\">\n          <p className=\"font-semibold text-amber-400 mb-1\">What this means:</p>\n          <p>\n            This image has no EXIF metadata (it may have been removed by social\n            media, messaging apps, or image editors). However,\n            location/timestamp info is still visible in the overlay text burned\n            into the image.\n          </p>\n        </div>\n      )}\n\n      {isVerified && (\n        <div className=\"bg-emerald-500/10 border border-emerald-500/20 rounded-lg p-3 mt-3 text-xs text-slate-300\">\n          <p className=\"font-semibold text-emerald-400 mb-1\">\n            What this means:\n          </p>\n          <p>\n             The image metadata appears authentic. Both EXIF data and visible\n            overlay contain matching information, suggesting the image hasn't\n            been tampered with.\n          </p>\n        </div>\n      )}\n    </motion.section>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/metadata-explorer.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1941,1944],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1941,1944],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2442,2445],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2442,2445],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2533,2536],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2533,2536],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2954,2957],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2954,2957],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":228,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":228,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6986,6989],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6986,6989],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":445,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":445,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14099,14102],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14099,14102],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":990,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":990,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34596,34599],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34596,34599],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":999,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":999,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34800,34803],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34800,34803],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1006,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1006,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[35065,35068],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[35065,35068],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Three-Pane Metadata Explorer\n *\n * A comprehensive interface for exploring metadata with:\n * - Left Pane: Smart File Browser with metadata density indicators\n * - Middle Pane: Context-Aware Metadata Tree with progressive disclosure\n * - Right Pane: Drill-Down Detail View with rich visualizations\n */\n\nimport React, {\n  useEffect,\n  useState,\n  useMemo,\n  useCallback,\n  useRef,\n} from 'react';\nimport {\n  ResizableHandle,\n  ResizablePanel,\n  ResizablePanelGroup,\n} from '@/components/ui/resizable';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport {\n  Accordion,\n  AccordionContent,\n  AccordionItem,\n  AccordionTrigger,\n} from '@/components/ui/accordion';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from '@/components/ui/tooltip';\nimport { Tabs, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport {\n  Search,\n  FileImage,\n  FileVideo,\n  FileAudio,\n  FileText,\n  File,\n  Camera,\n  MapPin,\n  Clock,\n  Shield,\n  Tag,\n  ExternalLink,\n  Copy,\n  Eye,\n  Layers,\n  Info,\n  Lock,\n} from 'lucide-react';\nimport { getFieldExplanation, hasExplanation } from '@/utils/fieldExplanations';\nimport { getCategoryDefinition } from '@/utils/metadataCategories';\nimport { loadPreferences, savePreferences } from '@/utils/userPreferences';\nimport { searchMetadata } from '@/utils/metadataSearch';\nimport { EducationalExamples } from '@/components/educational-examples';\nimport { AdvancedAnalysisResults } from '@/components/AdvancedAnalysisResults';\n\n// ============================================================================\n// Types\n// ============================================================================\n\ninterface MetadataField {\n  key: string;\n  value: any;\n  category: string;\n  description?: string;\n  significance?: string;\n  locked?: boolean;\n  highlightedKey?: string; // HTML string with <mark> tags\n  highlightedValue?: string; // HTML string with <mark> tags\n}\n\n/**\n * Runtime type guard for MetadataField\n * Validates that an object has all required fields of MetadataField\n */\nconst isMetadataField = (obj: unknown): obj is MetadataField => {\n  return (\n    obj !== null &&\n    typeof obj === 'object' &&\n    'key' in obj &&\n    typeof (obj as any).key === 'string' &&\n    'value' in obj &&\n    'category' in obj &&\n    typeof (obj as any).category === 'string'\n  );\n};\n\ninterface MetadataCategory {\n  name: string;\n  displayName: string;\n  icon: React.ReactNode;\n  fields: MetadataField[];\n  fieldCount: number;\n  locked?: boolean;\n}\n\ninterface ProcessedFile {\n  id: string;\n  name: string;\n  type: string;\n  size: string;\n  metadataDensity: 'low' | 'medium' | 'high';\n  fieldCount: number;\n  categories: MetadataCategory[];\n  rawMetadata: Record<string, any>;\n  tier: string;\n  processedAt: string;\n  advancedAnalysis?: {\n    enabled: boolean;\n    processing_time_ms: number;\n    modules_run: string[];\n    forensic_score: number;\n    authenticity_assessment: string;\n  };\n}\n\ninterface MetadataExplorerProps {\n  files: ProcessedFile[];\n  selectedFileId?: string;\n  onFileSelect?: (fileId: string) => void;\n  viewMode?: 'simple' | 'advanced' | 'raw';\n  onViewModeChange?: (mode: 'simple' | 'advanced' | 'raw') => void;\n}\n\n// ============================================================================\n// Field Significance Tooltips\n// ============================================================================\n\nconst FIELD_SIGNIFICANCE: Record<string, string> = {\n  Make: 'Camera manufacturer - useful for identifying device',\n  Model: 'Camera model - helps determine capabilities and age',\n  DateTimeOriginal: 'When the photo was actually taken',\n  GPSLatitude: 'Geographic latitude where photo was taken',\n  GPSLongitude: 'Geographic longitude where photo was taken',\n  ShutterCount: 'Number of actuations - indicates camera wear',\n  SerialNumber: 'Unique device identifier - forensic evidence',\n  Software: 'Software used to process/edit the image',\n  ExposureTime: 'How long the sensor was exposed - affects motion blur',\n  FNumber: 'Aperture setting - affects depth of field',\n  ISO: 'Sensor sensitivity - affects noise levels',\n  FocalLength: 'Lens focal length - affects perspective',\n  LensModel: 'Specific lens used - affects optical characteristics',\n  ColorSpace: 'Color encoding standard - affects color accuracy',\n  WhiteBalance: 'Color temperature compensation setting',\n  Flash: 'Flash mode used when photo was taken',\n  MeteringMode: 'How camera measured light for exposure',\n  ExposureMode: 'Auto, manual, or program exposure setting',\n  ExposureCompensation: 'User adjustment to auto exposure',\n  SceneType: 'What the camera detected the scene to be',\n  ImageWidth: 'Pixel width of the image',\n  ImageHeight: 'Pixel height of the image',\n  BitsPerSample: 'Color depth per channel',\n  Compression: 'Image compression method used',\n  Orientation: 'How image should be rotated for display',\n  XResolution: 'Intended horizontal print resolution',\n  YResolution: 'Intended vertical print resolution',\n  Artist: 'Photographer or creator name',\n  Copyright: 'Copyright notice for the image',\n  UserComment: 'User-supplied comment or note',\n};\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\nfunction getFileIcon(type: string) {\n  if (type.startsWith('image/')) return <FileImage className=\"h-4 w-4\" />;\n  if (type.startsWith('video/')) return <FileVideo className=\"h-4 w-4\" />;\n  if (type.startsWith('audio/')) return <FileAudio className=\"h-4 w-4\" />;\n  if (type === 'application/pdf') return <FileText className=\"h-4 w-4\" />;\n  return <File className=\"h-4 w-4\" />;\n}\n\nfunction getDensityColor(density: 'low' | 'medium' | 'high') {\n  switch (density) {\n    case 'low':\n      return 'bg-yellow-500';\n    case 'medium':\n      return 'bg-blue-500';\n    case 'high':\n      return 'bg-green-500';\n  }\n}\n\nfunction getDensityLabel(density: 'low' | 'medium' | 'high') {\n  switch (density) {\n    case 'low':\n      return 'Basic metadata';\n    case 'medium':\n      return 'Standard metadata';\n    case 'high':\n      return 'Rich metadata';\n  }\n}\n\nfunction getCategoryIcon(category: string) {\n  switch (category.toLowerCase()) {\n    case 'exif':\n    case 'camera':\n      return <Camera className=\"h-4 w-4\" />;\n    case 'gps':\n    case 'location':\n      return <MapPin className=\"h-4 w-4\" />;\n    case 'filesystem':\n    case 'dates':\n      return <Clock className=\"h-4 w-4\" />;\n    case 'forensic':\n    case 'security':\n      return <Shield className=\"h-4 w-4\" />;\n    case 'iptc':\n    case 'xmp':\n    case 'tags':\n      return <Tag className=\"h-4 w-4\" />;\n    default:\n      return <Layers className=\"h-4 w-4\" />;\n  }\n}\n\nfunction formatValue(value: any): string {\n  if (value === null || value === undefined) return 'N/A';\n  if (typeof value === 'object') {\n    if (Array.isArray(value)) return value.join(', ');\n    return JSON.stringify(value, null, 2);\n  }\n  return String(value);\n}\n\nfunction copyToClipboard(text: string) {\n  navigator.clipboard.writeText(text);\n}\n\n/**\n * Component to safely render HTML with highlighted matches\n */\nconst HighlightedText = ({\n  text,\n  className,\n}: {\n  text: string;\n  className?: string;\n}) => {\n  return (\n    <span className={className} dangerouslySetInnerHTML={{ __html: text }} />\n  );\n};\n\n// ============================================================================\n// Components\n// ============================================================================\n\n/**\n * Left Pane: File Browser with metadata density indicators\n */\nfunction FileBrowser({\n  files,\n  selectedFileId,\n  onFileSelect,\n}: {\n  files: ProcessedFile[];\n  selectedFileId?: string;\n  onFileSelect: (id: string) => void;\n}) {\n  const [searchQuery, setSearchQuery] = useState('');\n\n  const filteredFiles = useMemo(() => {\n    if (!searchQuery) return files;\n    const query = searchQuery.toLowerCase();\n    return files.filter(\n      file =>\n        file.name.toLowerCase().includes(query) ||\n        file.type.toLowerCase().includes(query)\n    );\n  }, [files, searchQuery]);\n\n  return (\n    <div className=\"flex h-full flex-col\" data-testid=\"metadata-file-browser\">\n      <div className=\"border-b p-3\">\n        <div className=\"relative\">\n          <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder=\"Search files...\"\n            aria-label=\"Search files\"\n            value={searchQuery}\n            onChange={e => setSearchQuery(e.target.value)}\n            className=\"pl-8\"\n          />\n        </div>\n      </div>\n\n      <ScrollArea className=\"flex-1\">\n        <div className=\"p-2\">\n          {filteredFiles.map(file => (\n            <button\n              key={file.id}\n              onClick={() => onFileSelect(file.id)}\n              className={`mb-1 flex w-full items-center gap-3 rounded-lg p-3 text-left transition-colors ${\n                selectedFileId === file.id\n                  ? 'bg-primary/10 text-primary'\n                  : 'hover:bg-muted'\n              }`}\n            >\n              <div className=\"shrink-0\">{getFileIcon(file.type)}</div>\n\n              <div className=\"min-w-0 flex-1\">\n                <p className=\"truncate text-sm font-medium\">{file.name}</p>\n                <p className=\"text-xs text-muted-foreground\">\n                  {file.size}  {file.fieldCount} fields\n                </p>\n              </div>\n\n              <TooltipProvider>\n                <Tooltip>\n                  <TooltipTrigger asChild>\n                    <span\n                      className={`h-3 w-3 rounded-full ${getDensityColor(\n                        file.metadataDensity\n                      )}`}\n                    />\n                  </TooltipTrigger>\n                  <TooltipContent>\n                    <p>{getDensityLabel(file.metadataDensity)}</p>\n                  </TooltipContent>\n                </Tooltip>\n              </TooltipProvider>\n            </button>\n          ))}\n\n          {filteredFiles.length === 0 && (\n            <div className=\"py-8 text-center text-sm text-muted-foreground\">\n              No files match your search\n            </div>\n          )}\n        </div>\n      </ScrollArea>\n    </div>\n  );\n}\n\n/**\n * Middle Pane: Metadata Tree with categories and fields\n */\nfunction MetadataTree({\n  file,\n  viewMode,\n  onFieldSelect,\n  selectedField,\n}: {\n  file: ProcessedFile | null;\n  viewMode: 'simple' | 'advanced' | 'raw';\n  onFieldSelect: (field: MetadataField | null) => void;\n  selectedField: MetadataField | null;\n}) {\n  const [searchQuery, setSearchQuery] = useState('');\n\n  // Load user preferences for expanded categories\n  const [expandedCategories, setExpandedCategories] = useState<string[]>(() => {\n    const prefs = loadPreferences();\n    const expanded = prefs.expandedCategories;\n\n    // Historical note: preferences may contain Phase-1 \"smart category\" keys\n    // (e.g. \"capture\", \"location\", \"file\"). This explorers accordion uses\n    // top-level metadata sections (e.g. \"summary\", \"exif\", \"gps\"). If the\n    // stored preferences don't match the current section naming scheme, fall\n    // back to runtime defaults based on the current file.\n    const expandedStrings = Array.isArray(expanded)\n      ? expanded.filter((c): c is string => typeof c === 'string')\n      : [];\n\n    // If we already know the active file on first render, validate immediately\n    // so the accordion isn't rendered collapsed in cases where the defaults are\n    // legacy keys.\n    if (file) {\n      const available = new Set(file.categories.map(c => c.name));\n      const valid = expandedStrings.filter(c => available.has(c));\n      if (valid.length > 0) return valid;\n\n      const preferredOrder = ['summary', 'exif', 'gps', 'image', 'filesystem'];\n      const defaults = preferredOrder.filter(name => available.has(name));\n      const fallback = file.categories.slice(0, 3).map(c => c.name);\n      return defaults.length > 0 ? defaults : fallback;\n    }\n\n    return expandedStrings;\n  });\n\n  // If we have no valid stored expansion state (or it doesn't match this file),\n  // expand a sensible set by default.\n  useEffect(() => {\n    if (!file) return;\n    const preferredOrder = ['summary', 'exif', 'gps', 'image', 'filesystem'];\n    const available = new Set(file.categories.map(c => c.name));\n    const hasAnyValid = expandedCategories.some(c => available.has(c));\n    if (expandedCategories.length > 0 && hasAnyValid) return;\n\n    const defaults = preferredOrder.filter(name => available.has(name));\n\n    // If none of our preferred categories exist (custom test fixtures, new formats),\n    // expand the first few categories so the UI isn't an empty accordion.\n    const fallback = file.categories.slice(0, 3).map(c => c.name);\n    setExpandedCategories(defaults.length > 0 ? defaults : fallback);\n  }, [file, expandedCategories]);\n\n  // Persist category expansion state\n  const handleCategoryExpand = useCallback((categories: string[]) => {\n    setExpandedCategories(categories);\n    const prefs = loadPreferences();\n    savePreferences({ ...prefs, expandedCategories: categories });\n  }, []);\n\n  // Filter categories based on viewMode and search query\n  const visibleCategories = useMemo(() => {\n    if (!file) return [];\n\n    let categories = [...file.categories];\n\n    // Simple mode: only show key categories\n    if (viewMode === 'simple') {\n      const simpleCategories = [\n        'summary',\n        'exif',\n        'camera',\n        'gps',\n        'image',\n        'filesystem',\n      ];\n      categories = categories.filter(c =>\n        simpleCategories.includes(c.name.toLowerCase())\n      );\n    }\n\n    // Apply active search\n    if (searchQuery.trim()) {\n      return categories\n        .map(category => {\n          // Build data record for search util\n          const categoryData: Record<string, any> = {};\n          const fieldMap = new Map<string, MetadataField>();\n\n          category.fields.forEach(field => {\n            categoryData[field.key] = field.value;\n            fieldMap.set(field.key, field);\n          });\n\n          const results = searchMetadata(categoryData, {\n            query: searchQuery,\n            fuzzyMatch: true,\n            caseSensitive: false,\n          });\n\n          // Reconstruct fields with highlighting\n          const matchedFields = results\n            .map(result => {\n              const originalField = fieldMap.get(result.fieldKey);\n              if (!originalField) return null;\n\n              return {\n                ...originalField,\n                highlightedKey: result.highlightedField,\n                highlightedValue: result.highlightedValue,\n              };\n            })\n            .filter(isMetadataField);\n\n          return {\n            ...category,\n            fields: matchedFields,\n          };\n        })\n        .filter(cat => cat.fields.length > 0);\n    }\n\n    return categories;\n  }, [file, viewMode, searchQuery]);\n\n  // Auto-expand on search\n  useEffect(() => {\n    if (searchQuery.trim() && visibleCategories.length > 0) {\n      setExpandedCategories(visibleCategories.map(c => c.name));\n    }\n  }, [searchQuery, visibleCategories.length]);\n\n  if (!file) {\n    return (\n      <div className=\"flex h-full items-center justify-center overflow-auto bg-muted/5\">\n        <EducationalExamples />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex h-full flex-col\" data-testid=\"metadata-tree\">\n      <div className=\"border-b p-3\">\n        <div className=\"relative\">\n          <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder=\"Search fields...\"\n            aria-label=\"Search fields\"\n            value={searchQuery}\n            onChange={e => setSearchQuery(e.target.value)}\n            className=\"pl-8\"\n          />\n        </div>\n      </div>\n\n      {/* Advanced Analysis Results */}\n      {file.advancedAnalysis && (\n        <div className=\"border-b p-4\">\n          <AdvancedAnalysisResults\n            steganography={file.rawMetadata.steganography_analysis}\n            manipulation={file.rawMetadata.manipulation_detection}\n            aiDetection={file.rawMetadata.ai_detection}\n            timeline={file.rawMetadata.timeline_analysis}\n          />\n        </div>\n      )}\n\n      <ScrollArea className=\"flex-1\">\n        <Accordion\n          type=\"multiple\"\n          value={expandedCategories}\n          onValueChange={handleCategoryExpand}\n          className=\"p-2\"\n        >\n          {visibleCategories.map(category => (\n            <AccordionItem\n              key={category.name}\n              value={category.name}\n              className=\"border-none\"\n            >\n              <AccordionTrigger className=\"rounded-lg px-3 py-2 hover:bg-muted hover:no-underline\">\n                <div className=\"flex flex-col items-start gap-1 flex-1\">\n                  <div className=\"flex items-center gap-2 w-full\">\n                    {getCategoryIcon(category.name)}\n                    <span className=\"font-medium\">{category.displayName}</span>\n                    <Badge variant=\"secondary\" className=\"ml-auto\">\n                      {category.fieldCount > category.fields.length\n                        ? `${category.fields.length}/${category.fieldCount}`\n                        : category.fieldCount}\n                    </Badge>\n                    {category.locked && (\n                      <Lock className=\"h-3 w-3 text-muted-foreground\" />\n                    )}\n                  </div>\n                  {(() => {\n                    const catDef = getCategoryDefinition(category.name);\n                    return (\n                      catDef?.description && (\n                        <span className=\"text-xs text-muted-foreground\">\n                          {catDef.description}\n                        </span>\n                      )\n                    );\n                  })()}\n                </div>\n              </AccordionTrigger>\n              <AccordionContent>\n                <div className=\"space-y-1 pl-4\">\n                  {category.fields.map(field => {\n                    if (!field) return null;\n                    return (\n                      <button\n                        key={field.key}\n                        onClick={() => onFieldSelect(field)}\n                        className={`flex w-full items-center justify-between rounded-md p-2 text-left text-sm transition-colors ${\n                          selectedField?.key === field.key\n                            ? 'bg-primary/10 text-primary'\n                            : 'hover:bg-muted'\n                        }`}\n                      >\n                        <div className=\"flex items-center gap-2\">\n                          {field.highlightedKey ? (\n                            <HighlightedText\n                              text={field.highlightedKey}\n                              className=\"font-medium [&>mark]:bg-yellow-200 [&>mark]:text-black dark:[&>mark]:bg-yellow-800 dark:[&>mark]:text-white\"\n                            />\n                          ) : (\n                            <span className=\"font-medium\">{field.key}</span>\n                          )}\n                          {(hasExplanation(field.key) ||\n                            field.significance) && (\n                            <TooltipProvider>\n                              <Tooltip>\n                                <TooltipTrigger asChild>\n                                  <span className=\"inline-flex items-center\">\n                                    <Info className=\"h-3 w-3 text-muted-foreground\" />\n                                  </span>\n                                </TooltipTrigger>\n                                <TooltipContent className=\"max-w-sm\">\n                                  {(() => {\n                                    const explanation = getFieldExplanation(\n                                      field.key\n                                    );\n                                    if (explanation) {\n                                      return (\n                                        <div className=\"space-y-2\">\n                                          <div>\n                                            <p className=\"font-semibold\">\n                                              {explanation.title}\n                                            </p>\n                                            <p className=\"text-sm mt-1\">\n                                              {explanation.description}\n                                            </p>\n                                          </div>\n                                          {explanation.details &&\n                                            explanation.details.length > 0 && (\n                                              <div>\n                                                <p className=\"text-xs font-semibold mb-1\">\n                                                  Details:\n                                                </p>\n                                                <ul className=\"text-xs space-y-1\">\n                                                  {explanation.details.map(\n                                                    (detail, idx) => (\n                                                      <li key={idx}>\n                                                         {detail}\n                                                      </li>\n                                                    )\n                                                  )}\n                                                </ul>\n                                              </div>\n                                            )}\n                                          {explanation.useCases &&\n                                            explanation.useCases.length > 0 && (\n                                              <div>\n                                                <p className=\"text-xs font-semibold mb-1\">\n                                                  Use Cases:\n                                                </p>\n                                                <ul className=\"text-xs space-y-1\">\n                                                  {explanation.useCases.map(\n                                                    (useCase, idx) => (\n                                                      <li key={idx}>\n                                                         {useCase}\n                                                      </li>\n                                                    )\n                                                  )}\n                                                </ul>\n                                              </div>\n                                            )}\n                                        </div>\n                                      );\n                                    } else if (field.significance) {\n                                      return <p>{field.significance}</p>;\n                                    }\n                                    return null;\n                                  })()}\n                                </TooltipContent>\n                              </Tooltip>\n                            </TooltipProvider>\n                          )}\n                        </div>\n                        <span className=\"truncate text-muted-foreground max-w-30\">\n                          {field.highlightedValue ? (\n                            <HighlightedText\n                              text={field.highlightedValue}\n                              className=\"[&>mark]:bg-yellow-200 [&>mark]:text-black dark:[&>mark]:bg-yellow-800 dark:[&>mark]:text-white\"\n                            />\n                          ) : (\n                            formatValue(field.value)\n                          )}\n                        </span>\n                      </button>\n                    );\n                  })}\n                </div>\n              </AccordionContent>\n            </AccordionItem>\n          ))}\n        </Accordion>\n      </ScrollArea>\n    </div>\n  );\n}\n\n/**\n * Right Pane: Detail View with rich visualizations\n */\nfunction DetailView({\n  field,\n  file,\n}: {\n  field: MetadataField | null;\n  file: ProcessedFile | null;\n}) {\n  if (!field) {\n    return (\n      <div\n        className=\"flex h-full items-center justify-center p-8 text-center text-muted-foreground\"\n        data-testid=\"metadata-detail-view\"\n      >\n        <div>\n          <Layers className=\"mx-auto mb-4 h-12 w-12 opacity-50\" />\n          <p>Select a field to see details</p>\n        </div>\n      </div>\n    );\n  }\n\n  const formattedValue = formatValue(field.value);\n  const isLongValue = formattedValue.length > 100;\n  const isGPS =\n    field.key.toLowerCase().includes('gps') ||\n    field.key.toLowerCase().includes('latitude') ||\n    field.key.toLowerCase().includes('longitude');\n  const isUrl =\n    typeof field.value === 'string' && field.value.startsWith('http');\n\n  return (\n    <div className=\"flex h-full flex-col\" data-testid=\"metadata-detail-view\">\n      <div className=\"border-b p-4\">\n        <h3 className=\"text-lg font-semibold\">{field.key}</h3>\n        <p className=\"text-sm text-muted-foreground\">{field.category}</p>\n      </div>\n\n      <ScrollArea className=\"flex-1 p-4\">\n        <div className=\"space-y-4\">\n          {/* Value Display */}\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"flex items-center justify-between text-sm\">\n                Value\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => copyToClipboard(formattedValue)}\n                >\n                  <Copy className=\"h-4 w-4\" />\n                </Button>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {isLongValue ? (\n                <pre className=\"overflow-x-auto rounded-md bg-muted p-3 text-sm\">\n                  {formattedValue}\n                </pre>\n              ) : (\n                <p className=\"text-lg font-medium\">{formattedValue}</p>\n              )}\n            </CardContent>\n          </Card>\n\n          {/* Significance */}\n          {field.significance && (\n            <Card>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm\">Why This Matters</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm text-muted-foreground\">\n                  {field.significance}\n                </p>\n              </CardContent>\n            </Card>\n          )}\n\n          {/* GPS Link */}\n          {isGPS && file?.rawMetadata?.gps && (\n            <Card>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"flex items-center gap-2 text-sm\">\n                  <MapPin className=\"h-4 w-4\" />\n                  Location\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2\">\n                  {file.rawMetadata.gps.google_maps_url && (\n                    <a\n                      href={file.rawMetadata.gps.google_maps_url}\n                      target=\"_blank\"\n                      rel=\"noopener noreferrer\"\n                      className=\"flex items-center gap-2 text-sm text-primary hover:underline\"\n                    >\n                      <ExternalLink className=\"h-4 w-4\" />\n                      Open in Google Maps\n                    </a>\n                  )}\n                  {file.rawMetadata.gps.coordinates && (\n                    <p className=\"text-sm text-muted-foreground\">\n                      {file.rawMetadata.gps.coordinates}\n                    </p>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          )}\n\n          {/* URL Link */}\n          {isUrl && (\n            <Card>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm\">Link</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <a\n                  href={field.value}\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  className=\"flex items-center gap-2 text-sm text-primary hover:underline\"\n                >\n                  <ExternalLink className=\"h-4 w-4\" />\n                  Open Link\n                </a>\n              </CardContent>\n            </Card>\n          )}\n\n          {/* Technical Info */}\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm\">Technical Details</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-2 text-sm\">\n              <div className=\"flex justify-between\">\n                <span className=\"text-muted-foreground\">Category</span>\n                <span>{field.category}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-muted-foreground\">Type</span>\n                <span>{typeof field.value}</span>\n              </div>\n              {typeof field.value === 'string' && (\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Length</span>\n                  <span>{field.value.length} characters</span>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      </ScrollArea>\n    </div>\n  );\n}\n\n// ============================================================================\n// Main Component\n// ============================================================================\n\nexport function MetadataExplorer({\n  files,\n  selectedFileId,\n  onFileSelect,\n  viewMode,\n  onViewModeChange,\n}: MetadataExplorerProps) {\n  const [internalSelectedFileId, setInternalSelectedFileId] = useState<\n    string | undefined\n  >(selectedFileId);\n  const [selectedField, setSelectedField] = useState<MetadataField | null>(\n    null\n  );\n  const [internalViewMode, setInternalViewMode] = useState<\n    'simple' | 'advanced' | 'raw'\n  >(viewMode ?? 'advanced');\n\n  const activeFileId = selectedFileId ?? internalSelectedFileId;\n  const isViewModeControlled = viewMode !== undefined;\n  const activeViewMode = isViewModeControlled ? viewMode : internalViewMode;\n\n  // Radix Tabs value-change can be finicky under jsdom + synthetic events.\n  // Track the last emitted view mode so clicks / onValueChange don't double-fire.\n  const lastEmittedViewModeRef = useRef<'simple' | 'advanced' | 'raw'>(\n    activeViewMode\n  );\n  useEffect(() => {\n    lastEmittedViewModeRef.current = activeViewMode;\n  }, [activeViewMode]);\n\n  const selectedFile = useMemo(\n    () => files.find(f => f.id === activeFileId) ?? null,\n    [files, activeFileId]\n  );\n\n  const handleFileSelect = useCallback(\n    (id: string) => {\n      setInternalSelectedFileId(id);\n      setSelectedField(null);\n      onFileSelect?.(id);\n    },\n    [onFileSelect]\n  );\n\n  const handleViewModeChange = useCallback(\n    (mode: 'simple' | 'advanced' | 'raw') => {\n      if (lastEmittedViewModeRef.current === mode) return;\n      lastEmittedViewModeRef.current = mode;\n      if (!isViewModeControlled) {\n        setInternalViewMode(mode);\n      }\n      onViewModeChange?.(mode);\n    },\n    [isViewModeControlled, onViewModeChange]\n  );\n\n  return (\n    <div className=\"flex h-full flex-col\">\n      {/* View Mode Tabs */}\n      <div className=\"flex items-center justify-between border-b px-4 py-2\">\n        <h2 className=\"font-semibold\">Metadata Explorer</h2>\n        <Tabs\n          value={activeViewMode}\n          onValueChange={v =>\n            handleViewModeChange(v as 'simple' | 'advanced' | 'raw')\n          }\n        >\n          <TabsList>\n            <TabsTrigger\n              value=\"simple\"\n              className=\"flex items-center gap-1\"\n              onClick={() => handleViewModeChange('simple')}\n            >\n              <Eye className=\"h-3 w-3\" />\n              Simple\n            </TabsTrigger>\n            <TabsTrigger\n              value=\"advanced\"\n              className=\"flex items-center gap-1\"\n              onClick={() => handleViewModeChange('advanced')}\n            >\n              <Layers className=\"h-3 w-3\" />\n              Advanced\n            </TabsTrigger>\n            <TabsTrigger\n              value=\"raw\"\n              className=\"flex items-center gap-1\"\n              onClick={() => handleViewModeChange('raw')}\n            >\n              <FileText className=\"h-3 w-3\" />\n              Raw\n            </TabsTrigger>\n          </TabsList>\n        </Tabs>\n      </div>\n\n      {/* Three-Pane Layout */}\n      <ResizablePanelGroup direction=\"horizontal\" className=\"flex-1\">\n        {/* Left Pane: File Browser */}\n        <ResizablePanel defaultSize={20} minSize={15} maxSize={30}>\n          <FileBrowser\n            files={files}\n            selectedFileId={activeFileId}\n            onFileSelect={handleFileSelect}\n          />\n        </ResizablePanel>\n\n        <ResizableHandle withHandle />\n\n        {/* Middle Pane: Metadata Tree */}\n        <ResizablePanel defaultSize={40} minSize={30}>\n          {activeViewMode === 'raw' ? (\n            <ScrollArea className=\"h-full p-4\">\n              <pre className=\"text-xs\" data-testid=\"metadata-raw-json\">\n                {JSON.stringify(selectedFile?.rawMetadata ?? {}, null, 2)}\n              </pre>\n            </ScrollArea>\n          ) : (\n            <MetadataTree\n              file={selectedFile}\n              viewMode={activeViewMode}\n              onFieldSelect={setSelectedField}\n              selectedField={selectedField}\n            />\n          )}\n        </ResizablePanel>\n\n        <ResizableHandle withHandle />\n\n        {/* Right Pane: Detail View */}\n        <ResizablePanel defaultSize={40} minSize={25}>\n          <DetailView field={selectedField} file={selectedFile} />\n        </ResizablePanel>\n      </ResizablePanelGroup>\n    </div>\n  );\n}\n\n// ============================================================================\n// Helper to convert API response to ProcessedFile format\n// ============================================================================\n\nexport function convertMetadataToProcessedFile(\n  metadata: Record<string, any>,\n  id: string\n): ProcessedFile {\n  const categories: MetadataCategory[] = [];\n\n  // Helper to add category\n  const addCategory = (\n    name: string,\n    displayName: string,\n    data: Record<string, any> | null | undefined,\n    locked?: boolean\n  ) => {\n    // Missing sections should simply be omitted. A section is considered \"locked\"\n    // only when the backend explicitly marks it as such.\n    if (!data) return;\n\n    if (typeof data === 'object' && (data as any)._locked) {\n      categories.push({\n        name,\n        displayName,\n        icon: getCategoryIcon(name),\n        fields: [],\n        fieldCount: 0,\n        locked: true,\n      });\n      return;\n    }\n\n    const fields: MetadataField[] = Object.entries(data)\n      .filter(([key]) => !key.startsWith('_'))\n      .map(([key, value]) => ({\n        key,\n        value,\n        category: displayName,\n        significance: FIELD_SIGNIFICANCE[key],\n      }));\n\n    categories.push({\n      name,\n      displayName,\n      icon: getCategoryIcon(name),\n      fields,\n      fieldCount: fields.length,\n      locked,\n    });\n  };\n\n  // Add categories from metadata\n  addCategory('summary', 'Summary', metadata.summary);\n  addCategory('exif', 'Camera & EXIF', metadata.exif);\n  addCategory('image', 'Image Properties', metadata.image);\n  addCategory('gps', 'Location', metadata.gps);\n  addCategory('filesystem', 'File System', metadata.filesystem);\n  addCategory('hashes', 'File Integrity', metadata.file_integrity);\n  addCategory('calculated', 'Calculated', metadata.calculated);\n  addCategory('forensic', 'Forensic', metadata.forensic);\n  addCategory('makernote', 'MakerNotes', metadata.makernote);\n  addCategory('iptc', 'IPTC', metadata.iptc);\n  addCategory('xmp', 'XMP', metadata.xmp);\n  addCategory('video', 'Video', metadata.video);\n  addCategory('audio', 'Audio', metadata.audio);\n  addCategory('pdf', 'PDF', metadata.pdf);\n\n  // Calculate metadata density\n  const totalFields = categories.reduce((sum, cat) => sum + cat.fieldCount, 0);\n  let density: 'low' | 'medium' | 'high' = 'low';\n  if (totalFields > 100) density = 'high';\n  else if (totalFields > 30) density = 'medium';\n\n  return {\n    id,\n    name: metadata.filename || 'Unknown',\n    type: metadata.mime_type || 'application/octet-stream',\n    size: metadata.filesize || 'Unknown',\n    metadataDensity: density,\n    fieldCount: totalFields,\n    categories: categories.filter(c => c.fieldCount > 0 || c.locked),\n    rawMetadata: metadata,\n    tier: metadata.tier || 'free',\n    processedAt: new Date().toISOString(),\n  };\n}\n\nexport default MetadataExplorer;\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/navigation.tsx","messages":[],"suppressedMessages":[{"ruleId":"jsx-a11y/anchor-is-valid","severity":2,"message":"Anchor used as a button. Anchors are primarily expected to navigate. Use the button element instead. Learn more: https://github.com/jsx-eslint/eslint-plugin-jsx-a11y/blob/HEAD/docs/rules/anchor-is-valid.md","line":59,"column":17,"nodeType":"JSXOpeningElement","endLine":69,"endColumn":18,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"jsx-a11y/anchor-is-valid","severity":2,"message":"Anchor used as a button. Anchors are primarily expected to navigate. Use the button element instead. Learn more: https://github.com/jsx-eslint/eslint-plugin-jsx-a11y/blob/HEAD/docs/rules/anchor-is-valid.md","line":148,"column":11,"nodeType":"JSXOpeningElement","endLine":152,"endColumn":12,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/onboarding-tutorial.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[567,570],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[567,570],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\n\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport {\n  ChevronRight,\n  ChevronLeft,\n  Upload,\n  Search,\n  Download,\n  Zap,\n  CheckCircle2,\n  X,\n  ArrowRight,\n  FileText,\n  Camera,\n  MapPin,\n  Hash,\n} from 'lucide-react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { cn } from '@/lib/utils';\n\ninterface TutorialStep {\n  id: string;\n  title: string;\n  description: string;\n  icon: React.ComponentType<any>;\n  content: React.ReactNode;\n  action?: {\n    label: string;\n    onClick: () => void;\n  };\n}\n\ninterface OnboardingTutorialProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onComplete: () => void;\n  userTier: string;\n}\n\nexport function OnboardingTutorial({\n  isOpen,\n  onClose,\n  onComplete,\n  userTier,\n}: OnboardingTutorialProps) {\n  const [currentStep, setCurrentStep] = useState(0);\n  const [completedSteps, setCompletedSteps] = useState<Set<number>>(new Set());\n  const normalizedTier =\n    userTier === 'starter'\n      ? 'professional'\n      : userTier === 'premium'\n        ? 'forensic'\n        : userTier === 'super'\n          ? 'enterprise'\n          : userTier;\n\n  const steps: TutorialStep[] = [\n    {\n      id: 'welcome',\n      title: 'Welcome to MetaExtract',\n      description: 'Your forensic-grade metadata extraction platform',\n      icon: Zap,\n      content: (\n        <div className=\"space-y-4\">\n          <div className=\"text-center\">\n            <div className=\"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4\">\n              <Zap className=\"w-8 h-8 text-primary\" />\n            </div>\n            <h3 className=\"text-lg font-semibold mb-2\">Extract Hidden Data</h3>\n            <p className=\"text-muted-foreground\">\n              Uncover 7,000+ metadata fields from images, videos, audio, and\n              documents. Used by forensic professionals, journalists, and\n              photographers worldwide.\n            </p>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4 mt-6\">\n            <div className=\"text-center p-3 bg-muted/50 rounded-lg\">\n              <Camera className=\"w-6 h-6 text-blue-500 mx-auto mb-2\" />\n              <p className=\"text-sm font-medium\">Camera Data</p>\n              <p className=\"text-xs text-muted-foreground\">EXIF, MakerNotes</p>\n            </div>\n            <div className=\"text-center p-3 bg-muted/50 rounded-lg\">\n              <MapPin className=\"w-6 h-6 text-green-500 mx-auto mb-2\" />\n              <p className=\"text-sm font-medium\">GPS Location</p>\n              <p className=\"text-xs text-muted-foreground\">Coordinates, Maps</p>\n            </div>\n            <div className=\"text-center p-3 bg-muted/50 rounded-lg\">\n              <Hash className=\"w-6 h-6 text-purple-500 mx-auto mb-2\" />\n              <p className=\"text-sm font-medium\">File Integrity</p>\n              <p className=\"text-xs text-muted-foreground\">MD5, SHA256</p>\n            </div>\n            <div className=\"text-center p-3 bg-muted/50 rounded-lg\">\n              <FileText className=\"w-6 h-6 text-orange-500 mx-auto mb-2\" />\n              <p className=\"text-sm font-medium\">Forensic Reports</p>\n              <p className=\"text-xs text-muted-foreground\">Court-ready PDFs</p>\n            </div>\n          </div>\n        </div>\n      ),\n    },\n    {\n      id: 'upload',\n      title: 'Upload Your Files',\n      description: 'Drag & drop or click to select files for analysis',\n      icon: Upload,\n      content: (\n        <div className=\"space-y-4\">\n          <div className=\"border-2 border-dashed border-muted-foreground/25 rounded-lg p-8 text-center\">\n            <Upload className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\n            <h4 className=\"font-medium mb-2\">Drop files here</h4>\n            <p className=\"text-sm text-muted-foreground mb-4\">\n              Or click to browse your computer\n            </p>\n            <div className=\"flex flex-wrap justify-center gap-2\">\n              <Badge variant=\"outline\">Images</Badge>\n              <Badge variant=\"outline\">Video</Badge>\n              <Badge variant=\"outline\">Audio</Badge>\n              <Badge variant=\"outline\">PDF</Badge>\n            </div>\n          </div>\n\n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n            <h5 className=\"font-medium text-blue-900 mb-2\">\n              Your Current Plan: {normalizedTier}\n            </h5>\n            <div className=\"text-sm text-blue-800\">\n              {normalizedTier === 'free' && (\n                <>\n                  <p> Up to 10MB per file</p>\n                  <p> Images only (JPEG, PNG, GIF, WebP)</p>\n                  <p> Basic EXIF data (~200 fields)</p>\n                </>\n              )}\n              {normalizedTier === 'professional' && (\n                <>\n                  <p> Up to 100MB per file</p>\n                  <p> Images + RAW + HEIC formats</p>\n                  <p> 1,000+ metadata fields including GPS</p>\n                </>\n              )}\n              {normalizedTier === 'forensic' && (\n                <>\n                  <p> Up to 500MB per file</p>\n                  <p> All formats including video</p>\n                  <p> 15,000+ fields with advanced forensics</p>\n                </>\n              )}\n              {normalizedTier === 'enterprise' && (\n                <>\n                  <p> Up to 2GB per file</p>\n                  <p> All formats + scientific/medical metadata</p>\n                  <p>\n                     comprehensive field coverage with full forensic analysis\n                  </p>\n                </>\n              )}\n            </div>\n          </div>\n        </div>\n      ),\n    },\n    {\n      id: 'analyze',\n      title: 'Metadata Extraction',\n      description: 'Our engine analyzes your files and extracts hidden data',\n      icon: Search,\n      content: (\n        <div className=\"space-y-4\">\n          <div className=\"text-center\">\n            <div className=\"relative w-24 h-24 mx-auto mb-4\">\n              <div className=\"absolute inset-0 border-4 border-primary/20 rounded-full\"></div>\n              <div className=\"absolute inset-0 border-4 border-primary border-t-transparent rounded-full animate-spin\"></div>\n              <Search className=\"absolute inset-0 w-8 h-8 text-primary m-auto\" />\n            </div>\n            <h4 className=\"font-medium mb-2\">Processing Your File</h4>\n            <p className=\"text-sm text-muted-foreground\">\n              Our forensic engine extracts metadata in seconds\n            </p>\n          </div>\n\n          <div className=\"space-y-3\">\n            <div className=\"flex items-center gap-3 p-3 bg-green-50 border border-green-200 rounded-lg\">\n              <CheckCircle2 className=\"w-5 h-5 text-green-600\" />\n              <div>\n                <p className=\"font-medium text-green-900\">File Analysis</p>\n                <p className=\"text-sm text-green-700\">\n                  Format detection and validation\n                </p>\n              </div>\n            </div>\n\n            <div className=\"flex items-center gap-3 p-3 bg-blue-50 border border-blue-200 rounded-lg\">\n              <div className=\"w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full animate-spin\"></div>\n              <div>\n                <p className=\"font-medium text-blue-900\">Metadata Extraction</p>\n                <p className=\"text-sm text-blue-700\">\n                  Extracting EXIF, GPS, and technical data\n                </p>\n              </div>\n            </div>\n\n            <div className=\"flex items-center gap-3 p-3 bg-muted/50 border border-muted rounded-lg\">\n              <div className=\"w-5 h-5 border-2 border-muted-foreground/30 rounded-full\"></div>\n              <div>\n                <p className=\"font-medium text-muted-foreground\">\n                  Report Generation\n                </p>\n                <p className=\"text-sm text-muted-foreground\">\n                  Formatting results for display\n                </p>\n              </div>\n            </div>\n          </div>\n        </div>\n      ),\n    },\n    {\n      id: 'explore',\n      title: 'Explore Results',\n      description: 'Navigate through extracted metadata organized by category',\n      icon: FileText,\n      content: (\n        <div className=\"space-y-4\">\n          <div className=\"border rounded-lg overflow-hidden\">\n            <div className=\"bg-muted/50 p-3 border-b\">\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-3 h-3 bg-red-500 rounded-full\"></div>\n                <div className=\"w-3 h-3 bg-yellow-500 rounded-full\"></div>\n                <div className=\"w-3 h-3 bg-green-500 rounded-full\"></div>\n                <span className=\"ml-2 text-sm font-mono\">IMG_2847.jpg</span>\n              </div>\n            </div>\n\n            <div className=\"p-4 space-y-3\">\n              <div className=\"flex items-center gap-2 text-sm\">\n                <Camera className=\"w-4 h-4 text-blue-500\" />\n                <span className=\"font-medium\">Camera & EXIF</span>\n                <Badge variant=\"outline\" className=\"ml-auto\">\n                  45 fields\n                </Badge>\n              </div>\n\n              <div className=\"flex items-center gap-2 text-sm\">\n                <MapPin className=\"w-4 h-4 text-green-500\" />\n                <span className=\"font-medium\">GPS Location</span>\n                <Badge variant=\"outline\" className=\"ml-auto\">\n                  8 fields\n                </Badge>\n              </div>\n\n              <div className=\"flex items-center gap-2 text-sm\">\n                <Hash className=\"w-4 h-4 text-purple-500\" />\n                <span className=\"font-medium\">File Integrity</span>\n                <Badge variant=\"outline\" className=\"ml-auto\">\n                  4 fields\n                </Badge>\n              </div>\n\n              <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                <FileText className=\"w-4 h-4\" />\n                <span className=\"font-medium\">MakerNotes</span>\n                <Badge variant=\"outline\" className=\"ml-auto bg-yellow-100\">\n                  Locked\n                </Badge>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-4\">\n            <h5 className=\"font-medium text-amber-900 mb-2\"> Pro Tip</h5>\n            <p className=\"text-sm text-amber-800\">\n              Use the search box to quickly find specific metadata fields. Try\n              searching for \"GPS\", \"camera\", or \"date\".\n            </p>\n          </div>\n        </div>\n      ),\n    },\n    {\n      id: 'export',\n      title: 'Export & Share',\n      description: 'Download results in multiple formats for your workflow',\n      icon: Download,\n      content: (\n        <div className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 gap-3\">\n            <div className=\"flex items-center gap-3 p-3 border rounded-lg hover:bg-muted/50 transition-colors\">\n              <div className=\"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center\">\n                <FileText className=\"w-5 h-5 text-blue-600\" />\n              </div>\n              <div className=\"flex-1\">\n                <p className=\"font-medium\">JSON Export</p>\n                <p className=\"text-sm text-muted-foreground\">\n                  Complete metadata for developers\n                </p>\n              </div>\n              <ArrowRight className=\"w-4 h-4 text-muted-foreground\" />\n            </div>\n\n            <div className=\"flex items-center gap-3 p-3 border rounded-lg hover:bg-muted/50 transition-colors\">\n              <div className=\"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center\">\n                <FileText className=\"w-5 h-5 text-green-600\" />\n              </div>\n              <div className=\"flex-1\">\n                <p className=\"font-medium\">CSV Export</p>\n                <p className=\"text-sm text-muted-foreground\">\n                  Spreadsheet-friendly format\n                </p>\n              </div>\n              <ArrowRight className=\"w-4 h-4 text-muted-foreground\" />\n            </div>\n\n            <div className=\"flex items-center gap-3 p-3 border rounded-lg hover:bg-muted/50 transition-colors\">\n              <div className=\"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center\">\n                <FileText className=\"w-5 h-5 text-red-600\" />\n              </div>\n              <div className=\"flex-1\">\n                <p className=\"font-medium\">PDF Report</p>\n                <p className=\"text-sm text-muted-foreground\">\n                  Court-ready forensic documentation\n                </p>\n              </div>\n              <Badge variant=\"outline\" className=\"bg-yellow-100\">\n                Pro\n              </Badge>\n            </div>\n          </div>\n\n          <div className=\"bg-green-50 border border-green-200 rounded-lg p-4\">\n            <h5 className=\"font-medium text-green-900 mb-2\">\n               Privacy Guarantee\n            </h5>\n            <p className=\"text-sm text-green-800\">\n              Your files are processed in memory and permanently deleted after\n              analysis. We never store your data.\n            </p>\n          </div>\n        </div>\n      ),\n    },\n  ];\n\n  const nextStep = () => {\n    if (currentStep < steps.length - 1) {\n      setCompletedSteps(prev => new Set([...prev, currentStep]));\n      setCurrentStep(currentStep + 1);\n    } else {\n      handleComplete();\n    }\n  };\n\n  const prevStep = () => {\n    if (currentStep > 0) {\n      setCurrentStep(currentStep - 1);\n    }\n  };\n\n  const goToStep = (stepIndex: number) => {\n    setCurrentStep(stepIndex);\n  };\n\n  const handleComplete = () => {\n    setCompletedSteps(prev => new Set([...prev, currentStep]));\n    onComplete();\n    onClose();\n  };\n\n  const progress = ((currentStep + 1) / steps.length) * 100;\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n      <motion.div\n        initial={{ opacity: 0, scale: 0.95 }}\n        animate={{ opacity: 1, scale: 1 }}\n        exit={{ opacity: 0, scale: 0.95 }}\n        className=\"bg-background rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden\"\n      >\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-6 border-b\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-8 h-8 bg-primary/10 rounded-lg flex items-center justify-center\">\n              <Zap className=\"w-4 h-4 text-primary\" />\n            </div>\n            <div>\n              <h2 className=\"font-semibold\">Getting Started</h2>\n              <p className=\"text-sm text-muted-foreground\">\n                Step {currentStep + 1} of {steps.length}\n              </p>\n            </div>\n          </div>\n\n          <Button variant=\"ghost\" size=\"sm\" onClick={onClose}>\n            <X className=\"w-4 h-4\" />\n          </Button>\n        </div>\n\n        {/* Progress */}\n        <div className=\"px-6 py-3 border-b\">\n          <Progress value={progress} className=\"h-2\" />\n          <div className=\"flex justify-between mt-2\">\n            {steps.map((step, index) => (\n              <button\n                key={step.id}\n                onClick={() => goToStep(index)}\n                className={cn(\n                  'w-8 h-8 rounded-full flex items-center justify-center text-xs font-medium transition-colors',\n                  index <= currentStep\n                    ? 'bg-primary text-primary-foreground'\n                    : 'bg-muted text-muted-foreground hover:bg-muted/80'\n                )}\n              >\n                {completedSteps.has(index) ? (\n                  <CheckCircle2 className=\"w-4 h-4\" />\n                ) : (\n                  index + 1\n                )}\n              </button>\n            ))}\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"p-6 min-h-[400px]\">\n          <AnimatePresence mode=\"wait\">\n            <motion.div\n              key={currentStep}\n              initial={{ opacity: 0, x: 20 }}\n              animate={{ opacity: 1, x: 0 }}\n              exit={{ opacity: 0, x: -20 }}\n              transition={{ duration: 0.2 }}\n            >\n              <div className=\"text-center mb-6\">\n                {(() => {\n                  const IconComponent = steps[currentStep].icon;\n                  return (\n                    <div className=\"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4\">\n                      <IconComponent className=\"w-6 h-6 text-primary\" />\n                    </div>\n                  );\n                })()}\n                <h3 className=\"text-xl font-semibold mb-2\">\n                  {steps[currentStep].title}\n                </h3>\n                <p className=\"text-muted-foreground\">\n                  {steps[currentStep].description}\n                </p>\n              </div>\n\n              {steps[currentStep].content}\n            </motion.div>\n          </AnimatePresence>\n        </div>\n\n        {/* Footer */}\n        <div className=\"flex items-center justify-between p-6 border-t bg-muted/50\">\n          <Button\n            variant=\"outline\"\n            onClick={prevStep}\n            disabled={currentStep === 0}\n          >\n            <ChevronLeft className=\"w-4 h-4 mr-2\" />\n            Previous\n          </Button>\n\n          <div className=\"flex items-center gap-2\">\n            <Button variant=\"ghost\" onClick={onClose}>\n              Skip Tutorial\n            </Button>\n\n            <Button onClick={nextStep}>\n              {currentStep === steps.length - 1 ? (\n                <>\n                  Get Started\n                  <CheckCircle2 className=\"w-4 h-4 ml-2\" />\n                </>\n              ) : (\n                <>\n                  Next\n                  <ChevronRight className=\"w-4 h-4 ml-2\" />\n                </>\n              )}\n            </Button>\n          </div>\n        </div>\n      </motion.div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/payment-modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/performance-optimized-metadata.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[246,249],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[246,249],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[365,368],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[365,368],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[400,403],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[400,403],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onFilterChange' is defined but never used. Allowed unused args must match /^_/u.","line":67,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":67,"endColumn":32},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":242,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":242,"endColumn":21,"suggestions":[{"fix":{"range":[7342,7438],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Performance-Optimized Metadata Display Component\n * Uses React.memo, virtualization, and lazy loading for large datasets\n */\n\nimport React, { useState, useCallback, useMemo } from 'react';\n\ninterface MetadataItem {\n  key: string;\n  value: any;\n  category: string;\n  confidence: number;\n}\n\ninterface OptimizedMetadataDisplayProps {\n  metadata: Record<string, any>;\n  onFilterChange?: (filters: any) => void;\n}\n\n// Memoized individual metadata item\nconst MemoizedMetadataItem = React.memo<{\n  item: MetadataItem;\n  onCategoryClick: (category: string) => void;\n}>(({ item, onCategoryClick }) => {\n  const valueDisplay = useMemo(() => {\n    if (typeof item.value === 'object' && item.value !== null) {\n      return JSON.stringify(item.value, null, 2);\n    }\n    return String(item.value);\n  }, [item.value]);\n\n  return (\n    <div className=\"p-3 border-b border-gray-100 hover:bg-gray-50 transition-colors\">\n      <div className=\"flex items-start justify-between gap-2\">\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2\">\n            <span className=\"font-medium text-sm truncate\">{item.key}</span>\n            <button\n              onClick={() => onCategoryClick(item.category)}\n              className=\"text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200\"\n            >\n              {item.category}\n            </button>\n          </div>\n          <p className=\"text-sm text-gray-600 mt-1 break-all\">{valueDisplay}</p>\n        </div>\n        <div className=\"flex-shrink-0\">\n          <div\n            className={`w-2 h-2 rounded-full ${\n              item.confidence > 0.8\n                ? 'bg-green-500'\n                : item.confidence > 0.5\n                  ? 'bg-yellow-500'\n                  : 'bg-red-500'\n            }`}\n          />\n        </div>\n      </div>\n    </div>\n  );\n});\n\nMemoizedMetadataItem.displayName = 'MemoizedMetadataItem';\n\nexport const OptimizedMetadataDisplay: React.FC<\n  OptimizedMetadataDisplayProps\n> = ({ metadata, onFilterChange }) => {\n  const [searchTerm, setSearchTerm] = useState('');\n  const [selectedCategory, setSelectedCategory] = useState<string | null>(null);\n  const [sortBy, setSortBy] = useState<'key' | 'confidence'>('key');\n\n  // Memoized metadata processing\n  const processedMetadata = useMemo(() => {\n    const items: MetadataItem[] = [];\n    const categories = new Set<string>();\n\n    Object.entries(metadata).forEach(([key, value]) => {\n      if (value === null || value === undefined) return;\n      if (\n        typeof value === 'object' &&\n        value !== null &&\n        Object.keys(value).length === 0\n      ) {\n        return;\n      }\n\n      // Determine category based on key\n      let category = 'other';\n      if (key.includes('exif')) category = 'exif';\n      else if (key.includes('gps')) category = 'gps';\n      else if (key.includes('iptc')) category = 'iptc';\n      else if (key.includes('xmp')) category = 'xmp';\n      else if (key.includes('ai_')) category = 'ai';\n      else if (key.includes('quality')) category = 'quality';\n\n      categories.add(category);\n\n      // Calculate confidence based on data quality\n      let confidence = 1.0;\n      if (value === '') confidence = 0.3;\n      else if (typeof value === 'object') {\n        const entries = Object.entries(value).length;\n        confidence = Math.min(1.0, entries / 10);\n      }\n\n      items.push({\n        key,\n        value,\n        category,\n        confidence,\n      });\n    });\n\n    // Filter and sort\n    let filtered = items.filter(\n      item =>\n        item.key.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        String(item.value).toLowerCase().includes(searchTerm.toLowerCase())\n    );\n\n    if (selectedCategory) {\n      filtered = filtered.filter(item => item.category === selectedCategory);\n    }\n\n    filtered.sort((a, b) => {\n      if (sortBy === 'confidence') {\n        return b.confidence - a.confidence;\n      }\n      return a.key.localeCompare(b.key);\n    });\n\n    return {\n      items: filtered,\n      categories: Array.from(categories).sort(),\n    };\n  }, [metadata, searchTerm, selectedCategory, sortBy]);\n\n  // Callback memoization\n  const handleCategoryClick = useCallback((category: string) => {\n    setSelectedCategory(prev => (prev === category ? null : category));\n  }, []);\n\n  const handleSearchChange = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      setSearchTerm(e.target.value);\n    },\n    []\n  );\n\n  // Virtualized list item renderer\n  return (\n    <div className=\"space-y-4\">\n      {/* Search and Filter Controls */}\n      <div className=\"flex gap-4 items-center\">\n        <input\n          type=\"text\"\n          placeholder=\"Search metadata...\"\n          value={searchTerm}\n          onChange={handleSearchChange}\n          className=\"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n        />\n\n        <select\n          value={selectedCategory || 'all'}\n          onChange={e =>\n            setSelectedCategory(\n              e.target.value === 'all' ? null : e.target.value\n            )\n          }\n          className=\"px-4 py-2 border border-gray-300 rounded-lg\"\n        >\n          <option value=\"all\">All Categories</option>\n          {processedMetadata.categories.map(cat => (\n            <option key={cat} value={cat}>\n              {cat.toUpperCase()}\n            </option>\n          ))}\n        </select>\n\n        <select\n          value={sortBy}\n          onChange={e => setSortBy(e.target.value as 'key' | 'confidence')}\n          className=\"px-4 py-2 border border-gray-300 rounded-lg\"\n        >\n          <option value=\"key\">Sort by Name</option>\n          <option value=\"confidence\">Sort by Confidence</option>\n        </select>\n      </div>\n\n      {/* Results Summary */}\n      <div className=\"text-sm text-gray-600\">\n        Showing {processedMetadata.items.length} metadata items\n        {searchTerm && ` matching \"${searchTerm}\"`}\n        {selectedCategory && ` in ${selectedCategory.toUpperCase()}`}\n      </div>\n\n      {/* List for Performance */}\n      {processedMetadata.items.length > 0 ? (\n        <div className=\"max-h-[600px] overflow-auto rounded-md border border-gray-100\">\n          {processedMetadata.items.map(item => (\n            <MemoizedMetadataItem\n              key={`${item.category}:${item.key}`}\n              item={item}\n              onCategoryClick={handleCategoryClick}\n            />\n          ))}\n        </div>\n      ) : (\n        <div className=\"text-center py-12 text-gray-500\">\n          No metadata found matching your criteria\n        </div>\n      )}\n    </div>\n  );\n};\n\n// Lazy-loaded heavy components\nexport const LazyMetadataCharts = React.lazy(() =>\n  import('./v2-results/metadata-charts').then(module => ({\n    default: module.MetadataCharts,\n  }))\n);\n\nexport const LazyMetadataExport = React.lazy(() =>\n  import('./v2-results/metadata-export').then(module => ({\n    default: module.MetadataExport,\n  }))\n);\n\n// Performance monitoring hook\nexport function usePerformanceMonitor(componentName: string) {\n  const [renderTime, setRenderTime] = useState<number>(0);\n\n  React.useEffect(() => {\n    const start = performance.now();\n\n    return () => {\n      const end = performance.now();\n      setRenderTime(end - start);\n\n      if (end - start > 100) {\n        console.warn(\n          `${componentName} slow render: ${(end - start).toFixed(2)}ms`\n        );\n      }\n    };\n  });\n\n  return { renderTime, isSlow: renderTime > 100 };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/persona-display.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/pricing-calculator.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'calculateAnnualPrice' is defined but never used.","line":52,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":52,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getFeatureDifferences' is defined but never used.","line":55,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":55,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isRecommended' is defined but never used. Allowed unused args must match /^_/u.","line":293,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":293,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Pricing Calculator Component\n * \n * Interactive pricing calculator with tier comparisons, usage estimation,\n * and currency localization.\n * \n * Requirements: 4.1, 4.2, 4.3, 4.6\n */\n\nimport React, { useState, useEffect, useMemo } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  Check,\n  X,\n  Zap,\n  ChevronDown,\n  Calculator,\n  Globe,\n  Info,\n  ArrowRight,\n  Sparkles,\n} from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Slider } from '@/components/ui/slider';\nimport { Switch } from '@/components/ui/switch';\nimport { Label } from '@/components/ui/label';\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from '@/components/ui/tooltip';\nimport {\n  PRICING_TIERS,\n  SUPPORTED_CURRENCIES,\n  type CurrencyCode,\n  type SubscriptionTier,\n  type PricingTier,\n  type UsageEstimate,\n  detectUserCurrency,\n  formatPrice,\n  calculateMonthlyPrice,\n  calculateAnnualPrice,\n  calculateAnnualSavings,\n  recommendTier,\n  getFeatureDifferences,\n} from '@/lib/pricing';\n\ninterface PricingCalculatorProps {\n  onSelectTier?: (tier: SubscriptionTier, billingCycle: 'monthly' | 'annual') => void;\n  currentTier?: SubscriptionTier;\n  showCalculator?: boolean;\n  className?: string;\n}\n\nexport function PricingCalculator({\n  onSelectTier,\n  currentTier,\n  showCalculator = true,\n  className = '',\n}: PricingCalculatorProps) {\n  const [currency, setCurrency] = useState<CurrencyCode>('USD');\n  const [billingCycle, setBillingCycle] = useState<'monthly' | 'annual'>('monthly');\n  const [showComparison, setShowComparison] = useState(false);\n  const [highlightedTier, setHighlightedTier] = useState<SubscriptionTier | null>(null);\n  \n  // Usage estimation state\n  const [usage, setUsage] = useState<UsageEstimate>({\n    filesPerMonth: 50,\n    averageFileSizeMB: 10,\n    needsRawFormats: false,\n    needsVideoAudio: false,\n    needsForensicAnalysis: false,\n    needsApiAccess: false,\n    needsPdfReports: false,\n  });\n\n  // Detect user's currency on mount\n  useEffect(() => {\n    const detectedCurrency = detectUserCurrency();\n    setCurrency(detectedCurrency);\n  }, []);\n\n  // Calculate recommended tier based on usage\n  const recommendedTier = useMemo(() => recommendTier(usage), [usage]);\n\n  const handleTierSelect = (tierId: SubscriptionTier) => {\n    onSelectTier?.(tierId, billingCycle);\n  };\n\n  return (\n    <div className={`space-y-8 ${className}`}>\n      {/* Currency and Billing Toggle */}\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n        <div className=\"flex items-center gap-4\">\n          <div className=\"flex items-center gap-2\">\n            <Globe className=\"w-4 h-4 text-slate-300\" />\n            <Select value={currency} onValueChange={(v) => setCurrency(v as CurrencyCode)}>\n              <SelectTrigger className=\"w-[140px] bg-white/5 border-white/10\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                {Object.entries(SUPPORTED_CURRENCIES).map(([code, info]) => (\n                  <SelectItem key={code} value={code}>\n                    {info.symbol} {code}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-3 bg-white/5 rounded-full p-1\">\n          <button\n            onClick={() => setBillingCycle('monthly')}\n            className={`px-4 py-2 rounded-full text-sm font-medium transition-all ${\n              billingCycle === 'monthly'\n                ? 'bg-primary text-black'\n                : 'text-slate-300 hover:text-white'\n            }`}\n          >\n            Monthly\n          </button>\n          <button\n            onClick={() => setBillingCycle('annual')}\n            className={`px-4 py-2 rounded-full text-sm font-medium transition-all flex items-center gap-2 ${\n              billingCycle === 'annual'\n                ? 'bg-primary text-black'\n                : 'text-slate-300 hover:text-white'\n            }`}\n          >\n            Annual\n            <Badge variant=\"secondary\" className=\"bg-emerald-500/20 text-emerald-400 text-xs\">\n              Save 20%\n            </Badge>\n          </button>\n        </div>\n      </div>\n\n      {/* Usage Calculator */}\n      {showCalculator && (\n        <Card className=\"bg-white/5 border-white/10\">\n          <CardHeader className=\"pb-4\">\n            <CardTitle className=\"flex items-center gap-2 text-lg\">\n              <Calculator className=\"w-5 h-5 text-primary\" />\n              Find Your Perfect Plan\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              {/* Files per month slider */}\n              <div className=\"space-y-3\">\n                <div className=\"flex justify-between\">\n                  <Label className=\"text-slate-200\">Files per month</Label>\n                  <span className=\"text-primary font-mono\">{usage.filesPerMonth}</span>\n                </div>\n                <Slider\n                  value={[usage.filesPerMonth]}\n                  onValueChange={([v]) => setUsage(prev => ({ ...prev, filesPerMonth: v }))}\n                  min={1}\n                  max={500}\n                  step={10}\n                  className=\"w-full\"\n                />\n                <div className=\"flex justify-between text-xs text-slate-500\">\n                  <span>1</span>\n                  <span>500+</span>\n                </div>\n              </div>\n\n              {/* Feature toggles */}\n              <div className=\"space-y-3\">\n                <Label className=\"text-slate-200\">Features needed</Label>\n                <div className=\"space-y-2\">\n                  {[\n                    { key: 'needsRawFormats', label: 'RAW image formats' },\n                    { key: 'needsVideoAudio', label: 'Video & Audio files' },\n                    { key: 'needsForensicAnalysis', label: 'Forensic analysis' },\n                    { key: 'needsApiAccess', label: 'API access' },\n                    { key: 'needsPdfReports', label: 'PDF reports' },\n                  ].map(({ key, label }) => (\n                    <div key={key} className=\"flex items-center justify-between\">\n                      <span className=\"text-sm text-slate-300\">{label}</span>\n                      <Switch\n                        checked={usage[key as keyof UsageEstimate] as boolean}\n                        onCheckedChange={(checked) =>\n                          setUsage(prev => ({ ...prev, [key]: checked }))\n                        }\n                      />\n                    </div>\n                  ))}\n                </div>\n              </div>\n            </div>\n\n            {/* Recommendation */}\n            <div className=\"flex items-center justify-between p-4 bg-primary/10 border border-primary/20 rounded-lg\">\n              <div className=\"flex items-center gap-3\">\n                <Sparkles className=\"w-5 h-5 text-primary\" />\n                <div>\n                  <p className=\"text-sm font-medium text-white\">\n                    Recommended: <span className=\"text-primary\">{PRICING_TIERS.find(t => t.id === recommendedTier)?.name}</span>\n                  </p>\n                  <p className=\"text-xs text-slate-300\">Based on your usage estimate</p>\n                </div>\n              </div>\n              <Button\n                size=\"sm\"\n                onClick={() => handleTierSelect(recommendedTier)}\n                className=\"bg-primary text-black hover:bg-primary/90\"\n              >\n                Select Plan\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Pricing Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        {PRICING_TIERS.map((tier) => (\n          <PricingCard\n            key={tier.id}\n            tier={tier}\n            currency={currency}\n            billingCycle={billingCycle}\n            isCurrentTier={currentTier === tier.id}\n            isRecommended={recommendedTier === tier.id}\n            isHighlighted={highlightedTier === tier.id}\n            onSelect={() => handleTierSelect(tier.id)}\n            onHover={() => setHighlightedTier(tier.id)}\n            onLeave={() => setHighlightedTier(null)}\n          />\n        ))}\n      </div>\n\n      {/* Feature Comparison Toggle */}\n      <div className=\"flex justify-center\">\n        <button\n          onClick={() => setShowComparison(!showComparison)}\n          className=\"flex items-center gap-2 text-sm text-slate-300 hover:text-white transition-colors\"\n        >\n          <span>Compare all features</span>\n          <ChevronDown\n            className={`w-4 h-4 transition-transform ${showComparison ? 'rotate-180' : ''}`}\n          />\n        </button>\n      </div>\n\n      {/* Feature Comparison Table */}\n      <AnimatePresence>\n        {showComparison && (\n          <motion.div\n            initial={{ opacity: 0, height: 0 }}\n            animate={{ opacity: 1, height: 'auto' }}\n            exit={{ opacity: 0, height: 0 }}\n            className=\"overflow-hidden\"\n          >\n            <FeatureComparisonTable currency={currency} billingCycle={billingCycle} />\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n\ninterface PricingCardProps {\n  tier: PricingTier;\n  currency: CurrencyCode;\n  billingCycle: 'monthly' | 'annual';\n  isCurrentTier: boolean;\n  isRecommended: boolean;\n  isHighlighted: boolean;\n  onSelect: () => void;\n  onHover: () => void;\n  onLeave: () => void;\n}\n\nfunction PricingCard({\n  tier,\n  currency,\n  billingCycle,\n  isCurrentTier,\n  isRecommended,\n  isHighlighted,\n  onSelect,\n  onHover,\n  onLeave,\n}: PricingCardProps) {\n  const monthlyPrice = calculateMonthlyPrice(tier, billingCycle, currency);\n  const annualSavings = calculateAnnualSavings(tier, currency);\n  const currencyInfo = SUPPORTED_CURRENCIES[currency];\n\n  return (\n    <motion.div\n      whileHover={{ y: -4 }}\n      onMouseEnter={onHover}\n      onMouseLeave={onLeave}\n      className={`relative flex flex-col h-full rounded-lg border transition-all ${\n        tier.recommended\n          ? 'bg-primary text-black border-primary'\n          : isHighlighted\n          ? 'bg-white/10 border-white/30'\n          : 'bg-white/5 border-white/10 hover:border-white/20'\n      }`}\n    >\n      {/* Recommended badge */}\n      {tier.recommended && (\n        <div className=\"absolute -top-3 left-1/2 -translate-x-1/2\">\n          <Badge className=\"bg-black text-primary px-3\">\n            <Zap className=\"w-3 h-3 mr-1\" />\n            Most Popular\n          </Badge>\n        </div>\n      )}\n\n      {/* Current tier badge */}\n      {isCurrentTier && (\n        <div className=\"absolute -top-3 right-4\">\n          <Badge variant=\"outline\" className=\"bg-emerald-500/20 text-emerald-400 border-emerald-500/30\">\n            Current Plan\n          </Badge>\n        </div>\n      )}\n\n      <div className=\"p-6 flex-1 flex flex-col\">\n        {/* Header */}\n        <div className=\"mb-4\">\n          <h3 className={`text-xl font-bold ${tier.recommended ? 'text-black' : 'text-white'}`}>\n            {tier.name}\n          </h3>\n          <p className={`text-sm ${tier.recommended ? 'text-black/70' : 'text-slate-300'}`}>\n            {tier.tagline}\n          </p>\n        </div>\n\n        {/* Price */}\n        <div className=\"mb-6\">\n          <div className=\"flex items-baseline gap-1\">\n            <span className={`text-4xl font-bold ${tier.recommended ? 'text-black' : 'text-white'}`}>\n              {tier.basePrice === 0 ? 'Free' : formatPrice(monthlyPrice / currencyInfo.rate, currency, { showDecimals: false })}\n            </span>\n            {tier.basePrice > 0 && (\n              <span className={`text-sm ${tier.recommended ? 'text-black/60' : 'text-slate-500'}`}>\n                /mo\n              </span>\n            )}\n          </div>\n          {billingCycle === 'annual' && tier.basePrice > 0 && (\n            <p className={`text-xs mt-1 ${tier.recommended ? 'text-black/70' : 'text-emerald-400'}`}>\n              Save {formatPrice(annualSavings / currencyInfo.rate, currency)} per year\n            </p>\n          )}\n        </div>\n\n        {/* Features */}\n        <ul className=\"space-y-2 mb-6 flex-1\">\n          {tier.features.slice(0, 6).map((feature) => (\n            <li\n              key={feature.id}\n              className={`flex items-center gap-2 text-sm ${\n                tier.recommended ? 'text-black/80' : 'text-slate-200'\n              }`}\n            >\n              {feature.included ? (\n                <Check className={`w-4 h-4 ${tier.recommended ? 'text-black' : 'text-emerald-500'}`} />\n              ) : (\n                <X className={`w-4 h-4 ${tier.recommended ? 'text-black/30' : 'text-slate-600'}`} />\n              )}\n              <span className={!feature.included ? 'opacity-50' : ''}>\n                {feature.name}\n                {feature.value && ` (${feature.value})`}\n              </span>\n            </li>\n          ))}\n        </ul>\n\n        {/* CTA Button */}\n        <Button\n          onClick={onSelect}\n          disabled={isCurrentTier}\n          className={`w-full ${\n            tier.recommended\n              ? 'bg-black text-white hover:bg-black/80'\n              : 'bg-white/10 text-white hover:bg-white/20 border border-white/20'\n          }`}\n        >\n          {isCurrentTier ? 'Current Plan' : tier.isEnterprise ? 'Contact Sales' : 'Get Started'}\n          {!isCurrentTier && <ArrowRight className=\"w-4 h-4 ml-2\" />}\n        </Button>\n      </div>\n    </motion.div>\n  );\n}\n\ninterface FeatureComparisonTableProps {\n  currency: CurrencyCode;\n  billingCycle: 'monthly' | 'annual';\n}\n\nfunction FeatureComparisonTable({ currency, billingCycle }: FeatureComparisonTableProps) {\n  // Get all unique features\n  const allFeatures = useMemo(() => {\n    const featureMap = new Map<string, { id: string; name: string; description: string }>();\n    PRICING_TIERS.forEach(tier => {\n      tier.features.forEach(feature => {\n        if (!featureMap.has(feature.id)) {\n          featureMap.set(feature.id, {\n            id: feature.id,\n            name: feature.name,\n            description: feature.description,\n          });\n        }\n      });\n    });\n    return Array.from(featureMap.values());\n  }, []);\n\n  return (\n    <div className=\"overflow-x-auto\">\n      <table className=\"w-full border-collapse\">\n        <thead>\n          <tr className=\"border-b border-white/10\">\n            <th className=\"text-left p-4 text-slate-300 font-medium\">Feature</th>\n            {PRICING_TIERS.map(tier => (\n              <th\n                key={tier.id}\n                className={`p-4 text-center font-medium ${\n                  tier.recommended ? 'text-primary' : 'text-white'\n                }`}\n              >\n                {tier.name}\n              </th>\n            ))}\n          </tr>\n        </thead>\n        <tbody>\n          {/* Pricing row */}\n          <tr className=\"border-b border-white/5\">\n            <td className=\"p-4 text-slate-200\">Monthly Price</td>\n            {PRICING_TIERS.map(tier => (\n              <td key={tier.id} className=\"p-4 text-center\">\n                <span className={tier.recommended ? 'text-primary font-bold' : 'text-white'}>\n                  {tier.basePrice === 0\n                    ? 'Free'\n                    : formatPrice(calculateMonthlyPrice(tier, billingCycle, currency) / SUPPORTED_CURRENCIES[currency].rate, currency)}\n                </span>\n              </td>\n            ))}\n          </tr>\n\n          {/* Feature rows */}\n          {allFeatures.map(feature => (\n            <tr key={feature.id} className=\"border-b border-white/5 hover:bg-white/5\">\n              <td className=\"p-4\">\n                <TooltipProvider>\n                  <Tooltip>\n                    <TooltipTrigger className=\"flex items-center gap-2 text-slate-200\">\n                      {feature.name}\n                      <Info className=\"w-3 h-3 text-slate-500\" />\n                    </TooltipTrigger>\n                    <TooltipContent>\n                      <p>{feature.description}</p>\n                    </TooltipContent>\n                  </Tooltip>\n                </TooltipProvider>\n              </td>\n              {PRICING_TIERS.map(tier => {\n                const tierFeature = tier.features.find(f => f.id === feature.id);\n                const included = tierFeature?.included ?? false;\n                const value = tierFeature?.value;\n\n                return (\n                  <td key={tier.id} className=\"p-4 text-center\">\n                    {value ? (\n                      <span className={tier.recommended ? 'text-primary' : 'text-white'}>\n                        {value}\n                      </span>\n                    ) : included ? (\n                      <Check className={`w-5 h-5 mx-auto ${tier.recommended ? 'text-primary' : 'text-emerald-500'}`} />\n                    ) : (\n                      <X className=\"w-5 h-5 mx-auto text-slate-600\" />\n                    )}\n                  </td>\n                );\n              })}\n            </tr>\n          ))}\n\n          {/* Limits rows */}\n          <tr className=\"border-b border-white/5\">\n            <td className=\"p-4 text-slate-200\">Monthly Uploads</td>\n            {PRICING_TIERS.map(tier => (\n              <td key={tier.id} className=\"p-4 text-center text-white\">\n                {tier.limits.monthlyUploads === 'unlimited' ? 'Unlimited' : tier.limits.monthlyUploads}\n              </td>\n            ))}\n          </tr>\n          <tr className=\"border-b border-white/5\">\n            <td className=\"p-4 text-slate-200\">Max File Size</td>\n            {PRICING_TIERS.map(tier => (\n              <td key={tier.id} className=\"p-4 text-center text-white\">\n                {tier.limits.maxFileSize >= 1024\n                  ? `${tier.limits.maxFileSize / 1024}GB`\n                  : `${tier.limits.maxFileSize}MB`}\n              </td>\n            ))}\n          </tr>\n          <tr className=\"border-b border-white/5\">\n            <td className=\"p-4 text-slate-200\">Support Level</td>\n            {PRICING_TIERS.map(tier => (\n              <td key={tier.id} className=\"p-4 text-center\">\n                <Badge\n                  variant=\"outline\"\n                  className={`capitalize ${\n                    tier.limits.supportLevel === 'dedicated'\n                      ? 'border-emerald-500/30 text-emerald-400'\n                      : tier.limits.supportLevel === 'priority'\n                      ? 'border-primary/30 text-primary'\n                      : 'border-white/20 text-slate-300'\n                  }`}\n                >\n                  {tier.limits.supportLevel}\n                </Badge>\n              </td>\n            ))}\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  );\n}\n\nexport default PricingCalculator;\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/pro-viz/charts.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'BarChart3' is defined but never used.","line":7,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PieChartIcon' is defined but never used.","line":8,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used.","line":10,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MapPin' is defined but never used.","line":11,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Camera' is defined but never used.","line":12,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Eye' is defined but never used.","line":13,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":6},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileText' is defined but never used.","line":14,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Activity' is defined but never used.","line":16,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Layers' is defined but never used.","line":17,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Filter' is defined but never used.","line":18,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Settings' is defined but never used.","line":20,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":11},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[702,705],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[702,705],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[794,797],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[794,797],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":138,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2598,2601],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2598,2601],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":143,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2852,2855],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2852,2855],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":232,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":232,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5404,5407],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5404,5407],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":237,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":237,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5658,5661],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5658,5661],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":314,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":314,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7784,7787],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7784,7787],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":319,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":319,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8038,8041],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8038,8041],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'label' is defined but never used. Allowed unused args must match /^_/u.","line":402,"column":45,"nodeType":null,"messageId":"unusedVar","endLine":402,"endColumn":50},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":402,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":402,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10217,10220],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10217,10220],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":536,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":536,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13936,13939],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13936,13939],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":546,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":546,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14168,14171],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14168,14171],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":23,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Professional Visualization Components - Advanced data visualization\n */\n\nimport React, { useState, useMemo } from 'react';\nimport {\n  BarChart3,\n  PieChart as PieChartIcon,\n  TrendingUp,\n  Calendar,\n  MapPin,\n  Camera,\n  Eye,\n  FileText,\n  Database,\n  Activity,\n  Layers,\n  Filter,\n  Download,\n  Settings,\n  Search,\n  ChevronDown,\n} from 'lucide-react';\nimport {\n  Bar,\n  BarChart,\n  Pie,\n  PieChart,\n  Line,\n  LineChart,\n  Area,\n  AreaChart,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  Legend,\n  ResponsiveContainer,\n  Cell,\n} from 'recharts';\nimport { Button } from '@/components/ui/button';\n\nexport interface ChartData {\n  name: string;\n  value: number;\n  fill?: string;\n  [key: string]: any;\n}\n\nexport interface TimeSeriesData {\n  date: string;\n  value: number;\n  [key: string]: any;\n}\n\nexport interface MetadataFieldDistribution {\n  fieldName: string;\n  count: number;\n  percentage: number;\n  avgConfidence: number;\n}\n\nexport interface ExtractionTrend {\n  date: string;\n  extractions: number;\n  successRate: number;\n  avgProcessingTime: number;\n}\n\nexport interface UserEngagementData {\n  date: string;\n  activeUsers: number;\n  newUsers: number;\n  retentionRate: number;\n}\n\nexport interface FileFormatDistribution {\n  format: string;\n  count: number;\n  percentage: number;\n  avgSize: number;\n}\n\nexport interface GeographicDistribution {\n  country: string;\n  count: number;\n  percentage: number;\n}\n\nexport interface CameraMakeDistribution {\n  make: string;\n  count: number;\n  percentage: number;\n}\n\nexport interface ProfessionalVisualizationProps {\n  data:\n    | ChartData[]\n    | TimeSeriesData[]\n    | MetadataFieldDistribution[]\n    | ExtractionTrend[]\n    | UserEngagementData[]\n    | FileFormatDistribution[]\n    | GeographicDistribution[]\n    | CameraMakeDistribution[];\n  type: 'bar' | 'line' | 'area' | 'pie' | 'scatter' | 'heatmap' | 'radar';\n  title?: string;\n  subtitle?: string;\n  xAxisKey?: string;\n  yAxisKey?: string;\n  colorScheme?: string[];\n  height?: number;\n  width?: number;\n  className?: string;\n  showLegend?: boolean;\n  showTooltip?: boolean;\n  showGrid?: boolean;\n  stacked?: boolean;\n  formatValue?: (value: number) => string;\n}\n\nconst ProfessionalBarChart: React.FC<ProfessionalVisualizationProps> = ({\n  data,\n  title,\n  subtitle,\n  xAxisKey = 'name',\n  yAxisKey = 'value',\n  colorScheme = ['#3b82f6', '#8b5cf6', '#10b981', '#f59e0b', '#ef4444'],\n  height = 400,\n  width = '100%',\n  className = '',\n  showLegend = true,\n  showTooltip = true,\n  showGrid = true,\n  stacked = false,\n  formatValue,\n}) => {\n  const CustomTooltip = ({ active, payload, label }: any) => {\n    if (active && payload && payload.length) {\n      return (\n        <div className=\"bg-background border border-border rounded-lg p-3 shadow-lg\">\n          <p className=\"font-medium text-foreground\">{label}</p>\n          {payload.map((entry: any, index: number) => (\n            <p key={index} className=\"text-sm\" style={{ color: entry.color }}>\n              {entry.name}:{' '}\n              {formatValue ? formatValue(entry.value) : entry.value}\n            </p>\n          ))}\n        </div>\n      );\n    }\n    return null;\n  };\n\n  return (\n    <div className={`bg-card border border-border rounded-xl p-6 ${className}`}>\n      <div className=\"mb-4\">\n        {title && (\n          <h3 className=\"text-lg font-semibold text-foreground mb-1\">\n            {title}\n          </h3>\n        )}\n        {subtitle && (\n          <p className=\"text-sm text-muted-foreground\">{subtitle}</p>\n        )}\n      </div>\n\n      <div style={{ height, width }}>\n        <ResponsiveContainer width=\"100%\" height=\"100%\">\n          <BarChart data={data} layout={stacked ? 'vertical' : 'horizontal'}>\n            {showGrid && (\n              <CartesianGrid\n                strokeDasharray=\"3 3\"\n                stroke=\"hsl(var(--border))\"\n              />\n            )}\n            <XAxis\n              dataKey={xAxisKey}\n              stroke=\"hsl(var(--muted-foreground))\"\n              tick={{ fill: 'hsl(var(--muted-foreground))' }}\n            />\n            <YAxis\n              stroke=\"hsl(var(--muted-foreground))\"\n              tick={{ fill: 'hsl(var(--muted-foreground))' }}\n              tickFormatter={formatValue}\n            />\n            {showTooltip && <Tooltip content={<CustomTooltip />} />}\n            {showLegend && <Legend />}\n\n            {stacked ? (\n              <>\n                {Object.keys(data[0])\n                  .filter(key => key !== xAxisKey)\n                  .map((key, index) => (\n                    <Bar\n                      key={key}\n                      dataKey={key}\n                      stackId=\"a\"\n                      fill={colorScheme[index % colorScheme.length]}\n                    />\n                  ))}\n              </>\n            ) : (\n              <Bar\n                dataKey={yAxisKey}\n                fill={colorScheme[0]}\n                radius={[4, 4, 0, 0]}\n              />\n            )}\n          </BarChart>\n        </ResponsiveContainer>\n      </div>\n    </div>\n  );\n};\n\nconst ProfessionalLineChart: React.FC<ProfessionalVisualizationProps> = ({\n  data,\n  title,\n  subtitle,\n  xAxisKey = 'date',\n  yAxisKey = 'value',\n  colorScheme = ['#3b82f6'],\n  height = 400,\n  width = '100%',\n  className = '',\n  showLegend = true,\n  showTooltip = true,\n  showGrid = true,\n  formatValue,\n}) => {\n  const CustomTooltip = ({ active, payload, label }: any) => {\n    if (active && payload && payload.length) {\n      return (\n        <div className=\"bg-background border border-border rounded-lg p-3 shadow-lg\">\n          <p className=\"font-medium text-foreground\">{label}</p>\n          {payload.map((entry: any, index: number) => (\n            <p key={index} className=\"text-sm\" style={{ color: entry.color }}>\n              {entry.name}:{' '}\n              {formatValue ? formatValue(entry.value) : entry.value}\n            </p>\n          ))}\n        </div>\n      );\n    }\n    return null;\n  };\n\n  return (\n    <div className={`bg-card border border-border rounded-xl p-6 ${className}`}>\n      <div className=\"mb-4\">\n        {title && (\n          <h3 className=\"text-lg font-semibold text-foreground mb-1\">\n            {title}\n          </h3>\n        )}\n        {subtitle && (\n          <p className=\"text-sm text-muted-foreground\">{subtitle}</p>\n        )}\n      </div>\n\n      <div style={{ height, width }}>\n        <ResponsiveContainer width=\"100%\" height=\"100%\">\n          <LineChart data={data}>\n            {showGrid && (\n              <CartesianGrid\n                strokeDasharray=\"3 3\"\n                stroke=\"hsl(var(--border))\"\n              />\n            )}\n            <XAxis\n              dataKey={xAxisKey}\n              stroke=\"hsl(var(--muted-foreground))\"\n              tick={{ fill: 'hsl(var(--muted-foreground))' }}\n            />\n            <YAxis\n              stroke=\"hsl(var(--muted-foreground))\"\n              tick={{ fill: 'hsl(var(--muted-foreground))' }}\n              tickFormatter={formatValue}\n            />\n            {showTooltip && <Tooltip content={<CustomTooltip />} />}\n            {showLegend && <Legend />}\n\n            <Line\n              type=\"monotone\"\n              dataKey={yAxisKey}\n              stroke={colorScheme[0]}\n              strokeWidth={2}\n              dot={{ r: 4 }}\n              activeDot={{ r: 6 }}\n            />\n          </LineChart>\n        </ResponsiveContainer>\n      </div>\n    </div>\n  );\n};\n\nconst ProfessionalAreaChart: React.FC<ProfessionalVisualizationProps> = ({\n  data,\n  title,\n  subtitle,\n  xAxisKey = 'date',\n  yAxisKey = 'value',\n  colorScheme = ['#3b82f6'],\n  height = 400,\n  width = '100%',\n  className = '',\n  showLegend = true,\n  showTooltip = true,\n  showGrid = true,\n  formatValue,\n}) => {\n  const CustomTooltip = ({ active, payload, label }: any) => {\n    if (active && payload && payload.length) {\n      return (\n        <div className=\"bg-background border border-border rounded-lg p-3 shadow-lg\">\n          <p className=\"font-medium text-foreground\">{label}</p>\n          {payload.map((entry: any, index: number) => (\n            <p key={index} className=\"text-sm\" style={{ color: entry.color }}>\n              {entry.name}:{' '}\n              {formatValue ? formatValue(entry.value) : entry.value}\n            </p>\n          ))}\n        </div>\n      );\n    }\n    return null;\n  };\n\n  return (\n    <div className={`bg-card border border-border rounded-xl p-6 ${className}`}>\n      <div className=\"mb-4\">\n        {title && (\n          <h3 className=\"text-lg font-semibold text-foreground mb-1\">\n            {title}\n          </h3>\n        )}\n        {subtitle && (\n          <p className=\"text-sm text-muted-foreground\">{subtitle}</p>\n        )}\n      </div>\n\n      <div style={{ height, width }}>\n        <ResponsiveContainer width=\"100%\" height=\"100%\">\n          <AreaChart data={data}>\n            {showGrid && (\n              <CartesianGrid\n                strokeDasharray=\"3 3\"\n                stroke=\"hsl(var(--border))\"\n              />\n            )}\n            <XAxis\n              dataKey={xAxisKey}\n              stroke=\"hsl(var(--muted-foreground))\"\n              tick={{ fill: 'hsl(var(--muted-foreground))' }}\n            />\n            <YAxis\n              stroke=\"hsl(var(--muted-foreground))\"\n              tick={{ fill: 'hsl(var(--muted-foreground))' }}\n              tickFormatter={formatValue}\n            />\n            {showTooltip && <Tooltip content={<CustomTooltip />} />}\n            {showLegend && <Legend />}\n\n            <Area\n              type=\"monotone\"\n              dataKey={yAxisKey}\n              fill={colorScheme[0]}\n              stroke={colorScheme[0]}\n              fillOpacity={0.3}\n            />\n          </AreaChart>\n        </ResponsiveContainer>\n      </div>\n    </div>\n  );\n};\n\nconst ProfessionalPieChart: React.FC<ProfessionalVisualizationProps> = ({\n  data,\n  title,\n  subtitle,\n  xAxisKey = 'name',\n  yAxisKey = 'value',\n  colorScheme = [\n    '#3b82f6',\n    '#8b5cf6',\n    '#10b981',\n    '#f59e0b',\n    '#ef4444',\n    '#ec4899',\n    '#6366f1',\n  ],\n  height = 400,\n  width = '100%',\n  className = '',\n  showLegend = true,\n  showTooltip = true,\n  formatValue,\n}) => {\n  const CustomTooltip = ({ active, payload, label }: any) => {\n    if (active && payload && payload.length) {\n      return (\n        <div className=\"bg-background border border-border rounded-lg p-3 shadow-lg\">\n          <p className=\"font-medium text-foreground\">{payload[0].name}</p>\n          <p className=\"text-sm text-foreground\">\n            {formatValue ? formatValue(payload[0].value) : payload[0].value}\n          </p>\n          <p className=\"text-xs text-muted-foreground\">\n            {(payload[0].percentage || 0).toFixed(1)}%\n          </p>\n        </div>\n      );\n    }\n    return null;\n  };\n\n  return (\n    <div className={`bg-card border border-border rounded-xl p-6 ${className}`}>\n      <div className=\"mb-4\">\n        {title && (\n          <h3 className=\"text-lg font-semibold text-foreground mb-1\">\n            {title}\n          </h3>\n        )}\n        {subtitle && (\n          <p className=\"text-sm text-muted-foreground\">{subtitle}</p>\n        )}\n      </div>\n\n      <div style={{ height, width }}>\n        <ResponsiveContainer width=\"100%\" height=\"100%\">\n          <PieChart>\n            {showTooltip && <Tooltip content={<CustomTooltip />} />}\n            {showLegend && <Legend />}\n\n            <Pie\n              data={data}\n              cx=\"50%\"\n              cy=\"50%\"\n              labelLine={false}\n              outerRadius={80}\n              fill=\"#8884d8\"\n              dataKey={yAxisKey}\n              nameKey={xAxisKey}\n              label={({ name, percent }) =>\n                `${name} ${(percent * 100).toFixed(0)}%`\n              }\n            >\n              {data.map((entry, index) => (\n                <Cell\n                  key={`cell-${index}`}\n                  fill={colorScheme[index % colorScheme.length]}\n                />\n              ))}\n            </Pie>\n          </PieChart>\n        </ResponsiveContainer>\n      </div>\n    </div>\n  );\n};\n\nexport interface DashboardWidgetProps {\n  title: string;\n  subtitle?: string;\n  icon?: React.ReactNode;\n  value: string | number;\n  change?: number; // Positive for increase, negative for decrease\n  changeLabel?: string;\n  trend?: 'up' | 'down';\n  footer?: React.ReactNode;\n  className?: string;\n}\n\nconst DashboardWidget: React.FC<DashboardWidgetProps> = ({\n  title,\n  subtitle,\n  icon,\n  value,\n  change,\n  changeLabel,\n  trend,\n  footer,\n  className = '',\n}) => {\n  return (\n    <div className={`bg-card border border-border rounded-xl p-6 ${className}`}>\n      <div className=\"flex items-start justify-between\">\n        <div>\n          <div className=\"flex items-center gap-2 mb-1\">\n            {icon}\n            <h3 className=\"text-sm font-medium text-muted-foreground\">\n              {title}\n            </h3>\n          </div>\n          {subtitle && (\n            <p className=\"text-xs text-muted-foreground\">{subtitle}</p>\n          )}\n        </div>\n        {change !== undefined && (\n          <div\n            className={`flex items-center gap-1 text-sm ${\n              trend === 'up' ? 'text-emerald-500' : 'text-red-500'\n            }`}\n          >\n            {trend === 'up' ? (\n              <TrendingUp className=\"w-4 h-4\" />\n            ) : (\n              <TrendingUp className=\"w-4 h-4 rotate-180\" />\n            )}\n            <span>\n              {change > 0 ? '+' : ''}\n              {change}%\n            </span>\n          </div>\n        )}\n      </div>\n\n      <div className=\"mt-4\">\n        <p className=\"text-3xl font-bold text-foreground\">{value}</p>\n        {changeLabel && (\n          <p className=\"text-xs text-muted-foreground mt-1\">{changeLabel}</p>\n        )}\n      </div>\n\n      {footer && (\n        <div className=\"mt-4 pt-4 border-t border-border\">{footer}</div>\n      )}\n    </div>\n  );\n};\n\nexport interface DataExplorerProps {\n  data: any[];\n  columns: Array<{\n    key: string;\n    label: string;\n    type?: 'text' | 'number' | 'date' | 'boolean';\n    sortable?: boolean;\n    searchable?: boolean;\n  }>;\n  title?: string;\n  description?: string;\n  onRowClick?: (row: any) => void;\n  className?: string;\n}\n\nconst DataExplorer: React.FC<DataExplorerProps> = ({\n  data,\n  columns,\n  title,\n  description,\n  onRowClick,\n  className = '',\n}) => {\n  const [sortConfig, setSortConfig] = useState<{\n    key: string;\n    direction: 'asc' | 'desc';\n  } | null>(null);\n  const [searchTerm, setSearchTerm] = useState('');\n\n  const sortedData = useMemo(() => {\n    if (!sortConfig) return data;\n\n    return [...data].sort((a, b) => {\n      const aValue = a[sortConfig.key];\n      const bValue = b[sortConfig.key];\n\n      if (aValue < bValue) {\n        return sortConfig.direction === 'asc' ? -1 : 1;\n      }\n      if (aValue > bValue) {\n        return sortConfig.direction === 'asc' ? 1 : -1;\n      }\n      return 0;\n    });\n  }, [data, sortConfig]);\n\n  const filteredData = useMemo(() => {\n    if (!searchTerm) return sortedData;\n\n    return sortedData.filter(row => {\n      return Object.values(row).some(value =>\n        String(value).toLowerCase().includes(searchTerm.toLowerCase())\n      );\n    });\n  }, [sortedData, searchTerm]);\n\n  const handleSort = (key: string) => {\n    let direction: 'asc' | 'desc' = 'asc';\n    if (\n      sortConfig &&\n      sortConfig.key === key &&\n      sortConfig.direction === 'asc'\n    ) {\n      direction = 'desc';\n    }\n    setSortConfig({ key, direction });\n  };\n\n  return (\n    <div className={`bg-card border border-border rounded-xl ${className}`}>\n      <div className=\"p-6 border-b border-border\">\n        <div className=\"flex items-center justify-between mb-4\">\n          {title && (\n            <h2 className=\"text-xl font-bold text-foreground\">{title}</h2>\n          )}\n          <div className=\"flex items-center gap-3\">\n            <div className=\"relative\">\n              <Search className=\"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground\" />\n              <input\n                type=\"text\"\n                placeholder=\"Search...\"\n                value={searchTerm}\n                onChange={e => setSearchTerm(e.target.value)}\n                className=\"pl-10 pr-4 py-2 bg-background border border-border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary/20\"\n              />\n            </div>\n            <Button variant=\"outline\" size=\"sm\">\n              <Download className=\"w-4 h-4 mr-2\" />\n              Export\n            </Button>\n          </div>\n        </div>\n        {description && (\n          <p className=\"text-sm text-muted-foreground\">{description}</p>\n        )}\n      </div>\n\n      <div className=\"overflow-x-auto\">\n        <table className=\"w-full\">\n          <thead className=\"bg-muted\">\n            <tr>\n              {columns.map(column => (\n                <th\n                  key={column.key}\n                  className=\"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider\"\n                >\n                  {column.sortable ? (\n                    <button\n                      onClick={() => handleSort(column.key)}\n                      className=\"flex items-center gap-1 hover:text-foreground transition-colors\"\n                    >\n                      {column.label}\n                      {sortConfig?.key === column.key && (\n                        <ChevronDown\n                          className={`w-4 h-4 ${sortConfig.direction === 'desc' ? 'rotate-180' : ''}`}\n                        />\n                      )}\n                    </button>\n                  ) : (\n                    column.label\n                  )}\n                </th>\n              ))}\n            </tr>\n          </thead>\n          <tbody className=\"divide-y divide-border\">\n            {filteredData.map((row, rowIndex) => (\n              <tr\n                key={rowIndex}\n                className={`hover:bg-muted/50 transition-colors ${\n                  onRowClick ? 'cursor-pointer' : ''\n                }`}\n                onClick={() => onRowClick && onRowClick(row)}\n              >\n                {columns.map(column => (\n                  <td\n                    key={column.key}\n                    className=\"px-6 py-4 whitespace-nowrap text-sm text-foreground\"\n                  >\n                    {column.type === 'date'\n                      ? new Date(row[column.key]).toLocaleDateString()\n                      : String(row[column.key])}\n                  </td>\n                ))}\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      </div>\n\n      {filteredData.length === 0 && (\n        <div className=\"py-12 text-center text-muted-foreground\">\n          <Database className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\n          <p>No data found</p>\n          <p className=\"text-sm mt-1\">\n            Try adjusting your search or filter criteria\n          </p>\n        </div>\n      )}\n    </div>\n  );\n};\n\n// Export all visualization components\n// Default export\nexport default {\n  ProfessionalBarChart,\n  ProfessionalLineChart,\n  ProfessionalAreaChart,\n  ProfessionalPieChart,\n  DashboardWidget,\n  DataExplorer,\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/public-layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/sample-files.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":119,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":119,"endColumn":20,"suggestions":[{"fix":{"range":[3165,3213],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":165,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":165,"endColumn":20,"suggestions":[{"fix":{"range":[4561,4610],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport {\n  Image,\n  Video,\n  Music,\n  FileText,\n  MapPin,\n  Camera,\n  Zap,\n  HardDrive,\n  Loader2,\n} from 'lucide-react';\nimport { motion } from 'framer-motion';\nimport { cn } from '@/lib/utils';\nimport { useToast } from '@/hooks/use-toast';\n\ninterface SampleFile {\n  id: string;\n  name: string;\n  filename: string;\n  description: string;\n  size: string;\n  type: string;\n  highlights: string[];\n  tier_required: string;\n}\n\ninterface SampleFilesProps {\n  onSampleSelect: (sampleId: string) => void;\n  currentTier: string;\n  className?: string;\n}\n\nconst getFileIcon = (type: string) => {\n  if (type.startsWith('image/')) return Image;\n  if (type.startsWith('video/')) return Video;\n  if (type.startsWith('audio/')) return Music;\n  if (type === 'application/pdf') return FileText;\n  return FileText;\n};\n\nconst getFileTypeColor = (type: string) => {\n  if (type.startsWith('image/'))\n    return 'bg-blue-500/10 text-blue-600 border-blue-200';\n  if (type.startsWith('video/'))\n    return 'bg-purple-500/10 text-purple-600 border-purple-200';\n  if (type.startsWith('audio/'))\n    return 'bg-green-500/10 text-green-600 border-green-200';\n  if (type === 'application/pdf')\n    return 'bg-red-500/10 text-red-600 border-red-200';\n  return 'bg-gray-500/10 text-gray-600 border-gray-200';\n};\n\nconst getTierColor = (tier: string) => {\n  switch (tier) {\n    case 'free':\n      return 'bg-gray-100 text-gray-800';\n    case 'professional':\n      return 'bg-blue-100 text-blue-800';\n    case 'forensic':\n      return 'bg-purple-100 text-purple-800';\n    case 'enterprise':\n      return 'bg-yellow-100 text-yellow-800';\n    case 'starter':\n      return 'bg-blue-100 text-blue-800';\n    case 'premium':\n      return 'bg-purple-100 text-purple-800';\n    case 'super':\n      return 'bg-yellow-100 text-yellow-800';\n    default:\n      return 'bg-gray-100 text-gray-800';\n  }\n};\n\nconst getHighlightIcon = (highlight: string) => {\n  if (\n    highlight.toLowerCase().includes('gps') ||\n    highlight.toLowerCase().includes('location')\n  )\n    return MapPin;\n  if (\n    highlight.toLowerCase().includes('camera') ||\n    highlight.toLowerCase().includes('lens')\n  )\n    return Camera;\n  if (\n    highlight.toLowerCase().includes('codec') ||\n    highlight.toLowerCase().includes('stream')\n  )\n    return Video;\n  return Zap;\n};\n\nexport function SampleFiles({\n  onSampleSelect,\n  currentTier,\n  className,\n}: SampleFilesProps) {\n  const [samples, setSamples] = useState<SampleFile[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [processingId, setProcessingId] = useState<string | null>(null);\n  const { toast } = useToast();\n\n  useEffect(() => {\n    fetchSamples();\n  }, []);\n\n  const fetchSamples = async () => {\n    try {\n      const response = await fetch('/api/samples');\n      if (!response.ok) throw new Error('Failed to fetch samples');\n\n      const data = await response.json();\n      setSamples(data.samples);\n    } catch (error) {\n      console.error('Error fetching samples:', error);\n      toast({\n        title: 'Error',\n        description: 'Failed to load sample files',\n        variant: 'destructive',\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSampleSelect = async (sample: SampleFile) => {\n    setProcessingId(sample.id);\n\n    try {\n      // Download and process the sample file\n      const downloadResponse = await fetch(\n        `/api/samples/${sample.id}/download`\n      );\n      if (!downloadResponse.ok) throw new Error('Failed to download sample');\n\n      const blob = await downloadResponse.blob();\n      const file = new File([blob], sample.filename, { type: sample.type });\n\n      // Create form data and submit for processing\n      const formData = new FormData();\n      formData.append('file', file);\n\n      const processResponse = await fetch(`/api/extract?tier=${currentTier}`, {\n        method: 'POST',\n        body: formData,\n      });\n\n      if (!processResponse.ok) throw new Error('Failed to process sample');\n\n      const result = await processResponse.json();\n\n      // Store result and navigate to results\n      sessionStorage.setItem('currentMetadata', JSON.stringify(result));\n      onSampleSelect(sample.id);\n\n      toast({\n        title: 'Sample processed',\n        description: `${sample.name} has been analyzed successfully`,\n      });\n    } catch (error) {\n      console.error('Error processing sample:', error);\n      toast({\n        title: 'Processing failed',\n        description:\n          error instanceof Error\n            ? error.message\n            : 'Failed to process sample file',\n        variant: 'destructive',\n      });\n    } finally {\n      setProcessingId(null);\n    }\n  };\n\n  const canAccessSample = (sampleTier: string) => {\n    const tierLevels = {\n      free: 0,\n      professional: 1,\n      forensic: 2,\n      enterprise: 3,\n      starter: 1,\n      premium: 2,\n      super: 3,\n    };\n    return (\n      tierLevels[currentTier as keyof typeof tierLevels] >=\n      tierLevels[sampleTier as keyof typeof tierLevels]\n    );\n  };\n\n  if (loading) {\n    return (\n      <div className={cn('flex items-center justify-center p-8', className)}>\n        <Loader2 className=\"w-6 h-6 animate-spin text-muted-foreground\" />\n        <span className=\"ml-2 text-muted-foreground\">\n          Loading sample files...\n        </span>\n      </div>\n    );\n  }\n\n  return (\n    <div className={cn('space-y-4', className)}>\n      <div className=\"text-center mb-6\">\n        <h3 className=\"text-lg font-semibold mb-2\">Try Sample Files</h3>\n        <p className=\"text-muted-foreground text-sm\">\n          Explore MetaExtract capabilities with pre-loaded examples\n        </p>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n        {samples.map((sample, index) => {\n          const FileIcon = getFileIcon(sample.type);\n          const canAccess = canAccessSample(sample.tier_required);\n          const isProcessing = processingId === sample.id;\n\n          return (\n            <motion.div\n              key={sample.id}\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: index * 0.1 }}\n            >\n              <Card\n                className={cn(\n                  'h-full transition-all duration-200 hover:shadow-md',\n                  !canAccess && 'opacity-60',\n                  isProcessing && 'ring-2 ring-primary'\n                )}\n              >\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-start justify-between\">\n                    <div\n                      className={cn(\n                        'w-10 h-10 rounded-lg flex items-center justify-center border',\n                        getFileTypeColor(sample.type)\n                      )}\n                    >\n                      <FileIcon className=\"w-5 h-5\" />\n                    </div>\n\n                    <Badge\n                      variant=\"outline\"\n                      className={cn(\n                        'text-xs',\n                        getTierColor(sample.tier_required)\n                      )}\n                    >\n                      {sample.tier_required}\n                    </Badge>\n                  </div>\n\n                  <CardTitle className=\"text-base\">{sample.name}</CardTitle>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {sample.description}\n                  </p>\n                </CardHeader>\n\n                <CardContent className=\"pt-0\">\n                  <div className=\"space-y-3\">\n                    {/* File Info */}\n                    <div className=\"flex items-center justify-between text-xs text-muted-foreground\">\n                      <span className=\"flex items-center gap-1\">\n                        <HardDrive className=\"w-3 h-3\" />\n                        {sample.size}\n                      </span>\n                      <span className=\"font-mono\">{sample.filename}</span>\n                    </div>\n\n                    {/* Highlights */}\n                    <div className=\"space-y-2\">\n                      <p className=\"text-xs font-medium text-muted-foreground\">\n                        Key Features:\n                      </p>\n                      <div className=\"space-y-1\">\n                        {sample.highlights.slice(0, 3).map((highlight, i) => {\n                          const HighlightIcon = getHighlightIcon(highlight);\n                          return (\n                            <div\n                              key={i}\n                              className=\"flex items-center gap-2 text-xs\"\n                            >\n                              <HighlightIcon className=\"w-3 h-3 text-primary\" />\n                              <span>{highlight}</span>\n                            </div>\n                          );\n                        })}\n                      </div>\n                    </div>\n\n                    {/* Action Button */}\n                    <Button\n                      onClick={() => handleSampleSelect(sample)}\n                      disabled={!canAccess || isProcessing}\n                      className=\"w-full mt-4\"\n                      size=\"sm\"\n                    >\n                      {isProcessing ? (\n                        <>\n                          <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                          Processing...\n                        </>\n                      ) : !canAccess ? (\n                        <>\n                          <Badge className=\"mr-2\">{sample.tier_required}</Badge>\n                          Upgrade Required\n                        </>\n                      ) : (\n                        <>\n                          <Zap className=\"w-4 h-4 mr-2\" />\n                          Analyze Sample\n                        </>\n                      )}\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            </motion.div>\n          );\n        })}\n      </div>\n\n      {/* Tier Upgrade Prompt */}\n      {samples.some(s => !canAccessSample(s.tier_required)) && (\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"text-center p-4 bg-muted/50 rounded-lg border border-dashed\"\n        >\n          <p className=\"text-sm text-muted-foreground mb-2\">\n            Some samples require higher tier access\n          </p>\n          <Button variant=\"outline\" size=\"sm\">\n            View Pricing Plans\n          </Button>\n        </motion.div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/subscription-manager.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/theme-toggle.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/timeline-visualization.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used.","line":8,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'timeline_events' is assigned a value but never used.","line":152,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":152,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { \n  Clock, \n  Calendar, \n  MapPin, \n  Camera, \n  AlertTriangle,\n  CheckCircle,\n  FileText,\n  Download,\n  Filter,\n  Zap,\n  TrendingUp\n} from 'lucide-react';\n\ninterface TimelineEvent {\n  timestamp: string;\n  event_type: 'creation' | 'modification' | 'access' | 'capture' | 'processing';\n  file_name: string;\n  file_index: number;\n  description: string;\n  metadata_source: string;\n  confidence: number;\n  location?: {\n    latitude: number;\n    longitude: number;\n    address?: string;\n  };\n  device_info?: {\n    camera_make?: string;\n    camera_model?: string;\n    software?: string;\n  };\n}\n\ninterface TimelineGap {\n  start_time: string;\n  end_time: string;\n  duration_hours: number;\n  gap_type: 'suspicious' | 'normal' | 'expected';\n  description: string;\n}\n\ninterface TimelineResult {\n  timeline_id: string;\n  total_files: number;\n  file_names: string[];\n  processing_time_ms: number;\n  timeline: {\n    events: TimelineEvent[];\n    gaps: TimelineGap[];\n    summary: {\n      total_events: number;\n      time_span_hours: number;\n      suspicious_gaps: number;\n      chain_of_custody_score: number;\n      temporal_consistency: number;\n    };\n    patterns: {\n      device_changes: number;\n      location_changes: number;\n      suspicious_sequences: string[];\n    };\n    recommendations: string[];\n  };\n}\n\ninterface TimelineVisualizationProps {\n  timelineResult: TimelineResult;\n}\n\nexport function TimelineVisualization({ timelineResult }: TimelineVisualizationProps) {\n  const [selectedEventTypes, setSelectedEventTypes] = useState<string[]>([]);\n  const [showSuspiciousOnly, setShowSuspiciousOnly] = useState(false);\n\n  const { timeline } = timelineResult;\n\n  const getEventIcon = (eventType: string) => {\n    switch (eventType) {\n      case 'creation':\n        return <FileText className=\"h-4 w-4 text-blue-600\" />;\n      case 'modification':\n        return <Zap className=\"h-4 w-4 text-yellow-600\" />;\n      case 'access':\n        return <Clock className=\"h-4 w-4 text-gray-600\" />;\n      case 'capture':\n        return <Camera className=\"h-4 w-4 text-green-600\" />;\n      case 'processing':\n        return <TrendingUp className=\"h-4 w-4 text-purple-600\" />;\n      default:\n        return <Clock className=\"h-4 w-4 text-gray-600\" />;\n    }\n  };\n\n  const getEventColor = (eventType: string) => {\n    switch (eventType) {\n      case 'creation':\n        return 'border-blue-200 bg-blue-50';\n      case 'modification':\n        return 'border-yellow-200 bg-yellow-50';\n      case 'access':\n        return 'border-gray-200 bg-gray-50';\n      case 'capture':\n        return 'border-green-200 bg-green-50';\n      case 'processing':\n        return 'border-purple-200 bg-purple-50';\n      default:\n        return 'border-gray-200 bg-gray-50';\n    }\n  };\n\n  const getGapColor = (gapType: string) => {\n    switch (gapType) {\n      case 'suspicious':\n        return 'border-red-200 bg-red-50 text-red-800';\n      case 'normal':\n        return 'border-gray-200 bg-gray-50 text-gray-800';\n      case 'expected':\n        return 'border-green-200 bg-green-50 text-green-800';\n      default:\n        return 'border-gray-200 bg-gray-50 text-gray-800';\n    }\n  };\n\n  const getConfidenceColor = (confidence: number) => {\n    if (confidence >= 0.8) return 'text-green-600';\n    if (confidence >= 0.6) return 'text-yellow-600';\n    return 'text-red-600';\n  };\n\n  const formatDuration = (hours: number) => {\n    if (hours < 1) return `${Math.round(hours * 60)} minutes`;\n    if (hours < 24) return `${hours.toFixed(1)} hours`;\n    return `${Math.round(hours / 24)} days`;\n  };\n\n  const filteredEvents = timeline.events.filter(event => {\n    if (selectedEventTypes.length > 0 && !selectedEventTypes.includes(event.event_type)) {\n      return false;\n    }\n    if (showSuspiciousOnly && event.confidence >= 0.8) {\n      return false;\n    }\n    return true;\n  });\n\n  // Add timeline_events reference for testing\n  const timeline_events = timeline.events;\n\n  const exportTimeline = () => {\n    const exportData = {\n      timeline_id: timelineResult.timeline_id,\n      generated_at: new Date().toISOString(),\n      files: timelineResult.file_names,\n      timeline_analysis: timeline,\n      forensic_summary: {\n        chain_of_custody_score: timeline.summary.chain_of_custody_score,\n        temporal_consistency: timeline.summary.temporal_consistency,\n        suspicious_gaps: timeline.summary.suspicious_gaps,\n        recommendations: timeline.recommendations\n      }\n    };\n\n    const blob = new Blob([JSON.stringify(exportData, null, 2)], { \n      type: 'application/json' \n    });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `timeline-analysis-${timelineResult.timeline_id}.json`;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <Card className=\"border-purple-200 bg-purple-50\">\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <CardTitle className=\"flex items-center gap-2 text-purple-900\">\n              <Clock className=\"h-6 w-6\" />\n              Timeline Reconstruction\n            </CardTitle>\n            <Button onClick={exportTimeline} variant=\"outline\" size=\"sm\">\n              <Download className=\"h-4 w-4 mr-2\" />\n              Export Timeline\n            </Button>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold text-purple-700\">\n                {timeline.events.length}\n              </div>\n              <div className=\"text-sm text-purple-600\">Timeline Events</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold text-blue-700\">\n                {formatDuration(timeline.summary.time_span_hours)}\n              </div>\n              <div className=\"text-sm text-blue-600\">Time Span</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold text-green-700\">\n                {(timeline.summary.chain_of_custody_score * 100).toFixed(0)}%\n              </div>\n              <div className=\"text-sm text-green-600\">Chain of Custody</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold text-orange-700\">\n                {timeline.summary.suspicious_gaps}\n              </div>\n              <div className=\"text-sm text-orange-600\">Suspicious Gaps</div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Suspicious Patterns Alert */}\n      {timeline.patterns.suspicious_sequences.length > 0 && (\n        <Alert className=\"border-red-200 bg-red-50\">\n          <AlertTriangle className=\"h-4 w-4 text-red-600\" />\n          <AlertDescription className=\"text-red-800\">\n            <strong>Suspicious Timeline Patterns Detected:</strong>\n            <ul className=\"mt-2 list-disc list-inside\">\n              {timeline.patterns.suspicious_sequences.map((pattern, index) => (\n                <li key={index}>{pattern}</li>\n              ))}\n            </ul>\n          </AlertDescription>\n        </Alert>\n      )}\n\n      {/* Timeline Summary */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card>\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-lg flex items-center gap-2\">\n              <TrendingUp className=\"h-5 w-5 text-blue-600\" />\n              Temporal Consistency\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-3xl font-bold text-blue-700\">\n              {(timeline.summary.temporal_consistency * 100).toFixed(1)}%\n            </div>\n            <div className=\"text-sm text-gray-600 mt-1\">\n              Timestamp reliability across files\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-lg flex items-center gap-2\">\n              <Camera className=\"h-5 w-5 text-green-600\" />\n              Device Changes\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-3xl font-bold text-green-700\">\n              {timeline.patterns.device_changes}\n            </div>\n            <div className=\"text-sm text-gray-600 mt-1\">\n              Different devices detected\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-lg flex items-center gap-2\">\n              <MapPin className=\"h-5 w-5 text-orange-600\" />\n              Location Changes\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-3xl font-bold text-orange-700\">\n              {timeline.patterns.location_changes}\n            </div>\n            <div className=\"text-sm text-gray-600 mt-1\">\n              Geographic locations detected\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Filters */}\n      <Card>\n        <CardContent className=\"pt-6\">\n          <div className=\"flex items-center gap-4 mb-4\">\n            <Button\n              variant={showSuspiciousOnly ? \"default\" : \"outline\"}\n              size=\"sm\"\n              onClick={() => setShowSuspiciousOnly(!showSuspiciousOnly)}\n            >\n              <Filter className=\"h-4 w-4 mr-2\" />\n              {showSuspiciousOnly ? 'Show All Events' : 'Show Suspicious Only'}\n            </Button>\n          </div>\n\n          <div className=\"flex flex-wrap gap-2\">\n            {['creation', 'modification', 'access', 'capture', 'processing'].map(eventType => (\n              <Button\n                key={eventType}\n                variant={selectedEventTypes.includes(eventType) ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={() => {\n                  setSelectedEventTypes(prev => \n                    prev.includes(eventType) \n                      ? prev.filter(t => t !== eventType)\n                      : [...prev, eventType]\n                  );\n                }}\n              >\n                {getEventIcon(eventType)}\n                <span className=\"ml-2 capitalize\">{eventType}</span>\n              </Button>\n            ))}\n          </div>\n\n          <div className=\"text-sm text-gray-600 mt-2\">\n            Showing {filteredEvents.length} of {timeline.events.length} events\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Timeline Events */}\n      <div className=\"space-y-4\">\n        <h3 className=\"text-lg font-semibold\">Timeline Events</h3>\n        \n        <div className=\"relative\">\n          {/* Timeline Line */}\n          <div className=\"absolute left-8 top-0 bottom-0 w-0.5 bg-gray-300\"></div>\n          \n          <div className=\"space-y-4\">\n            {filteredEvents.map((event, index) => (\n              <div key={index} className=\"relative flex items-start gap-4\">\n                {/* Timeline Dot */}\n                <div className={`relative z-10 flex items-center justify-center w-8 h-8 rounded-full border-2 ${getEventColor(event.event_type)} border-current`}>\n                  {getEventIcon(event.event_type)}\n                </div>\n\n                {/* Event Card */}\n                <Card className={`flex-1 ${getEventColor(event.event_type)}`}>\n                  <CardContent className=\"pt-4\">\n                    <div className=\"flex items-center justify-between mb-2\">\n                      <div className=\"flex items-center gap-2\">\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          {event.event_type.toUpperCase()}\n                        </Badge>\n                        <span className=\"font-medium\">{event.file_name}</span>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <span className={`text-sm font-medium ${getConfidenceColor(event.confidence)}`}>\n                          {(event.confidence * 100).toFixed(0)}% confidence\n                        </span>\n                      </div>\n                    </div>\n\n                    <div className=\"text-sm text-gray-700 mb-2\">\n                      {event.description}\n                    </div>\n\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-xs\">\n                      <div>\n                        <span className=\"font-medium\">Timestamp:</span>\n                        <div className=\"mt-1\">\n                          {new Date(event.timestamp).toLocaleString()}\n                        </div>\n                      </div>\n                      <div>\n                        <span className=\"font-medium\">Source:</span>\n                        <div className=\"mt-1\">{event.metadata_source}</div>\n                      </div>\n                    </div>\n\n                    {event.location && (\n                      <div className=\"mt-3 p-2 bg-white bg-opacity-50 rounded text-xs\">\n                        <div className=\"flex items-center gap-1 mb-1\">\n                          <MapPin className=\"h-3 w-3\" />\n                          <span className=\"font-medium\">Location</span>\n                        </div>\n                        <div>\n                          {event.location.latitude.toFixed(6)}, {event.location.longitude.toFixed(6)}\n                          {event.location.address && (\n                            <div className=\"text-gray-600 mt-1\">{event.location.address}</div>\n                          )}\n                        </div>\n                      </div>\n                    )}\n\n                    {event.device_info && (\n                      <div className=\"mt-3 p-2 bg-white bg-opacity-50 rounded text-xs\">\n                        <div className=\"flex items-center gap-1 mb-1\">\n                          <Camera className=\"h-3 w-3\" />\n                          <span className=\"font-medium\">Device Info</span>\n                        </div>\n                        <div className=\"space-y-1\">\n                          {event.device_info.camera_make && (\n                            <div>Camera: {event.device_info.camera_make} {event.device_info.camera_model}</div>\n                          )}\n                          {event.device_info.software && (\n                            <div>Software: {event.device_info.software}</div>\n                          )}\n                        </div>\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n\n      {/* Timeline Gaps */}\n      {timeline.gaps.length > 0 && (\n        <div className=\"space-y-4\">\n          <h3 className=\"text-lg font-semibold\">Timeline Gaps</h3>\n          <div className=\"space-y-3\">\n            {timeline.gaps.map((gap, index) => (\n              <Card key={index} className={getGapColor(gap.gap_type)}>\n                <CardContent className=\"pt-4\">\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <div className=\"flex items-center gap-2\">\n                      <AlertTriangle className=\"h-4 w-4\" />\n                      <span className=\"font-medium capitalize\">{gap.gap_type} Gap</span>\n                    </div>\n                    <Badge variant=\"outline\" className=\"text-xs\">\n                      {formatDuration(gap.duration_hours)}\n                    </Badge>\n                  </div>\n                  <div className=\"text-sm mb-2\">{gap.description}</div>\n                  <div className=\"text-xs\">\n                    <span className=\"font-medium\">Period:</span> {new Date(gap.start_time).toLocaleString()}  {new Date(gap.end_time).toLocaleString()}\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Recommendations */}\n      {timeline.recommendations.length > 0 && (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Timeline Analysis Recommendations</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <ul className=\"space-y-2\">\n              {timeline.recommendations.map((recommendation, index) => (\n                <li key={index} className=\"flex items-start gap-2\">\n                  <CheckCircle className=\"h-4 w-4 text-blue-600 mt-0.5 flex-shrink-0\" />\n                  <span className=\"text-sm\">{recommendation}</span>\n                </li>\n              ))}\n            </ul>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/trial-access-modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/tutorial-overlay.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/tutorial/SkipButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/tutorial/StepNavigator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/tutorial/Tooltip.tsx","messages":[{"ruleId":"jsx-a11y/click-events-have-key-events","severity":1,"message":"Visible, non-interactive elements with click handlers must have at least one keyboard listener.","line":129,"column":7,"nodeType":"JSXOpeningElement","endLine":136,"endColumn":8},{"ruleId":"jsx-a11y/no-static-element-interactions","severity":1,"message":"Avoid non-native interactive elements. If using native HTML is not possible, add an appropriate role and support for tabbing, mouse, keyboard, and touch inputs to an interactive content element.","line":129,"column":7,"nodeType":"JSXOpeningElement","endLine":136,"endColumn":8}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Tooltip - Contextual tooltip component\n */\n\nimport React, { useState, useRef, useEffect } from 'react';\nimport { Info, AlertCircle, HelpCircle } from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\nexport type TooltipPosition = 'top' | 'bottom' | 'left' | 'right';\nexport type TooltipVariant = 'info' | 'warning' | 'help' | 'custom';\n\ninterface TooltipProps {\n  content: React.ReactNode;\n  position?: TooltipPosition;\n  variant?: TooltipVariant;\n  children: React.ReactElement;\n  delay?: number;\n  trigger?: 'hover' | 'click' | 'focus';\n  className?: string;\n  maxWidth?: string;\n}\n\nexport function Tooltip({\n  content,\n  position = 'top',\n  variant = 'info',\n  children,\n  delay = 200,\n  trigger = 'hover',\n  className,\n  maxWidth = '300px',\n}: TooltipProps) {\n  const [isVisible, setIsVisible] = useState(false);\n  const [isClicked, setIsClicked] = useState(false);\n  const timeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n  const tooltipRef = useRef<HTMLDivElement>(null);\n\n  const handleMouseEnter = () => {\n    if (trigger === 'hover') {\n      if (timeoutRef.current) {\n        clearTimeout(timeoutRef.current);\n      }\n      timeoutRef.current = setTimeout(() => {\n        setIsVisible(true);\n      }, delay);\n    }\n  };\n\n  const handleMouseLeave = () => {\n    if (trigger === 'hover') {\n      if (timeoutRef.current) {\n        clearTimeout(timeoutRef.current);\n      }\n      setIsVisible(false);\n    }\n  };\n\n  const handleClick = () => {\n    if (trigger === 'click') {\n      setIsClicked(!isClicked);\n    }\n  };\n\n  const handleFocus = () => {\n    if (trigger === 'focus') {\n      setIsVisible(true);\n    }\n  };\n\n  const handleBlur = () => {\n    if (trigger === 'focus') {\n      setIsVisible(false);\n    }\n  };\n\n  useEffect(() => {\n    return () => {\n      if (timeoutRef.current) {\n        clearTimeout(timeoutRef.current);\n      }\n    };\n  }, []);\n\n  const shouldShow = trigger === 'click' ? isClicked : isVisible;\n\n  const getIcon = () => {\n    switch (variant) {\n      case 'warning':\n        return <AlertCircle size={16} />;\n      case 'help':\n        return <HelpCircle size={16} />;\n      case 'info':\n      case 'custom':\n      default:\n        return <Info size={16} />;\n    }\n  };\n\n  const getPositionClasses = () => {\n    const baseClasses = 'absolute z-50';\n    switch (position) {\n      case 'top':\n        return `${baseClasses} bottom-full left-1/2 -translate-x-1/2 mb-2`;\n      case 'bottom':\n        return `${baseClasses} top-full left-1/2 -translate-x-1/2 mt-2`;\n      case 'left':\n        return `${baseClasses} right-full top-1/2 -translate-y-1/2 mr-2`;\n      case 'right':\n        return `${baseClasses} left-full top-1/2 -translate-y-1/2 ml-2`;\n    }\n  };\n\n  const getArrowClasses = () => {\n    switch (position) {\n      case 'top':\n        return 'absolute -bottom-1 left-1/2 -translate-x-1/2 border-l border-r border-t border-gray-900 border-b-transparent transform rotate-45 w-2 h-2';\n      case 'bottom':\n        return 'absolute -top-1 left-1/2 -translate-x-1/2 border-l border-r border-b border-gray-900 border-t-transparent transform rotate-45 w-2 h-2';\n      case 'left':\n        return 'absolute -right-1 top-1/2 -translate-y-1/2 border-t border-b border-l border-gray-900 border-r-transparent transform rotate-45 w-2 h-2';\n      case 'right':\n        return 'absolute -left-1 top-1/2 -translate-y-1/2 border-t border-b border-r border-gray-900 border-l-transparent transform rotate-45 w-2 h-2';\n    }\n  };\n\n  return (\n    <div className={cn('relative inline-flex', className)}>\n      {/* Trigger */}\n      <div\n        onMouseEnter={handleMouseEnter}\n        onMouseLeave={handleMouseLeave}\n        onClick={handleClick}\n        onFocus={handleFocus}\n        onBlur={handleBlur}\n        className=\"inline-flex items-center\"\n      >\n        {children}\n      </div>\n\n      {/* Tooltip */}\n      {shouldShow && (\n        <div\n          ref={tooltipRef}\n          className={cn(\n            getPositionClasses(),\n            'bg-gray-900 text-white px-3 py-2 rounded-lg shadow-lg',\n            'text-sm leading-relaxed',\n            'animate-in fade-in zoom-in duration-200'\n          )}\n          style={{ maxWidth }}\n          role=\"tooltip\"\n          aria-live=\"polite\"\n        >\n          {/* Icon */}\n          <div className=\"flex items-start gap-2\">\n            <span className=\"mt-0.5 flex-shrink-0 text-blue-400\">\n              {getIcon()}\n            </span>\n            <span className=\"flex-1\">{content}</span>\n          </div>\n\n          {/* Arrow */}\n          <div className={getArrowClasses()} />\n\n          {/* Close button for click-triggered tooltips */}\n          {trigger === 'click' && (\n            <button\n              onClick={() => setIsClicked(false)}\n              type=\"button\"\n              className=\"absolute top-1 right-1 text-gray-400 hover:text-white\"\n              aria-label=\"Close tooltip\"\n            >\n              <span className=\"sr-only\">Close</span>\n              <svg\n                width=\"16\"\n                height=\"16\"\n                viewBox=\"0 0 24 24\"\n                fill=\"none\"\n                stroke=\"currentColor\"\n                strokeWidth=\"2\"\n              >\n                <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\n                <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\n              </svg>\n            </button>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\n/**\n * QuickTooltip - Simplified tooltip for inline help\n */\n\ninterface QuickTooltipProps {\n  text: string;\n  children: React.ReactNode;\n  side?: 'top' | 'bottom';\n}\n\nexport function QuickTooltip({\n  text,\n  children,\n  side = 'top',\n}: QuickTooltipProps) {\n  return (\n    <Tooltip\n      content={text}\n      position={side}\n      variant=\"help\"\n      trigger=\"hover\"\n      delay={100}\n    >\n      <span className=\"inline-flex items-center gap-1 text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 cursor-help\">\n        {children}\n      </span>\n    </Tooltip>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/tutorial/TutorialOverlay.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onComplete' is defined but never used. Allowed unused args must match /^_/u.","line":33,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mounted' is assigned a value but never used.","line":43,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":43,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'targetRect' is defined but never used. Allowed unused args must match /^_/u.","line":277,"column":47,"nodeType":null,"messageId":"unusedVar","endLine":277,"endColumn":57},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'offset' is assigned a value but never used.","line":278,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":278,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Tutorial Overlay - Spotlight overlay for tutorials\n */\n\nimport React, { useEffect, useRef, useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { X, ArrowRight, ArrowLeft, Pause, Play, RotateCcw } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { Button } from '@/components/ui/button';\nimport type { OnboardingStep } from '@/lib/onboarding/onboarding-engine';\n\ninterface TutorialOverlayProps {\n  step: OnboardingStep | null;\n  stepIndex: number;\n  totalSteps: number;\n  isPaused: boolean;\n  onComplete: () => void;\n  onSkip: () => void;\n  onNext: () => void;\n  onPrevious: () => void;\n  onPause: () => void;\n  onResume: () => void;\n  onRestart: () => void;\n  onDismiss: () => void;\n  isLoading?: boolean;\n}\n\nexport function TutorialOverlay({\n  step,\n  stepIndex,\n  totalSteps,\n  isPaused,\n  onComplete,\n  onSkip,\n  onNext,\n  onPrevious,\n  onPause,\n  onResume,\n  onRestart,\n  onDismiss,\n  isLoading = false,\n}: TutorialOverlayProps) {\n  const [mounted, setMounted] = useState(false);\n\n  useEffect(() => {\n    setMounted(true);\n    return () => setMounted(false);\n  }, []);\n  const [targetRect, setTargetRect] = useState<DOMRect | null>(null);\n  const spotlightRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (!step?.target) {\n      setTargetRect(null);\n      return;\n    }\n\n    const targetElement = document.querySelector(step.target);\n    if (targetElement) {\n      const rect = targetElement.getBoundingClientRect();\n      setTargetRect(rect);\n\n      // Scroll element into view\n      targetElement.scrollIntoView({\n        behavior: 'smooth',\n        block: 'center',\n        inline: 'center',\n      });\n\n      // Highlight element\n      targetElement.classList.add('tutorial-highlight');\n      return () => {\n        targetElement.classList.remove('tutorial-highlight');\n      };\n    } else {\n      setTargetRect(null);\n    }\n  }, [step?.target]);\n\n  if (!step) {\n    return null;\n  }\n\n  const isCentered = step.position === 'center';\n  const showSkip = step.skippable;\n\n  return (\n    <AnimatePresence>\n      <motion.div\n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        exit={{ opacity: 0 }}\n        transition={{ duration: 0.3 }}\n        className=\"fixed inset-0 z-[9999] pointer-events-none\"\n      >\n        {/* Backdrop */}\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          className=\"absolute inset-0 bg-black/60 backdrop-blur-sm\"\n          onClick={onDismiss}\n        />\n\n        {/* Spotlight */}\n        {!isCentered && targetRect && (\n          <motion.div\n            initial={{ opacity: 0, scale: 0.8 }}\n            animate={{ opacity: 1, scale: 1 }}\n            transition={{ duration: 0.3 }}\n            className=\"absolute\"\n            style={{\n              left: targetRect.left - 8,\n              top: targetRect.top - 8,\n              width: targetRect.width + 16,\n              height: targetRect.height + 16,\n              borderRadius: '12px',\n              boxShadow: '0 0 0 9999px rgba(0, 0, 0, 0.6)',\n            }}\n          >\n            <div className=\"absolute inset-0 border-2 border-blue-500 rounded-lg animate-pulse\" />\n          </motion.div>\n        )}\n\n        {/* Tooltip Card */}\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          exit={{ opacity: 0, y: -20 }}\n          transition={{ duration: 0.3, delay: 0.1 }}\n          className={cn(\n            'absolute max-w-md bg-white dark:bg-gray-900 rounded-xl shadow-2xl pointer-events-auto',\n            'p-6 border border-gray-200 dark:border-gray-700',\n            isCentered\n              ? 'top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2'\n              : '',\n            !isCentered &&\n              targetRect &&\n              step.position &&\n              getTooltipPosition(step.position, targetRect)\n          )}\n          ref={spotlightRef}\n        >\n          {/* Close button */}\n          <button\n            onClick={onDismiss}\n            type=\"button\"\n            className=\"absolute top-4 right-4 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200\"\n            aria-label=\"Close tutorial\"\n          >\n            <X size={20} />\n          </button>\n\n          {/* Step indicator */}\n          <div className=\"flex items-center gap-2 mb-4\">\n            <div className=\"h-1.5 flex-1 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden\">\n              <motion.div\n                initial={{ width: 0 }}\n                animate={{ width: `${((stepIndex + 1) / totalSteps) * 100}%` }}\n                transition={{ duration: 0.5 }}\n                className=\"h-full bg-blue-500\"\n              />\n            </div>\n            <span className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">\n              {stepIndex + 1} / {totalSteps}\n            </span>\n          </div>\n\n          {/* Content */}\n          <h3 className=\"text-xl font-semibold mb-2 text-gray-900 dark:text-gray-100\">\n            {step.title}\n          </h3>\n          <p className=\"text-gray-600 dark:text-gray-400 mb-6 leading-relaxed\">\n            {step.description}\n          </p>\n\n          {/* Actions */}\n          <div className=\"flex items-center justify-between gap-3\">\n            <div className=\"flex gap-2\">\n              {stepIndex > 0 && (\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={onPrevious}\n                  disabled={isLoading}\n                >\n                  <ArrowLeft size={16} className=\"mr-2\" />\n                  Back\n                </Button>\n              )}\n\n              {showSkip && (\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={onSkip}\n                  disabled={isLoading}\n                >\n                  Skip\n                </Button>\n              )}\n            </div>\n\n            <div className=\"flex gap-2\">\n              {isPaused ? (\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={onResume}\n                  disabled={isLoading}\n                >\n                  <Play size={16} className=\"mr-2\" />\n                  Resume\n                </Button>\n              ) : (\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={onPause}\n                  disabled={isLoading}\n                >\n                  <Pause size={16} className=\"mr-2\" />\n                  Pause\n                </Button>\n              )}\n\n              <Button onClick={onNext} disabled={isLoading}>\n                {stepIndex === totalSteps - 1 ? 'Finish' : 'Next'}\n                {stepIndex < totalSteps - 1 && (\n                  <ArrowRight size={16} className=\"ml-2\" />\n                )}\n              </Button>\n            </div>\n          </div>\n\n          {/* Restart button (only for multi-step tutorials) */}\n          {totalSteps > 3 && stepIndex > 0 && (\n            <button\n              onClick={onRestart}\n              type=\"button\"\n              className=\"mt-4 text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 flex items-center gap-1\"\n            >\n              <RotateCcw size={14} />\n              Restart tutorial\n            </button>\n          )}\n        </motion.div>\n      </motion.div>\n\n      {/* Global styles for highlighting */}\n      <style>{`\n        .tutorial-highlight {\n          animation: tutorialPulse 2s ease-in-out infinite;\n        }\n\n        @keyframes tutorialPulse {\n          0%, 100% {\n            box-shadow: 0 0 0 0px rgba(59, 130, 246, 0.5);\n          }\n          50% {\n            box-shadow: 0 0 0 8px rgba(59, 130, 246, 0);\n          }\n        }\n\n        * {\n          outline: none !important;\n        }\n\n        .tutorial-highlight:focus {\n          outline: 2px solid #3b82f6 !important;\n          outline-offset: 2px;\n        }\n      `}</style>\n    </AnimatePresence>\n  );\n}\n\nfunction getTooltipPosition(position: string, targetRect: DOMRect): string {\n  const offset = 16;\n\n  switch (position) {\n    case 'top':\n      return `top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2`;\n    case 'bottom':\n      return `top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2`;\n    case 'left':\n      return `top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2`;\n    case 'right':\n      return `top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2`;\n    default:\n      return 'top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2';\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/tutorial/TutorialProvider.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onboardingEventBus' is defined but never used.","line":20,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":28},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":76,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":76,"endColumn":24,"suggestions":[{"fix":{"range":[2197,2267],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'config' is assigned a value but never used.","line":80,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":80,"endColumn":21},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":87,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":87,"endColumn":22,"suggestions":[{"fix":{"range":[2500,2609],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":98,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":98,"endColumn":22,"suggestions":[{"fix":{"range":[2807,2875],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":115,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":115,"endColumn":22,"suggestions":[{"fix":{"range":[3252,3319],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":132,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":132,"endColumn":22,"suggestions":[{"fix":{"range":[3685,3748],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":175,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":175,"endColumn":20,"suggestions":[{"fix":{"range":[4816,4883],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":199,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":199,"endColumn":20,"suggestions":[{"fix":{"range":[5442,5512],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":215,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":215,"endColumn":20,"suggestions":[{"fix":{"range":[5893,5963],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Tutorial Provider - Context provider for tutorial system\n */\n\nimport React, {\n  createContext,\n  useContext,\n  useCallback,\n  useMemo,\n  useEffect,\n  useState,\n  type ReactNode,\n} from 'react';\nimport type {\n  OnboardingTutorial,\n  OnboardingStep,\n} from '@/lib/onboarding/onboarding-engine';\nimport { OnboardingEngine } from '@/lib/onboarding/onboarding-engine';\nimport { onboardingStorage } from '@/lib/onboarding/onboarding-storage';\nimport { onboardingEventBus } from '@/lib/onboarding/onboarding-events';\nimport {\n  getUIConfig,\n  getTutorialById,\n} from '@/lib/onboarding/onboarding-config';\n\ninterface TutorialContextValue {\n  engine: OnboardingEngine;\n  activeTutorial: OnboardingTutorial | null;\n  currentStep: OnboardingStep | null;\n  stepIndex: number;\n  isPaused: boolean;\n  isLoading: boolean;\n  startTutorial: (tutorialId: string) => Promise<void>;\n  completeStep: (stepId: string) => Promise<void>;\n  skipStep: (stepId: string) => Promise<void>;\n  nextStep: () => Promise<void>;\n  previousStep: () => Promise<void>;\n  skipTutorial: () => Promise<void>;\n  pauseTutorial: () => void;\n  resumeTutorial: () => void;\n  restartTutorial: () => Promise<void>;\n  dismissTutorial: () => Promise<void>;\n}\n\nconst TutorialContext = createContext<TutorialContextValue | null>(null);\n\nexport function TutorialProvider({\n  children,\n  userId,\n  uiVersion,\n}: {\n  children: ReactNode;\n  userId: string;\n  uiVersion: 'original' | 'v2' | 'images-mvp';\n}) {\n  const [engine] = useState(() => new OnboardingEngine(userId, uiVersion));\n  const [activeTutorial, setActiveTutorial] =\n    useState<OnboardingTutorial | null>(null);\n  const [stepIndex, setStepIndex] = useState(0);\n  const [isPaused, setIsPaused] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n\n  const currentStep = useMemo(() => {\n    if (!activeTutorial || stepIndex >= activeTutorial.steps.length) {\n      return null;\n    }\n    return activeTutorial.steps[stepIndex];\n  }, [activeTutorial, stepIndex]);\n\n  const startTutorial = useCallback(\n    async (tutorialId: string) => {\n      setIsLoading(true);\n      try {\n        const tutorial = getTutorialById(tutorialId);\n        if (!tutorial) {\n          console.error(`[TutorialProvider] Tutorial not found: ${tutorialId}`);\n          return;\n        }\n\n        const config = getUIConfig(uiVersion);\n        const isSkipped = await onboardingStorage.getSkipPreferences(\n          userId,\n          tutorialId\n        );\n\n        if (isSkipped) {\n          console.log(\n            `[TutorialProvider] Tutorial skipped by user preference: ${tutorialId}`\n          );\n          return;\n        }\n\n        await engine.startTutorial(tutorial);\n        setActiveTutorial(tutorial);\n        setStepIndex(0);\n        setIsPaused(false);\n      } catch (error) {\n        console.error('[TutorialProvider] Failed to start tutorial', error);\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [engine, userId, uiVersion]\n  );\n\n  const completeStep = useCallback(\n    async (stepId: string) => {\n      if (!activeTutorial) return;\n\n      setIsLoading(true);\n      try {\n        await engine.completeStep(activeTutorial.id, stepId);\n        setStepIndex(prev => prev + 1);\n      } catch (error) {\n        console.error('[TutorialProvider] Failed to complete step', error);\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [engine, activeTutorial]\n  );\n\n  const skipStep = useCallback(\n    async (stepId: string) => {\n      if (!activeTutorial) return;\n\n      setIsLoading(true);\n      try {\n        await engine.skipStep(activeTutorial.id, stepId);\n        setStepIndex(prev => prev + 1);\n      } catch (error) {\n        console.error('[TutorialProvider] Failed to skip step', error);\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [engine, activeTutorial]\n  );\n\n  const nextStep = useCallback(async () => {\n    if (!activeTutorial) return;\n\n    const nextIndex = stepIndex + 1;\n    if (nextIndex >= activeTutorial.steps.length) {\n      await engine.completeTutorial(activeTutorial.id);\n      setActiveTutorial(null);\n      setStepIndex(0);\n    } else {\n      setStepIndex(nextIndex);\n    }\n  }, [engine, activeTutorial, stepIndex]);\n\n  const previousStep = useCallback(async () => {\n    if (!activeTutorial || stepIndex <= 0) return;\n\n    const prevIndex = stepIndex - 1;\n    setStepIndex(prevIndex);\n  }, [activeTutorial, stepIndex]);\n\n  const skipTutorial = useCallback(async () => {\n    if (!activeTutorial) return;\n\n    setIsLoading(true);\n    try {\n      await onboardingStorage.setSkipPreferences(\n        userId,\n        activeTutorial.id,\n        true\n      );\n      await engine.dismissTutorial(activeTutorial.id);\n      setActiveTutorial(null);\n      setStepIndex(0);\n      setIsPaused(false);\n    } catch (error) {\n      console.error('[TutorialProvider] Failed to skip tutorial', error);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [engine, activeTutorial, userId]);\n\n  const pauseTutorial = useCallback(() => {\n    engine.pauseTutorial();\n    setIsPaused(true);\n  }, [engine]);\n\n  const resumeTutorial = useCallback(() => {\n    engine.resumeTutorial();\n    setIsPaused(false);\n  }, [engine]);\n\n  const restartTutorial = useCallback(async () => {\n    if (!activeTutorial) return;\n\n    setIsLoading(true);\n    try {\n      engine.resetTutorial(activeTutorial.id);\n      await startTutorial(activeTutorial.id);\n    } catch (error) {\n      console.error('[TutorialProvider] Failed to restart tutorial', error);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [engine, activeTutorial, startTutorial]);\n\n  const dismissTutorial = useCallback(async () => {\n    if (!activeTutorial) return;\n\n    setIsLoading(true);\n    try {\n      await engine.dismissTutorial(activeTutorial.id);\n      setActiveTutorial(null);\n      setStepIndex(0);\n      setIsPaused(false);\n    } catch (error) {\n      console.error('[TutorialProvider] Failed to dismiss tutorial', error);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [engine, activeTutorial]);\n\n  // Listen to engine events\n  useEffect(() => {\n    const unsubscribes = [\n      engine.on('tutorial:started', event => {\n        if (event.type === 'tutorial:started') {\n          const tutorial = getTutorialById(event.tutorialId);\n          if (tutorial) {\n            setActiveTutorial(tutorial);\n            setStepIndex(0);\n          }\n        }\n      }),\n      engine.on('tutorial:completed', event => {\n        if (\n          event.type === 'tutorial:completed' &&\n          activeTutorial?.id === event.tutorialId\n        ) {\n          setActiveTutorial(null);\n          setStepIndex(0);\n        }\n      }),\n      engine.on('tutorial:dismissed', event => {\n        if (\n          event.type === 'tutorial:dismissed' &&\n          activeTutorial?.id === event.tutorialId\n        ) {\n          setActiveTutorial(null);\n          setStepIndex(0);\n        }\n      }),\n    ];\n\n    return () => {\n      unsubscribes.forEach(unsub => unsub());\n    };\n  }, [engine, activeTutorial]);\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      engine.destroy();\n    };\n  }, [engine]);\n\n  const value: TutorialContextValue = useMemo(\n    () => ({\n      engine,\n      activeTutorial,\n      currentStep,\n      stepIndex,\n      isPaused,\n      isLoading,\n      startTutorial,\n      completeStep,\n      skipStep,\n      nextStep,\n      previousStep,\n      skipTutorial,\n      pauseTutorial,\n      resumeTutorial,\n      restartTutorial,\n      dismissTutorial,\n    }),\n    [\n      engine,\n      activeTutorial,\n      currentStep,\n      stepIndex,\n      isPaused,\n      isLoading,\n      startTutorial,\n      completeStep,\n      skipStep,\n      nextStep,\n      previousStep,\n      skipTutorial,\n      pauseTutorial,\n      resumeTutorial,\n      restartTutorial,\n      dismissTutorial,\n    ]\n  );\n\n  return (\n    <TutorialContext.Provider value={value}>\n      {children}\n    </TutorialContext.Provider>\n  );\n}\n\nexport function useTutorial() {\n  const context = useContext(TutorialContext);\n  if (!context) {\n    throw new Error('useTutorial must be used within TutorialProvider');\n  }\n  return context;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui-adaptation-controller.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle' is defined but never used.","line":19,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1358,1361],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1358,1361],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2064,2067],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2064,2067],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2490,2493],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2490,2493],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":419,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":419,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13016,13019],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13016,13019],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * UI Adaptation Controller\n * \n * Dynamically adapts the UI based on file context and user preferences.\n * Provides intelligent layout switching and contextual suggestions.\n */\n\nimport React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';\nimport { detectFileContext, getUIAdaptations, type FileContext } from '@/lib/context-detection';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { \n  Lightbulb, \n  Eye, \n  Settings, \n  Zap, \n  AlertTriangle,\n  CheckCircle,\n  Info\n} from 'lucide-react';\n\n// ============================================================================\n// Context and Types\n// ============================================================================\n\ninterface UIAdaptationState {\n  context: FileContext | null;\n  adaptations: ReturnType<typeof getUIAdaptations> | null;\n  userPreferences: {\n    autoAdapt: boolean;\n    preferredLayout: 'auto' | 'standard' | 'forensic' | 'scientific' | 'compact';\n    showSuggestions: boolean;\n    hideEmptySections: boolean;\n  };\n  overrides: {\n    layout?: string;\n    emphasizedSections?: string[];\n    hiddenSections?: string[];\n  };\n}\n\ninterface UIAdaptationContextType extends UIAdaptationState {\n  updateContext: (metadata: Record<string, any>) => void;\n  updatePreferences: (prefs: Partial<UIAdaptationState['userPreferences']>) => void;\n  applyOverride: (overrides: Partial<UIAdaptationState['overrides']>) => void;\n  resetOverrides: () => void;\n  getSectionVisibility: (section: string) => boolean;\n  getSectionEmphasis: (section: string) => boolean;\n  getLayout: () => string;\n}\n\nconst UIAdaptationContext = createContext<UIAdaptationContextType | null>(null);\n\n// ============================================================================\n// Provider Component\n// ============================================================================\n\ninterface UIAdaptationProviderProps {\n  children: ReactNode;\n  initialMetadata?: Record<string, any>;\n}\n\nexport function UIAdaptationProvider({ children, initialMetadata }: UIAdaptationProviderProps) {\n  const [state, setState] = useState<UIAdaptationState>({\n    context: null,\n    adaptations: null,\n    userPreferences: {\n      autoAdapt: true,\n      preferredLayout: 'auto',\n      showSuggestions: true,\n      hideEmptySections: true,\n    },\n    overrides: {},\n  });\n\n  const updateContext = (metadata: Record<string, any>) => {\n    const context = detectFileContext(metadata);\n    const adaptations = getUIAdaptations(context);\n    \n    setState(prev => ({\n      ...prev,\n      context,\n      adaptations: prev.userPreferences.autoAdapt ? adaptations : prev.adaptations,\n    }));\n  };\n\n  const updatePreferences = (prefs: Partial<UIAdaptationState['userPreferences']>) => {\n    setState(prev => ({\n      ...prev,\n      userPreferences: { ...prev.userPreferences, ...prefs },\n    }));\n  };\n\n  const applyOverride = (overrides: Partial<UIAdaptationState['overrides']>) => {\n    setState(prev => ({\n      ...prev,\n      overrides: { ...prev.overrides, ...overrides },\n    }));\n  };\n\n  const resetOverrides = () => {\n    setState(prev => ({\n      ...prev,\n      overrides: {},\n    }));\n  };\n\n  const getSectionVisibility = (section: string): boolean => {\n    if (state.overrides.hiddenSections?.includes(section)) return false;\n    if (!state.adaptations) return true;\n    return !state.adaptations.hiddenSections.includes(section);\n  };\n\n  const getSectionEmphasis = (section: string): boolean => {\n    if (state.overrides.emphasizedSections?.includes(section)) return true;\n    if (!state.adaptations) return false;\n    return state.adaptations.emphasizedSections.includes(section);\n  };\n\n  const getLayout = (): string => {\n    if (state.overrides.layout) return state.overrides.layout;\n    if (state.userPreferences.preferredLayout !== 'auto') {\n      return state.userPreferences.preferredLayout;\n    }\n    return state.adaptations?.layout || 'standard';\n  };\n\n  // Initialize with metadata if provided\n  useEffect(() => {\n    if (initialMetadata) {\n      updateContext(initialMetadata);\n    }\n  }, [initialMetadata]);\n\n  const contextValue: UIAdaptationContextType = {\n    ...state,\n    updateContext,\n    updatePreferences,\n    applyOverride,\n    resetOverrides,\n    getSectionVisibility,\n    getSectionEmphasis,\n    getLayout,\n  };\n\n  return (\n    <UIAdaptationContext.Provider value={contextValue}>\n      {children}\n    </UIAdaptationContext.Provider>\n  );\n}\n\n// ============================================================================\n// Hook\n// ============================================================================\n\nexport function useUIAdaptation() {\n  const context = useContext(UIAdaptationContext);\n  if (!context) {\n    throw new Error('useUIAdaptation must be used within UIAdaptationProvider');\n  }\n  return context;\n}\n\n// ============================================================================\n// Context Banner Component\n// ============================================================================\n\nexport function ContextBanner() {\n  const { context, adaptations, userPreferences } = useUIAdaptation();\n  const [dismissed, setDismissed] = useState(false);\n\n  if (!context || !userPreferences.showSuggestions || dismissed) {\n    return null;\n  }\n\n  const getContextIcon = () => {\n    switch (context.type) {\n      case 'forensic':\n        return <AlertTriangle className=\"h-4 w-4\" />;\n      case 'scientific':\n        return <Zap className=\"h-4 w-4\" />;\n      case 'photography':\n        return <Eye className=\"h-4 w-4\" />;\n      default:\n        return <Info className=\"h-4 w-4\" />;\n    }\n  };\n\n  const getContextColor = () => {\n    switch (context.type) {\n      case 'forensic':\n        return 'border-red-200 bg-red-50 text-red-800';\n      case 'scientific':\n        return 'border-blue-200 bg-blue-50 text-blue-800';\n      case 'photography':\n        return 'border-green-200 bg-green-50 text-green-800';\n      default:\n        return 'border-gray-200 bg-gray-50 text-gray-800';\n    }\n  };\n\n  return (\n    <Alert className={`mb-4 ${getContextColor()}`}>\n      <div className=\"flex items-start gap-3\">\n        {getContextIcon()}\n        <div className=\"flex-1\">\n          <div className=\"flex items-center gap-2 mb-1\">\n            <span className=\"font-medium\">\n              {context.type.charAt(0).toUpperCase() + context.type.slice(1)} Context Detected\n            </span>\n            <Badge variant=\"secondary\" className=\"text-xs\">\n              {Math.round(context.confidence * 100)}% confidence\n            </Badge>\n          </div>\n          <AlertDescription className=\"text-sm\">\n            This file appears to be from a {context.type} workflow. \n            {adaptations && (\n              <span>\n                {' '}The interface has been optimized to highlight {adaptations.emphasizedSections.slice(0, 3).join(', ')} sections.\n              </span>\n            )}\n          </AlertDescription>\n          \n          {context.warnings && context.warnings.length > 0 && (\n            <div className=\"mt-2 space-y-1\">\n              {context.warnings.map((warning, index) => (\n                <div key={index} className=\"flex items-center gap-2 text-sm font-medium\">\n                  <AlertTriangle className=\"h-3 w-3\" />\n                  {warning}\n                </div>\n              ))}\n            </div>\n          )}\n          \n          {adaptations && adaptations.suggestedActions.length > 0 && (\n            <div className=\"mt-3 flex flex-wrap gap-2\">\n              {adaptations.suggestedActions.slice(0, 3).map((action, index) => (\n                <Button\n                  key={index}\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"h-7 text-xs\"\n                >\n                  {action.label}\n                </Button>\n              ))}\n            </div>\n          )}\n        </div>\n        \n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => setDismissed(true)}\n          className=\"h-6 w-6 p-0\"\n        >\n          \n        </Button>\n      </div>\n    </Alert>\n  );\n}\n\n// ============================================================================\n// Smart Section Component\n// ============================================================================\n\ninterface SmartSectionProps {\n  section: string;\n  title: string;\n  children: ReactNode;\n  className?: string;\n  defaultVisible?: boolean;\n}\n\nexport function SmartSection({ \n  section, \n  title, \n  children, \n  className = '',\n  defaultVisible = true \n}: SmartSectionProps) {\n  const { getSectionVisibility, getSectionEmphasis } = useUIAdaptation();\n  \n  const isVisible = getSectionVisibility(section);\n  const isEmphasized = getSectionEmphasis(section);\n  \n  if (!isVisible && !defaultVisible) {\n    return null;\n  }\n  \n  const sectionClassName = `\n    ${className}\n    ${isEmphasized ? 'ring-2 ring-primary/20 bg-primary/5' : ''}\n    ${!isVisible ? 'opacity-50' : ''}\n  `.trim();\n  \n  return (\n    <section className={sectionClassName}>\n      <div className=\"flex items-center gap-2 mb-3\">\n        <h4 className={`text-sm font-medium ${isEmphasized ? 'text-primary' : 'text-muted-foreground'}`}>\n          {title}\n        </h4>\n        {isEmphasized && (\n          <Badge variant=\"secondary\" className=\"text-xs\">\n            <Lightbulb className=\"h-3 w-3 mr-1\" />\n            Relevant\n          </Badge>\n        )}\n      </div>\n      {children}\n    </section>\n  );\n}\n\n// ============================================================================\n// Layout Adapter Component\n// ============================================================================\n\ninterface LayoutAdapterProps {\n  children: (layout: string) => ReactNode;\n}\n\nexport function LayoutAdapter({ children }: LayoutAdapterProps) {\n  const { getLayout } = useUIAdaptation();\n  const layout = getLayout();\n  \n  return <>{children(layout)}</>;\n}\n\n// ============================================================================\n// Context Indicator Component\n// ============================================================================\n\nexport function ContextIndicator() {\n  const { context } = useUIAdaptation();\n  \n  if (!context) return null;\n  \n  const getIndicatorColor = () => {\n    switch (context.type) {\n      case 'forensic':\n        return 'bg-red-500';\n      case 'scientific':\n        return 'bg-blue-500';\n      case 'photography':\n        return 'bg-green-500';\n      case 'web':\n        return 'bg-purple-500';\n      case 'mobile':\n        return 'bg-orange-500';\n      case 'professional':\n        return 'bg-indigo-500';\n      default:\n        return 'bg-gray-500';\n    }\n  };\n  \n  return (\n    <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n      <div className={`w-2 h-2 rounded-full ${getIndicatorColor()}`} />\n      <span className=\"capitalize\">{context.type}</span>\n      <span>({Math.round(context.confidence * 100)}%)</span>\n    </div>\n  );\n}\n\n// ============================================================================\n// Preferences Panel Component\n// ============================================================================\n\nexport function AdaptationPreferences() {\n  const { userPreferences, updatePreferences, resetOverrides } = useUIAdaptation();\n  \n  return (\n    <div className=\"space-y-4 p-4 border rounded-lg\">\n      <h3 className=\"font-medium flex items-center gap-2\">\n        <Settings className=\"h-4 w-4\" />\n        UI Adaptation Settings\n      </h3>\n      \n      <div className=\"space-y-3\">\n        <label className=\"flex items-center gap-2\">\n          <input\n            type=\"checkbox\"\n            checked={userPreferences.autoAdapt}\n            onChange={(e) => updatePreferences({ autoAdapt: e.target.checked })}\n            className=\"rounded\"\n          />\n          <span className=\"text-sm\">Auto-adapt interface based on file type</span>\n        </label>\n        \n        <label className=\"flex items-center gap-2\">\n          <input\n            type=\"checkbox\"\n            checked={userPreferences.showSuggestions}\n            onChange={(e) => updatePreferences({ showSuggestions: e.target.checked })}\n            className=\"rounded\"\n          />\n          <span className=\"text-sm\">Show contextual suggestions</span>\n        </label>\n        \n        <label className=\"flex items-center gap-2\">\n          <input\n            type=\"checkbox\"\n            checked={userPreferences.hideEmptySections}\n            onChange={(e) => updatePreferences({ hideEmptySections: e.target.checked })}\n            className=\"rounded\"\n          />\n          <span className=\"text-sm\">Hide empty sections</span>\n        </label>\n        \n        <div className=\"flex items-center gap-2\">\n          <label className=\"text-sm\">Preferred layout:</label>\n          <select\n            value={userPreferences.preferredLayout}\n            onChange={(e) => updatePreferences({ preferredLayout: e.target.value as any })}\n            className=\"text-sm border rounded px-2 py-1\"\n          >\n            <option value=\"auto\">Auto</option>\n            <option value=\"standard\">Standard</option>\n            <option value=\"forensic\">Forensic</option>\n            <option value=\"scientific\">Scientific</option>\n            <option value=\"compact\">Compact</option>\n          </select>\n        </div>\n        \n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={resetOverrides}\n          className=\"w-full\"\n        >\n          Reset Customizations\n        </Button>\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/accordion.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/alert-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/alert.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/aspect-ratio.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/avatar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/breadcrumb.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/button-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/calendar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/carousel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/chart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/checkbox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/collapsible.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/command.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/context-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/drawer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/dropdown-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/empty.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/field.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/form.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/hover-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/input-group.tsx","messages":[{"ruleId":"jsx-a11y/click-events-have-key-events","severity":1,"message":"Visible, non-interactive elements with click handlers must have at least one keyboard listener.","line":64,"column":5,"nodeType":"JSXOpeningElement","endLine":76,"endColumn":7}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Textarea } from \"@/components/ui/textarea\"\n\nfunction InputGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"input-group\"\n      role=\"group\"\n      className={cn(\n        \"group/input-group border-input dark:bg-input/30 shadow-xs relative flex w-full items-center rounded-md border outline-none transition-[color,box-shadow]\",\n        \"h-9 has-[>textarea]:h-auto\",\n\n        // Variants based on alignment.\n        \"has-[>[data-align=inline-start]]:[&>input]:pl-2\",\n        \"has-[>[data-align=inline-end]]:[&>input]:pr-2\",\n        \"has-[>[data-align=block-start]]:h-auto has-[>[data-align=block-start]]:flex-col has-[>[data-align=block-start]]:[&>input]:pb-3\",\n        \"has-[>[data-align=block-end]]:h-auto has-[>[data-align=block-end]]:flex-col has-[>[data-align=block-end]]:[&>input]:pt-3\",\n\n        // Focus state.\n        \"has-[[data-slot=input-group-control]:focus-visible]:ring-ring has-[[data-slot=input-group-control]:focus-visible]:ring-1\",\n\n        // Error state.\n        \"has-[[data-slot][aria-invalid=true]]:ring-destructive/20 has-[[data-slot][aria-invalid=true]]:border-destructive dark:has-[[data-slot][aria-invalid=true]]:ring-destructive/40\",\n\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst inputGroupAddonVariants = cva(\n  \"text-muted-foreground flex h-auto cursor-text select-none items-center justify-center gap-2 py-1.5 text-sm font-medium group-data-[disabled=true]/input-group:opacity-50 [&>kbd]:rounded-[calc(var(--radius)-5px)] [&>svg:not([class*='size-'])]:size-4\",\n  {\n    variants: {\n      align: {\n        \"inline-start\":\n          \"order-first pl-3 has-[>button]:ml-[-0.45rem] has-[>kbd]:ml-[-0.35rem]\",\n        \"inline-end\":\n          \"order-last pr-3 has-[>button]:mr-[-0.4rem] has-[>kbd]:mr-[-0.35rem]\",\n        \"block-start\":\n          \"[.border-b]:pb-3 order-first w-full justify-start px-3 pt-3 group-has-[>input]/input-group:pt-2.5\",\n        \"block-end\":\n          \"[.border-t]:pt-3 order-last w-full justify-start px-3 pb-3 group-has-[>input]/input-group:pb-2.5\",\n      },\n    },\n    defaultVariants: {\n      align: \"inline-start\",\n    },\n  }\n)\n\nfunction InputGroupAddon({\n  className,\n  align = \"inline-start\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof inputGroupAddonVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"input-group-addon\"\n      data-align={align}\n      className={cn(inputGroupAddonVariants({ align }), className)}\n      onClick={(e) => {\n        if ((e.target as HTMLElement).closest(\"button\")) {\n          return\n        }\n        e.currentTarget.parentElement?.querySelector(\"input\")?.focus()\n      }}\n      {...props}\n    />\n  )\n}\n\nconst inputGroupButtonVariants = cva(\n  \"flex items-center gap-2 text-sm shadow-none\",\n  {\n    variants: {\n      size: {\n        xs: \"h-6 gap-1 rounded-[calc(var(--radius)-5px)] px-2 has-[>svg]:px-2 [&>svg:not([class*='size-'])]:size-3.5\",\n        sm: \"h-8 gap-1.5 rounded-md px-2.5 has-[>svg]:px-2.5\",\n        \"icon-xs\":\n          \"size-6 rounded-[calc(var(--radius)-5px)] p-0 has-[>svg]:p-0\",\n        \"icon-sm\": \"size-8 p-0 has-[>svg]:p-0\",\n      },\n    },\n    defaultVariants: {\n      size: \"xs\",\n    },\n  }\n)\n\nfunction InputGroupButton({\n  className,\n  type = \"button\",\n  variant = \"ghost\",\n  size = \"xs\",\n  ...props\n}: Omit<React.ComponentProps<typeof Button>, \"size\"> &\n  VariantProps<typeof inputGroupButtonVariants>) {\n  return (\n    <Button\n      type={type}\n      data-size={size}\n      variant={variant}\n      className={cn(inputGroupButtonVariants({ size }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupText({ className, ...props }: React.ComponentProps<\"span\">) {\n  return (\n    <span\n      className={cn(\n        \"text-muted-foreground flex items-center gap-2 text-sm [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupInput({\n  className,\n  ...props\n}: React.ComponentProps<\"input\">) {\n  return (\n    <Input\n      data-slot=\"input-group-control\"\n      className={cn(\n        \"flex-1 rounded-none border-0 bg-transparent shadow-none focus-visible:ring-0 dark:bg-transparent\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupTextarea({\n  className,\n  ...props\n}: React.ComponentProps<\"textarea\">) {\n  return (\n    <Textarea\n      data-slot=\"input-group-control\"\n      className={cn(\n        \"flex-1 resize-none rounded-none border-0 bg-transparent py-3 shadow-none focus-visible:ring-0 dark:bg-transparent\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  InputGroup,\n  InputGroupAddon,\n  InputGroupButton,\n  InputGroupText,\n  InputGroupInput,\n  InputGroupTextarea,\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/input-otp.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/item.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/kbd.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/menubar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/navigation-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/pagination.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/popover.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/progress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/radio-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/resizable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/scroll-area.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/separator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/sheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/slider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/sonner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/spinner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/textarea.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/timeline.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/toast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/toaster.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/toggle-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/toggle.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/ui/tooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/upload-zone.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertCircle' is defined but never used.","line":6,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":14},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":332,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":332,"endColumn":20,"suggestions":[{"fix":{"range":[8508,8546],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useCallback, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  Upload,\n  AlertCircle,\n  Cpu,\n  Scan,\n  Database,\n  Lock,\n  X,\n  FileWarning,\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { Button } from '@/components/ui/button';\nimport { useToast } from '@/hooks/use-toast';\nimport { TrialAccessModal } from '@/components/trial-access-modal';\nimport { validateUploadFile } from '@/lib/upload-guards';\n\n// File validation configuration\nconst FILE_CONFIG = {\n  maxSizeBytes: 2000 * 1024 * 1024, // 2GB for development testing\n  maxSizeMB: 2000,\n  supportedCategories: {\n    images: [\n      'image/jpeg',\n      'image/png',\n      'image/gif',\n      'image/webp',\n      'image/tiff',\n      'image/heic',\n      'image/heif',\n      'image/bmp',\n      'image/svg+xml',\n      'image/x-icon',\n      'image/x-canon-cr2',\n      'image/x-canon-cr3',\n      'image/x-nikon-nef',\n      'image/x-sony-arw',\n      'image/x-adobe-dng',\n      'image/x-fuji-raf',\n      'image/x-olympus-orf',\n      'image/x-panasonic-rw2',\n      'image/x-pentax-pef',\n    ],\n    videos: [\n      'video/mp4',\n      'video/quicktime',\n      'video/x-msvideo',\n      'video/x-matroska',\n      'video/webm',\n      'video/mpeg',\n      'video/3gpp',\n      'video/x-flv',\n    ],\n    audio: [\n      'audio/mpeg',\n      'audio/wav',\n      'audio/flac',\n      'audio/aac',\n      'audio/ogg',\n      'audio/x-m4a',\n      'audio/webm',\n    ],\n    documents: [\n      'application/pdf',\n      'application/msword',\n      'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n    ],\n    specialized: [\n      'application/dicom',\n      'application/fits',\n      'application/x-hdf5',\n      'application/x-netcdf',\n    ],\n  },\n  // Common extensions for files that may not have correct MIME types\n  supportedExtensions: [\n    '.jpg',\n    '.jpeg',\n    '.png',\n    '.gif',\n    '.webp',\n    '.tiff',\n    '.tif',\n    '.heic',\n    '.heif',\n    '.bmp',\n    '.svg',\n    '.ico',\n    '.cr2',\n    '.cr3',\n    '.nef',\n    '.arw',\n    '.dng',\n    '.raf',\n    '.orf',\n    '.rw2',\n    '.pef',\n    '.raw',\n    '.mp4',\n    '.mov',\n    '.avi',\n    '.mkv',\n    '.webm',\n    '.mpeg',\n    '.mpg',\n    '.3gp',\n    '.flv',\n    '.mp3',\n    '.wav',\n    '.flac',\n    '.aac',\n    '.ogg',\n    '.m4a',\n    '.pdf',\n    '.doc',\n    '.docx',\n    '.dcm',\n    '.dicom',\n    '.fits',\n    '.fit',\n    '.fts',\n    '.h5',\n    '.hdf5',\n    '.nc',\n    '.nc4',\n  ],\n};\n\nfunction getSessionId(): string {\n  if (typeof window === 'undefined') return 'anonymous';\n  let sessionId = window.localStorage.getItem('metaextract_session_id');\n  if (!sessionId) {\n    sessionId = crypto.randomUUID();\n    window.localStorage.setItem('metaextract_session_id', sessionId);\n  }\n  return sessionId;\n}\n\nconst CORE_UPLOAD_GUARD = {\n  maxBytes: FILE_CONFIG.maxSizeBytes,\n  allowedMimes: Object.values(FILE_CONFIG.supportedCategories).flat(),\n  allowedExtensions: FILE_CONFIG.supportedExtensions,\n};\n\nfunction formatFileSize(bytes: number): string {\n  if (bytes < 1024) return bytes + ' B';\n  if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';\n  return (bytes / (1024 * 1024)).toFixed(1) + ' MB';\n}\n\ninterface UploadError {\n  title: string;\n  message: string;\n  canRetry: boolean;\n  showPricingCTA?: boolean;\n}\n\nexport function UploadZone() {\n  const [isDragging, setIsDragging] = useState(false);\n  const [isUploading, setIsUploading] = useState(false);\n  const [uploadProgress, setUploadProgress] = useState(0);\n  const [processingStage, setProcessingStage] = useState('Initializing...');\n  const [currentFile, setCurrentFile] = useState<File | null>(null);\n  const [uploadError, setUploadError] = useState<UploadError | null>(null);\n  const [trialEmail, setTrialEmail] = useState<string | null>(null);\n  const [showTrialModal, setShowTrialModal] = useState(false);\n  const [pendingFile, setPendingFile] = useState<File | null>(null);\n  const navigate = useNavigate();\n  const { toast } = useToast();\n\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n    const stored = window.localStorage.getItem('metaextract_trial_email');\n    if (stored) setTrialEmail(stored);\n  }, []);\n\n  const handleDragOver = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragging(true);\n  }, []);\n\n  const handleDragLeave = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    // Only set to false if we're leaving the drop zone entirely\n    if (!e.currentTarget.contains(e.relatedTarget as Node)) {\n      setIsDragging(false);\n    }\n  }, []);\n\n  const handleDrop = useCallback(\n    (e: React.DragEvent) => {\n      e.preventDefault();\n      e.stopPropagation();\n      setIsDragging(false);\n      setUploadError(null);\n\n      const files = e.dataTransfer.files;\n      if (files && files.length > 0) {\n        if (files.length > 1) {\n          toast({\n            title: 'Multiple files detected',\n            description:\n              'Only the first file will be processed. Use batch upload for multiple files.',\n            variant: 'default',\n          });\n        }\n        processFile(files[0]);\n      }\n    },\n    [toast]\n  );\n\n  const handleFileSelect = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      setUploadError(null);\n      if (e.target.files && e.target.files.length > 0) {\n        processFile(e.target.files[0]);\n      }\n      // Reset input so same file can be selected again\n      e.target.value = '';\n    },\n    []\n  );\n\n  const processFile = async (file: File) => {\n    // Validate file\n    const guard = validateUploadFile(file, CORE_UPLOAD_GUARD);\n    if (!guard.ok) {\n      setUploadError({\n        title: 'Invalid File',\n        message: guard.message || 'File validation failed',\n        canRetry: true,\n      });\n      toast({\n        title: 'File Validation Failed',\n        description: guard.message,\n        variant: 'destructive',\n      });\n      return;\n    }\n\n    setCurrentFile(file);\n    if (!trialEmail) {\n      setPendingFile(file);\n      setShowTrialModal(true);\n      return;\n    }\n    startUpload(file);\n  };\n\n  const startUpload = async (file: File) => {\n    setIsUploading(true);\n    setUploadProgress(0);\n    setUploadError(null);\n\n    const stages = [\n      'Uploading file to secure enclave...',\n      'Analyzing file header...',\n      'Extracting EXIF data...',\n      'Parsing MakerNotes...',\n      'Decoding GPS coordinates...',\n      'Scanning for hidden XMP...',\n      'Detecting file context...',\n      'Generating forensic report...',\n    ];\n\n    let progressInterval: NodeJS.Timeout | null = null;\n\n    try {\n      // Create FormData for file upload\n      const formData = new FormData();\n      formData.append('file', file);\n      if (trialEmail) {\n        formData.append('trial_email', trialEmail);\n      }\n      formData.append('session_id', getSessionId());\n\n      // Simulate progress during upload\n      let progress = 0;\n      progressInterval = setInterval(() => {\n        if (progress < 90) {\n          progress += Math.random() * 8;\n          setUploadProgress(Math.min(progress, 90));\n\n          // Update stage text based on progress\n          const stageIndex = Math.floor((progress / 90) * stages.length);\n          if (stages[stageIndex]) setProcessingStage(stages[stageIndex]);\n        }\n      }, 250);\n\n      // Make actual API call to extract metadata\n      const response = await fetch('/api/extract', {\n        method: 'POST',\n        body: formData,\n      });\n\n      if (progressInterval) clearInterval(progressInterval);\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(\n          errorData.error ||\n          errorData.message ||\n          `Server error: ${response.status}`\n        );\n      }\n\n      const metadata = await response.json();\n\n      // Check for API-level errors\n      if (metadata.error) {\n        throw new Error(metadata.error);\n      }\n\n      // Complete progress\n      setUploadProgress(100);\n      setProcessingStage('Extraction complete!');\n\n      // Store metadata in sessionStorage for results page\n      sessionStorage.setItem('currentMetadata', JSON.stringify(metadata));\n\n      // Navigate to results\n      setTimeout(() => {\n        navigate('/images_mvp/results');\n      }, 600);\n    } catch (error) {\n      if (progressInterval) clearInterval(progressInterval);\n      console.error('Upload error:', error);\n\n      const errorMessage =\n        error instanceof Error ? error.message : 'An unexpected error occurred';\n\n      // Determine if error is retryable\n      const isNetworkError =\n        errorMessage.includes('fetch') || errorMessage.includes('network');\n      const isServerError =\n        errorMessage.includes('500') || errorMessage.includes('503');\n      const isPaymentIssue =\n        errorMessage.toLowerCase().includes('payment required') ||\n        errorMessage.toLowerCase().includes('insufficient credits');\n\n      setUploadError({\n        title: isNetworkError ? 'Connection Error' : 'Extraction Failed',\n        message: errorMessage,\n        canRetry: isNetworkError || isServerError,\n        showPricingCTA: isPaymentIssue,\n      });\n\n      toast({\n        title: 'Extraction Failed',\n        description: errorMessage,\n        variant: 'destructive',\n      });\n\n      setIsUploading(false);\n      setUploadProgress(0);\n    }\n  };\n\n  const handleRetry = () => {\n    if (currentFile) {\n      setUploadError(null);\n      startUpload(currentFile);\n    }\n  };\n\n  const handleCancel = () => {\n    setUploadError(null);\n    setCurrentFile(null);\n    setIsUploading(false);\n    setUploadProgress(0);\n  };\n\n  const handleTrialConfirm = (email: string) => {\n    setTrialEmail(email);\n    if (typeof window !== 'undefined') {\n      window.localStorage.setItem('metaextract_trial_email', email);\n    }\n    setShowTrialModal(false);\n    if (pendingFile) {\n      const fileToUpload = pendingFile;\n      setPendingFile(null);\n      startUpload(fileToUpload);\n    }\n  };\n\n  return (\n    <div className='w-full max-w-xl mx-auto'>\n      <TrialAccessModal\n        isOpen={showTrialModal}\n        onClose={() => {\n          setShowTrialModal(false);\n          setPendingFile(null);\n          setCurrentFile(null);\n        }}\n        onConfirm={handleTrialConfirm}\n      />\n      <AnimatePresence mode='wait'>\n        {uploadError ? (\n          <motion.div\n            key='error'\n            initial={{ opacity: 0, scale: 0.95 }}\n            animate={{ opacity: 1, scale: 1 }}\n            exit={{ opacity: 0, scale: 0.95 }}\n            className='bg-black/40 backdrop-blur-md rounded-xl border border-red-500/30 shadow-2xl p-8 relative overflow-hidden'\n          >\n            <div className='flex items-start gap-4 mb-6'>\n              <div className='p-3 bg-red-500/10 rounded-lg border border-red-500/20 shrink-0'>\n                <FileWarning className='w-6 h-6 text-red-500' />\n              </div>\n              <div className='flex-1 min-w-0'>\n                <h4 className='font-mono font-bold text-white mb-1'>\n                  {uploadError.title}\n                </h4>\n                <p className='text-sm text-slate-300 break-words'>\n                  {uploadError.message}\n                </p>\n              </div>\n              <button\n                type='button'\n                onClick={handleCancel}\n                className='p-1 text-slate-500 hover:text-white transition-colors shrink-0'\n                aria-label='Dismiss error'\n                title='Dismiss'\n              >\n                <X className='w-5 h-5' />\n              </button>\n            </div>\n\n            {currentFile && (\n              <div className='mb-6 p-3 bg-white/5 rounded-lg border border-white/10'>\n                <div className='text-xs text-slate-300 font-mono'>\n                  <span className='text-slate-500'>FILE:</span>{' '}\n                  {currentFile.name}\n                </div>\n                <div className='text-xs text-slate-500 font-mono mt-1'>\n                  <span>SIZE:</span> {formatFileSize(currentFile.size)} |{' '}\n                  <span>TYPE:</span> {currentFile.type || 'unknown'}\n                </div>\n              </div>\n            )}\n\n            <div className='flex gap-3'>\n              {uploadError.canRetry && (\n                <Button\n                  onClick={handleRetry}\n                  className='flex-1 bg-primary hover:bg-primary/90 text-black font-bold'\n                >\n                  Try Again\n                </Button>\n              )}\n              {uploadError.showPricingCTA && (\n                <Button\n                  onClick={() => navigate('/')}\n                  variant='outline'\n                  className='flex-1 border-white/20 text-white hover:bg-white/10'\n                >\n                  View Pricing\n                </Button>\n              )}\n              <Button\n                onClick={handleCancel}\n                variant='outline'\n                className='flex-1 border-white/20 text-white hover:bg-white/10'\n              >\n                Select Different File\n              </Button>\n            </div>\n          </motion.div>\n        ) : !isUploading ? (\n          <motion.div\n            key='upload'\n            initial={{ opacity: 0, y: 10 }}\n            animate={{ opacity: 1, y: 0 }}\n            exit={{ opacity: 0, scale: 0.95 }}\n            className={cn(\n              'relative group rounded-xl border border-dashed transition-all duration-300 ease-in-out cursor-pointer overflow-hidden backdrop-blur-sm',\n              isDragging\n                ? 'border-primary bg-primary/5 shadow-[0_0_30px_rgba(99,102,241,0.2)]'\n                : 'border-white/10 bg-white/5 hover:border-primary/50 hover:bg-white/10'\n            )}\n            onDragOver={handleDragOver}\n            onDragLeave={handleDragLeave}\n            onDrop={handleDrop}\n            onClick={() => document.getElementById('file-upload')?.click()}\n          >\n            <input\n              id='file-upload'\n              type='file'\n              className='hidden'\n              onChange={handleFileSelect}\n              accept={FILE_CONFIG.supportedExtensions.join(',')}\n            />\n\n            {/* Tech Decoration Lines */}\n            <div className='absolute top-0 left-0 w-8 h-8 border-t-2 border-l-2 border-white/20 group-hover:border-primary transition-colors' />\n            <div className='absolute top-0 right-0 w-8 h-8 border-t-2 border-r-2 border-white/20 group-hover:border-primary transition-colors' />\n            <div className='absolute bottom-0 left-0 w-8 h-8 border-b-2 border-l-2 border-white/20 group-hover:border-primary transition-colors' />\n            <div className='absolute bottom-0 right-0 w-8 h-8 border-b-2 border-r-2 border-white/20 group-hover:border-primary transition-colors' />\n\n            <div className='flex flex-col items-center justify-center py-20 px-6 text-center'>\n              <div\n                className={cn(\n                  'mb-8 p-4 rounded-full bg-white/5 transition-all duration-300 group-hover:scale-110 group-hover:bg-primary/20',\n                  isDragging && 'bg-primary/20 scale-110'\n                )}\n              >\n                <Upload\n                  className={cn(\n                    'w-8 h-8 text-slate-300 group-hover:text-primary transition-colors',\n                    isDragging && 'text-primary'\n                  )}\n                />\n              </div>\n              <h3 className='text-xl font-bold text-white mb-2 tracking-tight'>\n                Upload Evidence\n              </h3>\n              <p className='text-slate-300 mb-4 max-w-xs mx-auto text-sm'>\n                Drag & drop media files here or browse to start.\n              </p>\n              <div className='text-slate-500 text-xs mb-8 space-y-1'>\n                <p>Supports 400+ formats including RAW, HEIC, DICOM, FITS</p>\n                <p className='text-slate-600'>\n                  Max file size: {FILE_CONFIG.maxSizeMB}MB\n                </p>\n                <p className='text-slate-600'>\n                  {trialEmail\n                    ? 'Free report unlocked'\n                    : '1 free full report with email'}\n                </p>\n              </div>\n              <Button className='h-10 px-8 bg-white/10 text-white hover:bg-primary hover:text-black border border-white/20 hover:border-primary font-bold text-sm rounded transition-all duration-300 shadow-lg'>\n                Select File\n              </Button>\n            </div>\n          </motion.div>\n        ) : (\n          <motion.div\n            key='processing'\n            initial={{ opacity: 0, scale: 0.95 }}\n            animate={{ opacity: 1, scale: 1 }}\n            exit={{ opacity: 0, scale: 0.95 }}\n            className='bg-black/40 backdrop-blur-md rounded-xl border border-primary/20 shadow-2xl p-8 relative overflow-hidden'\n          >\n            {/* Scanning line effect */}\n            <div className='absolute inset-0 scanline opacity-20 pointer-events-none'></div>\n\n            <div className='flex items-center gap-4 mb-6 relative z-10'>\n              <div className='p-3 bg-primary/10 rounded-lg border border-primary/20'>\n                <Cpu className='w-6 h-6 text-primary animate-pulse' />\n              </div>\n              <div className='flex-1 min-w-0'>\n                <h4 className='font-mono font-bold text-white flex items-center gap-2'>\n                  PROCESSING <span className='animate-pulse'>_</span>\n                </h4>\n                <p className='text-xs font-mono text-primary/80 truncate'>\n                  {processingStage}\n                </p>\n              </div>\n              <div className='text-right shrink-0 min-w-[60px]'>\n                <span className='text-2xl font-bold text-white font-mono'>\n                  {Math.round(uploadProgress)}%\n                </span>\n              </div>\n            </div>\n\n            {currentFile && (\n              <div className='mb-6 p-3 bg-white/5 rounded-lg border border-white/10 relative z-10'>\n                <div className='text-xs text-slate-300 font-mono truncate'>\n                  <span className='text-slate-500'>FILE:</span>{' '}\n                  {currentFile.name}\n                </div>\n                <div className='text-xs text-slate-500 font-mono mt-1'>\n                  <span>SIZE:</span> {formatFileSize(currentFile.size)}\n                </div>\n              </div>\n            )}\n\n            <div className='space-y-2 relative z-10'>\n              <div className='h-1.5 w-full bg-white/10 rounded-full overflow-hidden'>\n                <motion.div\n                  className='h-full bg-gradient-to-r from-primary to-primary/80 shadow-[0_0_10px_rgba(99,102,241,0.5)]'\n                  initial={{ width: 0 }}\n                  animate={{ width: `${uploadProgress}%` }}\n                  transition={{ ease: 'linear', duration: 0.1 }}\n                />\n              </div>\n              <div className='flex justify-between text-[10px] font-mono text-slate-500 uppercase'>\n                <span className={uploadProgress > 10 ? 'text-primary' : ''}>\n                  Header\n                </span>\n                <span className={uploadProgress > 40 ? 'text-primary' : ''}>\n                  Body\n                </span>\n                <span className={uploadProgress > 70 ? 'text-primary' : ''}>\n                  Analysis\n                </span>\n                <span className={uploadProgress > 95 ? 'text-primary' : ''}>\n                  Complete\n                </span>\n              </div>\n            </div>\n\n            <div className='mt-8 grid grid-cols-3 gap-2 relative z-10'>\n              <div className='bg-white/5 p-2 rounded border border-white/5 text-center'>\n                <Database className='w-4 h-4 text-slate-500 mx-auto mb-1' />\n                <span className='text-[10px] text-slate-300 block'>\n                  Extensive field coverage\n                </span>\n              </div>\n              <div className='bg-white/5 p-2 rounded border border-white/5 text-center'>\n                <Scan className='w-4 h-4 text-slate-500 mx-auto mb-1' />\n                <span className='text-[10px] text-slate-300 block'>\n                  Deep Scan\n                </span>\n              </div>\n              <div className='bg-white/5 p-2 rounded border border-white/5 text-center'>\n                <Lock className='w-4 h-4 text-slate-500 mx-auto mb-1' />\n                <span className='text-[10px] text-slate-300 block'>\n                  Encrypted\n                </span>\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/v2-results/ActionsToolbar.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[491,494],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[491,494],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":51,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":51,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":77,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":77,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onCompare' is defined but never used. Allowed unused args must match /^_/u.","line":198,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":198,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onShare' is defined but never used. Allowed unused args must match /^_/u.","line":199,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":199,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":222,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":222,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":241,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":241,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Actions Toolbar Component\n *\n * Provides action buttons for metadata manipulation:\n * - Export (JSON, PDF)\n * - Compare with another file\n * - Share results\n */\n\nimport React, { useState } from 'react';\nimport { Download, FileText, Share2, Copy, Check } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { useToast } from '@/hooks/use-toast';\nimport { cn } from '@/lib/utils';\n\ninterface ActionsToolbarProps {\n  filename: string;\n  metadata: Record<string, any>;\n  onCompare?: () => void;\n  onShare?: () => void;\n  className?: string;\n}\n\nexport function ActionsToolbar({\n  filename,\n  metadata,\n  onCompare,\n  onShare,\n  className\n}: ActionsToolbarProps): React.ReactElement {\n  const { toast } = useToast();\n  const [copiedJson, setCopiedJson] = useState(false);\n\n  const handleExportJSON = () => {\n    try {\n      const dataStr = JSON.stringify(metadata, null, 2);\n      const dataBlob = new Blob([dataStr], { type: 'application/json' });\n      const url = URL.createObjectURL(dataBlob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = `${filename}_metadata.json`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(url);\n\n      toast({\n        title: 'Download started',\n        description: 'Metadata JSON file is being downloaded',\n      });\n    } catch (error) {\n      toast({\n        title: 'Export failed',\n        description: 'Could not export metadata',\n        variant: 'destructive',\n      });\n    }\n  };\n\n  const handleExportPDF = () => {\n    toast({\n      title: 'PDF export coming soon',\n      description: 'PDF export functionality will be available shortly',\n    });\n  };\n\n  const handleCopyJSON = async () => {\n    try {\n      const dataStr = JSON.stringify(metadata, null, 2);\n      await navigator.clipboard.writeText(dataStr);\n      setCopiedJson(true);\n      toast({\n        title: 'Copied!',\n        description: 'Metadata copied to clipboard',\n      });\n      setTimeout(() => setCopiedJson(false), 2000);\n    } catch (error) {\n      toast({\n        title: 'Copy failed',\n        description: 'Could not copy to clipboard',\n        variant: 'destructive',\n      });\n    }\n  };\n\n  const handleCompare = () => {\n    onCompare?.();\n    toast({\n      title: 'Compare functionality coming soon',\n      description: 'Compare with another file will be available soon',\n    });\n  };\n\n  const handleShare = () => {\n    onShare?.();\n    toast({\n      title: 'Share functionality coming soon',\n      description: 'Share results will be available soon',\n    });\n  };\n\n  return (\n    <div\n      className={cn(\n        'flex flex-wrap gap-2',\n        'p-4 rounded-lg',\n        'bg-white/5 dark:bg-black/40',\n        'border border-white/10 dark:border-white/10',\n        className\n      )}\n    >\n      <div className=\"flex items-center gap-2\">\n        <span className=\"text-xs font-medium text-gray-600 dark:text-gray-400 uppercase\">\n          Actions\n        </span>\n      </div>\n\n      <div className=\"flex-1\" />\n\n      <div className=\"flex flex-wrap gap-2\">\n        {/* Export Actions */}\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={handleExportJSON}\n          className=\"gap-2 text-xs min-h-[44px]\"\n          title=\"Download metadata as JSON\"\n        >\n          <Download className=\"w-4 h-4\" aria-hidden=\"true\" />\n          JSON\n        </Button>\n\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={handleExportPDF}\n          className=\"gap-2 text-xs min-h-[44px]\"\n          title=\"Export as PDF (coming soon)\"\n        >\n          <FileText className=\"w-4 h-4\" aria-hidden=\"true\" />\n          PDF\n        </Button>\n\n        {/* Copy JSON */}\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={handleCopyJSON}\n          className=\"gap-2 text-xs min-h-[44px]\"\n          title=\"Copy JSON to clipboard\"\n        >\n          {copiedJson ? (\n            <>\n              <Check className=\"w-4 h-4\" aria-hidden=\"true\" />\n              Copied\n            </>\n          ) : (\n            <>\n              <Copy className=\"w-4 h-4\" aria-hidden=\"true\" />\n              Copy\n            </>\n          )}\n        </Button>\n\n        {/* Compare */}\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={handleCompare}\n          className=\"gap-2 text-xs min-h-[44px]\"\n          title=\"Compare with another file (coming soon)\"\n        >\n          Compare\n        </Button>\n\n        {/* Share */}\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={handleShare}\n          className=\"gap-2 text-xs min-h-[44px]\"\n          title=\"Share results (coming soon)\"\n        >\n          <Share2 className=\"w-4 h-4\" aria-hidden=\"true\" />\n          Share\n        </Button>\n      </div>\n    </div>\n  );\n}\n\n/**\n * Compact variant for mobile\n */\nexport function ActionsToolbarCompact({\n  filename,\n  metadata,\n  onCompare,\n  onShare,\n  className\n}: ActionsToolbarProps): React.ReactElement {\n  const { toast } = useToast();\n  const [copiedJson, setCopiedJson] = useState(false);\n\n  const handleExportJSON = () => {\n    try {\n      const dataStr = JSON.stringify(metadata, null, 2);\n      const dataBlob = new Blob([dataStr], { type: 'application/json' });\n      const url = URL.createObjectURL(dataBlob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = `${filename}_metadata.json`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(url);\n\n      toast({\n        title: 'Download started',\n        description: 'Metadata JSON file is being downloaded',\n      });\n    } catch (error) {\n      toast({\n        title: 'Export failed',\n        description: 'Could not export metadata',\n        variant: 'destructive',\n      });\n    }\n  };\n\n  const handleCopyJSON = async () => {\n    try {\n      const dataStr = JSON.stringify(metadata, null, 2);\n      await navigator.clipboard.writeText(dataStr);\n      setCopiedJson(true);\n      toast({\n        title: 'Copied!',\n        description: 'Metadata copied to clipboard',\n      });\n      setTimeout(() => setCopiedJson(false), 2000);\n    } catch (error) {\n      toast({\n        title: 'Copy failed',\n        description: 'Could not copy to clipboard',\n        variant: 'destructive',\n      });\n    }\n  };\n\n  return (\n    <div\n      className={cn(\n        'grid grid-cols-2 gap-2',\n        'p-3 rounded-lg',\n        'bg-white/5 dark:bg-black/40',\n        'border border-white/10 dark:border-white/10',\n        className\n      )}\n    >\n      <Button\n        variant=\"outline\"\n        size=\"sm\"\n        onClick={handleExportJSON}\n        className=\"gap-2 text-xs min-h-[44px]\"\n      >\n        <Download className=\"w-4 h-4\" aria-hidden=\"true\" />\n        Export\n      </Button>\n\n      <Button\n        variant=\"outline\"\n        size=\"sm\"\n        onClick={handleCopyJSON}\n        className=\"gap-2 text-xs min-h-[44px]\"\n      >\n        {copiedJson ? (\n          <>\n            <Check className=\"w-4 h-4\" aria-hidden=\"true\" />\n            Copied\n          </>\n        ) : (\n          <>\n            <Copy className=\"w-4 h-4\" aria-hidden=\"true\" />\n            Copy\n          </>\n        )}\n      </Button>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/v2-results/AuthenticityBadge.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle' is defined but never used.","line":4,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'XCircle' is defined but never used.","line":6,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Fingerprint' is defined but never used.","line":11,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Badge } from '@/components/ui/badge';\nimport {\n  CheckCircle,\n  AlertTriangle,\n  XCircle,\n  Eye,\n  Shield,\n  Verified,\n  AlertOctagon,\n  Fingerprint,\n  TrendingUp,\n  TrendingDown,\n  Minus,\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\nexport interface AuthenticityBadgeProps {\n  score: number;\n  label?: string;\n  showIcon?: boolean;\n  variant?: 'default' | 'outline' | 'minimal' | 'compact' | 'detailed';\n  size?: 'sm' | 'md' | 'lg';\n  showConfidence?: boolean;\n  animated?: boolean;\n  className?: string;\n}\n\nexport interface AuthenticityAssessmentProps {\n  score: number;\n  details?: string;\n  showConfidence?: boolean;\n  showProgress?: boolean;\n  className?: string;\n}\n\nexport interface ForensicConfidenceIndicatorProps {\n  confidence: number;\n  type?: 'authenticity' | 'manipulation' | 'ai-detection';\n  size?: 'sm' | 'md' | 'lg';\n  showLabel?: boolean;\n}\n\n/**\n * Forensic Confidence Indicator\n * Visual representation of confidence levels with color-coded indicators\n */\nexport const ForensicConfidenceIndicator: React.FC<\n  ForensicConfidenceIndicatorProps\n> = ({ confidence, type = 'authenticity', size = 'md', showLabel = true }) => {\n  const getConfig = () => {\n    if (type === 'manipulation') {\n      // For manipulation detection, higher confidence in detection = more suspicious\n      return confidence >= 80\n        ? {\n            color: 'text-red-500',\n            bg: 'bg-red-500/10',\n            border: 'border-red-500/30',\n            label: 'High Risk',\n          }\n        : confidence >= 60\n          ? {\n              color: 'text-orange-500',\n              bg: 'bg-orange-500/10',\n              border: 'border-orange-500/30',\n              label: 'Medium Risk',\n            }\n          : {\n              color: 'text-emerald-500',\n              bg: 'bg-emerald-500/10',\n              border: 'border-emerald-500/30',\n              label: 'Low Risk',\n            };\n    } else if (type === 'ai-detection') {\n      // For AI detection, similar logic as manipulation\n      return confidence >= 80\n        ? {\n            color: 'text-red-500',\n            bg: 'bg-red-500/10',\n            border: 'border-red-500/30',\n            label: 'AI Detected',\n          }\n        : confidence >= 60\n          ? {\n              color: 'text-yellow-500',\n              bg: 'bg-yellow-500/10',\n              border: 'border-yellow-500/30',\n              label: 'Possibly AI',\n            }\n          : {\n              color: 'text-emerald-500',\n              bg: 'bg-emerald-500/10',\n              border: 'border-emerald-500/30',\n              label: 'Likely Original',\n            };\n    } else {\n      // Default authenticity scoring\n      return confidence >= 80\n        ? {\n            color: 'text-emerald-500',\n            bg: 'bg-emerald-500/10',\n            border: 'border-emerald-500/30',\n            label: 'Authentic',\n          }\n        : confidence >= 60\n          ? {\n              color: 'text-yellow-500',\n              bg: 'bg-yellow-500/10',\n              border: 'border-yellow-500/30',\n              label: 'Questionable',\n            }\n          : {\n              color: 'text-red-500',\n              bg: 'bg-red-500/10',\n              border: 'border-red-500/30',\n              label: 'Suspicious',\n            };\n    }\n  };\n\n  const config = getConfig();\n  const sizeClasses = {\n    sm: 'px-2 py-1 text-xs',\n    md: 'px-3 py-1.5 text-sm',\n    lg: 'px-4 py-2 text-base',\n  };\n\n  return (\n    <div\n      className={cn(\n        'inline-flex items-center gap-2 rounded-md border font-medium',\n        config.bg,\n        config.border,\n        config.color,\n        sizeClasses[size],\n        showLabel ? '' : 'px-2'\n      )}\n    >\n      {confidence >= 80 ? (\n        <Verified\n          className={cn(\n            size === 'sm' ? 'w-3 h-3' : size === 'md' ? 'w-4 h-4' : 'w-5 h-5'\n          )}\n        />\n      ) : confidence >= 60 ? (\n        <AlertTriangle\n          className={cn(\n            size === 'sm' ? 'w-3 h-3' : size === 'md' ? 'w-4 h-4' : 'w-5 h-5'\n          )}\n        />\n      ) : (\n        <AlertOctagon\n          className={cn(\n            size === 'sm' ? 'w-3 h-3' : size === 'md' ? 'w-4 h-4' : 'w-5 h-5'\n          )}\n        />\n      )}\n      {showLabel && (\n        <span>\n          {config.label}\n          {confidence < 100 ? ` (${confidence}%)` : ''}\n        </span>\n      )}\n    </div>\n  );\n};\n\n/**\n * Authenticity Badge Component\n * Enhanced badge with multiple display variants and animated transitions\n */\nexport const AuthenticityBadge: React.FC<AuthenticityBadgeProps> = ({\n  score,\n  label,\n  showIcon = true,\n  variant = 'default',\n  size = 'md',\n  showConfidence = true,\n  animated = true,\n  className,\n}) => {\n  // Determine authenticity level based on score\n  let authenticityLevel:\n    | 'authentic'\n    | 'questionable'\n    | 'suspicious'\n    | 'unknown';\n  let badgeVariant: 'default' | 'destructive' | 'secondary' | 'outline';\n  let icon: React.ReactNode;\n  let displayLabel: string;\n  let trendIcon: React.ReactNode | null = null;\n\n  if (score >= 80) {\n    authenticityLevel = 'authentic';\n    badgeVariant = 'secondary';\n    icon = (\n      <Verified\n        className={cn(\n          size === 'sm' ? 'w-3 h-3' : size === 'md' ? 'w-4 h-4' : 'w-5 h-5',\n          'text-emerald-500'\n        )}\n      />\n    );\n    displayLabel = label || `Authentic (${score}%)`;\n    trendIcon = <TrendingUp className=\"w-3 h-3 text-emerald-500\" />;\n  } else if (score >= 60) {\n    authenticityLevel = 'questionable';\n    badgeVariant = 'outline';\n    icon = (\n      <AlertTriangle\n        className={cn(\n          size === 'sm' ? 'w-3 h-3' : size === 'md' ? 'w-4 h-4' : 'w-5 h-5',\n          'text-yellow-500'\n        )}\n      />\n    );\n    displayLabel = label || `Questionable (${score}%)`;\n    trendIcon = <Minus className=\"w-3 h-3 text-yellow-500\" />;\n  } else if (score >= 0) {\n    authenticityLevel = 'suspicious';\n    badgeVariant = 'destructive';\n    icon = (\n      <AlertOctagon\n        className={cn(\n          size === 'sm' ? 'w-3 h-3' : size === 'md' ? 'w-4 h-4' : 'w-5 h-5',\n          'text-red-500'\n        )}\n      />\n    );\n    displayLabel = label || `Suspicious (${score}%)`;\n    trendIcon = <TrendingDown className=\"w-3 h-3 text-red-500\" />;\n  } else {\n    authenticityLevel = 'unknown';\n    badgeVariant = 'outline';\n    icon = (\n      <Eye\n        className={cn(\n          size === 'sm' ? 'w-3 h-3' : size === 'md' ? 'w-4 h-4' : 'w-5 h-5',\n          'text-slate-500'\n        )}\n      />\n    );\n    displayLabel = label || 'Authenticity Unknown';\n  }\n\n  // Adjust badge variant based on props\n  const finalVariant = variant === 'outline' ? 'outline' : badgeVariant;\n\n  // Size-based styling\n  const sizeClasses = {\n    sm: 'px-2 py-0.5 text-xs gap-1',\n    md: 'px-2.5 py-0.5 text-sm gap-1.5',\n    lg: 'px-3 py-1 text-sm gap-2',\n  };\n\n  // Handle different variants\n  if (variant === 'minimal') {\n    return (\n      <div\n        className={cn(\n          'inline-flex items-center gap-1',\n          animated && 'transition-all duration-300',\n          className\n        )}\n      >\n        {showIcon && icon}\n        <span\n          className={cn(\n            'font-medium',\n            authenticityLevel === 'authentic'\n              ? 'text-emerald-400'\n              : authenticityLevel === 'questionable'\n                ? 'text-yellow-400'\n                : authenticityLevel === 'suspicious'\n                  ? 'text-red-400'\n                  : 'text-slate-400'\n          )}\n        >\n          {displayLabel}\n        </span>\n      </div>\n    );\n  }\n\n  if (variant === 'compact') {\n    return (\n      <div\n        className={cn(\n          'inline-flex items-center gap-1.5 px-2 py-1 rounded-md',\n          'bg-background border',\n          authenticityLevel === 'authentic'\n            ? 'border-emerald-500/30 bg-emerald-500/10'\n            : authenticityLevel === 'questionable'\n              ? 'border-yellow-500/30 bg-yellow-500/10'\n              : authenticityLevel === 'suspicious'\n                ? 'border-red-500/30 bg-red-500/10'\n                : 'border-slate-500/30 bg-slate-500/10',\n          animated && 'transition-all duration-300',\n          className\n        )}\n      >\n        {showIcon && icon}\n        <span\n          className={cn(\n            'text-xs font-medium',\n            authenticityLevel === 'authentic'\n              ? 'text-emerald-400'\n              : authenticityLevel === 'questionable'\n                ? 'text-yellow-400'\n                : authenticityLevel === 'suspicious'\n                  ? 'text-red-400'\n                  : 'text-slate-400'\n          )}\n        >\n          {score}%\n        </span>\n      </div>\n    );\n  }\n\n  if (variant === 'detailed') {\n    return (\n      <div\n        className={cn(\n          'inline-flex items-center gap-3 px-3 py-2 rounded-lg',\n          'bg-background border',\n          authenticityLevel === 'authentic'\n            ? 'border-emerald-500/30 bg-emerald-500/10'\n            : authenticityLevel === 'questionable'\n              ? 'border-yellow-500/30 bg-yellow-500/10'\n              : authenticityLevel === 'suspicious'\n                ? 'border-red-500/30 bg-red-500/10'\n                : 'border-slate-500/30 bg-slate-500/10',\n          animated && 'transition-all duration-300',\n          className\n        )}\n      >\n        {showIcon && icon}\n        <div className=\"flex flex-col\">\n          <span\n            className={cn(\n              'font-medium',\n              authenticityLevel === 'authentic'\n                ? 'text-emerald-400'\n                : authenticityLevel === 'questionable'\n                  ? 'text-yellow-400'\n                  : authenticityLevel === 'suspicious'\n                    ? 'text-red-400'\n                    : 'text-slate-400'\n            )}\n          >\n            {displayLabel}\n          </span>\n          {showConfidence && (\n            <div className=\"flex items-center gap-1 text-xs text-slate-400\">\n              {trendIcon}\n              <span>Confidence: {score}%</span>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n\n  // Default badge variant\n  return (\n    <Badge\n      variant={finalVariant}\n      className={cn(\n        sizeClasses[size],\n        authenticityLevel === 'authentic'\n          ? 'bg-emerald-500/20 text-emerald-400 border-emerald-500/30'\n          : '',\n        authenticityLevel === 'questionable'\n          ? 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30'\n          : '',\n        authenticityLevel === 'suspicious'\n          ? 'bg-red-500/20 text-red-400 border-red-500/30'\n          : '',\n        authenticityLevel === 'unknown'\n          ? 'bg-slate-500/20 text-slate-300 border-slate-500/30'\n          : '',\n        showIcon ? 'flex items-center' : '',\n        animated && 'transition-all duration-300 hover:scale-105',\n        className\n      )}\n    >\n      {showIcon && icon}\n      <span>{displayLabel}</span>\n    </Badge>\n  );\n};\n\n/**\n * Authenticity Assessment Component\n * Comprehensive assessment display with optional progress bar\n */\nexport const AuthenticityAssessment: React.FC<AuthenticityAssessmentProps> = ({\n  score,\n  details,\n  showConfidence = true,\n  showProgress = false,\n  className,\n}) => {\n  return (\n    <div className={cn('space-y-3', className)}>\n      <div className=\"flex items-center justify-between\">\n        <AuthenticityBadge\n          score={score}\n          variant=\"detailed\"\n          showConfidence={showConfidence}\n        />\n        {showConfidence && (\n          <div className=\"flex items-center gap-2 text-xs text-slate-300\">\n            <Shield className=\"w-3 h-3\" />\n            <span>Analysis Confidence</span>\n          </div>\n        )}\n      </div>\n\n      {showProgress && (\n        <div className=\"space-y-2\">\n          <div className=\"flex justify-between text-xs text-slate-400\">\n            <span>Authenticity Score</span>\n            <span>{score}%</span>\n          </div>\n          <div className=\"w-full bg-slate-700 rounded-full h-2\">\n            <div\n              className={cn(\n                'h-2 rounded-full transition-all duration-1000',\n                score >= 80\n                  ? 'bg-emerald-500'\n                  : score >= 60\n                    ? 'bg-yellow-500'\n                    : 'bg-red-500'\n              )}\n              style={{ width: `${score}%` }}\n            />\n          </div>\n        </div>\n      )}\n\n      {details && (\n        <p className=\"text-xs text-slate-300 mt-2 leading-relaxed\">{details}</p>\n      )}\n    </div>\n  );\n};\n\n/**\n * Quick Authenticity Indicator\n * Ultra-compact component for use in lists or tables\n */\nexport const QuickAuthenticityIndicator: React.FC<{ score: number }> = ({\n  score,\n}) => {\n  const getColor = () => {\n    if (score >= 80) return 'bg-emerald-500';\n    if (score >= 60) return 'bg-yellow-500';\n    return 'bg-red-500';\n  };\n\n  return (\n    <div className=\"flex items-center gap-2\">\n      <div className={cn('w-2 h-2 rounded-full', getColor())} />\n      <span className=\"text-xs text-slate-400\">{score}%</span>\n    </div>\n  );\n};\n\nexport default AuthenticityBadge;\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/v2-results/DicomViewer.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MapPin' is defined but never used.","line":8,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used.","line":9,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { \n  Image as ImageIcon, \n  Database, \n  MapPin, \n  Calendar, \n  Settings,\n  Eye,\n  Download,\n  ZoomIn,\n  ZoomOut,\n  RotateCw\n} from 'lucide-react';\n\ninterface DicomMetadata {\n  patientName?: string;\n  patientId?: string;\n  patientAge?: string;\n  patientSex?: string;\n  studyDate?: string;\n  studyTime?: string;\n  studyDescription?: string;\n  modality?: string;\n  manufacturer?: string;\n  modelName?: string;\n  institutionName?: string;\n  bodyPartExamined?: string;\n  sliceThickness?: string;\n  kvp?: string;\n  tubeCurrent?: string;\n  exposureTime?: string;\n  imagePosition?: string;\n  imageOrientation?: string;\n  sliceLocation?: string;\n  windowCenter?: string;\n  windowWidth?: string;\n}\n\ninterface DicomViewerProps {\n  metadata: DicomMetadata;\n  imageUrl?: string;\n  onImageLoad?: () => void;\n}\n\nexport const DicomViewer: React.FC<DicomViewerProps> = ({ \n  metadata, \n  imageUrl,\n  onImageLoad \n}) => {\n  const [zoom, setZoom] = useState(1);\n  const [rotation, setRotation] = useState(0);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (imageUrl) {\n      setIsLoading(true);\n      setError(null);\n      \n      const img = new window.Image();\n      img.onload = () => {\n        setIsLoading(false);\n        onImageLoad?.();\n      };\n      img.onerror = () => {\n        setIsLoading(false);\n        setError('Failed to load DICOM image preview');\n      };\n      img.src = imageUrl;\n    }\n  }, [imageUrl, onImageLoad]);\n\n  const handleZoomIn = () => {\n    setZoom(prev => Math.min(prev + 0.1, 3));\n  };\n\n  const handleZoomOut = () => {\n    setZoom(prev => Math.max(prev - 0.1, 0.5));\n  };\n\n  const handleRotate = () => {\n    setRotation(prev => (prev + 90) % 360);\n  };\n\n  const handleReset = () => {\n    setZoom(1);\n    setRotation(0);\n  };\n\n  const renderMetadataSection = (title: string, fields: [string, string | undefined][]) => {\n    const validFields = fields.filter(([, value]) => value !== undefined && value.trim() !== '');\n    \n    if (validFields.length === 0) return null;\n    \n    return (\n      <div className=\"space-y-2\">\n        <h4 className=\"text-sm font-semibold text-white border-b border-white/10 pb-1\">{title}</h4>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2\">\n          {validFields.map(([label, value], idx) => (\n            <div key={idx} className=\"flex justify-between py-1\">\n              <span className=\"text-xs text-slate-300 capitalize\">{label.replace(/([A-Z])/g, ' $1').trim()}:</span>\n              <span className=\"text-sm text-white truncate max-w-[120px]\">{value}</span>\n            </div>\n          ))}\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        {/* Image Preview */}\n        <div className=\"lg:col-span-2\">\n          <Card className=\"bg-card border-white/10 h-full\">\n            <CardHeader>\n              <CardTitle className=\"text-white flex items-center gap-2\">\n                <ImageIcon className=\"w-5 h-5 text-primary\" />\n                DICOM Image Preview\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"relative bg-muted/20 rounded-lg overflow-hidden aspect-square flex items-center justify-center\">\n                {isLoading ? (\n                  <div className=\"text-center p-8\">\n                    <Database className=\"w-12 h-12 mx-auto text-primary mb-2\" />\n                    <p className=\"text-slate-300\">Loading DICOM preview...</p>\n                  </div>\n                ) : error ? (\n                  <div className=\"text-center p-8\">\n                    <Database className=\"w-12 h-12 mx-auto text-red-500 mb-2\" />\n                    <p className=\"text-red-400\">{error}</p>\n                  </div>\n                ) : imageUrl ? (\n                  <img\n                    src={imageUrl}\n                    alt=\"DICOM preview\"\n                    className=\"w-full h-full object-contain\"\n                    style={{\n                      transform: `scale(${zoom}) rotate(${rotation}deg)`,\n                      transition: 'transform 0.2s ease'\n                    }}\n                  />\n                ) : (\n                  <div className=\"text-center p-8\">\n                    <Database className=\"w-12 h-12 mx-auto text-slate-500 mb-2\" />\n                    <p className=\"text-slate-300\">No image preview available</p>\n                  </div>\n                )}\n              </div>\n              \n              {/* Image Controls */}\n              <div className=\"flex flex-wrap gap-2 mt-4\">\n                <Button \n                  variant=\"outline\" \n                  size=\"sm\" \n                  onClick={handleZoomIn}\n                  disabled={zoom >= 3}\n                  className=\"gap-2\"\n                >\n                  <ZoomIn className=\"w-4 h-4\" />\n                  Zoom In\n                </Button>\n                \n                <Button \n                  variant=\"outline\" \n                  size=\"sm\" \n                  onClick={handleZoomOut}\n                  disabled={zoom <= 0.5}\n                  className=\"gap-2\"\n                >\n                  <ZoomOut className=\"w-4 h-4\" />\n                  Zoom Out\n                </Button>\n                \n                <Button \n                  variant=\"outline\" \n                  size=\"sm\" \n                  onClick={handleRotate}\n                  className=\"gap-2\"\n                >\n                  <RotateCw className=\"w-4 h-4\" />\n                  Rotate\n                </Button>\n                \n                <Button \n                  variant=\"outline\" \n                  size=\"sm\" \n                  onClick={handleReset}\n                  className=\"gap-2\"\n                >\n                  <Settings className=\"w-4 h-4\" />\n                  Reset\n                </Button>\n                \n                <Button \n                  variant=\"outline\" \n                  size=\"sm\" \n                  className=\"gap-2 ml-auto\"\n                >\n                  <Download className=\"w-4 h-4\" />\n                  Export\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n        \n        {/* Metadata Panel */}\n        <div className=\"space-y-4\">\n          {renderMetadataSection('Patient Information', [\n            ['Patient Name', metadata.patientName],\n            ['Patient ID', metadata.patientId],\n            ['Age', metadata.patientAge],\n            ['Sex', metadata.patientSex],\n          ])}\n          \n          {renderMetadataSection('Study Information', [\n            ['Study Date', metadata.studyDate],\n            ['Study Time', metadata.studyTime],\n            ['Description', metadata.studyDescription],\n            ['Modality', metadata.modality],\n          ])}\n          \n          {renderMetadataSection('Equipment', [\n            ['Manufacturer', metadata.manufacturer],\n            ['Model Name', metadata.modelName],\n            ['Institution', metadata.institutionName],\n          ])}\n          \n          {renderMetadataSection('Image Parameters', [\n            ['Body Part', metadata.bodyPartExamined],\n            ['Slice Thickness', metadata.sliceThickness],\n            ['KVP', metadata.kvp],\n            ['Tube Current', metadata.tubeCurrent],\n            ['Exposure Time', metadata.exposureTime],\n          ])}\n          \n          {renderMetadataSection('Positioning', [\n            ['Image Position', metadata.imagePosition],\n            ['Image Orientation', metadata.imageOrientation],\n            ['Slice Location', metadata.sliceLocation],\n          ])}\n          \n          {renderMetadataSection('Display Settings', [\n            ['Window Center', metadata.windowCenter],\n            ['Window Width', metadata.windowWidth],\n          ])}\n        </div>\n      </div>\n      \n      {/* Additional DICOM Information */}\n      <Card className=\"bg-card border-white/10\">\n        <CardHeader>\n          <CardTitle className=\"text-white flex items-center gap-2\">\n            <Database className=\"w-5 h-5 text-primary\" />\n            DICOM Analysis\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div className=\"p-3 bg-muted/20 rounded-lg\">\n              <p className=\"text-xs text-slate-300\">Modality</p>\n              <p className=\"text-lg font-bold text-white\">\n                {metadata.modality || 'Unknown'}\n              </p>\n            </div>\n            \n            <div className=\"p-3 bg-muted/20 rounded-lg\">\n              <p className=\"text-xs text-slate-300\">Manufacturer</p>\n              <p className=\"text-lg font-bold text-white truncate\">\n                {metadata.manufacturer || 'Unknown'}\n              </p>\n            </div>\n            \n            <div className=\"p-3 bg-muted/20 rounded-lg\">\n              <p className=\"text-xs text-slate-300\">Authenticity</p>\n              <div className=\"flex items-center gap-2\">\n                <Eye className=\"w-5 h-5 text-emerald-500\" />\n                <span className=\"text-lg font-bold text-emerald-400\">Verified</span>\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"mt-4 pt-4 border-t border-white/10\">\n            <h4 className=\"text-sm font-semibold text-white mb-2\">DICOM Tags</h4>\n            <div className=\"flex flex-wrap gap-2\">\n              {metadata.modality && (\n                <Badge variant=\"secondary\" className=\"bg-purple-500/20 text-purple-400 border-purple-500/30\">\n                  Modality: {metadata.modality}\n                </Badge>\n              )}\n              {metadata.bodyPartExamined && (\n                <Badge variant=\"secondary\" className=\"bg-blue-500/20 text-blue-400 border-blue-500/30\">\n                  Body Part: {metadata.bodyPartExamined}\n                </Badge>\n              )}\n              {metadata.institutionName && (\n                <Badge variant=\"secondary\" className=\"bg-green-500/20 text-green-400 border-green-500/30\">\n                  Institution: {metadata.institutionName}\n                </Badge>\n              )}\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/v2-results/ExpandableSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/v2-results/ExpertView.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronRight' is defined but never used.","line":4,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronDown' is defined but never used.","line":5,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Database' is defined but never used.","line":9,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Layers' is defined but never used.","line":11,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":9},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[678,681],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[678,681],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1018,1021],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1018,1021],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1100,1103],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1100,1103],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useMemo } from 'react';\nimport { \n  Search, \n  ChevronRight, \n  ChevronDown, \n  Shield, \n  Cpu, \n  Zap, \n  Database, \n  Binary,\n  Layers,\n  FileSearch,\n  AlertTriangle\n} from 'lucide-react';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Separator } from '@/components/ui/separator';\nimport { cn } from '@/lib/utils';\n\ninterface ExpertViewProps {\n  metadata: any;\n  className?: string;\n}\n\nexport function ExpertView({ metadata, className }: ExpertViewProps) {\n  const [searchTerm, setSearchTerm] = useState('');\n  const [activeTab, setActiveTab] = useState('all');\n\n  // Flatten and filter metadata for expert search\n  const flattenedFields = useMemo(() => {\n    const fields: { key: string; value: any; category: string; fullPath: string }[] = [];\n    \n    const traverse = (obj: any, path: string = '', category: string = '') => {\n      if (!obj || typeof obj !== 'object' || Array.isArray(obj)) {\n        if (obj !== null) {\n          fields.push({ \n            key: path.split('.').pop() || path, \n            value: obj, \n            category, \n            fullPath: path \n          });\n        }\n        return;\n      }\n\n      Object.entries(obj).forEach(([key, value]) => {\n        if (key.startsWith('_')) return; // Skip internal fields\n        const currentPath = path ? `${path}.${key}` : key;\n        const currentCategory = path.split('.')[0] || key;\n        traverse(value, currentPath, currentCategory);\n      });\n    };\n\n    traverse(metadata);\n    \n    if (!searchTerm) return fields;\n    \n    const term = searchTerm.toLowerCase();\n    return fields.filter(f => \n      f.key.toLowerCase().includes(term) || \n      String(f.value).toLowerCase().includes(term) ||\n      f.category.toLowerCase().includes(term)\n    );\n  }, [metadata, searchTerm]);\n\n  const categories = useMemo(() => {\n    const cats = new Set(flattenedFields.map(f => f.category));\n    return Array.from(cats).sort();\n  }, [flattenedFields]);\n\n  return (\n    <Card className={cn(\"border-t-4 border-t-primary shadow-xl\", className)}>\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <div className=\"p-2 rounded-lg bg-primary/10\">\n              <Binary className=\"w-5 h-5 text-primary\" />\n            </div>\n            <div>\n              <CardTitle className=\"text-xl font-bold\">Expert Registry View (v4.0)</CardTitle>\n              <CardDescription>\n                Deep-parsing through {metadata?.extraction_info?.fields_extracted || '131,858'} verified fields\n              </CardDescription>\n            </div>\n          </div>\n          <Badge variant=\"outline\" className=\"font-mono bg-primary/5 border-primary/20\">\n            PRO FORENSIC TIER\n          </Badge>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div className=\"space-y-4\">\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n            <Input\n              placeholder=\"Search 131k fields (e.g. 'nal_unit', 'vba', 'profile', 'gps')...\"\n              className=\"pl-10 bg-muted/30\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n            />\n          </div>\n\n          <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n            <TabsList className=\"w-full justify-start overflow-x-auto h-auto p-1 bg-muted/50\">\n              <TabsTrigger value=\"all\" className=\"text-xs py-1.5\">All Fields</TabsTrigger>\n              <TabsTrigger value=\"forensics\" className=\"text-xs py-1.5 gap-1.5\">\n                <Shield className=\"w-3 h-3\" /> Forensics\n              </TabsTrigger>\n              <TabsTrigger value=\"bitstream\" className=\"text-xs py-1.5 gap-1.5\">\n                <Cpu className=\"w-3 h-3\" /> Bitstream\n              </TabsTrigger>\n              <TabsTrigger value=\"scientific\" className=\"text-xs py-1.5 gap-1.5\">\n                <Zap className=\"w-3 h-3\" /> Scientific\n              </TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"all\" className=\"mt-4\">\n              <ScrollArea className=\"h-[500px] pr-4 rounded-md border p-4 bg-black/5 dark:bg-white/5\">\n                <div className=\"space-y-6\">\n                  {categories.map(cat => {\n                    const catFields = flattenedFields.filter(f => f.category === cat);\n                    if (catFields.length === 0) return null;\n                    \n                    return (\n                      <div key={cat} className=\"space-y-2\">\n                        <div className=\"flex items-center gap-2 sticky top-0 bg-background/95 backdrop-blur py-1 z-10\">\n                          <Badge variant=\"secondary\" className=\"capitalize px-2 py-0 text-[10px] font-bold tracking-wider\">\n                            {cat}\n                          </Badge>\n                          <span className=\"text-[10px] text-muted-foreground\">{catFields.length} fields</span>\n                        </div>\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2\">\n                          {catFields.map((field, i) => (\n                            <div key={i} className=\"flex flex-col p-2 rounded border bg-card hover:border-primary/50 transition-colors\">\n                              <span className=\"text-[10px] font-mono text-muted-foreground truncate\" title={field.fullPath}>\n                                {field.fullPath}\n                              </span>\n                              <span className=\"text-xs font-semibold text-foreground truncate\">\n                                {String(field.value)}\n                              </span>\n                            </div>\n                          ))}\n                        </div>\n                        <Separator className=\"my-4 opacity-50\" />\n                      </div>\n                    );\n                  })}\n                </div>\n              </ScrollArea>\n            </TabsContent>\n\n            <TabsContent value=\"forensics\" className=\"mt-4 space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                {/* PDF Forensics */}\n                {metadata?.pdf?.forensics && (\n                  <Card className=\"border-orange-500/20 bg-orange-500/5\">\n                    <CardHeader className=\"py-3\">\n                      <CardTitle className=\"text-sm flex items-center gap-2\">\n                        <FileSearch className=\"w-4 h-4 text-orange-500\" /> PDF JavaScript Analysis\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"text-xs space-y-2\">\n                      <div className=\"flex justify-between items-center\">\n                        <span className=\"text-muted-foreground\">JavaScript Detected:</span>\n                        <Badge variant={metadata.pdf.forensics.js_present ? \"destructive\" : \"outline\"}>\n                          {metadata.pdf.forensics.js_present ? \"YES\" : \"NO\"}\n                        </Badge>\n                      </div>\n                      <div className=\"flex justify-between items-center\">\n                        <span className=\"text-muted-foreground\">Risk Level:</span>\n                        <span className=\"font-bold uppercase\">{metadata.pdf.forensics.risk_level || 'low'}</span>\n                      </div>\n                      {metadata.pdf.forensics.snippets?.length > 0 && (\n                        <div className=\"mt-2 p-2 bg-black/40 rounded font-mono text-[10px] text-orange-200\">\n                          {metadata.pdf.forensics.snippets[0].substring(0, 100)}...\n                        </div>\n                      )}\n                    </CardContent>\n                  </Card>\n                )}\n\n                {/* Office Forensics */}\n                {metadata?.office?.forensics && (\n                  <Card className=\"border-red-500/20 bg-red-500/5\">\n                    <CardHeader className=\"py-3\">\n                      <CardTitle className=\"text-sm flex items-center gap-2\">\n                        <AlertTriangle className=\"w-4 h-4 text-red-500\" /> VBA Macro Inspection\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"text-xs space-y-2\">\n                      <div className=\"flex justify-between items-center\">\n                        <span className=\"text-muted-foreground\">VBA Projects Found:</span>\n                        <Badge variant={metadata.office.forensics.has_vba ? \"destructive\" : \"outline\"}>\n                          {metadata.office.forensics.has_vba ? \"YES\" : \"NO\"}\n                        </Badge>\n                      </div>\n                      <div className=\"flex justify-between items-center\">\n                        <span className=\"text-muted-foreground\">Suspicious APIs:</span>\n                        <span className=\"font-bold text-red-500\">{metadata.office.forensics.suspicious_apis?.length || 0}</span>\n                      </div>\n                      <div className=\"flex flex-wrap gap-1 mt-2\">\n                        {metadata.office.forensics.suspicious_apis?.map((api: string, i: number) => (\n                          <Badge key={i} variant=\"outline\" className=\"text-[9px] py-0\">{api}</Badge>\n                        ))}\n                      </div>\n                    </CardContent>\n                  </Card>\n                )}\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"bitstream\" className=\"mt-4\">\n              {metadata?.video?.bitstream_forensics ? (\n                <div className=\"space-y-4\">\n                  <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                    <div className=\"p-3 rounded-lg bg-muted/50 border\">\n                      <div className=\"text-[10px] text-muted-foreground uppercase\">NAL Unit Count</div>\n                      <div className=\"text-xl font-bold font-mono\">{metadata.video.bitstream_forensics.nal_unit_count}</div>\n                    </div>\n                    <div className=\"p-3 rounded-lg bg-muted/50 border\">\n                      <div className=\"text-[10px] text-muted-foreground uppercase\">Entropy Coding</div>\n                      <div className=\"text-xl font-bold font-mono\">CABAC</div>\n                    </div>\n                    <div className=\"p-3 rounded-lg bg-muted/50 border\">\n                      <div className=\"text-[10px] text-muted-foreground uppercase\">SPS/PPS Deep Analysis</div>\n                      <div className=\"text-xl font-bold font-mono text-green-500\">ACTIVE</div>\n                    </div>\n                    <div className=\"p-3 rounded-lg bg-muted/50 border\">\n                      <div className=\"text-[10px] text-muted-foreground uppercase\">VUI Parameters</div>\n                      <div className=\"text-xl font-bold font-mono\">PRESENT</div>\n                    </div>\n                  </div>\n                  <Card className=\"bg-black/20\">\n                    <CardContent className=\"pt-6 h-40 flex items-center justify-center\">\n                      <div className=\"text-center\">\n                        <Cpu className=\"w-8 h-8 text-primary mx-auto mb-2 opacity-50\" />\n                        <p className=\"text-xs text-muted-foreground\">Bitstream Heatmap & QP Visualization Module (2026)</p>\n                      </div>\n                    </CardContent>\n                  </Card>\n                </div>\n              ) : (\n                <div className=\"flex flex-col items-center justify-center py-12 text-center border rounded-lg bg-muted/20\">\n                  <Cpu className=\"w-12 h-12 text-muted-foreground mb-2 opacity-20\" />\n                  <p className=\"text-sm font-medium\">Bitstream Forensics Unavailable</p>\n                  <p className=\"text-xs text-muted-foreground\">This feature requires a Pro Tier video file (H.264/HEVC/AV1)</p>\n                </div>\n              )}\n            </TabsContent>\n\n            <TabsContent value=\"scientific\" className=\"mt-4\">\n               <div className=\"flex flex-col items-center justify-center py-12 text-center border rounded-lg bg-muted/20\">\n                  <Zap className=\"w-12 h-12 text-muted-foreground mb-2 opacity-20\" />\n                  <p className=\"text-sm font-medium\">Scientific Data Registry</p>\n                  <p className=\"text-xs text-muted-foreground\">Mapping 10,000+ DICOM, FITS, and Geospatial fields</p>\n                  <Badge variant=\"outline\" className=\"mt-4\">COMING IN BETA 4.1</Badge>\n                </div>\n            </TabsContent>\n          </Tabs>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/v2-results/FitsVisualizer.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used.","line":8,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Settings' is defined but never used.","line":9,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Download' is defined but never used.","line":11,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { \n  Map, \n  Database, \n  Calendar, \n  Settings,\n  Eye,\n  Download,\n  Grid3X3,\n  Activity\n} from 'lucide-react';\n\ninterface FitsMetadata {\n  telescope?: string;\n  instrument?: string;\n  object?: string;\n  ra?: string; // Right Ascension\n  dec?: string; // Declination\n  dateObs?: string;\n  mjd?: string; // Modified Julian Date\n  exposure?: string;\n  filter?: string;\n  binning?: string;\n  gain?: string;\n  readNoise?: string;\n  pixelScale?: string;\n  seeing?: string;\n  airmass?: string;\n  temperature?: string;\n  humidity?: string;\n  pressure?: string;\n  naxis?: string;\n  naxis1?: string;\n  naxis2?: string;\n  bitpix?: string;\n  bscale?: string;\n  bzero?: string;\n  bunit?: string;\n  origin?: string;\n  observer?: string;\n  observerId?: string;\n}\n\ninterface FitsVisualizerProps {\n  metadata: FitsMetadata;\n}\n\nexport const FitsVisualizer: React.FC<FitsVisualizerProps> = ({ metadata }) => {\n  const [activeTab, setActiveTab] = useState<'overview' | 'coordinates' | 'instrument' | 'environment'>('overview');\n  \n  const renderMetadataSection = (title: string, fields: [string, string | undefined][]) => {\n    const validFields = fields.filter(([, value]) => value !== undefined && value.trim() !== '');\n    \n    if (validFields.length === 0) return null;\n    \n    return (\n      <div className=\"space-y-2\">\n        <h4 className=\"text-sm font-semibold text-white border-b border-white/10 pb-1\">{title}</h4>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2\">\n          {validFields.map(([label, value], idx) => (\n            <div key={idx} className=\"flex justify-between py-1\">\n              <span className=\"text-xs text-slate-300 capitalize\">{label.replace(/([A-Z])/g, ' $1').trim()}:</span>\n              <span className=\"text-sm text-white truncate max-w-[120px]\">{value}</span>\n            </div>\n          ))}\n        </div>\n      </div>\n    );\n  };\n\n  const renderTabContent = () => {\n    switch (activeTab) {\n      case 'overview':\n        return (\n          <div className=\"space-y-4\">\n            {renderMetadataSection('Observation', [\n              ['Object', metadata.object],\n              ['Date Observed', metadata.dateObs],\n              ['Modified Julian Date', metadata.mjd],\n              ['Exposure Time', metadata.exposure],\n            ])}\n            \n            {renderMetadataSection('Telescope', [\n              ['Telescope', metadata.telescope],\n              ['Instrument', metadata.instrument],\n              ['Observer', metadata.observer],\n            ])}\n          </div>\n        );\n      \n      case 'coordinates':\n        return (\n          <div className=\"space-y-4\">\n            {renderMetadataSection('Celestial Coordinates', [\n              ['Right Ascension', metadata.ra],\n              ['Declination', metadata.dec],\n              ['Pixel Scale', metadata.pixelScale],\n            ])}\n            \n            {renderMetadataSection('Observation Parameters', [\n              ['Seeing', metadata.seeing],\n              ['Airmass', metadata.airmass],\n              ['Binning', metadata.binning],\n            ])}\n          </div>\n        );\n      \n      case 'instrument':\n        return (\n          <div className=\"space-y-4\">\n            {renderMetadataSection('Detector', [\n              ['Gain', metadata.gain],\n              ['Read Noise', metadata.readNoise],\n              ['Filter', metadata.filter],\n            ])}\n            \n            {renderMetadataSection('FITS Header', [\n              ['NAXIS', metadata.naxis],\n              ['NAXIS1', metadata.naxis1],\n              ['NAXIS2', metadata.naxis2],\n              ['BITPIX', metadata.bitpix],\n              ['BSCALE', metadata.bscale],\n              ['BZERO', metadata.bzero],\n              ['BUNIT', metadata.bunit],\n            ])}\n          </div>\n        );\n      \n      case 'environment':\n        return (\n          <div className=\"space-y-4\">\n            {renderMetadataSection('Environmental Conditions', [\n              ['Temperature', metadata.temperature],\n              ['Humidity', metadata.humidity],\n              ['Pressure', metadata.pressure],\n            ])}\n          </div>\n        );\n      \n      default:\n        return null;\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <Card className=\"bg-card border-white/10\">\n        <CardHeader>\n          <CardTitle className=\"text-white flex items-center gap-2\">\n            <Grid3X3 className=\"w-5 h-5 text-primary\" />\n            FITS Data Visualizer\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex flex-wrap gap-2 mb-4\">\n            <Button \n              variant={activeTab === 'overview' ? 'default' : 'outline'}\n              size=\"sm\"\n              onClick={() => setActiveTab('overview')}\n            >\n              Overview\n            </Button>\n            <Button \n              variant={activeTab === 'coordinates' ? 'default' : 'outline'}\n              size=\"sm\"\n              onClick={() => setActiveTab('coordinates')}\n            >\n              Coordinates\n            </Button>\n            <Button \n              variant={activeTab === 'instrument' ? 'default' : 'outline'}\n              size=\"sm\"\n              onClick={() => setActiveTab('instrument')}\n            >\n              Instrument\n            </Button>\n            <Button \n              variant={activeTab === 'environment' ? 'default' : 'outline'}\n              size=\"sm\"\n              onClick={() => setActiveTab('environment')}\n            >\n              Environment\n            </Button>\n          </div>\n          \n          {renderTabContent()}\n        </CardContent>\n      </Card>\n      \n      {/* Scientific Data Visualization */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Coordinates Visualization */}\n        <Card className=\"bg-card border-white/10\">\n          <CardHeader>\n            <CardTitle className=\"text-white flex items-center gap-2\">\n              <Map className=\"w-5 h-5 text-primary\" />\n              Celestial Coordinates\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"bg-muted/20 rounded-lg p-4 h-64 flex items-center justify-center\">\n              <div className=\"text-center\">\n                <Activity className=\"w-12 h-12 mx-auto text-primary mb-2\" />\n                <p className=\"text-white\">Celestial coordinate visualization</p>\n                <p className=\"text-sm text-slate-300 mt-1\">\n                  {metadata.ra && metadata.dec \n                    ? `RA: ${metadata.ra}, Dec: ${metadata.dec}` \n                    : 'Coordinates not available'}\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n        \n        {/* Data Quality */}\n        <Card className=\"bg-card border-white/10\">\n          <CardHeader>\n            <CardTitle className=\"text-white flex items-center gap-2\">\n              <Eye className=\"w-5 h-5 text-primary\" />\n              Data Quality Assessment\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-slate-300\">Seeing Quality</span>\n                <Badge variant=\"outline\" className=\"bg-emerald-500/20 text-emerald-400 border-emerald-500/30\">\n                  {metadata.seeing || 'Unknown'}\n                </Badge>\n              </div>\n              \n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-slate-300\">Airmass</span>\n                <Badge variant=\"outline\" className=\"bg-blue-500/20 text-blue-400 border-blue-500/30\">\n                  {metadata.airmass || 'Unknown'}\n                </Badge>\n              </div>\n              \n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-slate-300\">Exposure Quality</span>\n                <Badge variant=\"outline\" className=\"bg-purple-500/20 text-purple-400 border-purple-500/30\">\n                  {metadata.exposure ? 'Good' : 'Unknown'}\n                </Badge>\n              </div>\n              \n              <div className=\"pt-2 border-t border-white/10\">\n                <h4 className=\"text-sm font-semibold text-white mb-2\">FITS Tags</h4>\n                <div className=\"flex flex-wrap gap-2\">\n                  {metadata.telescope && (\n                    <Badge variant=\"secondary\" className=\"bg-blue-500/20 text-blue-400 border-blue-500/30\">\n                      Telescope: {metadata.telescope}\n                    </Badge>\n                  )}\n                  {metadata.instrument && (\n                    <Badge variant=\"secondary\" className=\"bg-green-500/20 text-green-400 border-green-500/30\">\n                      Instrument: {metadata.instrument}\n                    </Badge>\n                  )}\n                  {metadata.object && (\n                    <Badge variant=\"secondary\" className=\"bg-purple-500/20 text-purple-400 border-purple-500/30\">\n                      Object: {metadata.object}\n                    </Badge>\n                  )}\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n      \n      {/* FITS Header Information */}\n      <Card className=\"bg-card border-white/10\">\n        <CardHeader>\n          <CardTitle className=\"text-white flex items-center gap-2\">\n            <Database className=\"w-5 h-5 text-primary\" />\n            FITS Header Information\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n            <div className=\"p-3 bg-muted/20 rounded-lg\">\n              <p className=\"text-xs text-slate-300\">Data Type</p>\n              <p className=\"text-lg font-bold text-white\">\n                {metadata.bitpix === '8' ? '8-bit' : \n                 metadata.bitpix === '16' ? '16-bit' : \n                 metadata.bitpix === '32' ? '32-bit' : 'Unknown'}\n              </p>\n            </div>\n            \n            <div className=\"p-3 bg-muted/20 rounded-lg\">\n              <p className=\"text-xs text-slate-300\">Dimensions</p>\n              <p className=\"text-lg font-bold text-white\">\n                {metadata.naxis1 && metadata.naxis2 ? `${metadata.naxis1}${metadata.naxis2}` : 'Unknown'}\n              </p>\n            </div>\n            \n            <div className=\"p-3 bg-muted/20 rounded-lg\">\n              <p className=\"text-xs text-slate-300\">Observatory</p>\n              <p className=\"text-lg font-bold text-white truncate\">\n                {metadata.telescope || 'Unknown'}\n              </p>\n            </div>\n            \n            <div className=\"p-3 bg-muted/20 rounded-lg\">\n              <p className=\"text-xs text-slate-300\">Authenticity</p>\n              <div className=\"flex items-center gap-2\">\n                <Eye className=\"w-5 h-5 text-emerald-500\" />\n                <span className=\"text-lg font-bold text-emerald-400\">Verified</span>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/v2-results/ForensicAnalysis.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle' is defined but never used.","line":10,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Eye' is defined but never used.","line":11,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":6},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Camera' is defined but never used.","line":13,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Hash' is defined but never used.","line":14,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertOctagon' is defined but never used.","line":26,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'color' is assigned a value but never used. Allowed unused args must match /^_/u.","line":206,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":206,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'colorClasses' is assigned a value but never used.","line":209,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":209,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Progress } from '@/components/ui/progress';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport {\n  Shield,\n  AlertTriangle,\n  CheckCircle,\n  Eye,\n  FileText,\n  Camera,\n  Hash,\n  Download,\n  RotateCcw,\n  Activity,\n  Search,\n  Brain,\n  Fingerprint,\n  TrendingUp,\n  PieChart,\n  BarChart3,\n  Zap,\n  Target,\n  AlertOctagon,\n  Verified,\n  XCircle,\n} from 'lucide-react';\nimport { AuthenticityBadge } from './AuthenticityBadge';\nimport { cn } from '@/lib/utils';\n\nexport interface SteganographyAnalysis {\n  detected: boolean;\n  confidence: number;\n  methodsChecked: string[];\n  findings: string[];\n  details?: string;\n}\n\nexport interface ManipulationAnalysis {\n  detected: boolean;\n  confidence: number;\n  indicators: Array<{\n    type: string;\n    severity: 'low' | 'medium' | 'high';\n    description: string;\n    confidence: number;\n  }>;\n  originalityScore?: number;\n}\n\nexport interface AIDetection {\n  aiGenerated: boolean;\n  confidence: number;\n  modelHints: string[];\n  detectionMethods: string[];\n}\n\nexport interface ForensicAnalysisProps {\n  steganography?: SteganographyAnalysis;\n  manipulation?: ManipulationAnalysis;\n  aiDetection?: AIDetection;\n  authenticityScore?: number;\n  onReanalyze?: () => void;\n  className?: string;\n}\n\nexport interface ForensicFindingCardProps {\n  title: string;\n  description: string;\n  confidence: number;\n  severity: 'low' | 'medium' | 'high';\n  icon?: React.ReactNode;\n  details?: string;\n  recommendations?: string[];\n}\n\ninterface ForensicScoreGaugeProps {\n  score: number;\n  size?: 'sm' | 'md' | 'lg';\n  showLabel?: boolean;\n}\n\nconst ForensicScoreGauge: React.FC<ForensicScoreGaugeProps> = ({\n  score,\n  size = 'md',\n  showLabel = true,\n}) => {\n  const radius = size === 'sm' ? 30 : size === 'md' ? 45 : 60;\n  const strokeWidth = size === 'sm' ? 4 : 6;\n  const normalizedRadius = radius - strokeWidth * 2;\n  const circumference = normalizedRadius * 2 * Math.PI;\n  const strokeDasharray = `${circumference} ${circumference}`;\n  const strokeDashoffset = circumference - (score / 100) * circumference;\n\n  const getScoreColor = (score: number) => {\n    if (score >= 80) return 'text-emerald-500';\n    if (score >= 60) return 'text-yellow-500';\n    if (score >= 40) return 'text-orange-500';\n    return 'text-red-500';\n  };\n\n  const getStrokeColor = (score: number) => {\n    if (score >= 80) return '#10b981';\n    if (score >= 60) return '#f59e0b';\n    if (score >= 40) return '#f97316';\n    return '#ef4444';\n  };\n\n  return (\n    <div\n      className={cn(\n        'flex flex-col items-center justify-center',\n        size === 'sm' && 'gap-1',\n        size === 'md' && 'gap-2',\n        size === 'lg' && 'gap-3'\n      )}\n    >\n      <div className=\"relative\">\n        <svg\n          height={radius * 2}\n          width={radius * 2}\n          className=\"transform -rotate-90\"\n        >\n          <circle\n            stroke=\"#374151\"\n            fill=\"transparent\"\n            strokeWidth={strokeWidth}\n            r={normalizedRadius}\n            cx={radius}\n            cy={radius}\n          />\n          <circle\n            stroke={getStrokeColor(score)}\n            fill=\"transparent\"\n            strokeWidth={strokeWidth}\n            strokeDasharray={strokeDasharray}\n            strokeDashoffset={strokeDashoffset}\n            strokeLinecap=\"round\"\n            r={normalizedRadius}\n            cx={radius}\n            cy={radius}\n            className=\"transition-all duration-1000 ease-out\"\n          />\n        </svg>\n        <div className=\"absolute inset-0 flex items-center justify-center\">\n          <span\n            className={cn(\n              'font-bold',\n              getScoreColor(score),\n              size === 'sm' && 'text-sm',\n              size === 'md' && 'text-lg',\n              size === 'lg' && 'text-2xl'\n            )}\n          >\n            {score}\n          </span>\n          <span\n            className={cn(\n              'text-gray-400',\n              size === 'sm' && 'text-xs',\n              size === 'md' && 'text-sm',\n              size === 'lg' && 'text-base'\n            )}\n          >\n            %\n          </span>\n        </div>\n      </div>\n      {showLabel && (\n        <div\n          className={cn(\n            'text-center',\n            size === 'sm' && 'text-xs',\n            size === 'md' && 'text-sm',\n            size === 'lg' && 'text-base'\n          )}\n        >\n          <p className={cn('font-medium', getScoreColor(score))}>\n            {score >= 80\n              ? 'Authentic'\n              : score >= 60\n                ? 'Likely Authentic'\n                : score >= 40\n                  ? 'Questionable'\n                  : 'Suspicious'}\n          </p>\n          <p className=\"text-gray-400 text-xs mt-1\">Forensic Score</p>\n        </div>\n      )}\n    </div>\n  );\n};\n\ninterface AnalysisConfidenceBarProps {\n  label: string;\n  confidence: number;\n  color?: 'blue' | 'green' | 'red' | 'yellow';\n  icon?: React.ReactNode;\n}\n\nconst AnalysisConfidenceBar: React.FC<AnalysisConfidenceBarProps> = ({\n  label,\n  confidence,\n  color = 'blue',\n  icon,\n}) => {\n  const colorClasses = {\n    blue: 'bg-blue-500',\n    green: 'bg-emerald-500',\n    red: 'bg-red-500',\n    yellow: 'bg-yellow-500',\n  };\n\n  return (\n    <div className=\"space-y-2\">\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-2\">\n          {icon}\n          <span className=\"text-sm font-medium text-gray-200\">{label}</span>\n        </div>\n        <span className=\"text-sm text-gray-400\">{confidence}%</span>\n      </div>\n      <Progress value={confidence} className=\"h-2\" />\n    </div>\n  );\n};\n\nconst ForensicFindingCard: React.FC<ForensicFindingCardProps> = ({\n  title,\n  description,\n  severity,\n  confidence,\n  icon,\n}) => {\n  const severityConfig = {\n    low: {\n      border: 'border-slate-500/30',\n      bg: 'bg-slate-500/10',\n      text: 'text-slate-300',\n      badge: 'bg-slate-500/20 text-slate-400 border-slate-500/30',\n    },\n    medium: {\n      border: 'border-yellow-500/30',\n      bg: 'bg-yellow-500/10',\n      text: 'text-yellow-400',\n      badge: 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30',\n    },\n    high: {\n      border: 'border-red-500/30',\n      bg: 'bg-red-500/10',\n      text: 'text-red-400',\n      badge: 'bg-red-500/20 text-red-400 border-red-500/30',\n    },\n  };\n\n  const config = severityConfig[severity];\n\n  return (\n    <div className={cn('p-4 rounded-lg border', config.border, config.bg)}>\n      <div className=\"flex items-start justify-between mb-2\">\n        <div className=\"flex items-center gap-2\">\n          {icon}\n          <h5 className={cn('font-medium', config.text)}>{title}</h5>\n        </div>\n        <Badge className={cn('text-xs', config.badge)}>\n          {severity.toUpperCase()}\n        </Badge>\n      </div>\n      <p className=\"text-sm text-gray-300 mb-2\">{description}</p>\n      <div className=\"flex items-center justify-between\">\n        <span className=\"text-xs text-gray-400\">Confidence: {confidence}%</span>\n        <div className=\"w-24\">\n          <Progress value={confidence} className=\"h-1\" />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport const ForensicAnalysis: React.FC<ForensicAnalysisProps> = ({\n  steganography,\n  manipulation,\n  aiDetection,\n  authenticityScore = 0,\n  onReanalyze,\n  className,\n}) => {\n  const [activeTab, setActiveTab] = useState('overview');\n  const [isExpanded, setIsExpanded] = useState(false);\n\n  const hasAnalysisData = !!(steganography || manipulation || aiDetection);\n\n  // Calculate overall forensic metrics\n  const totalAnalyses = [steganography, manipulation, aiDetection].filter(\n    Boolean\n  ).length;\n  const suspiciousFindings = [\n    steganography?.detected ? 1 : 0,\n    manipulation?.detected ? 1 : 0,\n    aiDetection?.aiGenerated ? 1 : 0,\n  ].reduce((a, b) => a + b, 0);\n\n  const getAuthenticityIcon = (score: number) => {\n    if (score >= 80) return <Verified className=\"w-5 h-5 text-emerald-500\" />;\n    if (score >= 60) return <Shield className=\"w-5 h-5 text-yellow-500\" />;\n    if (score >= 40)\n      return <AlertTriangle className=\"w-5 h-5 text-orange-500\" />;\n    return <XCircle className=\"w-5 h-5 text-red-500\" />;\n  };\n\n  if (!hasAnalysisData) {\n    return (\n      <Card className={cn('bg-card border-white/10', className)}>\n        <CardContent className=\"py-8 text-center\">\n          <Fingerprint className=\"w-12 h-12 mx-auto mb-4 text-slate-500\" />\n          <p className=\"text-slate-300\">No forensic analysis data available</p>\n          <p className=\"text-xs text-slate-500 mt-2\">\n            Forensic analysis requires Advanced or Enterprise tier\n          </p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className={cn('bg-card border-white/10', className)}>\n      <CardHeader>\n        <div className=\"flex items-start justify-between\">\n          <div>\n            <CardTitle className=\"flex items-center gap-2 text-white\">\n              <Fingerprint className=\"w-5 h-5 text-primary\" />\n              Forensic Analysis\n            </CardTitle>\n            <p className=\"text-sm text-slate-300 mt-1\">\n              Advanced authenticity and manipulation detection\n            </p>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <ForensicScoreGauge score={authenticityScore} size=\"sm\" />\n            {onReanalyze && (\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={onReanalyze}\n                className=\"gap-2\"\n              >\n                <RotateCcw className=\"w-4 h-4\" />\n                Re-analyze\n              </Button>\n            )}\n          </div>\n        </div>\n      </CardHeader>\n\n      <CardContent>\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n          <TabsList className=\"grid w-full grid-cols-4 bg-muted/50\">\n            <TabsTrigger value=\"overview\" className=\"text-xs\">\n              <PieChart className=\"w-3 h-3 mr-1\" />\n              Overview\n            </TabsTrigger>\n            <TabsTrigger value=\"steganography\" className=\"text-xs\">\n              <Search className=\"w-3 h-3 mr-1\" />\n              Steganography\n            </TabsTrigger>\n            <TabsTrigger value=\"manipulation\" className=\"text-xs\">\n              <Activity className=\"w-3 h-3 mr-1\" />\n              Manipulation\n            </TabsTrigger>\n            <TabsTrigger value=\"ai\" className=\"text-xs\">\n              <Brain className=\"w-3 h-3 mr-1\" />\n              AI Detection\n            </TabsTrigger>\n          </TabsList>\n\n          {/* Overview Tab */}\n          <TabsContent value=\"overview\" className=\"mt-6 space-y-6\">\n            {/* Forensic Score Dashboard */}\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n              <div className=\"lg:col-span-1\">\n                <Card className=\"bg-muted/20 border-white/10 h-full\">\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex flex-col items-center justify-center h-full\">\n                      <ForensicScoreGauge score={authenticityScore} size=\"lg\" />\n                      <div className=\"mt-4 text-center\">\n                        <div className=\"flex items-center justify-center gap-2 mb-2\">\n                          {getAuthenticityIcon(authenticityScore)}\n                          <span className=\"text-sm font-medium text-white\">\n                            {authenticityScore >= 80\n                              ? 'Authentic'\n                              : authenticityScore >= 60\n                                ? 'Likely Authentic'\n                                : authenticityScore >= 40\n                                  ? 'Questionable'\n                                  : 'Suspicious'}\n                          </span>\n                        </div>\n                        <p className=\"text-xs text-gray-400\">\n                          Based on {totalAnalyses} forensic analyses\n                        </p>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n\n              <div className=\"lg:col-span-2 space-y-4\">\n                <AnalysisConfidenceBar\n                  label=\"Overall Authenticity\"\n                  confidence={authenticityScore}\n                  color={\n                    authenticityScore >= 80\n                      ? 'green'\n                      : authenticityScore >= 60\n                        ? 'yellow'\n                        : 'red'\n                  }\n                  icon={<Shield className=\"w-4 h-4 text-primary\" />}\n                />\n\n                {steganography && (\n                  <AnalysisConfidenceBar\n                    label=\"Steganography Analysis\"\n                    confidence={steganography.confidence}\n                    color={steganography.detected ? 'red' : 'green'}\n                    icon={<Search className=\"w-4 h-4 text-blue-500\" />}\n                  />\n                )}\n\n                {manipulation && (\n                  <AnalysisConfidenceBar\n                    label=\"Manipulation Detection\"\n                    confidence={manipulation.confidence}\n                    color={manipulation.detected ? 'red' : 'green'}\n                    icon={<Activity className=\"w-4 h-4 text-orange-500\" />}\n                  />\n                )}\n\n                {aiDetection && (\n                  <AnalysisConfidenceBar\n                    label=\"AI Generation Detection\"\n                    confidence={aiDetection.confidence}\n                    color={aiDetection.aiGenerated ? 'red' : 'green'}\n                    icon={<Brain className=\"w-4 h-4 text-purple-500\" />}\n                  />\n                )}\n              </div>\n            </div>\n\n            {/* Risk Assessment Summary */}\n            <Card className=\"bg-muted/20 border-white/10\">\n              <CardContent className=\"p-6\">\n                <h3 className=\"font-semibold text-white mb-4 flex items-center gap-2\">\n                  <Target className=\"w-4 h-4 text-primary\" />\n                  Risk Assessment Summary\n                </h3>\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                  <div className=\"text-center p-4 bg-slate-500/10 rounded-lg border border-slate-500/30\">\n                    <div className=\"text-2xl font-bold text-slate-300 mb-1\">\n                      {totalAnalyses}\n                    </div>\n                    <p className=\"text-xs text-slate-400\">Total Analyses</p>\n                  </div>\n\n                  <div\n                    className={cn(\n                      'text-center p-4 rounded-lg border',\n                      suspiciousFindings > 0\n                        ? 'bg-red-500/10 border-red-500/30'\n                        : 'bg-emerald-500/10 border-emerald-500/30'\n                    )}\n                  >\n                    <div\n                      className={cn(\n                        'text-2xl font-bold mb-1',\n                        suspiciousFindings > 0\n                          ? 'text-red-400'\n                          : 'text-emerald-400'\n                      )}\n                    >\n                      {suspiciousFindings}\n                    </div>\n                    <p\n                      className={cn(\n                        'text-xs',\n                        suspiciousFindings > 0\n                          ? 'text-red-300'\n                          : 'text-emerald-300'\n                      )}\n                    >\n                      Suspicious Findings\n                    </p>\n                  </div>\n\n                  <div className=\"text-center p-4 bg-primary/10 rounded-lg border border-primary/30\">\n                    <div className=\"text-2xl font-bold text-primary mb-1\">\n                      {Math.round(\n                        (1 - suspiciousFindings / Math.max(1, totalAnalyses)) *\n                          100\n                      )}\n                      %\n                    </div>\n                    <p className=\"text-xs text-primary/70\">Trust Score</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Detailed Findings */}\n            {isExpanded && (\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                  <h3 className=\"font-semibold text-white flex items-center gap-2\">\n                    <BarChart3 className=\"w-4 h-4 text-primary\" />\n                    Detailed Findings\n                  </h3>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => setIsExpanded(false)}\n                    className=\"text-xs\"\n                  >\n                    Hide Details\n                  </Button>\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  {steganography?.findings.map((finding, i) => (\n                    <ForensicFindingCard\n                      key={`stego-${i}`}\n                      title=\"Steganography Finding\"\n                      description={finding}\n                      severity={steganography.detected ? 'high' : 'low'}\n                      confidence={steganography.confidence}\n                      icon={<Search className=\"w-4 h-4 text-blue-500\" />}\n                    />\n                  ))}\n\n                  {manipulation?.indicators.map((indicator, i) => (\n                    <ForensicFindingCard\n                      key={`manip-${i}`}\n                      title={indicator.type}\n                      description={indicator.description}\n                      severity={indicator.severity}\n                      confidence={indicator.confidence}\n                      icon={<Activity className=\"w-4 h-4 text-orange-500\" />}\n                    />\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {!isExpanded && (\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => setIsExpanded(true)}\n                className=\"w-full gap-2\"\n              >\n                <BarChart3 className=\"w-4 h-4\" />\n                Show Detailed Findings\n              </Button>\n            )}\n          </TabsContent>\n\n          {/* Steganography Tab */}\n          <TabsContent value=\"steganography\" className=\"mt-6 space-y-6\">\n            {steganography ? (\n              <>\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <AuthenticityBadge\n                      score={\n                        steganography.detected\n                          ? Math.max(10, 100 - steganography.confidence)\n                          : steganography.confidence\n                      }\n                      label={\n                        steganography.detected\n                          ? 'Hidden Data Found'\n                          : 'No Hidden Data'\n                      }\n                    />\n                    <span className=\"text-sm text-slate-300\">\n                      {steganography.confidence}% confidence\n                    </span>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <Zap className=\"w-4 h-4 text-yellow-500\" />\n                    <span className=\"text-xs text-slate-400\">\n                      {steganography.methodsChecked.length} methods analyzed\n                    </span>\n                  </div>\n                </div>\n\n                {steganography.methodsChecked.length > 0 && (\n                  <div>\n                    <h4 className=\"text-sm font-semibold text-white mb-3 flex items-center gap-2\">\n                      <Search className=\"w-4 h-4 text-primary\" />\n                      Methods Analyzed\n                    </h4>\n                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-2\">\n                      {steganography.methodsChecked.map((method, i) => (\n                        <Badge\n                          key={i}\n                          variant=\"outline\"\n                          className=\"text-xs border-white/20 justify-center\"\n                        >\n                          {method}\n                        </Badge>\n                      ))}\n                    </div>\n                  </div>\n                )}\n\n                {steganography.findings.length > 0 && (\n                  <div>\n                    <h4 className=\"text-sm font-semibold text-white mb-3 flex items-center gap-2\">\n                      <AlertTriangle className=\"w-4 h-4 text-primary\" />\n                      Findings\n                    </h4>\n                    <div className=\"space-y-3\">\n                      {steganography.findings.map((finding, i) => (\n                        <ForensicFindingCard\n                          key={i}\n                          title=\"Steganography Detection\"\n                          description={finding}\n                          severity={steganography.detected ? 'high' : 'low'}\n                          confidence={steganography.confidence}\n                          icon={<Search className=\"w-4 h-4 text-blue-500\" />}\n                        />\n                      ))}\n                    </div>\n                  </div>\n                )}\n\n                {steganography.details && (\n                  <div>\n                    <h4 className=\"text-sm font-semibold text-white mb-3 flex items-center gap-2\">\n                      <FileText className=\"w-4 h-4 text-primary\" />\n                      Analysis Details\n                    </h4>\n                    <div className=\"p-4 bg-muted/30 rounded-lg border border-white/10\">\n                      <p className=\"text-sm text-slate-200 leading-relaxed\">\n                        {steganography.details}\n                      </p>\n                    </div>\n                  </div>\n                )}\n              </>\n            ) : (\n              <div className=\"text-center py-8\">\n                <Search className=\"w-12 h-12 mx-auto mb-4 text-slate-500\" />\n                <p className=\"text-slate-400\">\n                  Steganography analysis not available\n                </p>\n              </div>\n            )}\n          </TabsContent>\n\n          {/* Manipulation Tab */}\n          <TabsContent value=\"manipulation\" className=\"mt-6 space-y-6\">\n            {manipulation ? (\n              <>\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <AuthenticityBadge\n                      score={\n                        manipulation.detected\n                          ? Math.max(10, 100 - manipulation.confidence)\n                          : manipulation.confidence\n                      }\n                      label={\n                        manipulation.detected\n                          ? 'Manipulation Detected'\n                          : 'No Manipulation'\n                      }\n                    />\n                    <span className=\"text-sm text-slate-300\">\n                      {manipulation.confidence}% confidence\n                    </span>\n                  </div>\n                  {manipulation.originalityScore !== undefined && (\n                    <div className=\"flex items-center gap-2\">\n                      <TrendingUp className=\"w-4 h-4 text-green-500\" />\n                      <span className=\"text-xs text-slate-400\">\n                        Originality: {manipulation.originalityScore}%\n                      </span>\n                    </div>\n                  )}\n                </div>\n\n                {manipulation.originalityScore !== undefined && (\n                  <div className=\"p-4 bg-muted/30 rounded-lg border border-white/10\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-2\">\n                        <TrendingUp className=\"w-4 h-4 text-green-500\" />\n                        <span className=\"text-slate-300\">\n                          Originality Score:\n                        </span>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <Progress\n                          value={manipulation.originalityScore}\n                          className=\"w-32 h-2\"\n                        />\n                        <span className=\"font-bold text-white\">\n                          {manipulation.originalityScore}%\n                        </span>\n                      </div>\n                    </div>\n                  </div>\n                )}\n\n                {manipulation.indicators.length > 0 && (\n                  <div>\n                    <h4 className=\"text-sm font-semibold text-white mb-3 flex items-center gap-2\">\n                      <Activity className=\"w-4 h-4 text-primary\" />\n                      Manipulation Indicators\n                    </h4>\n                    <div className=\"space-y-4\">\n                      {manipulation.indicators.map((indicator, i) => (\n                        <ForensicFindingCard\n                          key={i}\n                          title={indicator.type}\n                          description={indicator.description}\n                          severity={indicator.severity}\n                          confidence={indicator.confidence}\n                          icon={\n                            <Activity className=\"w-4 h-4 text-orange-500\" />\n                          }\n                        />\n                      ))}\n                    </div>\n                  </div>\n                )}\n              </>\n            ) : (\n              <div className=\"text-center py-8\">\n                <Activity className=\"w-12 h-12 mx-auto mb-4 text-slate-500\" />\n                <p className=\"text-slate-400\">\n                  Manipulation detection not available\n                </p>\n              </div>\n            )}\n          </TabsContent>\n\n          {/* AI Detection Tab */}\n          <TabsContent value=\"ai\" className=\"mt-6 space-y-6\">\n            {aiDetection ? (\n              <>\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <AuthenticityBadge\n                      score={\n                        aiDetection.aiGenerated\n                          ? Math.max(10, 100 - aiDetection.confidence)\n                          : aiDetection.confidence\n                      }\n                      label={\n                        aiDetection.aiGenerated\n                          ? 'AI Generated'\n                          : 'Likely Original'\n                      }\n                    />\n                    <span className=\"text-sm text-slate-300\">\n                      {aiDetection.confidence}% confidence\n                    </span>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <Brain className=\"w-4 h-4 text-purple-500\" />\n                    <span className=\"text-xs text-slate-400\">\n                      {aiDetection.detectionMethods.length} methods used\n                    </span>\n                  </div>\n                </div>\n\n                {aiDetection.detectionMethods.length > 0 && (\n                  <div>\n                    <h4 className=\"text-sm font-semibold text-white mb-3 flex items-center gap-2\">\n                      <Brain className=\"w-4 h-4 text-primary\" />\n                      Detection Methods\n                    </h4>\n                    <div className=\"grid grid-cols-2 md:grid-cols-3 gap-2\">\n                      {aiDetection.detectionMethods.map((method, i) => (\n                        <Badge\n                          key={i}\n                          variant=\"outline\"\n                          className=\"text-xs border-white/20 justify-center\"\n                        >\n                          {method}\n                        </Badge>\n                      ))}\n                    </div>\n                  </div>\n                )}\n\n                {aiDetection.modelHints.length > 0 && (\n                  <div>\n                    <h4 className=\"text-sm font-semibold text-white mb-3 flex items-center gap-2\">\n                      <Zap className=\"w-4 h-4 text-primary\" />\n                      Model Indicators\n                    </h4>\n                    <div className=\"flex flex-wrap gap-2\">\n                      {aiDetection.modelHints.map((hint, i) => (\n                        <Badge\n                          key={i}\n                          variant=\"outline\"\n                          className=\"text-xs border-purple-500/30 bg-purple-500/10 text-purple-400\"\n                        >\n                          {hint}\n                        </Badge>\n                      ))}\n                    </div>\n                  </div>\n                )}\n\n                <div className=\"flex gap-2 pt-4\">\n                  <Button variant=\"outline\" className=\"gap-2\">\n                    <Download className=\"w-4 h-4\" />\n                    Export Report\n                  </Button>\n                  <Button variant=\"outline\" className=\"gap-2\">\n                    <FileText className=\"w-4 h-4\" />\n                    View Technical Details\n                  </Button>\n                </div>\n              </>\n            ) : (\n              <div className=\"text-center py-8\">\n                <Brain className=\"w-12 h-12 mx-auto mb-4 text-slate-500\" />\n                <p className=\"text-slate-400\">AI detection not available</p>\n              </div>\n            )}\n          </TabsContent>\n        </Tabs>\n      </CardContent>\n    </Card>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/v2-results/ForensicBadges.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/v2-results/ForensicDemo.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Badge' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertTriangle' is defined but never used.","line":8,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Eye' is defined but never used.","line":9,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":6},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Camera' is defined but never used.","line":10,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Play' is defined but never used.","line":12,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":7}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { \n  Fingerprint, \n  Shield, \n  AlertTriangle, \n  Eye, \n  Camera, \n  Upload,\n  Play,\n  RotateCcw,\n  Download,\n  FileText,\n  Settings,\n  Zap\n} from 'lucide-react';\nimport { ForensicAnalysis } from './ForensicAnalysis';\nimport { ProgressiveDisclosure } from './ProgressiveDisclosure';\nimport { KeyFindings } from './KeyFindings';\nimport { AuthenticityBadge, ForensicConfidenceIndicator } from './AuthenticityBadge';\nimport { cn } from '@/lib/utils';\n\n// Demo data showcasing different forensic scenarios\nconst demoScenarios = {\n  authentic: {\n    title: 'Authentic Image',\n    description: 'Clean, unedited photograph with complete metadata',\n    forensicScore: 92,\n    keyFindings: {\n      when: 'January 15, 2025 at 2:30 PM',\n      where: 'Central Park, New York',\n      device: 'iPhone 15 Pro',\n      edited: false,\n      authenticity: 'Appears authentic',\n      confidence: 'high' as const\n    },\n    forensicAnalysis: {\n      steganography: {\n        detected: false,\n        confidence: 96,\n        methodsChecked: ['LSB Analysis', 'DCT Transform', 'Echo Hiding', 'Spread Spectrum'],\n        findings: ['No hidden data detected in any channel'],\n        details: 'Comprehensive steganography analysis using multiple detection algorithms'\n      },\n      manipulation: {\n        detected: false,\n        confidence: 89,\n        indicators: [],\n        originalityScore: 94\n      },\n      aiDetection: {\n        aiGenerated: false,\n        confidence: 93,\n        modelHints: [],\n        detectionMethods: ['Frequency Analysis', 'Artifact Detection', 'Noise Pattern Analysis']\n      },\n      authenticityScore: 92\n    }\n  },\n  \n  suspicious: {\n    title: 'Suspicious Image',\n    description: 'Potential manipulation and AI generation detected',\n    forensicScore: 34,\n    keyFindings: {\n      when: 'Unknown date and time',\n      where: 'No location data',\n      device: 'Unknown device',\n      edited: true,\n      authenticity: 'Suspicious - requires review',\n      confidence: 'low' as const\n    },\n    forensicAnalysis: {\n      steganography: {\n        detected: true,\n        confidence: 78,\n        methodsChecked: ['LSB Analysis', 'DCT Transform'],\n        findings: ['Potential hidden data in blue channel', 'Anomalous noise patterns detected'],\n        details: 'Evidence of data hiding techniques'\n      },\n      manipulation: {\n        detected: true,\n        confidence: 82,\n        indicators: [\n          {\n            type: 'Clone Detection',\n            severity: 'high' as const,\n            description: 'Evidence of cloning tool usage in upper right region',\n            confidence: 85\n          },\n          {\n            type: 'Resampling Artifacts',\n            severity: 'medium' as const,\n            description: 'Unusual resampling patterns suggest scaling operations',\n            confidence: 73\n          }\n        ],\n        originalityScore: 31\n      },\n      aiDetection: {\n        aiGenerated: true,\n        confidence: 76,\n        modelHints: ['Midjourney v6', 'Stable Diffusion'],\n        detectionMethods: ['GAN Artifact Detection', 'Frequency Analysis']\n      },\n      authenticityScore: 34\n    }\n  },\n  \n  questionable: {\n    title: 'Questionable Image',\n    description: 'Mixed signals - requires further investigation',\n    forensicScore: 67,\n    keyFindings: {\n      when: 'January 10, 2025 at 4:15 PM (approximate)',\n      where: 'Los Angeles, California (estimated)',\n      device: 'Professional camera (model unclear)',\n      edited: true,\n      authenticity: 'Questionable - metadata inconsistencies',\n      confidence: 'medium' as const\n    },\n    forensicAnalysis: {\n      steganography: {\n        detected: false,\n        confidence: 64,\n        methodsChecked: ['Basic LSB', 'DCT Transform'],\n        findings: ['Inconclusive results due to compression artifacts'],\n        details: 'Limited analysis possible due to image quality'\n      },\n      manipulation: {\n        detected: false,\n        confidence: 58,\n        indicators: [\n          {\n            type: 'Compression Artifacts',\n            severity: 'low' as const,\n            description: 'Heavy compression may mask manipulation signs',\n            confidence: 62\n          }\n        ],\n        originalityScore: 71\n      },\n      aiDetection: {\n        aiGenerated: false,\n        confidence: 45,\n        modelHints: [],\n        detectionMethods: ['Basic Frequency Analysis']\n      },\n      authenticityScore: 67\n    }\n  }\n};\n\ninterface ForensicDemoProps {\n  className?: string;\n  defaultScenario?: keyof typeof demoScenarios;\n  showControls?: boolean;\n  showComparison?: boolean;\n}\n\nexport const ForensicDemo: React.FC<ForensicDemoProps> = ({\n  className,\n  defaultScenario = 'authentic',\n  showControls = true,\n  showComparison = false\n}) => {\n  const [activeScenario, setActiveScenario] = useState<keyof typeof demoScenarios>(defaultScenario);\n  const [isAnalyzing, setIsAnalyzing] = useState(false);\n  const [showAdvanced, setShowAdvanced] = useState(false);\n\n  const currentScenario = demoScenarios[activeScenario];\n\n  const handleScenarioChange = (scenario: keyof typeof demoScenarios) => {\n    setIsAnalyzing(true);\n    setActiveScenario(scenario);\n    \n    // Simulate analysis delay\n    setTimeout(() => {\n      setIsAnalyzing(false);\n    }, 1500);\n  };\n\n  const handleReanalyze = () => {\n    setIsAnalyzing(true);\n    setTimeout(() => {\n      setIsAnalyzing(false);\n    }, 2000);\n  };\n\n  const progressiveDisclosureData = {\n    keyFindings: currentScenario.keyFindings,\n    quickDetails: {\n      resolution: '12.2 megapixels',\n      fileSize: '3.2 MB',\n      cameraSettings: 'f/1.6, 1/120s, ISO 64',\n      colorSpace: 'sRGB',\n      dimensions: '4032 x 3024'\n    },\n    location: {\n      latitude: 37.7749,\n      longitude: -122.4194\n    },\n    advancedMetadata: {\n      exif: {\n        Make: 'Apple',\n        Model: 'iPhone 15 Pro',\n        Software: 'iOS 17.1'\n      },\n      fileSystem: {\n        created: '2025-01-15T14:30:00Z',\n        modified: '2025-01-15T14:30:00Z'\n      }\n    },\n    forensicAnalysis: currentScenario.forensicAnalysis\n  };\n\n  return (\n    <div className={cn(\"w-full space-y-6\", className)}>\n      {/* Header */}\n      <div className=\"text-center space-y-4\">\n        <div className=\"flex items-center justify-center gap-3\">\n          <Fingerprint className=\"w-8 h-8 text-primary\" />\n          <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">\n            Forensic Analysis Demo\n          </h1>\n        </div>\n        <p className=\"text-gray-600 dark:text-gray-400 max-w-2xl mx-auto\">\n          Explore advanced forensic analysis capabilities with different image scenarios. \n          See how our AI-powered detection identifies manipulation, steganography, and AI generation.\n        </p>\n      </div>\n\n      {/* Scenario Controls */}\n      {showControls && (\n        <Card className=\"bg-card border-white/10\">\n          <CardHeader>\n            <CardTitle className=\"text-white\">Demo Scenarios</CardTitle>\n            <p className=\"text-sm text-slate-300\">Test different forensic analysis scenarios</p>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              {Object.entries(demoScenarios).map(([key, scenario]) => (\n                <Button\n                  key={key}\n                  variant={activeScenario === key ? \"default\" : \"outline\"}\n                  onClick={() => handleScenarioChange(key as keyof typeof demoScenarios)}\n                  disabled={isAnalyzing}\n                  className={cn(\n                    \"justify-start text-left h-auto py-3 px-4\",\n                    scenario.forensicScore >= 80 && \"border-emerald-500/50 text-emerald-300\",\n                    scenario.forensicScore >= 60 && scenario.forensicScore < 80 && \"border-yellow-500/50 text-yellow-300\",\n                    scenario.forensicScore < 60 && \"border-red-500/50 text-red-300\"\n                  )}\n                >\n                  <div className=\"space-y-1\">\n                    <div className=\"flex items-center gap-2\">\n                      <div className={cn(\n                        \"w-3 h-3 rounded-full\",\n                        scenario.forensicScore >= 80 ? \"bg-emerald-500\" :\n                        scenario.forensicScore >= 60 ? \"bg-yellow-500\" :\n                        \"bg-red-500\"\n                      )} />\n                      <span className=\"font-medium\">{scenario.title}</span>\n                    </div>\n                    <p className=\"text-xs text-slate-400\">{scenario.description}</p>\n                    <AuthenticityBadge score={scenario.forensicScore} variant=\"compact\" />\n                  </div>\n                </Button>\n              ))}\n            </div>\n            \n            <div className=\"flex items-center justify-between pt-4 border-t border-white/10\">\n              <div className=\"flex items-center gap-2\">\n                <Zap className=\"w-4 h-4 text-yellow-500\" />\n                <span className=\"text-sm text-slate-300\">\n                  {isAnalyzing ? 'Analyzing...' : 'Analysis complete'}\n                </span>\n              </div>\n              <Button\n                variant=\"outline\"\n                onClick={handleReanalyze}\n                disabled={isAnalyzing}\n                className=\"gap-2\"\n              >\n                <RotateCcw className=\"w-4 h-4\" />\n                Re-analyze\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Current Scenario Display */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Key Findings */}\n        <Card className=\"bg-card border-white/10\">\n          <CardHeader>\n            <CardTitle className=\"text-white flex items-center gap-2\">\n              <Shield className=\"w-5 h-5\" />\n              Key Findings\n            </CardTitle>\n            <p className=\"text-sm text-slate-300\">{currentScenario.description}</p>\n          </CardHeader>\n          <CardContent>\n            <KeyFindings\n              findings={currentScenario.keyFindings}\n              forensicScore={currentScenario.forensicScore}\n              forensicAnalysis={currentScenario.forensicAnalysis}\n              showForensicIndicators={true}\n            />\n          </CardContent>\n        </Card>\n\n        {/* Forensic Score */}\n        <Card className=\"bg-card border-white/10\">\n          <CardHeader>\n            <CardTitle className=\"text-white flex items-center gap-2\">\n              <Fingerprint className=\"w-5 h-5\" />\n              Forensic Assessment\n            </CardTitle>\n            <p className=\"text-sm text-slate-300\">Overall authenticity analysis</p>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div className=\"flex flex-col items-center justify-center py-8\">\n              <div className={cn(\n                \"text-6xl font-bold mb-2\",\n                currentScenario.forensicScore >= 80 ? \"text-emerald-500\" :\n                currentScenario.forensicScore >= 60 ? \"text-yellow-500\" :\n                \"text-red-500\"\n              )}>\n                {currentScenario.forensicScore}%\n              </div>\n              <AuthenticityBadge \n                score={currentScenario.forensicScore} \n                variant=\"detailed\"\n                size=\"lg\"\n              />\n            </div>\n            \n            <div className=\"space-y-3\">\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-slate-300\">Steganography Risk</span>\n                <ForensicConfidenceIndicator\n                  confidence={currentScenario.forensicAnalysis.steganography?.confidence || 0}\n                  type=\"manipulation\"\n                  size=\"sm\"\n                />\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-slate-300\">Manipulation Risk</span>\n                <ForensicConfidenceIndicator\n                  confidence={currentScenario.forensicAnalysis.manipulation?.confidence || 0}\n                  type=\"manipulation\"\n                  size=\"sm\"\n                />\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-slate-300\">AI Generation Risk</span>\n                <ForensicConfidenceIndicator\n                  confidence={currentScenario.forensicAnalysis.aiDetection?.confidence || 0}\n                  type=\"ai-detection\"\n                  size=\"sm\"\n                />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Detailed Forensic Analysis */}\n      <Card className=\"bg-card border-white/10\">\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <CardTitle className=\"text-white flex items-center gap-2\">\n                <Fingerprint className=\"w-5 h-5\" />\n                Detailed Forensic Analysis\n              </CardTitle>\n              <p className=\"text-sm text-slate-300\">\n                Comprehensive analysis breakdown\n              </p>\n            </div>\n            <div className=\"flex gap-2\">\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => setShowAdvanced(!showAdvanced)}\n              >\n                <Settings className=\"w-4 h-4 mr-1\" />\n                {showAdvanced ? 'Simple' : 'Advanced'}\n              </Button>\n              <Button variant=\"outline\" size=\"sm\" className=\"gap-2\">\n                <Download className=\"w-4 h-4\" />\n                Export\n              </Button>\n              <Button variant=\"outline\" size=\"sm\" className=\"gap-2\">\n                <FileText className=\"w-4 h-4\" />\n                Report\n              </Button>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {isAnalyzing ? (\n            <div className=\"py-12 text-center\">\n              <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4\" />\n              <p className=\"text-slate-300\">Analyzing image forensics...</p>\n            </div>\n          ) : (\n            showAdvanced ? (\n              <ForensicAnalysis\n                steganography={currentScenario.forensicAnalysis.steganography}\n                manipulation={currentScenario.forensicAnalysis.manipulation}\n                aiDetection={currentScenario.forensicAnalysis.aiDetection}\n                authenticityScore={currentScenario.forensicScore}\n                onReanalyze={handleReanalyze}\n              />\n            ) : (\n              <ProgressiveDisclosure\n                data={progressiveDisclosureData}\n                showForensicAnalysis={true}\n                defaultTab=\"forensic\"\n              />\n            )\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Comparison View */}\n      {showComparison && (\n        <Card className=\"bg-card border-white/10\">\n          <CardHeader>\n            <CardTitle className=\"text-white\">Scenario Comparison</CardTitle>\n            <p className=\"text-sm text-slate-300\">Compare forensic results across different scenarios</p>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              {Object.entries(demoScenarios).map(([key, scenario]) => (\n                <div\n                  key={key}\n                  className={cn(\n                    \"p-4 rounded-lg border\",\n                    \"bg-slate-50 dark:bg-slate-900\",\n                    \"border-slate-200 dark:border-slate-700\"\n                  )}\n                >\n                  <div className=\"flex items-center justify-between mb-3\">\n                    <h4 className=\"font-medium text-slate-900 dark:text-white\">\n                      {scenario.title}\n                    </h4>\n                    <AuthenticityBadge score={scenario.forensicScore} variant=\"compact\" />\n                  </div>\n                  <div className=\"space-y-2 text-xs\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-slate-600 dark:text-slate-400\">Steganography:</span>\n                      <span className={cn(\n                        scenario.forensicAnalysis.steganography?.detected ? \"text-red-500\" : \"text-emerald-500\"\n                      )}>\n                        {scenario.forensicAnalysis.steganography?.detected ? 'Detected' : 'Clean'}\n                      </span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-slate-600 dark:text-slate-400\">Manipulation:</span>\n                      <span className={cn(\n                        scenario.forensicAnalysis.manipulation?.detected ? \"text-red-500\" : \"text-emerald-500\"\n                      )}>\n                        {scenario.forensicAnalysis.manipulation?.detected ? 'Detected' : 'Clean'}\n                      </span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-slate-600 dark:text-slate-400\">AI Generated:</span>\n                      <span className={cn(\n                        scenario.forensicAnalysis.aiDetection?.aiGenerated ? \"text-red-500\" : \"text-emerald-500\"\n                      )}>\n                        {scenario.forensicAnalysis.aiDetection?.aiGenerated ? 'Yes' : 'No'}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Upload Your Own */}\n      <div className=\"text-center p-8 bg-gradient-to-r from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 rounded-lg border border-slate-200 dark:border-slate-700\">\n        <Upload className=\"w-12 h-12 mx-auto mb-4 text-slate-500\" />\n        <h3 className=\"text-lg font-semibold text-slate-900 dark:text-white mb-2\">\n          Try Your Own Image\n        </h3>\n        <p className=\"text-slate-600 dark:text-slate-400 mb-4\">\n          Upload an image to see real forensic analysis in action\n        </p>\n        <Button className=\"gap-2\">\n          <Upload className=\"w-4 h-4\" />\n          Upload Image\n        </Button>\n      </div>\n    </div>\n  );\n};\n\nexport default ForensicDemo;\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/v2-results/GeospatialMap.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Settings' is defined but never used.","line":11,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { \n  MapPin, \n  Navigation, \n  Globe, \n  Eye, \n  Download,\n  Settings,\n  ZoomIn,\n  ZoomOut,\n  RotateCcw\n} from 'lucide-react';\n\ninterface LocationData {\n  latitude: number;\n  longitude: number;\n  accuracy?: number;\n  altitude?: number;\n  address?: string;\n  city?: string;\n  region?: string;\n  country?: string;\n  timestamp?: string;\n  provider?: string;\n  bearing?: number;\n  speed?: number;\n}\n\ninterface GeospatialMapProps {\n  location: LocationData;\n  title?: string;\n  showControls?: boolean;\n}\n\nexport const GeospatialMap: React.FC<GeospatialMapProps> = ({ \n  location, \n  title = 'Geospatial Location',\n  showControls = true\n}) => {\n  const [zoom, setZoom] = useState(12);\n  const [mapType, setMapType] = useState<'roadmap' | 'satellite' | 'hybrid'>('roadmap');\n  \n  // Simulate map loading\n  const [isLoading, setIsLoading] = useState(true);\n  \n  useEffect(() => {\n    // Simulate map loading\n    const timer = setTimeout(() => {\n      setIsLoading(false);\n    }, 800);\n    \n    return () => clearTimeout(timer);\n  }, []);\n\n  const handleZoomIn = () => {\n    setZoom(prev => Math.min(prev + 1, 18));\n  };\n\n  const handleZoomOut = () => {\n    setZoom(prev => Math.max(prev - 1, 1));\n  };\n\n  const handleMapTypeChange = (type: 'roadmap' | 'satellite' | 'hybrid') => {\n    setMapType(type);\n  };\n\n  const handleReset = () => {\n    setZoom(12);\n    setMapType('roadmap');\n  };\n\n  const getMapUrl = () => {\n    // This would be replaced with an actual map service URL in a real implementation\n    // For now, we'll return a placeholder\n    return `https://placehold.co/600x400?text=Map+${location.latitude.toFixed(4)},${location.longitude.toFixed(4)}`;\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <Card className=\"bg-card border-white/10\">\n        <CardHeader>\n          <CardTitle className=\"text-white flex items-center gap-2\">\n            <Globe className=\"w-5 h-5 text-primary\" />\n            {title}\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n            {/* Map Visualization */}\n            <div className=\"lg:col-span-2\">\n              <div className=\"bg-muted/20 rounded-lg overflow-hidden aspect-video relative\">\n                {isLoading ? (\n                  <div className=\"w-full h-full flex items-center justify-center\">\n                    <div className=\"text-center\">\n                      <Globe className=\"w-12 h-12 mx-auto text-primary mb-2 animate-pulse\" />\n                      <p className=\"text-slate-300\">Loading map...</p>\n                    </div>\n                  </div>\n                ) : (\n                  <div className=\"w-full h-full flex items-center justify-center\">\n                    <img \n                      src={getMapUrl()} \n                      alt={`Map of ${location.address || `${location.latitude}, ${location.longitude}`}`}\n                      className=\"w-full h-full object-cover\"\n                    />\n                    <div className=\"absolute top-4 left-4 flex gap-2\">\n                      <Badge variant=\"secondary\" className=\"bg-blue-500/20 text-blue-400 border-blue-500/30\">\n                        {mapType.charAt(0).toUpperCase() + mapType.slice(1)}\n                      </Badge>\n                      <Badge variant=\"secondary\" className=\"bg-purple-500/20 text-purple-400 border-purple-500/30\">\n                        Zoom: {zoom}\n                      </Badge>\n                    </div>\n                  </div>\n                )}\n                \n                {/* Map Controls */}\n                {showControls && (\n                  <div className=\"absolute bottom-4 right-4 flex flex-col gap-2\">\n                    <Button \n                      variant=\"outline\" \n                      size=\"sm\" \n                      onClick={handleZoomIn}\n                      className=\"p-2\"\n                    >\n                      <ZoomIn className=\"w-4 h-4\" />\n                    </Button>\n                    <Button \n                      variant=\"outline\" \n                      size=\"sm\" \n                      onClick={handleZoomOut}\n                      className=\"p-2\"\n                    >\n                      <ZoomOut className=\"w-4 h-4\" />\n                    </Button>\n                    <Button \n                      variant=\"outline\" \n                      size=\"sm\" \n                      onClick={handleReset}\n                      className=\"p-2\"\n                    >\n                      <RotateCcw className=\"w-4 h-4\" />\n                    </Button>\n                  </div>\n                )}\n              </div>\n              \n              {/* Map Type Controls */}\n              {showControls && (\n                <div className=\"flex gap-2 mt-4\">\n                  <Button \n                    variant={mapType === 'roadmap' ? 'default' : 'outline'}\n                    size=\"sm\"\n                    onClick={() => handleMapTypeChange('roadmap')}\n                  >\n                    Roadmap\n                  </Button>\n                  <Button \n                    variant={mapType === 'satellite' ? 'default' : 'outline'}\n                    size=\"sm\"\n                    onClick={() => handleMapTypeChange('satellite')}\n                  >\n                    Satellite\n                  </Button>\n                  <Button \n                    variant={mapType === 'hybrid' ? 'default' : 'outline'}\n                    size=\"sm\"\n                    onClick={() => handleMapTypeChange('hybrid')}\n                  >\n                    Hybrid\n                  </Button>\n                  <Button \n                    variant=\"outline\" \n                    size=\"sm\" \n                    className=\"ml-auto\"\n                  >\n                    <Download className=\"w-4 h-4 mr-2\" />\n                    Export\n                  </Button>\n                </div>\n              )}\n            </div>\n            \n            {/* Location Information */}\n            <div className=\"space-y-4\">\n              <Card className=\"bg-muted/20 border-white/10\">\n                <CardContent className=\"p-4\">\n                  <h3 className=\"font-semibold text-white mb-3 flex items-center gap-2\">\n                    <MapPin className=\"w-4 h-4 text-primary\" />\n                    Location Details\n                  </h3>\n                  \n                  <div className=\"space-y-3\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-slate-300\">Coordinates:</span>\n                      <span className=\"text-white font-mono text-sm\">\n                        {location.latitude.toFixed(6)}, {location.longitude.toFixed(6)}\n                      </span>\n                    </div>\n                    \n                    {location.address && (\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-slate-300\">Address:</span>\n                        <span className=\"text-white text-sm max-w-[140px] truncate\">{location.address}</span>\n                      </div>\n                    )}\n                    \n                    {location.city && (\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-slate-300\">City:</span>\n                        <span className=\"text-white\">{location.city}</span>\n                      </div>\n                    )}\n                    \n                    {location.region && (\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-slate-300\">Region:</span>\n                        <span className=\"text-white\">{location.region}</span>\n                      </div>\n                    )}\n                    \n                    {location.country && (\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-slate-300\">Country:</span>\n                        <span className=\"text-white\">{location.country}</span>\n                      </div>\n                    )}\n                    \n                    {location.altitude !== undefined && (\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-slate-300\">Altitude:</span>\n                        <span className=\"text-white\">{location.altitude}m</span>\n                      </div>\n                    )}\n                    \n                    {location.accuracy !== undefined && (\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-slate-300\">Accuracy:</span>\n                        <span className=\"text-white\">{location.accuracy}m</span>\n                      </div>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n              \n              {/* Location Metadata */}\n              <Card className=\"bg-muted/20 border-white/10\">\n                <CardContent className=\"p-4\">\n                  <h3 className=\"font-semibold text-white mb-3 flex items-center gap-2\">\n                    <Navigation className=\"w-4 h-4 text-primary\" />\n                    Metadata\n                  </h3>\n                  \n                  <div className=\"space-y-2\">\n                    {location.timestamp && (\n                      <div className=\"flex justify-between text-sm\">\n                        <span className=\"text-slate-300\">Timestamp:</span>\n                        <span className=\"text-white\">{new Date(location.timestamp).toLocaleString()}</span>\n                      </div>\n                    )}\n                    \n                    {location.provider && (\n                      <div className=\"flex justify-between text-sm\">\n                        <span className=\"text-slate-300\">Provider:</span>\n                        <span className=\"text-white\">{location.provider}</span>\n                      </div>\n                    )}\n                    \n                    {location.bearing !== undefined && (\n                      <div className=\"flex justify-between text-sm\">\n                        <span className=\"text-slate-300\">Bearing:</span>\n                        <span className=\"text-white\">{location.bearing}</span>\n                      </div>\n                    )}\n                    \n                    {location.speed !== undefined && (\n                      <div className=\"flex justify-between text-sm\">\n                        <span className=\"text-slate-300\">Speed:</span>\n                        <span className=\"text-white\">{location.speed} m/s</span>\n                      </div>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n              \n              {/* Location Quality Assessment */}\n              <Card className=\"bg-muted/20 border-white/10\">\n                <CardContent className=\"p-4\">\n                  <h3 className=\"font-semibold text-white mb-3 flex items-center gap-2\">\n                    <Eye className=\"w-4 h-4 text-primary\" />\n                    Quality Assessment\n                  </h3>\n                  \n                  <div className=\"space-y-3\">\n                    <div>\n                      <div className=\"flex justify-between text-sm mb-1\">\n                        <span className=\"text-slate-300\">Accuracy</span>\n                        <span className=\"text-white\">\n                          {location.accuracy !== undefined \n                            ? location.accuracy < 10 ? 'High' \n                              : location.accuracy < 50 ? 'Medium' \n                              : 'Low'\n                            : 'Unknown'}\n                        </span>\n                      </div>\n                      <div className=\"w-full bg-muted rounded-full h-2\">\n                        <div \n                          className=\"bg-emerald-500 h-2 rounded-full\" \n                          style={{ \n                            width: location.accuracy !== undefined \n                              ? `${Math.max(0, Math.min(100, 100 - (location.accuracy / 10)))}%` \n                              : '0%' \n                          }}\n                        ></div>\n                      </div>\n                    </div>\n                    \n                    <div className=\"pt-2 border-t border-white/10\">\n                      <h4 className=\"text-xs font-semibold text-slate-300 mb-2\">Location Tags</h4>\n                      <div className=\"flex flex-wrap gap-2\">\n                        <Badge variant=\"secondary\" className=\"bg-blue-500/20 text-blue-400 border-blue-500/30\">\n                          GPS\n                        </Badge>\n                        {location.provider && (\n                          <Badge variant=\"secondary\" className=\"bg-purple-500/20 text-purple-400 border-purple-500/30\">\n                            {location.provider}\n                          </Badge>\n                        )}\n                        {location.accuracy !== undefined && (\n                          <Badge variant=\"secondary\" className=\"bg-green-500/20 text-green-400 border-green-500/30\">\n                            {location.accuracy < 10 ? 'Precise' : location.accuracy < 50 ? 'Standard' : 'Rough'}\n                          </Badge>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n      \n      {/* Location Context */}\n      <Card className=\"bg-card border-white/10\">\n        <CardHeader>\n          <CardTitle className=\"text-white flex items-center gap-2\">\n            <Globe className=\"w-5 h-5 text-primary\" />\n            Location Context\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div className=\"p-4 bg-muted/20 rounded-lg\">\n              <p className=\"text-sm text-slate-300 mb-1\">Coordinates</p>\n              <p className=\"text-lg font-bold text-white\">\n                {location.latitude.toFixed(4)}, {location.longitude.toFixed(4)}\n              </p>\n            </div>\n            \n            <div className=\"p-4 bg-muted/20 rounded-lg\">\n              <p className=\"text-sm text-slate-300 mb-1\">Location Type</p>\n              <p className=\"text-lg font-bold text-white\">\n                {location.address ? 'Address' : 'Coordinates'}\n              </p>\n            </div>\n            \n            <div className=\"p-4 bg-muted/20 rounded-lg\">\n              <p className=\"text-sm text-slate-300 mb-1\">Authenticity</p>\n              <div className=\"flex items-center gap-2\">\n                <Eye className=\"w-5 h-5 text-emerald-500\" />\n                <span className=\"text-lg font-bold text-emerald-400\">Verified</span>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/v2-results/KeyFindings.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":515,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":515,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14656,14659],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14656,14659],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Key Findings Component\n *\n * Displays the most important information extracted from metadata in plain English.\n * Enhanced with forensic analysis integration and visual indicators.\n */\n\nimport React from 'react';\nimport {\n  Clock,\n  MapPin,\n  Camera,\n  Shield,\n  Info,\n  Fingerprint,\n  AlertTriangle,\n  Verified,\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { KeyFindings as KeyFindingsType } from '@/utils/metadataTransformers';\nimport {\n  AuthenticityBadge,\n  ForensicConfidenceIndicator,\n} from './AuthenticityBadge';\n\nexport interface KeyFindingsProps {\n  findings: KeyFindingsType;\n  forensicScore?: number;\n  forensicAnalysis?: {\n    steganography?: { detected: boolean; confidence: number };\n    manipulation?: { detected: boolean; confidence: number };\n    aiDetection?: { aiGenerated: boolean; confidence: number };\n  };\n  className?: string;\n  showForensicIndicators?: boolean;\n  compact?: boolean;\n}\n\ninterface FindingCardProps {\n  icon: React.ReactNode;\n  label: string;\n  value: string;\n  confidence?: 'high' | 'medium' | 'low';\n  color?: 'blue' | 'green' | 'purple' | 'red' | 'yellow' | 'forensic';\n  forensicIndicator?: boolean;\n  riskLevel?: 'low' | 'medium' | 'high';\n}\n\ninterface ConfidenceBadgeProps {\n  confidence: 'high' | 'medium' | 'low';\n  forensic?: boolean;\n}\n\ninterface ConfidenceInfoProps {\n  confidence: 'high' | 'medium' | 'low';\n  forensic?: boolean;\n}\n\ninterface ForensicSummaryProps {\n  score?: number;\n  analysis?: {\n    steganography?: { detected: boolean; confidence: number };\n    manipulation?: { detected: boolean; confidence: number };\n    aiDetection?: { aiGenerated: boolean; confidence: number };\n  };\n  compact?: boolean;\n}\n\n/**\n * Forensic Summary Component\n * Displays forensic analysis results in a compact format\n */\nconst ForensicSummary: React.FC<ForensicSummaryProps> = ({\n  score = 0,\n  analysis,\n  compact = false,\n}) => {\n  if (!analysis) return null;\n\n  const { steganography, manipulation, aiDetection } = analysis;\n  const hasForensicData = !!(steganography || manipulation || aiDetection);\n\n  if (!hasForensicData) return null;\n\n  const getRiskColor = () => {\n    const risks = [\n      steganography?.detected,\n      manipulation?.detected,\n      aiDetection?.aiGenerated,\n    ].filter(Boolean).length;\n\n    if (risks === 0) return 'text-emerald-500';\n    if (risks === 1) return 'text-yellow-500';\n    return 'text-red-500';\n  };\n\n  if (compact) {\n    return (\n      <div className=\"flex items-center gap-2\">\n        <Fingerprint className={cn('w-3 h-3', getRiskColor())} />\n        <span className=\"text-xs text-gray-600 dark:text-gray-400\">\n          Forensic: {score}%\n        </span>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-4 rounded-lg bg-gradient-to-r from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 border border-slate-200 dark:border-slate-700\">\n      <div className=\"flex items-center justify-between mb-3\">\n        <div className=\"flex items-center gap-2\">\n          <Fingerprint className={cn('w-4 h-4', getRiskColor())} />\n          <h4 className=\"font-medium text-gray-900 dark:text-white\">\n            Forensic Analysis\n          </h4>\n        </div>\n        <AuthenticityBadge score={score} variant=\"compact\" />\n      </div>\n\n      <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-3\">\n        {steganography && (\n          <div className=\"flex items-center justify-between p-2 bg-white dark:bg-slate-800 rounded border border-slate-200 dark:border-slate-700\">\n            <span className=\"text-xs text-gray-600 dark:text-gray-400\">\n              Steganography\n            </span>\n            <ForensicConfidenceIndicator\n              confidence={steganography.confidence}\n              type=\"manipulation\"\n              size=\"sm\"\n              showLabel={false}\n            />\n          </div>\n        )}\n\n        {manipulation && (\n          <div className=\"flex items-center justify-between p-2 bg-white dark:bg-slate-800 rounded border border-slate-200 dark:border-slate-700\">\n            <span className=\"text-xs text-gray-600 dark:text-gray-400\">\n              Manipulation\n            </span>\n            <ForensicConfidenceIndicator\n              confidence={manipulation.confidence}\n              type=\"manipulation\"\n              size=\"sm\"\n              showLabel={false}\n            />\n          </div>\n        )}\n\n        {aiDetection && (\n          <div className=\"flex items-center justify-between p-2 bg-white dark:bg-slate-800 rounded border border-slate-200 dark:border-slate-700\">\n            <span className=\"text-xs text-gray-600 dark:text-gray-400\">\n              AI Detection\n            </span>\n            <ForensicConfidenceIndicator\n              confidence={aiDetection.confidence}\n              type=\"ai-detection\"\n              size=\"sm\"\n              showLabel={false}\n            />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\n/**\n * Enhanced Finding Card with forensic indicators\n */\nfunction FindingCard({\n  icon,\n  label,\n  value,\n  confidence,\n  color = 'blue',\n  forensicIndicator = false,\n  riskLevel = 'low',\n}: FindingCardProps): React.ReactElement {\n  const getForensicColor = () => {\n    if (forensicIndicator) {\n      switch (riskLevel) {\n        case 'high':\n          return 'bg-red-50 dark:bg-red-950';\n        case 'medium':\n          return 'bg-yellow-50 dark:bg-yellow-950';\n        case 'low':\n          return 'bg-emerald-50 dark:bg-emerald-950';\n        default:\n          return 'bg-slate-50 dark:bg-slate-950';\n      }\n    }\n    return color === 'blue'\n      ? 'bg-blue-50 dark:bg-blue-950'\n      : color === 'green'\n        ? 'bg-green-50 dark:bg-green-950'\n        : color === 'purple'\n          ? 'bg-purple-50 dark:bg-purple-950'\n          : color === 'red'\n            ? 'bg-red-50 dark:bg-red-950'\n            : color === 'yellow'\n              ? 'bg-yellow-50 dark:bg-yellow-950'\n              : 'bg-slate-50 dark:bg-slate-950';\n  };\n\n  const getBorderColor = () => {\n    if (forensicIndicator) {\n      switch (riskLevel) {\n        case 'high':\n          return 'border-red-200 dark:border-red-800';\n        case 'medium':\n          return 'border-yellow-200 dark:border-yellow-800';\n        case 'low':\n          return 'border-emerald-200 dark:border-emerald-800';\n        default:\n          return 'border-slate-200 dark:border-slate-800';\n      }\n    }\n    return color === 'blue'\n      ? 'border-blue-200 dark:border-blue-800'\n      : color === 'green'\n        ? 'border-green-200 dark:border-green-800'\n        : color === 'purple'\n          ? 'border-purple-200 dark:border-purple-800'\n          : color === 'red'\n            ? 'border-red-200 dark:border-red-800'\n            : color === 'yellow'\n              ? 'border-yellow-200 dark:border-yellow-800'\n              : 'border-slate-200 dark:border-slate-800';\n  };\n\n  const getIconColor = () => {\n    if (forensicIndicator) {\n      switch (riskLevel) {\n        case 'high':\n          return 'text-red-600 dark:text-red-400';\n        case 'medium':\n          return 'text-yellow-600 dark:text-yellow-400';\n        case 'low':\n          return 'text-emerald-600 dark:text-emerald-400';\n        default:\n          return 'text-slate-600 dark:text-slate-400';\n      }\n    }\n    return color === 'blue'\n      ? 'text-blue-600 dark:text-blue-400'\n      : color === 'green'\n        ? 'text-green-600 dark:text-green-400'\n        : color === 'purple'\n          ? 'text-purple-600 dark:text-purple-400'\n          : color === 'red'\n            ? 'text-red-600 dark:text-red-400'\n            : color === 'yellow'\n              ? 'text-yellow-600 dark:text-yellow-400'\n              : 'text-slate-600 dark:text-slate-400';\n  };\n\n  return (\n    <div\n      className={cn(\n        'p-4 rounded-lg border',\n        getForensicColor(),\n        getBorderColor()\n      )}\n    >\n      <div className=\"flex items-start gap-3\">\n        <div className={cn('mt-1', getIconColor())}>{icon}</div>\n        <div className=\"flex-1\">\n          <p className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">\n            {label}\n          </p>\n          <p\n            className={cn(\n              'font-semibold text-gray-900 dark:text-white mt-1',\n              forensicIndicator && 'flex items-center gap-2'\n            )}\n          >\n            {value}\n            {forensicIndicator && riskLevel === 'high' && (\n              <AlertTriangle className=\"w-4 h-4 text-red-500\" />\n            )}\n            {forensicIndicator && riskLevel === 'low' && (\n              <Verified className=\"w-4 h-4 text-emerald-500\" />\n            )}\n          </p>\n        </div>\n        {confidence && (\n          <ConfidenceBadge\n            confidence={confidence}\n            forensic={forensicIndicator}\n          />\n        )}\n      </div>\n    </div>\n  );\n}\n\n/**\n * Enhanced Confidence Badge with forensic styling\n */\nfunction ConfidenceBadge({\n  confidence,\n  forensic = false,\n}: ConfidenceBadgeProps): React.ReactElement {\n  if (forensic) {\n    const config = {\n      high: {\n        bg: 'bg-emerald-100 dark:bg-emerald-900',\n        text: 'text-emerald-800 dark:text-emerald-200',\n        label: 'Verified',\n      },\n      medium: {\n        bg: 'bg-yellow-100 dark:bg-yellow-900',\n        text: 'text-yellow-800 dark:text-yellow-200',\n        label: 'Caution',\n      },\n      low: {\n        bg: 'bg-red-100 dark:bg-red-900',\n        text: 'text-red-800 dark:text-red-200',\n        label: 'Review',\n      },\n    };\n\n    const { bg, text, label } = config[confidence];\n\n    return (\n      <div\n        className={cn(\n          'px-2 py-1 rounded text-xs font-medium flex items-center gap-1',\n          bg,\n          text\n        )}\n      >\n        <Fingerprint className=\"w-3 h-3\" />\n        {label}\n      </div>\n    );\n  }\n\n  const config = {\n    high: {\n      bg: 'bg-green-100 dark:bg-green-900',\n      text: 'text-green-800 dark:text-green-200',\n      label: 'High',\n    },\n    medium: {\n      bg: 'bg-yellow-100 dark:bg-yellow-900',\n      text: 'text-yellow-800 dark:text-yellow-200',\n      label: 'Medium',\n    },\n    low: {\n      bg: 'bg-red-100 dark:bg-red-900',\n      text: 'text-red-800 dark:text-red-200',\n      label: 'Low',\n    },\n  };\n\n  const { bg, text, label } = config[confidence];\n\n  return (\n    <div className={cn('px-2 py-1 rounded text-xs font-medium', bg, text)}>\n      {label}\n    </div>\n  );\n}\n\n/**\n * Enhanced Confidence Info with forensic context\n */\nfunction ConfidenceInfo({\n  confidence,\n  forensic = false,\n}: ConfidenceInfoProps): React.ReactElement {\n  if (forensic) {\n    const messages = {\n      high: 'High forensic confidence - extensive analysis completed with consistent results',\n      medium: 'Medium forensic confidence - some limitations in analysis scope',\n      low: 'Low forensic confidence - limited data available for comprehensive analysis',\n    };\n\n    return (\n      <div className=\"flex items-start gap-2 p-3 rounded-lg bg-gradient-to-r from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 border border-slate-200 dark:border-slate-700\">\n        <Fingerprint className=\"w-4 h-4 text-slate-500 dark:text-slate-400 mt-0.5 flex-shrink-0\" />\n        <p className=\"text-sm text-slate-600 dark:text-slate-400\">\n          {messages[confidence]}\n        </p>\n      </div>\n    );\n  }\n\n  const messages = {\n    high: 'High confidence based on extensive metadata',\n    medium: 'Medium confidence - some metadata may be limited',\n    low: 'Low confidence - limited metadata available',\n  };\n\n  return (\n    <div className=\"flex items-start gap-2 p-3 rounded-lg bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-800\">\n      <Info className=\"w-4 h-4 text-gray-500 dark:text-gray-400 mt-0.5 flex-shrink-0\" />\n      <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n        {messages[confidence]}\n      </p>\n    </div>\n  );\n}\n\n/**\n * Enhanced KeyFindings Component with forensic integration\n */\nexport function KeyFindings({\n  findings,\n  forensicScore,\n  forensicAnalysis,\n  className,\n  showForensicIndicators = true,\n  compact = false,\n}: KeyFindingsProps): React.ReactElement {\n  const getAuthenticityColor = (\n    confidence: 'high' | 'medium' | 'low'\n  ): 'green' | 'yellow' | 'red' | 'forensic' => {\n    if (showForensicIndicators && forensicScore !== undefined) {\n      return 'forensic';\n    }\n    switch (confidence) {\n      case 'high':\n        return 'green';\n      case 'medium':\n        return 'yellow';\n      case 'low':\n        return 'red';\n    }\n  };\n\n  const getAuthenticityRisk = (\n    confidence: 'high' | 'medium' | 'low'\n  ): 'low' | 'medium' | 'high' => {\n    if (forensicScore !== undefined) {\n      if (forensicScore >= 80) return 'low';\n      if (forensicScore >= 60) return 'medium';\n      return 'high';\n    }\n    return confidence;\n  };\n\n  return (\n    <div className={cn('space-y-4', className)}>\n      {findings.when && (\n        <FindingCard\n          icon={<Clock className=\"w-5 h-5\" />}\n          label=\"When\"\n          value={findings.when}\n          color=\"blue\"\n        />\n      )}\n\n      {findings.where && (\n        <FindingCard\n          icon={<MapPin className=\"w-5 h-5\" />}\n          label=\"Where\"\n          value={findings.where}\n          color=\"green\"\n        />\n      )}\n\n      {findings.device && (\n        <FindingCard\n          icon={<Camera className=\"w-5 h-5\" />}\n          label=\"Device\"\n          value={findings.device}\n          color=\"purple\"\n        />\n      )}\n\n      <FindingCard\n        icon={<Shield className=\"w-5 h-5\" />}\n        label=\"Authenticity\"\n        value={findings.authenticity}\n        confidence={findings.confidence}\n        color={getAuthenticityColor(findings.confidence)}\n        forensicIndicator={showForensicIndicators}\n        riskLevel={getAuthenticityRisk(findings.confidence)}\n      />\n\n      {showForensicIndicators && forensicAnalysis && (\n        <ForensicSummary\n          score={forensicScore}\n          analysis={forensicAnalysis}\n          compact={compact}\n        />\n      )}\n\n      <ConfidenceInfo\n        confidence={findings.confidence}\n        forensic={showForensicIndicators}\n      />\n    </div>\n  );\n}\n\n/**\n * Compact KeyFindings for space-constrained layouts\n */\nexport function KeyFindingsCompact({\n  findings,\n  forensicScore,\n  forensicAnalysis,\n  className,\n}: Omit<\n  KeyFindingsProps,\n  'expandable' | 'showForensicIndicators' | 'compact'\n>): React.ReactElement {\n  const items = [\n    findings.when && { icon: Clock, label: findings.when },\n    findings.where && { icon: MapPin, label: findings.where },\n    findings.device && { icon: Camera, label: findings.device },\n  ].filter(Boolean) as Array<{ icon: React.ComponentType<any>; label: string }>;\n\n  if (items.length === 0 && !forensicAnalysis) {\n    return <div className={className}>No key findings available</div>;\n  }\n\n  return (\n    <div className={cn('space-y-3', className)}>\n      <div className={cn('flex flex-wrap gap-4')}>\n        {items.map((item, idx) => {\n          const Icon = item.icon;\n          return (\n            <div key={idx} className=\"flex items-center gap-2\">\n              <Icon className=\"w-4 h-4 text-gray-500 dark:text-gray-400\" />\n              <span className=\"text-sm text-gray-700 dark:text-gray-300\">\n                {item.label}\n              </span>\n            </div>\n          );\n        })}\n      </div>\n\n      {forensicAnalysis && forensicScore !== undefined && (\n        <div className=\"flex items-center justify-between p-2 bg-slate-50 dark:bg-slate-900 rounded border border-slate-200 dark:border-slate-700\">\n          <div className=\"flex items-center gap-2\">\n            <Fingerprint className=\"w-4 h-4 text-slate-500\" />\n            <span className=\"text-xs text-slate-600 dark:text-slate-400\">\n              Forensic Score\n            </span>\n          </div>\n          <AuthenticityBadge score={forensicScore} variant=\"compact\" />\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/v2-results/LocationSection.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":80,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":80,"endColumn":22,"suggestions":[{"fix":{"range":[2109,2148],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'latitude' is defined but never used. Allowed unused args must match /^_/u.","line":315,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":315,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'longitude' is defined but never used. Allowed unused args must match /^_/u.","line":316,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":316,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Location Section Component\n *\n * Display GPS location information with map preview and reverse geocoding.\n * Transforms raw GPS data into meaningful location context.\n */\n\nimport React, { useEffect, useState } from 'react';\nimport { MapPin, Loader2, AlertCircle, ExternalLink } from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\nexport interface LocationData {\n  latitude: number;\n  longitude: number;\n}\n\nexport interface ReverseGeocodingResult {\n  success: boolean;\n  address?: string;\n  city?: string;\n  region?: string;\n  country?: string;\n  confidence?: 'high' | 'medium' | 'low';\n  coordinates?: string;\n  mapsUrl?: string;\n  osmUrl?: string;\n  cached?: boolean;\n  error?: string;\n}\n\ninterface LocationSectionProps {\n  location?: LocationData | null;\n  onLocationChange?: (result: ReverseGeocodingResult) => void;\n  className?: string;\n}\n\n/**\n * Main LocationSection component\n */\nexport function LocationSection({\n  location,\n  onLocationChange,\n  className\n}: LocationSectionProps): React.ReactElement {\n  const [geocoding, setGeocoding] = useState<ReverseGeocodingResult | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  // Perform reverse geocoding when location changes\n  useEffect(() => {\n    if (!location) {\n      setGeocoding(null);\n      return;\n    }\n\n    const performGeocoding = async () => {\n      setLoading(true);\n      setError(null);\n\n      try {\n        const response = await fetch('/api/geocode/reverse', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            latitude: location.latitude,\n            longitude: location.longitude\n          })\n        });\n\n        if (!response.ok) {\n          throw new Error('Geocoding failed');\n        }\n\n        const result = await response.json() as ReverseGeocodingResult;\n        setGeocoding(result);\n        onLocationChange?.(result);\n      } catch (err) {\n        const message = err instanceof Error ? err.message : 'Geocoding error';\n        setError(message);\n        console.error('Geocoding error:', err);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    performGeocoding();\n  }, [location, onLocationChange]);\n\n  if (!location) {\n    return (\n      <div className={cn('p-4 text-center text-gray-500', className)}>\n        No location data available\n      </div>\n    );\n  }\n\n  if (loading) {\n    return (\n      <div className={cn('space-y-4', className)}>\n        <div className=\"flex items-center justify-center p-6 rounded-lg bg-blue-50 dark:bg-blue-950\">\n          <Loader2 className=\"w-5 h-5 animate-spin text-blue-600 dark:text-blue-400 mr-2\" />\n          <span className=\"text-sm text-blue-700 dark:text-blue-300\">\n            Looking up location...\n          </span>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className={cn('space-y-4', className)}>\n        <div className=\"flex items-start gap-3 p-4 rounded-lg bg-red-50 dark:bg-red-950 border border-red-200 dark:border-red-800\">\n          <AlertCircle className=\"w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5\" />\n          <div>\n            <p className=\"text-sm font-medium text-red-700 dark:text-red-300\">\n              Location lookup failed\n            </p>\n            <p className=\"text-xs text-red-600 dark:text-red-400 mt-1\">\n              {error}\n            </p>\n          </div>\n        </div>\n\n        {/* Fall back to coordinates */}\n        <CoordinatesCard latitude={location.latitude} longitude={location.longitude} />\n      </div>\n    );\n  }\n\n  return (\n    <div className={cn('space-y-4', className)}>\n      {/* Main location card */}\n      {geocoding && (\n        <LocationCard\n          address={geocoding.address}\n          city={geocoding.city}\n          region={geocoding.region}\n          country={geocoding.country}\n          confidence={geocoding.confidence}\n          mapsUrl={geocoding.mapsUrl}\n          cached={geocoding.cached}\n        />\n      )}\n\n      {/* Coordinates fallback */}\n      <CoordinatesCard latitude={location.latitude} longitude={location.longitude} />\n\n      {/* Map links */}\n      <MapLinks\n        latitude={location.latitude}\n        longitude={location.longitude}\n        mapsUrl={geocoding?.mapsUrl}\n        osmUrl={geocoding?.osmUrl}\n      />\n    </div>\n  );\n}\n\n/**\n * Main location card display\n */\ninterface LocationCardProps {\n  address?: string;\n  city?: string;\n  region?: string;\n  country?: string;\n  confidence?: 'high' | 'medium' | 'low';\n  mapsUrl?: string;\n  cached?: boolean;\n}\n\nfunction LocationCard({\n  address,\n  city,\n  region,\n  country,\n  confidence = 'medium',\n  mapsUrl,\n  cached\n}: LocationCardProps): React.ReactElement {\n  const bgColor = {\n    high: 'bg-green-50 dark:bg-green-950',\n    medium: 'bg-blue-50 dark:bg-blue-950',\n    low: 'bg-yellow-50 dark:bg-yellow-950'\n  };\n\n  const borderColor = {\n    high: 'border-green-200 dark:border-green-800',\n    medium: 'border-blue-200 dark:border-blue-800',\n    low: 'border-yellow-200 dark:border-yellow-800'\n  };\n\n  const textColor = {\n    high: 'text-green-900 dark:text-green-100',\n    medium: 'text-blue-900 dark:text-blue-100',\n    low: 'text-yellow-900 dark:text-yellow-100'\n  };\n\n  return (\n    <div\n      className={cn(\n        'p-4 rounded-lg border',\n        bgColor[confidence],\n        borderColor[confidence]\n      )}\n    >\n      <div className=\"flex items-start gap-3\">\n        <MapPin className={cn('w-5 h-5 flex-shrink-0 mt-0.5', {\n          'text-green-600 dark:text-green-400': confidence === 'high',\n          'text-blue-600 dark:text-blue-400': confidence === 'medium',\n          'text-yellow-600 dark:text-yellow-400': confidence === 'low'\n        })} />\n\n        <div className=\"flex-1\">\n          <p className={cn('text-sm font-medium text-gray-600 dark:text-gray-400')}>\n            Location\n          </p>\n\n          {address && (\n            <p className={cn('text-base font-semibold mt-2', textColor[confidence])}>\n              {address}\n            </p>\n          )}\n\n          {/* Location hierarchy */}\n          {(city || region || country) && (\n            <div className={cn('text-xs mt-2 space-y-1', textColor[confidence])}>\n              {city && <p> City: {city}</p>}\n              {region && <p> Region: {region}</p>}\n              {country && <p> Country: {country}</p>}\n            </div>\n          )}\n\n          {/* Metadata */}\n          <div className=\"flex items-center gap-2 mt-3 text-xs\">\n            {cached && (\n              <span className=\"px-2 py-1 rounded bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300\">\n                Cached\n              </span>\n            )}\n            <span className=\"text-gray-500 dark:text-gray-400\">\n              {confidence === 'high' && ' High confidence'}\n              {confidence === 'medium' && ' Medium confidence'}\n              {confidence === 'low' && ' Low confidence'}\n            </span>\n          </div>\n        </div>\n\n        {mapsUrl && (\n          <a\n            href={mapsUrl}\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n            className={cn(\n              'p-2 rounded hover:bg-opacity-75 transition-colors',\n              {\n                'hover:bg-green-200 dark:hover:bg-green-800': confidence === 'high',\n                'hover:bg-blue-200 dark:hover:bg-blue-800': confidence === 'medium',\n                'hover:bg-yellow-200 dark:hover:bg-yellow-800': confidence === 'low'\n              }\n            )}\n            title=\"Open in Google Maps\"\n          >\n            <ExternalLink className=\"w-4 h-4\" />\n          </a>\n        )}\n      </div>\n    </div>\n  );\n}\n\n/**\n * Coordinates display card\n */\ninterface CoordinatesCardProps {\n  latitude: number;\n  longitude: number;\n}\n\nfunction CoordinatesCard({\n  latitude,\n  longitude\n}: CoordinatesCardProps): React.ReactElement {\n  const latDir = latitude >= 0 ? 'N' : 'S';\n  const lonDir = longitude >= 0 ? 'E' : 'W';\n  const formattedCoords = `${Math.abs(latitude).toFixed(4)} ${latDir}, ${Math.abs(longitude).toFixed(4)} ${lonDir}`;\n\n  return (\n    <div className=\"p-4 rounded-lg bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-800\">\n      <p className=\"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">\n        Exact Coordinates\n      </p>\n      <p className=\"text-sm font-mono text-gray-700 dark:text-gray-300 mt-2\">\n        {formattedCoords}\n      </p>\n      <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\n        Latitude: {latitude.toFixed(6)} | Longitude: {longitude.toFixed(6)}\n      </p>\n    </div>\n  );\n}\n\n/**\n * Map links section\n */\ninterface MapLinksProps {\n  latitude: number;\n  longitude: number;\n  mapsUrl?: string;\n  osmUrl?: string;\n}\n\nfunction MapLinks({\n  latitude,\n  longitude,\n  mapsUrl,\n  osmUrl\n}: MapLinksProps): React.ReactElement {\n  return (\n    <div className=\"flex gap-2\">\n      {mapsUrl && (\n        <a\n          href={mapsUrl}\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          className=\"flex-1 flex items-center justify-center gap-2 px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium transition-colors\"\n        >\n          <ExternalLink className=\"w-4 h-4\" />\n          Google Maps\n        </a>\n      )}\n\n      {osmUrl && (\n        <a\n          href={osmUrl}\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          className=\"flex-1 flex items-center justify-center gap-2 px-4 py-2 rounded-lg bg-purple-600 hover:bg-purple-700 text-white text-sm font-medium transition-colors\"\n        >\n          <ExternalLink className=\"w-4 h-4\" />\n          OpenStreetMap\n        </a>\n      )}\n    </div>\n  );\n}\n\n/**\n * Hook to perform reverse geocoding\n */\nexport function useReverseGeocode(location: LocationData | null | undefined) {\n  const [result, setResult] = useState<ReverseGeocodingResult | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (!location) {\n      setResult(null);\n      return;\n    }\n\n    const performGeocoding = async () => {\n      setLoading(true);\n      setError(null);\n\n      try {\n        const response = await fetch('/api/geocode/reverse', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            latitude: location.latitude,\n            longitude: location.longitude\n          })\n        });\n\n        if (!response.ok) {\n          throw new Error('Geocoding failed');\n        }\n\n        const data = await response.json() as ReverseGeocodingResult;\n        setResult(data);\n      } catch (err) {\n        const message = err instanceof Error ? err.message : 'Geocoding error';\n        setError(message);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    performGeocoding();\n  }, [location]);\n\n  return { result, loading, error };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/v2-results/ProgressiveDisclosure.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Shield' is defined but never used.","line":24,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertTriangle' is defined but never used.","line":25,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Progressive Disclosure Component\n *\n * Implements a three-tier information hierarchy:\n * 1. Hero section with key findings (always visible)\n * 2. Quick details card (easy to scan)\n * 3. Advanced metadata (collapsible sections)\n *\n * Enhanced with forensic analysis integration and visual indicators.\n * Reduces cognitive load while keeping all information accessible.\n */\n\nimport React, { useState } from 'react';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { cn } from '@/lib/utils';\nimport { KeyFindings, KeyFindingsCompact } from './KeyFindings';\nimport { QuickDetails, type QuickDetailsData } from './QuickDetails';\nimport { ExpandableSectionList } from './ExpandableSection';\nimport { LocationSection, type LocationData } from './LocationSection';\nimport { ForensicAnalysis } from './ForensicAnalysis';\nimport { AuthenticityBadge } from './AuthenticityBadge';\nimport {\n  Fingerprint,\n  Shield,\n  AlertTriangle,\n  Activity,\n  Brain,\n  Search,\n} from 'lucide-react';\nimport type { KeyFindings as KeyFindingsType } from '@/utils/metadataTransformers';\n\nexport interface ProgressiveDisclosureData {\n  keyFindings: KeyFindingsType;\n  quickDetails: QuickDetailsData;\n  location?: LocationData | null;\n  advancedMetadata?: Record<string, unknown>;\n  forensicAnalysis?: {\n    steganography?: {\n      detected: boolean;\n      confidence: number;\n      methodsChecked: string[];\n      findings: string[];\n      details?: string;\n    };\n    manipulation?: {\n      detected: boolean;\n      confidence: number;\n      indicators: Array<{\n        type: string;\n        severity: 'low' | 'medium' | 'high';\n        description: string;\n        confidence: number;\n      }>;\n      originalityScore?: number;\n    };\n    aiDetection?: {\n      aiGenerated: boolean;\n      confidence: number;\n      modelHints: string[];\n      detectionMethods: string[];\n    };\n    authenticityScore?: number;\n  };\n}\n\nexport interface ProgressiveDisclosureProps {\n  data: ProgressiveDisclosureData;\n  className?: string;\n  showForensicAnalysis?: boolean;\n  defaultTab?: 'overview' | 'location' | 'advanced' | 'forensic';\n}\n\ninterface AdvancedMetadataViewProps {\n  data?: Record<string, unknown>;\n  forensicData?: ProgressiveDisclosureData['forensicAnalysis'];\n}\n\n/**\n * Forensic Analysis Tab Content\n */\nfunction ForensicAnalysisTab({\n  forensicData,\n}: {\n  forensicData?: ProgressiveDisclosureData['forensicAnalysis'];\n}) {\n  if (!forensicData) {\n    return (\n      <div className=\"space-y-4\">\n        <div className=\"text-center p-8 bg-slate-50 dark:bg-slate-900 rounded-lg border border-slate-200 dark:border-slate-700\">\n          <Fingerprint className=\"w-12 h-12 mx-auto mb-4 text-slate-500\" />\n          <h3 className=\"text-lg font-semibold text-slate-900 dark:text-white mb-2\">\n            Forensic Analysis\n          </h3>\n          <p className=\"text-slate-600 dark:text-slate-400\">\n            No forensic analysis data available\n          </p>\n          <p className=\"text-xs text-slate-500 dark:text-slate-500 mt-2\">\n            Forensic analysis requires Advanced or Enterprise tier\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Forensic Analysis Header */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"space-y-1\">\n          <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\n            <Fingerprint className=\"w-5 h-5 text-primary\" />\n            Forensic Analysis Results\n          </h3>\n          <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n            Advanced authenticity and manipulation detection\n          </p>\n        </div>\n        {forensicData.authenticityScore !== undefined && (\n          <AuthenticityBadge\n            score={forensicData.authenticityScore}\n            variant=\"detailed\"\n            showConfidence={true}\n          />\n        )}\n      </div>\n\n      {/* Risk Assessment Overview */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        {forensicData.steganography && (\n          <div className=\"p-4 bg-blue-50 dark:bg-blue-950 rounded-lg border border-blue-200 dark:border-blue-800\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <Search className=\"w-4 h-4 text-blue-600 dark:text-blue-400\" />\n              <h4 className=\"font-medium text-blue-900 dark:text-blue-100\">\n                Steganography\n              </h4>\n            </div>\n            <div className=\"space-y-1\">\n              <p className=\"text-sm text-blue-800 dark:text-blue-200\">\n                {forensicData.steganography.detected\n                  ? 'Hidden data detected'\n                  : 'No hidden data found'}\n              </p>\n              <p className=\"text-xs text-blue-600 dark:text-blue-400\">\n                Confidence: {forensicData.steganography.confidence}%\n              </p>\n            </div>\n          </div>\n        )}\n\n        {forensicData.manipulation && (\n          <div className=\"p-4 bg-orange-50 dark:bg-orange-950 rounded-lg border border-orange-200 dark:border-orange-800\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <Activity className=\"w-4 h-4 text-orange-600 dark:text-orange-400\" />\n              <h4 className=\"font-medium text-orange-900 dark:text-orange-100\">\n                Manipulation\n              </h4>\n            </div>\n            <div className=\"space-y-1\">\n              <p className=\"text-sm text-orange-800 dark:text-orange-200\">\n                {forensicData.manipulation.detected\n                  ? 'Manipulation detected'\n                  : 'No manipulation found'}\n              </p>\n              <p className=\"text-xs text-orange-600 dark:text-orange-400\">\n                Confidence: {forensicData.manipulation.confidence}%\n              </p>\n            </div>\n          </div>\n        )}\n\n        {forensicData.aiDetection && (\n          <div className=\"p-4 bg-purple-50 dark:bg-purple-950 rounded-lg border border-purple-200 dark:border-purple-800\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <Brain className=\"w-4 h-4 text-purple-600 dark:text-purple-400\" />\n              <h4 className=\"font-medium text-purple-900 dark:text-purple-100\">\n                AI Detection\n              </h4>\n            </div>\n            <div className=\"space-y-1\">\n              <p className=\"text-sm text-purple-800 dark:text-purple-200\">\n                {forensicData.aiDetection.aiGenerated\n                  ? 'AI generated content'\n                  : 'Likely original content'}\n              </p>\n              <p className=\"text-xs text-purple-600 dark:text-purple-400\">\n                Confidence: {forensicData.aiDetection.confidence}%\n              </p>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Full Forensic Analysis Component */}\n      <ForensicAnalysis\n        steganography={forensicData.steganography}\n        manipulation={forensicData.manipulation}\n        aiDetection={forensicData.aiDetection}\n        authenticityScore={forensicData.authenticityScore}\n      />\n    </div>\n  );\n}\n\n/**\n * Advanced Metadata View with forensic integration\n */\nfunction AdvancedMetadataView({\n  data,\n  forensicData,\n}: AdvancedMetadataViewProps): React.ReactElement {\n  if (!data && !forensicData) {\n    return (\n      <div className=\"p-4 text-center text-gray-600 dark:text-gray-300 rounded-lg bg-gray-50 dark:bg-gray-900\">\n        No advanced metadata available\n      </div>\n    );\n  }\n\n  const sections = [];\n\n  // Add forensic analysis section if available\n  if (forensicData) {\n    sections.push({\n      title: 'Forensic Analysis',\n      content: <ForensicAnalysisTab forensicData={forensicData} />,\n      icon: <Fingerprint className=\"w-4 h-4\" />,\n    });\n  }\n\n  // Add regular metadata sections\n  if (data) {\n    // Filter out undefined/null entries\n    const entries = Object.entries(data).filter(\n      ([_, v]) => v !== undefined && v !== null\n    );\n\n    if (entries.length > 0) {\n      sections.push(\n        ...entries.map(([key, value]) => ({\n          title: formatCategoryName(key),\n          content: <MetadataDetails value={value} />,\n          icon: null,\n        }))\n      );\n    }\n  }\n\n  if (sections.length === 0) {\n    return (\n      <div className=\"p-4 text-center text-gray-600 dark:text-gray-300 rounded-lg bg-gray-50 dark:bg-gray-900\">\n        No advanced metadata available\n      </div>\n    );\n  }\n\n  return <ExpandableSectionList sections={sections} />;\n}\n\n/**\n * Metadata Details Component\n */\ninterface MetadataDetailsProps {\n  value: unknown;\n}\n\nfunction MetadataDetails({ value }: MetadataDetailsProps): React.ReactElement {\n  if (value === null || value === undefined) {\n    return <span className=\"text-gray-500 dark:text-gray-400\">N/A</span>;\n  }\n\n  if (typeof value === 'string' || typeof value === 'number') {\n    return <span className=\"text-gray-900 dark:text-white\">{value}</span>;\n  }\n\n  if (typeof value === 'boolean') {\n    return (\n      <span\n        className={\n          value\n            ? 'text-green-600 dark:text-green-400'\n            : 'text-red-600 dark:text-red-400'\n        }\n      >\n        {value ? 'Yes' : 'No'}\n      </span>\n    );\n  }\n\n  if (Array.isArray(value)) {\n    return (\n      <div className=\"space-y-1\">\n        {value.map((item, idx) => (\n          <div key={idx} className=\"text-sm text-gray-900 dark:text-white\">\n            {typeof item === 'object' ? JSON.stringify(item) : item}\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  if (typeof value === 'object') {\n    return (\n      <div className=\"space-y-2\">\n        {Object.entries(value).map(([k, v]) => (\n          <div key={k} className=\"flex justify-between text-sm\">\n            <span className=\"text-gray-700 dark:text-gray-300\">\n              {formatCategoryName(k)}\n            </span>\n            <span className=\"text-gray-900 dark:text-white font-medium\">\n              {typeof v === 'object' ? JSON.stringify(v) : String(v)}\n            </span>\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  return <span className=\"text-gray-900 dark:text-white\">{String(value)}</span>;\n}\n\n/**\n * Utility function to format category names\n */\nfunction formatCategoryName(name: string): string {\n  return name\n    .replace(/([A-Z])/g, ' $1')\n    .replace(/^./, str => str.toUpperCase())\n    .trim();\n}\n\n/**\n * Main ProgressiveDisclosure Component\n */\nexport function ProgressiveDisclosure({\n  data,\n  className,\n  showForensicAnalysis = true,\n  defaultTab = 'overview',\n}: ProgressiveDisclosureProps): React.ReactElement {\n  const [activeTab, setActiveTab] = useState(defaultTab);\n  const hasForensicData = !!(\n    data.forensicAnalysis?.steganography ||\n    data.forensicAnalysis?.manipulation ||\n    data.forensicAnalysis?.aiDetection\n  );\n\n  return (\n    <div className={cn('space-y-6', className)}>\n      {/* Hero Section - Always Visible */}\n      <section className=\"space-y-2\">\n        <div className=\"flex items-center justify-between\">\n          <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n            Key Findings\n          </h2>\n          {showForensicAnalysis &&\n            data.forensicAnalysis?.authenticityScore !== undefined && (\n              <AuthenticityBadge\n                score={data.forensicAnalysis.authenticityScore}\n                variant=\"compact\"\n              />\n            )}\n        </div>\n        <KeyFindings\n          findings={data.keyFindings}\n          forensicScore={data.forensicAnalysis?.authenticityScore}\n          forensicAnalysis={data.forensicAnalysis}\n          showForensicIndicators={showForensicAnalysis}\n        />\n      </section>\n\n      {/* Tabbed Interface for Progressive Disclosure */}\n      <Tabs\n        value={activeTab}\n        onValueChange={value => setActiveTab(value as typeof activeTab)}\n        className=\"w-full\"\n      >\n        <TabsList className=\"grid w-full grid-cols-3 md:grid-cols-4\">\n          <TabsTrigger value=\"overview\" className=\"text-xs md:text-sm\">\n            Overview\n          </TabsTrigger>\n          <TabsTrigger value=\"location\" className=\"text-xs md:text-sm\">\n            Location\n          </TabsTrigger>\n          {showForensicAnalysis && hasForensicData && (\n            <TabsTrigger value=\"forensic\" className=\"text-xs md:text-sm\">\n              <Fingerprint className=\"w-3 h-3 mr-1\" />\n              Forensic\n            </TabsTrigger>\n          )}\n          <TabsTrigger value=\"advanced\" className=\"text-xs md:text-sm\">\n            Advanced\n          </TabsTrigger>\n        </TabsList>\n\n        {/* Overview Tab - Quick Details */}\n        <TabsContent value=\"overview\" className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <p className=\"text-sm text-gray-700 dark:text-gray-300\">\n              Essential metadata at a glance\n            </p>\n            <QuickDetails data={data.quickDetails} />\n          </div>\n        </TabsContent>\n\n        {/* Location Tab */}\n        <TabsContent value=\"location\" className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <p className=\"text-sm text-gray-700 dark:text-gray-300\">\n              GPS location information\n            </p>\n            {data.location ? (\n              <LocationSection location={data.location} />\n            ) : (\n              <div className=\"p-4 text-center text-gray-600 dark:text-gray-300 rounded-lg bg-gray-50 dark:bg-gray-900\">\n                No location data available\n              </div>\n            )}\n          </div>\n        </TabsContent>\n\n        {/* Forensic Tab */}\n        {showForensicAnalysis && hasForensicData && (\n          <TabsContent value=\"forensic\" className=\"space-y-4\">\n            <ForensicAnalysisTab forensicData={data.forensicAnalysis} />\n          </TabsContent>\n        )}\n\n        {/* Advanced Tab - Collapsible Sections */}\n        <TabsContent value=\"advanced\" className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <p className=\"text-sm text-gray-700 dark:text-gray-300\">\n              Detailed metadata organized by category\n            </p>\n            <AdvancedMetadataView\n              data={data.advancedMetadata}\n              forensicData={data.forensicAnalysis}\n            />\n          </div>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n\n/**\n * Mobile-optimized variant with collapsible sections\n */\nexport function ProgressiveDisclosureMobile({\n  data,\n  className,\n  showForensicAnalysis = true,\n}: ProgressiveDisclosureProps): React.ReactElement {\n  const hasForensicData = !!(\n    data.forensicAnalysis?.steganography ||\n    data.forensicAnalysis?.manipulation ||\n    data.forensicAnalysis?.aiDetection\n  );\n\n  return (\n    <div className={cn('space-y-4', className)}>\n      {/* Compact Key Findings for mobile */}\n      <section className=\"space-y-2\">\n        <div className=\"flex items-center justify-between\">\n          <h2 className=\"text-base font-semibold text-gray-900 dark:text-white\">\n            Key Info\n          </h2>\n          {showForensicAnalysis &&\n            data.forensicAnalysis?.authenticityScore !== undefined && (\n              <AuthenticityBadge\n                score={data.forensicAnalysis.authenticityScore}\n                variant=\"compact\"\n              />\n            )}\n        </div>\n        <KeyFindingsCompact\n          findings={data.keyFindings}\n          forensicScore={data.forensicAnalysis?.authenticityScore}\n          forensicAnalysis={data.forensicAnalysis}\n        />\n      </section>\n\n      {/* Expandable sections for mobile */}\n      <ExpandableSectionList\n        sections={[\n          {\n            title: 'Details',\n            content: <QuickDetails data={data.quickDetails} />,\n            icon: null,\n          },\n          ...(data.location\n            ? [\n                {\n                  title: 'Location',\n                  content: <LocationSection location={data.location} />,\n                  icon: null,\n                },\n              ]\n            : []),\n          ...(showForensicAnalysis && hasForensicData\n            ? [\n                {\n                  title: 'Forensic Analysis',\n                  content: (\n                    <ForensicAnalysisTab forensicData={data.forensicAnalysis} />\n                  ),\n                  icon: <Fingerprint className=\"w-4 h-4\" />,\n                },\n              ]\n            : []),\n          ...(data.advancedMetadata &&\n          Object.keys(data.advancedMetadata).length > 0\n            ? [\n                {\n                  title: 'Advanced Metadata',\n                  content: (\n                    <AdvancedMetadataView\n                      data={data.advancedMetadata}\n                      forensicData={data.forensicAnalysis}\n                    />\n                  ),\n                  icon: null,\n                },\n              ]\n            : []),\n        ]}\n      />\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/v2-results/QuickDetails.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/v2-results/ScientificGraphs.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Thermometer' is defined but never used.","line":9,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Tooltip' is defined but never used.","line":19,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":10}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { \n  BarChart3, \n  Activity, \n  Eye, \n  Database,\n  TrendingUp,\n  Thermometer,\n  Gauge\n} from 'lucide-react';\nimport { ChartContainer, ChartTooltip, ChartTooltipContent } from '@/components/ui/chart';\nimport { \n  BarChart, \n  Bar, \n  XAxis, \n  YAxis, \n  CartesianGrid, \n  Tooltip, \n  Legend, \n  ResponsiveContainer,\n  LineChart,\n  Line,\n  AreaChart,\n  Area\n} from 'recharts';\n\ninterface ScientificDataPoint {\n  name: string;\n  value: number;\n  unit?: string;\n  confidence?: number;\n}\n\ninterface ScientificGraphsProps {\n  data: ScientificDataPoint[];\n  title?: string;\n  chartType?: 'bar' | 'line' | 'area';\n  yAxisLabel?: string;\n}\n\nexport const ScientificGraphs: React.FC<ScientificGraphsProps> = ({ \n  data, \n  title = 'Scientific Data Visualization',\n  chartType = 'bar',\n  yAxisLabel = 'Value'\n}) => {\n  const renderChart = () => {\n    const chartProps = {\n      data,\n      margin: { top: 5, right: 30, left: 20, bottom: 5 }\n    };\n\n    switch (chartType) {\n      case 'line':\n        return (\n          <LineChart {...chartProps}>\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#374151\" />\n            <XAxis dataKey=\"name\" stroke=\"#9CA3AF\" />\n            <YAxis stroke=\"#9CA3AF\" label={{ value: yAxisLabel, angle: -90, position: 'insideLeft' }} />\n            <ChartTooltip content={<ChartTooltipContent />} />\n            <Legend />\n            <Line \n              type=\"monotone\" \n              dataKey=\"value\" \n              stroke=\"#3b82f6\" \n              activeDot={{ r: 8 }} \n              name={yAxisLabel}\n            />\n          </LineChart>\n        );\n      \n      case 'area':\n        return (\n          <AreaChart {...chartProps}>\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#374151\" />\n            <XAxis dataKey=\"name\" stroke=\"#9CA3AF\" />\n            <YAxis stroke=\"#9CA3AF\" label={{ value: yAxisLabel, angle: -90, position: 'insideLeft' }} />\n            <ChartTooltip content={<ChartTooltipContent />} />\n            <Legend />\n            <Area \n              type=\"monotone\" \n              dataKey=\"value\" \n              stroke=\"#8b5cf6\" \n              fill=\"#8b5cf6\" \n              fillOpacity={0.3} \n              name={yAxisLabel}\n            />\n          </AreaChart>\n        );\n      \n      case 'bar':\n      default:\n        return (\n          <BarChart {...chartProps}>\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#374151\" />\n            <XAxis dataKey=\"name\" stroke=\"#9CA3AF\" />\n            <YAxis stroke=\"#9CA3AF\" label={{ value: yAxisLabel, angle: -90, position: 'insideLeft' }} />\n            <ChartTooltip content={<ChartTooltipContent />} />\n            <Legend />\n            <Bar \n              dataKey=\"value\" \n              fill=\"#3b82f6\" \n              name={yAxisLabel}\n            />\n          </BarChart>\n        );\n    }\n  };\n\n  // Calculate statistics\n  const values = data.map(d => d.value);\n  const average = values.reduce((sum, val) => sum + val, 0) / values.length;\n  const max = Math.max(...values);\n  const min = Math.min(...values);\n  const total = values.reduce((sum, val) => sum + val, 0);\n\n  return (\n    <div className=\"space-y-6\">\n      <Card className=\"bg-card border-white/10\">\n        <CardHeader>\n          <CardTitle className=\"text-white flex items-center gap-2\">\n            <BarChart3 className=\"w-5 h-5 text-primary\" />\n            {title}\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <ChartContainer config={{}} className=\"h-80\">\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\n              {renderChart()}\n            </ResponsiveContainer>\n          </ChartContainer>\n        </CardContent>\n      </Card>\n\n      {/* Statistics Summary */}\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n        <Card className=\"bg-card border-white/10\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-primary/10 rounded-lg\">\n                <Gauge className=\"w-5 h-5 text-primary\" />\n              </div>\n              <div>\n                <p className=\"text-xs text-slate-300\">Average</p>\n                <p className=\"text-lg font-bold text-white\">{average.toFixed(2)}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"bg-card border-white/10\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-emerald-500/10 rounded-lg\">\n                <TrendingUp className=\"w-5 h-5 text-emerald-500\" />\n              </div>\n              <div>\n                <p className=\"text-xs text-slate-300\">Maximum</p>\n                <p className=\"text-lg font-bold text-white\">{max}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"bg-card border-white/10\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-blue-500/10 rounded-lg\">\n                <Activity className=\"w-5 h-5 text-blue-500\" />\n              </div>\n              <div>\n                <p className=\"text-xs text-slate-300\">Minimum</p>\n                <p className=\"text-lg font-bold text-white\">{min}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"bg-card border-white/10\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-purple-500/10 rounded-lg\">\n                <Database className=\"w-5 h-5 text-purple-500\" />\n              </div>\n              <div>\n                <p className=\"text-xs text-slate-300\">Total</p>\n                <p className=\"text-lg font-bold text-white\">{total}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Data Table */}\n      <Card className=\"bg-card border-white/10\">\n        <CardHeader>\n          <CardTitle className=\"text-white flex items-center gap-2\">\n            <Database className=\"w-5 h-5 text-primary\" />\n            Raw Data\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full\">\n              <thead>\n                <tr className=\"border-b border-white/10\">\n                  <th className=\"text-left py-3 px-4 text-slate-300 font-medium\">Name</th>\n                  <th className=\"text-left py-3 px-4 text-slate-300 font-medium\">Value</th>\n                  <th className=\"text-left py-3 px-4 text-slate-300 font-medium\">Unit</th>\n                  <th className=\"text-left py-3 px-4 text-slate-300 font-medium\">Confidence</th>\n                </tr>\n              </thead>\n              <tbody>\n                {data.map((item, idx) => (\n                  <tr key={idx} className={idx % 2 === 0 ? 'bg-muted/10' : ''}>\n                    <td className=\"py-3 px-4 text-white\">{item.name}</td>\n                    <td className=\"py-3 px-4 text-white font-medium\">{item.value}</td>\n                    <td className=\"py-3 px-4 text-slate-300\">{item.unit || 'N/A'}</td>\n                    <td className=\"py-3 px-4\">\n                      {item.confidence !== undefined ? (\n                        <div className=\"flex items-center gap-2\">\n                          <div className=\"w-16 bg-muted rounded-full h-2\">\n                            <div \n                              className=\"bg-primary h-2 rounded-full\" \n                              style={{ width: `${item.confidence}%` }}\n                            ></div>\n                          </div>\n                          <span className=\"text-xs text-slate-300\">{item.confidence}%</span>\n                        </div>\n                      ) : (\n                        <span className=\"text-slate-300\">N/A</span>\n                      )}\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Data Quality Assessment */}\n      <Card className=\"bg-card border-white/10\">\n        <CardHeader>\n          <CardTitle className=\"text-white flex items-center gap-2\">\n            <Eye className=\"w-5 h-5 text-primary\" />\n            Data Quality Assessment\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div className=\"space-y-3\">\n              <div className=\"flex justify-between\">\n                <span className=\"text-slate-300\">Data Completeness</span>\n                <span className=\"text-white font-medium\">\n                  {data.filter(d => d.value !== undefined).length}/{data.length} values\n                </span>\n              </div>\n              <div className=\"w-full bg-muted rounded-full h-2\">\n                <div \n                  className=\"bg-emerald-500 h-2 rounded-full\" \n                  style={{ \n                    width: `${(data.filter(d => d.value !== undefined).length / data.length) * 100}%` \n                  }}\n                ></div>\n              </div>\n            </div>\n            \n            <div className=\"space-y-3\">\n              <div className=\"flex justify-between\">\n                <span className=\"text-slate-300\">Average Confidence</span>\n                <span className=\"text-white font-medium\">\n                  {data.length > 0 \n                    ? Math.round(data.reduce((sum, d) => sum + (d.confidence || 0), 0) / data.length) + '%' \n                    : '0%'}\n                </span>\n              </div>\n              <div className=\"w-full bg-muted rounded-full h-2\">\n                <div \n                  className=\"bg-blue-500 h-2 rounded-full\" \n                  style={{ \n                    width: data.length > 0 \n                      ? `${Math.round(data.reduce((sum, d) => sum + (d.confidence || 0), 0) / data.length)}%` \n                      : '0%' \n                  }}\n                ></div>\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"mt-4 pt-4 border-t border-white/10\">\n            <h4 className=\"text-sm font-semibold text-white mb-2\">Quality Indicators</h4>\n            <div className=\"flex flex-wrap gap-2\">\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-3 h-3 rounded-full bg-emerald-500\"></div>\n                <span className=\"text-xs text-slate-300\">High Completeness</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-3 h-3 rounded-full bg-blue-500\"></div>\n                <span className=\"text-xs text-slate-300\">Good Confidence</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-3 h-3 rounded-full bg-purple-500\"></div>\n                <span className=\"text-xs text-slate-300\">Valid Format</span>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/v2-results/Timeline.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used. Allowed unused args must match /^_/u.","line":158,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":158,"endColumn":49}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { \n  Calendar, \n  Clock, \n  MapPin, \n  Camera, \n  FileText, \n  Database, \n  Eye, \n  Download,\n  Filter,\n  Search\n} from 'lucide-react';\n\ninterface TimelineEvent {\n  id: string;\n  timestamp: string;\n  eventType: string;\n  description: string;\n  location?: string;\n  confidence?: number;\n  source: string;\n  tags?: string[];\n}\n\ninterface TimelineProps {\n  events: TimelineEvent[];\n  title?: string;\n}\n\nexport const Timeline: React.FC<TimelineProps> = ({ \n  events, \n  title = 'Event Timeline' \n}) => {\n  const [filter, setFilter] = useState<string>('all');\n  const [searchTerm, setSearchTerm] = useState<string>('');\n  const [sortBy, setSortBy] = useState<'time' | 'confidence'>('time');\n  \n  // Filter and sort events\n  const filteredEvents = events\n    .filter(event => {\n      const matchesFilter = filter === 'all' || event.eventType.toLowerCase().includes(filter.toLowerCase());\n      const matchesSearch = searchTerm === '' || \n        event.description.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        event.source.toLowerCase().includes(searchTerm.toLowerCase());\n      return matchesFilter && matchesSearch;\n    })\n    .sort((a, b) => {\n      if (sortBy === 'time') {\n        return new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime();\n      } else {\n        return (b.confidence || 0) - (a.confidence || 0);\n      }\n    });\n  \n  // Get unique event types for filter\n  const eventTypes = Array.from(new Set(events.map(event => event.eventType)));\n  \n  const getEventTypeIcon = (type: string) => {\n    switch (type.toLowerCase()) {\n      case 'capture':\n      case 'photo':\n      case 'image':\n        return <Camera className=\"w-4 h-4 text-blue-500\" />;\n      case 'location':\n      case 'gps':\n        return <MapPin className=\"w-4 h-4 text-green-500\" />;\n      case 'file':\n      case 'creation':\n        return <FileText className=\"w-4 h-4 text-purple-500\" />;\n      case 'extraction':\n      case 'analysis':\n        return <Database className=\"w-4 h-4 text-yellow-500\" />;\n      default:\n        return <Clock className=\"w-4 h-4 text-slate-500\" />;\n    }\n  };\n  \n  const getConfidenceColor = (confidence?: number) => {\n    if (confidence === undefined) return 'text-slate-300';\n    if (confidence >= 80) return 'text-emerald-400';\n    if (confidence >= 60) return 'text-yellow-400';\n    return 'text-red-400';\n  };\n  \n  const getConfidenceLabel = (confidence?: number) => {\n    if (confidence === undefined) return 'Unknown';\n    if (confidence >= 80) return 'High';\n    if (confidence >= 60) return 'Medium';\n    return 'Low';\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <Card className=\"bg-card border-white/10\">\n        <CardHeader>\n          <CardTitle className=\"text-white flex items-center gap-2\">\n            <Calendar className=\"w-5 h-5 text-primary\" />\n            {title}\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {/* Filters and Controls */}\n          <div className=\"flex flex-wrap gap-4 mb-6\">\n            <div className=\"flex items-center gap-2\">\n              <Search className=\"w-4 h-4 text-slate-300\" />\n              <input\n                type=\"text\"\n                placeholder=\"Search events...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"px-3 py-1 bg-muted border border-white/10 rounded text-white text-sm focus:outline-none focus:ring-1 focus:ring-primary\"\n              />\n            </div>\n            \n            <div className=\"flex items-center gap-2\">\n              <Filter className=\"w-4 h-4 text-slate-300\" />\n              <select\n                value={filter}\n                onChange={(e) => setFilter(e.target.value)}\n                className=\"px-3 py-1 bg-muted border border-white/10 rounded text-white text-sm focus:outline-none focus:ring-1 focus:ring-primary\"\n              >\n                <option value=\"all\">All Types</option>\n                {eventTypes.map(type => (\n                  <option key={type} value={type}>{type}</option>\n                ))}\n              </select>\n            </div>\n            \n            <div className=\"flex items-center gap-2\">\n              <Clock className=\"w-4 h-4 text-slate-300\" />\n              <select\n                value={sortBy}\n                onChange={(e) => setSortBy(e.target.value as 'time' | 'confidence')}\n                className=\"px-3 py-1 bg-muted border border-white/10 rounded text-white text-sm focus:outline-none focus:ring-1 focus:ring-primary\"\n              >\n                <option value=\"time\">Sort by Time</option>\n                <option value=\"confidence\">Sort by Confidence</option>\n              </select>\n            </div>\n            \n            <Button variant=\"outline\" size=\"sm\" className=\"ml-auto gap-2\">\n              <Download className=\"w-4 h-4\" />\n              Export Timeline\n            </Button>\n          </div>\n          \n          {/* Timeline */}\n          <div className=\"relative\">\n            {/* Timeline line */}\n            <div className=\"absolute left-4 top-0 bottom-0 w-0.5 bg-gradient-to-b from-primary to-transparent\"></div>\n            \n            <div className=\"space-y-6 pl-10\">\n              {filteredEvents.length > 0 ? (\n                filteredEvents.map((event, index) => (\n                  <div key={event.id} className=\"relative\">\n                    {/* Timeline dot */}\n                    <div className=\"absolute left-[-22px] top-3 w-4 h-4 rounded-full bg-primary border-4 border-card z-10\"></div>\n                    \n                    <Card className=\"bg-muted/20 border-white/10 hover:bg-muted/30 transition-colors\">\n                      <CardContent className=\"p-4\">\n                        <div className=\"flex items-start justify-between\">\n                          <div className=\"flex-1\">\n                            <div className=\"flex items-center gap-2 mb-2\">\n                              {getEventTypeIcon(event.eventType)}\n                              <h3 className=\"font-semibold text-white capitalize\">{event.eventType}</h3>\n                              {event.confidence !== undefined && (\n                                <Badge \n                                  variant=\"outline\" \n                                  className={`${getConfidenceColor(event.confidence)} border-current`}\n                                >\n                                  {getConfidenceLabel(event.confidence)} ({event.confidence}%)\n                                </Badge>\n                              )}\n                            </div>\n                            \n                            <p className=\"text-slate-200 mb-2\">{event.description}</p>\n                            \n                            <div className=\"flex flex-wrap gap-4 text-sm\">\n                              <div className=\"flex items-center gap-1\">\n                                <Clock className=\"w-4 h-4 text-slate-300\" />\n                                <span className=\"text-slate-300\">\n                                  {new Date(event.timestamp).toLocaleString()}\n                                </span>\n                              </div>\n                              \n                              {event.location && (\n                                <div className=\"flex items-center gap-1\">\n                                  <MapPin className=\"w-4 h-4 text-slate-300\" />\n                                  <span className=\"text-slate-300\">{event.location}</span>\n                                </div>\n                              )}\n                              \n                              <div className=\"flex items-center gap-1\">\n                                <Database className=\"w-4 h-4 text-slate-300\" />\n                                <span className=\"text-slate-300\">Source: {event.source}</span>\n                              </div>\n                            </div>\n                            \n                            {event.tags && event.tags.length > 0 && (\n                              <div className=\"flex flex-wrap gap-2 mt-3\">\n                                {event.tags.map((tag, idx) => (\n                                  <Badge key={idx} variant=\"secondary\" className=\"text-xs\">\n                                    {tag}\n                                  </Badge>\n                                ))}\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  </div>\n                ))\n              ) : (\n                <div className=\"text-center py-12 text-slate-500\">\n                  <Calendar className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\n                  <p>No events match your filters</p>\n                  <p className=\"text-sm mt-1\">Try changing your search or filter criteria</p>\n                </div>\n              )}\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n      \n      {/* Timeline Summary */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card className=\"bg-card border-white/10\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-primary/10 rounded-lg\">\n                <Calendar className=\"w-5 h-5 text-primary\" />\n              </div>\n              <div>\n                <p className=\"text-xs text-slate-300\">Total Events</p>\n                <p className=\"text-xl font-bold text-white\">{events.length}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n        \n        <Card className=\"bg-card border-white/10\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-emerald-500/10 rounded-lg\">\n                <Eye className=\"w-5 h-5 text-emerald-500\" />\n              </div>\n              <div>\n                <p className=\"text-xs text-slate-300\">Avg Confidence</p>\n                <p className=\"text-xl font-bold text-white\">\n                  {events.length > 0 \n                    ? Math.round(events.reduce((sum, e) => sum + (e.confidence || 0), 0) / events.length) + '%' \n                    : '0%'}\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n        \n        <Card className=\"bg-card border-white/10\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-blue-500/10 rounded-lg\">\n                <Clock className=\"w-5 h-5 text-blue-500\" />\n              </div>\n              <div>\n                <p className=\"text-xs text-slate-300\">Time Span</p>\n                {events.length > 0 ? (\n                  <p className=\"text-xl font-bold text-white\">\n                    {Math.max(1, \n                      Math.floor(\n                        (new Date(events[events.length - 1].timestamp).getTime() - \n                         new Date(events[0].timestamp).getTime()) / (1000 * 60 * 60 * 24)\n                      )\n                    )} days\n                  </p>\n                ) : (\n                  <p className=\"text-xl font-bold text-white\">0 days</p>\n                )}\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n        \n        <Card className=\"bg-card border-white/10\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-purple-500/10 rounded-lg\">\n                <FileText className=\"w-5 h-5 text-purple-500\" />\n              </div>\n              <div>\n                <p className=\"text-xs text-slate-300\">Event Types</p>\n                <p className=\"text-xl font-bold text-white\">{eventTypes.length}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n      \n      {/* Event Type Distribution */}\n      <Card className=\"bg-card border-white/10\">\n        <CardHeader>\n          <CardTitle className=\"text-white flex items-center gap-2\">\n            <Database className=\"w-5 h-5 text-primary\" />\n            Event Type Distribution\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n            {eventTypes.map(type => {\n              const count = events.filter(e => e.eventType === type).length;\n              const percentage = events.length > 0 ? Math.round((count / events.length) * 100) : 0;\n              \n              return (\n                <div key={type} className=\"space-y-2\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-slate-300 capitalize\">{type}</span>\n                    <span className=\"text-white font-medium\">{count}</span>\n                  </div>\n                  <div className=\"w-full bg-muted rounded-full h-2\">\n                    <div \n                      className=\"bg-primary h-2 rounded-full\" \n                      style={{ width: `${percentage}%` }}\n                    ></div>\n                  </div>\n                  <div className=\"text-right text-xs text-slate-300\">{percentage}%</div>\n                </div>\n              );\n            })}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/v2-results/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/v2-results/metadata-charts.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/v2-results/metadata-export.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[437,440],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[437,440],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2007,2010],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2007,2010],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'prefix' is assigned a value but never used. Allowed unused args must match /^_/u.","line":72,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":72,"endColumn":41},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2075,2078],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2075,2078],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2117,2120],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2117,2120],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":74,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2165,2168],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2165,2168],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2958,2961],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2958,2961],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Metadata Export - Export functionality for metadata results\n */\n\nimport React, { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport {\n  Download,\n  FileText,\n  FileJson,\n  FileSpreadsheet,\n  File,\n} from 'lucide-react';\n\nexport interface MetadataExportProps {\n  metadata: any;\n  fileName: string;\n  className?: string;\n}\n\nexport const MetadataExport: React.FC<MetadataExportProps> = ({\n  metadata,\n  fileName,\n  className = '',\n}) => {\n  const [isExporting, setIsExporting] = useState(false);\n  const [exportFormat, setExportFormat] = useState<\n    'json' | 'csv' | 'pdf' | 'excel'\n  >('json');\n\n  const exportToJson = () => {\n    const blob = new Blob([JSON.stringify(metadata, null, 2)], {\n      type: 'application/json',\n    });\n    downloadBlob(blob, `${fileName}.json`);\n  };\n\n  const exportToCsv = () => {\n    // Convert metadata to CSV format\n    const csvContent = convertToCsv(metadata);\n    const blob = new Blob([csvContent], { type: 'text/csv' });\n    downloadBlob(blob, `${fileName}.csv`);\n  };\n\n  const exportToPdf = async () => {\n    // In a real implementation, this would use a PDF library like jsPDF\n    // For now, we'll just create a text representation\n    const textContent = convertToText(metadata);\n    const blob = new Blob([textContent], { type: 'text/plain' });\n    downloadBlob(blob, `${fileName}.txt`);\n  };\n\n  const exportToExcel = () => {\n    // In a real implementation, this would use a library like xlsx\n    // For now, we'll just export as CSV\n    exportToCsv();\n  };\n\n  const downloadBlob = (blob: Blob, filename: string) => {\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = filename;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  };\n\n  const convertToCsv = (obj: any, prefix: string = ''): string => {\n    const flattenObj = (obj: any, prefix: string = ''): Record<string, any> => {\n      const flattened: Record<string, any> = {};\n\n      for (const key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\n          const newKey = prefix ? `${prefix}.${key}` : key;\n\n          if (\n            typeof obj[key] === 'object' &&\n            obj[key] !== null &&\n            !Array.isArray(obj[key])\n          ) {\n            Object.assign(flattened, flattenObj(obj[key], newKey));\n          } else {\n            flattened[newKey] = obj[key];\n          }\n        }\n      }\n\n      return flattened;\n    };\n\n    const flattened = flattenObj(obj);\n    const headers = Object.keys(flattened);\n    const values = Object.values(flattened);\n\n    return [\n      headers.join(','),\n      values.map(v => `\"${String(v).replace(/\"/g, '\"\"')}\"`).join(','),\n    ].join('\\n');\n  };\n\n  const convertToText = (obj: any, indent: number = 0): string => {\n    let text = '';\n\n    for (const key in obj) {\n      if (Object.prototype.hasOwnProperty.call(obj, key)) {\n        const value = obj[key];\n        const spaces = ' '.repeat(indent);\n\n        if (\n          typeof value === 'object' &&\n          value !== null &&\n          !Array.isArray(value)\n        ) {\n          text += `${spaces}${key}:\\n`;\n          text += convertToText(value, indent + 2);\n        } else {\n          text += `${spaces}${key}: ${value}\\n`;\n        }\n      }\n    }\n\n    return text;\n  };\n\n  const handleExport = async () => {\n    setIsExporting(true);\n\n    try {\n      switch (exportFormat) {\n        case 'json':\n          exportToJson();\n          break;\n        case 'csv':\n          exportToCsv();\n          break;\n        case 'pdf':\n          await exportToPdf();\n          break;\n        case 'excel':\n          exportToExcel();\n          break;\n      }\n    } finally {\n      setIsExporting(false);\n    }\n  };\n\n  return (\n    <Card className={`bg-card border-white/10 ${className}`}>\n      <CardHeader>\n        <CardTitle className=\"text-white flex items-center gap-2\">\n          <Download className=\"w-5 h-5 text-primary\" />\n          Export Metadata\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"flex flex-wrap gap-3\">\n          <Button\n            variant={exportFormat === 'json' ? 'default' : 'outline'}\n            onClick={() => setExportFormat('json')}\n            className=\"gap-2\"\n          >\n            <FileJson className=\"w-4 h-4\" />\n            JSON\n          </Button>\n\n          <Button\n            variant={exportFormat === 'csv' ? 'default' : 'outline'}\n            onClick={() => setExportFormat('csv')}\n            className=\"gap-2\"\n          >\n            <FileSpreadsheet className=\"w-4 h-4\" />\n            CSV\n          </Button>\n\n          <Button\n            variant={exportFormat === 'pdf' ? 'default' : 'outline'}\n            onClick={() => setExportFormat('pdf')}\n            className=\"gap-2\"\n          >\n            <FileText className=\"w-4 h-4\" />\n            PDF\n          </Button>\n\n          <Button\n            variant={exportFormat === 'excel' ? 'default' : 'outline'}\n            onClick={() => setExportFormat('excel')}\n            className=\"gap-2\"\n          >\n            <File className=\"w-4 h-4\" />\n            Excel\n          </Button>\n        </div>\n\n        <div className=\"mt-4 flex justify-between items-center\">\n          <Badge variant=\"outline\" className=\"text-xs\">\n            Format: {exportFormat.toUpperCase()}\n          </Badge>\n\n          <Button\n            onClick={handleExport}\n            disabled={isExporting}\n            className=\"gap-2\"\n          >\n            <Download className=\"w-4 h-4\" />\n            {isExporting ? 'Exporting...' : 'Export'}\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n};\n\nexport default MetadataExport;\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/viz/AudioWaveformViz.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/viz/CameraSettingsRadar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'image' is defined but never used. Allowed unused args must match /^_/u.","line":101,"column":45,"nodeType":null,"messageId":"unusedVar","endLine":101,"endColumn":50}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// client/src/components/viz/CameraSettingsRadar.tsx\nimport React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport {\n  Radar,\n  RadarChart,\n  PolarGrid,\n  PolarAngleAxis,\n  PolarRadiusAxis,\n  ResponsiveContainer,\n  Tooltip as RechartsTooltip,\n} from 'recharts';\nimport { Aperture, Timer, Focus, Zap, Sun, Droplets } from 'lucide-react';\n\ninterface CameraSettingsRadarProps {\n  exif: {\n    ISO?: number | string;\n    FNumber?: number | string;\n    ExposureTime?: string;\n    FocalLength?: number | string;\n    WhiteBalance?: string | number;\n    ColorTemperature?: number | string;\n    ExposureCompensation?: number | string;\n    Flash?: string | number;\n    DigitalZoomRatio?: number | string;\n  };\n  image?: {\n    width?: number;\n    height?: number;\n    bit_depth?: number;\n  };\n}\n\ninterface CameraSetting {\n  name: string;\n  value: string | number | undefined;\n  normalized: number;\n  icon: React.ReactNode;\n  description: string;\n}\n\nfunction parseExposure(\n  exposureStr: string | number | undefined\n): number | null {\n  if (!exposureStr || typeof exposureStr === 'number') return null;\n  // Format: \"1/120\" or \"0.002\" or \"2\"\n  const match = String(exposureStr).match(/^(\\d+\\.?\\d*)\\/(\\d+\\.?\\d*)$/);\n  if (match) {\n    return parseFloat(match[1]) / parseFloat(match[2]);\n  }\n  const val = parseFloat(exposureStr);\n  return isNaN(val) ? null : val;\n}\n\nfunction normalizeISO(value: number | string | undefined): number {\n  if (!value) return 0;\n  const num = typeof value === 'string' ? parseInt(value) : value;\n  if (isNaN(num)) return 0;\n  // Log scale: 50 -> 0.2, 100 -> 0.4, 400 -> 0.6, 1600 -> 0.8, 6400 -> 1.0\n  return Math.min(Math.log2(num / 50) / 7, 1);\n}\n\nfunction normalizeAperture(value: number | string | undefined): number {\n  if (!value) return 0;\n  const num = typeof value === 'string' ? parseFloat(value) : value;\n  if (isNaN(num)) return 0;\n  // Aperture: f/1.4 -> 1.0, f/2.8 -> 0.5, f/5.6 -> 0.25, f/16 -> 0.1\n  return Math.min(2.8 / num, 1);\n}\n\nfunction normalizeExposure(value: number | string | undefined): number {\n  const exposure = typeof value === 'string' ? parseExposure(value) : value;\n  if (!exposure) return 0.5;\n  // Exposure: 1/4000 -> 1.0, 1/125 -> 0.5, 2s -> 0.2\n  return Math.min(Math.abs(Math.log2(exposure * 1000)) / 12, 1);\n}\n\nfunction normalizeFocalLength(value: number | string | undefined): number {\n  if (!value) return 0.5;\n  const num = typeof value === 'string' ? parseInt(value) : value;\n  if (isNaN(num)) return 0.5;\n  // Focal length: 14mm -> 0.1, 35mm -> 0.3, 85mm -> 0.7, 600mm -> 1.0\n  return Math.min(num / 600, 1);\n}\n\nfunction normalizeFlash(value: number | string | undefined): number {\n  if (!value) return 0.5;\n  const num = typeof value === 'string' ? parseInt(value) : value;\n  // Flash fired: 1, not fired: 0\n  return num > 0 ? 0.8 : 0.3;\n}\n\nfunction normalizeWhiteBalance(value: number | string | undefined): number {\n  if (!value) return 0.5;\n  // Temperature: 2000K -> 0, 6500K -> 0.5, 10000K -> 1.0\n  const num = typeof value === 'string' ? parseInt(value) : value;\n  if (isNaN(num)) return 0.5;\n  return Math.min(Math.max((num - 2000) / 8000, 0), 1);\n}\n\nexport function CameraSettingsRadar({ exif, image }: CameraSettingsRadarProps) {\n  const data: CameraSetting[] = [\n    {\n      name: 'ISO',\n      value: exif.ISO,\n      normalized: normalizeISO(exif.ISO),\n      icon: <Zap className=\"w-4 h-4\" />,\n      description: 'Light sensitivity',\n    },\n    {\n      name: 'Aperture',\n      value: exif.FNumber,\n      normalized: normalizeAperture(exif.FNumber),\n      icon: <Aperture className=\"w-4 h-4\" />,\n      description: 'f/' + (exif.FNumber || '?'),\n    },\n    {\n      name: 'Shutter',\n      value: exif.ExposureTime,\n      normalized: normalizeExposure(exif.ExposureTime),\n      icon: <Timer className=\"w-4 h-4\" />,\n      description: 'Exposure time',\n    },\n    {\n      name: 'Focal',\n      value: exif.FocalLength,\n      normalized: normalizeFocalLength(exif.FocalLength),\n      icon: <Focus className=\"w-4 h-4\" />,\n      description: (exif.FocalLength || '?') + 'mm',\n    },\n    {\n      name: 'White Bal',\n      value: exif.ColorTemperature || exif.WhiteBalance,\n      normalized: normalizeWhiteBalance(\n        exif.ColorTemperature || exif.WhiteBalance\n      ),\n      icon: <Sun className=\"w-4 h-4\" />,\n      description: 'Color temperature',\n    },\n    {\n      name: 'Flash',\n      value: exif.Flash,\n      normalized: normalizeFlash(exif.Flash),\n      icon: <Droplets className=\"w-4 h-4\" />,\n      description: exif.Flash ? 'Fired' : 'Not fired',\n    },\n  ];\n\n  const radarData = data.map(d => ({\n    subject: d.name,\n    value: d.normalized * 100,\n    fullMark: 100,\n    description: d.description,\n  }));\n\n  const hasAnyData = data.some(d => d.normalized > 0);\n\n  return (\n    <Card className=\"w-full\">\n      <CardHeader className=\"pb-2\">\n        <CardTitle className=\"text-lg flex items-center gap-2\">\n          <Aperture className=\"w-5 h-5\" />\n          Camera Settings\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        {!hasAnyData ? (\n          <div className=\"h-[300px] flex items-center justify-center text-muted-foreground\">\n            No camera settings available\n          </div>\n        ) : (\n          <div className=\"h-[300px]\">\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\n              <RadarChart cx=\"50%\" cy=\"50%\" outerRadius=\"70%\" data={radarData}>\n                <PolarGrid stroke=\"hsl(var(--border))\" />\n                <PolarAngleAxis\n                  dataKey=\"subject\"\n                  tick={{ fill: 'hsl(var(--foreground))', fontSize: 12 }}\n                />\n                <PolarRadiusAxis\n                  angle={30}\n                  domain={[0, 100]}\n                  tick={{ fill: 'hsl(var(--muted-foreground))', fontSize: 10 }}\n                />\n                <Radar\n                  name=\"Settings\"\n                  dataKey=\"value\"\n                  stroke=\"hsl(var(--primary))\"\n                  fill=\"hsl(var(--primary))\"\n                  fillOpacity={0.4}\n                  strokeWidth={2}\n                />\n                <RechartsTooltip\n                  content={({ active, payload }) => {\n                    if (active && payload && payload.length) {\n                      const data = payload[0].payload;\n                      return (\n                        <div className=\"bg-background border rounded-lg shadow-lg p-3\">\n                          <p className=\"font-medium\">{data.subject}</p>\n                          <p className=\"text-sm text-muted-foreground\">\n                            {data.description}\n                          </p>\n                          <p className=\"text-xs mt-1\">\n                            Value: {data.value.toFixed(0)}%\n                          </p>\n                        </div>\n                      );\n                    }\n                    return null;\n                  }}\n                />\n              </RadarChart>\n            </ResponsiveContainer>\n          </div>\n        )}\n\n        {/* Settings summary */}\n        <div className=\"grid grid-cols-2 md:grid-cols-3 gap-2 mt-4\">\n          {data\n            .filter(d => d.value)\n            .map(setting => (\n              <div\n                key={setting.name}\n                className=\"flex items-center gap-2 p-2 rounded-lg bg-muted/50\"\n              >\n                <span className=\"text-muted-foreground\">{setting.icon}</span>\n                <div>\n                  <p className=\"text-xs text-muted-foreground\">\n                    {setting.name}\n                  </p>\n                  <p className=\"text-sm font-medium\">{setting.description}</p>\n                </div>\n              </div>\n            ))}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/viz/ColorHistogram.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Aperture' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// client/src/components/viz/ColorHistogram.tsx\nimport React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Aperture, BarChart3, Activity } from 'lucide-react';\n\ninterface ColorHistogramProps {\n  image?: {\n    width?: number;\n    height?: number;\n    bit_depth?: number;\n    color_mode?: string;\n  };\n  exif?: {\n    ColorSpace?: number;\n    WhiteBalance?: string | number;\n    ColorTemperature?: number;\n  };\n}\n\ninterface HistogramData {\n  red: number[];\n  green: number[];\n  blue: number[];\n  luminance: number[];\n}\n\n// Generate simulated histogram data (in real app, would extract from image)\nfunction generateHistogramData(): HistogramData {\n  const size = 256;\n  return {\n    red: Array.from({ length: size }, (_, i) => {\n      // Simulate a typical photo histogram distribution\n      const center = 128 + (Math.random() - 0.5) * 50;\n      const width = 60 + Math.random() * 40;\n      return Math.max(\n        0,\n        100 * Math.exp(-Math.pow(i - center, 2) / (2 * width * width)) +\n          Math.random() * 5\n      );\n    }),\n    green: Array.from({ length: size }, (_, i) => {\n      const center = 130 + (Math.random() - 0.5) * 50;\n      const width = 55 + Math.random() * 40;\n      return Math.max(\n        0,\n        100 * Math.exp(-Math.pow(i - center, 2) / (2 * width * width)) +\n          Math.random() * 5\n      );\n    }),\n    blue: Array.from({ length: size }, (_, i) => {\n      const center = 125 + (Math.random() - 0.5) * 50;\n      const width = 65 + Math.random() * 40;\n      return Math.max(\n        0,\n        100 * Math.exp(-Math.pow(i - center, 2) / (2 * width * width)) +\n          Math.random() * 5\n      );\n    }),\n    luminance: Array.from({ length: size }, (_, i) => {\n      const center = 132 + (Math.random() - 0.5) * 50;\n      const width = 58 + Math.random() * 40;\n      return Math.max(\n        0,\n        100 * Math.exp(-Math.pow(i - center, 2) / (2 * width * width)) +\n          Math.random() * 3\n      );\n    }),\n  };\n}\n\nfunction calculateStatistics(data: number[]): {\n  mean: number;\n  stdDev: number;\n  percentile95: number;\n} {\n  const valid = data.filter(v => !isNaN(v) && isFinite(v));\n  const mean = valid.reduce((a, b) => a + b, 0) / valid.length;\n  const stdDev = Math.sqrt(\n    valid.reduce((sum, v) => sum + Math.pow(v - mean, 2), 0) / valid.length\n  );\n  const sorted = [...valid].sort((a, b) => a - b);\n  const percentile95 = sorted[Math.floor(sorted.length * 0.95)];\n  return { mean, stdDev, percentile95 };\n}\n\nexport function ColorHistogram({ image, exif }: ColorHistogramProps) {\n  const histogram = generateHistogramData();\n  const maxValue = Math.max(\n    ...histogram.red,\n    ...histogram.green,\n    ...histogram.blue\n  );\n\n  const stats = {\n    red: calculateStatistics(histogram.red),\n    green: calculateStatistics(histogram.green),\n    blue: calculateStatistics(histogram.blue),\n  };\n\n  const colorStats = [\n    {\n      name: 'Red',\n      color: 'rgb(239, 68, 68)',\n      data: histogram.red,\n      stats: stats.red,\n    },\n    {\n      name: 'Green',\n      color: 'rgb(34, 197, 94)',\n      data: histogram.green,\n      stats: stats.green,\n    },\n    {\n      name: 'Blue',\n      color: 'rgb(59, 130, 246)',\n      data: histogram.blue,\n      stats: stats.blue,\n    },\n  ];\n\n  return (\n    <Card className=\"w-full\">\n      <CardHeader className=\"pb-2\">\n        <CardTitle className=\"text-lg flex items-center gap-2\">\n          <BarChart3 className=\"w-5 h-5\" />\n          Color Histogram\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        {/* Histogram Chart */}\n        <div className=\"h-[200px] w-full relative\">\n          <svg\n            className=\"w-full h-full\"\n            viewBox=\"0 0 256 100\"\n            preserveAspectRatio=\"none\"\n            role=\"img\"\n            aria-label=\"Color histogram showing RGB distribution\"\n          >\n            <title>Color Histogram</title>\n            {/* Luminance (background) */}\n            <path\n              d={histogram.luminance\n                .map((v, i) => `${i},${100 - (v / maxValue) * 100}`)\n                .join(' L ')}\n              fill=\"none\"\n              stroke=\"rgb(156, 163, 175)\"\n              strokeWidth=\"0.5\"\n              opacity=\"0.3\"\n            />\n\n            {/* RGB channels */}\n            {colorStats.map((channel, idx) => (\n              <g key={channel.name}>\n                <path\n                  d={channel.data\n                    .map((v, i) => `${i},${100 - (v / maxValue) * 100}`)\n                    .join(' L ')}\n                  fill=\"none\"\n                  stroke={channel.color}\n                  strokeWidth={idx === 2 ? '1.5' : '1'}\n                  opacity=\"0.8\"\n                />\n                <path\n                  d={`${channel.data.map((v, i) => `${i},${100 - (v / maxValue) * 100}`).join(' L ')} L 255,100 L 0,100 Z`}\n                  fill={channel.color}\n                  opacity=\"0.15\"\n                />\n              </g>\n            ))}\n          </svg>\n\n          {/* Ticks */}\n          <div className=\"absolute bottom-0 left-0 right-0 flex justify-between text-[10px] text-muted-foreground px-1\">\n            <span>0</span>\n            <span>64</span>\n            <span>128</span>\n            <span>192</span>\n            <span>255</span>\n          </div>\n        </div>\n\n        {/* Color legend */}\n        <div className=\"flex flex-wrap gap-4 mt-4\">\n          {colorStats.map(channel => (\n            <div key={channel.name} className=\"flex items-center gap-2\">\n              <div\n                className=\"w-3 h-3 rounded-full\"\n                style={{ backgroundColor: channel.color }}\n              />\n              <span className=\"text-sm\">{channel.name}</span>\n              <Badge variant=\"outline\" className=\"text-xs\">\n                ={channel.stats.mean.toFixed(0)}\n              </Badge>\n            </div>\n          ))}\n        </div>\n\n        {/* Image info */}\n        <div className=\"grid grid-cols-2 gap-4 mt-4 pt-4 border-t\">\n          <div>\n            <div className=\"text-xs text-muted-foreground\">Dimensions</div>\n            <div className=\"font-mono text-sm\">\n              {image?.width || '?'}  {image?.height || '?'}\n            </div>\n          </div>\n          <div>\n            <div className=\"text-xs text-muted-foreground\">Bit Depth</div>\n            <div className=\"font-mono text-sm\">\n              {image?.bit_depth || '?'} bit\n            </div>\n          </div>\n          <div>\n            <div className=\"text-xs text-muted-foreground\">Color Space</div>\n            <div className=\"font-mono text-sm\">\n              {exif?.ColorSpace === 1 ? 'sRGB' : exif?.ColorSpace || 'Unknown'}\n            </div>\n          </div>\n          <div>\n            <div className=\"text-xs text-muted-foreground\">White Balance</div>\n            <div className=\"font-mono text-sm\">\n              {exif?.WhiteBalance || 'Auto'}\n            </div>\n          </div>\n        </div>\n\n        {/* Histogram insights */}\n        <div className=\"mt-4 p-3 rounded bg-muted/50\">\n          <div className=\"flex items-center gap-2 mb-2\">\n            <Activity className=\"w-4 h-4 text-muted-foreground\" />\n            <span className=\"text-sm font-medium\">Histogram Analysis</span>\n          </div>\n          <ul className=\"text-xs text-muted-foreground space-y-1\">\n            <li> Distribution centered around mid-tones (good exposure)</li>\n            <li> Red channel slightly higher (warm tone)</li>\n            <li> No blown highlights or blocked shadows</li>\n          </ul>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/viz/DateTimeTimeline.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/viz/EmailThreadViz.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Tooltip' is defined but never used.","line":6,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TooltipContent' is defined but never used.","line":7,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TooltipProvider' is defined but never used.","line":8,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TooltipTrigger' is defined but never used.","line":9,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":11,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ReplyAll' is defined but never used.","line":16,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used.","line":21,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getSecurityBadge' is defined but never used.","line":118,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":118,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'idx' is defined but never used. Allowed unused args must match /^_/u.","line":391,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":391,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// client/src/components/viz/EmailThreadViz.tsx\nimport React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from '@/components/ui/tooltip';\nimport { Button } from '@/components/ui/button';\nimport {\n  Mail,\n  Reply,\n  Forward,\n  ReplyAll,\n  Paperclip,\n  Shield,\n  AlertTriangle,\n  CheckCircle,\n  Clock,\n  ArrowRight,\n  ArrowDown,\n  ArrowUp,\n  Users,\n  Calendar,\n} from 'lucide-react';\n\ninterface EmailThreadVizProps {\n  email: {\n    email_from?: string;\n    email_from_name?: string;\n    email_from_address?: string;\n    email_to?: string;\n    email_to_addresses?: string[];\n    email_cc?: string;\n    email_cc_addresses?: string[];\n    email_bcc?: string;\n    email_bcc_addresses?: string[];\n    email_subject?: string;\n    email_date?: string;\n    email_datetime_parsed?: string;\n    email_timestamp?: number;\n    email_message_id?: string;\n    email_in_reply_to?: string;\n    email_references?: string;\n    email_is_reply?: boolean;\n    email_is_direct_reply?: boolean;\n    email_is_forward?: boolean;\n    email_thread_level?: number;\n    email_priority?: string;\n    email_dkim_present?: boolean;\n    email_spf_result?: string;\n    email_authentication_results?: string;\n    email_spam_status?: string;\n    email_attachment_count?: number;\n    email_attachments?: Array<{\n      filename: string;\n      content_type: string;\n      size: number;\n    }>;\n  };\n}\n\ninterface Participant {\n  name: string;\n  email: string;\n  type: 'from' | 'to' | 'cc' | 'bcc';\n  avatar?: string;\n}\n\ninterface ThreadNode {\n  id: string;\n  subject: string;\n  from: Participant;\n  to: Participant[];\n  cc: Participant[];\n  date: string;\n  isReply: boolean;\n  isForward: boolean;\n  threadLevel: number;\n  hasAttachments: boolean;\n  security: {\n    dkim: boolean;\n    spf: string;\n    spamScore: string;\n  };\n}\n\nfunction extractEmail(str: string | undefined): string {\n  if (!str) return '';\n  const match = str.match(/<([^>]+)>/);\n  return match ? match[1] : str;\n}\n\nfunction extractName(str: string | undefined): string {\n  if (!str) return '';\n  const match = str.match(/^\"?([^\"<]+)\"?\\s*</);\n  if (match) return match[1].trim();\n  return str.split('@')[0] || str;\n}\n\nfunction getAvatarColor(type: string): string {\n  switch (type) {\n    case 'from':\n      return 'bg-blue-500';\n    case 'to':\n      return 'bg-green-500';\n    case 'cc':\n      return 'bg-amber-500';\n    case 'bcc':\n      return 'bg-gray-500';\n    default:\n      return 'bg-gray-400';\n  }\n}\n\nfunction getSecurityBadge(dkim: boolean, spf: string): React.ReactNode {\n  if (dkim && spf === 'pass') {\n    return (\n      <Badge className=\"bg-green-100 text-green-800 hover:bg-green-100\">\n        <CheckCircle className=\"w-3 h-3 mr-1\" />\n        Verified\n      </Badge>\n    );\n  }\n  if (spf === 'fail' || spf === 'softfail') {\n    return (\n      <Badge className=\"bg-red-100 text-red-800 hover:bg-red-100\">\n        <AlertTriangle className=\"w-3 h-3 mr-1\" />\n        Failed\n      </Badge>\n    );\n  }\n  return (\n    <Badge variant=\"outline\">\n      <Shield className=\"w-3 h-3 mr-1\" />\n      Unknown\n    </Badge>\n  );\n}\n\nfunction getPriorityBadge(priority: string | undefined): React.ReactNode {\n  if (!priority) return null;\n\n  switch (priority.toLowerCase()) {\n    case 'high':\n    case 'urgent':\n      return (\n        <Badge variant=\"destructive\" className=\"text-xs\">\n          <ArrowUp className=\"w-3 h-3 mr-1\" />\n          High Priority\n        </Badge>\n      );\n    case 'low':\n    case 'non-urgent':\n      return (\n        <Badge variant=\"secondary\" className=\"text-xs\">\n          Low Priority\n        </Badge>\n      );\n    default:\n      return (\n        <Badge variant=\"outline\" className=\"text-xs\">\n          Normal\n        </Badge>\n      );\n  }\n}\n\nexport function EmailThreadViz({ email }: EmailThreadVizProps) {\n  // Build thread nodes\n  const nodes: ThreadNode[] = [];\n\n  const mainNode: ThreadNode = {\n    id: email.email_message_id || 'main',\n    subject: email.email_subject || '(No Subject)',\n    from: {\n      name: email.email_from_name || extractName(email.email_from),\n      email: extractEmail(email.email_from),\n      type: 'from',\n    },\n    to: (email.email_to_addresses || []).map(e => ({\n      name: extractName(e),\n      email: extractEmail(e),\n      type: 'to' as const,\n    })),\n    cc: (email.email_cc_addresses || []).map(e => ({\n      name: extractName(e),\n      email: extractEmail(e),\n      type: 'cc' as const,\n    })),\n    date: email.email_datetime_parsed || email.email_date || '',\n    isReply: email.email_is_reply || false,\n    isForward: email.email_is_forward || false,\n    threadLevel: email.email_thread_level || 0,\n    hasAttachments: (email.email_attachment_count || 0) > 0,\n    security: {\n      dkim: email.email_dkim_present || false,\n      spf: email.email_spf_result || 'unknown',\n      spamScore: email.email_spam_status || 'Unknown',\n    },\n  };\n\n  nodes.push(mainNode);\n\n  const maxLevel = Math.max(...nodes.map(n => n.threadLevel));\n\n  return (\n    <Card className=\"w-full\">\n      <CardHeader className=\"pb-2\">\n        <CardTitle className=\"text-lg flex items-center gap-2\">\n          <Mail className=\"w-5 h-5\" />\n          Email Thread\n          {getPriorityBadge(email.email_priority)}\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        {/* Subject line */}\n        <div className=\"mb-4 p-3 rounded-lg bg-muted/50\">\n          <div className=\"flex items-center gap-2 flex-wrap\">\n            {mainNode.isReply && <Reply className=\"w-4 h-4 text-blue-600\" />}\n            {mainNode.isForward && (\n              <Forward className=\"w-4 h-4 text-orange-600\" />\n            )}\n            <span className=\"font-medium\">{mainNode.subject}</span>\n          </div>\n          {maxLevel > 0 && (\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Thread level: {mainNode.threadLevel}\n            </div>\n          )}\n        </div>\n\n        {/* Participants */}\n        <div className=\"mb-4\">\n          <h4 className=\"text-sm font-medium mb-2 flex items-center gap-2\">\n            <Users className=\"w-4 h-4\" />\n            Participants\n          </h4>\n\n          <div className=\"space-y-2\">\n            {/* From */}\n            <div className=\"flex items-center gap-2\">\n              <div\n                className={`w-8 h-8 rounded-full ${getAvatarColor('from')} flex items-center justify-center text-white text-sm font-medium`}\n              >\n                {mainNode.from.name.charAt(0).toUpperCase()}\n              </div>\n              <div>\n                <div className=\"text-sm font-medium\">{mainNode.from.name}</div>\n                <div className=\"text-xs text-muted-foreground\">\n                  {mainNode.from.email}\n                </div>\n              </div>\n              <Badge variant=\"outline\" className=\"text-xs ml-auto\">\n                From\n              </Badge>\n            </div>\n\n            {/* To */}\n            {mainNode.to.map((recipient, idx) => (\n              <div\n                key={`to-${recipient.email}-${idx}`}\n                className=\"flex items-center gap-2\"\n              >\n                <div\n                  className={`w-8 h-8 rounded-full ${getAvatarColor('to')} flex items-center justify-center text-white text-sm font-medium`}\n                >\n                  {recipient.name.charAt(0).toUpperCase()}\n                </div>\n                <div>\n                  <div className=\"text-sm font-medium\">{recipient.name}</div>\n                  <div className=\"text-xs text-muted-foreground\">\n                    {recipient.email}\n                  </div>\n                </div>\n                <Badge variant=\"outline\" className=\"text-xs ml-auto\">\n                  To\n                </Badge>\n              </div>\n            ))}\n\n            {/* CC */}\n            {mainNode.cc.length > 0 && (\n              <div className=\"mt-2\">\n                <div className=\"text-xs text-muted-foreground mb-1\">CC:</div>\n                {mainNode.cc.map((recipient, idx) => (\n                  <div\n                    key={`cc-${recipient.email}-${idx}`}\n                    className=\"flex items-center gap-2 ml-4\"\n                  >\n                    <div\n                      className={`w-6 h-6 rounded-full ${getAvatarColor('cc')} flex items-center justify-center text-white text-xs font-medium`}\n                    >\n                      {recipient.name.charAt(0).toUpperCase()}\n                    </div>\n                    <div className=\"text-sm\">{recipient.name}</div>\n                    <div className=\"text-xs text-muted-foreground\">\n                      {recipient.email}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Date & Time */}\n        <div className=\"mb-4 p-3 rounded-lg bg-muted/50\">\n          <div className=\"flex items-center gap-2\">\n            <Calendar className=\"w-4 h-4 text-muted-foreground\" />\n            <span className=\"text-sm\">{mainNode.date}</span>\n          </div>\n        </div>\n\n        {/* Attachments */}\n        {mainNode.hasAttachments &&\n          email.email_attachments &&\n          email.email_attachments.length > 0 && (\n            <div className=\"mb-4\">\n              <h4 className=\"text-sm font-medium mb-2 flex items-center gap-2\">\n                <Paperclip className=\"w-4 h-4\" />\n                Attachments ({email.email_attachments.length})\n              </h4>\n              <div className=\"space-y-1\">\n                {email.email_attachments.map((att, idx) => (\n                  <div\n                    key={`attachment-${att.filename}-${idx}`}\n                    className=\"flex items-center gap-2 p-2 rounded bg-muted/30\"\n                  >\n                    <Paperclip className=\"w-4 h-4 text-muted-foreground\" />\n                    <span className=\"text-sm flex-1\">{att.filename}</span>\n                    <span className=\"text-xs text-muted-foreground\">\n                      {att.size ? `${(att.size / 1024).toFixed(1)} KB` : ''}\n                    </span>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n        {/* Security Status */}\n        <div className=\"border-t pt-4\">\n          <h4 className=\"text-sm font-medium mb-2 flex items-center gap-2\">\n            <Shield className=\"w-4 h-4\" />\n            Security Verification\n          </h4>\n          <div className=\"grid grid-cols-2 gap-2\">\n            <div className=\"flex items-center gap-2 p-2 rounded bg-muted/30\">\n              <CheckCircle\n                className={`w-4 h-4 ${mainNode.security.dkim ? 'text-green-600' : 'text-gray-400'}`}\n              />\n              <span className=\"text-sm\">DKIM</span>\n              {mainNode.security.dkim ? (\n                <Badge className=\"ml-auto text-xs\">Valid</Badge>\n              ) : (\n                <Badge variant=\"outline\" className=\"ml-auto text-xs\">\n                  Not found\n                </Badge>\n              )}\n            </div>\n            <div className=\"flex items-center gap-2 p-2 rounded bg-muted/30\">\n              <CheckCircle\n                className={`w-4 h-4 ${mainNode.security.spf === 'pass' ? 'text-green-600' : 'text-gray-400'}`}\n              />\n              <span className=\"text-sm\">SPF</span>\n              <Badge\n                className={`ml-auto text-xs ${mainNode.security.spf === 'pass' ? 'bg-green-100 text-green-800' : 'bg-gray-100'}`}\n              >\n                {mainNode.security.spf}\n              </Badge>\n            </div>\n          </div>\n          {email.email_spam_status && (\n            <div className=\"mt-2 p-2 rounded bg-muted/30 text-sm\">\n              <span className=\"text-muted-foreground\">Spam status: </span>\n              {email.email_spam_status}\n            </div>\n          )}\n        </div>\n\n        {/* Thread visualization */}\n        {maxLevel > 0 && (\n          <div className=\"border-t pt-4 mt-4\">\n            <h4 className=\"text-sm font-medium mb-2 flex items-center gap-2\">\n              <ArrowRight className=\"w-4 h-4\" />\n              Thread Structure\n            </h4>\n            <div className=\"space-y-2\">\n              {nodes.map((node, idx) => (\n                <div\n                  key={node.id}\n                  className=\"flex items-center gap-2\"\n                  style={{ marginLeft: `${node.threadLevel * 24}px` }}\n                >\n                  <ArrowDown className=\"w-4 h-4 text-muted-foreground\" />\n                  <div className=\"p-2 rounded bg-muted/50 flex-1\">\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"text-sm font-medium\">\n                        {node.subject}\n                      </span>\n                      {node.isReply && (\n                        <Reply className=\"w-3 h-3 text-blue-600\" />\n                      )}\n                      {node.isForward && (\n                        <Forward className=\"w-3 h-3 text-orange-600\" />\n                      )}\n                    </div>\n                    <div className=\"text-xs text-muted-foreground\">\n                      From: {node.from.name}  {node.date}\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/viz/ForensicTimeline.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'XCircle' is defined but never used.","line":10,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'LinkIcon' is defined but never used.","line":15,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fileType' is defined but never used. Allowed unused args must match /^_/u.","line":106,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":106,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'filename' is defined but never used. Allowed unused args must match /^_/u.","line":107,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":107,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'idx' is defined but never used. Allowed unused args must match /^_/u.","line":275,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":275,"endColumn":44}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// client/src/components/viz/ForensicTimeline.tsx\nimport React, { useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport {\n  History,\n  Shield,\n  CheckCircle,\n  XCircle,\n  AlertTriangle,\n  Clock,\n  FileCheck,\n  Fingerprint,\n  Link as LinkIcon,\n  Hash,\n} from 'lucide-react';\n\ninterface FileIntegrity {\n  md5?: string;\n  sha256?: string;\n  sha1?: string;\n  crc32?: string;\n}\n\ninterface ForensicData {\n  forensic_filesystem?: {\n    file_created?: string;\n    file_modified?: string;\n    file_accessed?: string;\n    file_size?: number;\n    file_permissions?: string;\n    file_owner?: number;\n    file_inode?: number;\n  };\n  forensic_device_hardware?: {\n    device_id?: string;\n    volume_id?: string;\n    drive_type?: string;\n    filesystem_type?: string;\n  };\n  forensic_network_communication?: {\n    peer_ip?: string;\n    peer_hostname?: string;\n    connection_type?: string;\n  };\n}\n\ninterface ForensicTimelineProps {\n  integrity?: FileIntegrity;\n  forensic?: ForensicData;\n  fileType?: string;\n  filename?: string;\n}\n\ninterface TimelineEvent {\n  id: string;\n  timestamp: Date | null;\n  label: string;\n  description: string;\n  type:\n    | 'creation'\n    | 'modification'\n    | 'access'\n    | 'transfer'\n    | 'verification'\n    | 'hash';\n  icon: React.ReactNode;\n  color: string;\n  verified: boolean;\n}\n\nfunction parseDate(dateStr: string | undefined): Date | null {\n  if (!dateStr) return null;\n  const date = new Date(dateStr);\n  return isNaN(date.getTime()) ? null : date;\n}\n\nfunction formatDateTime(date: Date | null): string {\n  if (!date) return 'Unknown';\n  return date.toLocaleString('en-US', {\n    month: 'short',\n    day: 'numeric',\n    year: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit',\n    second: '2-digit',\n  });\n}\n\nfunction formatRelativeTime(date: Date | null): string {\n  if (!date) return '';\n  const now = new Date();\n  const diffMs = now.getTime() - date.getTime();\n  const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\n  if (diffDays === 0) return 'Today';\n  if (diffDays === 1) return 'Yesterday';\n  if (diffDays < 30) return `${diffDays} days ago`;\n  if (diffDays < 365) return `${Math.floor(diffDays / 30)} months ago`;\n  return `${Math.floor(diffDays / 365)} years ago`;\n}\n\nexport function ForensicTimeline({\n  integrity,\n  forensic,\n  fileType,\n  filename,\n}: ForensicTimelineProps) {\n  const [filter, setFilter] = useState<\n    'all' | 'creation' | 'modification' | 'access' | 'hash'\n  >('all');\n\n  const events: TimelineEvent[] = [\n    {\n      id: 'file-created',\n      timestamp: parseDate(forensic?.forensic_filesystem?.file_created),\n      label: 'File Created',\n      description: `Original file created on this device`,\n      type: 'creation',\n      icon: <FileCheck className=\"w-4 h-4\" />,\n      color: 'text-green-600',\n      verified: true,\n    },\n    {\n      id: 'file-modified',\n      timestamp: parseDate(forensic?.forensic_filesystem?.file_modified),\n      label: 'Last Modified',\n      description: `File was last modified`,\n      type: 'modification',\n      icon: <Clock className=\"w-4 h-4\" />,\n      color: 'text-blue-600',\n      verified: true,\n    },\n    {\n      id: 'file-accessed',\n      timestamp: parseDate(forensic?.forensic_filesystem?.file_accessed),\n      label: 'Last Accessed',\n      description: `File was last accessed`,\n      type: 'access',\n      icon: <Clock className=\"w-4 h-4\" />,\n      color: 'text-orange-600',\n      verified: true,\n    },\n    {\n      id: 'hash-computed',\n      timestamp: new Date(),\n      label: 'Hash Verified',\n      description: `SHA-256: ${integrity?.sha256?.substring(0, 16)}...`,\n      type: 'hash',\n      icon: <Fingerprint className=\"w-4 h-4\" />,\n      color: 'text-purple-600',\n      verified: true,\n    },\n  ];\n\n  const filteredEvents = events\n    .filter(e => filter === 'all' || e.type === filter)\n    .filter(e => e.timestamp)\n    .sort(\n      (a, b) => (a.timestamp?.getTime() || 0) - (b.timestamp?.getTime() || 0)\n    );\n\n  // Calculate forensic score (simplified)\n  const verifiedCount = events.filter(e => e.verified).length;\n  const forensicScore = Math.round((verifiedCount / events.length) * 100);\n\n  return (\n    <Card className=\"w-full\">\n      <CardHeader className=\"pb-2\">\n        <CardTitle className=\"text-lg flex items-center gap-2\">\n          <History className=\"w-5 h-5\" />\n          Chain of Custody\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        {/* Forensic Score */}\n        <div className=\"mb-6 p-4 rounded-lg bg-gradient-to-r from-muted/50 to-muted/30\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <div className=\"flex items-center gap-2\">\n              <Shield className=\"w-5 h-5 text-green-600\" />\n              <span className=\"font-medium\">Forensic Score</span>\n            </div>\n            <Badge\n              variant={\n                forensicScore >= 80\n                  ? 'default'\n                  : forensicScore >= 50\n                    ? 'secondary'\n                    : 'destructive'\n              }\n            >\n              {forensicScore}%\n            </Badge>\n          </div>\n          <Progress value={forensicScore} className=\"h-2\" />\n          <p className=\"text-xs text-muted-foreground mt-2\">\n            {forensicScore >= 80\n              ? 'High confidence - Multiple timestamps and hashes verified'\n              : forensicScore >= 50\n                ? 'Medium confidence - Limited forensic data available'\n                : 'Low confidence - Insufficient forensic metadata'}\n          </p>\n        </div>\n\n        {/* Filter */}\n        <div className=\"mb-4 flex gap-2 flex-wrap\">\n          {(['all', 'creation', 'modification', 'access', 'hash'] as const).map(\n            f => (\n              <button\n                type=\"button\"\n                key={f}\n                onClick={() => setFilter(f)}\n                className={`px-3 py-1 text-xs rounded-full transition-colors ${\n                  filter === f\n                    ? 'bg-primary text-primary-foreground'\n                    : 'bg-muted hover:bg-muted/80'\n                }`}\n              >\n                {f.charAt(0).toUpperCase() + f.slice(1)}\n              </button>\n            )\n          )}\n        </div>\n\n        {/* File Hashes */}\n        {integrity && (\n          <div className=\"mb-6\">\n            <h4 className=\"text-sm font-medium mb-2 flex items-center gap-2\">\n              <Hash className=\"w-4 h-4\" />\n              File Hashes\n            </h4>\n            <div className=\"space-y-2\">\n              {integrity.sha256 && (\n                <div className=\"flex items-center gap-2 p-2 rounded bg-muted/30\">\n                  <span className=\"text-xs text-muted-foreground w-12\">\n                    SHA-256\n                  </span>\n                  <code className=\"text-xs flex-1 font-mono truncate\">\n                    {integrity.sha256}\n                  </code>\n                  <CheckCircle className=\"w-4 h-4 text-green-600\" />\n                </div>\n              )}\n              {integrity.md5 && (\n                <div className=\"flex items-center gap-2 p-2 rounded bg-muted/30\">\n                  <span className=\"text-xs text-muted-foreground w-12\">\n                    MD5\n                  </span>\n                  <code className=\"text-xs flex-1 font-mono truncate\">\n                    {integrity.md5}\n                  </code>\n                  <CheckCircle className=\"w-4 h-4 text-green-600\" />\n                </div>\n              )}\n              {integrity.sha1 && (\n                <div className=\"flex items-center gap-2 p-2 rounded bg-muted/30\">\n                  <span className=\"text-xs text-muted-foreground w-12\">\n                    SHA-1\n                  </span>\n                  <code className=\"text-xs flex-1 font-mono truncate\">\n                    {integrity.sha1}\n                  </code>\n                  <CheckCircle className=\"w-4 h-4 text-green-600\" />\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* Timeline */}\n        <div className=\"relative\">\n          <div className=\"absolute left-3 top-0 bottom-0 w-0.5 bg-border\" />\n\n          <div className=\"space-y-4\">\n            {filteredEvents.map((event, idx) => (\n              <div\n                key={event.id}\n                className=\"relative flex items-start gap-4 pl-10\"\n              >\n                {/* Icon */}\n                <div\n                  className={`absolute left-0 w-6 h-6 rounded-full bg-background border-2 border-${event.color.replace('text-', '')} flex items-center justify-center z-10 ${event.color}`}\n                >\n                  {event.icon}\n                </div>\n\n                {/* Content */}\n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"flex items-center gap-2 flex-wrap\">\n                    <span className=\"font-medium\">{event.label}</span>\n                    {event.verified ? (\n                      <Badge variant=\"outline\" className=\"text-xs bg-green-50\">\n                        <CheckCircle className=\"w-3 h-3 mr-1 text-green-600\" />\n                        Verified\n                      </Badge>\n                    ) : (\n                      <Badge variant=\"outline\" className=\"text-xs bg-amber-50\">\n                        <AlertTriangle className=\"w-3 h-3 mr-1 text-amber-600\" />\n                        Unverified\n                      </Badge>\n                    )}\n                  </div>\n\n                  <div className=\"text-sm text-muted-foreground mt-1\">\n                    {event.description}\n                  </div>\n\n                  <div className=\"flex items-center gap-2 mt-1 text-xs text-muted-foreground\">\n                    <Clock className=\"w-3 h-3\" />\n                    <span>{formatDateTime(event.timestamp)}</span>\n                    <span></span>\n                    <span>{formatRelativeTime(event.timestamp)}</span>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n\n        {/* Device Info */}\n        {forensic?.forensic_device_hardware && (\n          <div className=\"mt-6 pt-4 border-t\">\n            <h4 className=\"text-sm font-medium mb-2 flex items-center gap-2\">\n              <Fingerprint className=\"w-4 h-4\" />\n              Device Information\n            </h4>\n            <div className=\"grid grid-cols-2 gap-2 text-sm\">\n              {forensic.forensic_device_hardware.device_id && (\n                <div className=\"p-2 rounded bg-muted/30\">\n                  <span className=\"text-xs text-muted-foreground\">\n                    Device ID\n                  </span>\n                  <div className=\"font-mono text-xs truncate\">\n                    {forensic.forensic_device_hardware.device_id}\n                  </div>\n                </div>\n              )}\n              {forensic.forensic_device_hardware.filesystem_type && (\n                <div className=\"p-2 rounded bg-muted/30\">\n                  <span className=\"text-xs text-muted-foreground\">\n                    Filesystem\n                  </span>\n                  <div>{forensic.forensic_device_hardware.filesystem_type}</div>\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/viz/LocationMiniMap.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'image' is defined but never used. Allowed unused args must match /^_/u.","line":69,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":69,"endColumn":45}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// client/src/components/viz/LocationMiniMap.tsx\nimport React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport {\n  MapPin,\n  Navigation,\n  ExternalLink,\n  Clock,\n  Map as MapIcon,\n  Layers,\n} from 'lucide-react';\n\ninterface LocationMiniMapProps {\n  gps?: {\n    latitude?: number;\n    longitude?: number;\n    latitude_decimal?: number;\n    longitude_decimal?: number;\n    altitude_meters?: number;\n    gps_timestamp?: string;\n    gps_speed?: number;\n    gps_direction?: number;\n    coordinates_formatted?: string;\n    google_maps_url?: string;\n    openstreetmap_url?: string;\n  };\n  image?: {\n    width?: number;\n    height?: number;\n  };\n}\n\nfunction formatCoordinates(\n  lat: number | undefined,\n  lon: number | undefined\n): string {\n  if (lat === undefined || lon === undefined) return 'Unknown';\n\n  const latDir = lat >= 0 ? 'N' : 'S';\n  const lonDir = lon >= 0 ? 'E' : 'W';\n\n  const latAbs = Math.abs(lat);\n  const lonAbs = Math.abs(lon);\n\n  return `${latAbs.toFixed(4)} ${latDir}, ${lonAbs.toFixed(4)} ${lonDir}`;\n}\n\nfunction getRelativeTime(timestamp: string | undefined): string {\n  if (!timestamp) return '';\n\n  try {\n    const date = new Date(timestamp);\n    const now = new Date();\n    const diffMs = now.getTime() - date.getTime();\n    const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\n\n    if (diffDays === 0) return 'Today';\n    if (diffDays === 1) return 'Yesterday';\n    if (diffDays < 30) return `${diffDays} days ago`;\n    if (diffDays < 365) return `${Math.floor(diffDays / 30)} months ago`;\n    return `${Math.floor(diffDays / 365)} years ago`;\n  } catch {\n    return '';\n  }\n}\n\nexport function LocationMiniMap({ gps, image }: LocationMiniMapProps) {\n  const lat = gps?.latitude || gps?.latitude_decimal;\n  const lon = gps?.longitude || gps?.longitude_decimal;\n\n  const hasLocation = lat !== undefined && lon !== undefined;\n  const googleMapsUrl =\n    gps?.google_maps_url ||\n    (lat !== undefined && lon !== undefined\n      ? `https://www.google.com/maps?q=${lat},${lon}`\n      : '');\n  const osmUrl =\n    gps?.openstreetmap_url ||\n    (lat !== undefined && lon !== undefined\n      ? `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}#map=15/${lat}/${lon}`\n      : '');\n\n  // Simple map visualization (would use Leaflet/Mapbox for full implementation)\n  const MapPlaceholder = () => (\n    <div className=\"relative w-full h-full bg-gradient-to-br from-blue-100 via-green-50 to-blue-50 rounded-lg overflow-hidden\">\n      {/* Grid lines */}\n      <div\n        className=\"absolute inset-0\"\n        style={{\n          backgroundImage:\n            'linear-gradient(rgba(0,0,0,0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0,0,0,0.05) 1px, transparent 1px)',\n          backgroundSize: '20px 20px',\n        }}\n      />\n\n      {/* Location marker */}\n      {hasLocation && (\n        <div className=\"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2\">\n          <div className=\"relative\">\n            <div className=\"w-8 h-8 bg-red-500 rounded-full flex items-center justify-center shadow-lg\">\n              <MapPin className=\"w-5 h-5 text-white\" />\n            </div>\n            <div className=\"absolute -bottom-1 left-1/2 transform -translate-x-1/2 w-2 h-2 bg-red-500 rotate-45\" />\n          </div>\n        </div>\n      )}\n\n      {/* Compass */}\n      <div className=\"absolute top-3 right-3 w-8 h-8 bg-white/80 rounded-full flex items-center justify-center shadow\">\n        <Navigation\n          className=\"w-5 h-5 text-red-500\"\n          style={{ transform: 'rotate(45deg)' }}\n        />\n      </div>\n\n      {/* Scale */}\n      <div className=\"absolute bottom-3 left-3 flex items-center gap-1 bg-white/80 px-2 py-1 rounded text-xs\">\n        <div className=\"w-8 h-0.5 bg-gray-600\" />\n        <span>1 km</span>\n      </div>\n    </div>\n  );\n\n  if (!hasLocation) {\n    return (\n      <Card className=\"w-full\">\n        <CardHeader className=\"pb-2\">\n          <CardTitle className=\"text-lg flex items-center gap-2\">\n            <MapPin className=\"w-5 h-5\" />\n            Location\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"h-[200px] w-full bg-muted/50 rounded-lg flex items-center justify-center\">\n            <div className=\"text-center text-muted-foreground\">\n              <MapPin className=\"w-8 h-8 mx-auto mb-2 opacity-50\" />\n              <p>No GPS data available</p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className=\"w-full\">\n      <CardHeader className=\"pb-2\">\n        <CardTitle className=\"text-lg flex items-center gap-2\">\n          <MapPin className=\"w-5 h-5\" />\n          Location\n          <Badge variant=\"outline\" className=\"ml-2\">\n            {gps?.altitude_meters\n              ? `${gps.altitude_meters.toFixed(0)}m`\n              : 'Surface'}\n          </Badge>\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        {/* Map visualization */}\n        <div className=\"h-[200px] w-full mb-4\">\n          <MapPlaceholder />\n        </div>\n\n        {/* Coordinates */}\n        <div className=\"flex items-center gap-2 mb-3 p-3 rounded-lg bg-muted/50\">\n          <MapIcon className=\"w-4 h-4 text-muted-foreground\" />\n          <span className=\"font-mono text-sm\">\n            {formatCoordinates(lat, lon)}\n          </span>\n        </div>\n\n        {/* Additional info */}\n        <div className=\"grid grid-cols-2 gap-2 mb-3\">\n          {gps?.gps_speed !== undefined && (\n            <div className=\"p-2 rounded bg-muted/30\">\n              <div className=\"text-xs text-muted-foreground\">Speed</div>\n              <div className=\"font-mono text-sm\">\n                {(gps.gps_speed * 3.6).toFixed(1)} km/h\n              </div>\n            </div>\n          )}\n          {gps?.gps_direction !== undefined && (\n            <div className=\"p-2 rounded bg-muted/30\">\n              <div className=\"text-xs text-muted-foreground\">Direction</div>\n              <div className=\"font-mono text-sm\">\n                {gps.gps_direction.toFixed(0)}\n              </div>\n            </div>\n          )}\n          {gps?.gps_timestamp && (\n            <div className=\"p-2 rounded bg-muted/30 col-span-2\">\n              <div className=\"flex items-center gap-2\">\n                <Clock className=\"w-4 h-4 text-muted-foreground\" />\n                <span className=\"text-xs text-muted-foreground\">\n                  GPS time:{' '}\n                </span>\n                <span className=\"text-sm\">\n                  {getRelativeTime(gps.gps_timestamp)}\n                </span>\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Map links */}\n        <div className=\"flex gap-2\">\n          <Button asChild variant=\"outline\" size=\"sm\" className=\"flex-1\">\n            <a href={googleMapsUrl} target=\"_blank\" rel=\"noopener noreferrer\">\n              <MapPin className=\"w-4 h-4 mr-2\" />\n              Google Maps\n              <ExternalLink className=\"w-3 h-3 ml-1\" />\n            </a>\n          </Button>\n          <Button asChild variant=\"outline\" size=\"sm\" className=\"flex-1\">\n            <a href={osmUrl} target=\"_blank\" rel=\"noopener noreferrer\">\n              <Layers className=\"w-4 h-4 mr-2\" />\n              OpenStreetMap\n              <ExternalLink className=\"w-3 h-3 ml-1\" />\n            </a>\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/viz/ManipulationDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Zap' is defined but never used.","line":10,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":6},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1390,1393],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1390,1393],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// client/src/components/viz/ManipulationDashboard.tsx\nimport React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport {\n  ShieldAlert,\n  ShieldCheck,\n  Eye,\n  Zap,\n  FileWarning,\n  Activity,\n  Radar,\n  Cpu,\n  Search,\n} from 'lucide-react';\n\ninterface ManipulationDetection {\n  manipulation_probability?: number;\n  indicators?: string[];\n  jpeg_analysis?: {\n    compression_artifacts?: boolean;\n    recompression_detected?: boolean;\n  };\n  noise_analysis?: {\n    inconsistent_regions?: number;\n    confidence?: number;\n  };\n}\n\ninterface SteganographyAnalysis {\n  suspicious_score?: number;\n  methods_detected?: string[];\n  entropy_analysis?: {\n    score?: number;\n    suspicious_regions?: number;\n  };\n  lsb_analysis?: {\n    suspicious_channels?: string[];\n    confidence?: number;\n  };\n}\n\ninterface AIDetection {\n  ai_probability?: number;\n  detection_methods?: string[];\n  confidence?: number;\n  suspicious_patterns?: string[];\n}\n\ninterface ManipulationDashboardProps {\n  manipulation?: ManipulationDetection;\n  steganography?: SteganographyAnalysis;\n  ai_detection?: AIDetection;\n}\n\ninterface AnalysisCard {\n  title: string;\n  score: number;\n  status: 'safe' | 'suspicious' | 'warning';\n  description: string;\n  details: Record<string, any>;\n  icon: React.ReactNode;\n  color: string;\n}\n\nfunction getStatusColor(status: 'safe' | 'suspicious' | 'warning'): string {\n  switch (status) {\n    case 'safe':\n      return 'text-green-600';\n    case 'suspicious':\n      return 'text-amber-600';\n    case 'warning':\n      return 'text-red-600';\n  }\n}\n\nfunction getStatusBg(status: 'safe' | 'suspicious' | 'warning'): string {\n  switch (status) {\n    case 'safe':\n      return 'bg-green-100 text-green-800';\n    case 'suspicious':\n      return 'bg-amber-100 text-amber-800';\n    case 'warning':\n      return 'bg-red-100 text-red-800';\n  }\n}\n\nfunction getProbabilityStatus(\n  probability: number | undefined\n): 'safe' | 'suspicious' | 'warning' {\n  if (!probability) return 'safe';\n  if (probability < 30) return 'safe';\n  if (probability < 70) return 'suspicious';\n  return 'warning';\n}\n\nexport function ManipulationDashboard({\n  manipulation,\n  steganography,\n  ai_detection,\n}: ManipulationDashboardProps) {\n  const analysisCards: AnalysisCard[] = [\n    {\n      title: 'Manipulation Detection',\n      score: manipulation?.manipulation_probability || 0,\n      status: getProbabilityStatus(manipulation?.manipulation_probability),\n      description: 'Analysis of editing artifacts and inconsistencies',\n      details: {\n        'Compression artifacts': manipulation?.jpeg_analysis\n          ?.compression_artifacts\n          ? 'Detected'\n          : 'None',\n        Recompression: manipulation?.jpeg_analysis?.recompression_detected\n          ? 'Detected'\n          : 'Clean',\n        'Inconsistent regions':\n          manipulation?.noise_analysis?.inconsistent_regions || 0,\n        Confidence: `${manipulation?.noise_analysis?.confidence || 0}%`,\n      },\n      icon: <FileWarning className=\"w-5 h-5\" />,\n      color: 'text-orange-600',\n    },\n    {\n      title: 'Steganography',\n      score: steganography?.suspicious_score || 0,\n      status: getProbabilityStatus(steganography?.suspicious_score),\n      description: 'Hidden data detection analysis',\n      details: {\n        'Methods found': steganography?.methods_detected?.length || 0,\n        'Entropy score': steganography?.entropy_analysis?.score || 0,\n        'Suspicious regions':\n          steganography?.entropy_analysis?.suspicious_regions || 0,\n        'LSB analysis': steganography?.lsb_analysis?.confidence || 0,\n      },\n      icon: <Radar className=\"w-5 h-5\" />,\n      color: 'text-purple-600',\n    },\n    {\n      title: 'AI Generation Detection',\n      score: ai_detection?.ai_probability || 0,\n      status: getProbabilityStatus(ai_detection?.ai_probability),\n      description: 'AI-generated content probability',\n      details: {\n        'Detection methods': ai_detection?.detection_methods?.length || 0,\n        Confidence: `${ai_detection?.confidence || 0}%`,\n        'Patterns found': ai_detection?.suspicious_patterns?.length || 0,\n      },\n      icon: <Cpu className=\"w-5 h-5\" />,\n      color: 'text-blue-600',\n    },\n  ];\n\n  const overallScore = Math.round(\n    analysisCards.reduce((acc, card) => acc + card.score, 0) /\n      analysisCards.length\n  );\n\n  const overallStatus = getProbabilityStatus(overallScore);\n\n  return (\n    <Card className=\"w-full\">\n      <CardHeader className=\"pb-2\">\n        <CardTitle className=\"text-lg flex items-center gap-2\">\n          <Eye className=\"w-5 h-5\" />\n          Manipulation Analysis\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        {/* Overall Assessment */}\n        <div className=\"mb-6 p-4 rounded-lg bg-gradient-to-r from-muted/50 to-muted/30\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <div className=\"flex items-center gap-2\">\n              {overallStatus === 'safe' ? (\n                <ShieldCheck className=\"w-6 h-6 text-green-600\" />\n              ) : overallStatus === 'suspicious' ? (\n                <ShieldAlert className=\"w-6 h-6 text-amber-600\" />\n              ) : (\n                <ShieldAlert className=\"w-6 h-6 text-red-600\" />\n              )}\n              <div>\n                <div className=\"font-medium\">Overall Assessment</div>\n                <div className=\"text-sm text-muted-foreground\">\n                  {overallStatus === 'safe'\n                    ? 'No manipulation detected'\n                    : overallStatus === 'suspicious'\n                      ? 'Some anomalies detected'\n                      : 'High manipulation probability'}\n                </div>\n              </div>\n            </div>\n            <div className=\"text-right\">\n              <div\n                className={`text-2xl font-bold ${getStatusColor(overallStatus)}`}\n              >\n                {overallScore}%\n              </div>\n              <div className=\"text-xs text-muted-foreground\">Risk Score</div>\n            </div>\n          </div>\n          <Progress value={overallScore} className=\"h-2\" />\n        </div>\n\n        {/* Analysis Cards */}\n        <div className=\"space-y-4\">\n          {analysisCards.map(card => (\n            <div\n              key={card.title}\n              className={`p-4 rounded-lg border ${\n                card.status === 'safe'\n                  ? 'border-green-200 bg-green-50/30'\n                  : card.status === 'suspicious'\n                    ? 'border-amber-200 bg-amber-50/30'\n                    : 'border-red-200 bg-red-50/30'\n              }`}\n            >\n              <div className=\"flex items-start justify-between mb-3\">\n                <div className=\"flex items-center gap-2\">\n                  <div className={card.color}>{card.icon}</div>\n                  <div>\n                    <div className=\"font-medium\">{card.title}</div>\n                    <div className=\"text-xs text-muted-foreground\">\n                      {card.description}\n                    </div>\n                  </div>\n                </div>\n                <Badge className={getStatusBg(card.status)}>\n                  {card.score}%\n                </Badge>\n              </div>\n\n              {/* Mini progress bar */}\n              <Progress value={card.score} className=\"h-1 mb-3\" />\n\n              {/* Details grid */}\n              <div className=\"grid grid-cols-2 gap-2\">\n                {Object.entries(card.details).map(([key, value]) => (\n                  <div\n                    key={key}\n                    className=\"flex items-center gap-2 p-2 rounded bg-background/50\"\n                  >\n                    <Activity className=\"w-3 h-3 text-muted-foreground\" />\n                    <div>\n                      <div className=\"text-[10px] text-muted-foreground\">\n                        {key}\n                      </div>\n                      <div className=\"text-sm font-medium\">\n                        {typeof value === 'number'\n                          ? value.toString()\n                          : String(value)}\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n\n              {/* Indicators list */}\n              {card.title === 'Manipulation Detection' &&\n                manipulation?.indicators &&\n                manipulation.indicators.length > 0 && (\n                  <div className=\"mt-3 pt-3 border-t border-border/50\">\n                    <div className=\"text-xs text-muted-foreground mb-2\">\n                      Indicators found:\n                    </div>\n                    <div className=\"flex flex-wrap gap-1\">\n                      {manipulation.indicators.map((indicator, i) => (\n                        <Badge\n                          key={`indicator-${i}`}\n                          variant=\"outline\"\n                          className=\"text-xs\"\n                        >\n                          {indicator}\n                        </Badge>\n                      ))}\n                    </div>\n                  </div>\n                )}\n\n              {card.title === 'AI Generation Detection' &&\n                ai_detection?.suspicious_patterns &&\n                ai_detection.suspicious_patterns.length > 0 && (\n                  <div className=\"mt-3 pt-3 border-t border-border/50\">\n                    <div className=\"text-xs text-muted-foreground mb-2\">\n                      Suspicious patterns:\n                    </div>\n                    <div className=\"flex flex-wrap gap-1\">\n                      {ai_detection.suspicious_patterns.map((pattern, i) => (\n                        <Badge\n                          key={`pattern-${i}`}\n                          variant=\"outline\"\n                          className=\"text-xs\"\n                        >\n                          {pattern}\n                        </Badge>\n                      ))}\n                    </div>\n                  </div>\n                )}\n            </div>\n          ))}\n        </div>\n\n        {/* Info note */}\n        <div className=\"mt-4 p-3 rounded bg-muted/50 text-sm text-muted-foreground\">\n          <div className=\"flex items-start gap-2\">\n            <Search className=\"w-4 h-4 mt-0.5 flex-shrink-0\" />\n            <p>\n              This analysis is probabilistic and should be verified manually.\n              Low confidence results may require additional forensic tools for\n              confirmation.\n            </p>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/viz/MetadataComparison.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":11,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsContent' is defined but never used.","line":12,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileDiff' is defined but never used.","line":16,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RefreshCw' is defined but never used.","line":19,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Columns' is defined but never used.","line":20,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":10},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[596,599],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[596,599],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[694,697],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[694,697],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[780,783],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[780,783],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[795,798],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[795,798],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[910,913],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[910,913],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[952,955],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[952,955],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1913,1916],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1913,1916],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'viewMode' is assigned a value but never used.","line":83,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":83,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setViewMode' is assigned a value but never used.","line":83,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":83,"endColumn":31},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":155,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":155,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4571,4574],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4571,4574],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":15,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// client/src/components/viz/MetadataComparison.tsx\nimport React, { useState } from 'react';\nimport {\n  Card,\n  CardContent,\n  CardHeader,\n  CardTitle,\n  CardDescription,\n} from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport {\n  GitCompare,\n  ArrowRightLeft,\n  FileDiff,\n  Plus,\n  Minus,\n  RefreshCw,\n  Columns,\n} from 'lucide-react';\n\ninterface MetadataComparisonProps {\n  file1?: {\n    filename: string;\n    metadata: Record<string, any>;\n    thumbnail?: string;\n  };\n  file2?: {\n    filename: string;\n    metadata: Record<string, any>;\n    thumbnail?: string;\n  };\n}\n\ninterface DiffResult {\n  key: string;\n  value1: any;\n  value2: any;\n  status: 'added' | 'removed' | 'changed' | 'unchanged';\n}\n\nfunction compareMetadata(\n  meta1: Record<string, any> | undefined,\n  meta2: Record<string, any> | undefined\n): DiffResult[] {\n  if (!meta1 || !meta2) return [];\n\n  const allKeys = new Set([...Object.keys(meta1), ...Object.keys(meta2)]);\n  const results: DiffResult[] = [];\n\n  allKeys.forEach(key => {\n    const val1 = meta1[key];\n    const val2 = meta2[key];\n\n    if (val1 === undefined && val2 !== undefined) {\n      results.push({ key, value1: null, value2: val2, status: 'added' });\n    } else if (val1 !== undefined && val2 === undefined) {\n      results.push({ key, value1: val1, value2: null, status: 'removed' });\n    } else if (JSON.stringify(val1) !== JSON.stringify(val2)) {\n      results.push({ key, value1: val1, value2: val2, status: 'changed' });\n    } else {\n      results.push({ key, value1: val1, value2: val2, status: 'unchanged' });\n    }\n  });\n\n  return results.sort((a, b) => {\n    const order = { added: 0, removed: 1, changed: 2, unchanged: 3 };\n    return order[a.status] - order[b.status];\n  });\n}\n\nfunction formatValue(value: any): string {\n  if (value === null || value === undefined) return 'N/A';\n  if (typeof value === 'object') return JSON.stringify(value);\n  return String(value);\n}\n\nexport function MetadataComparison({ file1, file2 }: MetadataComparisonProps) {\n  const [filter, setFilter] = useState<'all' | 'changed' | 'added' | 'removed'>(\n    'all'\n  );\n  const [viewMode, setViewMode] = useState<'diff' | 'split'>('diff');\n\n  // Sample data if no files provided\n  const sampleMeta1 = file1?.metadata || {\n    DateTimeOriginal: '2024:03:15 14:30:00',\n    Make: 'Canon',\n    Model: 'EOS R5',\n    ISO: 400,\n    FNumber: 2.8,\n    FocalLength: 50,\n    Flash: 'No flash',\n    WhiteBalance: 'Auto',\n  };\n\n  const sampleMeta2 = file2?.metadata || {\n    DateTimeOriginal: '2024:03:15 14:30:05',\n    Make: 'Canon',\n    Model: 'EOS R5',\n    ISO: 800,\n    FNumber: 2.8,\n    FocalLength: 85,\n    Flash: 'Fired',\n    WhiteBalance: 'Manual',\n  };\n\n  const diffResults = compareMetadata(sampleMeta1, sampleMeta2);\n\n  const filteredDiff = diffResults.filter(\n    r => filter === 'all' || r.status === filter\n  );\n\n  const stats = {\n    total: diffResults.length,\n    changed: diffResults.filter(r => r.status === 'changed').length,\n    added: diffResults.filter(r => r.status === 'added').length,\n    removed: diffResults.filter(r => r.status === 'removed').length,\n  };\n\n  return (\n    <Card className=\"w-full\">\n      <CardHeader className=\"pb-2\">\n        <CardTitle className=\"text-lg flex items-center gap-2\">\n          <GitCompare className=\"w-5 h-5\" />\n          Metadata Comparison\n        </CardTitle>\n        <CardDescription>Compare metadata between two files</CardDescription>\n      </CardHeader>\n      <CardContent>\n        {/* File headers */}\n        <div className=\"flex items-center gap-4 mb-4\">\n          <div className=\"flex-1 p-3 rounded-lg bg-muted/50 text-center\">\n            <div className=\"font-medium truncate\">\n              {file1?.filename || 'File 1'}\n            </div>\n            <div className=\"text-xs text-muted-foreground\">\n              {Object.keys(sampleMeta1).length} fields\n            </div>\n          </div>\n          <ArrowRightLeft className=\"w-5 h-5 text-muted-foreground\" />\n          <div className=\"flex-1 p-3 rounded-lg bg-muted/50 text-center\">\n            <div className=\"font-medium truncate\">\n              {file2?.filename || 'File 2'}\n            </div>\n            <div className=\"text-xs text-muted-foreground\">\n              {Object.keys(sampleMeta2).length} fields\n            </div>\n          </div>\n        </div>\n\n        {/* Filter tabs */}\n        <Tabs\n          value={filter}\n          onValueChange={v => setFilter(v as any)}\n          className=\"mb-4\"\n        >\n          <TabsList className=\"grid w-full grid-cols-4\">\n            <TabsTrigger value=\"all\" className=\"flex items-center gap-1\">\n              All\n              <Badge variant=\"secondary\" className=\"text-xs\">\n                {stats.total}\n              </Badge>\n            </TabsTrigger>\n            <TabsTrigger value=\"changed\" className=\"flex items-center gap-1\">\n              Changed\n              <Badge variant=\"secondary\" className=\"text-xs\">\n                {stats.changed}\n              </Badge>\n            </TabsTrigger>\n            <TabsTrigger value=\"added\" className=\"flex items-center gap-1\">\n              Added\n              <Badge variant=\"secondary\" className=\"text-xs\">\n                {stats.added}\n              </Badge>\n            </TabsTrigger>\n            <TabsTrigger value=\"removed\" className=\"flex items-center gap-1\">\n              Removed\n              <Badge variant=\"secondary\" className=\"text-xs\">\n                {stats.removed}\n              </Badge>\n            </TabsTrigger>\n          </TabsList>\n        </Tabs>\n\n        {/* Diff view */}\n        <div className=\"space-y-2 max-h-[400px] overflow-y-auto\">\n          {filteredDiff.length === 0 ? (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              No differences found\n            </div>\n          ) : (\n            filteredDiff.map((diff, idx) => (\n              <div\n                key={`${diff.key}-${idx}`}\n                className={`p-3 rounded-lg border ${\n                  diff.status === 'changed'\n                    ? 'border-amber-200 bg-amber-50/50'\n                    : diff.status === 'added'\n                      ? 'border-green-200 bg-green-50/50'\n                      : diff.status === 'removed'\n                        ? 'border-red-200 bg-red-50/50'\n                        : 'border-muted bg-muted/30'\n                }`}\n              >\n                <div className=\"flex items-center gap-2 mb-1\">\n                  <Badge\n                    variant={\n                      diff.status === 'changed'\n                        ? 'secondary'\n                        : diff.status === 'added'\n                          ? 'default'\n                          : diff.status === 'removed'\n                            ? 'destructive'\n                            : 'outline'\n                    }\n                    className=\"text-xs\"\n                  >\n                    {diff.status === 'changed' && (\n                      <ArrowRightLeft className=\"w-3 h-3 mr-1\" />\n                    )}\n                    {diff.status === 'added' && (\n                      <Plus className=\"w-3 h-3 mr-1\" />\n                    )}\n                    {diff.status === 'removed' && (\n                      <Minus className=\"w-3 h-3 mr-1\" />\n                    )}\n                    {diff.status}\n                  </Badge>\n                  <span className=\"font-medium text-sm\">{diff.key}</span>\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4 mt-2\">\n                  <div className={diff.status === 'added' ? 'opacity-50' : ''}>\n                    <div className=\"text-xs text-muted-foreground\">File 1</div>\n                    <div className=\"font-mono text-sm\">\n                      {formatValue(diff.value1)}\n                    </div>\n                  </div>\n                  <div\n                    className={diff.status === 'removed' ? 'opacity-50' : ''}\n                  >\n                    <div className=\"text-xs text-muted-foreground\">File 2</div>\n                    <div className=\"font-mono text-sm\">\n                      {formatValue(diff.value2)}\n                    </div>\n                  </div>\n                </div>\n              </div>\n            ))\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/viz/PremiumTimeline.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used.","line":10,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronLeft' is defined but never used.","line":35,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronRight' is defined but never used.","line":36,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":15},{"ruleId":"jsx-a11y/no-static-element-interactions","severity":1,"message":"Avoid non-native interactive elements. If using native HTML is not possible, add an appropriate role and support for tabbing, mouse, keyboard, and touch inputs to an interactive content element.","line":985,"column":9,"nodeType":"JSXOpeningElement","endLine":993,"endColumn":10},{"ruleId":"jsx-a11y/click-events-have-key-events","severity":1,"message":"Visible, non-interactive elements with click handlers must have at least one keyboard listener.","line":1286,"column":11,"nodeType":"JSXOpeningElement","endLine":1289,"endColumn":12},{"ruleId":"jsx-a11y/no-static-element-interactions","severity":1,"message":"Avoid non-native interactive elements. If using native HTML is not possible, add an appropriate role and support for tabbing, mouse, keyboard, and touch inputs to an interactive content element.","line":1286,"column":11,"nodeType":"JSXOpeningElement","endLine":1289,"endColumn":12},{"ruleId":"jsx-a11y/click-events-have-key-events","severity":1,"message":"Visible, non-interactive elements with click handlers must have at least one keyboard listener.","line":1290,"column":13,"nodeType":"JSXOpeningElement","endLine":1293,"endColumn":14},{"ruleId":"jsx-a11y/no-static-element-interactions","severity":1,"message":"Avoid non-native interactive elements. If using native HTML is not possible, add an appropriate role and support for tabbing, mouse, keyboard, and touch inputs to an interactive content element.","line":1290,"column":13,"nodeType":"JSXOpeningElement","endLine":1293,"endColumn":14},{"ruleId":"jsx-a11y/click-events-have-key-events","severity":1,"message":"Visible, non-interactive elements with click handlers must have at least one keyboard listener.","line":1418,"column":11,"nodeType":"JSXOpeningElement","endLine":1421,"endColumn":12},{"ruleId":"jsx-a11y/no-static-element-interactions","severity":1,"message":"Avoid non-native interactive elements. If using native HTML is not possible, add an appropriate role and support for tabbing, mouse, keyboard, and touch inputs to an interactive content element.","line":1418,"column":11,"nodeType":"JSXOpeningElement","endLine":1421,"endColumn":12},{"ruleId":"jsx-a11y/click-events-have-key-events","severity":1,"message":"Visible, non-interactive elements with click handlers must have at least one keyboard listener.","line":1422,"column":13,"nodeType":"JSXOpeningElement","endLine":1425,"endColumn":14},{"ruleId":"jsx-a11y/no-static-element-interactions","severity":1,"message":"Avoid non-native interactive elements. If using native HTML is not possible, add an appropriate role and support for tabbing, mouse, keyboard, and touch inputs to an interactive content element.","line":1422,"column":13,"nodeType":"JSXOpeningElement","endLine":1425,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// client/src/components/viz/PremiumTimeline.tsx\nimport React, {\n  useState,\n  useRef,\n  useEffect,\n  useMemo,\n  useCallback,\n} from 'react';\nimport {\n  Calendar,\n  Edit3,\n  Eye,\n  FileText,\n  Camera,\n  ZoomIn,\n  ZoomOut,\n  Clock,\n  Search,\n  Filter,\n  Moon,\n  Sun,\n  Download,\n  Play,\n  Pause,\n  SkipBack,\n  SkipForward,\n  Layers,\n  ArrowUpDown,\n  BarChart3,\n  FileImage,\n  FileType,\n  File,\n  X,\n  Check,\n  ChevronLeft,\n  ChevronRight,\n} from 'lucide-react';\n\ninterface TimelineEvent {\n  id: string;\n  type: 'taken' | 'created' | 'modified' | 'accessed';\n  date: Date;\n  file: FileData;\n}\n\ninterface FileData {\n  id: number;\n  filename: string;\n  type: 'image' | 'document' | 'text' | 'video' | 'audio';\n  icon: React.ComponentType<{ className?: string }>;\n  created: Date;\n  modified: Date;\n  accessed: Date;\n  dateTaken?: Date;\n  size: string;\n  sizeBytes: number;\n  dimensions?: string;\n  pages?: number;\n  location?: string;\n  camera?: string;\n  author?: string;\n  tags?: string[];\n}\n\ninterface PremiumTimelineProps {\n  files?: FileData[];\n  onFileSelect?: (file: FileData) => void;\n}\n\nconst defaultFiles: FileData[] = [\n  {\n    id: 1,\n    filename: 'summer_vacation_2024.jpg',\n    type: 'image',\n    icon: FileImage,\n    created: new Date('2024-07-15T14:30:00'),\n    modified: new Date('2024-08-22T09:15:00'),\n    accessed: new Date('2025-01-03T16:45:00'),\n    dateTaken: new Date('2024-07-15T14:28:30'),\n    size: '4.2 MB',\n    sizeBytes: 4404019,\n    dimensions: '4032x3024',\n    location: 'Maldives',\n    camera: 'iPhone 15 Pro',\n    tags: ['vacation', 'beach', 'summer'],\n  },\n  {\n    id: 2,\n    filename: 'project_report.pdf',\n    type: 'document',\n    icon: FileType,\n    created: new Date('2024-09-10T10:00:00'),\n    modified: new Date('2024-12-15T14:30:00'),\n    accessed: new Date('2025-01-04T11:20:00'),\n    size: '1.8 MB',\n    sizeBytes: 1887436,\n    pages: 24,\n    author: 'John Doe',\n    tags: ['work', 'report', 'Q4'],\n  },\n  {\n    id: 3,\n    filename: 'meeting_notes.txt',\n    type: 'text',\n    icon: FileText,\n    created: new Date('2024-11-20T09:00:00'),\n    modified: new Date('2024-11-20T17:45:00'),\n    accessed: new Date('2025-01-02T08:30:00'),\n    size: '12 KB',\n    sizeBytes: 12288,\n    tags: ['meeting', 'notes'],\n  },\n  {\n    id: 4,\n    filename: 'family_photo.jpg',\n    type: 'image',\n    icon: FileImage,\n    created: new Date('2024-12-25T18:00:00'),\n    modified: new Date('2024-12-25T18:00:00'),\n    accessed: new Date('2025-01-04T20:15:00'),\n    dateTaken: new Date('2024-12-25T17:58:00'),\n    size: '3.8 MB',\n    sizeBytes: 3984588,\n    dimensions: '3840x2160',\n    location: 'Home',\n    camera: 'Canon EOS R5',\n    tags: ['family', 'christmas', 'holiday'],\n  },\n  {\n    id: 5,\n    filename: 'presentation.pptx',\n    type: 'document',\n    icon: FileType,\n    created: new Date('2024-10-05T08:00:00'),\n    modified: new Date('2024-11-28T16:30:00'),\n    accessed: new Date('2025-01-03T09:00:00'),\n    size: '5.2 MB',\n    sizeBytes: 5452595,\n    pages: 32,\n    author: 'Jane Smith',\n    tags: ['presentation', 'work', 'Q3'],\n  },\n  {\n    id: 6,\n    filename: 'budget_2024.xlsx',\n    type: 'document',\n    icon: File,\n    created: new Date('2024-01-15T10:00:00'),\n    modified: new Date('2024-12-30T15:45:00'),\n    accessed: new Date('2025-01-05T08:00:00'),\n    size: '856 KB',\n    sizeBytes: 876544,\n    author: 'Finance Team',\n    tags: ['budget', 'finance', '2024'],\n  },\n];\n\nconst dateTypeInfo: Record<\n  string,\n  {\n    label: string;\n    icon: React.ComponentType<{ className?: string }>;\n    color: string;\n    textColor: string;\n    bgLight: string;\n    border: string;\n    ring: string;\n  }\n> = {\n  taken: {\n    label: 'Date Taken',\n    icon: Camera,\n    color: 'bg-purple-500 dark:bg-purple-600',\n    textColor: 'text-purple-500',\n    bgLight: 'bg-purple-50 dark:bg-purple-900/30',\n    border: 'border-purple-200 dark:border-purple-700',\n    ring: 'ring-purple-400',\n  },\n  created: {\n    label: 'Created',\n    icon: FileText,\n    color: 'bg-blue-500 dark:bg-blue-600',\n    textColor: 'text-blue-500',\n    bgLight: 'bg-blue-50 dark:bg-blue-900/30',\n    border: 'border-blue-200 dark:border-blue-700',\n    ring: 'ring-blue-400',\n  },\n  modified: {\n    label: 'Modified',\n    icon: Edit3,\n    color: 'bg-amber-500 dark:bg-amber-600',\n    textColor: 'text-amber-500',\n    bgLight: 'bg-amber-50 dark:bg-amber-900/30',\n    border: 'border-amber-200 dark:border-amber-700',\n    ring: 'ring-amber-400',\n  },\n  accessed: {\n    label: 'Last Accessed',\n    icon: Eye,\n    color: 'bg-green-500 dark:bg-green-600',\n    textColor: 'text-green-500',\n    bgLight: 'bg-green-50 dark:bg-green-900/30',\n    border: 'border-green-200 dark:border-green-700',\n    ring: 'ring-green-400',\n  },\n};\n\nfunction formatDate(date: Date, format: 'full' | 'short' = 'full'): string {\n  if (format === 'short') {\n    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\n  }\n  return date.toLocaleString('en-US', {\n    year: 'numeric',\n    month: 'short',\n    day: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit',\n  });\n}\n\nfunction formatRelative(date: Date): string {\n  const now = new Date();\n  const diffMs = now.getTime() - date.getTime();\n  const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\n\n  if (diffDays === 0) return 'Today';\n  if (diffDays === 1) return 'Yesterday';\n  if (diffDays < 7) return `${diffDays} days ago`;\n  if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;\n  if (diffDays < 365) return `${Math.floor(diffDays / 30)} months ago`;\n  return `${Math.floor(diffDays / 365)} years ago`;\n}\n\nfunction formatFileSize(bytes: number): string {\n  if (bytes < 1024) return `${bytes} B`;\n  if (bytes < 1048576) return `${(bytes / 1024).toFixed(1)} KB`;\n  if (bytes < 1073741824) return `${(bytes / 1048576).toFixed(1)} MB`;\n  return `${(bytes / 1073741824).toFixed(2)} GB`;\n}\n\nexport function PremiumTimeline({\n  files = defaultFiles,\n  onFileSelect,\n}: PremiumTimelineProps) {\n  const [darkMode, setDarkMode] = useState(false);\n  const [fileMode, setFileMode] = useState<'single' | 'all'>('single');\n  const [selectedFileIdx, setSelectedFileIdx] = useState(0);\n  const [zoomLevel, setZoomLevel] = useState(1);\n  const [panOffset, setPanOffset] = useState(0);\n  const [isDragging, setIsDragging] = useState(false);\n  const [dragStart, setDragStart] = useState({ x: 0, offset: 0 });\n  const [hoveredPoint, setHoveredPoint] = useState<string | null>(null);\n  const [selectedPoints, setSelectedPoints] = useState<string[]>([]);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [showFilters, setShowFilters] = useState(false);\n  const [filters, setFilters] = useState<{\n    types: Array<'taken' | 'created' | 'modified' | 'accessed'>;\n    fileTypes: Array<'image' | 'document' | 'text'>;\n  }>({\n    types: ['taken', 'created', 'modified', 'accessed'],\n    fileTypes: ['image', 'document', 'text'],\n  });\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [playbackSpeed, setPlaybackSpeed] = useState(1);\n  const [currentPlayIndex, setCurrentPlayIndex] = useState(0);\n  const [showStats, setShowStats] = useState(false);\n  const [groupBy, setGroupBy] = useState<\n    'none' | 'day' | 'week' | 'month' | 'year'\n  >('none');\n  const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('asc');\n  const [detailModal, setDetailModal] = useState<TimelineEvent | null>(null);\n  const [dateRangeStart, setDateRangeStart] = useState('');\n  const [dateRangeEnd, setDateRangeEnd] = useState('');\n  const [showExportMenu, setShowExportMenu] = useState(false);\n  const [comparisonMode, setComparisonMode] = useState(false);\n  const [compareFiles, setCompareFiles] = useState([0, 1]);\n\n  const timelineRef = useRef<HTMLDivElement>(null);\n  const playIntervalRef = useRef<NodeJS.Timeout | null>(null);\n\n  const allTimelinePoints: TimelineEvent[] = useMemo(() => {\n    const points: TimelineEvent[] = [];\n    const filesToProcess =\n      fileMode === 'single' ? [files[selectedFileIdx]] : files;\n\n    filesToProcess.forEach(file => {\n      if (\n        !filters.fileTypes.includes(file.type as 'image' | 'document' | 'text')\n      )\n        return;\n      if (\n        searchQuery &&\n        !file.filename.toLowerCase().includes(searchQuery.toLowerCase()) &&\n        !file.tags?.some(t =>\n          t.toLowerCase().includes(searchQuery.toLowerCase())\n        )\n      )\n        return;\n\n      const addPoint = (\n        date: Date,\n        type: 'taken' | 'created' | 'modified' | 'accessed'\n      ) => {\n        if (!filters.types.includes(type)) return;\n        if (dateRangeStart && date < new Date(dateRangeStart)) return;\n        if (dateRangeEnd && date > new Date(dateRangeEnd + 'T23:59:59')) return;\n        points.push({ date, type, file, id: `${file.id}-${type}` });\n      };\n\n      if (file.dateTaken) addPoint(file.dateTaken, 'taken');\n      addPoint(file.created, 'created');\n      addPoint(file.modified, 'modified');\n      addPoint(file.accessed, 'accessed');\n    });\n\n    points.sort((a, b) =>\n      sortOrder === 'asc'\n        ? a.date.getTime() - b.date.getTime()\n        : b.date.getTime() - a.date.getTime()\n    );\n    return points;\n  }, [\n    files,\n    fileMode,\n    selectedFileIdx,\n    filters,\n    searchQuery,\n    sortOrder,\n    dateRangeStart,\n    dateRangeEnd,\n  ]);\n\n  const { minDate, maxDate, timeRange } = useMemo(() => {\n    if (allTimelinePoints.length === 0) {\n      const now = new Date();\n      return { minDate: now, maxDate: now, timeRange: 1 };\n    }\n    const dates = allTimelinePoints.map(p => p.date);\n    const min = new Date(Math.min(...dates.map(d => d.getTime())));\n    const max = new Date(Math.max(...dates.map(d => d.getTime())));\n    return {\n      minDate: min,\n      maxDate: max,\n      timeRange: max.getTime() - min.getTime() || 1,\n    };\n  }, [allTimelinePoints]);\n\n  const stats = useMemo(() => {\n    const totalFiles = new Set(allTimelinePoints.map(p => p.file.id)).size;\n    const totalEvents = allTimelinePoints.length;\n    const byType: Record<string, number> = {};\n    let totalSize = 0;\n\n    allTimelinePoints.forEach(p => {\n      byType[p.type] = (byType[p.type] || 0) + 1;\n      totalSize += p.file.sizeBytes || 0;\n    });\n\n    const daysSpan = Math.ceil(timeRange / (1000 * 60 * 60 * 24));\n    return { totalFiles, totalEvents, byType, totalSize, daysSpan };\n  }, [allTimelinePoints, timeRange]);\n\n  const getPosition = useCallback(\n    (date: Date) => {\n      const basePos = ((date.getTime() - minDate.getTime()) / timeRange) * 100;\n      return basePos * zoomLevel + panOffset;\n    },\n    [minDate, timeRange, zoomLevel, panOffset]\n  );\n\n  const handleZoom = (delta: number) => {\n    setZoomLevel(prev => Math.max(0.5, Math.min(5, prev + delta)));\n  };\n\n  const handleWheel = (e: React.WheelEvent) => {\n    if (e.ctrlKey || e.metaKey) {\n      e.preventDefault();\n      handleZoom(e.deltaY > 0 ? -0.1 : 0.1);\n    } else {\n      setPanOffset(prev => prev - e.deltaY * 0.1);\n    }\n  };\n\n  const handleMouseDown = (e: React.MouseEvent) => {\n    if (e.button === 0) {\n      setIsDragging(true);\n      setDragStart({ x: e.clientX, offset: panOffset });\n    }\n  };\n\n  const handleMouseMove = (e: React.MouseEvent) => {\n    if (isDragging) {\n      const delta = e.clientX - dragStart.x;\n      setPanOffset(dragStart.offset + delta * 0.2);\n    }\n  };\n\n  const handleMouseUp = () => setIsDragging(false);\n\n  const handlePointClick = (point: TimelineEvent, e: React.MouseEvent) => {\n    if (e.shiftKey) {\n      setSelectedPoints(prev =>\n        prev.includes(point.id)\n          ? prev.filter(id => id !== point.id)\n          : [...prev, point.id]\n      );\n    } else if (e.ctrlKey || e.metaKey) {\n      setDetailModal(point);\n    } else {\n      setSelectedPoints([point.id]);\n    }\n  };\n\n  useEffect(() => {\n    if (isPlaying && allTimelinePoints.length > 0) {\n      playIntervalRef.current = setInterval(() => {\n        setCurrentPlayIndex(prev => {\n          if (prev >= allTimelinePoints.length - 1) {\n            setIsPlaying(false);\n            return 0;\n          }\n          return prev + 1;\n        });\n      }, 1000 / playbackSpeed);\n    } else {\n      if (playIntervalRef.current) clearInterval(playIntervalRef.current);\n    }\n    return () => {\n      if (playIntervalRef.current) clearInterval(playIntervalRef.current);\n    };\n  }, [isPlaying, playbackSpeed, allTimelinePoints.length]);\n\n  useEffect(() => {\n    if (isPlaying && allTimelinePoints[currentPlayIndex]) {\n      setSelectedPoints([allTimelinePoints[currentPlayIndex].id]);\n    }\n  }, [currentPlayIndex, isPlaying, allTimelinePoints]);\n\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (\n        e.target instanceof HTMLInputElement ||\n        e.target instanceof HTMLTextAreaElement\n      )\n        return;\n\n      switch (e.key) {\n        case '+':\n        case '=':\n          handleZoom(0.2);\n          break;\n        case '-':\n          handleZoom(-0.2);\n          break;\n        case '0':\n          setZoomLevel(1);\n          setPanOffset(0);\n          break;\n        case ' ':\n          e.preventDefault();\n          setIsPlaying(p => !p);\n          break;\n        case 'ArrowLeft':\n          setPanOffset(p => p + 50);\n          break;\n        case 'ArrowRight':\n          setPanOffset(p => p - 50);\n          break;\n        case 'd':\n          setDarkMode(d => !d);\n          break;\n        case 'f':\n          setShowFilters(f => !f);\n          break;\n        case 's':\n          setShowStats(s => !s);\n          break;\n        case 'Escape':\n          setDetailModal(null);\n          setSelectedPoints([]);\n          break;\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, []);\n\n  const theme = {\n    bg: darkMode\n      ? 'bg-gray-900'\n      : 'bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50',\n    card: darkMode\n      ? 'bg-gray-800 border-gray-700'\n      : 'bg-white/80 backdrop-blur border-white/50',\n    text: darkMode ? 'text-gray-100' : 'text-gray-800',\n    textMuted: darkMode ? 'text-gray-400' : 'text-gray-500',\n    border: darkMode ? 'border-gray-700' : 'border-gray-200',\n    hover: darkMode ? 'hover:bg-gray-700' : 'hover:bg-gray-100',\n    input: darkMode\n      ? 'bg-gray-700 border-gray-600 text-white'\n      : 'bg-white border-gray-300',\n    accent: 'bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500',\n  };\n\n  const exportData = (format: 'json' | 'csv') => {\n    const data = allTimelinePoints.map(p => ({\n      file: p.file.filename,\n      type: p.type,\n      date: p.date.toISOString(),\n      size: p.file.size,\n    }));\n\n    if (format === 'json') {\n      const blob = new Blob([JSON.stringify(data, null, 2)], {\n        type: 'application/json',\n      });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = 'timeline-export.json';\n      a.click();\n    } else {\n      const csv = ['File,Type,Date,Size']\n        .concat(\n          allTimelinePoints.map(\n            p =>\n              `\"${p.file.filename}\",${p.type},\"${p.date.toISOString()}\",\"${p.file.size}\"`\n          )\n        )\n        .join('\\n');\n      const blob = new Blob([csv], { type: 'text/csv' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = 'timeline-export.csv';\n      a.click();\n    }\n    setShowExportMenu(false);\n  };\n\n  const currentFile = files[selectedFileIdx];\n\n  return (\n    <div\n      className={`w-full min-h-screen ${theme.bg} p-4 md:p-8 transition-colors duration-300`}\n    >\n      <div className=\"max-w-7xl mx-auto space-y-6\">\n        {/* Header */}\n        <div className={`${theme.card} rounded-2xl shadow-xl border p-6`}>\n          <div className=\"flex flex-wrap items-center justify-between gap-4\">\n            <div>\n              <h1\n                className={`text-3xl font-bold ${theme.text} flex items-center gap-3`}\n              >\n                <div\n                  className={`w-10 h-10 ${theme.accent} rounded-xl flex items-center justify-center`}\n                >\n                  <Clock className=\"w-6 h-6 text-white\" />\n                </div>\n                Premium Timeline Explorer\n              </h1>\n              <p className={`${theme.textMuted} mt-1`}>\n                Interactive file metadata visualization {' '}\n                {allTimelinePoints.length} events across {stats.totalFiles}{' '}\n                files\n              </p>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <button\n                type=\"button\"\n                onClick={() => setDarkMode(!darkMode)}\n                className={`p-2.5 rounded-xl ${theme.hover} ${theme.text} transition-all`}\n              >\n                {darkMode ? (\n                  <Sun className=\"w-5 h-5\" />\n                ) : (\n                  <Moon className=\"w-5 h-5\" />\n                )}\n              </button>\n              <button\n                type=\"button\"\n                onClick={() => setShowStats(!showStats)}\n                className={`p-2.5 rounded-xl ${showStats ? 'bg-indigo-500 text-white' : theme.hover + ' ' + theme.text} transition-all`}\n              >\n                <BarChart3 className=\"w-5 h-5\" />\n              </button>\n              <button\n                type=\"button\"\n                onClick={() => setShowFilters(!showFilters)}\n                className={`p-2.5 rounded-xl ${showFilters ? 'bg-indigo-500 text-white' : theme.hover + ' ' + theme.text} transition-all`}\n              >\n                <Filter className=\"w-5 h-5\" />\n              </button>\n              <div className=\"relative\">\n                <button\n                  type=\"button\"\n                  onClick={() => setShowExportMenu(!showExportMenu)}\n                  className={`p-2.5 rounded-xl ${showExportMenu ? 'bg-indigo-500 text-white' : theme.hover + ' ' + theme.text} transition-all`}\n                >\n                  <Download className=\"w-5 h-5\" />\n                </button>\n                {showExportMenu && (\n                  <div\n                    className={`absolute right-0 top-12 ${theme.card} rounded-xl shadow-2xl border p-2 z-50 min-w-[160px]`}\n                  >\n                    <button\n                      type=\"button\"\n                      onClick={() => exportData('json')}\n                      className={`w-full text-left px-4 py-2 rounded-lg ${theme.hover} ${theme.text} text-sm block`}\n                    >\n                       Export as JSON\n                    </button>\n                    <button\n                      type=\"button\"\n                      onClick={() => exportData('csv')}\n                      className={`w-full text-left px-4 py-2 rounded-lg ${theme.hover} ${theme.text} text-sm block`}\n                    >\n                       Export as CSV\n                    </button>\n                  </div>\n                )}\n              </div>\n              <button\n                type=\"button\"\n                onClick={() => setComparisonMode(!comparisonMode)}\n                className={`p-2.5 rounded-xl ${comparisonMode ? 'bg-pink-500 text-white' : theme.hover + ' ' + theme.text} transition-all`}\n              >\n                <Layers className=\"w-5 h-5\" />\n              </button>\n            </div>\n          </div>\n          <div className=\"mt-4 relative\">\n            <Search\n              className={`absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 ${theme.textMuted}`}\n            />\n            <input\n              type=\"text\"\n              id=\"search\"\n              placeholder=\"Search files by name or tags...\"\n              value={searchQuery}\n              onChange={e => setSearchQuery(e.target.value)}\n              className={`w-full pl-12 pr-4 py-3 rounded-xl ${theme.input} border focus:ring-2 focus:ring-indigo-500 transition-all`}\n            />\n          </div>\n        </div>\n\n        {/* Filters Panel */}\n        {showFilters && (\n          <div\n            className={`${theme.card} rounded-2xl shadow-xl border p-6 animate-in slide-in-from-top-2`}\n          >\n            <h3\n              className={`font-semibold ${theme.text} mb-4 flex items-center gap-2`}\n            >\n              <Filter className=\"w-4 h-4\" /> Filters\n            </h3>\n            <div className=\"grid md:grid-cols-3 gap-6\">\n              <div>\n                <label\n                  className={`text-sm font-medium ${theme.textMuted} mb-2 block`}\n                >\n                  Event Types\n                </label>\n                <div className=\"flex flex-wrap gap-2\">\n                  {(\n                    Object.entries(dateTypeInfo) as [\n                      string,\n                      (typeof dateTypeInfo)[string],\n                    ][]\n                  ).map(([type, info]) => (\n                    <button\n                      type=\"button\"\n                      key={type}\n                      onClick={() =>\n                        setFilters(f => ({\n                          types: f.types.includes(\n                            type as\n                              | 'taken'\n                              | 'created'\n                              | 'modified'\n                              | 'accessed'\n                          )\n                            ? f.types.filter(t => t !== type)\n                            : [\n                                ...f.types,\n                                type as\n                                  | 'taken'\n                                  | 'created'\n                                  | 'modified'\n                                  | 'accessed',\n                              ],\n                          fileTypes: f.fileTypes,\n                        }))\n                      }\n                      className={`px-3 py-1.5 rounded-lg text-sm font-medium flex items-center gap-1.5 transition-all ${filters.types.includes(type as 'taken' | 'created' | 'modified' | 'accessed') ? info.color + ' text-white' : `${theme.hover} ${theme.text} border ${theme.border}`}`}\n                    >\n                      <info.icon className=\"w-3.5 h-3.5\" />\n                      {info.label}\n                    </button>\n                  ))}\n                </div>\n              </div>\n              <div>\n                <label\n                  className={`text-sm font-medium ${theme.textMuted} mb-2 block`}\n                >\n                  File Types\n                </label>\n                <div className=\"flex flex-wrap gap-2\">\n                  {(['image', 'document', 'text'] as const).map(type => (\n                    <button\n                      type=\"button\"\n                      key={type}\n                      onClick={() =>\n                        setFilters(f => ({\n                          types: f.types,\n                          fileTypes: f.fileTypes.includes(type)\n                            ? f.fileTypes.filter(t => t !== type)\n                            : [...f.fileTypes, type],\n                        }))\n                      }\n                      className={`px-3 py-1.5 rounded-lg text-sm font-medium capitalize transition-all ${filters.fileTypes.includes(type) ? 'bg-indigo-500 text-white' : `${theme.hover} ${theme.text} border ${theme.border}`}`}\n                    >\n                      {type}\n                    </button>\n                  ))}\n                </div>\n              </div>\n              <div>\n                <label\n                  className={`text-sm font-medium ${theme.textMuted} mb-2 block`}\n                >\n                  Group By\n                </label>\n                <div className=\"flex flex-wrap gap-2\">\n                  {(['none', 'day', 'week', 'month', 'year'] as const).map(\n                    g => (\n                      <button\n                        type=\"button\"\n                        key={g}\n                        onClick={() => setGroupBy(g)}\n                        className={`px-3 py-1.5 rounded-lg text-sm font-medium capitalize transition-all ${groupBy === g ? 'bg-indigo-500 text-white' : `${theme.hover} ${theme.text} border ${theme.border}`}`}\n                      >\n                        {g === 'none' ? 'None' : g}\n                      </button>\n                    )\n                  )}\n                </div>\n              </div>\n            </div>\n            <div className=\"mt-4 pt-4 border-t border-dashed border-gray-300\">\n              <label\n                className={`text-sm font-medium ${theme.textMuted} mb-2 block`}\n              >\n                Date Range\n              </label>\n              <div className=\"flex flex-wrap items-center gap-3\">\n                <input\n                  type=\"date\"\n                  id=\"dateStart\"\n                  value={dateRangeStart}\n                  onChange={e => setDateRangeStart(e.target.value)}\n                  className={`px-3 py-2 rounded-lg ${theme.input} border text-sm`}\n                />\n                <span className={theme.textMuted}>to</span>\n                <input\n                  type=\"date\"\n                  id=\"dateEnd\"\n                  value={dateRangeEnd}\n                  onChange={e => setDateRangeEnd(e.target.value)}\n                  className={`px-3 py-2 rounded-lg ${theme.input} border text-sm`}\n                />\n                {(dateRangeStart || dateRangeEnd) && (\n                  <button\n                    type=\"button\"\n                    onClick={() => {\n                      setDateRangeStart('');\n                      setDateRangeEnd('');\n                    }}\n                    className={`px-3 py-2 rounded-lg ${theme.hover} ${theme.text} text-sm`}\n                  >\n                    Clear\n                  </button>\n                )}\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Stats Panel */}\n        {showStats && (\n          <div\n            className={`${theme.card} rounded-2xl shadow-xl border p-6 animate-in slide-in-from-top-2`}\n          >\n            <h3\n              className={`font-semibold ${theme.text} mb-4 flex items-center gap-2`}\n            >\n              <BarChart3 className=\"w-4 h-4\" /> Statistics\n            </h3>\n            <div className=\"grid grid-cols-2 md:grid-cols-5 gap-4\">\n              {[\n                {\n                  label: 'Files',\n                  value: stats.totalFiles,\n                  color: 'from-blue-500 to-cyan-500',\n                },\n                {\n                  label: 'Events',\n                  value: stats.totalEvents,\n                  color: 'from-purple-500 to-pink-500',\n                },\n                {\n                  label: 'Days Span',\n                  value: stats.daysSpan,\n                  color: 'from-amber-500 to-orange-500',\n                },\n                {\n                  label: 'Total Size',\n                  value: formatFileSize(stats.totalSize),\n                  color: 'from-green-500 to-emerald-500',\n                },\n                {\n                  label: 'By Type',\n                  value: null,\n                  color: 'from-indigo-500 to-purple-500',\n                  isHtml: true,\n                },\n              ].map((stat, i) => (\n                <div\n                  key={i}\n                  className={`p-4 rounded-xl ${darkMode ? 'bg-gray-700/50' : 'bg-gray-100'}`}\n                >\n                  {stat.isHtml ? (\n                    <div className=\"flex gap-2 justify-center\">\n                      {Object.entries(stats.byType).map(([t, c]) => (\n                        <div\n                          key={t}\n                          className={`w-6 h-6 ${dateTypeInfo[t]?.color} rounded-full flex items-center justify-center text-xs text-white font-bold`}\n                        >\n                          {c}\n                        </div>\n                      ))}\n                    </div>\n                  ) : (\n                    <div\n                      className={`text-2xl font-bold bg-gradient-to-r ${stat.color} bg-clip-text text-transparent`}\n                    >\n                      {stat.value}\n                    </div>\n                  )}\n                  <div className={`text-sm ${theme.textMuted} mt-1`}>\n                    {stat.label}\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Controls Bar */}\n        <div className={`${theme.card} rounded-2xl shadow-xl border p-4`}>\n          <div className=\"flex flex-wrap items-center justify-between gap-4\">\n            <div className=\"flex items-center gap-2\">\n              <div\n                className={`flex rounded-xl p-1 ${darkMode ? 'bg-gray-700' : 'bg-gray-100'}`}\n              >\n                {[\n                  { id: 'single', label: 'Single', icon: FileText },\n                  { id: 'all', label: 'All Files', icon: Layers },\n                ].map(mode => (\n                  <button\n                    type=\"button\"\n                    key={mode.id}\n                    onClick={() => {\n                      setFileMode(mode.id as 'single' | 'all');\n                      setCurrentPlayIndex(0);\n                    }}\n                    className={`px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 transition-all ${fileMode === mode.id ? 'bg-indigo-500 text-white shadow-md' : `${theme.text} ${theme.hover}`}`}\n                  >\n                    <mode.icon className=\"w-4 h-4\" />\n                    {mode.label}\n                  </button>\n                ))}\n              </div>\n              {fileMode === 'single' && (\n                <select\n                  value={selectedFileIdx}\n                  onChange={e => {\n                    setSelectedFileIdx(Number(e.target.value));\n                    setCurrentPlayIndex(0);\n                  }}\n                  className={`px-4 py-2 rounded-xl ${theme.input} border text-sm`}\n                >\n                  {files.map((file, idx) => (\n                    <option key={idx} value={idx}>\n                      {file.filename}\n                    </option>\n                  ))}\n                </select>\n              )}\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <button\n                type=\"button\"\n                onClick={() => handleZoom(-0.2)}\n                className={`p-2 rounded-lg ${theme.hover} ${theme.text}`}\n              >\n                <ZoomOut className=\"w-5 h-5\" />\n              </button>\n              <div\n                className={`px-3 py-1 rounded-lg ${darkMode ? 'bg-gray-700' : 'bg-gray-100'} ${theme.text} text-sm font-mono min-w-[4rem] text-center`}\n              >\n                {Math.round(zoomLevel * 100)}%\n              </div>\n              <button\n                type=\"button\"\n                onClick={() => handleZoom(0.2)}\n                className={`p-2 rounded-lg ${theme.hover} ${theme.text}`}\n              >\n                <ZoomIn className=\"w-5 h-5\" />\n              </button>\n              <button\n                type=\"button\"\n                onClick={() => {\n                  setZoomLevel(1);\n                  setPanOffset(0);\n                }}\n                className={`px-3 py-2 rounded-lg ${theme.hover} ${theme.text} text-sm`}\n              >\n                Reset\n              </button>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <button\n                type=\"button\"\n                onClick={() => setCurrentPlayIndex(0)}\n                className={`p-2 rounded-lg ${theme.hover} ${theme.text}`}\n              >\n                <SkipBack className=\"w-5 h-5\" />\n              </button>\n              <button\n                type=\"button\"\n                onClick={() => setIsPlaying(!isPlaying)}\n                className={`p-3 rounded-xl ${isPlaying ? 'bg-red-500 text-white' : 'bg-indigo-500 text-white'}`}\n              >\n                {isPlaying ? (\n                  <Pause className=\"w-5 h-5\" />\n                ) : (\n                  <Play className=\"w-5 h-5\" />\n                )}\n              </button>\n              <button\n                type=\"button\"\n                onClick={() =>\n                  setCurrentPlayIndex(Math.max(0, allTimelinePoints.length - 1))\n                }\n                className={`p-2 rounded-lg ${theme.hover} ${theme.text}`}\n              >\n                <SkipForward className=\"w-5 h-5\" />\n              </button>\n              <select\n                value={playbackSpeed}\n                onChange={e => setPlaybackSpeed(Number(e.target.value))}\n                className={`px-2 py-1 rounded-lg ${theme.input} border text-sm`}\n              >\n                <option value={0.5}>0.5x</option>\n                <option value={1}>1x</option>\n                <option value={2}>2x</option>\n                <option value={4}>4x</option>\n              </select>\n            </div>\n            <button\n              type=\"button\"\n              onClick={() => setSortOrder(o => (o === 'asc' ? 'desc' : 'asc'))}\n              className={`px-4 py-2 rounded-xl flex items-center gap-2 ${theme.hover} ${theme.text} text-sm`}\n            >\n              <ArrowUpDown className=\"w-4 h-4\" />\n              {sortOrder === 'asc' ? 'Oldest First' : 'Newest First'}\n            </button>\n          </div>\n        </div>\n\n        {/* Main Timeline */}\n        <div\n          ref={timelineRef}\n          onWheel={handleWheel}\n          onMouseDown={handleMouseDown}\n          onMouseMove={handleMouseMove}\n          onMouseUp={handleMouseUp}\n          onMouseLeave={handleMouseUp}\n          className={`${theme.card} rounded-2xl shadow-xl border p-6 overflow-hidden cursor-grab active:cursor-grabbing`}\n        >\n          <div className=\"flex items-center justify-between mb-6\">\n            <h2 className={`text-xl font-semibold ${theme.text}`}>\n              {fileMode === 'single'\n                ? currentFile.filename\n                : 'All Files Timeline'}\n            </h2>\n            <div className={`text-sm ${theme.textMuted}`}>\n              {formatDate(minDate, 'short')}  {formatDate(maxDate, 'short')}\n            </div>\n          </div>\n\n          {/* Minimap */}\n          <div\n            className={`mb-4 relative h-8 rounded-lg ${darkMode ? 'bg-gray-700' : 'bg-gray-200'} overflow-hidden`}\n          >\n            {allTimelinePoints.map((point, idx) => {\n              const pos =\n                ((point.date.getTime() - minDate.getTime()) / timeRange) * 100;\n              return (\n                <div\n                  key={idx}\n                  className={`absolute w-1 h-full ${dateTypeInfo[point.type]?.color} opacity-60`}\n                  style={{ left: `${pos}%` }}\n                />\n              );\n            })}\n            <div\n              className=\"absolute h-full bg-indigo-500/30 border-2 border-indigo-500 rounded\"\n              style={{\n                left: `${Math.max(0, -panOffset / zoomLevel)}%`,\n                width: `${100 / zoomLevel}%`,\n              }}\n            />\n          </div>\n\n          {/* Timeline Track */}\n          <div className=\"relative pt-16\" style={{ minHeight: '300px' }}>\n            <div\n              className={`absolute top-24 left-0 right-0 h-3 rounded-full ${theme.accent} opacity-20`}\n              style={{\n                transform: `translateX(${panOffset}px) scaleX(${zoomLevel})`,\n                transformOrigin: 'left',\n              }}\n            />\n            <div\n              className=\"absolute top-0 left-0 right-0 flex justify-between text-xs\"\n              style={{ transform: `translateX(${panOffset}px)` }}\n            >\n              {[0, 25, 50, 75, 100].map(pct => {\n                const date = new Date(\n                  minDate.getTime() + (timeRange * pct) / 100\n                );\n                return (\n                  <div\n                    key={pct}\n                    className={theme.textMuted}\n                    style={{\n                      left: `${pct * zoomLevel}%`,\n                      position: 'absolute',\n                    }}\n                  >\n                    {formatDate(date, 'short')}\n                  </div>\n                );\n              })}\n            </div>\n            <div className=\"relative pt-16\" style={{ height: '250px' }}>\n              {allTimelinePoints.map((point, idx) => {\n                const typeInfo = dateTypeInfo[point.type];\n                if (!typeInfo) return null;\n                const Icon = typeInfo.icon;\n                const position = getPosition(point.date);\n                const isSelected = selectedPoints.includes(point.id);\n                const isHovered = hoveredPoint === point.id;\n                const row = fileMode === 'all' ? idx % 3 : 0;\n                return (\n                  <div\n                    key={point.id}\n                    className=\"absolute transform -translate-x-1/2 transition-all duration-200\"\n                    style={{ left: `${position}%`, top: `${row * 70}px` }}\n                    onMouseEnter={() => setHoveredPoint(point.id)}\n                    onMouseLeave={() => setHoveredPoint(null)}\n                    onClick={e => handlePointClick(point, e)}\n                    role=\"button\"\n                    tabIndex={0}\n                    onKeyUp={e =>\n                      e.key === 'Enter' &&\n                      handlePointClick(point, e as unknown as React.MouseEvent)\n                    }\n                  >\n                    <div\n                      className={`absolute left-1/2 -translate-x-1/2 w-0.5 h-16 ${darkMode ? 'bg-gray-600' : 'bg-gray-300'}`}\n                    />\n                    <div\n                      className={`relative w-14 h-14 ${typeInfo.color} rounded-full flex items-center justify-center cursor-pointer transform transition-all duration-200 shadow-lg ${isHovered || isSelected ? 'scale-125 shadow-2xl z-30' : 'hover:scale-110 z-10'} ${isSelected ? `ring-4 ${typeInfo.ring}` : ''}`}\n                    >\n                      <Icon className=\"w-6 h-6 text-white\" />\n                      {isSelected && (\n                        <div className=\"absolute -top-1 -right-1 w-5 h-5 bg-white rounded-full flex items-center justify-center shadow-md\">\n                          <Check className=\"w-3 h-3 text-indigo-600\" />\n                        </div>\n                      )}\n                    </div>\n                    {(isHovered || isSelected) && (\n                      <div className=\"absolute top-20 left-1/2 -translate-x-1/2 z-40 animate-in fade-in zoom-in-95 duration-150\">\n                        <div\n                          className={`${typeInfo.bgLight} px-5 py-4 rounded-xl shadow-2xl border-2 ${typeInfo.border} whitespace-nowrap`}\n                        >\n                          <div\n                            className={`flex items-center gap-2 mb-2 pb-2 border-b ${theme.border}`}\n                          >\n                            <point.file.icon\n                              className={`w-4 h-4 ${typeInfo.textColor}`}\n                            />\n                            <span className={`text-sm font-bold ${theme.text}`}>\n                              {point.file.filename}\n                            </span>\n                          </div>\n                          <div\n                            className={`text-xs font-semibold ${typeInfo.textColor} mb-1`}\n                          >\n                            {typeInfo.label}\n                          </div>\n                          <div className={`text-sm font-medium ${theme.text}`}>\n                            {formatDate(point.date)}\n                          </div>\n                          <div className={`text-xs ${theme.textMuted} mt-1`}>\n                            {formatRelative(point.date)}\n                          </div>\n                          <div className=\"mt-2 pt-2 border-t border-dashed border-gray-300 flex gap-3\">\n                            <span className={`text-xs ${theme.textMuted}`}>\n                              {point.file.size}\n                            </span>\n                            {point.file.dimensions && (\n                              <span className={`text-xs ${theme.textMuted}`}>\n                                {point.file.dimensions}\n                              </span>\n                            )}\n                          </div>\n                        </div>\n                        <div\n                          className={`absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 ${typeInfo.bgLight} rotate-45 border-l-2 border-t-2 ${typeInfo.border}`}\n                        />\n                      </div>\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n        </div>\n\n        {/* Detail Cards */}\n        <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {(fileMode === 'single' ? [currentFile] : files).map(file => {\n            const fileDates = [\n              file.dateTaken && {\n                type: 'taken' as const,\n                date: file.dateTaken,\n              },\n              { type: 'created' as const, date: file.created },\n              { type: 'modified' as const, date: file.modified },\n              { type: 'accessed' as const, date: file.accessed },\n            ].filter(Boolean);\n            return (\n              <div\n                key={file.id}\n                className={`${theme.card} rounded-xl border p-5 hover:shadow-lg transition-all cursor-pointer`}\n                onClick={() => onFileSelect?.(file)}\n                role=\"button\"\n                tabIndex={0}\n                onKeyUp={e => e.key === 'Enter' && onFileSelect?.(file)}\n              >\n                <div className=\"flex items-start gap-3 mb-4\">\n                  <div\n                    className={`w-10 h-10 ${theme.accent} rounded-lg flex items-center justify-center`}\n                  >\n                    <file.icon className=\"w-5 h-5 text-white\" />\n                  </div>\n                  <div className=\"flex-1 min-w-0\">\n                    <h3 className={`font-semibold ${theme.text} truncate`}>\n                      {file.filename}\n                    </h3>\n                    <p className={`text-sm ${theme.textMuted}`}>\n                      {file.type}  {file.size}\n                      {file.dimensions && `  ${file.dimensions}`}\n                      {file.pages && `  ${file.pages} pages`}\n                    </p>\n                  </div>\n                </div>\n                {file.tags && (\n                  <div className=\"flex flex-wrap gap-1 mb-4\">\n                    {file.tags.map(tag => (\n                      <span\n                        key={tag}\n                        className={`px-2 py-0.5 rounded-full text-xs ${darkMode ? 'bg-gray-700 text-gray-300' : 'bg-gray-100 text-gray-600'}`}\n                      >\n                        #{tag}\n                      </span>\n                    ))}\n                  </div>\n                )}\n                <div className=\"grid grid-cols-2 gap-2\">\n                  {fileDates.map(dateInfo => {\n                    if (!dateInfo) return null;\n                    const typeInfo = dateTypeInfo[dateInfo.type];\n                    if (!typeInfo) return null;\n                    const Icon = typeInfo.icon;\n                    return (\n                      <div\n                        key={dateInfo.type}\n                        className={`${typeInfo.bgLight} p-3 rounded-lg border ${typeInfo.border}`}\n                      >\n                        <div className=\"flex items-center gap-2 mb-1\">\n                          <div\n                            className={`${typeInfo.color} w-6 h-6 rounded-full flex items-center justify-center`}\n                          >\n                            <Icon className=\"w-3 h-3 text-white\" />\n                          </div>\n                          <span\n                            className={`text-xs font-medium ${typeInfo.textColor}`}\n                          >\n                            {typeInfo.label}\n                          </span>\n                        </div>\n                        <div className={`text-xs ${theme.text} font-medium`}>\n                          {formatDate(dateInfo.date, 'short')}\n                        </div>\n                        <div className={`text-xs ${theme.textMuted}`}>\n                          {formatRelative(dateInfo.date)}\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              </div>\n            );\n          })}\n        </div>\n\n        {/* Legend & Shortcuts */}\n        <div className={`${theme.card} rounded-2xl shadow-xl border p-6`}>\n          <div className=\"flex flex-wrap justify-between gap-8\">\n            <div>\n              <h3 className={`text-sm font-semibold ${theme.textMuted} mb-3`}>\n                Legend\n              </h3>\n              <div className=\"flex flex-wrap gap-4\">\n                {Object.entries(dateTypeInfo).map(([type, info]) => (\n                  <div key={type} className=\"flex items-center gap-2\">\n                    <div\n                      className={`${info.color} w-6 h-6 rounded-full flex items-center justify-center`}\n                    >\n                      <info.icon className=\"w-3 h-3 text-white\" />\n                    </div>\n                    <span className={`text-sm ${theme.text}`}>\n                      {info.label}\n                    </span>\n                  </div>\n                ))}\n              </div>\n            </div>\n            <div>\n              <h3 className={`text-sm font-semibold ${theme.textMuted} mb-3`}>\n                Keyboard Shortcuts\n              </h3>\n              <div className=\"flex flex-wrap gap-4 text-sm\">\n                {[\n                  { key: '+/-', desc: 'Zoom' },\n                  { key: '0', desc: 'Reset' },\n                  { key: 'Space', desc: 'Play/Pause' },\n                  { key: '/', desc: 'Pan' },\n                  { key: 'D', desc: 'Dark mode' },\n                  { key: 'F', desc: 'Filters' },\n                  { key: 'S', desc: 'Stats' },\n                ].map(shortcut => (\n                  <div key={shortcut.key} className=\"flex items-center gap-2\">\n                    <kbd\n                      className={`px-2 py-1 rounded ${darkMode ? 'bg-gray-700' : 'bg-gray-100'} ${theme.text} font-mono text-xs`}\n                    >\n                      {shortcut.key}\n                    </kbd>\n                    <span className={theme.textMuted}>{shortcut.desc}</span>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Detail Modal */}\n        {detailModal && (\n          <div\n            className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4\"\n            onClick={() => setDetailModal(null)}\n          >\n            <div\n              className={`${theme.card} rounded-2xl shadow-2xl border max-w-lg w-full p-6 animate-in zoom-in-95`}\n              onClick={e => e.stopPropagation()}\n            >\n              <div className=\"flex items-start justify-between mb-4\">\n                <div className=\"flex items-center gap-3\">\n                  <div\n                    className={`w-12 h-12 ${dateTypeInfo[detailModal.type]?.color} rounded-xl flex items-center justify-center`}\n                  >\n                    {dateTypeInfo[detailModal.type] &&\n                      React.createElement(dateTypeInfo[detailModal.type].icon, {\n                        className: 'w-6 h-6 text-white',\n                      })}\n                  </div>\n                  <div>\n                    <h2 className={`text-xl font-bold ${theme.text}`}>\n                      {detailModal.file.filename}\n                    </h2>\n                    <p\n                      className={`${dateTypeInfo[detailModal.type]?.textColor} font-medium`}\n                    >\n                      {dateTypeInfo[detailModal.type]?.label}\n                    </p>\n                  </div>\n                </div>\n                <button\n                  type=\"button\"\n                  onClick={() => setDetailModal(null)}\n                  className={`p-2 rounded-lg ${theme.hover}`}\n                >\n                  <X className={`w-5 h-5 ${theme.text}`} />\n                </button>\n              </div>\n              <div className=\"space-y-4\">\n                <div\n                  className={`p-4 rounded-xl ${darkMode ? 'bg-gray-700/50' : 'bg-gray-100'}`}\n                >\n                  <div className={`text-lg font-semibold ${theme.text}`}>\n                    {formatDate(detailModal.date)}\n                  </div>\n                  <div className={theme.textMuted}>\n                    {formatRelative(detailModal.date)}\n                  </div>\n                </div>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <div className={`text-sm ${theme.textMuted}`}>\n                      File Type\n                    </div>\n                    <div className={`font-medium ${theme.text} capitalize`}>\n                      {detailModal.file.type}\n                    </div>\n                  </div>\n                  <div>\n                    <div className={`text-sm ${theme.textMuted}`}>Size</div>\n                    <div className={`font-medium ${theme.text}`}>\n                      {detailModal.file.size}\n                    </div>\n                  </div>\n                  {detailModal.file.dimensions && (\n                    <div>\n                      <div className={`text-sm ${theme.textMuted}`}>\n                        Dimensions\n                      </div>\n                      <div className={`font-medium ${theme.text}`}>\n                        {detailModal.file.dimensions}\n                      </div>\n                    </div>\n                  )}\n                  {detailModal.file.pages && (\n                    <div>\n                      <div className={`text-sm ${theme.textMuted}`}>Pages</div>\n                      <div className={`font-medium ${theme.text}`}>\n                        {detailModal.file.pages}\n                      </div>\n                    </div>\n                  )}\n                  {detailModal.file.location && (\n                    <div>\n                      <div className={`text-sm ${theme.textMuted}`}>\n                        Location\n                      </div>\n                      <div className={`font-medium ${theme.text}`}>\n                        {detailModal.file.location}\n                      </div>\n                    </div>\n                  )}\n                  {detailModal.file.camera && (\n                    <div>\n                      <div className={`text-sm ${theme.textMuted}`}>Camera</div>\n                      <div className={`font-medium ${theme.text}`}>\n                        {detailModal.file.camera}\n                      </div>\n                    </div>\n                  )}\n                  {detailModal.file.author && (\n                    <div>\n                      <div className={`text-sm ${theme.textMuted}`}>Author</div>\n                      <div className={`font-medium ${theme.text}`}>\n                        {detailModal.file.author}\n                      </div>\n                    </div>\n                  )}\n                </div>\n                {detailModal.file.tags && (\n                  <div>\n                    <div className={`text-sm ${theme.textMuted} mb-2`}>\n                      Tags\n                    </div>\n                    <div className=\"flex flex-wrap gap-2\">\n                      {detailModal.file.tags.map(tag => (\n                        <span\n                          key={tag}\n                          className={`px-3 py-1 rounded-full text-sm ${darkMode ? 'bg-gray-700 text-gray-300' : 'bg-indigo-100 text-indigo-700'}`}\n                        >\n                          #{tag}\n                        </span>\n                      ))}\n                    </div>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Comparison Modal */}\n        {comparisonMode && (\n          <div\n            className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4\"\n            onClick={() => setComparisonMode(false)}\n          >\n            <div\n              className={`${theme.card} rounded-2xl shadow-2xl border max-w-5xl w-full max-h-[90vh] overflow-auto p-6`}\n              onClick={e => e.stopPropagation()}\n            >\n              <div className=\"flex items-center justify-between mb-6\">\n                <h2 className={`text-2xl font-bold ${theme.text}`}>\n                   File Comparison\n                </h2>\n                <button\n                  type=\"button\"\n                  onClick={() => setComparisonMode(false)}\n                  className={`p-2 rounded-lg ${theme.hover}`}\n                >\n                  <X className={`w-5 h-5 ${theme.text}`} />\n                </button>\n              </div>\n              <div className=\"grid grid-cols-2 gap-4 mb-6\">\n                <select\n                  value={compareFiles[0]}\n                  onChange={e =>\n                    setCompareFiles([Number(e.target.value), compareFiles[1]])\n                  }\n                  className={`px-4 py-3 rounded-xl ${theme.input} border text-sm font-medium`}\n                >\n                  {files.map((file, idx) => (\n                    <option key={idx} value={idx}>\n                      {file.filename}\n                    </option>\n                  ))}\n                </select>\n                <select\n                  value={compareFiles[1]}\n                  onChange={e =>\n                    setCompareFiles([compareFiles[0], Number(e.target.value)])\n                  }\n                  className={`px-4 py-3 rounded-xl ${theme.input} border text-sm font-medium`}\n                >\n                  {files.map((file, idx) => (\n                    <option key={idx} value={idx}>\n                      {file.filename}\n                    </option>\n                  ))}\n                </select>\n              </div>\n              <div className=\"grid grid-cols-2 gap-6\">\n                {compareFiles.map((fileIdx, i) => {\n                  const file = files[fileIdx];\n                  const fileDates = [\n                    file.dateTaken && {\n                      type: 'taken' as const,\n                      date: file.dateTaken,\n                    },\n                    { type: 'created' as const, date: file.created },\n                    { type: 'modified' as const, date: file.modified },\n                    { type: 'accessed' as const, date: file.accessed },\n                  ].filter(Boolean);\n                  return (\n                    <div\n                      key={i}\n                      className={`p-5 rounded-xl ${darkMode ? 'bg-gray-700/50' : 'bg-gray-50'}`}\n                    >\n                      <div className=\"flex items-center gap-3 mb-4\">\n                        <div\n                          className={`w-10 h-10 ${theme.accent} rounded-lg flex items-center justify-center`}\n                        >\n                          <file.icon className=\"w-5 h-5 text-white\" />\n                        </div>\n                        <div>\n                          <h3 className={`font-semibold ${theme.text}`}>\n                            {file.filename}\n                          </h3>\n                          <p className={`text-sm ${theme.textMuted}`}>\n                            {file.type}  {file.size}\n                          </p>\n                        </div>\n                      </div>\n                      <div className=\"space-y-3\">\n                        {fileDates.map(dateInfo => {\n                          if (!dateInfo) return null;\n                          const typeInfo = dateTypeInfo[dateInfo.type];\n                          if (!typeInfo) return null;\n                          const Icon = typeInfo.icon;\n                          return (\n                            <div\n                              key={dateInfo.type}\n                              className={`flex items-center justify-between p-3 rounded-lg ${typeInfo.bgLight} border ${typeInfo.border}`}\n                            >\n                              <div className=\"flex items-center gap-2\">\n                                <div\n                                  className={`${typeInfo.color} w-7 h-7 rounded-full flex items-center justify-center`}\n                                >\n                                  <Icon className=\"w-3.5 h-3.5 text-white\" />\n                                </div>\n                                <span\n                                  className={`text-sm font-medium ${typeInfo.textColor}`}\n                                >\n                                  {typeInfo.label}\n                                </span>\n                              </div>\n                              <div className=\"text-right\">\n                                <div\n                                  className={`text-sm font-medium ${theme.text}`}\n                                >\n                                  {formatDate(dateInfo.date, 'short')}\n                                </div>\n                                <div className={`text-xs ${theme.textMuted}`}>\n                                  {formatRelative(dateInfo.date)}\n                                </div>\n                              </div>\n                            </div>\n                          );\n                        })}\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n              <div\n                className={`mt-6 p-4 rounded-xl ${darkMode ? 'bg-gray-700/30' : 'bg-indigo-50'} border ${darkMode ? 'border-gray-600' : 'border-indigo-200'}`}\n              >\n                <h3 className={`text-sm font-semibold ${theme.text} mb-3`}>\n                   Time Difference Analysis\n                </h3>\n                <div className=\"grid grid-cols-3 gap-4 text-center\">\n                  {(() => {\n                    const f1 = files[compareFiles[0]];\n                    const f2 = files[compareFiles[1]];\n                    const createdDiff =\n                      Math.abs(f1.created.getTime() - f2.created.getTime()) /\n                      (1000 * 60 * 60 * 24);\n                    const modifiedDiff =\n                      Math.abs(f1.modified.getTime() - f2.modified.getTime()) /\n                      (1000 * 60 * 60 * 24);\n                    const accessedDiff =\n                      Math.abs(f1.accessed.getTime() - f2.accessed.getTime()) /\n                      (1000 * 60 * 60 * 24);\n                    return [\n                      {\n                        label: 'Created difference',\n                        value: `${createdDiff.toFixed(1)} days`,\n                      },\n                      {\n                        label: 'Modified difference',\n                        value: `${modifiedDiff.toFixed(1)} days`,\n                      },\n                      {\n                        label: 'Accessed difference',\n                        value: `${accessedDiff.toFixed(1)} days`,\n                      },\n                    ];\n                  })().map((stat, i) => (\n                    <div key={i}>\n                      <div className={`text-lg font-bold ${theme.text}`}>\n                        {stat.value}\n                      </div>\n                      <div className={`text-xs ${theme.textMuted}`}>\n                        {stat.label}\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default PremiumTimeline;\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/viz/VideoKeyframesViz.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'time' is defined but never used. Allowed unused args must match /^_/u.","line":55,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":55,"endColumn":7}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// client/src/components/viz/VideoKeyframesViz.tsx\nimport React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Film, Video, Clock, Layers, Maximize2, Database } from 'lucide-react';\n\ninterface VideoMetadata {\n  duration?: number;\n  width?: number;\n  height?: number;\n  frame_rate?: number;\n  bitrate?: number;\n  codec?: string;\n  audio_codec?: string;\n  container?: string;\n}\n\ninterface VideoKeyframesVizProps {\n  video?: VideoMetadata;\n}\n\n// Generate simulated keyframes\nfunction generateKeyframes(\n  count: number = 6\n): Array<{ id: number; time: number; label: string }> {\n  return Array.from({ length: count }, (_, i) => ({\n    id: i,\n    time: i * 10 + Math.floor(Math.random() * 5),\n    label: `${i * 10 + Math.floor(Math.random() * 5)}s`,\n  }));\n}\n\nfunction formatDuration(seconds: number | undefined): string {\n  if (!seconds) return '0:00';\n  const hours = Math.floor(seconds / 3600);\n  const mins = Math.floor((seconds % 3600) / 60);\n  const secs = Math.floor(seconds % 60);\n\n  if (hours > 0) {\n    return `${hours}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n  }\n  return `${mins}:${secs.toString().padStart(2, '0')}`;\n}\n\nfunction formatBitrate(bitsPerSecond: number | undefined): string {\n  if (!bitsPerSecond) return 'Unknown';\n  if (bitsPerSecond >= 1000000)\n    return `${(bitsPerSecond / 1000000).toFixed(1)} Mbps`;\n  if (bitsPerSecond >= 1000) return `${(bitsPerSecond / 1000).toFixed(0)} kbps`;\n  return `${bitsPerSecond} bps`;\n}\n\n// Placeholder thumbnail component\nfunction ThumbnailPlaceholder({\n  time,\n  label,\n  isActive,\n}: {\n  time: number;\n  label: string;\n  isActive?: boolean;\n}) {\n  return (\n    <div\n      className={`relative group cursor-pointer ${isActive ? 'ring-2 ring-primary' : ''}`}\n    >\n      <div className=\"aspect-video bg-gradient-to-br from-slate-700 to-slate-800 rounded-md flex items-center justify-center overflow-hidden\">\n        <div className=\"absolute inset-0 flex items-center justify-center\">\n          <Video className=\"w-8 h-8 text-white/30\" />\n        </div>\n        {/* Simulated frame content */}\n        <div className=\"absolute inset-0 opacity-20 bg-gradient-to-br from-blue-500/20 to-purple-500/20\" />\n      </div>\n      <div className=\"absolute bottom-1 right-1 bg-black/70 text-white text-[10px] px-1 rounded\">\n        {label}\n      </div>\n      {/* Play indicator on hover */}\n      <div className=\"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors rounded-md flex items-center justify-center\">\n        <div className=\"w-8 h-8 bg-white/90 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity\">\n          <div className=\"w-0 h-0 border-l-4 border-l-slate-800 border-y-4 border-y-transparent ml-0.5\" />\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport function VideoKeyframesViz({ video }: VideoKeyframesVizProps) {\n  const keyframes = generateKeyframes(6);\n  const aspectRatio =\n    video?.width && video?.height ? video.width / video.height : 16 / 9;\n\n  return (\n    <Card className=\"w-full\">\n      <CardHeader className=\"pb-2\">\n        <CardTitle className=\"text-lg flex items-center gap-2\">\n          <Film className=\"w-5 h-5\" />\n          Video Overview\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        {/* Video info header */}\n        <div className=\"flex items-center gap-3 mb-4 p-3 rounded-lg bg-muted/50\">\n          <div\n            className=\"w-16 aspect-video rounded bg-gradient-to-br from-blue-600 to-purple-700 flex items-center justify-center\"\n            style={{ aspectRatio }}\n          >\n            <Film className=\"w-8 h-8 text-white\" />\n          </div>\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"font-medium\">Video File</div>\n            <div className=\"text-sm text-muted-foreground\">\n              {video?.width && video?.height\n                ? `${video.width}  ${video.height}`\n                : 'Unknown resolution'}\n            </div>\n            <div className=\"flex flex-wrap gap-1 mt-1\">\n              {video?.codec && (\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  {video.codec}\n                </Badge>\n              )}\n              {video?.container && (\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  {video.container}\n                </Badge>\n              )}\n            </div>\n          </div>\n          <div className=\"text-right\">\n            <div className=\"flex items-center gap-1 text-sm text-muted-foreground\">\n              <Clock className=\"w-4 h-4\" />\n              {formatDuration(video?.duration)}\n            </div>\n            {video?.frame_rate && (\n              <div className=\"text-xs text-muted-foreground\">\n                {video.frame_rate.toFixed(1)} fps\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Timeline with keyframes */}\n        <div className=\"mb-4\">\n          <div className=\"flex items-center gap-2 mb-2\">\n            <Layers className=\"w-4 h-4 text-muted-foreground\" />\n            <span className=\"text-sm font-medium\">Keyframes</span>\n          </div>\n\n          {/* Timeline bar */}\n          <div className=\"relative h-8 bg-muted/30 rounded mb-3\">\n            <div className=\"absolute inset-y-0 left-0 right-0 flex items-center\">\n              {/* Time markers */}\n              {Array.from({ length: 11 }, (_, i) => (\n                <div\n                  key={i}\n                  className=\"flex-1 border-l border-muted-foreground/20 h-full relative\"\n                >\n                  <span className=\"absolute -bottom-4 left-0 text-[8px] text-muted-foreground\">\n                    {i * 10}s\n                  </span>\n                </div>\n              ))}\n            </div>\n            {/* Progress indicator */}\n            <div\n              className=\"absolute top-0 bottom-0 w-0.5 bg-primary\"\n              style={{ left: '30%' }}\n            />\n          </div>\n\n          {/* Keyframe thumbnails */}\n          <div className=\"grid grid-cols-3 md:grid-cols-6 gap-2\">\n            {keyframes.map(kf => (\n              <ThumbnailPlaceholder\n                key={`kf-${kf.time}-${kf.label}`}\n                time={kf.time}\n                label={kf.label}\n                isActive={kf.id === 1} // Simulate second frame as active\n              />\n            ))}\n          </div>\n        </div>\n\n        {/* Technical details */}\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-2\">\n          <div className=\"p-2 rounded bg-muted/30 text-center\">\n            <div className=\"flex items-center justify-center gap-1 text-xs text-muted-foreground mb-1\">\n              <Maximize2 className=\"w-3 h-3\" />\n              Resolution\n            </div>\n            <div className=\"font-mono text-sm\">\n              {video?.width && video?.height\n                ? `${video.width}${video.height}`\n                : 'Unknown'}\n            </div>\n          </div>\n\n          <div className=\"p-2 rounded bg-muted/30 text-center\">\n            <div className=\"flex items-center justify-center gap-1 text-xs text-muted-foreground mb-1\">\n              <Film className=\"w-3 h-3\" />\n              Frame Rate\n            </div>\n            <div className=\"font-mono text-sm\">\n              {video?.frame_rate ? `${video.frame_rate.toFixed(1)} fps` : '?'}\n            </div>\n          </div>\n\n          <div className=\"p-2 rounded bg-muted/30 text-center\">\n            <div className=\"flex items-center justify-center gap-1 text-xs text-muted-foreground mb-1\">\n              <Database className=\"w-3 h-3\" />\n              Bitrate\n            </div>\n            <div className=\"font-mono text-sm\">\n              {formatBitrate(video?.bitrate)}\n            </div>\n          </div>\n\n          <div className=\"p-2 rounded bg-muted/30 text-center\">\n            <div className=\"flex items-center justify-center gap-1 text-xs text-muted-foreground mb-1\">\n              <Video className=\"w-3 h-3\" />\n              Audio\n            </div>\n            <div className=\"font-mono text-sm\">\n              {video?.audio_codec || 'None'}\n            </div>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/viz/VizDemo.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileImage' is defined but never used.","line":28,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileAudio' is defined but never used.","line":29,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileVideo' is defined but never used.","line":30,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// client/src/components/viz/VizDemo.tsx\nimport React, { useState } from 'react';\nimport {\n  Card,\n  CardContent,\n  CardHeader,\n  CardTitle,\n  CardDescription,\n} from '@/components/ui/card';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { DateTimeTimeline } from './DateTimeTimeline';\nimport { CameraSettingsRadar } from './CameraSettingsRadar';\nimport { EmailThreadViz } from './EmailThreadViz';\nimport { ColorHistogram } from './ColorHistogram';\nimport { LocationMiniMap } from './LocationMiniMap';\nimport { AudioWaveformViz } from './AudioWaveformViz';\nimport { VideoKeyframesViz } from './VideoKeyframesViz';\nimport { ForensicTimeline } from './ForensicTimeline';\nimport { ManipulationDashboard } from './ManipulationDashboard';\nimport {\n  Calendar,\n  Camera,\n  Mail,\n  Play,\n  RotateCcw,\n  FileImage,\n  FileAudio,\n  FileVideo,\n  AlertTriangle,\n  Activity,\n  Film,\n  History,\n  Shield,\n} from 'lucide-react';\n\n// Sample data for demos\nconst sampleImageMetadata = {\n  DateTimeOriginal: '2024:03:15 14:32:45',\n  CreateDate: '2024:03:15 14:32:50',\n  ModifyDate: '2024:03:15 14:35:12',\n  FileCreateDate: '2024-03-15T10:32:50-04:00',\n  FileModifyDate: '2024-03-15T10:35:12-04:00',\n  FileAccessDate: '2024-03-15T11:00:00-04:00',\n};\n\nconst sampleExif = {\n  ISO: 400,\n  FNumber: 2.8,\n  ExposureTime: '1/250',\n  FocalLength: 50,\n  WhiteBalance: 6500,\n  ColorTemperature: 6500,\n  Flash: 1,\n  ExposureCompensation: 0,\n  DigitalZoomRatio: 1,\n};\n\nconst sampleImage = {\n  width: 6000,\n  height: 4000,\n  bit_depth: 14,\n  color_mode: 'RGB',\n};\n\nconst sampleGps = {\n  latitude: 37.7749,\n  longitude: -122.4194,\n  latitude_decimal: 37.7749,\n  longitude_decimal: -122.4194,\n  altitude_meters: 15,\n  gps_timestamp: '2024-03-15T14:32:45Z',\n  gps_speed: 0,\n  gps_direction: 180,\n  coordinates_formatted: '37.7749 N, 122.4194 W',\n  google_maps_url: 'https://www.google.com/maps?q=37.7749,-122.4194',\n  openstreetmap_url:\n    'https://www.openstreetmap.org/?mlat=37.7749&mlon=-122.4194#map=15/37.7749/-122.4194',\n};\n\nconst sampleEmail = {\n  email_from: 'John Doe <john.doe@example.com>',\n  email_from_name: 'John Doe',\n  email_from_address: 'john.doe@example.com',\n  email_to: 'Jane Smith <jane@company.org>',\n  email_to_addresses: ['jane@company.org'],\n  email_cc: 'Team Lead <lead@company.org>',\n  email_cc_addresses: ['lead@company.org'],\n  email_subject: 'Re: Project Update - Q2 Planning',\n  email_date: 'Mon, 15 Mar 2024 14:30:00 +0000',\n  email_datetime_parsed: '2024-03-15T14:30:00+00:00',\n  email_timestamp: 1710513000,\n  email_message_id: '<ABC123@example.com>',\n  email_in_reply_to: '<XYZ789@example.com>',\n  email_is_reply: true,\n  email_is_direct_reply: true,\n  email_is_forward: false,\n  email_thread_level: 2,\n  email_priority: 'high',\n  email_dkim_present: true,\n  email_spf_result: 'pass',\n  email_authentication_results: 'example.com; spf=pass; dkim=pass',\n  email_spam_status: 'No, score=0.0',\n  email_attachment_count: 2,\n  email_attachments: [\n    {\n      filename: 'Q2_Planning_Document.pdf',\n      content_type: 'application/pdf',\n      size: 245760,\n    },\n    {\n      filename: 'Budget_Summary.xlsx',\n      content_type:\n        'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n      size: 51200,\n    },\n  ],\n};\n\nconst sampleAudio = {\n  duration: 245,\n  bitrate: 320000,\n  sample_rate: 44100,\n  channels: 2,\n  bit_depth: 16,\n  codec: 'MP3',\n  artist: 'Sample Artist',\n  album: 'Demo Album',\n  title: 'Sample Track',\n  genre: 'Rock',\n  year: 2024,\n};\n\nconst sampleVideo = {\n  duration: 120,\n  width: 1920,\n  height: 1080,\n  frame_rate: 30,\n  bitrate: 8000000,\n  codec: 'H.264',\n  audio_codec: 'AAC',\n  container: 'MP4',\n};\n\nconst sampleIntegrity = {\n  md5: 'd41d8cd98f00b204e9800998ecf8427e',\n  sha256: 'e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855',\n  sha1: 'da39a3ee5e6b4b0d3255bfef95601890afd80709',\n  crc32: '00000000',\n};\n\nconst sampleForensic = {\n  forensic_filesystem: {\n    file_created: '2024-03-15T10:32:50-04:00',\n    file_modified: '2024-03-15T14:35:12-04:00',\n    file_accessed: '2024-03-15T18:00:00-04:00',\n    file_size: 2457600,\n    file_permissions: '644',\n    file_owner: 1000,\n    file_inode: 12345678,\n  },\n  forensic_device_hardware: {\n    device_id: 'device-abc123',\n    volume_id: 'volume-xyz789',\n    drive_type: 'SSD',\n    filesystem_type: 'APFS',\n  },\n};\n\nconst sampleManipulation = {\n  manipulation_probability: 15,\n  indicators: ['Minor metadata adjustment', 'Color correction'],\n  jpeg_analysis: {\n    compression_artifacts: false,\n    recompression_detected: true,\n  },\n  noise_analysis: {\n    inconsistent_regions: 0,\n    confidence: 85,\n  },\n};\n\nconst sampleSteganography = {\n  suspicious_score: 5,\n  methods_detected: [],\n  entropy_analysis: {\n    score: 3.2,\n    suspicious_regions: 0,\n  },\n  lsb_analysis: {\n    suspicious_channels: [],\n    confidence: 92,\n  },\n};\n\nconst sampleAIDetection = {\n  ai_probability: 8,\n  detection_methods: ['Noise analysis', 'Frequency domain'],\n  confidence: 78,\n  suspicious_patterns: [],\n};\n\n// Anomaly example\nconst anomalyMetadata = {\n  DateTimeOriginal: '2024:01:15 08:30:00',\n  CreateDate: '2024:01:15 08:30:05',\n  ModifyDate: '2024:01:20 18:45:30',\n  FileCreateDate: '2024-03-15T10:00:00-04:00',\n  FileModifyDate: '2024-03-15T18:45:30-04:00',\n  FileAccessDate: '2024-03-15T18:45:30-04:00',\n};\n\nexport function VizDemo() {\n  const [activeTab, setActiveTab] = useState('timeline');\n  const [showAnomaly, setShowAnomaly] = useState(false);\n  const [currentImageData, setCurrentImageData] = useState(sampleImageMetadata);\n  const [currentExif, setCurrentExif] = useState(sampleExif);\n  const [currentEmail, setCurrentEmail] = useState(sampleEmail);\n\n  const resetDemo = () => {\n    setShowAnomaly(false);\n    setCurrentImageData(sampleImageMetadata);\n    setCurrentExif(sampleExif);\n    setCurrentEmail(sampleEmail);\n  };\n\n  const loadAnomalyDemo = () => {\n    setShowAnomaly(true);\n    setCurrentImageData(anomalyMetadata);\n  };\n\n  const randomizeExif = () => {\n    setCurrentExif({\n      ...currentExif,\n      ISO: Math.floor(Math.random() * 6400) + 50,\n      FNumber: [1.4, 1.8, 2.8, 4, 5.6, 8, 11, 16][\n        Math.floor(Math.random() * 8)\n      ],\n      ExposureTime: [\n        '1/4000',\n        '1/2000',\n        '1/1000',\n        '1/500',\n        '1/250',\n        '1/125',\n        '1/60',\n        '1/30',\n      ][Math.floor(Math.random() * 8)],\n      FocalLength: [24, 35, 50, 85, 135, 200][Math.floor(Math.random() * 6)],\n      Flash: Math.random() > 0.5 ? 1 : 0,\n    });\n  };\n\n  return (\n    <div className=\"container mx-auto py-8 px-4 max-w-7xl\">\n      <div className=\"mb-8\">\n        <h1 className=\"text-3xl font-bold mb-2\">Metadata Visualization Demo</h1>\n        <p className=\"text-muted-foreground\">\n          Explore interactive visualizations for different metadata types\n        </p>\n      </div>\n\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-5 mb-6\">\n          <TabsTrigger value=\"timeline\" className=\"flex items-center gap-2\">\n            <Calendar className=\"w-4 h-4\" />\n            Timeline\n          </TabsTrigger>\n          <TabsTrigger value=\"camera\" className=\"flex items-center gap-2\">\n            <Camera className=\"w-4 h-4\" />\n            Camera\n          </TabsTrigger>\n          <TabsTrigger value=\"email\" className=\"flex items-center gap-2\">\n            <Mail className=\"w-4 h-4\" />\n            Email\n          </TabsTrigger>\n          <TabsTrigger value=\"media\" className=\"flex items-center gap-2\">\n            <Film className=\"w-4 h-4\" />\n            Audio/Video\n          </TabsTrigger>\n          <TabsTrigger value=\"forensic\" className=\"flex items-center gap-2\">\n            <Shield className=\"w-4 h-4\" />\n            Forensic\n          </TabsTrigger>\n        </TabsList>\n\n        {/* Timeline Demo */}\n        <TabsContent value=\"timeline\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            <DateTimeTimeline metadata={currentImageData} fileType=\"image\" />\n            <Card>\n              <CardHeader>\n                <CardTitle>Date/Time Timeline</CardTitle>\n                <CardDescription>\n                  Multi-source date visualization with anomaly detection\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"flex flex-wrap gap-2\">\n                  <Button onClick={resetDemo} variant=\"outline\" size=\"sm\">\n                    <RotateCcw className=\"w-4 h-4 mr-2\" />\n                    Normal Data\n                  </Button>\n                  <Button\n                    onClick={loadAnomalyDemo}\n                    variant=\"destructive\"\n                    size=\"sm\"\n                  >\n                    <AlertTriangle className=\"w-4 h-4 mr-2\" />\n                    Show Anomaly\n                  </Button>\n                </div>\n                {showAnomaly && (\n                  <Badge\n                    variant=\"secondary\"\n                    className=\"bg-amber-100 text-amber-800\"\n                  >\n                     Large gap detected between dates\n                  </Badge>\n                )}\n                <p className=\"text-sm text-muted-foreground\">\n                  Shows all date/time sources: EXIF (capture, create, modify),\n                  filesystem, and email. Automatically highlights anomalies like\n                  large gaps between dates.\n                </p>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        {/* Camera Demo */}\n        <TabsContent value=\"camera\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            <CameraSettingsRadar exif={currentExif} image={sampleImage} />\n            <div className=\"space-y-4\">\n              <ColorHistogram image={sampleImage} exif={sampleExif} />\n              <LocationMiniMap gps={sampleGps} />\n            </div>\n          </div>\n          <div className=\"mt-4\">\n            <Button onClick={randomizeExif} className=\"w-full\">\n              <Play className=\"w-4 h-4 mr-2\" />\n              Randomize Camera Settings\n            </Button>\n          </div>\n        </TabsContent>\n\n        {/* Email Demo */}\n        <TabsContent value=\"email\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            <EmailThreadViz email={currentEmail} />\n            <Card>\n              <CardHeader>\n                <CardTitle>Email Thread Visualization</CardTitle>\n                <CardDescription>\n                  Email metadata with security status and thread structure\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm text-muted-foreground mb-4\">\n                  Visualizes email headers, participant cards, security\n                  verification (DKIM/SPF), attachments, and thread\n                  relationships.\n                </p>\n                <ul className=\"text-sm space-y-2\">\n                  <li> Color-coded participant avatars</li>\n                  <li> DKIM/SPF verification badges</li>\n                  <li> Attachment list with sizes</li>\n                  <li> Thread level visualization</li>\n                  <li> Priority indicators</li>\n                </ul>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        {/* Audio/Video Demo */}\n        <TabsContent value=\"media\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            <AudioWaveformViz audio={sampleAudio} />\n            <VideoKeyframesViz video={sampleVideo} />\n          </div>\n        </TabsContent>\n\n        {/* Forensic Demo */}\n        <TabsContent value=\"forensic\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            <ForensicTimeline\n              integrity={sampleIntegrity}\n              forensic={sampleForensic}\n              filename=\"sample.jpg\"\n            />\n            <ManipulationDashboard\n              manipulation={sampleManipulation}\n              steganography={sampleSteganography}\n              ai_detection={sampleAIDetection}\n            />\n          </div>\n        </TabsContent>\n      </Tabs>\n\n      <div className=\"mt-12 border-t pt-8\">\n        <h2 className=\"text-2xl font-bold mb-4\">\n          All Visualization Components\n        </h2>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Calendar className=\"w-5 h-5\" />\n                DateTimeTimeline\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-sm text-muted-foreground mb-2\">\n                Multi-source date timeline with anomaly detection\n              </p>\n              <div className=\"flex flex-wrap gap-1\">\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  EXIF\n                </Badge>\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  Filesystem\n                </Badge>\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  Email\n                </Badge>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Camera className=\"w-5 h-5\" />\n                CameraSettingsRadar\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-sm text-muted-foreground mb-2\">\n                Radar chart for camera settings\n              </p>\n              <div className=\"flex flex-wrap gap-1\">\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  ISO\n                </Badge>\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  Aperture\n                </Badge>\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  Shutter\n                </Badge>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Mail className=\"w-5 h-5\" />\n                EmailThreadViz\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-sm text-muted-foreground mb-2\">\n                Email thread with security status\n              </p>\n              <div className=\"flex flex-wrap gap-1\">\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  DKIM\n                </Badge>\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  SPF\n                </Badge>\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  Attachments\n                </Badge>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Activity className=\"w-5 h-5\" />\n                ColorHistogram\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-sm text-muted-foreground mb-2\">\n                RGB/luminance histogram\n              </p>\n              <div className=\"flex flex-wrap gap-1\">\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  Red\n                </Badge>\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  Green\n                </Badge>\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  Blue\n                </Badge>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <History className=\"w-5 h-5\" />\n                LocationMiniMap\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-sm text-muted-foreground mb-2\">\n                GPS location with map links\n              </p>\n              <div className=\"flex flex-wrap gap-1\">\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  Coordinates\n                </Badge>\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  Altitude\n                </Badge>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Shield className=\"w-5 h-5\" />\n                ForensicTimeline\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-sm text-muted-foreground mb-2\">\n                Chain of custody visualization\n              </p>\n              <div className=\"flex flex-wrap gap-1\">\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  Hashes\n                </Badge>\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  Device\n                </Badge>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Film className=\"w-5 h-5\" />\n                VideoKeyframesViz\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-sm text-muted-foreground mb-2\">\n                Video overview with keyframes\n              </p>\n              <div className=\"flex flex-wrap gap-1\">\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  Codec\n                </Badge>\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  Resolution\n                </Badge>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Play className=\"w-5 h-5\" />\n                AudioWaveformViz\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-sm text-muted-foreground mb-2\">\n                Audio waveform visualization\n              </p>\n              <div className=\"flex flex-wrap gap-1\">\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  Format\n                </Badge>\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  Bitrate\n                </Badge>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <AlertTriangle className=\"w-5 h-5\" />\n                ManipulationDashboard\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-sm text-muted-foreground mb-2\">\n                AI/manipulation detection\n              </p>\n              <div className=\"flex flex-wrap gap-1\">\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  Steganography\n                </Badge>\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  AI Detection\n                </Badge>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default VizDemo;\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/components/viz/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/context/AccessibilityContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/context/ContextAdapter.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1103,1106],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1103,1106],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1365,1368],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1365,1368],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":216,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":216,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7024,7027],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7024,7027],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":218,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":218,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7123,7126],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7123,7126],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":222,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":222,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7268,7271],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7268,7271],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":371,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":371,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12431,12434],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12431,12434],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":456,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":456,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14780,14783],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14780,14783],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":466,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":466,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15128,15131],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15128,15131],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":479,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":479,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15484,15487],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15484,15487],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":486,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":486,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15722,15725],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15722,15725],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Context Adapter - Dynamic UI Adaptation Controller\n *\n * Provides React context for managing file context detection and\n * dynamic UI template switching based on file type and content.\n */\n\nimport React, {\n  createContext,\n  useContext,\n  useState,\n  useCallback,\n  useMemo,\n  ReactNode,\n} from 'react';\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface ContextProfile {\n  display_name: string;\n  description: string;\n  ui_template: string;\n  icon: string;\n  color: string;\n  priority_fields: string[];\n  special_components: string[];\n  field_groups: Record<string, string[]>;\n}\n\nexport interface AlternativeContext {\n  context_type: string;\n  confidence: number;\n}\n\nexport interface FileContext {\n  context_type: string;\n  confidence: number;\n  confidence_level: 'high' | 'medium' | 'low' | 'uncertain';\n  is_fallback: boolean;\n  detection_time_ms: number;\n  profile: ContextProfile;\n  alternative_contexts: AlternativeContext[];\n  evidence: Record<string, any>;\n}\n\nexport interface ContextAdapterState {\n  currentContext: FileContext | null;\n  isLoading: boolean;\n  error: string | null;\n  viewMode: 'simple' | 'advanced' | 'raw';\n}\n\nexport interface ContextAdapterActions {\n  detectContext: (metadata: Record<string, any>, filename: string) => void;\n  setViewMode: (mode: 'simple' | 'advanced' | 'raw') => void;\n  resetContext: () => void;\n  overrideContext: (contextType: string) => void;\n}\n\n// ============================================================================\n// Default Context Profiles (Fallback when API unavailable)\n// ============================================================================\n\nconst DEFAULT_PROFILES: Record<string, ContextProfile> = {\n  smartphone_photo: {\n    display_name: 'Smartphone Photo',\n    description: 'Photo taken with a smartphone camera',\n    ui_template: 'computational_photography',\n    icon: 'smartphone',\n    color: 'blue',\n    priority_fields: [\n      'Make', 'Model', 'DateTimeOriginal', 'GPSLatitude', 'GPSLongitude',\n      'LensModel', 'ExposureTime', 'FNumber', 'ISO'\n    ],\n    special_components: ['gps_map_mini', 'golden_hour_indicator'],\n    field_groups: {\n      'Camera': ['Make', 'Model', 'LensModel', 'Software'],\n      'Exposure': ['ExposureTime', 'FNumber', 'ISO'],\n      'Location': ['GPSLatitude', 'GPSLongitude', 'GPSAltitude'],\n    },\n  },\n  dslr_photo: {\n    display_name: 'DSLR/Mirrorless Photo',\n    description: 'Photo taken with a professional camera',\n    ui_template: 'exposure_triangle',\n    icon: 'camera',\n    color: 'purple',\n    priority_fields: [\n      'Make', 'Model', 'LensModel', 'ShutterCount', 'SerialNumber',\n      'ExposureTime', 'FNumber', 'ISO', 'FocalLength'\n    ],\n    special_components: ['exposure_triangle_diagram', 'lens_profile_viewer', 'shutter_count_analysis'],\n    field_groups: {\n      'Camera Body': ['Make', 'Model', 'SerialNumber', 'ShutterCount'],\n      'Lens': ['LensModel', 'FocalLength', 'MaxApertureValue'],\n      'Exposure': ['ExposureTime', 'FNumber', 'ISO'],\n    },\n  },\n  drone_photo: {\n    display_name: 'Drone/Aerial Photo',\n    description: 'Aerial photograph from a drone',\n    ui_template: 'map_centered',\n    icon: 'plane',\n    color: 'cyan',\n    priority_fields: [\n      'GPSLatitude', 'GPSLongitude', 'GPSAltitude', 'RelativeAltitude',\n      'GimbalRoll', 'GimbalPitch', 'Make', 'Model'\n    ],\n    special_components: ['aerial_map_overlay', 'altitude_chart', 'gimbal_orientation_3d'],\n    field_groups: {\n      'Flight Data': ['GPSAltitude', 'RelativeAltitude', 'FlightSpeed'],\n      'Gimbal': ['GimbalRoll', 'GimbalPitch', 'GimbalYaw'],\n      'Location': ['GPSLatitude', 'GPSLongitude'],\n    },\n  },\n  dicom_medical: {\n    display_name: 'Medical Image (DICOM)',\n    description: 'Medical imaging file',\n    ui_template: 'medical_context',\n    icon: 'heart-pulse',\n    color: 'red',\n    priority_fields: [\n      'PatientID', 'StudyDate', 'Modality', 'BodyPartExamined',\n      'Manufacturer', 'InstitutionName'\n    ],\n    special_components: ['body_part_diagram', 'dose_meter', 'anonymization_warning'],\n    field_groups: {\n      'Study': ['StudyDate', 'StudyDescription'],\n      'Patient': ['PatientID', 'BodyPartExamined'],\n      'Equipment': ['Manufacturer', 'InstitutionName'],\n    },\n  },\n  astronomy_fits: {\n    display_name: 'Astronomical Data (FITS)',\n    description: 'Astronomical observation',\n    ui_template: 'astronomy_context',\n    icon: 'star',\n    color: 'indigo',\n    priority_fields: [\n      'OBJECT', 'RA', 'DEC', 'EXPTIME', 'FILTER', 'TELESCOP', 'DATE-OBS'\n    ],\n    special_components: ['celestial_coordinate_overlay', 'star_chart_viewer'],\n    field_groups: {\n      'Target': ['OBJECT', 'RA', 'DEC'],\n      'Observation': ['DATE-OBS', 'EXPTIME', 'FILTER'],\n      'Equipment': ['TELESCOP', 'INSTRUME'],\n    },\n  },\n  ai_generated: {\n    display_name: 'AI-Generated Image',\n    description: 'Image created by AI',\n    ui_template: 'ai_generated',\n    icon: 'sparkles',\n    color: 'pink',\n    priority_fields: [\n      'Software', 'Creator', 'Prompt', 'Model', 'Seed', 'Steps'\n    ],\n    special_components: ['ai_model_badge', 'prompt_viewer', 'authenticity_warning'],\n    field_groups: {\n      'Generation': ['Software', 'Model', 'Prompt'],\n      'Parameters': ['Seed', 'Steps', 'CFGScale'],\n    },\n  },\n  edited_image: {\n    display_name: 'Edited Image',\n    description: 'Image edited in software',\n    ui_template: 'editing_history',\n    icon: 'wand',\n    color: 'amber',\n    priority_fields: [\n      'Software', 'HistoryAction', 'OriginalDocumentID', 'Make', 'Model'\n    ],\n    special_components: ['edit_history_timeline', 'software_chain_viewer'],\n    field_groups: {\n      'Edit History': ['Software', 'HistoryAction', 'EditingTime'],\n      'Original': ['OriginalDocumentID', 'DateTimeOriginal'],\n    },\n  },\n  generic_photo: {\n    display_name: 'Photo',\n    description: 'Standard photograph',\n    ui_template: 'default_photo',\n    icon: 'image',\n    color: 'slate',\n    priority_fields: [\n      'Make', 'Model', 'DateTimeOriginal', 'ImageWidth', 'ImageHeight',\n      'ExposureTime', 'FNumber', 'ISO'\n    ],\n    special_components: ['basic_exif_view'],\n    field_groups: {\n      'Camera': ['Make', 'Model'],\n      'Exposure': ['ExposureTime', 'FNumber', 'ISO'],\n      'Image': ['ImageWidth', 'ImageHeight'],\n    },\n  },\n  generic_file: {\n    display_name: 'File',\n    description: 'Generic file',\n    ui_template: 'default',\n    icon: 'file',\n    color: 'slate',\n    priority_fields: ['FileName', 'FileSize', 'FileType', 'MIMEType'],\n    special_components: [],\n    field_groups: {\n      'File': ['FileName', 'FileSize', 'FileType'],\n    },\n  },\n};\n\n// ============================================================================\n// Context Detection Logic (Client-side fallback)\n// ============================================================================\n\nfunction detectContextFromMetadata(metadata: Record<string, any>): FileContext {\n  const scores: Record<string, number> = {};\n  const evidence: Record<string, any> = {};\n\n  // Flatten metadata for easier searching\n  const flatMetadata: Record<string, string> = {};\n  const flatten = (obj: Record<string, any>, prefix = '') => {\n    for (const [key, value] of Object.entries(obj)) {\n      if (key.startsWith('_')) continue;\n      const fullKey = prefix ? `${prefix}.${key}` : key;\n      if (value && typeof value === 'object' && !Array.isArray(value)) {\n        flatten(value, fullKey);\n      } else {\n        flatMetadata[fullKey] = String(value);\n      }\n    }\n  };\n  flatten(metadata);\n\n  const make = (metadata.Make || metadata.exif?.Make || '').toLowerCase();\n  const model = (metadata.Model || metadata.exif?.Model || '').toLowerCase();\n  const software = (metadata.Software || '').toLowerCase();\n\n  // Smartphone detection\n  const smartphoneMakers = ['apple', 'iphone', 'samsung', 'google', 'pixel', 'huawei', 'xiaomi', 'oneplus'];\n  for (const maker of smartphoneMakers) {\n    if (make.includes(maker) || model.includes(maker)) {\n      scores['smartphone_photo'] = 0.85;\n      evidence['smartphone'] = { maker_match: maker };\n      break;\n    }\n  }\n\n  // Check for computational photography\n  const hasDepth = Object.keys(flatMetadata).some(k => k.toLowerCase().includes('depth'));\n  const hasLivePhoto = Object.keys(flatMetadata).some(k =>\n    k.toLowerCase().includes('livephoto') || k.toLowerCase().includes('motionphoto')\n  );\n  if (hasDepth || hasLivePhoto) {\n    scores['smartphone_photo'] = Math.max(scores['smartphone_photo'] || 0, 0.9);\n  }\n\n  // DSLR detection\n  const dslrMakers = ['canon eos', 'nikon', 'sony alpha', 'fujifilm', 'olympus', 'panasonic lumix'];\n  const combined = `${make} ${model}`;\n  for (const maker of dslrMakers) {\n    if (combined.includes(maker)) {\n      scores['dslr_photo'] = 0.85;\n      evidence['dslr'] = { maker_match: maker };\n      break;\n    }\n  }\n\n  // Shutter count indicates DSLR\n  if (metadata.ShutterCount || metadata.ImageCount || metadata.makernote?.ShutterCount) {\n    scores['dslr_photo'] = Math.max(scores['dslr_photo'] || 0, 0.9);\n    evidence['dslr'] = { ...evidence['dslr'], shutter_count: true };\n  }\n\n  // Drone detection\n  const droneMakers = ['dji', 'mavic', 'phantom', 'parrot', 'autel'];\n  for (const maker of droneMakers) {\n    if (combined.includes(maker)) {\n      scores['drone_photo'] = 0.95;\n      evidence['drone'] = { maker_match: maker };\n      break;\n    }\n  }\n\n  // Gimbal data indicates drone\n  const hasGimbal = Object.keys(flatMetadata).some(k => k.toLowerCase().includes('gimbal'));\n  const hasFlightData = Object.keys(flatMetadata).some(k =>\n    k.toLowerCase().includes('flightaltitude') || k.toLowerCase().includes('relativealtitude')\n  );\n  if (hasGimbal || hasFlightData) {\n    scores['drone_photo'] = Math.max(scores['drone_photo'] || 0, 0.9);\n  }\n\n  // AI-generated detection\n  const aiPatterns = ['midjourney', 'dall-e', 'stable diffusion', 'automatic1111', 'comfyui'];\n  const allValues = Object.values(flatMetadata).join(' ').toLowerCase();\n  for (const pattern of aiPatterns) {\n    if (allValues.includes(pattern)) {\n      scores['ai_generated'] = 0.95;\n      evidence['ai'] = { software_match: pattern };\n      break;\n    }\n  }\n\n  // Edited image detection\n  const editingSoftware = ['photoshop', 'lightroom', 'capture one', 'gimp', 'affinity'];\n  for (const sw of editingSoftware) {\n    if (software.includes(sw)) {\n      scores['edited_image'] = 0.85;\n      evidence['edited'] = { software_match: sw };\n      break;\n    }\n  }\n\n  // DICOM detection\n  if (metadata.PatientID || metadata.StudyDate || metadata.Modality) {\n    scores['dicom_medical'] = 0.95;\n  }\n\n  // FITS detection\n  if (metadata.SIMPLE || metadata.BITPIX || metadata.TELESCOP) {\n    scores['astronomy_fits'] = 0.95;\n  }\n\n  // Determine winner\n  let bestContext = 'generic_photo';\n  let bestScore = 0.3;\n\n  for (const [context, score] of Object.entries(scores)) {\n    if (score > bestScore) {\n      bestContext = context;\n      bestScore = score;\n    }\n  }\n\n  // Build alternatives\n  const alternatives: AlternativeContext[] = Object.entries(scores)\n    .filter(([ctx]) => ctx !== bestContext)\n    .sort((a, b) => b[1] - a[1])\n    .slice(0, 3)\n    .map(([ctx, conf]) => ({ context_type: ctx, confidence: conf }));\n\n  const profile = DEFAULT_PROFILES[bestContext] || DEFAULT_PROFILES['generic_file'];\n\n  return {\n    context_type: bestContext,\n    confidence: bestScore,\n    confidence_level: bestScore >= 0.75 ? 'high' : bestScore >= 0.5 ? 'medium' : 'low',\n    is_fallback: bestScore < 0.3,\n    detection_time_ms: 0,\n    profile,\n    alternative_contexts: alternatives,\n    evidence,\n  };\n}\n\n// ============================================================================\n// Context Provider\n// ============================================================================\n\nconst ContextAdapterContext = createContext<\n  (ContextAdapterState & ContextAdapterActions) | null\n>(null);\n\nexport function ContextAdapterProvider({ children }: { children: ReactNode }) {\n  const [currentContext, setCurrentContext] = useState<FileContext | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [viewMode, setViewMode] = useState<'simple' | 'advanced' | 'raw'>('simple');\n\n  const detectContext = useCallback((metadata: Record<string, any>, _filename: string) => {\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      // First try API call\n      // For now, use client-side detection as fallback\n      const startTime = performance.now();\n      const result = detectContextFromMetadata(metadata);\n      result.detection_time_ms = performance.now() - startTime;\n\n      setCurrentContext(result);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Context detection failed');\n      // Fallback to generic\n      setCurrentContext({\n        context_type: 'generic_file',\n        confidence: 0.1,\n        confidence_level: 'uncertain',\n        is_fallback: true,\n        detection_time_ms: 0,\n        profile: DEFAULT_PROFILES['generic_file'],\n        alternative_contexts: [],\n        evidence: {},\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n\n  const resetContext = useCallback(() => {\n    setCurrentContext(null);\n    setError(null);\n  }, []);\n\n  const overrideContext = useCallback((contextType: string) => {\n    if (currentContext) {\n      const profile = DEFAULT_PROFILES[contextType] || DEFAULT_PROFILES['generic_file'];\n      setCurrentContext({\n        ...currentContext,\n        context_type: contextType,\n        profile,\n        confidence: 1.0, // Manual override = full confidence\n        confidence_level: 'high',\n        is_fallback: false,\n      });\n    }\n  }, [currentContext]);\n\n  const value = useMemo(\n    () => ({\n      currentContext,\n      isLoading,\n      error,\n      viewMode,\n      detectContext,\n      setViewMode,\n      resetContext,\n      overrideContext,\n    }),\n    [currentContext, isLoading, error, viewMode, detectContext, resetContext, overrideContext]\n  );\n\n  return (\n    <ContextAdapterContext.Provider value={value}>\n      {children}\n    </ContextAdapterContext.Provider>\n  );\n}\n\nexport function useContextAdapter() {\n  const context = useContext(ContextAdapterContext);\n  if (!context) {\n    throw new Error('useContextAdapter must be used within a ContextAdapterProvider');\n  }\n  return context;\n}\n\n// ============================================================================\n// Utility Hooks\n// ============================================================================\n\n/**\n * Get priority fields for the current context\n */\nexport function usePriorityFields(metadata: Record<string, any>) {\n  const { currentContext } = useContextAdapter();\n\n  return useMemo(() => {\n    if (!currentContext) return [];\n\n    const priorityFields = currentContext.profile.priority_fields;\n    return priorityFields.filter(field => {\n      // Check if field exists in metadata (including nested)\n      const keys = field.split('.');\n      let value: any = metadata;\n      for (const key of keys) {\n        value = value?.[key];\n        if (value === undefined) break;\n      }\n      return value !== undefined && value !== null && value !== '';\n    });\n  }, [currentContext, metadata]);\n}\n\n/**\n * Get field groups organized by the current context\n */\nexport function useFieldGroups(metadata: Record<string, any>) {\n  const { currentContext } = useContextAdapter();\n\n  return useMemo(() => {\n    if (!currentContext) return {};\n\n    const groups = currentContext.profile.field_groups;\n    const result: Record<string, Array<{ key: string; value: any }>> = {};\n\n    for (const [groupName, fields] of Object.entries(groups)) {\n      result[groupName] = fields\n        .map(field => {\n          let value = metadata[field];\n          // Check nested paths\n          if (value === undefined) {\n            const parts = field.split('.');\n            value = metadata;\n            for (const part of parts) {\n              value = value?.[part];\n            }\n          }\n          return { key: field, value };\n        })\n        .filter(item => item.value !== undefined && item.value !== null);\n    }\n\n    return result;\n  }, [currentContext, metadata]);\n}\n\n/**\n * Check if a special component should be shown\n */\nexport function useSpecialComponents() {\n  const { currentContext } = useContextAdapter();\n\n  return useMemo(() => {\n    if (!currentContext) return [];\n    return currentContext.profile.special_components;\n  }, [currentContext]);\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/hooks/use-mobile.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/hooks/use-toast.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'actionTypes' is assigned a value but only used as a type.","line":18,"column":7,"nodeType":null,"messageId":"usedOnlyAsType","endLine":18,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/hooks/useKeyFindings.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1063,1066],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1063,1066],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * useKeyFindings Hook\n *\n * Custom React hook to extract and manage key findings from metadata.\n * Handles loading states and error cases gracefully.\n */\n\nimport { useMemo } from 'react';\nimport { extractKeyFindings, KeyFindings } from '@/utils/metadataTransformers';\n\ninterface UseKeyFindingsOptions {\n  skipWhen?: boolean;\n  skipWhere?: boolean;\n  skipDevice?: boolean;\n  skipAuthenticity?: boolean;\n}\n\ninterface UseKeyFindingsResult {\n  findings: KeyFindings | null;\n  isLoading: boolean;\n  error: Error | null;\n}\n\n/**\n * Hook to extract key findings from metadata\n *\n * @param metadata - Raw metadata object from extraction\n * @param options - Options to control which findings to include\n * @returns Object containing findings, loading state, and any errors\n *\n * @example\n * ```tsx\n * const { findings, error } = useKeyFindings(metadata);\n *\n * if (error) return <div>Error: {error.message}</div>;\n * if (!findings) return <div>No findings</div>;\n *\n * return <KeyFindings findings={findings} />;\n * ```\n */\nexport function useKeyFindings(\n  metadata: any | null | undefined,\n  options: UseKeyFindingsOptions = {}\n): UseKeyFindingsResult {\n  const { \n    skipWhen = false,\n    skipWhere = false,\n    skipDevice = false,\n    skipAuthenticity = false\n  } = options;\n\n  const result = useMemo<UseKeyFindingsResult>(() => {\n    try {\n      if (!metadata) {\n        return {\n          findings: null,\n          isLoading: false,\n          error: null\n        };\n      }\n\n      // Extract findings\n      const findings = extractKeyFindings(metadata);\n\n      // Apply skip options\n      const filtered: KeyFindings = {\n        ...findings,\n        when: skipWhen ? null : findings.when,\n        where: skipWhere ? null : findings.where,\n        device: skipDevice ? null : findings.device,\n        authenticity: skipAuthenticity ? findings.authenticity : findings.authenticity\n      };\n\n      return {\n        findings: filtered,\n        isLoading: false,\n        error: null\n      };\n    } catch (error) {\n      return {\n        findings: null,\n        isLoading: false,\n        error: error instanceof Error ? error : new Error(String(error))\n      };\n    }\n  }, [metadata, skipWhen, skipWhere, skipDevice, skipAuthenticity]);\n\n  return result;\n}\n\n/**\n * Hook to check if any findings are available\n *\n * @param findings - Key findings object\n * @returns True if at least one finding is available\n */\nexport function useHasFindings(findings: KeyFindings | null): boolean {\n  return useMemo(() => {\n    if (!findings) return false;\n    return !!(findings.when || findings.where || findings.device);\n  }, [findings]);\n}\n\n/**\n * Hook to get a summary string of findings\n *\n * @param findings - Key findings object\n * @returns Human-readable summary of findings\n *\n * @example\n * ```\n * \"Captured on January 3, 2025 in San Francisco with iPhone 15 Pro\"\n * ```\n */\nexport function useKeyFindingsSummary(findings: KeyFindings | null): string {\n  return useMemo(() => {\n    if (!findings) return '';\n\n    const parts = [];\n\n    if (findings.when) {\n      parts.push(`Captured on ${findings.when}`);\n    }\n\n    if (findings.where) {\n      parts.push(`in ${findings.where}`);\n    }\n\n    if (findings.device) {\n      parts.push(`with ${findings.device}`);\n    }\n\n    return parts.join(' ');\n  }, [findings]);\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/hooks/useLazyLoad.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/accessibility-config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/accessibility-context.tsx","messages":[{"ruleId":"@typescript-eslint/no-empty-function","severity":1,"message":"Unexpected empty arrow function.","line":216,"column":34,"nodeType":"ArrowFunctionExpression","messageId":"unexpected","endLine":216,"endColumn":36,"suggestions":[{"messageId":"suggestComment","data":{"name":"arrow function"},"fix":{"range":[7034,7034],"text":" /* empty */ "},"desc":"Add comment inside empty arrow function."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Accessibility Context Provider\n * \n * Provides centralized accessibility state management and utilities for the application.\n * Manages focus, ARIA announcements, keyboard navigation, and user preferences.\n * \n * @module accessibility-context\n * @validates Requirements 1.1, 1.2, 1.3, 1.5 - Core accessibility infrastructure\n */\n\nimport React, { createContext, useContext, useEffect, useState, useCallback, useRef, useMemo } from 'react';\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface AccessibilityState {\n  // Motion preferences\n  prefersReducedMotion: boolean;\n  \n  // Focus management\n  focusVisible: boolean;\n  focusWithin: boolean;\n  \n  // Screen reader state\n  announcements: string[];\n  liveRegionContent: string;\n  \n  // Keyboard navigation\n  keyboardNavigation: boolean;\n  currentFocusId: string | null;\n  \n  // High contrast mode\n  highContrast: boolean;\n  \n  // Touch/mobile preferences\n  prefersTouchTargets: boolean;\n}\n\nexport interface AccessibilityActions {\n  // Announcements\n  announce: (message: string, priority?: 'polite' | 'assertive') => void;\n  clearAnnouncements: () => void;\n  \n  // Focus management\n  setFocusVisible: (visible: boolean) => void;\n  setCurrentFocus: (elementId: string | null) => void;\n  trapFocus: (containerId: string) => () => void;\n  \n  // Keyboard navigation\n  setKeyboardNavigation: (enabled: boolean) => void;\n  \n  // Preferences\n  toggleHighContrast: () => void;\n  updateMotionPreference: () => void;\n}\n\nexport interface AccessibilityContextValue extends AccessibilityState, AccessibilityActions {\n  // Utility functions\n  isReducedMotion: () => boolean;\n  shouldShowFocusRing: () => boolean;\n  getAriaLiveRegion: () => HTMLElement | null;\n}\n\n// ============================================================================\n// Context\n// ============================================================================\n\nconst AccessibilityContext = createContext<AccessibilityContextValue | undefined>(undefined);\n\n// ============================================================================\n// Provider Component\n// ============================================================================\n\nexport interface AccessibilityProviderProps {\n  children: React.ReactNode;\n}\n\nexport function AccessibilityProvider({ children }: AccessibilityProviderProps) {\n  // State\n  const [state, setState] = useState<AccessibilityState>({\n    prefersReducedMotion: false,\n    focusVisible: false,\n    focusWithin: false,\n    announcements: [],\n    liveRegionContent: '',\n    keyboardNavigation: false,\n    currentFocusId: null,\n    highContrast: false,\n    prefersTouchTargets: false,\n  });\n  \n  // Refs for managing DOM elements\n  const liveRegionRef = useRef<HTMLElement | null>(null);\n  const focusTrapRef = useRef<{\n    container: HTMLElement;\n    firstElement: HTMLElement;\n    lastElement: HTMLElement;\n    returnElement: HTMLElement;\n  } | null>(null);\n  \n  // Initialize accessibility preferences\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n    \n    // Check for reduced motion preference\n    const mediaQuery = window.matchMedia('(prefers-reduced-motion: reduce)');\n    const updateMotionPreference = () => {\n      setState(prev => ({ ...prev, prefersReducedMotion: mediaQuery.matches }));\n    };\n    \n    updateMotionPreference();\n    mediaQuery.addEventListener('change', updateMotionPreference);\n    \n    // Check for high contrast preference\n    const contrastQuery = window.matchMedia('(prefers-contrast: high)');\n    const updateContrastPreference = () => {\n      setState(prev => ({ ...prev, highContrast: contrastQuery.matches }));\n    };\n    \n    updateContrastPreference();\n    contrastQuery.addEventListener('change', updateContrastPreference);\n    \n    // Check for touch device\n    const touchQuery = window.matchMedia('(pointer: coarse)');\n    const updateTouchPreference = () => {\n      setState(prev => ({ ...prev, prefersTouchTargets: touchQuery.matches }));\n    };\n    \n    updateTouchPreference();\n    touchQuery.addEventListener('change', updateTouchPreference);\n    \n    // Keyboard navigation detection\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === 'Tab') {\n        setState(prev => ({ ...prev, keyboardNavigation: true, focusVisible: true }));\n      }\n    };\n    \n    const handleMouseDown = () => {\n      setState(prev => ({ ...prev, keyboardNavigation: false, focusVisible: false }));\n    };\n    \n    document.addEventListener('keydown', handleKeyDown);\n    document.addEventListener('mousedown', handleMouseDown);\n    \n    return () => {\n      mediaQuery.removeEventListener('change', updateMotionPreference);\n      contrastQuery.removeEventListener('change', updateContrastPreference);\n      touchQuery.removeEventListener('change', updateTouchPreference);\n      document.removeEventListener('keydown', handleKeyDown);\n      document.removeEventListener('mousedown', handleMouseDown);\n    };\n  }, []);\n  \n  // Create or get ARIA live region\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n    \n    let liveRegion = document.getElementById('accessibility-live-region');\n    if (!liveRegion) {\n      liveRegion = document.createElement('div');\n      liveRegion.id = 'accessibility-live-region';\n      liveRegion.setAttribute('aria-live', 'polite');\n      liveRegion.setAttribute('aria-atomic', 'true');\n      liveRegion.className = 'sr-only';\n      document.body.appendChild(liveRegion);\n    }\n    liveRegionRef.current = liveRegion;\n    \n    return () => {\n      if (liveRegion && liveRegion.parentNode) {\n        liveRegion.parentNode.removeChild(liveRegion);\n      }\n    };\n  }, []);\n  \n  // Actions\n  const announce = useCallback((message: string, priority: 'polite' | 'assertive' = 'polite') => {\n    setState(prev => ({\n      ...prev,\n      announcements: [...prev.announcements, message],\n      liveRegionContent: message,\n    }));\n    \n    if (liveRegionRef.current) {\n      liveRegionRef.current.setAttribute('aria-live', priority);\n      liveRegionRef.current.textContent = message;\n      \n      // Clear after announcement\n      setTimeout(() => {\n        if (liveRegionRef.current) {\n          liveRegionRef.current.textContent = '';\n        }\n      }, 1000);\n    }\n  }, []);\n  \n  const clearAnnouncements = useCallback(() => {\n    setState(prev => ({ ...prev, announcements: [], liveRegionContent: '' }));\n    if (liveRegionRef.current) {\n      liveRegionRef.current.textContent = '';\n    }\n  }, []);\n  \n  const setFocusVisible = useCallback((visible: boolean) => {\n    setState(prev => ({ ...prev, focusVisible: visible }));\n  }, []);\n  \n  const setCurrentFocus = useCallback((elementId: string | null) => {\n    setState(prev => ({ ...prev, currentFocusId: elementId }));\n  }, []);\n  \n  const trapFocus = useCallback((containerId: string) => {\n    const container = document.getElementById(containerId);\n    if (!container) return () => {};\n    \n    const focusableElements = container.querySelectorAll(\n      'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n    );\n    \n    const firstElement = focusableElements[0] as HTMLElement;\n    const lastElement = focusableElements[focusableElements.length - 1] as HTMLElement;\n    const returnElement = document.activeElement as HTMLElement;\n    \n    focusTrapRef.current = { container, firstElement, lastElement, returnElement };\n    \n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key !== 'Tab') return;\n      \n      if (e.shiftKey) {\n        if (document.activeElement === firstElement) {\n          e.preventDefault();\n          lastElement?.focus();\n        }\n      } else {\n        if (document.activeElement === lastElement) {\n          e.preventDefault();\n          firstElement?.focus();\n        }\n      }\n    };\n    \n    container.addEventListener('keydown', handleKeyDown);\n    firstElement?.focus();\n    \n    return () => {\n      container.removeEventListener('keydown', handleKeyDown);\n      if (focusTrapRef.current?.returnElement) {\n        focusTrapRef.current.returnElement.focus();\n      }\n      focusTrapRef.current = null;\n    };\n  }, []);\n  \n  const setKeyboardNavigation = useCallback((enabled: boolean) => {\n    setState(prev => ({ ...prev, keyboardNavigation: enabled }));\n  }, []);\n  \n  const toggleHighContrast = useCallback(() => {\n    setState(prev => ({ ...prev, highContrast: !prev.highContrast }));\n  }, []);\n  \n  const updateMotionPreference = useCallback(() => {\n    if (typeof window === 'undefined') return;\n    const mediaQuery = window.matchMedia('(prefers-reduced-motion: reduce)');\n    setState(prev => ({ ...prev, prefersReducedMotion: mediaQuery.matches }));\n  }, []);\n  \n  // Utility functions\n  const isReducedMotion = useCallback(() => state.prefersReducedMotion, [state.prefersReducedMotion]);\n  \n  const shouldShowFocusRing = useCallback(() => {\n    return state.keyboardNavigation && state.focusVisible;\n  }, [state.keyboardNavigation, state.focusVisible]);\n  \n  const getAriaLiveRegion = useCallback(() => liveRegionRef.current, []);\n  \n  const value = useMemo<AccessibilityContextValue>(() => ({\n    ...state,\n    announce,\n    clearAnnouncements,\n    setFocusVisible,\n    setCurrentFocus,\n    trapFocus,\n    setKeyboardNavigation,\n    toggleHighContrast,\n    updateMotionPreference,\n    isReducedMotion,\n    shouldShowFocusRing,\n    getAriaLiveRegion,\n  }), [\n    state,\n    announce,\n    clearAnnouncements,\n    setFocusVisible,\n    setCurrentFocus,\n    trapFocus,\n    setKeyboardNavigation,\n    toggleHighContrast,\n    updateMotionPreference,\n    isReducedMotion,\n    shouldShowFocusRing,\n    getAriaLiveRegion,\n  ]);\n  \n  return (\n    <AccessibilityContext.Provider value={value}>\n      {children}\n    </AccessibilityContext.Provider>\n  );\n}\n\n// ============================================================================\n// Hook\n// ============================================================================\n\n/**\n * Hook to access accessibility context\n * @throws Error if used outside AccessibilityProvider\n */\nexport function useAccessibility(): AccessibilityContextValue {\n  const context = useContext(AccessibilityContext);\n  if (context === undefined) {\n    throw new Error('useAccessibility must be used within an AccessibilityProvider');\n  }\n  return context;\n}\n\n// ============================================================================\n// Utility Hooks\n// ============================================================================\n\n/**\n * Hook for managing focus trapping in modals/dialogs\n */\nexport function useFocusTrap(isActive: boolean, containerId?: string) {\n  const { trapFocus } = useAccessibility();\n  \n  useEffect(() => {\n    if (!isActive || !containerId) return;\n    \n    const cleanup = trapFocus(containerId);\n    return cleanup;\n  }, [isActive, containerId, trapFocus]);\n}\n\n/**\n * Hook for making announcements to screen readers\n */\nexport function useAnnounce() {\n  const { announce } = useAccessibility();\n  return announce;\n}\n\n/**\n * Hook for detecting keyboard navigation\n */\nexport function useKeyboardNavigation() {\n  const { keyboardNavigation, shouldShowFocusRing } = useAccessibility();\n  return { keyboardNavigation, shouldShowFocusRing };\n}\n\n/**\n * Hook for respecting motion preferences\n */\nexport function useMotionPreference() {\n  const { prefersReducedMotion, isReducedMotion } = useAccessibility();\n  return { prefersReducedMotion, isReducedMotion };\n}\n\nexport default AccessibilityProvider;","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/accessibility-utils.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2189,2192],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2189,2192],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":100,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2543,2546],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2543,2546],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-empty-function","severity":1,"message":"Unexpected empty arrow function.","line":282,"column":18,"nodeType":"ArrowFunctionExpression","messageId":"unexpected","endLine":282,"endColumn":20,"suggestions":[{"messageId":"suggestComment","data":{"name":"arrow function"},"fix":{"range":[7148,7148],"text":" /* empty */ "},"desc":"Add comment inside empty arrow function."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Accessibility Utilities\n *\n * Core utilities for managing ARIA attributes, focus management, and accessibility features.\n * These utilities provide the foundation for all accessibility enhancements.\n *\n * @module accessibility-utils\n * @validates Requirements 1.1, 1.5, 2.2, 2.4, 2.5 - ARIA management and utilities\n */\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface ARIAAttributes {\n  // Labels and descriptions\n  'aria-label'?: string;\n  'aria-labelledby'?: string;\n  'aria-describedby'?: string;\n\n  // States and properties\n  'aria-expanded'?: boolean;\n  'aria-selected'?: boolean;\n  'aria-checked'?: boolean | 'mixed';\n  'aria-disabled'?: boolean;\n  'aria-required'?: boolean;\n  'aria-invalid'?: boolean | 'grammar' | 'spelling';\n  'aria-hidden'?: boolean;\n\n  // Live regions\n  'aria-live'?: 'off' | 'polite' | 'assertive';\n  'aria-atomic'?: boolean;\n  'aria-relevant'?: 'additions' | 'removals' | 'text' | 'all';\n\n  // Relationships\n  'aria-controls'?: string;\n  'aria-owns'?: string;\n  'aria-flowto'?: string;\n\n  // Roles\n  role?: string;\n\n  // Values\n  'aria-valuenow'?: number;\n  'aria-valuemin'?: number;\n  'aria-valuemax'?: number;\n  'aria-valuetext'?: string;\n\n  // Modal\n  'aria-modal'?: boolean;\n\n  // Other\n  tabIndex?: number;\n}\n\nexport interface FocusableElement {\n  element: HTMLElement;\n  tabIndex: number;\n  isVisible: boolean;\n}\n\n// ============================================================================\n// ARIA Utilities\n// ============================================================================\n\n/**\n * Generates a unique ID for ARIA relationships\n */\nexport function generateAriaId(prefix: string = 'aria'): string {\n  return `${prefix}-${Math.random().toString(36).substring(2, 11)}`;\n}\n\n/**\n * Creates ARIA attributes object with proper typing\n */\nexport function createAriaAttributes(\n  attributes: Partial<ARIAAttributes>\n): ARIAAttributes {\n  const result: ARIAAttributes = {};\n\n  Object.entries(attributes).forEach(([key, value]) => {\n    if (value !== undefined && value !== null) {\n      (result as any)[key] = value;\n    }\n  });\n\n  return result;\n}\n\n/**\n * Sets ARIA attributes on an element\n */\nexport function setAriaAttributes(\n  element: HTMLElement,\n  attributes: ARIAAttributes\n): void {\n  Object.entries(attributes).forEach(([key, value]) => {\n    if (value !== undefined && value !== null) {\n      if (key === 'tabIndex') {\n        (element as any)[key] = value;\n      } else {\n        element.setAttribute(key, String(value));\n      }\n    }\n  });\n}\n\n/**\n * Creates an accessible button with proper ARIA attributes\n */\nexport function createAccessibleButton(\n  text: string,\n  onClick: () => void,\n  options: {\n    ariaLabel?: string;\n    ariaDescribedBy?: string;\n    disabled?: boolean;\n    className?: string;\n  } = {}\n): HTMLButtonElement {\n  const button = document.createElement('button');\n  button.textContent = text;\n  button.onclick = onClick;\n\n  const ariaAttrs = createAriaAttributes({\n    'aria-label': options.ariaLabel,\n    'aria-describedby': options.ariaDescribedBy,\n    'aria-disabled': options.disabled,\n  });\n\n  setAriaAttributes(button, ariaAttrs);\n\n  if (options.className) {\n    button.className = options.className;\n  }\n\n  if (options.disabled) {\n    button.disabled = true;\n  }\n\n  return button;\n}\n\n/**\n * Creates an accessible input with proper labeling\n */\nexport function createAccessibleInput(\n  type: string,\n  labelText: string,\n  options: {\n    required?: boolean;\n    ariaDescribedBy?: string;\n    placeholder?: string;\n    value?: string;\n    id?: string;\n  } = {}\n): { input: HTMLInputElement; label: HTMLLabelElement } {\n  const id = options.id || generateAriaId('input');\n\n  const input = document.createElement('input');\n  input.type = type;\n  input.id = id;\n\n  const label = document.createElement('label');\n  label.textContent = labelText;\n  label.htmlFor = id;\n\n  const ariaAttrs = createAriaAttributes({\n    'aria-required': options.required,\n    'aria-describedby': options.ariaDescribedBy,\n  });\n\n  setAriaAttributes(input, ariaAttrs);\n\n  if (options.placeholder) input.placeholder = options.placeholder;\n  if (options.value) input.value = options.value;\n  if (options.required) input.required = true;\n\n  return { input, label };\n}\n\n// ============================================================================\n// Focus Management\n// ============================================================================\n\n/**\n * Gets all focusable elements within a container\n */\nexport function getFocusableElements(\n  container: HTMLElement\n): FocusableElement[] {\n  const focusableSelectors = [\n    'button:not([disabled])',\n    '[href]',\n    'input:not([disabled])',\n    'select:not([disabled])',\n    'textarea:not([disabled])',\n    '[tabindex]:not([tabindex=\"-1\"])',\n    '[contenteditable=\"true\"]',\n  ].join(', ');\n\n  const elements = Array.from(\n    container.querySelectorAll(focusableSelectors)\n  ) as HTMLElement[];\n\n  return elements\n    .map(element => ({\n      element,\n      tabIndex: element.tabIndex,\n      isVisible: isElementVisible(element),\n    }))\n    .filter(item => item.isVisible)\n    .sort((a, b) => {\n      // Sort by tab index, then by DOM order\n      if (a.tabIndex !== b.tabIndex) {\n        if (a.tabIndex === 0) return 1;\n        if (b.tabIndex === 0) return -1;\n        return a.tabIndex - b.tabIndex;\n      }\n      return 0;\n    });\n}\n\n/**\n * Checks if an element is visible and focusable\n */\nexport function isElementVisible(element: HTMLElement): boolean {\n  const style = window.getComputedStyle(element);\n  // In JSDOM offsetWidth/offsetHeight are not reliable, so rely on computed styles and absence of 'hidden' attribute\n  const hasHiddenAttr = element.hasAttribute('hidden');\n  return (\n    !hasHiddenAttr &&\n    style.display !== 'none' &&\n    style.visibility !== 'hidden' &&\n    style.opacity !== '0'\n  );\n}\n\n/**\n * Moves focus to the next focusable element\n */\nexport function focusNext(container: HTMLElement = document.body): boolean {\n  const focusableElements = getFocusableElements(container);\n  const currentIndex = focusableElements.findIndex(\n    item => item.element === document.activeElement\n  );\n\n  const nextIndex = currentIndex + 1;\n  if (nextIndex < focusableElements.length) {\n    focusableElements[nextIndex].element.focus();\n    return true;\n  }\n\n  return false;\n}\n\n/**\n * Moves focus to the previous focusable element\n */\nexport function focusPrevious(container: HTMLElement = document.body): boolean {\n  const focusableElements = getFocusableElements(container);\n  const currentIndex = focusableElements.findIndex(\n    item => item.element === document.activeElement\n  );\n\n  const prevIndex = currentIndex - 1;\n  if (prevIndex >= 0) {\n    focusableElements[prevIndex].element.focus();\n    return true;\n  }\n\n  return false;\n}\n\n/**\n * Traps focus within a container\n */\nexport function trapFocus(container: HTMLElement): () => void {\n  const focusableElements = getFocusableElements(container);\n\n  if (focusableElements.length === 0) {\n    return () => {};\n  }\n\n  const firstElement = focusableElements[0].element;\n  const lastElement = focusableElements[focusableElements.length - 1].element;\n  const previousActiveElement = document.activeElement as HTMLElement;\n\n  // Focus the first element\n  firstElement.focus();\n\n  const handleKeyDown = (e: KeyboardEvent) => {\n    if (e.key !== 'Tab') return;\n\n    if (e.shiftKey) {\n      // Shift + Tab\n      if (document.activeElement === firstElement) {\n        e.preventDefault();\n        lastElement.focus();\n      }\n    } else {\n      // Tab\n      if (document.activeElement === lastElement) {\n        e.preventDefault();\n        firstElement.focus();\n      }\n    }\n  };\n\n  container.addEventListener('keydown', handleKeyDown);\n\n  // Return cleanup function\n  return () => {\n    container.removeEventListener('keydown', handleKeyDown);\n    if (\n      previousActiveElement &&\n      typeof previousActiveElement.focus === 'function'\n    ) {\n      previousActiveElement.focus();\n    }\n  };\n}\n\n// ============================================================================\n// Live Region Management\n// ============================================================================\n\n/**\n * Creates or updates an ARIA live region\n */\nexport function createLiveRegion(\n  id: string,\n  priority: 'polite' | 'assertive' = 'polite'\n): HTMLElement {\n  let liveRegion = document.getElementById(id);\n\n  if (!liveRegion) {\n    liveRegion = document.createElement('div');\n    liveRegion.id = id;\n    liveRegion.className = 'sr-only';\n    document.body.appendChild(liveRegion);\n  }\n\n  liveRegion.setAttribute('aria-live', priority);\n  liveRegion.setAttribute('aria-atomic', 'true');\n\n  return liveRegion;\n}\n\n/**\n * Announces a message to screen readers\n */\nexport function announceToScreenReader(\n  message: string,\n  priority: 'polite' | 'assertive' = 'polite',\n  regionId: string = 'accessibility-announcements'\n): void {\n  const liveRegion = createLiveRegion(regionId, priority);\n\n  // Clear previous content\n  liveRegion.textContent = '';\n\n  // Use setTimeout to ensure the change is detected\n  setTimeout(() => {\n    liveRegion.textContent = message;\n  }, 100);\n\n  // Clear after announcement\n  setTimeout(() => {\n    liveRegion.textContent = '';\n  }, 1000);\n}\n\n// ============================================================================\n// Color Contrast Utilities\n// ============================================================================\n\n/**\n * Calculates the contrast ratio between two colors\n */\nexport function calculateContrastRatio(color1: string, color2: string): number {\n  const luminance1 = getRelativeLuminance(color1);\n  const luminance2 = getRelativeLuminance(color2);\n\n  const lighter = Math.max(luminance1, luminance2);\n  const darker = Math.min(luminance1, luminance2);\n\n  return (lighter + 0.05) / (darker + 0.05);\n}\n\n/**\n * Gets the relative luminance of a color\n */\nfunction getRelativeLuminance(color: string): number {\n  const rgb = hexToRgb(color);\n  if (!rgb) return 0;\n\n  const [r, g, b] = [rgb.r, rgb.g, rgb.b].map(c => {\n    c = c / 255;\n    return c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);\n  });\n\n  return 0.2126 * r + 0.7152 * g + 0.0722 * b;\n}\n\n/**\n * Converts hex color to RGB\n */\nfunction hexToRgb(hex: string): { r: number; g: number; b: number } | null {\n  const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n  return result\n    ? {\n        r: parseInt(result[1], 16),\n        g: parseInt(result[2], 16),\n        b: parseInt(result[3], 16),\n      }\n    : null;\n}\n\n/**\n * Checks if a color combination meets WCAG contrast requirements\n */\nexport function meetsContrastRequirement(\n  foreground: string,\n  background: string,\n  level: 'AA' | 'AAA' = 'AA',\n  isLargeText: boolean = false\n): boolean {\n  const ratio = calculateContrastRatio(foreground, background);\n\n  if (level === 'AAA') {\n    return isLargeText ? ratio >= 4.5 : ratio >= 7;\n  }\n\n  // AA level\n  return isLargeText ? ratio >= 3 : ratio >= 4.5;\n}\n\n// ============================================================================\n// Keyboard Navigation Utilities\n// ============================================================================\n\n/**\n * Standard keyboard event handlers\n */\nexport const keyboardHandlers = {\n  /**\n   * Handles Enter and Space key activation\n   */\n  activateOnEnterOrSpace: (callback: () => void) => (e: KeyboardEvent) => {\n    if (e.key === 'Enter' || e.key === ' ') {\n      e.preventDefault();\n      callback();\n    }\n  },\n\n  /**\n   * Handles Escape key\n   */\n  closeOnEscape: (callback: () => void) => (e: KeyboardEvent) => {\n    if (e.key === 'Escape') {\n      e.preventDefault();\n      callback();\n    }\n  },\n\n  /**\n   * Handles arrow key navigation\n   */\n  arrowNavigation:\n    (\n      onUp: () => void,\n      onDown: () => void,\n      onLeft?: () => void,\n      onRight?: () => void\n    ) =>\n    (e: KeyboardEvent) => {\n      switch (e.key) {\n        case 'ArrowUp':\n          e.preventDefault();\n          onUp();\n          break;\n        case 'ArrowDown':\n          e.preventDefault();\n          onDown();\n          break;\n        case 'ArrowLeft':\n          if (onLeft) {\n            e.preventDefault();\n            onLeft();\n          }\n          break;\n        case 'ArrowRight':\n          if (onRight) {\n            e.preventDefault();\n            onRight();\n          }\n          break;\n      }\n    },\n};\n\n// ============================================================================\n// Skip Links Utilities\n// ============================================================================\n\n/**\n * Creates a skip link element\n */\nexport function createSkipLink(\n  text: string,\n  targetId: string,\n  className: string = 'skip-link'\n): HTMLAnchorElement {\n  const skipLink = document.createElement('a');\n  skipLink.href = `#${targetId}`;\n  skipLink.textContent = text;\n  skipLink.className = className;\n\n  skipLink.addEventListener('click', e => {\n    e.preventDefault();\n    const target = document.getElementById(targetId);\n    if (target) {\n      target.focus();\n      target.scrollIntoView({ behavior: 'smooth', block: 'start' });\n    }\n  });\n\n  return skipLink;\n}\n\n// ============================================================================\n// Validation Utilities\n// ============================================================================\n\n/**\n * Validates that an element has proper accessibility attributes\n */\nexport function validateAccessibility(element: HTMLElement): {\n  isValid: boolean;\n  errors: string[];\n  warnings: string[];\n} {\n  const errors: string[] = [];\n  const warnings: string[] = [];\n\n  // Check for interactive elements without labels\n  const interactiveElements = ['button', 'input', 'select', 'textarea'];\n  if (interactiveElements.includes(element.tagName.toLowerCase())) {\n    const hasLabel =\n      element.getAttribute('aria-label') ||\n      element.getAttribute('aria-labelledby') ||\n      (element.tagName.toLowerCase() === 'input' &&\n        document.querySelector(`label[for=\"${element.id}\"]`));\n\n    if (!hasLabel) {\n      errors.push('Interactive element missing accessible label');\n    }\n  }\n\n  // Check for images without alt text\n  if (element.tagName.toLowerCase() === 'img') {\n    const hasAlt = element.hasAttribute('alt');\n    if (!hasAlt) {\n      errors.push('Image missing alt attribute');\n    }\n  }\n\n  // Check for proper heading hierarchy\n  if (element.tagName.match(/^H[1-6]$/)) {\n    const level = parseInt(element.tagName.charAt(1));\n    const prevHeading = element.previousElementSibling;\n    if (prevHeading && prevHeading.tagName.match(/^H[1-6]$/)) {\n      const prevLevel = parseInt(prevHeading.tagName.charAt(1));\n      if (level > prevLevel + 1) {\n        warnings.push(\n          'Heading level skipped - may confuse screen reader users'\n        );\n      }\n    }\n  }\n\n  return {\n    isValid: errors.length === 0,\n    errors,\n    warnings,\n  };\n}\n\nexport default {\n  generateAriaId,\n  createAriaAttributes,\n  setAriaAttributes,\n  createAccessibleButton,\n  createAccessibleInput,\n  getFocusableElements,\n  isElementVisible,\n  focusNext,\n  focusPrevious,\n  trapFocus,\n  createLiveRegion,\n  announceToScreenReader,\n  calculateContrastRatio,\n  meetsContrastRequirement,\n  keyboardHandlers,\n  createSkipLink,\n  validateAccessibility,\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/achievements/achievement-tracker.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'progressId' is assigned a value but never used.","line":419,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":419,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":716,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":716,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20522,20525],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20522,20525],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Achievement System - Badge system for onboarding and engagement\n */\n\nexport interface Achievement {\n  id: string;\n  name: string;\n  description: string;\n  icon: string;\n  points: number;\n  category: 'onboarding' | 'exploration' | 'expertise' | 'engagement' | 'collaboration';\n  requirements: AchievementRequirement[];\n  rarity: 'common' | 'uncommon' | 'rare' | 'epic' | 'legendary';\n  unlockedAt?: Date;\n  unlockedBy?: string;\n}\n\nexport interface AchievementRequirement {\n  type: 'action_count' | 'time_spent' | 'feature_used' | 'tutorial_completed' | 'result_shared' | 'team_activity';\n  action: string;\n  targetValue: number;\n  currentValue: number;\n  completed: boolean;\n}\n\nexport interface UserAchievement {\n  userId: string;\n  achievementId: string;\n  unlockedAt: Date;\n  progress: number; // For achievements that have progress\n  completed: boolean;\n  pointsEarned: number;\n}\n\nexport interface AchievementProgress {\n  userId: string;\n  achievementId: string;\n  currentProgress: number;\n  targetProgress: number;\n  percentage: number;\n  lastUpdated: Date;\n}\n\nexport interface Milestone {\n  id: string;\n  name: string;\n  description: string;\n  threshold: number; // Points threshold\n  unlockedAt?: Date;\n  badge: 'bronze' | 'silver' | 'gold' | 'platinum';\n}\n\nexport class AchievementSystem {\n  private achievements: Map<string, Achievement> = new Map();\n  private userAchievements: Map<string, UserAchievement[]> = new Map();\n  private achievementProgress: Map<string, AchievementProgress[]> = new Map();\n  private milestones: Map<string, Milestone> = new Map();\n\n  constructor() {\n    this.initializeDefaultAchievements();\n    this.initializeDefaultMilestones();\n  }\n\n  /**\n   * Initialize default achievements\n   */\n  private initializeDefaultAchievements(): void {\n    const defaultAchievements: Achievement[] = [\n      {\n        id: 'ach-first-upload',\n        name: 'First Upload',\n        description: 'Uploaded your first file for metadata extraction',\n        icon: '',\n        points: 10,\n        category: 'onboarding',\n        requirements: [\n          {\n            type: 'action_count',\n            action: 'file_upload',\n            targetValue: 1,\n            currentValue: 0,\n            completed: false\n          }\n        ],\n        rarity: 'common'\n      },\n      {\n        id: 'ach-first-results',\n        name: 'First Results',\n        description: 'Successfully extracted metadata from a file',\n        icon: '',\n        points: 15,\n        category: 'onboarding',\n        requirements: [\n          {\n            type: 'action_count',\n            action: 'view_results',\n            targetValue: 1,\n            currentValue: 0,\n            completed: false\n          }\n        ],\n        rarity: 'common'\n      },\n      {\n        id: 'ach-five-uploads',\n        name: 'Early Adopter',\n        description: 'Uploaded 5 files for extraction',\n        icon: '',\n        points: 25,\n        category: 'exploration',\n        requirements: [\n          {\n            type: 'action_count',\n            action: 'file_upload',\n            targetValue: 5,\n            currentValue: 0,\n            completed: false\n          }\n        ],\n        rarity: 'common'\n      },\n      {\n        id: 'ach-gps-discovery',\n        name: 'Location Detective',\n        description: 'Explored GPS and location data in results',\n        icon: '',\n        points: 30,\n        category: 'exploration',\n        requirements: [\n          {\n            type: 'feature_used',\n            action: 'view_gps_data',\n            targetValue: 1,\n            currentValue: 0,\n            completed: false\n          }\n        ],\n        rarity: 'uncommon'\n      },\n      {\n        id: 'ach-camera-expert',\n        name: 'Camera Expert',\n        description: 'Analyzed camera settings and EXIF data',\n        icon: '',\n        points: 35,\n        category: 'expertise',\n        requirements: [\n          {\n            type: 'feature_used',\n            action: 'analyze_camera_settings',\n            targetValue: 1,\n            currentValue: 0,\n            completed: false\n          }\n        ],\n        rarity: 'uncommon'\n      },\n      {\n        id: 'ach-tutorial-master',\n        name: 'Tutorial Master',\n        description: 'Completed 5 onboarding tutorials',\n        icon: '',\n        points: 50,\n        category: 'onboarding',\n        requirements: [\n          {\n            type: 'tutorial_completed',\n            action: 'complete_tutorial',\n            targetValue: 5,\n            currentValue: 0,\n            completed: false\n          }\n        ],\n        rarity: 'rare'\n      },\n      {\n        id: 'ach-forensic-beginner',\n        name: 'Forensic Beginner',\n        description: 'Performed your first forensic analysis',\n        icon: '',\n        points: 40,\n        category: 'expertise',\n        requirements: [\n          {\n            type: 'feature_used',\n            action: 'forensic_analysis',\n            targetValue: 1,\n            currentValue: 0,\n            completed: false\n          }\n        ],\n        rarity: 'uncommon'\n      },\n      {\n        id: 'ach-ai-detection',\n        name: 'AI Detective',\n        description: 'Used AI generation detection feature',\n        icon: '',\n        points: 45,\n        category: 'expertise',\n        requirements: [\n          {\n            type: 'feature_used',\n            action: 'ai_detection',\n            targetValue: 1,\n            currentValue: 0,\n            completed: false\n          }\n        ],\n        rarity: 'rare'\n      },\n      {\n        id: 'ach-steganography',\n        name: 'Steganography Hunter',\n        description: 'Detected hidden data using steganography tools',\n        icon: '',\n        points: 55,\n        category: 'expertise',\n        requirements: [\n          {\n            type: 'feature_used',\n            action: 'steganography_detection',\n            targetValue: 1,\n            currentValue: 0,\n            completed: false\n          }\n        ],\n        rarity: 'rare'\n      },\n      {\n        id: 'ach-team-collaborator',\n        name: 'Team Collaborator',\n        description: 'Shared results with your team',\n        icon: '',\n        points: 35,\n        category: 'collaboration',\n        requirements: [\n          {\n            type: 'result_shared',\n            action: 'share_result',\n            targetValue: 1,\n            currentValue: 0,\n            completed: false\n          }\n        ],\n        rarity: 'uncommon'\n      },\n      {\n        id: 'ach-power-user',\n        name: 'Power User',\n        description: 'Used 10 different features',\n        icon: '',\n        points: 60,\n        category: 'engagement',\n        requirements: [\n          {\n            type: 'feature_used',\n            action: 'use_feature',\n            targetValue: 10,\n            currentValue: 0,\n            completed: false\n          }\n        ],\n        rarity: 'rare'\n      },\n      {\n        id: 'ach-weekly-regular',\n        name: 'Weekly Regular',\n        description: 'Used the platform 5 days in one week',\n        icon: '',\n        points: 50,\n        category: 'engagement',\n        requirements: [\n          {\n            type: 'action_count',\n            action: 'daily_login',\n            targetValue: 5,\n            currentValue: 0,\n            completed: false\n          }\n        ],\n        rarity: 'uncommon'\n      },\n      {\n        id: 'ach-monthly-veteran',\n        name: 'Monthly Veteran',\n        description: 'Used the platform for 20 days in one month',\n        icon: '',\n        points: 80,\n        category: 'engagement',\n        requirements: [\n          {\n            type: 'action_count',\n            action: 'daily_login',\n            targetValue: 20,\n            currentValue: 0,\n            completed: false\n          }\n        ],\n        rarity: 'epic'\n      },\n      {\n        id: 'ach-helpful-contributor',\n        name: 'Helpful Contributor',\n        description: 'Provided feedback on 5 help articles',\n        icon: '',\n        points: 40,\n        category: 'engagement',\n        requirements: [\n          {\n            type: 'action_count',\n            action: 'help_feedback',\n            targetValue: 5,\n            currentValue: 0,\n            completed: false\n          }\n        ],\n        rarity: 'rare'\n      },\n      {\n        id: 'ach-perfectionist',\n        name: 'Perfectionist',\n        description: 'Achieved 100% completion in onboarding',\n        icon: '',\n        points: 100,\n        category: 'onboarding',\n        requirements: [\n          {\n            type: 'tutorial_completed',\n            action: 'complete_all_tutorials',\n            targetValue: 1,\n            currentValue: 0,\n            completed: false\n          }\n        ],\n        rarity: 'epic'\n      }\n    ];\n\n    defaultAchievements.forEach(achievement => {\n      this.achievements.set(achievement.id, { ...achievement });\n    });\n  }\n\n  /**\n   * Initialize default milestones\n   */\n  private initializeDefaultMilestones(): void {\n    const defaultMilestones: Milestone[] = [\n      {\n        id: 'ms-bronze',\n        name: 'Bronze Explorer',\n        description: 'Reached 100 achievement points',\n        threshold: 100,\n        badge: 'bronze'\n      },\n      {\n        id: 'ms-silver',\n        name: 'Silver Analyst',\n        description: 'Reached 500 achievement points',\n        threshold: 500,\n        badge: 'silver'\n      },\n      {\n        id: 'ms-gold',\n        name: 'Gold Expert',\n        description: 'Reached 1000 achievement points',\n        threshold: 1000,\n        badge: 'gold'\n      },\n      {\n        id: 'ms-platinum',\n        name: 'Platinum Master',\n        description: 'Reached 2000 achievement points',\n        threshold: 2000,\n        badge: 'platinum'\n      }\n    ];\n\n    defaultMilestones.forEach(milestone => {\n      this.milestones.set(milestone.id, milestone);\n    });\n  }\n\n  /**\n   * Track user action for achievements\n   */\n  async trackUserAction(userId: string, action: string, value: number = 1): Promise<void> {\n    // Update user's progress toward achievements\n    const userAchievements = this.userAchievements.get(userId) || [];\n    const userProgress = this.achievementProgress.get(userId) || [];\n\n    // Get all achievements that match this action\n    const relevantAchievements = Array.from(this.achievements.values()).filter(\n      ach => ach.requirements.some(req => req.action === action)\n    );\n\n    for (const achievement of relevantAchievements) {\n      const req = achievement.requirements.find(r => r.action === action);\n      if (!req) continue;\n\n      // Update progress\n      req.currentValue += value;\n\n      // Check if requirement is now complete\n      if (req.currentValue >= req.targetValue && !req.completed) {\n        req.completed = true;\n\n        // Check if entire achievement is now complete\n        const allCompleted = achievement.requirements.every(r => r.completed);\n        if (allCompleted) {\n          // Award the achievement\n          await this.awardAchievement(userId, achievement.id);\n        }\n      }\n\n      // Update progress tracking\n      const progressId = `${userId}-${achievement.id}`;\n      let progress = userProgress.find(p => p.achievementId === achievement.id);\n      \n      if (progress) {\n        progress.currentProgress = req.currentValue;\n        progress.percentage = Math.min(100, Math.round((req.currentValue / req.targetValue) * 100));\n        progress.lastUpdated = new Date();\n      } else {\n        progress = {\n          userId,\n          achievementId: achievement.id,\n          currentProgress: req.currentValue,\n          targetProgress: req.targetValue,\n          percentage: Math.min(100, Math.round((req.currentValue / req.targetValue) * 100)),\n          lastUpdated: new Date()\n        };\n        userProgress.push(progress);\n      }\n    }\n\n    // Update the maps\n    this.userAchievements.set(userId, userAchievements);\n    this.achievementProgress.set(userId, userProgress);\n  }\n\n  /**\n   * Award an achievement to a user\n   */\n  async awardAchievement(userId: string, achievementId: string): Promise<boolean> {\n    const achievement = this.achievements.get(achievementId);\n    if (!achievement) return false;\n\n    // Check if user already has this achievement\n    const userAchievements = this.userAchievements.get(userId) || [];\n    if (userAchievements.some(ua => ua.achievementId === achievementId)) {\n      return false; // Already awarded\n    }\n\n    // Create new user achievement\n    const userAchievement: UserAchievement = {\n      userId,\n      achievementId,\n      unlockedAt: new Date(),\n      progress: 100, // 100% since it's completed\n      completed: true,\n      pointsEarned: achievement.points\n    };\n\n    userAchievements.push(userAchievement);\n    this.userAchievements.set(userId, userAchievements);\n\n    // Update achievement status\n    const updatedAchievement = { ...achievement };\n    updatedAchievement.unlockedAt = new Date();\n    updatedAchievement.unlockedBy = userId;\n    this.achievements.set(achievementId, updatedAchievement);\n\n    // Check for milestone unlocks\n    await this.checkMilestones(userId);\n\n    return true;\n  }\n\n  /**\n   * Get user's achievements\n   */\n  async getUserAchievements(userId: string): Promise<UserAchievement[]> {\n    return this.userAchievements.get(userId) || [];\n  }\n\n  /**\n   * Get user's achievement progress\n   */\n  async getUserProgress(userId: string): Promise<AchievementProgress[]> {\n    return this.achievementProgress.get(userId) || [];\n  }\n\n  /**\n   * Get all available achievements\n   */\n  getAllAchievements(): Achievement[] {\n    return Array.from(this.achievements.values());\n  }\n\n  /**\n   * Get achievements by category\n   */\n  getAchievementsByCategory(category: string): Achievement[] {\n    return Array.from(this.achievements.values()).filter(\n      ach => ach.category === category\n    );\n  }\n\n  /**\n   * Get user's total achievement points\n   */\n  async getUserPoints(userId: string): Promise<number> {\n    const userAchievements = await this.getUserAchievements(userId);\n    return userAchievements.reduce((sum, ua) => sum + ua.pointsEarned, 0);\n  }\n\n  /**\n   * Check if user has unlocked a specific achievement\n   */\n  async hasAchievement(userId: string, achievementId: string): Promise<boolean> {\n    const userAchievements = await this.getUserAchievements(userId);\n    return userAchievements.some(ua => ua.achievementId === achievementId);\n  }\n\n  /**\n   * Get user's unlocked achievements\n   */\n  async getUnlockedAchievements(userId: string): Promise<UserAchievement[]> {\n    const userAchievements = await this.getUserAchievements(userId);\n    return userAchievements.filter(ua => ua.completed);\n  }\n\n  /**\n   * Get user's locked achievements\n   */\n  async getLockedAchievements(userId: string): Promise<Achievement[]> {\n    const userAchievements = await this.getUserAchievements(userId);\n    const unlockedIds = new Set(userAchievements.map(ua => ua.achievementId));\n    \n    return Array.from(this.achievements.values())\n      .filter(ach => !unlockedIds.has(ach.id));\n  }\n\n  /**\n   * Get user's achievement statistics\n   */\n  async getUserAchievementStats(userId: string) {\n    const allAchievements = await this.getUserAchievements(userId);\n    const unlocked = allAchievements.filter(ua => ua.completed);\n    const totalPoints = unlocked.reduce((sum, ua) => sum + ua.pointsEarned, 0);\n    \n    // Count by category\n    const categoryCounts: Record<string, number> = {};\n    for (const ua of unlocked) {\n      const achievement = this.achievements.get(ua.achievementId);\n      if (achievement) {\n        categoryCounts[achievement.category] = (categoryCounts[achievement.category] || 0) + 1;\n      }\n    }\n    \n    // Count by rarity\n    const rarityCounts: Record<string, number> = {};\n    for (const ua of unlocked) {\n      const achievement = this.achievements.get(ua.achievementId);\n      if (achievement) {\n        rarityCounts[achievement.rarity] = (rarityCounts[achievement.rarity] || 0) + 1;\n      }\n    }\n    \n    return {\n      totalUnlocked: unlocked.length,\n      totalAvailable: this.achievements.size,\n      totalPoints,\n      completionRate: this.achievements.size > 0 \n        ? (unlocked.length / this.achievements.size) * 100 \n        : 0,\n      categoryBreakdown: categoryCounts,\n      rarityBreakdown: rarityCounts,\n      lastUnlocked: unlocked.length > 0 \n        ? unlocked[unlocked.length - 1].unlockedAt \n        : null\n    };\n  }\n\n  /**\n   * Check for milestone unlocks\n   */\n  async checkMilestones(userId: string): Promise<Milestone[]> {\n    const userPoints = await this.getUserPoints(userId);\n    const userAchievements = this.userAchievements.get(userId) || [];\n    \n    const unlockedMilestones: Milestone[] = [];\n    \n    for (const [milestoneId, milestone] of this.milestones) {\n      // Check if user has enough points and milestone isn't already unlocked\n      if (userPoints >= milestone.threshold) {\n        const isAlreadyUnlocked = userAchievements.some(ua => \n          ua.achievementId === milestoneId && ua.completed\n        );\n        \n        if (!isAlreadyUnlocked) {\n          // Award milestone as a special achievement\n          const milestoneAchievement: UserAchievement = {\n            userId,\n            achievementId: milestoneId,\n            unlockedAt: new Date(),\n            progress: 100,\n            completed: true,\n            pointsEarned: 0 // Milestones don't give extra points\n          };\n          \n          userAchievements.push(milestoneAchievement);\n          unlockedMilestones.push(milestone);\n          \n          // Update milestone status\n          const updatedMilestone = { ...milestone, unlockedAt: new Date() };\n          this.milestones.set(milestoneId, updatedMilestone);\n        }\n      }\n    }\n    \n    this.userAchievements.set(userId, userAchievements);\n    return unlockedMilestones;\n  }\n\n  /**\n   * Get user's milestones\n   */\n  async getUserMilestones(userId: string): Promise<Milestone[]> {\n    const userAchievements = this.userAchievements.get(userId) || [];\n    const unlockedMilestoneIds = userAchievements\n      .filter(ua => this.milestones.has(ua.achievementId))\n      .map(ua => ua.achievementId);\n    \n    return Array.from(this.milestones.values())\n      .filter(m => unlockedMilestoneIds.includes(m.id));\n  }\n\n  /**\n   * Get achievement by ID\n   */\n  getAchievement(achievementId: string): Achievement | undefined {\n    return this.achievements.get(achievementId);\n  }\n\n  /**\n   * Get user's progress toward a specific achievement\n   */\n  async getUserAchievementProgress(userId: string, achievementId: string): Promise<AchievementProgress | null> {\n    const userProgress = this.achievementProgress.get(userId) || [];\n    return userProgress.find(p => p.achievementId === achievementId) || null;\n  }\n\n  /**\n   * Get top users by achievement points\n   */\n  getLeaderboard(limit: number = 10): Array<{ userId: string; points: number; achievements: number }> {\n    const leaderboard: Array<{ userId: string; points: number; achievements: number }> = [];\n    \n    for (const [userId, userAchievements] of this.userAchievements) {\n      const points = userAchievements.reduce((sum, ua) => sum + ua.pointsEarned, 0);\n      const achievementCount = userAchievements.length;\n      \n      leaderboard.push({ userId, points, achievements: achievementCount });\n    }\n    \n    return leaderboard\n      .sort((a, b) => b.points - a.points)\n      .slice(0, limit);\n  }\n\n  /**\n   * Get achievements by rarity\n   */\n  getAchievementsByRarity(rarity: string): Achievement[] {\n    return Array.from(this.achievements.values()).filter(\n      ach => ach.rarity === rarity\n    );\n  }\n\n  /**\n   * Get recent achievements\n   */\n  getRecentAchievements(limit: number = 5): Achievement[] {\n    return Array.from(this.achievements.values())\n      .filter(ach => ach.unlockedAt)\n      .sort((a, b) => \n        (b.unlockedAt?.getTime() || 0) - (a.unlockedAt?.getTime() || 0)\n      )\n      .slice(0, limit);\n  }\n\n  /**\n   * Create a custom achievement\n   */\n  async createCustomAchievement(\n    name: string,\n    description: string,\n    icon: string,\n    points: number,\n    category: string,\n    requirements: AchievementRequirement[],\n    rarity: 'common' | 'uncommon' | 'rare' | 'epic' | 'legendary' = 'common'\n  ): Promise<Achievement> {\n    const achievementId = `custom-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n    \n    const newAchievement: Achievement = {\n      id: achievementId,\n      name,\n      description,\n      icon,\n      points,\n      category: category as any,\n      requirements,\n      rarity,\n      unlockedAt: undefined,\n      unlockedBy: undefined\n    };\n\n    this.achievements.set(achievementId, newAchievement);\n    return newAchievement;\n  }\n\n  /**\n   * Get personalized achievement recommendations for user\n   */\n  async getPersonalizedRecommendations(userId: string): Promise<Achievement[]> {\n    const userAchievements = await this.getUserAchievements(userId);\n    const unlockedIds = new Set(userAchievements.map(ua => ua.achievementId));\n    \n    // Get locked achievements\n    const lockedAchievements = Array.from(this.achievements.values())\n      .filter(ach => !unlockedIds.has(ach.id));\n    \n    // Prioritize achievements based on user's activity\n    const userProgress = await this.getUserProgress(userId);\n    \n    // Calculate scores based on how close user is to completing achievements\n    const scoredAchievements = lockedAchievements.map(ach => {\n      // Find the user's progress for this achievement\n      const progress = userProgress.find(p => p.achievementId === ach.id);\n      \n      // Calculate completion percentage\n      const percentage = progress ? progress.percentage : 0;\n      \n      // Prioritize achievements the user is close to completing\n      return {\n        achievement: ach,\n        score: percentage\n      };\n    });\n    \n    // Sort by score (highest first) and return top 5\n    return scoredAchievements\n      .sort((a, b) => b.score - a.score)\n      .slice(0, 5)\n      .map(item => item.achievement);\n  }\n}\n\n// Singleton instance\nexport const achievementSystem = new AchievementSystem();\n\nexport default achievementSystem;","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/api-hub/api-client.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[967,970],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[967,970],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'name' is defined but never used. Allowed unused args must match /^_/u.","line":263,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":263,"endColumn":9},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":325,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":325,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7833,7836],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7833,7836],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":361,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":361,"endColumn":18,"suggestions":[{"fix":{"range":[8982,9059],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'method' is defined but never used. Allowed unused args must match /^_/u.","line":443,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":443,"endColumn":11},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":466,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":466,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11891,11894],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11891,11894],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * API Hub - Centralized API management and integration system\n */\n\nimport { v4 as uuidv4 } from 'uuid';\n\nexport interface ApiKey {\n  id: string;\n  userId: string;\n  key: string;\n  name: string;\n  permissions: string[];\n  createdAt: Date;\n  lastUsedAt?: Date;\n  expiresAt?: Date;\n  isActive: boolean;\n}\n\nexport interface ApiUsageRecord {\n  id: string;\n  apiKeyId: string;\n  userId: string;\n  endpoint: string;\n  method: string;\n  statusCode: number;\n  responseTime: number; // in ms\n  requestSize: number; // in bytes\n  responseSize: number; // in bytes\n  timestamp: Date;\n  ip: string;\n  userAgent?: string;\n}\n\nexport interface Webhook {\n  id: string;\n  userId: string;\n  url: string;\n  events: string[]; // ['extraction.completed', 'file.uploaded', etc.]\n  secret: string;\n  isActive: boolean;\n  createdAt: Date;\n  lastTriggeredAt?: Date;\n  failureCount: number;\n}\n\nexport interface WebhookEvent {\n  id: string;\n  webhookId: string;\n  event: string;\n  payload: any;\n  status: 'pending' | 'sent' | 'failed';\n  attempts: number;\n  createdAt: Date;\n  sentAt?: Date;\n  error?: string;\n}\n\nexport interface RateLimitConfig {\n  windowMs: number; // Time window in milliseconds\n  maxRequests: number; // Max requests per window\n  tier: 'free' | 'professional' | 'forensic' | 'enterprise';\n  endpoint?: string; // Specific endpoint, or global if undefined\n}\n\nexport interface ApiHubConfig {\n  defaultRateLimit: RateLimitConfig;\n  webhookTimeout: number; // in ms\n  maxPayloadSize: number; // in bytes\n  corsOrigins: string[];\n}\n\nexport class ApiHub {\n  private apiKeys: Map<string, ApiKey> = new Map();\n  private usageRecords: ApiUsageRecord[] = [];\n  private webhooks: Map<string, Webhook> = new Map();\n  private webhookEvents: Map<string, WebhookEvent[]> = new Map();\n  private rateLimits: Map<string, RateLimitConfig[]> = new Map(); // userId -> limits\n  private config: ApiHubConfig;\n\n  constructor(config?: Partial<ApiHubConfig>) {\n    this.config = {\n      defaultRateLimit: {\n        windowMs: 15 * 60 * 1000, // 15 minutes\n        maxRequests: 100,\n        tier: 'free'\n      },\n      webhookTimeout: 10000, // 10 seconds\n      maxPayloadSize: 10 * 1024 * 1024, // 10MB\n      corsOrigins: ['*'],\n      ...config\n    };\n  }\n\n  /**\n   * Generate a new API key for a user\n   */\n  async generateApiKey(userId: string, name: string, permissions: string[] = []): Promise<ApiKey> {\n    const apiKey: ApiKey = {\n      id: uuidv4(),\n      userId,\n      key: this.generateSecureApiKey(),\n      name,\n      permissions,\n      createdAt: new Date(),\n      isActive: true\n    };\n\n    this.apiKeys.set(apiKey.id, apiKey);\n    return apiKey;\n  }\n\n  /**\n   * Generate a secure API key\n   */\n  private generateSecureApiKey(): string {\n    // Generate a secure random API key\n    return `meta_${uuidv4().replace(/-/g, '')}`;\n  }\n\n  /**\n   * Validate an API key\n   */\n  async validateApiKey(key: string): Promise<ApiKey | null> {\n    for (const apiKey of this.apiKeys.values()) {\n      if (apiKey.key === key && apiKey.isActive) {\n        // Update last used timestamp\n        apiKey.lastUsedAt = new Date();\n        return apiKey;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Revoke an API key\n   */\n  async revokeApiKey(keyId: string, userId: string): Promise<boolean> {\n    const key = this.apiKeys.get(keyId);\n    if (!key || key.userId !== userId) {\n      return false;\n    }\n\n    key.isActive = false;\n    return true;\n  }\n\n  /**\n   * Record API usage\n   */\n  async recordUsage(\n    apiKeyId: string,\n    userId: string,\n    endpoint: string,\n    method: string,\n    statusCode: number,\n    responseTime: number,\n    requestSize: number,\n    responseSize: number,\n    ip: string,\n    userAgent?: string\n  ): Promise<void> {\n    const usage: ApiUsageRecord = {\n      id: uuidv4(),\n      apiKeyId,\n      userId,\n      endpoint,\n      method,\n      statusCode,\n      responseTime,\n      requestSize,\n      responseSize,\n      timestamp: new Date(),\n      ip,\n      userAgent\n    };\n\n    this.usageRecords.push(usage);\n\n    // Keep only last 10000 records to prevent memory issues\n    if (this.usageRecords.length > 10000) {\n      this.usageRecords = this.usageRecords.slice(-10000);\n    }\n  }\n\n  /**\n   * Get API usage for a user\n   */\n  async getUsage(\n    userId: string,\n    startDate?: Date,\n    endDate?: Date,\n    limit: number = 100\n  ): Promise<ApiUsageRecord[]> {\n    let records = this.usageRecords.filter(record => record.userId === userId);\n\n    if (startDate) {\n      records = records.filter(record => record.timestamp >= startDate);\n    }\n\n    if (endDate) {\n      records = records.filter(record => record.timestamp <= endDate);\n    }\n\n    // Sort by timestamp descending and limit\n    return records\n      .sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime())\n      .slice(0, limit);\n  }\n\n  /**\n   * Get API usage summary for a user\n   */\n  async getUsageSummary(userId: string, days = 30): Promise<{\n    totalRequests: number;\n    successfulRequests: number;\n    failedRequests: number;\n    avgResponseTime: number;\n    totalDataTransferred: number;\n    requestsByEndpoint: Record<string, number>;\n    requestsByMethod: Record<string, number>;\n  }> {\n    const cutoffDate = new Date();\n    cutoffDate.setDate(cutoffDate.getDate() - days);\n\n    const userRecords = this.usageRecords.filter(\n      record => record.userId === userId && record.timestamp >= cutoffDate\n    );\n\n    const totalRequests = userRecords.length;\n    const successfulRequests = userRecords.filter(r => r.statusCode >= 200 && r.statusCode < 300).length;\n    const failedRequests = userRecords.filter(r => r.statusCode >= 400).length;\n    const avgResponseTime = userRecords.length > 0\n      ? userRecords.reduce((sum, r) => sum + r.responseTime, 0) / userRecords.length\n      : 0;\n    const totalDataTransferred = userRecords.reduce((sum, r) => sum + r.responseSize, 0);\n\n    const requestsByEndpoint: Record<string, number> = {};\n    const requestsByMethod: Record<string, number> = {};\n\n    for (const record of userRecords) {\n      requestsByEndpoint[record.endpoint] = (requestsByEndpoint[record.endpoint] || 0) + 1;\n      requestsByMethod[record.method] = (requestsByMethod[record.method] || 0) + 1;\n    }\n\n    return {\n      totalRequests,\n      successfulRequests,\n      failedRequests,\n      avgResponseTime,\n      totalDataTransferred,\n      requestsByEndpoint,\n      requestsByMethod\n    };\n  }\n\n  /**\n   * Create a new webhook\n   */\n  async createWebhook(\n    userId: string,\n    url: string,\n    events: string[],\n    name?: string\n  ): Promise<Webhook> {\n    const webhook: Webhook = {\n      id: uuidv4(),\n      userId,\n      url,\n      events,\n      secret: this.generateWebhookSecret(),\n      isActive: true,\n      createdAt: new Date(),\n      failureCount: 0\n    };\n\n    this.webhooks.set(webhook.id, webhook);\n    this.webhookEvents.set(webhook.id, []);\n    return webhook;\n  }\n\n  /**\n   * Generate a secure webhook secret\n   */\n  private generateWebhookSecret(): string {\n    return `whsec_${uuidv4().replace(/-/g, '')}`;\n  }\n\n  /**\n   * Update a webhook\n   */\n  async updateWebhook(\n    webhookId: string,\n    userId: string,\n    updates: Partial<Webhook>\n  ): Promise<boolean> {\n    const webhook = this.webhooks.get(webhookId);\n    if (!webhook || webhook.userId !== userId) {\n      return false;\n    }\n\n    Object.assign(webhook, updates);\n    return true;\n  }\n\n  /**\n   * Delete a webhook\n   */\n  async deleteWebhook(webhookId: string, userId: string): Promise<boolean> {\n    const webhook = this.webhooks.get(webhookId);\n    if (!webhook || webhook.userId !== userId) {\n      return false;\n    }\n\n    this.webhooks.delete(webhookId);\n    this.webhookEvents.delete(webhookId);\n    return true;\n  }\n\n  /**\n   * Trigger a webhook event\n   */\n  async triggerWebhookEvent(\n    userId: string,\n    event: string,\n    payload: any\n  ): Promise<void> {\n    // Find all active webhooks for this user that listen to this event\n    const userWebhooks = Array.from(this.webhooks.values()).filter(\n      wh => wh.userId === userId && wh.isActive && wh.events.includes(event)\n    );\n\n    for (const webhook of userWebhooks) {\n      const webhookEvent: WebhookEvent = {\n        id: uuidv4(),\n        webhookId: webhook.id,\n        event,\n        payload,\n        status: 'pending',\n        attempts: 0,\n        createdAt: new Date()\n      };\n\n      // Add to webhook's event queue\n      if (!this.webhookEvents.has(webhook.id)) {\n        this.webhookEvents.set(webhook.id, []);\n      }\n      this.webhookEvents.get(webhook.id)!.push(webhookEvent);\n\n      // Attempt to send the webhook (in a real implementation, this would be done asynchronously)\n      await this.sendWebhook(webhook, webhookEvent);\n    }\n  }\n\n  /**\n   * Send a webhook event\n   */\n  private async sendWebhook(webhook: Webhook, event: WebhookEvent): Promise<void> {\n    try {\n      // In a real implementation, we would make an HTTP request to the webhook URL\n      // For now, we'll just simulate the process\n      console.log(`Simulating webhook to ${webhook.url} for event ${event.event}`);\n\n      // Update event status\n      event.status = 'sent';\n      event.sentAt = new Date();\n      event.attempts += 1;\n\n      // Update webhook last triggered time\n      webhook.lastTriggeredAt = new Date();\n    } catch (error) {\n      event.status = 'failed';\n      event.error = (error as Error).message;\n      event.attempts += 1;\n      webhook.failureCount += 1;\n    }\n  }\n\n  /**\n   * Get webhooks for a user\n   */\n  async getUserWebhooks(userId: string): Promise<Webhook[]> {\n    return Array.from(this.webhooks.values()).filter(wh => wh.userId === userId);\n  }\n\n  /**\n   * Get webhook events\n   */\n  async getWebhookEvents(\n    webhookId: string,\n    userId: string,\n    limit: number = 50\n  ): Promise<WebhookEvent[]> {\n    const webhook = this.webhooks.get(webhookId);\n    if (!webhook || webhook.userId !== userId) {\n      return [];\n    }\n\n    const events = this.webhookEvents.get(webhookId) || [];\n    return events\n      .sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime())\n      .slice(0, limit);\n  }\n\n  /**\n   * Set rate limit for a user\n   */\n  async setRateLimit(\n    userId: string,\n    config: RateLimitConfig\n  ): Promise<void> {\n    if (!this.rateLimits.has(userId)) {\n      this.rateLimits.set(userId, []);\n    }\n\n    const limits = this.rateLimits.get(userId)!;\n    \n    // Check if there's already a limit for this endpoint/tier combination\n    const existingIndex = limits.findIndex(l => \n      l.tier === config.tier && l.endpoint === config.endpoint\n    );\n\n    if (existingIndex !== -1) {\n      limits[existingIndex] = config;\n    } else {\n      limits.push(config);\n    }\n  }\n\n  /**\n   * Get rate limits for a user\n   */\n  async getRateLimits(userId: string): Promise<RateLimitConfig[]> {\n    return this.rateLimits.get(userId) || [this.config.defaultRateLimit];\n  }\n\n  /**\n   * Check if a request is rate limited\n   */\n  async isRateLimited(\n    userId: string,\n    apiKeyId: string,\n    endpoint: string,\n    method: string\n  ): Promise<{ isLimited: boolean; resetTime?: Date; limit?: number; remaining?: number }> {\n    const limits = await this.getRateLimits(userId);\n    \n    // Find the most specific rate limit (endpoint-specific first, then tier-specific)\n    const applicableLimit = limits.find(l => l.endpoint === endpoint) ||\n      limits.find(l => !l.endpoint) ||\n      this.config.defaultRateLimit;\n\n    // In a real implementation, we would check the actual request count\n    // against the time window to determine if the user is rate limited\n    // For now, we'll return a mock response indicating not limited\n    return {\n      isLimited: false,\n      resetTime: new Date(Date.now() + applicableLimit.windowMs),\n      limit: applicableLimit.maxRequests,\n      remaining: applicableLimit.maxRequests\n    };\n  }\n\n  /**\n   * Get API documentation\n   */\n  getApiDocumentation(): any {\n    return {\n      version: '1.0.0',\n      title: 'MetaExtract API',\n      description: 'Comprehensive metadata extraction API',\n      endpoints: [\n        {\n          path: '/api/extract',\n          method: 'POST',\n          description: 'Extract metadata from a file',\n          parameters: [\n            { name: 'file', type: 'binary', required: true, description: 'File to extract metadata from' },\n            { name: 'tier', type: 'string', required: false, description: 'Extraction tier (free, professional, forensic, enterprise)' }\n          ],\n          responses: [\n            { code: 200, description: 'Successful extraction' },\n            { code: 400, description: 'Bad request' },\n            { code: 401, description: 'Unauthorized' },\n            { code: 402, description: 'Payment required' },\n            { code: 429, description: 'Rate limited' }\n          ]\n        },\n        {\n          path: '/api/extract/batch',\n          method: 'POST',\n          description: 'Extract metadata from multiple files',\n          parameters: [\n            { name: 'files', type: 'array', required: true, description: 'Array of files to extract metadata from' },\n            { name: 'tier', type: 'string', required: false, description: 'Extraction tier' }\n          ],\n          responses: [\n            { code: 200, description: 'Successful batch extraction' },\n            { code: 400, description: 'Bad request' },\n            { code: 401, description: 'Unauthorized' },\n            { code: 402, description: 'Payment required' },\n            { code: 429, description: 'Rate limited' }\n          ]\n        },\n        {\n          path: '/api/webhooks',\n          method: 'POST',\n          description: 'Create a new webhook',\n          parameters: [\n            { name: 'url', type: 'string', required: true, description: 'Webhook URL' },\n            { name: 'events', type: 'array', required: true, description: 'Events to listen for' }\n          ],\n          responses: [\n            { code: 201, description: 'Webhook created' },\n            { code: 400, description: 'Bad request' },\n            { code: 401, description: 'Unauthorized' }\n          ]\n        }\n      ],\n      rateLimits: {\n        free: { requestsPerMinute: 10 },\n        professional: { requestsPerMinute: 100 },\n        forensic: { requestsPerMinute: 500 },\n        enterprise: { requestsPerMinute: 1000 }\n      },\n      authentication: {\n        method: 'API Key',\n        header: 'Authorization: Bearer YOUR_API_KEY'\n      }\n    };\n  }\n}\n\n// Singleton instance\nexport const apiHub = new ApiHub();\n\nexport default apiHub;\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/api-hub/api-docs.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[543,546],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[543,546],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[639,642],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[639,642],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[656,659],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[656,659],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[745,748],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[745,748],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[762,765],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[762,765],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1262,1265],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1262,1265],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1285,1288],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1285,1288],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * API Documentation - Auto-generated API docs and SDK\n */\n\nexport interface ApiEndpoint {\n  path: string;\n  method: 'GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH';\n  description: string;\n  parameters: ApiParameter[];\n  requestBody?: ApiRequestBody;\n  responses: ApiResponse[];\n  authRequired: boolean;\n  rateLimitTier: 'free' | 'professional' | 'forensic' | 'enterprise';\n}\n\nexport interface ApiParameter {\n  name: string;\n  type: 'string' | 'number' | 'boolean' | 'array' | 'object';\n  required: boolean;\n  description: string;\n  example?: any;\n}\n\nexport interface ApiRequestBody {\n  description: string;\n  required: boolean;\n  schema: any;\n  example?: any;\n}\n\nexport interface ApiResponse {\n  code: number;\n  description: string;\n  schema?: any;\n  example?: any;\n}\n\nexport interface ApiDocumentation {\n  version: string;\n  title: string;\n  description: string;\n  endpoints: ApiEndpoint[];\n  rateLimits: {\n    free: { requestsPerMinute: number };\n    professional: { requestsPerMinute: number };\n    forensic: { requestsPerMinute: number };\n    enterprise: { requestsPerMinute: number };\n  };\n  authentication: {\n    method: string;\n    header: string;\n  };\n}\n\nexport interface WebhookEventDefinition {\n  name: string;\n  description: string;\n  payloadSchema: any;\n  examplePayload: any;\n}\n\nexport interface WebhookDefinition {\n  id: string;\n  name: string;\n  description: string;\n  events: WebhookEventDefinition[];\n  url: string;\n  secretRequired: boolean;\n}\n\nexport class ApiDocs {\n  /**\n   * Generate API documentation\n   */\n  static generateDocumentation(): ApiDocumentation {\n    return {\n      version: '1.0.0',\n      title: 'MetaExtract API',\n      description: 'Comprehensive metadata extraction API with advanced forensic capabilities',\n      endpoints: [\n        {\n          path: '/api/extract',\n          method: 'POST',\n          description: 'Extract metadata from a file with comprehensive analysis',\n          parameters: [\n            {\n              name: 'tier',\n              type: 'string',\n              required: false,\n              description: 'Extraction tier (free, professional, forensic, enterprise)',\n              example: 'professional'\n            },\n            {\n              name: 'includeAdvanced',\n              type: 'boolean',\n              required: false,\n              description: 'Include advanced forensic analysis',\n              example: true\n            }\n          ],\n          requestBody: {\n            description: 'File to extract metadata from',\n            required: true,\n            schema: {\n              type: 'object',\n              properties: {\n                file: {\n                  type: 'string',\n                  format: 'binary',\n                  description: 'File to extract metadata from'\n                },\n                options: {\n                  type: 'object',\n                  properties: {\n                    tier: { type: 'string', enum: ['free', 'professional', 'forensic', 'enterprise'] },\n                    includeAdvanced: { type: 'boolean' }\n                  }\n                }\n              }\n            }\n          },\n          responses: [\n            {\n              code: 200,\n              description: 'Successful metadata extraction',\n              schema: {\n                type: 'object',\n                properties: {\n                  id: { type: 'string' },\n                  metadata: { type: 'object' },\n                  analysis: { type: 'object' },\n                  confidence: { type: 'number' }\n                }\n              },\n              example: {\n                id: 'abc123',\n                metadata: { make: 'Canon', model: 'EOS R5', datetime: '2025-01-05T10:30:00Z' },\n                analysis: { authenticity: 'high', gps: { lat: 37.7749, lng: -122.4194 } },\n                confidence: 95\n              }\n            },\n            {\n              code: 400,\n              description: 'Bad request - invalid file or parameters',\n              example: { error: 'Invalid file format' }\n            },\n            {\n              code: 401,\n              description: 'Unauthorized - invalid API key',\n              example: { error: 'Invalid API key' }\n            },\n            {\n              code: 402,\n              description: 'Payment required - insufficient credits',\n              example: { error: 'Insufficient credits' }\n            },\n            {\n              code: 429,\n              description: 'Rate limited - too many requests',\n              example: { error: 'Rate limit exceeded' }\n            }\n          ],\n          authRequired: true,\n          rateLimitTier: 'free'\n        },\n        {\n          path: '/api/extract/batch',\n          method: 'POST',\n          description: 'Extract metadata from multiple files in a batch operation',\n          parameters: [\n            {\n              name: 'tier',\n              type: 'string',\n              required: false,\n              description: 'Extraction tier for all files',\n              example: 'forensic'\n            }\n          ],\n          requestBody: {\n            description: 'Multiple files to extract metadata from',\n            required: true,\n            schema: {\n              type: 'object',\n              properties: {\n                files: {\n                  type: 'array',\n                  items: {\n                    type: 'string',\n                    format: 'binary'\n                  }\n                },\n                options: {\n                  type: 'object',\n                  properties: {\n                    tier: { type: 'string', enum: ['free', 'professional', 'forensic', 'enterprise'] },\n                    includeAdvanced: { type: 'boolean' }\n                  }\n                }\n              }\n            }\n          },\n          responses: [\n            {\n              code: 200,\n              description: 'Successful batch extraction',\n              schema: {\n                type: 'object',\n                properties: {\n                  results: {\n                    type: 'array',\n                    items: {\n                      type: 'object',\n                      properties: {\n                        id: { type: 'string' },\n                        filename: { type: 'string' },\n                        metadata: { type: 'object' },\n                        analysis: { type: 'object' },\n                        confidence: { type: 'number' }\n                      }\n                    }\n                  }\n                }\n              },\n              example: {\n                results: [\n                  {\n                    id: 'def456',\n                    filename: 'image1.jpg',\n                    metadata: { make: 'Nikon', model: 'D850' },\n                    analysis: { authenticity: 'medium' },\n                    confidence: 85\n                  }\n                ]\n              }\n            }\n          ],\n          authRequired: true,\n          rateLimitTier: 'professional'\n        },\n        {\n          path: '/api/webhooks',\n          method: 'POST',\n          description: 'Create a new webhook to receive event notifications',\n          parameters: [],\n          requestBody: {\n            description: 'Webhook configuration',\n            required: true,\n            schema: {\n              type: 'object',\n              properties: {\n                url: { type: 'string', description: 'URL to send webhook events to' },\n                events: {\n                  type: 'array',\n                  items: { type: 'string' },\n                  description: 'List of events to subscribe to'\n                }\n              }\n            }\n          },\n          responses: [\n            {\n              code: 201,\n              description: 'Webhook created successfully',\n              schema: {\n                type: 'object',\n                properties: {\n                  id: { type: 'string' },\n                  url: { type: 'string' },\n                  events: { type: 'array', items: { type: 'string' } },\n                  secret: { type: 'string', description: 'Webhook secret for verification' }\n                }\n              }\n            }\n          ],\n          authRequired: true,\n          rateLimitTier: 'professional'\n        },\n        {\n          path: '/api/analytics',\n          method: 'GET',\n          description: 'Get analytics and usage statistics',\n          parameters: [\n            {\n              name: 'startDate',\n              type: 'string',\n              required: false,\n              description: 'Start date for analytics (ISO format)',\n              example: '2025-01-01T00:00:00Z'\n            },\n            {\n              name: 'endDate',\n              type: 'string',\n              required: false,\n              description: 'End date for analytics (ISO format)',\n              example: '2025-01-31T23:59:59Z'\n            }\n          ],\n          requestBody: undefined,\n          responses: [\n            {\n              code: 200,\n              description: 'Analytics data retrieved successfully',\n              schema: {\n                type: 'object',\n                properties: {\n                  extractions: { type: 'number' },\n                  successRate: { type: 'number' },\n                  avgProcessingTime: { type: 'number' },\n                  topFormats: {\n                    type: 'array',\n                    items: {\n                      type: 'object',\n                      properties: {\n                        format: { type: 'string' },\n                        count: { type: 'number' }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          ],\n          authRequired: true,\n          rateLimitTier: 'professional'\n        }\n      ],\n      rateLimits: {\n        free: { requestsPerMinute: 10 },\n        professional: { requestsPerMinute: 100 },\n        forensic: { requestsPerMinute: 500 },\n        enterprise: { requestsPerMinute: 1000 }\n      },\n      authentication: {\n        method: 'API Key',\n        header: 'Authorization: Bearer YOUR_API_KEY'\n      }\n    };\n  }\n\n  /**\n   * Generate webhook documentation\n   */\n  static generateWebhookDocumentation(): WebhookDefinition[] {\n    return [\n      {\n        id: 'extraction.completed',\n        name: 'Extraction Completed',\n        description: 'Triggered when a metadata extraction is completed',\n        events: [\n          {\n            name: 'extraction.completed',\n            description: 'Sent when metadata extraction is completed',\n            payloadSchema: {\n              type: 'object',\n              properties: {\n                extractionId: { type: 'string' },\n                filename: { type: 'string' },\n                metadata: { type: 'object' },\n                analysis: { type: 'object' },\n                completedAt: { type: 'string', format: 'date-time' }\n              }\n            },\n            examplePayload: {\n              extractionId: 'abc123',\n              filename: 'photo.jpg',\n              metadata: { make: 'Canon', model: 'EOS R5' },\n              analysis: { authenticity: 'high' },\n              completedAt: '2025-01-05T10:30:00Z'\n            }\n          }\n        ],\n        url: 'https://your-domain.com/webhook',\n        secretRequired: true\n      },\n      {\n        id: 'file.uploaded',\n        name: 'File Uploaded',\n        description: 'Triggered when a file is successfully uploaded',\n        events: [\n          {\n            name: 'file.uploaded',\n            description: 'Sent when a file is uploaded successfully',\n            payloadSchema: {\n              type: 'object',\n              properties: {\n                fileId: { type: 'string' },\n                filename: { type: 'string' },\n                size: { type: 'number' },\n                mimeType: { type: 'string' },\n                uploadedAt: { type: 'string', format: 'date-time' }\n              }\n            },\n            examplePayload: {\n              fileId: 'def456',\n              filename: 'document.pdf',\n              size: 1024000,\n              mimeType: 'application/pdf',\n              uploadedAt: '2025-01-05T10:29:00Z'\n            }\n          }\n        ],\n        url: 'https://your-domain.com/webhook',\n        secretRequired: true\n      }\n    ];\n  }\n\n  /**\n   * Generate SDK documentation\n   */\n  static generateSdkDocumentation(): string {\n    return `\n# MetaExtract JavaScript SDK\n\n## Installation\n\n\\`\\`\\`bash\nnpm install @metaextract/sdk\n\\`\\`\\`\n\n## Usage\n\n\\`\\`\\`javascript\nimport { MetaExtractClient } from '@metaextract/sdk';\n\nconst client = new MetaExtractClient({\n  apiKey: 'YOUR_API_KEY'\n});\n\n// Extract metadata from a file\nconst result = await client.extract(file, {\n  tier: 'professional',\n  includeAdvanced: true\n});\n\nconsole.log(result.metadata);\nconsole.log(result.analysis);\n\\`\\`\\`\n\n## Webhook Verification\n\n\\`\\`\\`javascript\nimport { verifyWebhookSignature } from '@metaextract/sdk';\n\nconst isValid = verifyWebhookSignature(\n  payload,\n  signature,\n  secret\n);\n\nif (isValid) {\n  // Process webhook\n}\n\\`\\`\\`\n\n## Rate Limiting\n\nThe API enforces rate limits based on your subscription tier:\n- Free: 10 requests per minute\n- Professional: 100 requests per minute\n- Forensic: 500 requests per minute\n- Enterprise: 1000 requests per minute\n\nExceeding the rate limit will result in a 429 response code.\n    `;\n  }\n\n  /**\n   * Get rate limit information for a tier\n   */\n  static getRateLimitInfo(tier: 'free' | 'professional' | 'forensic' | 'enterprise'): { requestsPerMinute: number; description: string } {\n    const limits = {\n      free: { requestsPerMinute: 10, description: 'Basic usage tier' },\n      professional: { requestsPerMinute: 100, description: 'Professional usage tier' },\n      forensic: { requestsPerMinute: 500, description: 'Forensic analysis tier' },\n      enterprise: { requestsPerMinute: 1000, description: 'Enterprise usage tier' }\n    };\n\n    return limits[tier];\n  }\n}\n\n// Export the documentation\nexport const apiDocumentation = ApiDocs.generateDocumentation();\nexport const webhookDocumentation = ApiDocs.generateWebhookDocumentation();\nexport const sdkDocumentation = ApiDocs.generateSdkDocumentation();\n\nexport default ApiDocs;","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/auth.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1562,1565],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1562,1565],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1593,1596],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1593,1596],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1631,1634],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1631,1634],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":76,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":76,"endColumn":20,"suggestions":[{"fix":{"range":[1717,1760],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2460,2463],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2460,2463],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":106,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2538,2541],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2538,2541],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":107,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2576,2579],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2576,2579],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":111,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2675,2678],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2675,2678],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":112,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2741,2744],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2741,2744],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-empty-function","severity":1,"message":"Unexpected empty arrow function.","line":122,"column":24,"nodeType":"ArrowFunctionExpression","messageId":"unexpected","endLine":122,"endColumn":26,"suggestions":[{"messageId":"suggestComment","data":{"name":"arrow function"},"fix":{"range":[3080,3080],"text":" /* empty */ "},"desc":"Add comment inside empty arrow function."}]},{"ruleId":"@typescript-eslint/no-empty-function","severity":1,"message":"Unexpected empty arrow function.","line":128,"column":24,"nodeType":"ArrowFunctionExpression","messageId":"unexpected","endLine":128,"endColumn":26,"suggestions":[{"messageId":"suggestComment","data":{"name":"arrow function"},"fix":{"range":[3318,3318],"text":" /* empty */ "},"desc":"Add comment inside empty arrow function."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":135,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":135,"endColumn":20,"suggestions":[{"fix":{"range":[3435,3472],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":160,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4078,4081],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4078,4081],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":161,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4146,4149],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4146,4149],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":164,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4272,4275],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4272,4275],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":169,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":169,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4385,4388],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4385,4388],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":173,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":173,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4470,4473],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4470,4473],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":174,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4508,4511],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4508,4511],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":177,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4556,4559],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4556,4559],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":178,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":178,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4622,4625],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4622,4625],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-empty-function","severity":1,"message":"Unexpected empty arrow function.","line":188,"column":24,"nodeType":"ArrowFunctionExpression","messageId":"unexpected","endLine":188,"endColumn":26,"suggestions":[{"messageId":"suggestComment","data":{"name":"arrow function"},"fix":{"range":[4965,4965],"text":" /* empty */ "},"desc":"Add comment inside empty arrow function."}]},{"ruleId":"@typescript-eslint/no-empty-function","severity":1,"message":"Unexpected empty arrow function.","line":194,"column":24,"nodeType":"ArrowFunctionExpression","messageId":"unexpected","endLine":194,"endColumn":26,"suggestions":[{"messageId":"suggestComment","data":{"name":"arrow function"},"fix":{"range":[5203,5203],"text":" /* empty */ "},"desc":"Add comment inside empty arrow function."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":201,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":201,"endColumn":20,"suggestions":[{"fix":{"range":[5320,5360],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":216,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":216,"endColumn":20,"suggestions":[{"fix":{"range":[5647,5685],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":24,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * MetaExtract Auth Context\n *\n * Provides authentication state and methods throughout the app.\n */\n\nimport React, {\n  createContext,\n  useContext,\n  useState,\n  useEffect,\n  useCallback,\n} from 'react';\n\nexport interface User {\n  id: string;\n  email: string;\n  username: string;\n  tier: string;\n  subscriptionStatus: string | null;\n}\n\ninterface AuthContextType {\n  user: User | null;\n  isAuthenticated: boolean;\n  isLoading: boolean;\n  login: (\n    email: string,\n    password: string\n  ) => Promise<{ success: boolean; error?: string }>;\n  register: (\n    email: string,\n    username: string,\n    password: string\n  ) => Promise<{ success: boolean; error?: string }>;\n  logout: () => Promise<void>;\n  refreshUser: () => Promise<void>;\n}\n\nconst AuthContext = createContext<AuthContextType | null>(null);\n\nconst parseJsonSafe = async (response: Response) => {\n  const contentType = response.headers.get('content-type') || '';\n  if (!contentType.includes('application/json')) {\n    return null;\n  }\n  try {\n    return await response.json();\n  } catch {\n    return null;\n  }\n};\n\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\n  const [user, setUser] = useState<User | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  // Check auth status on mount\n  useEffect(() => {\n    checkAuth();\n  }, []);\n\n  const checkAuth = async () => {\n    try {\n      const response = await fetch('/api/auth/me', {\n        credentials: 'include',\n      });\n      const data = await parseJsonSafe(response);\n\n      if (data && (data as any).authenticated && (data as any).user) {\n        setUser((data as any).user);\n      } else {\n        setUser(null);\n      }\n    } catch (error) {\n      console.error('Auth check failed:', error);\n      setUser(null);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const login = async (email: string, password: string) => {\n    try {\n      const tierOverride = localStorage.getItem('metaextract_tier_override');\n      const response = await fetch('/api/auth/login', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({\n          email,\n          password,\n          ...(tierOverride ? { tier: tierOverride } : {}),\n        }),\n      });\n\n      const data = await parseJsonSafe(response);\n\n      if (!response.ok) {\n        return {\n          success: false,\n          error: (data && (data as any).error) || 'Login failed',\n        };\n      }\n\n      if (data && (data as any).user) {\n        setUser((data as any).user);\n      }\n\n      // Store token in localStorage for API calls\n      if (data && (data as any).token) {\n        localStorage.setItem('auth_token', (data as any).token);\n      }\n\n      // Best-effort: claim any guest credits to this account (core + Images MVP)\n      try {\n        await fetch('/api/credits/claim', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          credentials: 'include',\n          body: JSON.stringify({}),\n        }).catch(() => {});\n        await fetch('/api/images_mvp/credits/claim', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          credentials: 'include',\n          body: JSON.stringify({}),\n        }).catch(() => {});\n      } catch {\n        // Best-effort only\n      }\n\n      return { success: true };\n    } catch (error) {\n      console.error('Login error:', error);\n      return {\n        success: false,\n        error: 'Network error. Please try again.',\n      };\n    }\n  };\n\n  const register = async (\n    email: string,\n    username: string,\n    password: string\n  ) => {\n    try {\n      const response = await fetch('/api/auth/register', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({ email, username, password }),\n      });\n\n      const data = await parseJsonSafe(response);\n\n      if (!response.ok) {\n        // Handle validation errors\n        if (data && (data as any).details) {\n          const firstError = Object.values((data as any).details).flat()[0];\n          return {\n            success: false,\n            error: (firstError as string) || (data as any).error,\n          };\n        }\n        return {\n          success: false,\n          error: (data && (data as any).error) || 'Registration failed',\n        };\n      }\n\n      if (data && (data as any).user) {\n        setUser((data as any).user);\n      }\n\n      if (data && (data as any).token) {\n        localStorage.setItem('auth_token', (data as any).token);\n      }\n\n      // Best-effort: claim any guest credits to this new account (core + Images MVP)\n      try {\n        await fetch('/api/credits/claim', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          credentials: 'include',\n          body: JSON.stringify({}),\n        }).catch(() => {});\n        await fetch('/api/images_mvp/credits/claim', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          credentials: 'include',\n          body: JSON.stringify({}),\n        }).catch(() => {});\n      } catch {\n        // Best-effort only\n      }\n\n      return { success: true };\n    } catch (error) {\n      console.error('Register error:', error);\n      return {\n        success: false,\n        error: 'Network error. Please try again.',\n      };\n    }\n  };\n\n  const logout = async () => {\n    try {\n      await fetch('/api/auth/logout', {\n        method: 'POST',\n        credentials: 'include',\n      });\n    } catch (error) {\n      console.error('Logout error:', error);\n    } finally {\n      setUser(null);\n      localStorage.removeItem('auth_token');\n    }\n  };\n\n  const refreshUser = useCallback(async () => {\n    await checkAuth();\n  }, []);\n\n  return (\n    <AuthContext.Provider\n      value={{\n        user,\n        isAuthenticated: !!user,\n        isLoading,\n        login,\n        register,\n        logout,\n        refreshUser,\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n}\n\n/**\n * Get the user's effective tier for feature gating\n */\nexport function useEffectiveTier(): string {\n  const { user, isAuthenticated } = useAuth();\n\n  if (!isAuthenticated || !user) {\n    return 'free';\n  }\n\n  // Only count subscription as active if status is \"active\"\n  if (user.subscriptionStatus === 'active') {\n    return user.tier;\n  }\n\n  return 'free';\n}\n\n/**\n * Check if user can access a specific tier's features\n */\nexport function useCanAccessTier(requiredTier: string): boolean {\n  const effectiveTier = useEffectiveTier();\n\n  const tierOrder = ['free', 'professional', 'forensic', 'enterprise'];\n  const currentIndex = tierOrder.indexOf(effectiveTier);\n  const requiredIndex = tierOrder.indexOf(requiredTier);\n\n  return currentIndex >= requiredIndex;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/context-detection.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":117,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3905,3908],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3905,3908],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":196,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":196,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6448,6451],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6448,6451],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":208,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":208,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6805,6808],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6805,6808],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_category' is assigned a value but never used.","line":215,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":215,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":252,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":252,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8056,8059],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8056,8059],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":274,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":274,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8856,8859],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8856,8859],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":309,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":309,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10077,10080],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10077,10080],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Context Detection Engine\n * \n * Analyzes file metadata to determine the most appropriate UI context\n * and provides intelligent suggestions for metadata exploration.\n */\n\nexport interface FileContext {\n  type: 'photography' | 'forensic' | 'scientific' | 'web' | 'mobile' | 'professional' | 'generic';\n  confidence: number;\n  indicators: string[];\n  suggestedViews: string[];\n  priorityFields: string[];\n  warnings?: string[];\n}\n\nexport interface ContextProfile {\n  name: string;\n  displayName: string;\n  description: string;\n  indicators: {\n    required?: string[];\n    preferred?: string[];\n    negative?: string[];\n  };\n  priorityCategories: string[];\n  suggestedActions: string[];\n  uiTemplate: 'standard' | 'forensic' | 'scientific' | 'mobile' | 'professional';\n}\n\n// Context profiles registry\nexport const CONTEXT_PROFILES: Record<string, ContextProfile> = {\n  photography: {\n    name: 'photography',\n    displayName: 'Photography',\n    description: 'Professional photography workflow',\n    indicators: {\n      required: ['exif'],\n      preferred: ['Make', 'Model', 'LensModel', 'FocalLength', 'FNumber', 'ExposureTime', 'ISO'],\n      negative: ['forensic_security', 'scientific_data']\n    },\n    priorityCategories: ['exif', 'image', 'gps', 'makernote', 'iptc'],\n    suggestedActions: ['view_camera_settings', 'check_location', 'analyze_exposure'],\n    uiTemplate: 'standard'\n  },\n  \n  forensic: {\n    name: 'forensic',\n    displayName: 'Forensic Analysis',\n    description: 'Digital forensics and evidence analysis',\n    indicators: {\n      preferred: ['forensic', 'file_integrity', 'burned_metadata', 'manipulation_detection'],\n      negative: []\n    },\n    priorityCategories: ['forensic', 'file_integrity', 'filesystem', 'burned_metadata', 'steganography_analysis'],\n    suggestedActions: ['verify_integrity', 'check_manipulation', 'analyze_timeline', 'generate_report'],\n    uiTemplate: 'forensic'\n  },\n  \n  scientific: {\n    name: 'scientific',\n    displayName: 'Scientific Data',\n    description: 'Scientific instruments and research data',\n    indicators: {\n      required: ['scientific_data'],\n      preferred: ['scientific', 'HDF5', 'NetCDF', 'FITS'],\n      negative: []\n    },\n    priorityCategories: ['scientific_data', 'scientific', 'calculated', 'extended'],\n    suggestedActions: ['explore_datasets', 'view_parameters', 'export_data'],\n    uiTemplate: 'scientific'\n  },\n  \n  web: {\n    name: 'web',\n    displayName: 'Web Content',\n    description: 'Web-optimized images and social media',\n    indicators: {\n      preferred: ['web_metadata', 'social_media', 'normalized'],\n      negative: ['scientific_data']\n    },\n    priorityCategories: ['web_metadata', 'social_media', 'normalized', 'image'],\n    suggestedActions: ['check_optimization', 'view_social_tags', 'analyze_compression'],\n    uiTemplate: 'standard'\n  },\n  \n  mobile: {\n    name: 'mobile',\n    displayName: 'Mobile Photography',\n    description: 'Smartphone and mobile device photos',\n    indicators: {\n      preferred: ['mobile_metadata', 'action_camera', 'computational_photography'],\n      negative: ['scientific_data']\n    },\n    priorityCategories: ['mobile_metadata', 'exif', 'gps', 'image'],\n    suggestedActions: ['view_device_info', 'check_processing', 'analyze_location'],\n    uiTemplate: 'mobile'\n  },\n  \n  professional: {\n    name: 'professional',\n    displayName: 'Professional Workflow',\n    description: 'Professional photography and publishing',\n    indicators: {\n      preferred: ['workflow_dam', 'print_publishing', 'iptc', 'xmp'],\n      negative: []\n    },\n    priorityCategories: ['workflow_dam', 'print_publishing', 'iptc', 'xmp', 'makernote'],\n    suggestedActions: ['manage_workflow', 'check_metadata', 'prepare_publishing'],\n    uiTemplate: 'professional'\n  }\n};\n\n/**\n * Analyzes metadata to detect the most appropriate context\n */\nexport function detectFileContext(metadata: Record<string, any>): FileContext {\n  const contexts: Array<{ profile: ContextProfile; score: number; indicators: string[] }> = [];\n  \n  // Analyze each context profile\n  Object.values(CONTEXT_PROFILES).forEach(profile => {\n    let score = 0;\n    const foundIndicators: string[] = [];\n    \n    // Check required indicators\n    if (profile.indicators.required) {\n      const requiredFound = profile.indicators.required.every(indicator => {\n        const found = hasIndicator(metadata, indicator);\n        if (found) foundIndicators.push(indicator);\n        return found;\n      });\n      if (!requiredFound) return; // Skip if required indicators not found\n      score += 30;\n    }\n    \n    // Check preferred indicators\n    if (profile.indicators.preferred) {\n      profile.indicators.preferred.forEach(indicator => {\n        if (hasIndicator(metadata, indicator)) {\n          foundIndicators.push(indicator);\n          score += 10;\n        }\n      });\n    }\n    \n    // Check negative indicators (reduce score)\n    if (profile.indicators.negative) {\n      profile.indicators.negative.forEach(indicator => {\n        if (hasIndicator(metadata, indicator)) {\n          score -= 15;\n        }\n      });\n    }\n    \n    // Bonus for category richness\n    const categoryCount = profile.priorityCategories.filter(cat => \n      metadata[cat] && typeof metadata[cat] === 'object' && Object.keys(metadata[cat]).length > 0\n    ).length;\n    score += categoryCount * 5;\n    \n    if (score > 0) {\n      contexts.push({ profile, score, indicators: foundIndicators });\n    }\n  });\n  \n  // Sort by score and select best match\n  contexts.sort((a, b) => b.score - a.score);\n  \n  if (contexts.length === 0) {\n    // Default to generic context\n    return {\n      type: 'generic',\n      confidence: 0.5,\n      indicators: [],\n      suggestedViews: ['all', 'technical'],\n      priorityFields: ['summary', 'exif', 'image', 'filesystem']\n    };\n  }\n  \n  const bestMatch = contexts[0];\n  const confidence = Math.min(bestMatch.score / 100, 1.0);\n  \n  // Generate warnings\n  const warnings: string[] = [];\n  if (confidence < 0.3) {\n    warnings.push('Low confidence in context detection');\n  }\n  if (hasIndicator(metadata, 'manipulation_detection') && metadata.manipulation_detection?.suspicious) {\n    warnings.push('Potential image manipulation detected');\n  }\n  if (hasIndicator(metadata, 'burned_metadata') && metadata.burned_metadata?.has_burned_metadata) {\n    warnings.push('Burned-in metadata found - verify authenticity');\n  }\n  \n  return {\n    type: bestMatch.profile.name as any,\n    confidence,\n    indicators: bestMatch.indicators,\n    suggestedViews: getSuggestedViews(bestMatch.profile),\n    priorityFields: getPriorityFields(metadata, bestMatch.profile),\n    warnings: warnings.length > 0 ? warnings : undefined\n  };\n}\n\n/**\n * Checks if metadata contains a specific indicator\n */\nfunction hasIndicator(metadata: Record<string, any>, indicator: string): boolean {\n  // Direct category check\n  if (metadata[indicator] && typeof metadata[indicator] === 'object') {\n    return Object.keys(metadata[indicator]).length > 0;\n  }\n  \n  // Field name search across all categories\n  for (const [_category, data] of Object.entries(metadata)) {\n    if (typeof data === 'object' && data !== null) {\n      if (Object.keys(data).some(key => \n        key.toLowerCase().includes(indicator.toLowerCase()) ||\n        indicator.toLowerCase().includes(key.toLowerCase())\n      )) {\n        return true;\n      }\n    }\n  }\n  \n  return false;\n}\n\n/**\n * Gets suggested views based on context\n */\nfunction getSuggestedViews(profile: ContextProfile): string[] {\n  const baseViews = ['all'];\n  \n  switch (profile.uiTemplate) {\n    case 'forensic':\n      return [...baseViews, 'forensic', 'advanced', 'technical'];\n    case 'scientific':\n      return [...baseViews, 'technical', 'raw'];\n    case 'mobile':\n      return [...baseViews, 'advanced'];\n    case 'professional':\n      return [...baseViews, 'technical', 'advanced'];\n    default:\n      return [...baseViews, 'technical'];\n  }\n}\n\n/**\n * Gets priority fields based on context and available data\n */\nfunction getPriorityFields(metadata: Record<string, any>, profile: ContextProfile): string[] {\n  const priorityFields: string[] = [];\n  \n  // Add fields from priority categories that have data\n  profile.priorityCategories.forEach(category => {\n    if (metadata[category] && typeof metadata[category] === 'object') {\n      const fields = Object.keys(metadata[category]);\n      priorityFields.push(...fields.slice(0, 5)); // Top 5 fields per category\n    }\n  });\n  \n  // Add context-specific important fields\n  const contextFields = getContextSpecificFields(profile.name, metadata);\n  priorityFields.push(...contextFields);\n  \n  // Remove duplicates and return top 20\n  return [...new Set(priorityFields)].slice(0, 20);\n}\n\n/**\n * Gets context-specific important fields\n */\nfunction getContextSpecificFields(contextType: string, _metadata: Record<string, any>): string[] {\n  switch (contextType) {\n    case 'photography':\n      return ['Make', 'Model', 'LensModel', 'FocalLength', 'FNumber', 'ExposureTime', 'ISO', 'DateTimeOriginal'];\n    case 'forensic':\n      return ['MD5', 'SHA256', 'creation_timestamp', 'modification_timestamp', 'SerialNumber'];\n    case 'scientific':\n      return ['instrument', 'observation_date', 'processing_level', 'data_format'];\n    case 'web':\n      return ['optimization_level', 'compression_quality', 'color_profile'];\n    case 'mobile':\n      return ['device_model', 'software_version', 'computational_photography'];\n    case 'professional':\n      return ['workflow_id', 'color_space', 'print_profile', 'copyright'];\n    default:\n      return [];\n  }\n}\n\n/**\n * Gets UI adaptation suggestions based on context\n */\nexport function getUIAdaptations(context: FileContext): {\n  layout: 'standard' | 'forensic' | 'scientific' | 'compact';\n  emphasizedSections: string[];\n  hiddenSections: string[];\n  suggestedActions: Array<{\n    label: string;\n    action: string;\n    priority: 'high' | 'medium' | 'low';\n  }>;\n} {\n  const profile = CONTEXT_PROFILES[context.type] || CONTEXT_PROFILES.photography;\n  \n  return {\n    layout: profile.uiTemplate as any,\n    emphasizedSections: profile.priorityCategories,\n    hiddenSections: getHiddenSections(context.type),\n    suggestedActions: profile.suggestedActions.map(action => ({\n      label: formatActionLabel(action),\n      action,\n      priority: getActionPriority(action, context)\n    }))\n  };\n}\n\nfunction getHiddenSections(contextType: string): string[] {\n  switch (contextType) {\n    case 'photography':\n      return ['scientific_data', 'forensic_security'];\n    case 'forensic':\n      return ['workflow_dam', 'print_publishing'];\n    case 'scientific':\n      return ['social_media', 'web_metadata'];\n    case 'web':\n      return ['scientific_data', 'makernote'];\n    case 'mobile':\n      return ['scientific_data', 'print_publishing'];\n    default:\n      return [];\n  }\n}\n\nfunction formatActionLabel(action: string): string {\n  return action.split('_').map(word => \n    word.charAt(0).toUpperCase() + word.slice(1)\n  ).join(' ');\n}\n\nfunction getActionPriority(action: string, context: FileContext): 'high' | 'medium' | 'low' {\n  if (context.warnings && context.warnings.length > 0) {\n    if (action.includes('verify') || action.includes('check')) return 'high';\n  }\n  if (context.confidence > 0.8) return 'high';\n  if (context.confidence > 0.5) return 'medium';\n  return 'low';\n}","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/contextual-help/help-content-manager.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/design-tokens.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/error-messages.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":673,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":673,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":675,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":675,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20541,20544],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20541,20544],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":676,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":676,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is assigned a value but never used.","line":745,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":745,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * User-Friendly Error Messaging System\n *\n * Provides progressive error disclosure with actionable guidance.\n * Replaces technical errors with helpful user messages.\n * Implements error recovery and retry mechanisms.\n *\n * @module error-messages\n * @validates Requirements 1.4, 3.4 - User-friendly error messaging\n */\n\n// ============================================================================\n// Error Types and Categories\n// ============================================================================\n\nexport type ErrorCategory =\n  | 'network'\n  | 'upload'\n  | 'processing'\n  | 'authentication'\n  | 'authorization'\n  | 'validation'\n  | 'server'\n  | 'timeout'\n  | 'quota'\n  | 'unknown';\n\nexport type ErrorSeverity = 'info' | 'warning' | 'error' | 'critical';\n\nexport interface UserFriendlyError {\n  /** Unique error code for tracking */\n  code: string;\n  /** Error category for grouping */\n  category: ErrorCategory;\n  /** Severity level */\n  severity: ErrorSeverity;\n  /** User-friendly title */\n  title: string;\n  /** User-friendly description */\n  message: string;\n  /** Actionable suggestions for the user */\n  suggestions: string[];\n  /** Whether the error is recoverable */\n  recoverable: boolean;\n  /** Retry configuration if recoverable */\n  retry?: RetryConfig;\n  /** Help article link */\n  helpLink?: string;\n  /** Original technical error (for logging) */\n  technicalDetails?: string;\n}\n\nexport interface RetryConfig {\n  /** Maximum number of retry attempts */\n  maxAttempts: number;\n  /** Base delay in milliseconds */\n  baseDelay: number;\n  /** Whether to use exponential backoff */\n  exponentialBackoff: boolean;\n  /** Maximum delay cap in milliseconds */\n  maxDelay?: number;\n}\n\n// ============================================================================\n// Error Code Definitions\n// ============================================================================\n\nexport const ERROR_CODES = {\n  // Network errors\n  NETWORK_OFFLINE: 'NET_001',\n  NETWORK_TIMEOUT: 'NET_002',\n  NETWORK_UNREACHABLE: 'NET_003',\n\n  // Upload errors\n  UPLOAD_FILE_TOO_LARGE: 'UPL_001',\n  UPLOAD_INVALID_TYPE: 'UPL_002',\n  UPLOAD_FAILED: 'UPL_003',\n  UPLOAD_CANCELLED: 'UPL_004',\n  UPLOAD_CORRUPTED: 'UPL_005',\n\n  // Processing errors\n  PROCESSING_FAILED: 'PRC_001',\n  PROCESSING_TIMEOUT: 'PRC_002',\n  PROCESSING_UNSUPPORTED: 'PRC_003',\n  PROCESSING_PARTIAL: 'PRC_004',\n\n  // Authentication errors\n  AUTH_INVALID_CREDENTIALS: 'AUTH_001',\n  AUTH_SESSION_EXPIRED: 'AUTH_002',\n  AUTH_ACCOUNT_LOCKED: 'AUTH_003',\n  AUTH_EMAIL_NOT_VERIFIED: 'AUTH_004',\n\n  // Authorization errors\n  AUTHZ_INSUFFICIENT_TIER: 'AUTHZ_001',\n  AUTHZ_FEATURE_LOCKED: 'AUTHZ_002',\n  AUTHZ_RATE_LIMITED: 'AUTHZ_003',\n\n  // Validation errors\n  VALIDATION_REQUIRED_FIELD: 'VAL_001',\n  VALIDATION_INVALID_FORMAT: 'VAL_002',\n  VALIDATION_OUT_OF_RANGE: 'VAL_003',\n\n  // Server errors\n  SERVER_INTERNAL: 'SRV_001',\n  SERVER_MAINTENANCE: 'SRV_002',\n  SERVER_OVERLOADED: 'SRV_003',\n\n  // Quota errors\n  QUOTA_EXCEEDED: 'QTA_001',\n  QUOTA_DAILY_LIMIT: 'QTA_002',\n  QUOTA_STORAGE_FULL: 'QTA_003',\n\n  // Unknown\n  UNKNOWN: 'UNK_001',\n} as const;\n\nexport type ErrorCode = (typeof ERROR_CODES)[keyof typeof ERROR_CODES];\n\n// ============================================================================\n// Error Message Templates\n// ============================================================================\n\nconst errorTemplates: Record<\n  string,\n  Omit<UserFriendlyError, 'technicalDetails'>\n> = {\n  // Network errors\n  [ERROR_CODES.NETWORK_OFFLINE]: {\n    code: ERROR_CODES.NETWORK_OFFLINE,\n    category: 'network',\n    severity: 'warning',\n    title: \"You're offline\",\n    message: \"It looks like you've lost your internet connection.\",\n    suggestions: [\n      'Check your Wi-Fi or mobile data connection',\n      \"Try refreshing the page once you're back online\",\n      'Your work will be saved locally and synced when reconnected',\n    ],\n    recoverable: true,\n    retry: {\n      maxAttempts: 5,\n      baseDelay: 2000,\n      exponentialBackoff: true,\n      maxDelay: 30000,\n    },\n  },\n  [ERROR_CODES.NETWORK_TIMEOUT]: {\n    code: ERROR_CODES.NETWORK_TIMEOUT,\n    category: 'timeout',\n    severity: 'warning',\n    title: 'Request timed out',\n    message: 'The server is taking longer than expected to respond.',\n    suggestions: [\n      'Check your internet connection speed',\n      'Try again in a few moments',\n      'If the problem persists, the server may be experiencing high load',\n    ],\n    recoverable: true,\n    retry: { maxAttempts: 3, baseDelay: 3000, exponentialBackoff: true },\n  },\n  [ERROR_CODES.NETWORK_UNREACHABLE]: {\n    code: ERROR_CODES.NETWORK_UNREACHABLE,\n    category: 'network',\n    severity: 'error',\n    title: 'Server unreachable',\n    message: \"We couldn't connect to our servers.\",\n    suggestions: [\n      \"Check if you're behind a firewall or VPN\",\n      'Try disabling browser extensions that might block requests',\n      'Visit our status page to check for outages',\n    ],\n    recoverable: true,\n    retry: { maxAttempts: 3, baseDelay: 5000, exponentialBackoff: true },\n    helpLink: '/status',\n  },\n\n  // Upload errors\n  [ERROR_CODES.UPLOAD_FILE_TOO_LARGE]: {\n    code: ERROR_CODES.UPLOAD_FILE_TOO_LARGE,\n    category: 'upload',\n    severity: 'warning',\n    title: 'File too large',\n    message: 'The file you selected exceeds the maximum allowed size.',\n    suggestions: [\n      'Try compressing the file before uploading',\n      'Split large files into smaller parts',\n      'Upgrade your plan for larger file support',\n    ],\n    recoverable: false,\n    helpLink: '/docs/file-limits',\n  },\n  [ERROR_CODES.UPLOAD_INVALID_TYPE]: {\n    code: ERROR_CODES.UPLOAD_INVALID_TYPE,\n    category: 'upload',\n    severity: 'warning',\n    title: 'Unsupported file type',\n    message: \"This file format isn't supported for metadata extraction.\",\n    suggestions: [\n      'Check our supported formats list',\n      'Convert the file to a supported format',\n      'Contact support if you need this format added',\n    ],\n    recoverable: false,\n    helpLink: '/docs/supported-formats',\n  },\n  [ERROR_CODES.UPLOAD_FAILED]: {\n    code: ERROR_CODES.UPLOAD_FAILED,\n    category: 'upload',\n    severity: 'error',\n    title: 'Upload failed',\n    message: 'Something went wrong while uploading your file.',\n    suggestions: [\n      'Check your internet connection',\n      'Try uploading the file again',\n      'If the problem continues, try a different browser',\n    ],\n    recoverable: true,\n    retry: { maxAttempts: 3, baseDelay: 1000, exponentialBackoff: false },\n  },\n  [ERROR_CODES.UPLOAD_CANCELLED]: {\n    code: ERROR_CODES.UPLOAD_CANCELLED,\n    category: 'upload',\n    severity: 'info',\n    title: 'Upload cancelled',\n    message: 'The file upload was cancelled.',\n    suggestions: [\"You can start a new upload whenever you're ready\"],\n    recoverable: false,\n  },\n  [ERROR_CODES.UPLOAD_CORRUPTED]: {\n    code: ERROR_CODES.UPLOAD_CORRUPTED,\n    category: 'upload',\n    severity: 'error',\n    title: 'File appears corrupted',\n    message: \"We couldn't read this file. It may be damaged or incomplete.\",\n    suggestions: [\n      'Try downloading the original file again',\n      'Check if the file opens correctly on your computer',\n      'Try a different copy of the file if available',\n    ],\n    recoverable: false,\n  },\n\n  // Processing errors\n  [ERROR_CODES.PROCESSING_FAILED]: {\n    code: ERROR_CODES.PROCESSING_FAILED,\n    category: 'processing',\n    severity: 'error',\n    title: 'Processing failed',\n    message:\n      'We encountered an issue while extracting metadata from your file.',\n    suggestions: [\n      'Try uploading the file again',\n      'Check if the file is valid and not corrupted',\n      'Contact support if this keeps happening',\n    ],\n    recoverable: true,\n    retry: { maxAttempts: 2, baseDelay: 2000, exponentialBackoff: false },\n  },\n  [ERROR_CODES.PROCESSING_TIMEOUT]: {\n    code: ERROR_CODES.PROCESSING_TIMEOUT,\n    category: 'timeout',\n    severity: 'warning',\n    title: 'Processing taking too long',\n    message: 'Your file is taking longer than expected to process.',\n    suggestions: [\n      'Large or complex files may take more time',\n      'You can wait or try again with a smaller file',\n      'Results will be emailed if processing completes',\n    ],\n    recoverable: true,\n    retry: { maxAttempts: 2, baseDelay: 5000, exponentialBackoff: true },\n  },\n  [ERROR_CODES.PROCESSING_UNSUPPORTED]: {\n    code: ERROR_CODES.PROCESSING_UNSUPPORTED,\n    category: 'processing',\n    severity: 'warning',\n    title: 'Limited metadata available',\n    message: 'This file type has limited metadata extraction support.',\n    suggestions: [\n      'Basic metadata has been extracted',\n      'Some advanced features may not be available',\n      'Check our docs for full format support details',\n    ],\n    recoverable: false,\n    helpLink: '/docs/format-support',\n  },\n  [ERROR_CODES.PROCESSING_PARTIAL]: {\n    code: ERROR_CODES.PROCESSING_PARTIAL,\n    category: 'processing',\n    severity: 'info',\n    title: 'Partial results available',\n    message:\n      \"We extracted some metadata, but couldn't complete the full analysis.\",\n    suggestions: [\n      'Review the available results below',\n      'Some metadata categories may be incomplete',\n      'Try re-uploading for a complete extraction',\n    ],\n    recoverable: true,\n    retry: { maxAttempts: 1, baseDelay: 1000, exponentialBackoff: false },\n  },\n\n  // Authentication errors\n  [ERROR_CODES.AUTH_INVALID_CREDENTIALS]: {\n    code: ERROR_CODES.AUTH_INVALID_CREDENTIALS,\n    category: 'authentication',\n    severity: 'warning',\n    title: 'Invalid credentials',\n    message: 'The email or password you entered is incorrect.',\n    suggestions: [\n      'Double-check your email address',\n      'Make sure Caps Lock is off',\n      'Use \"Forgot Password\" to reset your password',\n    ],\n    recoverable: false,\n    helpLink: '/forgot-password',\n  },\n  [ERROR_CODES.AUTH_SESSION_EXPIRED]: {\n    code: ERROR_CODES.AUTH_SESSION_EXPIRED,\n    category: 'authentication',\n    severity: 'info',\n    title: 'Session expired',\n    message: 'Your session has expired for security reasons.',\n    suggestions: [\n      'Please sign in again to continue',\n      'Your work has been saved',\n    ],\n    recoverable: false,\n  },\n  [ERROR_CODES.AUTH_ACCOUNT_LOCKED]: {\n    code: ERROR_CODES.AUTH_ACCOUNT_LOCKED,\n    category: 'authentication',\n    severity: 'error',\n    title: 'Account locked',\n    message:\n      'Your account has been temporarily locked due to multiple failed login attempts.',\n    suggestions: [\n      'Wait 15 minutes before trying again',\n      'Use \"Forgot Password\" to reset your password',\n      'Contact support if you need immediate access',\n    ],\n    recoverable: false,\n    helpLink: '/support',\n  },\n  [ERROR_CODES.AUTH_EMAIL_NOT_VERIFIED]: {\n    code: ERROR_CODES.AUTH_EMAIL_NOT_VERIFIED,\n    category: 'authentication',\n    severity: 'warning',\n    title: 'Email not verified',\n    message: 'Please verify your email address to continue.',\n    suggestions: [\n      'Check your inbox for the verification email',\n      'Check your spam folder',\n      'Click \"Resend\" to get a new verification email',\n    ],\n    recoverable: false,\n  },\n\n  // Authorization errors\n  [ERROR_CODES.AUTHZ_INSUFFICIENT_TIER]: {\n    code: ERROR_CODES.AUTHZ_INSUFFICIENT_TIER,\n    category: 'authorization',\n    severity: 'info',\n    title: 'Feature requires upgrade',\n    message: 'This feature is available on higher tier plans.',\n    suggestions: [\n      'View available plans to unlock this feature',\n      'Start a free trial of our Pro plan',\n      'Contact sales for enterprise options',\n    ],\n    recoverable: false,\n    helpLink: '/home#pricing',\n  },\n  [ERROR_CODES.AUTHZ_FEATURE_LOCKED]: {\n    code: ERROR_CODES.AUTHZ_FEATURE_LOCKED,\n    category: 'authorization',\n    severity: 'info',\n    title: 'Feature locked',\n    message: \"This feature isn't available on your current plan.\",\n    suggestions: [\n      'Upgrade your plan to access this feature',\n      \"Check what's included in each plan\",\n    ],\n    recoverable: false,\n    helpLink: '/home#pricing',\n  },\n  [ERROR_CODES.AUTHZ_RATE_LIMITED]: {\n    code: ERROR_CODES.AUTHZ_RATE_LIMITED,\n    category: 'authorization',\n    severity: 'warning',\n    title: 'Too many requests',\n    message: \"You've made too many requests. Please slow down.\",\n    suggestions: [\n      'Wait a moment before trying again',\n      'Upgrade your plan for higher rate limits',\n    ],\n    recoverable: true,\n    retry: {\n      maxAttempts: 3,\n      baseDelay: 10000,\n      exponentialBackoff: true,\n      maxDelay: 60000,\n    },\n  },\n\n  // Validation errors\n  [ERROR_CODES.VALIDATION_REQUIRED_FIELD]: {\n    code: ERROR_CODES.VALIDATION_REQUIRED_FIELD,\n    category: 'validation',\n    severity: 'warning',\n    title: 'Required field missing',\n    message: 'Please fill in all required fields.',\n    suggestions: [\n      'Look for fields marked with an asterisk (*)',\n      'Make sure no required fields are empty',\n    ],\n    recoverable: false,\n  },\n  [ERROR_CODES.VALIDATION_INVALID_FORMAT]: {\n    code: ERROR_CODES.VALIDATION_INVALID_FORMAT,\n    category: 'validation',\n    severity: 'warning',\n    title: 'Invalid format',\n    message: \"The value you entered isn't in the correct format.\",\n    suggestions: [\n      'Check the expected format for this field',\n      'Remove any special characters if not allowed',\n    ],\n    recoverable: false,\n  },\n  [ERROR_CODES.VALIDATION_OUT_OF_RANGE]: {\n    code: ERROR_CODES.VALIDATION_OUT_OF_RANGE,\n    category: 'validation',\n    severity: 'warning',\n    title: 'Value out of range',\n    message: 'The value you entered is outside the allowed range.',\n    suggestions: [\n      'Check the minimum and maximum allowed values',\n      'Enter a value within the specified range',\n    ],\n    recoverable: false,\n  },\n\n  // Server errors\n  [ERROR_CODES.SERVER_INTERNAL]: {\n    code: ERROR_CODES.SERVER_INTERNAL,\n    category: 'server',\n    severity: 'error',\n    title: 'Something went wrong',\n    message: 'We encountered an unexpected error on our end.',\n    suggestions: [\n      'Try refreshing the page',\n      'If the problem persists, please try again later',\n      'Contact support if this keeps happening',\n    ],\n    recoverable: true,\n    retry: { maxAttempts: 2, baseDelay: 3000, exponentialBackoff: true },\n    helpLink: '/support',\n  },\n  [ERROR_CODES.SERVER_MAINTENANCE]: {\n    code: ERROR_CODES.SERVER_MAINTENANCE,\n    category: 'server',\n    severity: 'info',\n    title: 'Scheduled maintenance',\n    message: \"We're currently performing scheduled maintenance.\",\n    suggestions: [\n      'Service will be restored shortly',\n      'Check our status page for updates',\n      \"Your data is safe and will be available when we're back\",\n    ],\n    recoverable: false,\n    helpLink: '/status',\n  },\n  [ERROR_CODES.SERVER_OVERLOADED]: {\n    code: ERROR_CODES.SERVER_OVERLOADED,\n    category: 'server',\n    severity: 'warning',\n    title: 'High demand',\n    message: 'Our servers are experiencing high demand right now.',\n    suggestions: [\n      'Please try again in a few minutes',\n      'Your request has been queued',\n      'Consider upgrading for priority processing',\n    ],\n    recoverable: true,\n    retry: {\n      maxAttempts: 3,\n      baseDelay: 10000,\n      exponentialBackoff: true,\n      maxDelay: 60000,\n    },\n  },\n\n  // Quota errors\n  [ERROR_CODES.QUOTA_EXCEEDED]: {\n    code: ERROR_CODES.QUOTA_EXCEEDED,\n    category: 'quota',\n    severity: 'warning',\n    title: 'Usage limit reached',\n    message: \"You've reached your plan's usage limit.\",\n    suggestions: [\n      'Upgrade your plan for more extractions',\n      'Wait until your quota resets',\n      'View your usage in account settings',\n    ],\n    recoverable: false,\n    helpLink: '/home#pricing',\n  },\n  [ERROR_CODES.QUOTA_DAILY_LIMIT]: {\n    code: ERROR_CODES.QUOTA_DAILY_LIMIT,\n    category: 'quota',\n    severity: 'info',\n    title: 'Daily limit reached',\n    message: \"You've used all your extractions for today.\",\n    suggestions: [\n      'Your limit resets at midnight UTC',\n      'Upgrade for unlimited daily extractions',\n    ],\n    recoverable: false,\n    helpLink: '/home#pricing',\n  },\n  [ERROR_CODES.QUOTA_STORAGE_FULL]: {\n    code: ERROR_CODES.QUOTA_STORAGE_FULL,\n    category: 'quota',\n    severity: 'warning',\n    title: 'Storage full',\n    message: \"You've used all your available storage.\",\n    suggestions: [\n      'Delete old results to free up space',\n      'Export and download results you want to keep',\n      'Upgrade for more storage',\n    ],\n    recoverable: false,\n    helpLink: '/settings/storage',\n  },\n\n  // Unknown error\n  [ERROR_CODES.UNKNOWN]: {\n    code: ERROR_CODES.UNKNOWN,\n    category: 'unknown',\n    severity: 'error',\n    title: 'Unexpected error',\n    message: 'Something unexpected happened.',\n    suggestions: [\n      'Try refreshing the page',\n      'If the problem persists, contact support',\n    ],\n    recoverable: true,\n    retry: { maxAttempts: 1, baseDelay: 2000, exponentialBackoff: false },\n    helpLink: '/support',\n  },\n};\n\n// ============================================================================\n// Error Detection and Mapping\n// ============================================================================\n\n/**\n * Map HTTP status codes to error codes\n */\nexport function mapHttpStatusToErrorCode(status: number): ErrorCode {\n  switch (status) {\n    case 400:\n      return ERROR_CODES.VALIDATION_INVALID_FORMAT;\n    case 401:\n      return ERROR_CODES.AUTH_SESSION_EXPIRED;\n    case 403:\n      return ERROR_CODES.AUTHZ_FEATURE_LOCKED;\n    case 404:\n      return ERROR_CODES.UNKNOWN;\n    case 408:\n      return ERROR_CODES.NETWORK_TIMEOUT;\n    case 413:\n      return ERROR_CODES.UPLOAD_FILE_TOO_LARGE;\n    case 415:\n      return ERROR_CODES.UPLOAD_INVALID_TYPE;\n    case 422:\n      return ERROR_CODES.VALIDATION_INVALID_FORMAT;\n    case 429:\n      return ERROR_CODES.AUTHZ_RATE_LIMITED;\n    case 500:\n      return ERROR_CODES.SERVER_INTERNAL;\n    case 502:\n      return ERROR_CODES.SERVER_OVERLOADED;\n    case 503:\n      return ERROR_CODES.SERVER_MAINTENANCE;\n    case 504:\n      return ERROR_CODES.NETWORK_TIMEOUT;\n    default:\n      return status >= 500 ? ERROR_CODES.SERVER_INTERNAL : ERROR_CODES.UNKNOWN;\n  }\n}\n\n/**\n * Detect error type from various error sources\n */\nexport function detectErrorCode(error: unknown): ErrorCode {\n  // Handle null/undefined\n  if (!error) return ERROR_CODES.UNKNOWN;\n\n  // Handle Error objects\n  if (error instanceof Error) {\n    const message = error.message.toLowerCase();\n\n    // Network errors\n    if (message.includes('network') || message.includes('fetch')) {\n      if (message.includes('offline') || !navigator.onLine) {\n        return ERROR_CODES.NETWORK_OFFLINE;\n      }\n      return ERROR_CODES.NETWORK_UNREACHABLE;\n    }\n\n    // Timeout errors\n    if (message.includes('timeout') || message.includes('timed out')) {\n      return ERROR_CODES.NETWORK_TIMEOUT;\n    }\n\n    // Abort errors\n    if (message.includes('abort') || error.name === 'AbortError') {\n      return ERROR_CODES.UPLOAD_CANCELLED;\n    }\n  }\n\n  // Handle response-like objects\n  if (typeof error === 'object' && error !== null) {\n    const obj = error as Record<string, unknown>;\n\n    // Check for status code\n    if (typeof obj.status === 'number') {\n      return mapHttpStatusToErrorCode(obj.status);\n    }\n\n    // Check for error code\n    if (typeof obj.code === 'string' && obj.code in ERROR_CODES) {\n      return obj.code as ErrorCode;\n    }\n  }\n\n  return ERROR_CODES.UNKNOWN;\n}\n\n// ============================================================================\n// Error Message Generation\n// ============================================================================\n\n/**\n * Get a user-friendly error from an error code\n */\nexport function getUserFriendlyError(\n  code: ErrorCode,\n  technicalDetails?: string\n): UserFriendlyError {\n  const template = errorTemplates[code] || errorTemplates[ERROR_CODES.UNKNOWN];\n  return {\n    ...template,\n    technicalDetails,\n  };\n}\n\n/**\n * Convert any error to a user-friendly error\n */\nexport function toUserFriendlyError(error: unknown): UserFriendlyError {\n  const code = detectErrorCode(error);\n  let technicalDetails: string;\n\n  if (error instanceof Error) {\n    technicalDetails = `${error.name}: ${error.message}`;\n  } else {\n    try {\n      technicalDetails =\n        typeof error === 'string' ? error : JSON.stringify(error);\n    } catch (_) {\n      try {\n        technicalDetails = String(error as any);\n      } catch (_) {\n        technicalDetails = '<unserializable error>';\n      }\n    }\n  }\n\n  return getUserFriendlyError(code, technicalDetails);\n}\n\n/**\n * Create a custom user-friendly error\n */\nexport function createUserFriendlyError(\n  options: Partial<UserFriendlyError> & { title: string; message: string }\n): UserFriendlyError {\n  return {\n    code: options.code || ERROR_CODES.UNKNOWN,\n    category: options.category || 'unknown',\n    severity: options.severity || 'error',\n    title: options.title,\n    message: options.message,\n    suggestions: options.suggestions || [],\n    recoverable: options.recoverable ?? false,\n    retry: options.retry,\n    helpLink: options.helpLink,\n    technicalDetails: options.technicalDetails,\n  };\n}\n\n// ============================================================================\n// Retry Logic\n// ============================================================================\n\n/**\n * Calculate delay for retry attempt\n */\nexport function calculateRetryDelay(\n  attempt: number,\n  config: RetryConfig\n): number {\n  if (!config.exponentialBackoff) {\n    return config.baseDelay;\n  }\n\n  const delay = config.baseDelay * Math.pow(2, attempt - 1);\n  return config.maxDelay ? Math.min(delay, config.maxDelay) : delay;\n}\n\n/**\n * Check if an error should be retried\n */\nexport function shouldRetry(\n  error: UserFriendlyError,\n  currentAttempt: number\n): boolean {\n  if (!error.recoverable || !error.retry) {\n    return false;\n  }\n  return currentAttempt < error.retry.maxAttempts;\n}\n\n/**\n * Execute a function with automatic retry\n */\nexport async function withRetry<T>(\n  fn: () => Promise<T>,\n  errorCode: ErrorCode = ERROR_CODES.UNKNOWN,\n  onRetry?: (attempt: number, delay: number) => void\n): Promise<T> {\n  const error = getUserFriendlyError(errorCode);\n  let attempt = 0;\n\n  while (true) {\n    try {\n      return await fn();\n    } catch (e) {\n      attempt++;\n      const userError = toUserFriendlyError(e);\n\n      if (!shouldRetry(userError, attempt)) {\n        throw userError;\n      }\n\n      const delay = calculateRetryDelay(attempt, userError.retry!);\n      onRetry?.(attempt, delay);\n\n      await new Promise(resolve => setTimeout(resolve, delay));\n    }\n  }\n}\n\n// ============================================================================\n// Error Display Utilities\n// ============================================================================\n\n/**\n * Get icon name for error severity\n */\nexport function getErrorIcon(severity: ErrorSeverity): string {\n  switch (severity) {\n    case 'info':\n      return 'info';\n    case 'warning':\n      return 'alert-triangle';\n    case 'error':\n      return 'x-circle';\n    case 'critical':\n      return 'alert-octagon';\n  }\n}\n\n/**\n * Get color class for error severity\n */\nexport function getErrorColorClass(severity: ErrorSeverity): string {\n  switch (severity) {\n    case 'info':\n      return 'text-blue-500 bg-blue-500/10 border-blue-500/20';\n    case 'warning':\n      return 'text-yellow-500 bg-yellow-500/10 border-yellow-500/20';\n    case 'error':\n      return 'text-red-500 bg-red-500/10 border-red-500/20';\n    case 'critical':\n      return 'text-red-600 bg-red-600/10 border-red-600/20';\n  }\n}\n\n/**\n * Format error for logging (includes technical details)\n */\nexport function formatErrorForLogging(error: UserFriendlyError): string {\n  return JSON.stringify({\n    code: error.code,\n    category: error.category,\n    severity: error.severity,\n    title: error.title,\n    technicalDetails: error.technicalDetails,\n    timestamp: new Date().toISOString(),\n  });\n}\n\n/**\n * Format error for display (user-friendly)\n */\nexport function formatErrorForDisplay(error: UserFriendlyError): string {\n  return `${error.title}: ${error.message}`;\n}\n\n// ============================================================================\n// Export All\n// ============================================================================\n\nexport const errorMessages = {\n  ERROR_CODES,\n  errorTemplates,\n  mapHttpStatusToErrorCode,\n  detectErrorCode,\n  getUserFriendlyError,\n  toUserFriendlyError,\n  createUserFriendlyError,\n  calculateRetryDelay,\n  shouldRetry,\n  withRetry,\n  getErrorIcon,\n  getErrorColorClass,\n  formatErrorForLogging,\n  formatErrorForDisplay,\n} as const;\n\nexport default errorMessages;\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/help-system.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'searchableText' is assigned a value but never used.","line":526,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":526,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Comprehensive Help and Documentation System\n * \n * Provides contextual tooltips, help content, metadata field descriptions,\n * and searchable help documentation.\n * \n * @module help-system\n * @validates Requirements 2.6, 3.3 - Contextual help and metadata documentation\n */\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface HelpTopic {\n  /** Unique identifier */\n  id: string;\n  /** Display title */\n  title: string;\n  /** Short description for tooltips */\n  shortDescription: string;\n  /** Full description for help panels */\n  fullDescription: string;\n  /** Related topics */\n  relatedTopics?: string[];\n  /** Keywords for search */\n  keywords: string[];\n  /** Category for grouping */\n  category: HelpCategory;\n  /** Link to external documentation */\n  externalLink?: string;\n}\n\nexport type HelpCategory = \n  | 'getting-started'\n  | 'upload'\n  | 'metadata'\n  | 'analysis'\n  | 'export'\n  | 'account'\n  | 'pricing'\n  | 'security'\n  | 'troubleshooting';\n\nexport interface MetadataFieldDoc {\n  /** Field name/key */\n  field: string;\n  /** Human-readable label */\n  label: string;\n  /** Description of what this field contains */\n  description: string;\n  /** Example value */\n  example?: string;\n  /** Data type */\n  type: 'string' | 'number' | 'date' | 'boolean' | 'array' | 'object';\n  /** Category this field belongs to */\n  category: MetadataCategory;\n  /** Whether this is a common/important field */\n  common?: boolean;\n  /** Technical standard this field comes from */\n  standard?: string;\n}\n\nexport type MetadataCategory =\n  | 'basic'\n  | 'camera'\n  | 'location'\n  | 'datetime'\n  | 'technical'\n  | 'color'\n  | 'copyright'\n  | 'software'\n  | 'forensic'\n  | 'audio'\n  | 'video'\n  | 'document';\n\n// ============================================================================\n// Help Topics Database\n// ============================================================================\n\nexport const helpTopics: Record<string, HelpTopic> = {\n  // Getting Started\n  'getting-started': {\n    id: 'getting-started',\n    title: 'Getting Started',\n    shortDescription: 'Learn the basics of metadata extraction',\n    fullDescription: 'MetaExtract helps you extract and analyze metadata from images, documents, and media files. Simply upload a file to see all the hidden information it contains, including camera settings, location data, timestamps, and more.',\n    relatedTopics: ['upload-file', 'supported-formats', 'metadata-basics'],\n    keywords: ['start', 'begin', 'intro', 'introduction', 'basics', 'how to'],\n    category: 'getting-started',\n  },\n  'upload-file': {\n    id: 'upload-file',\n    title: 'Uploading Files',\n    shortDescription: 'How to upload files for analysis',\n    fullDescription: 'Drag and drop files onto the upload zone, or click to browse. You can upload multiple files at once. Supported formats include JPEG, PNG, TIFF, PDF, MP4, and many more.',\n    relatedTopics: ['supported-formats', 'file-limits'],\n    keywords: ['upload', 'drag', 'drop', 'file', 'browse', 'select'],\n    category: 'upload',\n  },\n  'supported-formats': {\n    id: 'supported-formats',\n    title: 'Supported File Formats',\n    shortDescription: 'List of supported file types',\n    fullDescription: 'We support over 100 file formats including: Images (JPEG, PNG, TIFF, RAW, HEIC), Documents (PDF, DOCX, XLSX), Audio (MP3, WAV, FLAC), Video (MP4, MOV, AVI), and many specialized formats.',\n    relatedTopics: ['upload-file', 'file-limits'],\n    keywords: ['format', 'type', 'extension', 'jpeg', 'png', 'pdf', 'mp4', 'supported'],\n    category: 'upload',\n    externalLink: '/docs/supported-formats',\n  },\n  'file-limits': {\n    id: 'file-limits',\n    title: 'File Size Limits',\n    shortDescription: 'Maximum file sizes by plan',\n    fullDescription: 'Free tier: 10MB per file. Pro tier: 100MB per file. Enterprise: 1GB per file. Batch uploads are limited to 10 files at a time on Free, 50 on Pro, and unlimited on Enterprise.',\n    relatedTopics: ['pricing', 'upload-file'],\n    keywords: ['size', 'limit', 'maximum', 'mb', 'gb', 'large'],\n    category: 'upload',\n  },\n\n  // Metadata Topics\n  'metadata-basics': {\n    id: 'metadata-basics',\n    title: 'Understanding Metadata',\n    shortDescription: 'What is metadata and why it matters',\n    fullDescription: 'Metadata is data about data. For images, this includes when and where a photo was taken, camera settings, and editing history. Understanding metadata helps with organization, verification, and forensic analysis.',\n    relatedTopics: ['exif-data', 'iptc-data', 'xmp-data'],\n    keywords: ['metadata', 'what is', 'understand', 'basics', 'definition'],\n    category: 'metadata',\n  },\n  'exif-data': {\n    id: 'exif-data',\n    title: 'EXIF Data',\n    shortDescription: 'Camera and technical image data',\n    fullDescription: 'EXIF (Exchangeable Image File Format) contains technical information recorded by cameras: aperture, shutter speed, ISO, focal length, GPS coordinates, date/time, and camera model.',\n    relatedTopics: ['metadata-basics', 'iptc-data'],\n    keywords: ['exif', 'camera', 'technical', 'settings', 'photo'],\n    category: 'metadata',\n    externalLink: '/docs/exif',\n  },\n  'iptc-data': {\n    id: 'iptc-data',\n    title: 'IPTC Data',\n    shortDescription: 'Editorial and copyright information',\n    fullDescription: 'IPTC (International Press Telecommunications Council) metadata includes editorial information: captions, keywords, copyright, creator credits, and usage rights.',\n    relatedTopics: ['metadata-basics', 'exif-data'],\n    keywords: ['iptc', 'editorial', 'caption', 'keywords', 'press'],\n    category: 'metadata',\n  },\n  'xmp-data': {\n    id: 'xmp-data',\n    title: 'XMP Data',\n    shortDescription: 'Adobe extensible metadata',\n    fullDescription: 'XMP (Extensible Metadata Platform) is Adobe\\'s standard for embedding metadata. It can store editing history, ratings, labels, and custom metadata fields.',\n    relatedTopics: ['metadata-basics', 'iptc-data'],\n    keywords: ['xmp', 'adobe', 'extensible', 'editing', 'history'],\n    category: 'metadata',\n  },\n\n  // Analysis Topics\n  'forensic-analysis': {\n    id: 'forensic-analysis',\n    title: 'Forensic Analysis',\n    shortDescription: 'Detect image manipulation and authenticity',\n    fullDescription: 'Our forensic tools analyze images for signs of manipulation: ELA (Error Level Analysis), clone detection, metadata inconsistencies, and compression artifacts.',\n    relatedTopics: ['ela-analysis', 'metadata-basics'],\n    keywords: ['forensic', 'manipulation', 'fake', 'authentic', 'detect', 'analysis'],\n    category: 'analysis',\n  },\n  'ela-analysis': {\n    id: 'ela-analysis',\n    title: 'Error Level Analysis (ELA)',\n    shortDescription: 'Detect edited regions in images',\n    fullDescription: 'ELA highlights areas that have been resaved at different quality levels, which can indicate editing. Edited regions often show different error levels than the original image.',\n    relatedTopics: ['forensic-analysis'],\n    keywords: ['ela', 'error level', 'editing', 'detection', 'quality'],\n    category: 'analysis',\n  },\n\n  // Export Topics\n  'export-results': {\n    id: 'export-results',\n    title: 'Exporting Results',\n    shortDescription: 'Download your analysis results',\n    fullDescription: 'Export your metadata analysis in multiple formats: JSON for developers, CSV for spreadsheets, PDF for reports, or XML for archival purposes.',\n    relatedTopics: ['json-export'],\n    keywords: ['export', 'download', 'save', 'json', 'csv', 'pdf'],\n    category: 'export',\n  },\n  'json-export': {\n    id: 'json-export',\n    title: 'JSON Export',\n    shortDescription: 'Machine-readable metadata export',\n    fullDescription: 'JSON export provides the complete metadata in a structured format ideal for developers, APIs, and automated processing.',\n    relatedTopics: ['export-results'],\n    keywords: ['json', 'export', 'developer', 'api', 'structured'],\n    category: 'export',\n  },\n\n  // Account Topics\n  'account-settings': {\n    id: 'account-settings',\n    title: 'Account Settings',\n    shortDescription: 'Manage your account preferences',\n    fullDescription: 'Update your profile, change password, manage API keys, view usage statistics, and configure notification preferences.',\n    relatedTopics: ['api-keys'],\n    keywords: ['account', 'settings', 'profile', 'preferences', 'password'],\n    category: 'account',\n  },\n  'api-keys': {\n    id: 'api-keys',\n    title: 'API Keys',\n    shortDescription: 'Manage your API access keys',\n    fullDescription: 'Generate and manage API keys for programmatic access to MetaExtract. Each key can have specific permissions and rate limits.',\n    relatedTopics: ['account-settings'],\n    keywords: ['api', 'key', 'token', 'access', 'programmatic'],\n    category: 'account',\n    externalLink: '/docs/api',\n  },\n\n  // Pricing Topics\n  'pricing': {\n    id: 'pricing',\n    title: 'Pricing Plans',\n    shortDescription: 'Compare our pricing tiers',\n    fullDescription: 'Choose from Free, Pro, or Enterprise plans. Each tier offers different file limits, features, and support levels. Upgrade anytime to unlock more capabilities.',\n    relatedTopics: ['file-limits'],\n    keywords: ['pricing', 'plan', 'tier', 'cost', 'free', 'pro', 'enterprise'],\n    category: 'pricing',\n    externalLink: '/home#pricing',\n  },\n\n  // Security Topics\n  'data-privacy': {\n    id: 'data-privacy',\n    title: 'Data Privacy',\n    shortDescription: 'How we protect your data',\n    fullDescription: 'Your files are processed securely and deleted immediately after analysis. We never store your files or share your data. All transfers are encrypted with TLS 1.3.',\n    keywords: ['privacy', 'data', 'security', 'delete', 'encrypt', 'gdpr'],\n    category: 'security',\n  },\n\n  // Troubleshooting\n  'upload-failed': {\n    id: 'upload-failed',\n    title: 'Upload Failed',\n    shortDescription: 'Troubleshoot upload issues',\n    fullDescription: 'If your upload fails, check: file size limits, supported formats, internet connection, and browser compatibility. Try refreshing the page or using a different browser.',\n    relatedTopics: ['file-limits', 'supported-formats'],\n    keywords: ['upload', 'failed', 'error', 'problem', 'troubleshoot'],\n    category: 'troubleshooting',\n  },\n};\n\n// ============================================================================\n// Metadata Field Documentation\n// ============================================================================\n\nexport const metadataFieldDocs: Record<string, MetadataFieldDoc> = {\n  // Basic Fields\n  'fileName': {\n    field: 'fileName',\n    label: 'File Name',\n    description: 'The name of the file as stored on disk',\n    example: 'IMG_2024.jpg',\n    type: 'string',\n    category: 'basic',\n    common: true,\n  },\n  'fileSize': {\n    field: 'fileSize',\n    label: 'File Size',\n    description: 'The size of the file in bytes',\n    example: '2457600',\n    type: 'number',\n    category: 'basic',\n    common: true,\n  },\n  'mimeType': {\n    field: 'mimeType',\n    label: 'MIME Type',\n    description: 'The media type identifier for the file format',\n    example: 'image/jpeg',\n    type: 'string',\n    category: 'basic',\n    common: true,\n  },\n  'imageWidth': {\n    field: 'imageWidth',\n    label: 'Image Width',\n    description: 'Width of the image in pixels',\n    example: '4032',\n    type: 'number',\n    category: 'basic',\n    common: true,\n  },\n  'imageHeight': {\n    field: 'imageHeight',\n    label: 'Image Height',\n    description: 'Height of the image in pixels',\n    example: '3024',\n    type: 'number',\n    category: 'basic',\n    common: true,\n  },\n\n  // Camera Fields\n  'make': {\n    field: 'make',\n    label: 'Camera Make',\n    description: 'The manufacturer of the camera or device',\n    example: 'Apple',\n    type: 'string',\n    category: 'camera',\n    common: true,\n    standard: 'EXIF',\n  },\n  'model': {\n    field: 'model',\n    label: 'Camera Model',\n    description: 'The specific model of the camera or device',\n    example: 'iPhone 15 Pro',\n    type: 'string',\n    category: 'camera',\n    common: true,\n    standard: 'EXIF',\n  },\n  'exposureTime': {\n    field: 'exposureTime',\n    label: 'Exposure Time',\n    description: 'Shutter speed in seconds (how long the sensor was exposed)',\n    example: '1/125',\n    type: 'string',\n    category: 'camera',\n    common: true,\n    standard: 'EXIF',\n  },\n  'fNumber': {\n    field: 'fNumber',\n    label: 'F-Number (Aperture)',\n    description: 'The aperture setting (f-stop) controlling depth of field',\n    example: 'f/2.8',\n    type: 'string',\n    category: 'camera',\n    common: true,\n    standard: 'EXIF',\n  },\n  'iso': {\n    field: 'iso',\n    label: 'ISO Speed',\n    description: 'Light sensitivity setting of the camera sensor',\n    example: '400',\n    type: 'number',\n    category: 'camera',\n    common: true,\n    standard: 'EXIF',\n  },\n  'focalLength': {\n    field: 'focalLength',\n    label: 'Focal Length',\n    description: 'The focal length of the lens in millimeters',\n    example: '50mm',\n    type: 'string',\n    category: 'camera',\n    standard: 'EXIF',\n  },\n  'flash': {\n    field: 'flash',\n    label: 'Flash',\n    description: 'Whether flash was used and its mode',\n    example: 'Flash did not fire',\n    type: 'string',\n    category: 'camera',\n    standard: 'EXIF',\n  },\n\n  // Location Fields\n  'gpsLatitude': {\n    field: 'gpsLatitude',\n    label: 'GPS Latitude',\n    description: 'The north-south position where the photo was taken',\n    example: '37.7749',\n    type: 'number',\n    category: 'location',\n    common: true,\n    standard: 'EXIF',\n  },\n  'gpsLongitude': {\n    field: 'gpsLongitude',\n    label: 'GPS Longitude',\n    description: 'The east-west position where the photo was taken',\n    example: '-122.4194',\n    type: 'number',\n    category: 'location',\n    common: true,\n    standard: 'EXIF',\n  },\n  'gpsAltitude': {\n    field: 'gpsAltitude',\n    label: 'GPS Altitude',\n    description: 'Height above sea level in meters',\n    example: '15.5',\n    type: 'number',\n    category: 'location',\n    standard: 'EXIF',\n  },\n\n  // DateTime Fields\n  'dateTimeOriginal': {\n    field: 'dateTimeOriginal',\n    label: 'Date Taken',\n    description: 'When the photo was originally captured',\n    example: '2024-03-15 14:30:00',\n    type: 'date',\n    category: 'datetime',\n    common: true,\n    standard: 'EXIF',\n  },\n  'dateTimeDigitized': {\n    field: 'dateTimeDigitized',\n    label: 'Date Digitized',\n    description: 'When the image was digitized (scanned or converted)',\n    example: '2024-03-15 14:30:00',\n    type: 'date',\n    category: 'datetime',\n    standard: 'EXIF',\n  },\n  'modifyDate': {\n    field: 'modifyDate',\n    label: 'Date Modified',\n    description: 'When the file was last modified',\n    example: '2024-03-16 10:00:00',\n    type: 'date',\n    category: 'datetime',\n    common: true,\n  },\n\n  // Technical Fields\n  'colorSpace': {\n    field: 'colorSpace',\n    label: 'Color Space',\n    description: 'The color model used (sRGB, Adobe RGB, etc.)',\n    example: 'sRGB',\n    type: 'string',\n    category: 'color',\n    standard: 'EXIF',\n  },\n  'bitDepth': {\n    field: 'bitDepth',\n    label: 'Bit Depth',\n    description: 'Number of bits per color channel',\n    example: '8',\n    type: 'number',\n    category: 'technical',\n  },\n  'compression': {\n    field: 'compression',\n    label: 'Compression',\n    description: 'The compression method used',\n    example: 'JPEG',\n    type: 'string',\n    category: 'technical',\n  },\n\n  // Copyright Fields\n  'copyright': {\n    field: 'copyright',\n    label: 'Copyright',\n    description: 'Copyright notice for the image',\n    example: ' 2024 Photographer Name',\n    type: 'string',\n    category: 'copyright',\n    common: true,\n    standard: 'IPTC',\n  },\n  'artist': {\n    field: 'artist',\n    label: 'Artist/Creator',\n    description: 'Name of the photographer or creator',\n    example: 'John Doe',\n    type: 'string',\n    category: 'copyright',\n    standard: 'EXIF',\n  },\n\n  // Software Fields\n  'software': {\n    field: 'software',\n    label: 'Software',\n    description: 'Software used to create or edit the file',\n    example: 'Adobe Photoshop 25.0',\n    type: 'string',\n    category: 'software',\n    standard: 'EXIF',\n  },\n  'editHistory': {\n    field: 'editHistory',\n    label: 'Edit History',\n    description: 'Record of editing operations performed on the file',\n    type: 'array',\n    category: 'software',\n    standard: 'XMP',\n  },\n};\n\n// ============================================================================\n// Search and Lookup Functions\n// ============================================================================\n\n/**\n * Search help topics by query\n */\nexport function searchHelpTopics(query: string): HelpTopic[] {\n  if (!query || query.trim().length === 0) {\n    return Object.values(helpTopics);\n  }\n  \n  const normalizedQuery = query.toLowerCase().trim();\n  const words = normalizedQuery.split(/\\s+/);\n  \n  return Object.values(helpTopics)\n    .map(topic => {\n      // Calculate relevance score\n      let score = 0;\n      const searchableText = [\n        topic.title,\n        topic.shortDescription,\n        topic.fullDescription,\n        ...topic.keywords,\n      ].join(' ').toLowerCase();\n      \n      words.forEach(word => {\n        if (topic.title.toLowerCase().includes(word)) score += 10;\n        if (topic.keywords.some(k => k.toLowerCase().includes(word))) score += 5;\n        if (topic.shortDescription.toLowerCase().includes(word)) score += 3;\n        if (topic.fullDescription.toLowerCase().includes(word)) score += 1;\n      });\n      \n      return { topic, score };\n    })\n    .filter(({ score }) => score > 0)\n    .sort((a, b) => b.score - a.score)\n    .map(({ topic }) => topic);\n}\n\n/**\n * Get help topic by ID\n */\nexport function getHelpTopic(id: string): HelpTopic | undefined {\n  return helpTopics[id];\n}\n\n/**\n * Get help topics by category\n */\nexport function getHelpTopicsByCategory(category: HelpCategory): HelpTopic[] {\n  return Object.values(helpTopics).filter(topic => topic.category === category);\n}\n\n/**\n * Get related help topics\n */\nexport function getRelatedTopics(topicId: string): HelpTopic[] {\n  const topic = helpTopics[topicId];\n  if (!topic || !topic.relatedTopics) return [];\n  \n  return topic.relatedTopics\n    .map(id => helpTopics[id])\n    .filter((t): t is HelpTopic => t !== undefined);\n}\n\n/**\n * Get metadata field documentation\n */\nexport function getMetadataFieldDoc(field: string): MetadataFieldDoc | undefined {\n  return metadataFieldDocs[field];\n}\n\n/**\n * Get metadata fields by category\n */\nexport function getMetadataFieldsByCategory(category: MetadataCategory): MetadataFieldDoc[] {\n  return Object.values(metadataFieldDocs).filter(doc => doc.category === category);\n}\n\n/**\n * Get common/important metadata fields\n */\nexport function getCommonMetadataFields(): MetadataFieldDoc[] {\n  return Object.values(metadataFieldDocs).filter(doc => doc.common);\n}\n\n/**\n * Search metadata field documentation\n */\nexport function searchMetadataFields(query: string): MetadataFieldDoc[] {\n  if (!query || query.trim().length === 0) {\n    return Object.values(metadataFieldDocs);\n  }\n  \n  const normalizedQuery = query.toLowerCase().trim();\n  \n  return Object.values(metadataFieldDocs).filter(doc => {\n    const searchableText = [\n      doc.field,\n      doc.label,\n      doc.description,\n      doc.standard || '',\n    ].join(' ').toLowerCase();\n    \n    return searchableText.includes(normalizedQuery);\n  });\n}\n\n// ============================================================================\n// Contextual Help Utilities\n// ============================================================================\n\n/** Context identifiers for contextual help */\nexport type HelpContext = \n  | 'upload-zone'\n  | 'results-view'\n  | 'metadata-panel'\n  | 'forensic-panel'\n  | 'export-dialog'\n  | 'pricing-page'\n  | 'settings-page'\n  | 'dashboard';\n\n/** Map contexts to relevant help topics */\nconst contextHelpMap: Record<HelpContext, string[]> = {\n  'upload-zone': ['upload-file', 'supported-formats', 'file-limits'],\n  'results-view': ['metadata-basics', 'export-results'],\n  'metadata-panel': ['exif-data', 'iptc-data', 'xmp-data'],\n  'forensic-panel': ['forensic-analysis', 'ela-analysis'],\n  'export-dialog': ['export-results', 'json-export'],\n  'pricing-page': ['pricing', 'file-limits'],\n  'settings-page': ['account-settings', 'api-keys', 'data-privacy'],\n  'dashboard': ['getting-started', 'upload-file'],\n};\n\n/**\n * Get contextual help topics for a specific UI context\n */\nexport function getContextualHelp(context: HelpContext): HelpTopic[] {\n  const topicIds = contextHelpMap[context] || [];\n  return topicIds\n    .map(id => helpTopics[id])\n    .filter((t): t is HelpTopic => t !== undefined);\n}\n\n/**\n * Get tooltip content for a metadata field\n */\nexport function getFieldTooltip(field: string): string | undefined {\n  const doc = metadataFieldDocs[field];\n  if (!doc) return undefined;\n  \n  let tooltip = doc.description;\n  if (doc.example) {\n    tooltip += ` Example: ${doc.example}`;\n  }\n  return tooltip;\n}\n\n// ============================================================================\n// Category Labels\n// ============================================================================\n\nexport const helpCategoryLabels: Record<HelpCategory, string> = {\n  'getting-started': 'Getting Started',\n  'upload': 'Uploading Files',\n  'metadata': 'Understanding Metadata',\n  'analysis': 'Analysis Tools',\n  'export': 'Exporting Results',\n  'account': 'Account & Settings',\n  'pricing': 'Pricing & Plans',\n  'security': 'Security & Privacy',\n  'troubleshooting': 'Troubleshooting',\n};\n\nexport const metadataCategoryLabels: Record<MetadataCategory, string> = {\n  'basic': 'Basic Information',\n  'camera': 'Camera Settings',\n  'location': 'Location Data',\n  'datetime': 'Date & Time',\n  'technical': 'Technical Details',\n  'color': 'Color Information',\n  'copyright': 'Copyright & Credits',\n  'software': 'Software & Editing',\n  'forensic': 'Forensic Data',\n  'audio': 'Audio Metadata',\n  'video': 'Video Metadata',\n  'document': 'Document Metadata',\n};\n\n// ============================================================================\n// Export All\n// ============================================================================\n\nexport const helpSystem = {\n  helpTopics,\n  metadataFieldDocs,\n  searchHelpTopics,\n  getHelpTopic,\n  getHelpTopicsByCategory,\n  getRelatedTopics,\n  getMetadataFieldDoc,\n  getMetadataFieldsByCategory,\n  getCommonMetadataFields,\n  searchMetadataFields,\n  getContextualHelp,\n  getFieldTooltip,\n  helpCategoryLabels,\n  metadataCategoryLabels,\n} as const;\n\nexport default helpSystem;\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/images-mvp-analytics.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1559,1562],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1559,1562],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1600,1603],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1600,1603],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":58,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":58,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const SESSION_STORAGE_KEY = 'metaextract_session_id';\n\nconst SIZE_BUCKETS = [\n  { label: '<1MB', max: 1 * 1024 * 1024 },\n  { label: '1-5MB', max: 5 * 1024 * 1024 },\n  { label: '5-20MB', max: 20 * 1024 * 1024 },\n  { label: '20-100MB', max: 100 * 1024 * 1024 },\n];\n\nexport function getImagesMvpSessionId(): string | null {\n  if (typeof window === 'undefined') return null;\n  let sessionId = localStorage.getItem(SESSION_STORAGE_KEY);\n  if (!sessionId) {\n    sessionId = crypto.randomUUID();\n    localStorage.setItem(SESSION_STORAGE_KEY, sessionId);\n  }\n  return sessionId;\n}\n\nexport function getFileSizeBucket(bytes?: number | null): string {\n  if (!bytes || bytes <= 0) return 'unknown';\n  for (const bucket of SIZE_BUCKETS) {\n    if (bytes <= bucket.max) return bucket.label;\n  }\n  return '>100MB';\n}\n\nexport function trackImagesMvpEvent(\n  event: string,\n  properties: Record<string, unknown> = {}\n): void {\n  if (typeof window === 'undefined' || !event) return;\n\n  const payload = JSON.stringify({\n    event,\n    properties,\n    sessionId: getImagesMvpSessionId(),\n  });\n\n  if (navigator.sendBeacon) {\n    const blob = new Blob([payload], { type: 'application/json' });\n    navigator.sendBeacon('/api/images_mvp/analytics/track', blob);\n    return;\n  }\n\n  const res = fetch('/api/images_mvp/analytics/track', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: payload,\n    keepalive: true,\n  });\n  // In some test environments fetch may be undefined or non-promise; guard against that\n  try {\n    if (res && typeof (res as any).catch === 'function')\n      (res as any).catch(() => {\n        // Best-effort analytics.\n      });\n  } catch (e) {\n    // swallow any synchronous errors\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/images-mvp-quote.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/interactive-feedback.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'transitions' is defined but never used.","line":11,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Interactive Feedback System\n * \n * Centralized utilities for hover, focus, active states, and micro-interactions.\n * Provides consistent interactive feedback across all UI components.\n * \n * @module interactive-feedback\n * @validates Requirements 1.2 - Interactive feedback for all components\n */\n\nimport { transitions } from './design-tokens';\n\n// ============================================================================\n// Interactive State Classes\n// ============================================================================\n\n/**\n * Base interactive states that can be applied to any interactive element\n */\nexport const interactiveStates = {\n  // Hover states\n  hover: {\n    subtle: 'hover:bg-white/5 hover:border-white/20',\n    medium: 'hover:bg-white/10 hover:border-white/30',\n    strong: 'hover:bg-white/15 hover:border-white/40',\n    primary: 'hover:bg-primary/10 hover:border-primary/30',\n    glow: 'hover:shadow-[0_0_20px_rgba(99,102,241,0.3)]',\n  },\n  \n  // Focus states (accessibility-compliant)\n  focus: {\n    ring: 'focus:outline-none focus:ring-2 focus:ring-primary/50 focus:ring-offset-2 focus:ring-offset-background',\n    border: 'focus:outline-none focus:border-primary focus:shadow-[0_0_0_3px_rgba(99,102,241,0.2)]',\n    glow: 'focus:outline-none focus:shadow-[0_0_15px_rgba(99,102,241,0.4)]',\n    visible: 'focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/50 focus-visible:ring-offset-2',\n  },\n  \n  // Active/pressed states\n  active: {\n    scale: 'active:scale-[0.98]',\n    opacity: 'active:opacity-80',\n    translate: 'active:translate-y-[1px]',\n    shadow: 'active:shadow-inner',\n    combined: 'active:scale-[0.98] active:opacity-90',\n  },\n  \n  // Disabled states\n  disabled: {\n    base: 'disabled:opacity-50 disabled:cursor-not-allowed disabled:pointer-events-none',\n    muted: 'disabled:opacity-40 disabled:grayscale disabled:cursor-not-allowed',\n  },\n} as const;\n\n// ============================================================================\n// Transition Classes\n// ============================================================================\n\n/**\n * Transition utilities for smooth state changes\n */\nexport const transitionClasses = {\n  // Duration-based transitions\n  fast: 'transition-all duration-150 ease-out',\n  normal: 'transition-all duration-200 ease-out',\n  slow: 'transition-all duration-300 ease-out',\n  slower: 'transition-all duration-500 ease-out',\n  \n  // Property-specific transitions\n  colors: 'transition-colors duration-200 ease-out',\n  transform: 'transition-transform duration-200 ease-out',\n  opacity: 'transition-opacity duration-200 ease-out',\n  shadow: 'transition-shadow duration-200 ease-out',\n  \n  // Combined transitions\n  interactive: 'transition-all duration-200 ease-out',\n  hover: 'transition-[background-color,border-color,box-shadow] duration-200 ease-out',\n} as const;\n\n// ============================================================================\n// Component-Specific Feedback Classes\n// ============================================================================\n\n/**\n * Pre-built interactive feedback classes for common components\n */\nexport const componentFeedback = {\n  // Button feedback\n  button: {\n    default: `\n      ${transitionClasses.interactive}\n      ${interactiveStates.hover.primary}\n      ${interactiveStates.focus.visible}\n      ${interactiveStates.active.combined}\n      ${interactiveStates.disabled.base}\n    `.trim().replace(/\\s+/g, ' '),\n    \n    ghost: `\n      ${transitionClasses.interactive}\n      ${interactiveStates.hover.subtle}\n      ${interactiveStates.focus.visible}\n      ${interactiveStates.active.scale}\n      ${interactiveStates.disabled.base}\n    `.trim().replace(/\\s+/g, ' '),\n    \n    primary: `\n      ${transitionClasses.interactive}\n      hover:brightness-110 hover:shadow-lg\n      ${interactiveStates.focus.glow}\n      ${interactiveStates.active.combined}\n      ${interactiveStates.disabled.base}\n    `.trim().replace(/\\s+/g, ' '),\n  },\n  \n  // Input feedback\n  input: {\n    default: `\n      ${transitionClasses.interactive}\n      hover:border-white/30\n      ${interactiveStates.focus.border}\n      ${interactiveStates.disabled.base}\n    `.trim().replace(/\\s+/g, ' '),\n    \n    search: `\n      ${transitionClasses.interactive}\n      hover:bg-white/5 hover:border-white/20\n      focus:bg-white/5 focus:border-primary\n      ${interactiveStates.disabled.base}\n    `.trim().replace(/\\s+/g, ' '),\n  },\n  \n  // Card feedback\n  card: {\n    default: `\n      ${transitionClasses.interactive}\n      ${interactiveStates.hover.subtle}\n    `.trim().replace(/\\s+/g, ' '),\n    \n    interactive: `\n      ${transitionClasses.interactive}\n      ${interactiveStates.hover.medium}\n      hover:shadow-lg hover:-translate-y-0.5\n      cursor-pointer\n    `.trim().replace(/\\s+/g, ' '),\n    \n    selectable: `\n      ${transitionClasses.interactive}\n      ${interactiveStates.hover.primary}\n      hover:shadow-[0_0_20px_rgba(99,102,241,0.2)]\n      cursor-pointer\n    `.trim().replace(/\\s+/g, ' '),\n  },\n  \n  // Link feedback\n  link: {\n    default: `\n      ${transitionClasses.colors}\n      hover:text-primary\n      ${interactiveStates.focus.visible}\n    `.trim().replace(/\\s+/g, ' '),\n    \n    underline: `\n      ${transitionClasses.colors}\n      hover:text-primary hover:underline\n      ${interactiveStates.focus.visible}\n    `.trim().replace(/\\s+/g, ' '),\n    \n    nav: `\n      ${transitionClasses.interactive}\n      hover:text-white hover:bg-white/5\n      ${interactiveStates.focus.visible}\n    `.trim().replace(/\\s+/g, ' '),\n  },\n  \n  // Icon button feedback\n  iconButton: {\n    default: `\n      ${transitionClasses.interactive}\n      hover:bg-white/10 hover:text-white\n      ${interactiveStates.focus.ring}\n      ${interactiveStates.active.scale}\n      ${interactiveStates.disabled.base}\n    `.trim().replace(/\\s+/g, ' '),\n    \n    ghost: `\n      ${transitionClasses.interactive}\n      hover:bg-white/5\n      ${interactiveStates.focus.visible}\n      ${interactiveStates.active.opacity}\n    `.trim().replace(/\\s+/g, ' '),\n  },\n  \n  // Tab feedback\n  tab: {\n    default: `\n      ${transitionClasses.interactive}\n      hover:bg-white/5 hover:text-white\n      data-[state=active]:bg-primary/10 data-[state=active]:text-primary\n      ${interactiveStates.focus.visible}\n    `.trim().replace(/\\s+/g, ' '),\n  },\n  \n  // Dropdown/Select feedback\n  dropdown: {\n    default: `\n      ${transitionClasses.interactive}\n      hover:bg-white/5 hover:border-white/20\n      ${interactiveStates.focus.border}\n      data-[state=open]:border-primary\n    `.trim().replace(/\\s+/g, ' '),\n    \n    trigger: `\n      ${transitionClasses.interactive}\n      hover:bg-white/5 hover:border-white/20\n      ${interactiveStates.focus.border}\n      data-[state=open]:border-primary\n    `.trim().replace(/\\s+/g, ' '),\n    \n    item: `\n      ${transitionClasses.fast}\n      hover:bg-white/10 hover:text-white\n      focus:bg-white/10 focus:text-white\n      cursor-pointer\n    `.trim().replace(/\\s+/g, ' '),\n  },\n  \n  // Checkbox/Radio feedback\n  checkbox: {\n    default: `\n      ${transitionClasses.interactive}\n      hover:border-primary/50\n      ${interactiveStates.focus.ring}\n      data-[state=checked]:bg-primary data-[state=checked]:border-primary\n    `.trim().replace(/\\s+/g, ' '),\n  },\n  \n  // Toggle/Switch feedback\n  toggle: {\n    default: `\n      ${transitionClasses.interactive}\n      hover:bg-white/20\n      ${interactiveStates.focus.ring}\n      data-[state=checked]:bg-primary\n    `.trim().replace(/\\s+/g, ' '),\n  },\n} as const;\n\n// ============================================================================\n// Micro-Interaction Animations\n// ============================================================================\n\n/**\n * CSS keyframe animation classes for micro-interactions\n */\nexport const microInteractions = {\n  // Pulse effect for attention\n  pulse: 'animate-pulse',\n  \n  // Bounce effect for success/completion\n  bounce: 'animate-bounce',\n  \n  // Spin for loading\n  spin: 'animate-spin',\n  \n  // Ping for notifications\n  ping: 'animate-ping',\n  \n  // Custom micro-interactions (defined in CSS)\n  wiggle: 'animate-wiggle',\n  shake: 'animate-shake',\n  pop: 'animate-pop',\n  slideUp: 'animate-slide-up',\n  slideDown: 'animate-slide-down',\n  fadeIn: 'animate-fade-in',\n  fadeOut: 'animate-fade-out',\n  scaleIn: 'animate-scale-in',\n  scaleOut: 'animate-scale-out',\n} as const;\n\n// ============================================================================\n// Ripple Effect Utility\n// ============================================================================\n\n/**\n * Creates a ripple effect on click\n * @param event - Mouse event from click\n * @param element - Target element for ripple\n */\nexport function createRipple(event: React.MouseEvent<HTMLElement>, element: HTMLElement): void {\n  const rect = element.getBoundingClientRect();\n  const ripple = document.createElement('span');\n  const size = Math.max(rect.width, rect.height);\n  const x = event.clientX - rect.left - size / 2;\n  const y = event.clientY - rect.top - size / 2;\n  \n  ripple.style.cssText = `\n    position: absolute;\n    width: ${size}px;\n    height: ${size}px;\n    left: ${x}px;\n    top: ${y}px;\n    background: rgba(255, 255, 255, 0.3);\n    border-radius: 50%;\n    transform: scale(0);\n    animation: ripple 0.6s ease-out;\n    pointer-events: none;\n  `;\n  \n  element.style.position = 'relative';\n  element.style.overflow = 'hidden';\n  element.appendChild(ripple);\n  \n  setTimeout(() => ripple.remove(), 600);\n}\n\n// ============================================================================\n// Focus Management Utilities\n// ============================================================================\n\n/**\n * Manages focus states for keyboard navigation\n */\nexport const focusManagement = {\n  /**\n   * Trap focus within an element (for modals, dialogs)\n   */\n  trapFocus: (container: HTMLElement): (() => void) => {\n    const focusableElements = container.querySelectorAll<HTMLElement>(\n      'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n    );\n    const firstElement = focusableElements[0];\n    const lastElement = focusableElements[focusableElements.length - 1];\n    \n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key !== 'Tab') return;\n      \n      if (e.shiftKey && document.activeElement === firstElement) {\n        e.preventDefault();\n        lastElement?.focus();\n      } else if (!e.shiftKey && document.activeElement === lastElement) {\n        e.preventDefault();\n        firstElement?.focus();\n      }\n    };\n    \n    container.addEventListener('keydown', handleKeyDown);\n    firstElement?.focus();\n    \n    return () => container.removeEventListener('keydown', handleKeyDown);\n  },\n  \n  /**\n   * Restore focus to previous element\n   */\n  restoreFocus: (previousElement: HTMLElement | null): void => {\n    previousElement?.focus();\n  },\n};\n\n// ============================================================================\n// Utility Functions\n// ============================================================================\n\n/**\n * Combines multiple feedback classes\n */\nexport function combineFeedback(...classes: (string | undefined | null | false)[]): string {\n  return classes.filter(Boolean).join(' ').replace(/\\s+/g, ' ').trim();\n}\n\n/**\n * Gets feedback classes for a component type\n */\nexport function getFeedbackClasses(\n  component: keyof typeof componentFeedback,\n  variant: string = 'default'\n): string {\n  const componentStyles = componentFeedback[component] as Record<string, string>;\n  return componentStyles[variant] || componentStyles['default'] || '';\n}\n\n/**\n * Creates a hover effect configuration\n */\nexport function createHoverEffect(options: {\n  scale?: number;\n  brightness?: number;\n  shadow?: boolean;\n  glow?: boolean;\n}): string {\n  const classes: string[] = [transitionClasses.interactive];\n  \n  if (options.scale) {\n    classes.push(`hover:scale-[${options.scale}]`);\n  }\n  if (options.brightness) {\n    classes.push(`hover:brightness-[${options.brightness}]`);\n  }\n  if (options.shadow) {\n    classes.push('hover:shadow-lg');\n  }\n  if (options.glow) {\n    classes.push(interactiveStates.hover.glow);\n  }\n  \n  return classes.join(' ');\n}\n\n// ============================================================================\n// CSS Custom Properties for Animations\n// ============================================================================\n\n/**\n * CSS to be injected for custom animations\n */\nexport const customAnimationCSS = `\n  @keyframes ripple {\n    to {\n      transform: scale(4);\n      opacity: 0;\n    }\n  }\n  \n  @keyframes wiggle {\n    0%, 100% { transform: rotate(-3deg); }\n    50% { transform: rotate(3deg); }\n  }\n  \n  @keyframes shake {\n    0%, 100% { transform: translateX(0); }\n    10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); }\n    20%, 40%, 60%, 80% { transform: translateX(2px); }\n  }\n  \n  @keyframes pop {\n    0% { transform: scale(1); }\n    50% { transform: scale(1.1); }\n    100% { transform: scale(1); }\n  }\n  \n  @keyframes slide-up {\n    from { transform: translateY(10px); opacity: 0; }\n    to { transform: translateY(0); opacity: 1; }\n  }\n  \n  @keyframes slide-down {\n    from { transform: translateY(-10px); opacity: 0; }\n    to { transform: translateY(0); opacity: 1; }\n  }\n  \n  @keyframes fade-in {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n  \n  @keyframes fade-out {\n    from { opacity: 1; }\n    to { opacity: 0; }\n  }\n  \n  @keyframes scale-in {\n    from { transform: scale(0.95); opacity: 0; }\n    to { transform: scale(1); opacity: 1; }\n  }\n  \n  @keyframes scale-out {\n    from { transform: scale(1); opacity: 1; }\n    to { transform: scale(0.95); opacity: 0; }\n  }\n  \n  @keyframes shimmer {\n    0% { transform: translateX(-100%); }\n    100% { transform: translateX(100%); }\n  }\n  \n  .animate-wiggle { animation: wiggle 0.3s ease-in-out; }\n  .animate-shake { animation: shake 0.5s ease-in-out; }\n  .animate-pop { animation: pop 0.3s ease-out; }\n  .animate-slide-up { animation: slide-up 0.3s ease-out; }\n  .animate-slide-down { animation: slide-down 0.3s ease-out; }\n  .animate-fade-in { animation: fade-in 0.2s ease-out; }\n  .animate-fade-out { animation: fade-out 0.2s ease-in; }\n  .animate-scale-in { animation: scale-in 0.2s ease-out; }\n  .animate-scale-out { animation: scale-out 0.2s ease-in; }\n  .animate-shimmer { animation: shimmer 2s infinite; }\n`;\n\n// ============================================================================\n// Type Exports\n// ============================================================================\n\nexport type InteractiveStates = typeof interactiveStates;\nexport type TransitionClasses = typeof transitionClasses;\nexport type ComponentFeedback = typeof componentFeedback;\nexport type MicroInteractions = typeof microInteractions;\n\nexport default {\n  interactiveStates,\n  transitionClasses,\n  componentFeedback,\n  microInteractions,\n  createRipple,\n  focusManagement,\n  combineFeedback,\n  getFeedbackClasses,\n  createHoverEffect,\n  customAnimationCSS,\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/loading-states.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/mockData.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[203,206],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[203,206],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * MetaExtract Frontend Data\n * \n * Pricing tiers based on forensic value proposition.\n */\n\n// Generate extended fields for demo\nconst generateExtendedFields = () => {\n  const fields: Record<string, any> = {};\n  \n  // Canon MakerNote simulation\n  for (let i = 1; i <= 2500; i++) {\n    const hex = i.toString(16).padStart(4, '0').toUpperCase();\n    fields[`Canon MakerNote 0x${hex}`] = `0x${Math.floor(Math.random() * 65536).toString(16).toUpperCase()}`;\n  }\n  \n  // IPTC Extension simulation\n  for (let i = 1; i <= 1500; i++) {\n    fields[`IPTC Extension Field ${i}`] = `Data Segment ${Math.random().toString(36).substring(7)}`;\n  }\n  \n  // XMP Raw simulation\n  for (let i = 1; i <= 3000; i++) {\n    fields[`XMP-crs:RawData-${i}`] = Math.random() > 0.5 ? \"True\" : \"False\";\n  }\n\n  return fields;\n};\n\nexport const MOCK_METADATA = {\n  filename: \"EVIDENCE_IMG_20240515_A74.RAW\",\n  filesize: \"84.2 MB\",\n  filetype: \"Sony ARW (RAW)\",\n  created: \"2024-05-15T14:23:01.452Z\",\n  modified: \"2024-05-15T14:23:01.452Z\",\n  hash: \"a1b2c3d4e5f67890abcdef1234567890\",\n  \n  file_integrity: {\n    md5: \"a1b2c3d4e5f67890abcdef1234567890\",\n    sha256: \"a1b2c3d4e5f67890abcdef1234567890a1b2c3d4e5f67890abcdef1234567890\"\n  },\n  \n  summary: {\n    make: \"Sony\",\n    model: \"Alpha 7 IV\",\n    serial: \"384729104\",\n    lens: \"FE 24-70mm F2.8 GM II\",\n    firmware: \"v2.01\",\n    shutter_count: \"14,203\",\n    capture_time: \"2024-05-15 14:23:01.452\",\n    location: \"37.7749 N, 122.4194 W\"\n  },\n  \n  gps: {\n    latitude_decimal: 37.7749,\n    longitude_decimal: -122.4194,\n    latitude_dms: \"37 46' 29.64\\\" N\",\n    longitude_dms: \"122 25' 9.84\\\" W\",\n    altitude_meters: 52.3,\n    coordinates_formatted: \"37.774900, -122.419400\",\n    google_maps_url: \"https://www.google.com/maps?q=37.7749,-122.4194\"\n  },\n  \n  filesystem: {\n    size_bytes: 88320000,\n    size_human: \"84.2 MB\",\n    created: \"2024-05-15T14:23:01.452Z\",\n    modified: \"2024-05-15T14:23:01.452Z\",\n    accessed: \"2024-12-29T10:00:00.000Z\",\n    permissions_octal: \"0644\",\n    permissions_human: \"-rw-r--r--\",\n    owner: \"user\",\n    owner_uid: 501,\n    group: \"staff\",\n    group_gid: 20,\n    inode: 12345678,\n    hard_links: 1\n  },\n  \n  calculated: {\n    aspect_ratio: \"3:2\",\n    aspect_ratio_decimal: 1.5,\n    megapixels: 33.0,\n    orientation: \"landscape\",\n    file_age_days: 228,\n    file_age_human: \"7 months ago\",\n    is_modified: false,\n    time_between_creation_modification: \"0 seconds\"\n  },\n  \n  forensic: {\n    \"Device_Manufacturer\": \"Sony\",\n    \"Device_Model\": \"ILCE-7M4\",\n    \"Creation_Timestamp\": \"2024-05-15T14:23:01.452Z\",\n    \"Last_Modified\": \"2024-05-15T14:23:01.452Z\",\n    \"Original_DateTime\": \"2024:05:15 14:23:01\",\n    \"Creation_Software\": \"ILCE-7M4 v2.01\",\n    \"Device_Serial\": \"384729104\",\n    \"Lens_Serial\": \"99283711\",\n    \"Internal_Serial\": \"SN001234567890\",\n    \"Firmware\": \"v2.01\",\n    \"Owner_Name\": \"John Doe\",\n    \"Artist\": \"John Doe Photography\",\n    \"Copyright\": \" 2024 John Doe\",\n    \"Image_Unique_ID\": \"a1b2c3d4e5f67890\"\n  },\n  \n  exif: {\n    \"Camera_Make\": \"Sony\",\n    \"Camera_Model\": \"ILCE-7M4\",\n    \"Lens_Model\": \"FE 24-70mm F2.8 GM II\",\n    \"Lens_Make\": \"Sony\",\n    \"Focal_Length\": \"35mm\",\n    \"Focal_Length_35mm\": \"35mm\",\n    \"F_Number\": \"f/2.8\",\n    \"Exposure_Time\": \"1/250s\",\n    \"ISO\": \"100\",\n    \"White_Balance\": \"Auto\",\n    \"Flash\": \"Did not fire\",\n    \"Metering_Mode\": \"Pattern\",\n    \"Exposure_Mode\": \"Manual\",\n    \"Exposure_Program\": \"Manual\",\n    \"Exposure_Compensation\": \"0 EV\",\n    \"Scene_Type\": \"Standard\",\n    \"Contrast\": \"Normal\",\n    \"Saturation\": \"Normal\",\n    \"Sharpness\": \"Normal\",\n    \"Digital_Zoom\": \"1.0\",\n    \"Focus_Mode\": \"AF-C\",\n    \"Image_Stabilization\": \"On\"\n  },\n  \n  makernote: {\n    _locked: false,\n    \"Sony_ImageWidth\": \"7008\",\n    \"Sony_ImageHeight\": \"4672\",\n    \"Sony_FocusMode\": \"AF-C\",\n    \"Sony_AFPointSelected\": \"Wide\",\n    \"Sony_AFPointsUsed\": \"128\",\n    \"Sony_InternalSerialNumber\": \"SN001234567890\",\n    \"Sony_ShutterCount\": \"14203\",\n    \"Sony_LensType\": \"FE 24-70mm F2.8 GM II\",\n    \"Sony_DynamicRangeOptimizer\": \"Auto\",\n    \"Sony_Quality\": \"RAW\",\n    \"Sony_ColorTemperature\": \"5500\",\n    \"Sony_Brightness\": \"128\",\n    \"Sony_Contrast\": \"Normal\",\n    \"Sony_Saturation\": \"Normal\",\n  },\n  \n  iptc: {\n    _locked: false,\n    \"IPTC_Keywords\": \"landscape, california, sunset\",\n    \"IPTC_Caption\": \"Sunset over San Francisco Bay\",\n    \"IPTC_Credit\": \"John Doe Photography\",\n    \"IPTC_Source\": \"Original\",\n    \"IPTC_Copyright\": \" 2024 John Doe\",\n    \"IPTC_City\": \"San Francisco\",\n    \"IPTC_Province\": \"California\",\n    \"IPTC_Country\": \"United States\"\n  },\n  \n  xmp: {\n    _locked: false,\n    \"XMP_Creator\": \"John Doe\",\n    \"XMP_CreateDate\": \"2024-05-15T14:23:01\",\n    \"XMP_ModifyDate\": \"2024-05-15T14:23:01\",\n    \"XMP_Rating\": \"5\",\n    \"XMP_Label\": \"Blue\"\n  },\n  \n  extended: generateExtendedFields(),\n  \n  locked_fields: []\n};\n\n// ============================================================================\n// REVISED PRICING - Based on forensic value proposition\n// ============================================================================\n\nexport const PRICING_TIERS = [\n  {\n    tier: \"enterprise\",\n    name: \"Free\",\n    price: \"FREE\",\n    period: \"\",\n    tagline: \"Evaluate our extraction quality\",\n    description: \"3 files/day, basic web formats only\",\n    features: [\n      \"Standard images (JPEG, PNG, GIF, WebP)\", \n      \"10MB file limit\", \n      \"Basic EXIF + GPS + Hashes\",\n      \"200-300 fields\",\n      \"3 extractions per day\",\n      \"JSON export\"\n    ],\n    cta: \"Start Free\",\n    recommended: false,\n    isPaid: false,\n    fieldCount: \"200-300\"\n  },\n  {\n    tier: \"professional\",\n    name: \"Professional\",\n    price: \"$19\",\n    period: \"/mo\",\n    tagline: \"For investigators & photographers\",\n    description: \"All image formats including RAW\",\n    features: [\n      \"All image formats + RAW\", \n      \"100MB file limit\",\n      \"Full EXIF + MakerNotes\",\n      \"IPTC + XMP metadata\",\n      \"2,000+ fields extracted\",\n      \"500 files/month\",\n      \"Forensic analysis\",\n      \"JSON + CSV export\",\n      \"Email support\"\n    ],\n    cta: \"Get Professional\",\n    recommended: false,\n    isPaid: true,\n    fieldCount: \"2,000+\"\n  },\n  {\n    tier: \"forensic\",\n    name: \"Forensic\",\n    price: \"$49\",\n    period: \"/mo\",\n    tagline: \"Complete forensic toolkit\",\n    description: \"All file types, advanced analysis\",\n    features: [\n      \"All file types (Video, Audio, PDF)\",\n      \"500MB file limit\",\n      \"7,000+ fields extracted\",\n      \"Manipulation detection\",\n      \"Timeline reconstruction\",\n      \"Batch processing\",\n      \"API access (5,000 calls/mo)\",\n      \"Priority processing\",\n      \"PDF reports\",\n      \"Priority support\"\n    ],\n    cta: \"Go Forensic\",\n    recommended: true,\n    isPaid: true,\n    fieldCount: \"7,000+\"\n  },\n  {\n    tier: \"enterprise\",\n    name: \"Enterprise\",\n    price: \"$149\",\n    period: \"/mo\",\n    tagline: \"For agencies & legal teams\",\n    description: \"Unlimited everything + dedicated support\",\n    features: [\n      \"Everything in Forensic\",\n      \"2GB file limit\",\n      \"Unlimited API calls\",\n      \"Unlimited files\",\n      \"Custom integrations\",\n      \"Compliance reporting\",\n      \"Dedicated support\",\n      \"SLA guarantee\"\n    ],\n    cta: \"Contact Sales\",\n    recommended: false,\n    isPaid: true,\n    fieldCount: \"7,000+\",\n    isEnterprise: true\n  }\n];\n\n// ============================================================================\n// CREDIT PACKS - Pay-per-use option\n// ============================================================================\n\nexport const CREDIT_PACKS = [\n  {\n    id: \"single\",\n    name: \"Single\",\n    credits: 1,\n    price: \"$2\",\n    per_credit: \"$2.00 per file\",\n    description: \"1 full forensic analysis\"\n  },\n  {\n    id: \"investigation\",\n    name: \"Investigation\",\n    credits: 10,\n    price: \"$15\",\n    per_credit: \"$1.50 per file\",\n    description: \"Perfect for small cases\",\n    popular: true\n  },\n  {\n    id: \"case\",\n    name: \"Case Pack\",\n    credits: 50,\n    price: \"$50\",\n    per_credit: \"$1.00 per file\",\n    description: \"Best value for cases\"\n  },\n  {\n    id: \"agency\",\n    name: \"Agency\",\n    credits: 200,\n    price: \"$150\",\n    per_credit: \"$0.75 per file\",\n    description: \"Bulk discount\"\n  }\n];\n\n// ============================================================================\n// CREDIT COST EXPLANATION\n// ============================================================================\n\nexport const CREDIT_EXPLANATION = [\n  { action: \"Standard Image (JPG/PNG/GIF/WebP)\", cost: \"1 Credit\" },\n  { action: \"RAW Image (CR2/NEF/ARW/DNG/HEIC)\", cost: \"2 Credits\" },\n  { action: \"Video File (MP4/MOV/AVI/MKV)\", cost: \"5 Credits\" },\n  { action: \"Audio File (MP3/FLAC/WAV/OGG)\", cost: \"2 Credits\" },\n  { action: \"PDF Document\", cost: \"2 Credits\" },\n  { action: \"SVG File\", cost: \"1 Credit\" }\n];\n\n// ============================================================================\n// FEATURE COMPARISON TABLE DATA\n// ============================================================================\n\nexport const FEATURE_COMPARISON = {\n  categories: [\n    {\n      name: \"File Support\",\n      features: [\n        { name: \"Standard Images (JPEG, PNG, GIF, WebP)\", free: true, professional: true, forensic: true, enterprise: true },\n        { name: \"RAW Formats (CR2, NEF, ARW, DNG)\", free: false, professional: true, forensic: true, enterprise: true },\n        { name: \"HEIC/HEIF\", free: false, professional: true, forensic: true, enterprise: true },\n        { name: \"Video (MP4, MOV, AVI, MKV)\", free: false, professional: false, forensic: true, enterprise: true },\n        { name: \"Audio (MP3, FLAC, WAV)\", free: false, professional: false, forensic: true, enterprise: true },\n        { name: \"PDF Documents\", free: false, professional: false, forensic: true, enterprise: true },\n        { name: \"SVG Files\", free: false, professional: false, forensic: true, enterprise: true },\n      ]\n    },\n    {\n      name: \"Metadata Extraction\",\n      features: [\n        { name: \"Basic EXIF\", free: true, professional: true, forensic: true, enterprise: true },\n        { name: \"GPS/Location Data\", free: true, professional: true, forensic: true, enterprise: true },\n        { name: \"File Integrity Hashes\", free: true, professional: true, forensic: true, enterprise: true },\n        { name: \"Full EXIF (all tags)\", free: false, professional: true, forensic: true, enterprise: true },\n        { name: \"Camera MakerNotes\", free: false, professional: true, forensic: true, enterprise: true },\n        { name: \"IPTC Metadata\", free: false, professional: true, forensic: true, enterprise: true },\n        { name: \"XMP Metadata\", free: false, professional: true, forensic: true, enterprise: true },\n        { name: \"Extended Attributes\", free: false, professional: true, forensic: true, enterprise: true },\n        { name: \"Serial Numbers\", free: false, professional: true, forensic: true, enterprise: true },\n      ]\n    },\n    {\n      name: \"Forensic Analysis\",\n      features: [\n        { name: \"Basic Forensics\", free: false, professional: true, forensic: true, enterprise: true },\n        { name: \"Manipulation Detection\", free: false, professional: false, forensic: true, enterprise: true },\n        { name: \"Timeline Reconstruction\", free: false, professional: false, forensic: true, enterprise: true },\n        { name: \"Steganography Detection\", free: false, professional: false, forensic: true, enterprise: true },\n      ]\n    },\n    {\n      name: \"Processing\",\n      features: [\n        { name: \"Single File Upload\", free: true, professional: true, forensic: true, enterprise: true },\n        { name: \"Batch Upload\", free: false, professional: false, forensic: true, enterprise: true },\n        { name: \"API Access\", free: false, professional: false, forensic: \"5K/mo\", enterprise: \"Unlimited\" },\n        { name: \"Priority Processing\", free: false, professional: false, forensic: true, enterprise: true },\n      ]\n    },\n    {\n      name: \"Export & Support\",\n      features: [\n        { name: \"JSON Export\", free: true, professional: true, forensic: true, enterprise: true },\n        { name: \"CSV Export\", free: false, professional: true, forensic: true, enterprise: true },\n        { name: \"PDF Reports\", free: false, professional: false, forensic: true, enterprise: true },\n        { name: \"Email Support\", free: false, professional: true, forensic: true, enterprise: true },\n        { name: \"Priority Support\", free: false, professional: false, forensic: true, enterprise: true },\n        { name: \"Dedicated Support\", free: false, professional: false, forensic: false, enterprise: true },\n      ]\n    },\n  ]\n};\n\n// ============================================================================\n// VALUE PROPOSITIONS\n// ============================================================================\n\nexport const VALUE_PROPS = [\n  {\n    icon: \"Database\",\n    title: \"7,000+ Fields\",\n    description: \"Extract more metadata than any competitor. We parse proprietary MakerNotes, IPTC, XMP, and codec-specific data.\"\n  },\n  {\n    icon: \"Shield\",\n    title: \"Court-Ready\",\n    description: \"File integrity hashes, chain of custody timestamps, and forensic analysis suitable for legal proceedings.\"\n  },\n  {\n    icon: \"Zap\",\n    title: \"Fast Processing\",\n    description: \"Sub-second extraction for most files. Batch process hundreds of files with our enterprise-grade infrastructure.\"\n  },\n  {\n    icon: \"Lock\",\n    title: \"Privacy-First\",\n    description: \"Files processed in memory, deleted immediately after analysis. No data retention, no third-party sharing.\"\n  }\n];\n\n// ============================================================================\n// FAQ DATA\n// ============================================================================\n\nexport const FAQ_ITEMS = [\n  {\n    question: \"How is this different from other EXIF viewers?\",\n    answer: \"Most EXIF viewers extract 50-200 fields. MetaExtract extracts 7,000+ fields including parsed camera MakerNotes (Canon, Sony, Nikon proprietary data), full IPTC/XMP metadata, video codec parameters, and forensic indicators. We're built for investigators, not casual users.\"\n  },\n  {\n    question: \"Is my data safe?\",\n    answer: \"Yes. Files are processed in temporary memory and permanently deleted immediately after extraction. We never store your files, and our servers are SOC 2 compliant. For enterprise customers, we offer on-premise deployment.\"\n  },\n  {\n    question: \"What's the difference between subscriptions and credits?\",\n    answer: \"Subscriptions are monthly plans for regular users. Credits are pay-per-use for occasional needs. Credits never expire and include full forensic analysis on any file type. Both options give you access to our complete 7,000+ field extraction.\"\n  },\n  {\n    question: \"Can I use this for legal/forensic investigations?\",\n    answer: \"Yes. Our Forensic and Enterprise tiers include features specifically designed for investigations: file integrity hashes (MD5, SHA256), manipulation detection, timeline reconstruction, and detailed chain-of-custody metadata. Many law enforcement agencies and legal teams use MetaExtract.\"\n  },\n  {\n    question: \"Do you offer API access?\",\n    answer: \"Yes. The Forensic tier includes 5,000 API calls per month. Enterprise tier includes unlimited API access. Our REST API supports all extraction features and returns structured JSON.\"\n  },\n  {\n    question: \"What file types do you support?\",\n    answer: \"Free tier supports standard web images. Professional tier adds RAW formats from all major camera manufacturers. Forensic and Enterprise tiers support everything: video (MP4, MOV, AVI, MKV), audio (MP3, FLAC, WAV), PDF, SVG, and more.\"\n  }\n];\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/navigation-config.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'BarChart3' is defined but never used.","line":12,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Navigation Configuration\n * \n * Centralized navigation configuration for consistent navigation across all pages.\n * Defines nav items, routes, and navigation behavior.\n * \n * @module navigation-config\n * @validates Requirements 1.6 - Navigation consistency\n */\n\nimport { \n  BarChart3, \n  Upload, \n  FileText, \n  TrendingUp, \n  Activity, \n  Shield, \n  Settings,\n  Home,\n  HelpCircle,\n  CreditCard,\n  User,\n  Cpu,\n  type LucideIcon\n} from 'lucide-react';\n\n// ============================================================================\n// Navigation Item Types\n// ============================================================================\n\nexport interface NavItem {\n  /** Unique identifier */\n  id: string;\n  /** Display name */\n  name: string;\n  /** Route path */\n  href: string;\n  /** Lucide icon component */\n  icon: LucideIcon;\n  /** Whether this item requires authentication */\n  requiresAuth?: boolean;\n  /** Whether this item is only for public (non-authenticated) users */\n  publicOnly?: boolean;\n  /** Badge content (e.g., notification count) */\n  badge?: string | number;\n  /** Whether this is an external link */\n  external?: boolean;\n  /** Description for tooltips/accessibility */\n  description?: string;\n  /** Keyboard shortcut */\n  shortcut?: string;\n}\n\nexport interface NavSection {\n  /** Section identifier */\n  id: string;\n  /** Section title (optional, for grouped navigation) */\n  title?: string;\n  /** Navigation items in this section */\n  items: NavItem[];\n}\n\n// ============================================================================\n// Public Navigation (Landing, Marketing Pages)\n// ============================================================================\n\nexport const publicNavItems: NavItem[] = [\n  {\n    id: 'features',\n    name: 'Features',\n    href: '/home#features',\n    icon: Cpu,\n    description: 'Explore our metadata extraction capabilities',\n  },\n  {\n    id: 'pricing',\n    name: 'Pricing',\n    href: '/home#pricing',\n    icon: CreditCard,\n    description: 'View pricing plans and features',\n  },\n  {\n    id: 'docs',\n    name: 'Docs',\n    href: '/docs',\n    icon: FileText,\n    description: 'Read the documentation',\n  },\n];\n\n// ============================================================================\n// Dashboard Navigation (Authenticated Users)\n// ============================================================================\n\nexport const dashboardNavSections: NavSection[] = [\n  {\n    id: 'main',\n    items: [\n      {\n        id: 'extract',\n        name: 'Extract',\n        href: '/images_mvp',\n        icon: Upload,\n        description: 'Upload and extract metadata',\n        shortcut: 'g e',\n      },\n      {\n        id: 'credits',\n        name: 'Credits',\n        href: '/credits',\n        icon: CreditCard,\n        requiresAuth: true,\n        description: 'Balances and recent transactions',\n      },\n      {\n        id: 'results',\n        name: 'Results',\n        href: '/images_mvp/results',\n        icon: FileText,\n        requiresAuth: true,\n        description: 'View extraction results',\n        shortcut: 'g r',\n      },\n      {\n        id: 'analytics',\n        name: 'Analytics',\n        href: '/images_mvp/analytics',\n        icon: TrendingUp,\n        requiresAuth: true,\n        description: 'Usage analytics and insights',\n      },\n      {\n        id: 'settings',\n        name: 'Settings',\n        href: '/settings',\n        icon: Settings,\n        requiresAuth: true,\n        description: 'Account, plan, and preferences',\n        shortcut: 'g s',\n      },\n    ],\n  },\n];\n\n/** Flat list of all dashboard nav items */\nexport const dashboardNavItems: NavItem[] = dashboardNavSections.flatMap(\n  section => section.items\n);\n\n// ============================================================================\n// User Menu Items\n// ============================================================================\n\nexport const userMenuItems: NavItem[] = [\n  {\n    id: 'profile',\n    name: 'Profile',\n    href: '/profile',\n    icon: User,\n    requiresAuth: true,\n    description: 'View and edit your profile',\n  },\n  {\n    id: 'user-settings',\n    name: 'Settings',\n    href: '/settings',\n    icon: Settings,\n    requiresAuth: true,\n    description: 'Account settings',\n  },\n  {\n    id: 'help',\n    name: 'Help',\n    href: '/help',\n    icon: HelpCircle,\n    description: 'Get help and support',\n  },\n];\n\n// ============================================================================\n// Footer Navigation\n// ============================================================================\n\nexport const footerNavSections: NavSection[] = [\n  {\n    id: 'product',\n    title: 'Product',\n    items: [\n      { id: 'footer-features', name: 'Features', href: '/home#features', icon: Cpu },\n      { id: 'footer-pricing', name: 'Pricing', href: '/home#pricing', icon: CreditCard },\n      { id: 'footer-docs', name: 'Documentation', href: '/docs', icon: FileText },\n      { id: 'footer-api', name: 'API', href: '/api', icon: Activity },\n    ],\n  },\n  {\n    id: 'company',\n    title: 'Company',\n    items: [\n      { id: 'footer-about', name: 'About', href: '/about', icon: Home },\n      { id: 'footer-blog', name: 'Blog', href: '/blog', icon: FileText },\n      { id: 'footer-contact', name: 'Contact', href: '/contact', icon: HelpCircle },\n    ],\n  },\n  {\n    id: 'legal',\n    title: 'Legal',\n    items: [\n      { id: 'footer-privacy', name: 'Privacy Policy', href: '/privacy', icon: Shield },\n      { id: 'footer-terms', name: 'Terms of Service', href: '/terms', icon: FileText },\n      { id: 'footer-security', name: 'Security', href: '/security', icon: Shield },\n    ],\n  },\n];\n\n// ============================================================================\n// Navigation Utilities\n// ============================================================================\n\n/**\n * Check if a path matches the current location\n */\nexport function isActivePath(currentPath: string, itemPath: string): boolean {\n  // Exact match\n  if (currentPath === itemPath) return true;\n  \n  // Handle hash links\n  if (itemPath.includes('#')) {\n    const [basePath] = itemPath.split('#');\n    return currentPath === basePath || currentPath === '/';\n  }\n  \n  // Handle nested routes (e.g., /settings/profile matches /settings)\n  if (itemPath !== '/' && currentPath.startsWith(itemPath)) {\n    return true;\n  }\n  \n  return false;\n}\n\n/**\n * Get nav item by ID\n */\nexport function getNavItemById(id: string): NavItem | undefined {\n  return [...publicNavItems, ...dashboardNavItems, ...userMenuItems].find(\n    item => item.id === id\n  );\n}\n\n/**\n * Get nav items filtered by authentication state\n */\nexport function getFilteredNavItems(\n  items: NavItem[],\n  isAuthenticated: boolean\n): NavItem[] {\n  return items.filter(item => {\n    if (item.requiresAuth && !isAuthenticated) return false;\n    if (item.publicOnly && isAuthenticated) return false;\n    return true;\n  });\n}\n\n/**\n * Brand configuration\n */\nexport const brandConfig = {\n  name: 'MetaExtract',\n  shortName: 'M',\n  tagline: 'The world\\'s most comprehensive metadata extraction system.',\n  logo: {\n    icon: Cpu,\n    bgColor: 'bg-primary',\n    textColor: 'text-black',\n  },\n} as const;\n\n// ============================================================================\n// Navigation Styles (Dark Forensic Theme)\n// ============================================================================\n\nexport const navStyles = {\n  // Sidebar styles\n  sidebar: {\n    bg: 'bg-[#0a0a0f]',\n    border: 'border-white/5',\n    width: 'w-64',\n  },\n  \n  // Header styles\n  header: {\n    bg: 'bg-[#0B0C10]/80',\n    bgSolid: 'bg-[#0B0C10]',\n    border: 'border-white/5',\n    height: 'h-16',\n    heightMobile: 'h-14',\n  },\n  \n  // Nav item styles\n  item: {\n    base: 'flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-all duration-200',\n    active: 'bg-primary/10 text-primary border border-primary/20',\n    inactive: 'text-slate-400 hover:text-white hover:bg-white/5',\n    icon: 'w-4 h-4',\n    iconActive: 'text-primary',\n  },\n  \n  // Link styles\n  link: {\n    base: 'text-sm text-slate-300 hover:text-white transition-colors',\n    footer: 'text-sm text-slate-400 hover:text-white transition-colors',\n  },\n  \n  // Button styles\n  button: {\n    primary: 'bg-primary hover:bg-primary/90 text-black font-medium',\n    ghost: 'text-slate-300 hover:text-white hover:bg-white/10',\n  },\n} as const;\n\n// ============================================================================\n// Export All\n// ============================================================================\n\nexport const navigationConfig = {\n  publicNavItems,\n  dashboardNavSections,\n  dashboardNavItems,\n  userMenuItems,\n  footerNavSections,\n  brandConfig,\n  navStyles,\n  isActivePath,\n  getNavItemById,\n  getFilteredNavItems,\n} as const;\n\nexport default navigationConfig;\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/notifications/notification-system.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[445,448],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[445,448],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1664,1667],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1664,1667],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'updatedCount' is assigned a value but never used.","line":185,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":185,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":334,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":334,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8671,8674],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8671,8674],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":354,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":354,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9291,9294],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9291,9294],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":370,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":370,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9618,9621],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9618,9621],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userId' is defined but never used. Allowed unused args must match /^_/u.","line":447,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":447,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'callback' is defined but never used. Allowed unused args must match /^_/u.","line":448,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":448,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Notification System - In-app and push notifications\n */\n\nimport { v4 as uuidv4 } from 'uuid';\n\nexport interface Notification {\n  id: string;\n  userId: string;\n  type: 'info' | 'success' | 'warning' | 'error' | 'system';\n  title: string;\n  message: string;\n  priority: 'low' | 'medium' | 'high' | 'critical';\n  read: boolean;\n  createdAt: Date;\n  expiresAt?: Date;\n  actionUrl?: string;\n  actionLabel?: string;\n  metadata?: Record<string, any>;\n}\n\nexport interface NotificationPreferences {\n  userId: string;\n  emailNotifications: boolean;\n  inAppNotifications: boolean;\n  pushNotifications: boolean;\n  notificationChannels: {\n    extractionCompleted: boolean;\n    systemUpdates: boolean;\n    securityAlerts: boolean;\n    billing: boolean;\n    featureUpdates: boolean;\n  };\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nexport interface NotificationChannel {\n  id: string;\n  name: string;\n  description: string;\n  enabled: boolean;\n  userId?: string; // If null/undefined, applies globally\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nexport class NotificationSystem {\n  private notifications: Map<string, Notification[]> = new Map();\n  private preferences: Map<string, NotificationPreferences> = new Map();\n  private channels: Map<string, NotificationChannel[]> = new Map();\n  private unreadCounts: Map<string, number> = new Map();\n\n  /**\n   * Send a notification to a user\n   */\n  async sendNotification(\n    userId: string,\n    type: Notification['type'],\n    title: string,\n    message: string,\n    options: {\n      priority?: Notification['priority'];\n      actionUrl?: string;\n      actionLabel?: string;\n      expiresAt?: Date;\n      metadata?: Record<string, any>;\n    } = {}\n  ): Promise<string> {\n    const notificationId = uuidv4();\n    \n    const notification: Notification = {\n      id: notificationId,\n      userId,\n      type,\n      title,\n      message,\n      priority: options.priority || 'medium',\n      read: false,\n      createdAt: new Date(),\n      expiresAt: options.expiresAt,\n      actionUrl: options.actionUrl,\n      actionLabel: options.actionLabel,\n      metadata: options.metadata\n    };\n\n    if (!this.notifications.has(userId)) {\n      this.notifications.set(userId, []);\n    }\n\n    const userNotifications = this.notifications.get(userId)!;\n    userNotifications.unshift(notification);\n\n    // Update unread count\n    const currentUnread = this.unreadCounts.get(userId) || 0;\n    this.unreadCounts.set(userId, currentUnread + 1);\n\n    return notificationId;\n  }\n\n  /**\n   * Get notifications for a user\n   */\n  async getUserNotifications(\n    userId: string,\n    options: {\n      limit?: number;\n      offset?: number;\n      type?: Notification['type'];\n      priority?: Notification['priority'];\n      read?: boolean;\n      includeExpired?: boolean;\n    } = {}\n  ): Promise<Notification[]> {\n    const allNotifications = this.notifications.get(userId) || [];\n    \n    let filtered = allNotifications.filter(notif => {\n      // Filter by type\n      if (options.type && notif.type !== options.type) {\n        return false;\n      }\n      \n      // Filter by priority\n      if (options.priority && notif.priority !== options.priority) {\n        return false;\n      }\n      \n      // Filter by read status\n      if (options.read !== undefined && notif.read !== options.read) {\n        return false;\n      }\n      \n      // Filter by expiration\n      if (!options.includeExpired && notif.expiresAt && notif.expiresAt < new Date()) {\n        return false;\n      }\n      \n      return true;\n    });\n\n    // Apply pagination\n    if (options.offset) {\n      filtered = filtered.slice(options.offset);\n    }\n    \n    if (options.limit) {\n      filtered = filtered.slice(0, options.limit);\n    }\n\n    return filtered;\n  }\n\n  /**\n   * Mark a notification as read\n   */\n  async markAsRead(userId: string, notificationId: string): Promise<boolean> {\n    const notifications = this.notifications.get(userId) || [];\n    const notification = notifications.find(n => n.id === notificationId && n.userId === userId);\n    \n    if (!notification) {\n      return false;\n    }\n\n    notification.read = true;\n    \n    // Update unread count\n    const currentUnread = this.unreadCounts.get(userId) || 0;\n    if (!notification.read) { // If it was previously unread\n      this.unreadCounts.set(userId, Math.max(0, currentUnread - 1));\n    }\n\n    return true;\n  }\n\n  /**\n   * Mark all notifications as read for a user\n   */\n  async markAllAsRead(userId: string): Promise<boolean> {\n    const notifications = this.notifications.get(userId) || [];\n    let updatedCount = 0;\n\n    for (const notification of notifications) {\n      if (!notification.read) {\n        notification.read = true;\n        updatedCount++;\n      }\n    }\n\n    this.unreadCounts.set(userId, 0);\n    return true;\n  }\n\n  /**\n   * Delete a notification\n   */\n  async deleteNotification(userId: string, notificationId: string): Promise<boolean> {\n    const notifications = this.notifications.get(userId) || [];\n    const initialLength = notifications.length;\n    \n    const updated = notifications.filter(n => n.id !== notificationId);\n    this.notifications.set(userId, updated);\n\n    const removedCount = initialLength - updated.length;\n    \n    if (removedCount > 0) {\n      // Update unread count if the deleted notification was unread\n      const deletedNotif = notifications.find(n => n.id === notificationId);\n      if (deletedNotif && !deletedNotif.read) {\n        const currentUnread = this.unreadCounts.get(userId) || 0;\n        this.unreadCounts.set(userId, Math.max(0, currentUnread - 1));\n      }\n    }\n\n    return removedCount > 0;\n  }\n\n  /**\n   * Get unread notification count for a user\n   */\n  async getUnreadCount(userId: string): Promise<number> {\n    return this.unreadCounts.get(userId) || 0;\n  }\n\n  /**\n   * Get user's notification preferences\n   */\n  async getPreferences(userId: string): Promise<NotificationPreferences> {\n    if (!this.preferences.has(userId)) {\n      // Create default preferences\n      const defaultPrefs: NotificationPreferences = {\n        userId,\n        emailNotifications: true,\n        inAppNotifications: true,\n        pushNotifications: false, // Disabled by default\n        notificationChannels: {\n          extractionCompleted: true,\n          systemUpdates: true,\n          securityAlerts: true,\n          billing: true,\n          featureUpdates: true\n        },\n        createdAt: new Date(),\n        updatedAt: new Date()\n      };\n      \n      this.preferences.set(userId, defaultPrefs);\n      return defaultPrefs;\n    }\n\n    return this.preferences.get(userId)!;\n  }\n\n  /**\n   * Update user's notification preferences\n   */\n  async updatePreferences(userId: string, updates: Partial<NotificationPreferences>): Promise<boolean> {\n    const currentPrefs = await this.getPreferences(userId);\n    \n    // Update preferences\n    Object.assign(currentPrefs, updates, { updatedAt: new Date() });\n    this.preferences.set(userId, currentPrefs);\n    \n    return true;\n  }\n\n  /**\n   * Toggle a specific notification channel\n   */\n  async toggleNotificationChannel(\n    userId: string,\n    channel: keyof NotificationPreferences['notificationChannels'],\n    enabled: boolean\n  ): Promise<boolean> {\n    const prefs = await this.getPreferences(userId);\n    prefs.notificationChannels[channel] = enabled;\n    prefs.updatedAt = new Date();\n    \n    this.preferences.set(userId, prefs);\n    return true;\n  }\n\n  /**\n   * Create a notification channel\n   */\n  async createChannel(\n    name: string,\n    description: string,\n    enabled: boolean,\n    userId?: string\n  ): Promise<NotificationChannel> {\n    const channel: NotificationChannel = {\n      id: uuidv4(),\n      name,\n      description,\n      enabled,\n      userId,\n      createdAt: new Date(),\n      updatedAt: new Date()\n    };\n\n    if (!this.channels.has(userId || 'global')) {\n      this.channels.set(userId || 'global', []);\n    }\n\n    const channelList = this.channels.get(userId || 'global')!;\n    channelList.push(channel);\n\n    return channel;\n  }\n\n  /**\n   * Get notification channels for a user\n   */\n  async getUserChannels(userId: string): Promise<NotificationChannel[]> {\n    const userChannels = this.channels.get(userId) || [];\n    const globalChannels = this.channels.get('global') || [];\n    \n    return [...globalChannels, ...userChannels];\n  }\n\n  /**\n   * Bulk send notifications to multiple users\n   */\n  async bulkSend(\n    userIds: string[],\n    type: Notification['type'],\n    title: string,\n    message: string,\n    options: {\n      priority?: Notification['priority'];\n      actionUrl?: string;\n      actionLabel?: string;\n      expiresAt?: Date;\n      metadata?: Record<string, any>;\n    } = {}\n  ): Promise<{ success: number; failed: number; ids: string[] }> {\n    const results = await Promise.all(\n      userIds.map(async userId => {\n        try {\n          const id = await this.sendNotification(userId, type, title, message, options);\n          return { success: true, id };\n        } catch (error) {\n          return { success: false, error };\n        }\n      })\n    );\n\n    const successful = results.filter(r => r.success);\n    const failed = results.filter(r => !r.success);\n\n    return {\n      success: successful.length,\n      failed: failed.length,\n      ids: successful.map(r => (r as any).id)\n    };\n  }\n\n  /**\n   * Send system-wide notification\n   */\n  async broadcast(\n    type: Notification['type'],\n    title: string,\n    message: string,\n    options: {\n      priority?: Notification['priority'];\n      actionUrl?: string;\n      actionLabel?: string;\n      expiresAt?: Date;\n      metadata?: Record<string, any>;\n    } = {}\n  ): Promise<{ success: number; failed: number; ids: string[] }> {\n    const allUserIds = Array.from(this.notifications.keys());\n    return await this.bulkSend(allUserIds, type, title, message, options);\n  }\n\n  /**\n   * Clean up expired notifications\n   */\n  async cleanupExpired(): Promise<number> {\n    const now = new Date();\n    let cleanedCount = 0;\n\n    for (const [userId, userNotifications] of this.notifications.entries()) {\n      const initialCount = userNotifications.length;\n      const activeNotifications = userNotifications.filter(\n        notif => !notif.expiresAt || notif.expiresAt > now\n      );\n      \n      this.notifications.set(userId, activeNotifications);\n      cleanedCount += initialCount - activeNotifications.length;\n    }\n\n    return cleanedCount;\n  }\n\n  /**\n   * Get notification statistics\n   */\n  async getStats(userId: string): Promise<{\n    total: number;\n    unread: number;\n    read: number;\n    byType: Record<string, number>;\n    byPriority: Record<string, number>;\n    recent: number; // Last 24 hours\n  }> {\n    const allNotifications = this.notifications.get(userId) || [];\n    const now = new Date();\n    const yesterday = new Date(now.getTime() - 24 * 60 * 60 * 1000);\n\n    const stats = {\n      total: allNotifications.length,\n      unread: 0,\n      read: 0,\n      byType: {} as Record<string, number>,\n      byPriority: {} as Record<string, number>,\n      recent: 0\n    };\n\n    for (const notif of allNotifications) {\n      if (notif.read) {\n        stats.read++;\n      } else {\n        stats.unread++;\n      }\n\n      // Count by type\n      stats.byType[notif.type] = (stats.byType[notif.type] || 0) + 1;\n\n      // Count by priority\n      stats.byPriority[notif.priority] = (stats.byPriority[notif.priority] || 0) + 1;\n\n      // Count recent (last 24 hours)\n      if (notif.createdAt > yesterday) {\n        stats.recent++;\n      }\n    }\n\n    return stats;\n  }\n\n  /**\n   * Subscribe to notification events\n   */\n  onNotificationReceived(\n    userId: string,\n    callback: (notification: Notification) => void\n  ): () => void {\n    // In a real implementation, this would use an event emitter\n    // For now, we'll return a dummy unsubscribe function\n    return () => {\n      // Unsubscribe logic would go here\n    };\n  }\n}\n\n// Singleton instance\nexport const notificationSystem = new NotificationSystem();\n\nexport default notificationSystem;","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/onboarding.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1724,1727],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1724,1727],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":134,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3743,3746],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3743,3746],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":387,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":387,"endColumn":20,"suggestions":[{"fix":{"range":[12455,12512],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":426,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":426,"endColumn":20,"suggestions":[{"fix":{"range":[13522,13574],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":433,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":433,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13798,13801],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13798,13801],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":478,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":478,"endColumn":20,"suggestions":[{"fix":{"range":[15207,15267],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":513,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":513,"endColumn":20,"suggestions":[{"fix":{"range":[16175,16235],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":535,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":535,"endColumn":20,"suggestions":[{"fix":{"range":[16724,16776],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":557,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":557,"endColumn":20,"suggestions":[{"fix":{"range":[17253,17306],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":584,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":584,"endColumn":20,"suggestions":[{"fix":{"range":[17903,17958],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":885,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":885,"endColumn":22,"suggestions":[{"fix":{"range":[28316,28391],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":1041,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":1041,"endColumn":19,"suggestions":[{"fix":{"range":[33297,33373],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":1060,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":1060,"endColumn":16,"suggestions":[{"fix":{"range":[33775,33832],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":13,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Onboarding Context and State Management\n * \n * Provides onboarding state, progress tracking, and user profile management\n * throughout the intelligent onboarding experience.\n */\n\nimport React, { createContext, useContext, useState, useEffect, useCallback } from \"react\";\nimport { useAuth } from \"./auth\";\n\n// ============================================================================\n// Core Types and Interfaces\n// ============================================================================\n\nexport interface UserProfile {\n  useCase: 'personal' | 'professional' | 'forensic' | 'research' | 'enterprise';\n  technicalLevel: 'beginner' | 'intermediate' | 'advanced';\n  primaryFileTypes: string[];\n  industry?: string;\n  goals: string[];\n  completedAt?: Date;\n}\n\nexport interface OnboardingStep {\n  id: string;\n  title: string;\n  description: string;\n  targetElement?: string;\n  position: 'top' | 'bottom' | 'left' | 'right' | 'center';\n  skippable: boolean;\n  completionCriteria: {\n    type: 'interaction' | 'time' | 'manual';\n    value?: string | number;\n  };\n}\n\nexport interface OnboardingPath {\n  id: string;\n  name: string;\n  description: string;\n  steps: OnboardingStep[];\n  estimatedDuration: number;\n  prerequisites: string[];\n}\n\nexport interface OnboardingProgress {\n  stepsCompleted: string[];\n  milestonesAchieved: string[];\n  featuresDiscovered: string[];\n  samplesProcessed: string[];\n  timeSpent: number;\n  completionRate: number;\n  currentStepIndex: number;\n}\n\nexport interface UserInteraction {\n  timestamp: Date;\n  type: 'step-complete' | 'skip' | 'help-request' | 'feature-try' | 'error';\n  stepId?: string;\n  featureId?: string;\n  duration?: number;\n  success?: boolean;\n  metadata: Record<string, any>;\n}\n\nexport interface InteractionMetrics {\n  averageStepDuration: number;\n  successRate: number;\n  skipRate: number;\n  helpRequestRate: number;\n  errorRate: number;\n  interactionSpeed: 'slow' | 'normal' | 'fast';\n  proficiencyLevel: 'beginner' | 'intermediate' | 'advanced';\n}\n\nexport interface AdaptivePacing {\n  recommendedDelay: number; // milliseconds between steps\n  shouldShowExtraHelp: boolean;\n  shouldSkipBasicExplanations: boolean;\n  complexityLevel: 'basic' | 'intermediate' | 'advanced';\n}\n\nexport interface AdvancedTutorial {\n  id: string;\n  title: string;\n  description: string;\n  prerequisites: string[]; // IDs of features/steps that must be completed\n  interestIndicators: string[]; // Feature IDs that indicate interest in this tutorial\n  difficulty: 'intermediate' | 'advanced';\n  estimatedDuration: number;\n  path: OnboardingPath;\n}\n\nexport interface FeatureInterest {\n  featureId: string;\n  interactionCount: number;\n  lastInteraction: Date;\n  completionRate: number;\n  timeSpent: number;\n}\n\nexport interface OnboardingSession {\n  id: string;\n  startedAt: Date;\n  completedAt?: Date;\n  currentStep: number;\n  pathId: string;\n  userProfile: UserProfile;\n  progress: OnboardingProgress;\n  interactions: UserInteraction[];\n  isActive: boolean;\n  metrics?: InteractionMetrics;\n  adaptivePacing?: AdaptivePacing;\n  featureInterests?: FeatureInterest[];\n  unlockedTutorials?: string[]; // IDs of unlocked advanced tutorials\n}\n\n// ============================================================================\n// Context Interface\n// ============================================================================\n\ninterface OnboardingContextType {\n  // Session state\n  session: OnboardingSession | null;\n  isOnboardingActive: boolean;\n  isOnboardingComplete: boolean;\n  \n  // Current state\n  currentPath: OnboardingPath | null;\n  currentStep: OnboardingStep | null;\n  \n  // Actions\n  startOnboarding: (userProfile: UserProfile) => Promise<void>;\n  completeStep: (stepId: string, metadata?: Record<string, any>) => Promise<void>;\n  skipStep: (stepId: string, reason?: string) => Promise<void>;\n  pauseOnboarding: () => Promise<void>;\n  resumeOnboarding: () => Promise<void>;\n  completeOnboarding: () => Promise<void>;\n  \n  // Progress tracking\n  updateProgress: (progress: Partial<OnboardingProgress>) => void;\n  trackInteraction: (interaction: Omit<UserInteraction, 'timestamp'>) => void;\n  \n  // User profile\n  updateUserProfile: (profile: Partial<UserProfile>) => void;\n  \n  // Adaptive learning\n  calculateMetrics: () => InteractionMetrics;\n  getAdaptivePacing: () => AdaptivePacing;\n  shouldModifyPath: () => boolean;\n  modifyPathForUser: () => OnboardingPath | null;\n  \n  // Advanced tutorial unlocking\n  detectFeatureInterest: (featureId: string) => void;\n  checkPrerequisites: (tutorialId: string) => boolean;\n  getRecommendedTutorials: () => AdvancedTutorial[];\n  unlockTutorial: (tutorialId: string) => void;\n  isAdvancedTutorialUnlocked: (tutorialId: string) => boolean;\n  \n  // Utilities\n  getRecommendedPath: (profile: UserProfile) => OnboardingPath;\n  canAccessStep: (stepId: string) => boolean;\n  getNextStep: () => OnboardingStep | null;\n  getPreviousStep: () => OnboardingStep | null;\n}\n\n// ============================================================================\n// Default Onboarding Paths\n// ============================================================================\n\nconst DEFAULT_PATHS: OnboardingPath[] = [\n  {\n    id: 'personal-basic',\n    name: 'Personal User Journey',\n    description: 'Perfect for individuals exploring metadata extraction',\n    estimatedDuration: 300, // 5 minutes\n    prerequisites: [],\n    steps: [\n      {\n        id: 'welcome',\n        title: 'Welcome to MetaExtract',\n        description: 'Let\\'s get you started with metadata extraction',\n        position: 'center',\n        skippable: false,\n        completionCriteria: { type: 'manual' }\n      },\n      {\n        id: 'upload-intro',\n        title: 'Upload Your First File',\n        description: 'Try uploading an image or document to see what metadata we can extract',\n        targetElement: '[data-testid=\"upload-zone\"]',\n        position: 'top',\n        skippable: true,\n        completionCriteria: { type: 'interaction', value: 'file-upload' }\n      },\n      {\n        id: 'results-tour',\n        title: 'Understanding Your Results',\n        description: 'Learn how to read and interpret the extracted metadata',\n        targetElement: '[data-testid=\"results-panel\"]',\n        position: 'left',\n        skippable: true,\n        completionCriteria: { type: 'manual' }\n      }\n    ]\n  },\n  {\n    id: 'professional-advanced',\n    name: 'Professional User Journey',\n    description: 'Comprehensive tour for professional users',\n    estimatedDuration: 600, // 10 minutes\n    prerequisites: [],\n    steps: [\n      {\n        id: 'welcome-pro',\n        title: 'Welcome, Professional User',\n        description: 'Let\\'s explore advanced metadata extraction capabilities',\n        position: 'center',\n        skippable: false,\n        completionCriteria: { type: 'manual' }\n      },\n      {\n        id: 'batch-processing',\n        title: 'Batch Processing',\n        description: 'Learn how to process multiple files efficiently',\n        targetElement: '[data-testid=\"batch-upload\"]',\n        position: 'top',\n        skippable: true,\n        completionCriteria: { type: 'interaction', value: 'batch-upload' }\n      },\n      {\n        id: 'advanced-features',\n        title: 'Advanced Analysis',\n        description: 'Discover forensic analysis and advanced metadata extraction',\n        targetElement: '[data-testid=\"advanced-panel\"]',\n        position: 'right',\n        skippable: true,\n        completionCriteria: { type: 'manual' }\n      }\n    ]\n  }\n];\n\n// ============================================================================\n// Advanced Tutorials\n// ============================================================================\n\nconst ADVANCED_TUTORIALS: AdvancedTutorial[] = [\n  {\n    id: 'forensic-analysis',\n    title: 'Forensic Analysis Deep Dive',\n    description: 'Learn advanced forensic analysis techniques for digital evidence',\n    prerequisites: ['results-tour', 'upload-intro'],\n    interestIndicators: ['forensic-feature', 'advanced-analysis', 'timeline-view'],\n    difficulty: 'advanced',\n    estimatedDuration: 900, // 15 minutes\n    path: {\n      id: 'forensic-tutorial',\n      name: 'Forensic Analysis Tutorial',\n      description: 'Master forensic metadata analysis',\n      estimatedDuration: 900,\n      prerequisites: ['results-tour'],\n      steps: [\n        {\n          id: 'forensic-intro',\n          title: 'Introduction to Forensic Analysis',\n          description: 'Understand how metadata can be used for digital forensics',\n          position: 'center',\n          skippable: false,\n          completionCriteria: { type: 'manual' }\n        },\n        {\n          id: 'timeline-analysis',\n          title: 'Timeline Analysis',\n          description: 'Learn to analyze file timelines and detect anomalies',\n          targetElement: '[data-testid=\"timeline-panel\"]',\n          position: 'right',\n          skippable: true,\n          completionCriteria: { type: 'manual' }\n        }\n      ]\n    }\n  },\n  {\n    id: 'batch-processing-advanced',\n    title: 'Advanced Batch Processing',\n    description: 'Process hundreds of files efficiently with advanced filtering',\n    prerequisites: ['upload-intro'],\n    interestIndicators: ['batch-upload', 'multiple-files'],\n    difficulty: 'intermediate',\n    estimatedDuration: 600, // 10 minutes\n    path: {\n      id: 'batch-tutorial',\n      name: 'Batch Processing Tutorial',\n      description: 'Master batch file processing',\n      estimatedDuration: 600,\n      prerequisites: ['upload-intro'],\n      steps: [\n        {\n          id: 'batch-intro',\n          title: 'Batch Processing Basics',\n          description: 'Learn to upload and process multiple files at once',\n          targetElement: '[data-testid=\"batch-upload\"]',\n          position: 'top',\n          skippable: false,\n          completionCriteria: { type: 'interaction', value: 'batch-upload' }\n        },\n        {\n          id: 'batch-filtering',\n          title: 'Advanced Filtering',\n          description: 'Filter and organize batch results efficiently',\n          targetElement: '[data-testid=\"filter-panel\"]',\n          position: 'left',\n          skippable: true,\n          completionCriteria: { type: 'manual' }\n        }\n      ]\n    }\n  },\n  {\n    id: 'comparison-analysis',\n    title: 'File Comparison Analysis',\n    description: 'Compare metadata across multiple files to find patterns',\n    prerequisites: ['results-tour'],\n    interestIndicators: ['comparison-view', 'multiple-files', 'analysis'],\n    difficulty: 'intermediate',\n    estimatedDuration: 450, // 7.5 minutes\n    path: {\n      id: 'comparison-tutorial',\n      name: 'Comparison Analysis Tutorial',\n      description: 'Learn to compare file metadata',\n      estimatedDuration: 450,\n      prerequisites: ['results-tour'],\n      steps: [\n        {\n          id: 'comparison-intro',\n          title: 'Introduction to Comparison',\n          description: 'Learn how to compare metadata across files',\n          targetElement: '[data-testid=\"comparison-panel\"]',\n          position: 'center',\n          skippable: false,\n          completionCriteria: { type: 'manual' }\n        }\n      ]\n    }\n  }\n];\n\n// ============================================================================\n// Context Implementation\n// ============================================================================\n\nconst OnboardingContext = createContext<OnboardingContextType | null>(null);\n\nexport function OnboardingProvider({ children }: { children: React.ReactNode }) {\n  const { user, isAuthenticated } = useAuth();\n  const [session, setSession] = useState<OnboardingSession | null>(null);\n  const [currentPath, setCurrentPath] = useState<OnboardingPath | null>(null);\n\n  // Initialize onboarding state on mount\n  useEffect(() => {\n    initializeOnboarding();\n  }, [isAuthenticated, user]);\n\n  const initializeOnboarding = useCallback(async () => {\n    if (!isAuthenticated || !user) {\n      return;\n    }\n\n    try {\n      // Check if user has completed onboarding\n      const response = await fetch('/api/onboarding/status', {\n        credentials: 'include'\n      });\n      \n      if (response.ok) {\n        const data = await response.json();\n        if (data.session) {\n          setSession(data.session);\n          if (data.session.pathId) {\n            const path = DEFAULT_PATHS.find(p => p.id === data.session.pathId);\n            setCurrentPath(path || null);\n          }\n        }\n      }\n    } catch (error) {\n      console.error('Failed to initialize onboarding:', error);\n    }\n  }, [isAuthenticated, user]);\n\n  const startOnboarding = useCallback(async (userProfile: UserProfile) => {\n    const recommendedPath = getRecommendedPath(userProfile);\n    \n    const newSession: OnboardingSession = {\n      id: crypto.randomUUID(),\n      startedAt: new Date(),\n      currentStep: 0,\n      pathId: recommendedPath.id,\n      userProfile,\n      progress: {\n        stepsCompleted: [],\n        milestonesAchieved: [],\n        featuresDiscovered: [],\n        samplesProcessed: [],\n        timeSpent: 0,\n        completionRate: 0,\n        currentStepIndex: 0\n      },\n      interactions: [],\n      isActive: true\n    };\n\n    try {\n      const response = await fetch('/api/onboarding/start', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify(newSession)\n      });\n\n      if (response.ok) {\n        setSession(newSession);\n        setCurrentPath(recommendedPath);\n      }\n    } catch (error) {\n      console.error('Failed to start onboarding:', error);\n      // Continue with local state even if API fails\n      setSession(newSession);\n      setCurrentPath(recommendedPath);\n    }\n  }, []);\n\n  const completeStep = useCallback(async (stepId: string, metadata?: Record<string, any>) => {\n    if (!session || !currentPath) return;\n\n    // Calculate step duration\n    const stepStartTime = session.interactions\n      .filter(i => i.stepId === stepId)\n      .sort((a, b) => a.timestamp.getTime() - b.timestamp.getTime())[0]?.timestamp;\n    \n    const duration = stepStartTime \n      ? Date.now() - new Date(stepStartTime).getTime()\n      : undefined;\n\n    const interaction: UserInteraction = {\n      timestamp: new Date(),\n      type: 'step-complete',\n      stepId,\n      duration,\n      success: metadata?.validated !== false,\n      metadata: metadata || {}\n    };\n\n    const updatedProgress = {\n      ...session.progress,\n      stepsCompleted: [...session.progress.stepsCompleted, stepId],\n      currentStepIndex: session.progress.currentStepIndex + 1,\n      completionRate: ((session.progress.stepsCompleted.length + 1) / currentPath.steps.length) * 100,\n      timeSpent: session.progress.timeSpent + (duration || 0)\n    };\n\n    const updatedSession = {\n      ...session,\n      progress: updatedProgress,\n      interactions: [...session.interactions, interaction]\n    };\n\n    setSession(updatedSession);\n\n    try {\n      await fetch('/api/onboarding/progress', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({ session: updatedSession, interaction })\n      });\n    } catch (error) {\n      console.error('Failed to save onboarding progress:', error);\n    }\n  }, [session, currentPath]);\n\n  const skipStep = useCallback(async (stepId: string, reason?: string) => {\n    if (!session || !currentPath) return;\n\n    const interaction: UserInteraction = {\n      timestamp: new Date(),\n      type: 'skip',\n      stepId,\n      metadata: { reason: reason || 'user-skip' }\n    };\n\n    const updatedProgress = {\n      ...session.progress,\n      currentStepIndex: session.progress.currentStepIndex + 1\n    };\n\n    const updatedSession = {\n      ...session,\n      progress: updatedProgress,\n      interactions: [...session.interactions, interaction]\n    };\n\n    setSession(updatedSession);\n\n    try {\n      await fetch('/api/onboarding/progress', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({ session: updatedSession, interaction })\n      });\n    } catch (error) {\n      console.error('Failed to save onboarding progress:', error);\n    }\n  }, [session, currentPath]);\n\n  const pauseOnboarding = useCallback(async () => {\n    if (!session) return;\n\n    const updatedSession = {\n      ...session,\n      isActive: false\n    };\n\n    setSession(updatedSession);\n\n    try {\n      await fetch('/api/onboarding/pause', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({ sessionId: session.id })\n      });\n    } catch (error) {\n      console.error('Failed to pause onboarding:', error);\n    }\n  }, [session]);\n\n  const resumeOnboarding = useCallback(async () => {\n    if (!session) return;\n\n    const updatedSession = {\n      ...session,\n      isActive: true\n    };\n\n    setSession(updatedSession);\n\n    try {\n      await fetch('/api/onboarding/resume', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({ sessionId: session.id })\n      });\n    } catch (error) {\n      console.error('Failed to resume onboarding:', error);\n    }\n  }, [session]);\n\n  const completeOnboarding = useCallback(async () => {\n    if (!session) return;\n\n    const updatedSession = {\n      ...session,\n      completedAt: new Date(),\n      isActive: false,\n      progress: {\n        ...session.progress,\n        completionRate: 100\n      }\n    };\n\n    setSession(updatedSession);\n\n    try {\n      await fetch('/api/onboarding/complete', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({ sessionId: session.id })\n      });\n    } catch (error) {\n      console.error('Failed to complete onboarding:', error);\n    }\n  }, [session]);\n\n  const updateProgress = useCallback((progress: Partial<OnboardingProgress>) => {\n    if (!session) return;\n\n    const updatedSession = {\n      ...session,\n      progress: { ...session.progress, ...progress }\n    };\n\n    setSession(updatedSession);\n  }, [session]);\n\n  const trackInteraction = useCallback((interaction: Omit<UserInteraction, 'timestamp'>) => {\n    if (!session) return;\n\n    const fullInteraction: UserInteraction = {\n      ...interaction,\n      timestamp: new Date()\n    };\n\n    const updatedSession = {\n      ...session,\n      interactions: [...session.interactions, fullInteraction]\n    };\n\n    setSession(updatedSession);\n  }, [session]);\n\n  const updateUserProfile = useCallback((profile: Partial<UserProfile>) => {\n    if (!session) return;\n\n    const updatedSession = {\n      ...session,\n      userProfile: { ...session.userProfile, ...profile }\n    };\n\n    setSession(updatedSession);\n  }, [session]);\n\n  const getRecommendedPath = useCallback((profile: UserProfile): OnboardingPath => {\n    // Simple path recommendation logic\n    if (profile.useCase === 'personal' && profile.technicalLevel === 'beginner') {\n      return DEFAULT_PATHS.find(p => p.id === 'personal-basic') || DEFAULT_PATHS[0];\n    }\n    \n    if (profile.useCase === 'professional' || profile.technicalLevel === 'advanced') {\n      return DEFAULT_PATHS.find(p => p.id === 'professional-advanced') || DEFAULT_PATHS[1];\n    }\n\n    return DEFAULT_PATHS[0];\n  }, []);\n\n  const canAccessStep = useCallback((stepId: string): boolean => {\n    if (!session || !currentPath) return false;\n\n    const stepIndex = currentPath.steps.findIndex(s => s.id === stepId);\n    return stepIndex <= session.progress.currentStepIndex;\n  }, [session, currentPath]);\n\n  const getNextStep = useCallback((): OnboardingStep | null => {\n    if (!session || !currentPath) return null;\n\n    const nextIndex = session.progress.currentStepIndex;\n    return currentPath.steps[nextIndex] || null;\n  }, [session, currentPath]);\n\n  const getPreviousStep = useCallback((): OnboardingStep | null => {\n    if (!session || !currentPath) return null;\n\n    const prevIndex = session.progress.currentStepIndex - 1;\n    return prevIndex >= 0 ? currentPath.steps[prevIndex] : null;\n  }, [session, currentPath]);\n\n  // ============================================================================\n  // Adaptive Learning Functions\n  // ============================================================================\n\n  /**\n   * Calculate interaction metrics from user behavior\n   */\n  const calculateMetrics = useCallback((): InteractionMetrics => {\n    if (!session || session.interactions.length === 0) {\n      return {\n        averageStepDuration: 0,\n        successRate: 100,\n        skipRate: 0,\n        helpRequestRate: 0,\n        errorRate: 0,\n        interactionSpeed: 'normal',\n        proficiencyLevel: 'beginner'\n      };\n    }\n\n    const interactions = session.interactions;\n    const totalInteractions = interactions.length;\n\n    // Calculate step durations\n    const stepCompletions = interactions.filter(i => i.type === 'step-complete' && i.duration);\n    const averageStepDuration = stepCompletions.length > 0\n      ? stepCompletions.reduce((sum, i) => sum + (i.duration || 0), 0) / stepCompletions.length\n      : 0;\n\n    // Calculate rates\n    const successfulSteps = interactions.filter(i => i.type === 'step-complete' && i.success !== false).length;\n    const skippedSteps = interactions.filter(i => i.type === 'skip').length;\n    const helpRequests = interactions.filter(i => i.type === 'help-request').length;\n    const errors = interactions.filter(i => i.type === 'error').length;\n\n    const successRate = totalInteractions > 0 ? (successfulSteps / totalInteractions) * 100 : 100;\n    const skipRate = totalInteractions > 0 ? (skippedSteps / totalInteractions) * 100 : 0;\n    const helpRequestRate = totalInteractions > 0 ? (helpRequests / totalInteractions) * 100 : 0;\n    const errorRate = totalInteractions > 0 ? (errors / totalInteractions) * 100 : 0;\n\n    // Determine interaction speed (based on average step duration)\n    // Fast: < 30 seconds, Normal: 30-90 seconds, Slow: > 90 seconds\n    let interactionSpeed: 'slow' | 'normal' | 'fast' = 'normal';\n    if (averageStepDuration > 0) {\n      if (averageStepDuration < 30000) {\n        interactionSpeed = 'fast';\n      } else if (averageStepDuration > 90000) {\n        interactionSpeed = 'slow';\n      }\n    }\n\n    // Determine proficiency level based on multiple factors\n    let proficiencyLevel: 'beginner' | 'intermediate' | 'advanced' = 'beginner';\n    \n    // Advanced: high success rate, low skip/help/error rates, fast speed\n    if (successRate > 80 && skipRate < 10 && helpRequestRate < 10 && errorRate < 5 && interactionSpeed === 'fast') {\n      proficiencyLevel = 'advanced';\n    }\n    // Intermediate: moderate success, some skips/help, normal speed\n    else if (successRate > 60 && skipRate < 30 && helpRequestRate < 30 && errorRate < 15) {\n      proficiencyLevel = 'intermediate';\n    }\n\n    return {\n      averageStepDuration,\n      successRate,\n      skipRate,\n      helpRequestRate,\n      errorRate,\n      interactionSpeed,\n      proficiencyLevel\n    };\n  }, [session]);\n\n  /**\n   * Get adaptive pacing recommendations based on user metrics\n   */\n  const getAdaptivePacing = useCallback((): AdaptivePacing => {\n    const metrics = calculateMetrics();\n\n    // Default pacing\n    let recommendedDelay = 1000; // 1 second between steps\n    let shouldShowExtraHelp = false;\n    let shouldSkipBasicExplanations = false;\n    let complexityLevel: 'basic' | 'intermediate' | 'advanced' = 'basic';\n\n    // Adjust based on interaction speed\n    if (metrics.interactionSpeed === 'slow') {\n      recommendedDelay = 2000; // Give more time\n      shouldShowExtraHelp = true;\n    } else if (metrics.interactionSpeed === 'fast') {\n      recommendedDelay = 500; // Move faster\n      shouldSkipBasicExplanations = metrics.proficiencyLevel === 'advanced';\n    }\n\n    // Adjust based on error and help request rates\n    if (metrics.errorRate > 10 || metrics.helpRequestRate > 20) {\n      shouldShowExtraHelp = true;\n      complexityLevel = 'basic';\n    } else if (metrics.successRate > 80 && metrics.skipRate < 10) {\n      complexityLevel = metrics.proficiencyLevel === 'advanced' ? 'advanced' : 'intermediate';\n    }\n\n    // Adjust based on proficiency level\n    if (metrics.proficiencyLevel === 'advanced') {\n      shouldSkipBasicExplanations = true;\n      complexityLevel = 'advanced';\n    } else if (metrics.proficiencyLevel === 'beginner') {\n      shouldShowExtraHelp = true;\n      complexityLevel = 'basic';\n    }\n\n    return {\n      recommendedDelay,\n      shouldShowExtraHelp,\n      shouldSkipBasicExplanations,\n      complexityLevel\n    };\n  }, [calculateMetrics]);\n\n  /**\n   * Determine if the onboarding path should be modified\n   */\n  const shouldModifyPath = useCallback((): boolean => {\n    if (!session || !currentPath) return false;\n\n    const metrics = calculateMetrics();\n    const pacing = getAdaptivePacing();\n\n    // Modify path if user is significantly faster or slower than expected\n    const expectedDuration = currentPath.estimatedDuration;\n    const actualDuration = session.progress.timeSpent;\n    const progressRatio = session.progress.currentStepIndex / currentPath.steps.length;\n\n    if (progressRatio > 0.3) { // Only modify after 30% completion\n      // User is much faster than expected and showing high proficiency\n      if (metrics.proficiencyLevel === 'advanced' && actualDuration < expectedDuration * 0.5) {\n        return true;\n      }\n\n      // User is struggling (high error rate, many help requests)\n      if (metrics.errorRate > 15 || metrics.helpRequestRate > 30) {\n        return true;\n      }\n\n      // User's complexity level doesn't match path\n      if (pacing.complexityLevel === 'advanced' && currentPath.id.includes('basic')) {\n        return true;\n      }\n      if (pacing.complexityLevel === 'basic' && currentPath.id.includes('advanced')) {\n        return true;\n      }\n    }\n\n    return false;\n  }, [session, currentPath, calculateMetrics, getAdaptivePacing]);\n\n  /**\n   * Modify the onboarding path based on user behavior\n   */\n  const modifyPathForUser = useCallback((): OnboardingPath | null => {\n    if (!session || !currentPath) return null;\n\n    const metrics = calculateMetrics();\n    const pacing = getAdaptivePacing();\n\n    // If user is advanced and on basic path, switch to advanced\n    if (metrics.proficiencyLevel === 'advanced' && currentPath.id.includes('basic')) {\n      const advancedPath = DEFAULT_PATHS.find(p => p.id.includes('advanced'));\n      if (advancedPath) {\n        return advancedPath;\n      }\n    }\n\n    // If user is struggling on advanced path, switch to basic\n    if ((metrics.errorRate > 15 || metrics.helpRequestRate > 30) && currentPath.id.includes('advanced')) {\n      const basicPath = DEFAULT_PATHS.find(p => p.id.includes('basic'));\n      if (basicPath) {\n        return basicPath;\n      }\n    }\n\n    // Create a modified version of current path with adjusted steps\n    const modifiedSteps = currentPath.steps.map(step => {\n      // Skip basic explanations for advanced users\n      if (pacing.shouldSkipBasicExplanations && step.id.includes('intro')) {\n        return { ...step, skippable: true };\n      }\n\n      // Make steps less skippable for struggling users\n      if (pacing.shouldShowExtraHelp) {\n        return { ...step, skippable: false };\n      }\n\n      return step;\n    });\n\n    return {\n      ...currentPath,\n      steps: modifiedSteps,\n      estimatedDuration: Math.round(currentPath.estimatedDuration * (pacing.recommendedDelay / 1000))\n    };\n  }, [session, currentPath, calculateMetrics, getAdaptivePacing]);\n\n  // Update metrics and pacing periodically\n  useEffect(() => {\n    if (!session || !session.isActive) return;\n\n    const updateMetrics = () => {\n      const metrics = calculateMetrics();\n      const pacing = getAdaptivePacing();\n\n      const updatedSession = {\n        ...session,\n        metrics,\n        adaptivePacing: pacing\n      };\n\n      setSession(updatedSession);\n\n      // Check if path should be modified\n      if (shouldModifyPath()) {\n        const newPath = modifyPathForUser();\n        if (newPath && newPath.id !== currentPath?.id) {\n          setCurrentPath(newPath);\n          console.log('Onboarding path adapted based on user behavior:', newPath.id);\n        }\n      }\n    };\n\n    // Update metrics every 30 seconds\n    const interval = setInterval(updateMetrics, 30000);\n\n    return () => clearInterval(interval);\n  }, [session, currentPath, calculateMetrics, getAdaptivePacing, shouldModifyPath, modifyPathForUser]);\n\n  // ============================================================================\n  // Advanced Tutorial Unlocking Functions\n  // ============================================================================\n\n  /**\n   * Detect and track user interest in specific features\n   */\n  const detectFeatureInterest = useCallback((featureId: string) => {\n    if (!session) return;\n\n    const existingInterests = session.featureInterests || [];\n    const existingInterest = existingInterests.find(i => i.featureId === featureId);\n\n    let updatedInterests: FeatureInterest[];\n\n    if (existingInterest) {\n      // Update existing interest\n      updatedInterests = existingInterests.map(interest =>\n        interest.featureId === featureId\n          ? {\n              ...interest,\n              interactionCount: interest.interactionCount + 1,\n              lastInteraction: new Date()\n            }\n          : interest\n      );\n    } else {\n      // Add new interest\n      updatedInterests = [\n        ...existingInterests,\n        {\n          featureId,\n          interactionCount: 1,\n          lastInteraction: new Date(),\n          completionRate: 0,\n          timeSpent: 0\n        }\n      ];\n    }\n\n    const updatedSession = {\n      ...session,\n      featureInterests: updatedInterests\n    };\n\n    setSession(updatedSession);\n\n    // Track interaction\n    trackInteraction({\n      type: 'feature-try',\n      featureId,\n      metadata: { action: 'interest-detected' }\n    });\n  }, [session, trackInteraction]);\n\n  /**\n   * Check if user has completed all prerequisites for a tutorial\n   */\n  const checkPrerequisites = useCallback((tutorialId: string): boolean => {\n    if (!session) return false;\n\n    const tutorial = ADVANCED_TUTORIALS.find(t => t.id === tutorialId);\n    if (!tutorial) return false;\n\n    // Check if all prerequisite steps have been completed\n    const completedSteps = session.progress.stepsCompleted;\n    return tutorial.prerequisites.every(prereq => completedSteps.includes(prereq));\n  }, [session]);\n\n  /**\n   * Get recommended advanced tutorials based on user interests and prerequisites\n   */\n  const getRecommendedTutorials = useCallback((): AdvancedTutorial[] => {\n    if (!session) return [];\n\n    const featureInterests = session.featureInterests || [];\n    const unlockedTutorials = session.unlockedTutorials || [];\n    const metrics = calculateMetrics();\n\n    // Filter tutorials based on prerequisites and proficiency\n    const eligibleTutorials = ADVANCED_TUTORIALS.filter(tutorial => {\n      // Must meet prerequisites\n      if (!checkPrerequisites(tutorial.id)) return false;\n\n      // Must not already be unlocked\n      if (unlockedTutorials.includes(tutorial.id)) return false;\n\n      // Must match proficiency level\n      if (tutorial.difficulty === 'advanced' && metrics.proficiencyLevel === 'beginner') {\n        return false;\n      }\n\n      return true;\n    });\n\n    // Score tutorials based on interest indicators\n    const scoredTutorials = eligibleTutorials.map(tutorial => {\n      let score = 0;\n\n      // Check interest indicators\n      tutorial.interestIndicators.forEach(indicator => {\n        const interest = featureInterests.find(i => i.featureId === indicator);\n        if (interest) {\n          score += interest.interactionCount * 10;\n          \n          // Bonus for recent interactions (within last 5 minutes)\n          const timeSinceInteraction = Date.now() - new Date(interest.lastInteraction).getTime();\n          if (timeSinceInteraction < 300000) {\n            score += 20;\n          }\n        }\n      });\n\n      // Bonus for matching user's technical level\n      if (tutorial.difficulty === 'intermediate' && metrics.proficiencyLevel === 'intermediate') {\n        score += 15;\n      }\n      if (tutorial.difficulty === 'advanced' && metrics.proficiencyLevel === 'advanced') {\n        score += 25;\n      }\n\n      return { tutorial, score };\n    });\n\n    // Sort by score and return top recommendations\n    return scoredTutorials\n      .sort((a, b) => b.score - a.score)\n      .filter(item => item.score > 0) // Only return tutorials with some interest\n      .slice(0, 3) // Top 3 recommendations\n      .map(item => item.tutorial);\n  }, [session, calculateMetrics, checkPrerequisites]);\n\n  /**\n   * Unlock an advanced tutorial for the user\n   */\n  const unlockTutorial = useCallback((tutorialId: string) => {\n    if (!session) return;\n\n    const unlockedTutorials = session.unlockedTutorials || [];\n    \n    // Don't unlock if already unlocked\n    if (unlockedTutorials.includes(tutorialId)) return;\n\n    // Check prerequisites\n    if (!checkPrerequisites(tutorialId)) {\n      console.warn(`Cannot unlock tutorial ${tutorialId}: prerequisites not met`);\n      return;\n    }\n\n    const updatedSession = {\n      ...session,\n      unlockedTutorials: [...unlockedTutorials, tutorialId]\n    };\n\n    setSession(updatedSession);\n\n    // Track milestone\n    const updatedProgress = {\n      ...session.progress,\n      milestonesAchieved: [...session.progress.milestonesAchieved, `tutorial-unlocked-${tutorialId}`]\n    };\n\n    updateProgress(updatedProgress);\n\n    console.log(`Advanced tutorial unlocked: ${tutorialId}`);\n  }, [session, checkPrerequisites, updateProgress]);\n\n  /**\n   * Check if an advanced tutorial is unlocked\n   */\n  const isAdvancedTutorialUnlocked = useCallback((tutorialId: string): boolean => {\n    if (!session) return false;\n    const unlockedTutorials = session.unlockedTutorials || [];\n    return unlockedTutorials.includes(tutorialId);\n  }, [session]);\n\n  const currentStep = getNextStep();\n  const isOnboardingActive = session?.isActive || false;\n  const isOnboardingComplete = session?.completedAt != null;\n\n  return (\n    <OnboardingContext.Provider\n      value={{\n        session,\n        isOnboardingActive,\n        isOnboardingComplete,\n        currentPath,\n        currentStep,\n        startOnboarding,\n        completeStep,\n        skipStep,\n        pauseOnboarding,\n        resumeOnboarding,\n        completeOnboarding,\n        updateProgress,\n        trackInteraction,\n        updateUserProfile,\n        calculateMetrics,\n        getAdaptivePacing,\n        shouldModifyPath,\n        modifyPathForUser,\n        detectFeatureInterest,\n        checkPrerequisites,\n        getRecommendedTutorials,\n        unlockTutorial,\n        isAdvancedTutorialUnlocked,\n        getRecommendedPath,\n        canAccessStep,\n        getNextStep,\n        getPreviousStep\n      }}\n    >\n      {children}\n    </OnboardingContext.Provider>\n  );\n}\n\nexport function useOnboarding() {\n  const context = useContext(OnboardingContext);\n  if (!context) {\n    throw new Error(\"useOnboarding must be used within an OnboardingProvider\");\n  }\n  return context;\n}\n\n/**\n * Hook to check if user should see onboarding\n */\nexport function useShouldShowOnboarding(): boolean {\n  const { user, isAuthenticated } = useAuth();\n  const { isOnboardingComplete } = useOnboarding();\n  \n  // Show onboarding for new authenticated users who haven't completed it\n  return isAuthenticated && !!user && !isOnboardingComplete;\n}\n\n/**\n * Hook to get onboarding analytics data\n */\nexport function useOnboardingAnalytics() {\n  const { session } = useOnboarding();\n  \n  return {\n    timeSpent: session?.progress.timeSpent || 0,\n    stepsCompleted: session?.progress.stepsCompleted.length || 0,\n    completionRate: session?.progress.completionRate || 0,\n    interactions: session?.interactions || [],\n    userProfile: session?.userProfile\n  };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/onboarding/onboarding-config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/onboarding/onboarding-engine.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":105,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":105,"endColumn":24,"suggestions":[{"fix":{"range":[3124,3180],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":126,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3772,3775],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3772,3775],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":137,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":137,"endColumn":22,"suggestions":[{"fix":{"range":[4094,4158],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Onboarding Engine - Core state management for intelligent user onboarding\n */\n\nexport interface OnboardingStep {\n  id: string;\n  title: string;\n  description: string;\n  target?: string; // CSS selector for element\n  position?: 'top' | 'bottom' | 'left' | 'right' | 'center';\n  action?: 'click' | 'type' | 'select' | 'wait';\n  actionTarget?: string;\n  prerequisite?: string[];\n  skippable: boolean;\n  duration?: number; // seconds\n}\n\nexport interface OnboardingTutorial {\n  id: string;\n  name: string;\n  description: string;\n  uiVersion: 'original' | 'v2' | 'images-mvp';\n  steps: OnboardingStep[];\n  difficulty: 'beginner' | 'intermediate' | 'advanced';\n  estimatedDuration: number; // minutes\n}\n\nexport interface TutorialState {\n  tutorialId: string | null;\n  currentStepIndex: number;\n  status: 'idle' | 'active' | 'paused' | 'completed' | 'dismissed';\n  startTime: number | null;\n  completedSteps: Set<string>;\n  skippedSteps: Set<string>;\n  totalSteps: number;\n}\n\nexport interface OnboardingProgress {\n  userId: string;\n  uiVersion: string;\n  completedTutorials: string[];\n  activeTutorial: TutorialState | null;\n  unlockedFeatures: string[];\n  totalStepsCompleted: number;\n  totalStepsSkipped: number;\n  lastUpdated: number;\n}\n\nexport type OnboardingEvent =\n  | { type: 'tutorial:started'; tutorialId: string }\n  | { type: 'step:completed'; tutorialId: string; stepId: string }\n  | { type: 'step:skipped'; tutorialId: string; stepId: string }\n  | { type: 'tutorial:completed'; tutorialId: string; duration: number }\n  | { type: 'tutorial:dismissed'; tutorialId: string }\n  | { type: 'feature:unlocked'; featureId: string }\n  | { type: 'help:viewed'; helpId: string }\n  | { type: 'progress:updated'; progress: OnboardingProgress };\n\ntype EventListener = (event: OnboardingEvent) => void;\n\nexport class OnboardingEngine {\n  private userId: string;\n  private uiVersion: 'original' | 'v2' | 'images-mvp';\n  private listeners: Map<OnboardingEvent['type'], EventListener[]> = new Map();\n  private currentState: OnboardingProgress | null = null;\n\n  constructor(userId: string, uiVersion: 'original' | 'v2' | 'images-mvp') {\n    this.userId = userId;\n    this.uiVersion = uiVersion;\n    this.loadState();\n  }\n\n  /**\n   * Event subscription\n   */\n  on(eventType: OnboardingEvent['type'], listener: EventListener): () => void {\n    if (!this.listeners.has(eventType)) {\n      this.listeners.set(eventType, []);\n    }\n    this.listeners.get(eventType)!.push(listener);\n    return () => this.off(eventType, listener);\n  }\n\n  private off(\n    eventType: OnboardingEvent['type'],\n    listener: EventListener\n  ): void {\n    const listeners = this.listeners.get(eventType);\n    if (listeners) {\n      const index = listeners.indexOf(listener);\n      if (index > -1) {\n        listeners.splice(index, 1);\n      }\n    }\n  }\n\n  private emit(event: OnboardingEvent): void {\n    const listeners = this.listeners.get(event.type);\n    if (listeners) {\n      listeners.forEach(listener => {\n        try {\n          listener(event);\n        } catch (err) {\n          // Ensure a misbehaving listener doesn't break engine flow\n          console.error('[OnboardingEngine] Listener error', err);\n        }\n      });\n    }\n  }\n\n  /**\n   * State management\n   */\n  private loadState(): void {\n    const stored = localStorage.getItem(\n      `onboarding_${this.userId}_${this.uiVersion}`\n    );\n    if (stored) {\n      try {\n        // Parse and normalize persisted state. We need to convert any array\n        // representations of sets back into Set instances so the runtime\n        // behaves consistently across sessions and during tests.\n        const parsed = JSON.parse(stored) as OnboardingProgress;\n\n        if (parsed.activeTutorial) {\n          const at = parsed.activeTutorial as any;\n          if (Array.isArray(at.completedSteps)) {\n            at.completedSteps = new Set(at.completedSteps);\n          }\n          if (Array.isArray(at.skippedSteps)) {\n            at.skippedSteps = new Set(at.skippedSteps);\n          }\n        }\n\n        this.currentState = parsed;\n      } catch (error) {\n        console.error('[OnboardingEngine] Failed to load state', error);\n        this.initializeState();\n      }\n    } else {\n      this.initializeState();\n    }\n  }\n\n  private saveState(): void {\n    if (this.currentState) {\n      // Convert Sets to arrays for JSON serialization\n      const serializable = JSON.parse(JSON.stringify(this.currentState));\n\n      if (serializable.activeTutorial) {\n        if (this.currentState.activeTutorial?.completedSteps instanceof Set) {\n          serializable.activeTutorial.completedSteps = Array.from(\n            this.currentState.activeTutorial.completedSteps\n          );\n        }\n        if (this.currentState.activeTutorial?.skippedSteps instanceof Set) {\n          serializable.activeTutorial.skippedSteps = Array.from(\n            this.currentState.activeTutorial.skippedSteps\n          );\n        }\n      }\n\n      localStorage.setItem(\n        `onboarding_${this.userId}_${this.uiVersion}`,\n        JSON.stringify(serializable)\n      );\n      this.emit({ type: 'progress:updated', progress: this.currentState });\n    }\n  }\n\n  private initializeState(): void {\n    this.currentState = {\n      userId: this.userId,\n      uiVersion: this.uiVersion,\n      completedTutorials: [],\n      activeTutorial: null,\n      unlockedFeatures: [],\n      totalStepsCompleted: 0,\n      totalStepsSkipped: 0,\n      lastUpdated: Date.now(),\n    };\n    this.saveState();\n  }\n\n  /**\n   * Tutorial management\n   */\n  async startTutorial(tutorial: OnboardingTutorial): Promise<void> {\n    if (!this.currentState) {\n      this.initializeState();\n    }\n\n    const activeState: TutorialState = {\n      tutorialId: tutorial.id,\n      currentStepIndex: 0,\n      status: 'active',\n      startTime: Date.now(),\n      completedSteps: new Set(),\n      skippedSteps: new Set(),\n      totalSteps: tutorial.steps.length,\n    };\n\n    this.currentState!.activeTutorial = activeState;\n    this.saveState();\n    this.emit({ type: 'tutorial:started', tutorialId: tutorial.id });\n  }\n\n  async completeStep(tutorialId: string, stepId: string): Promise<void> {\n    if (!this.currentState?.activeTutorial) {\n      return;\n    }\n\n    this.currentState.activeTutorial.completedSteps.add(stepId);\n    this.currentState.activeTutorial.currentStepIndex++;\n    this.currentState.totalStepsCompleted++;\n    this.currentState.lastUpdated = Date.now();\n\n    // If we've completed all expected steps, auto-complete the tutorial\n    const total = this.currentState.activeTutorial.totalSteps;\n    if (\n      typeof total === 'number' &&\n      this.currentState.activeTutorial.completedSteps.size >= total\n    ) {\n      await this.completeTutorial(tutorialId);\n      return;\n    }\n\n    this.saveState();\n    this.emit({ type: 'step:completed', tutorialId, stepId });\n  }\n\n  async skipStep(tutorialId: string, stepId: string): Promise<void> {\n    if (!this.currentState?.activeTutorial) {\n      return;\n    }\n\n    this.currentState.activeTutorial.skippedSteps.add(stepId);\n    this.currentState.activeTutorial.currentStepIndex++;\n    this.currentState.totalStepsSkipped++;\n    this.currentState.lastUpdated = Date.now();\n\n    this.saveState();\n    this.emit({ type: 'step:skipped', tutorialId, stepId });\n  }\n\n  async completeTutorial(tutorialId: string): Promise<void> {\n    if (!this.currentState?.activeTutorial) {\n      return;\n    }\n\n    const duration = this.currentState.activeTutorial.startTime\n      ? (Date.now() - this.currentState.activeTutorial.startTime) / 1000\n      : 0;\n\n    this.currentState.completedTutorials.push(tutorialId);\n    this.currentState.activeTutorial = null;\n    this.currentState.lastUpdated = Date.now();\n\n    this.saveState();\n    this.emit({ type: 'tutorial:completed', tutorialId, duration });\n  }\n\n  async dismissTutorial(tutorialId: string): Promise<void> {\n    if (!this.currentState?.activeTutorial) {\n      return;\n    }\n\n    this.currentState.activeTutorial.status = 'dismissed';\n    this.currentState.activeTutorial = null;\n    this.currentState.lastUpdated = Date.now();\n\n    this.saveState();\n    this.emit({ type: 'tutorial:dismissed', tutorialId });\n  }\n\n  pauseTutorial(): void {\n    if (this.currentState?.activeTutorial) {\n      this.currentState.activeTutorial.status = 'paused';\n      this.saveState();\n    }\n  }\n\n  resumeTutorial(): void {\n    if (this.currentState?.activeTutorial) {\n      this.currentState.activeTutorial.status = 'active';\n      this.saveState();\n    }\n  }\n\n  /**\n   * Feature management\n   */\n  unlockFeature(featureId: string): void {\n    if (!this.currentState) {\n      this.initializeState();\n    }\n\n    if (!this.currentState!.unlockedFeatures.includes(featureId)) {\n      this.currentState!.unlockedFeatures.push(featureId);\n      this.saveState();\n      this.emit({ type: 'feature:unlocked', featureId });\n    }\n  }\n\n  isFeatureUnlocked(featureId: string): boolean {\n    return this.currentState?.unlockedFeatures.includes(featureId) ?? false;\n  }\n\n  /**\n   * Progress queries\n   */\n  getProgress(): OnboardingProgress | null {\n    return this.currentState;\n  }\n\n  isActiveTutorial(tutorialId: string): boolean {\n    return this.currentState?.activeTutorial?.tutorialId === tutorialId;\n  }\n\n  isTutorialCompleted(tutorialId: string): boolean {\n    return this.currentState?.completedTutorials.includes(tutorialId) ?? false;\n  }\n\n  getCompletionRate(): number {\n    if (!this.currentState) {\n      return 0;\n    }\n\n    const total =\n      this.currentState.totalStepsCompleted +\n      this.currentState.totalStepsSkipped;\n    if (total === 0) {\n      return 0;\n    }\n\n    return (this.currentState.totalStepsCompleted / total) * 100;\n  }\n\n  /**\n   * Reset and cleanup\n   */\n  resetProgress(): void {\n    this.initializeState();\n  }\n\n  resetTutorial(tutorialId: string): void {\n    if (this.currentState?.completedTutorials.includes(tutorialId)) {\n      this.currentState.completedTutorials =\n        this.currentState.completedTutorials.filter(id => id !== tutorialId);\n      this.saveState();\n    }\n  }\n\n  destroy(): void {\n    this.listeners.clear();\n    this.currentState = null;\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/onboarding/onboarding-events.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":62,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":62,"endColumn":24,"suggestions":[{"fix":{"range":[1497,1615],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":71,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":71,"endColumn":18,"suggestions":[{"fix":{"range":[1672,1738],"text":""},"messageId":"removeConsole","data":{"propertyName":"debug"},"desc":"Remove the console.debug()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Onboarding Events - Event bus for onboarding system\n */\n\nimport type { OnboardingEvent } from './onboarding-engine';\n\ntype EventListener = (event: OnboardingEvent) => void;\ntype EventUnsubscribe = () => void;\n\nexport class OnboardingEventBus {\n  private listeners: Map<OnboardingEvent['type'], Set<EventListener>> =\n    new Map();\n  private eventHistory: OnboardingEvent[] = [];\n  private maxHistorySize = 100;\n\n  /**\n   * Subscribe to an event type\n   */\n  on(\n    eventType: OnboardingEvent['type'],\n    listener: EventListener\n  ): EventUnsubscribe {\n    if (!this.listeners.has(eventType)) {\n      this.listeners.set(eventType, new Set());\n    }\n    this.listeners.get(eventType)!.add(listener);\n\n    // Return unsubscribe function\n    return () => this.off(eventType, listener);\n  }\n\n  /**\n   * Unsubscribe from an event type\n   */\n  private off(\n    eventType: OnboardingEvent['type'],\n    listener: EventListener\n  ): void {\n    const listeners = this.listeners.get(eventType);\n    if (listeners) {\n      listeners.delete(listener);\n    }\n  }\n\n  /**\n   * Emit an event\n   */\n  emit(event: OnboardingEvent): void {\n    // Add to history\n    this.eventHistory.push(event);\n    if (this.eventHistory.length > this.maxHistorySize) {\n      this.eventHistory.shift();\n    }\n\n    // Notify listeners\n    const listeners = this.listeners.get(event.type);\n    if (listeners) {\n      listeners.forEach(listener => {\n        try {\n          listener(event);\n        } catch (error) {\n          console.error(\n            `[OnboardingEventBus] Error in listener for ${event.type}:`,\n            error\n          );\n        }\n      });\n    }\n\n    // Log for debugging\n    console.debug('[OnboardingEventBus] Emitted:', event.type, event);\n  }\n\n  /**\n   * Emit multiple events\n   */\n  emitBatch(events: OnboardingEvent[]): void {\n    events.forEach(event => this.emit(event));\n  }\n\n  /**\n   * Once - subscribe to one-time event\n   */\n  once(\n    eventType: OnboardingEvent['type'],\n    listener: EventListener\n  ): EventUnsubscribe {\n    const wrappedListener = (event: OnboardingEvent) => {\n      if (event.type === eventType) {\n        this.off(eventType, wrappedListener);\n        listener(event);\n      }\n    };\n    return this.on(eventType, wrappedListener);\n  }\n\n  /**\n   * Wait for an event (promise-based)\n   */\n  waitFor(\n    eventType: OnboardingEvent['type'],\n    timeout = 5000\n  ): Promise<OnboardingEvent> {\n    // If the event already occurred, resolve immediately with the most recent\n    const existing = this.eventHistory.find(e => e.type === eventType);\n    if (existing) return Promise.resolve(existing);\n\n    return new Promise((resolve, reject) => {\n      const timeoutId = setTimeout(() => {\n        unsubscribe();\n        reject(new Error(`Timeout waiting for event: ${eventType}`));\n      }, timeout);\n\n      const unsubscribe = this.once(eventType, (event: OnboardingEvent) => {\n        clearTimeout(timeoutId);\n        resolve(event);\n      });\n    });\n  }\n\n  /**\n   * Get listener count for an event type\n   */\n  listenerCount(eventType: OnboardingEvent['type']): number {\n    return this.listeners.get(eventType)?.size ?? 0;\n  }\n\n  /**\n   * Get total listener count\n   */\n  totalListenerCount(): number {\n    let total = 0;\n    this.listeners.forEach(listeners => {\n      total += listeners.size;\n    });\n    return total;\n  }\n\n  /**\n   * Clear all listeners for an event type\n   */\n  clear(eventType: OnboardingEvent['type']): void {\n    this.listeners.delete(eventType);\n  }\n\n  /**\n   * Clear all listeners\n   */\n  clearAll(): void {\n    this.listeners.clear();\n  }\n\n  /**\n   * Get event history\n   */\n  getHistory(): OnboardingEvent[] {\n    return [...this.eventHistory];\n  }\n\n  /**\n   * Get events by type from history\n   */\n  getHistoryByType(eventType: OnboardingEvent['type']): OnboardingEvent[] {\n    return this.eventHistory.filter(event => event.type === eventType);\n  }\n\n  /**\n   * Clear event history\n   */\n  clearHistory(): void {\n    this.eventHistory = [];\n  }\n}\n\nexport const onboardingEventBus = new OnboardingEventBus();\n\n/**\n * Convenience functions for common event patterns\n */\nexport const emitTutorialStarted = (tutorialId: string): void => {\n  onboardingEventBus.emit({ type: 'tutorial:started', tutorialId });\n};\n\nexport const emitStepCompleted = (tutorialId: string, stepId: string): void => {\n  onboardingEventBus.emit({ type: 'step:completed', tutorialId, stepId });\n};\n\nexport const emitStepSkipped = (tutorialId: string, stepId: string): void => {\n  onboardingEventBus.emit({ type: 'step:skipped', tutorialId, stepId });\n};\n\nexport const emitTutorialCompleted = (\n  tutorialId: string,\n  duration: number\n): void => {\n  onboardingEventBus.emit({ type: 'tutorial:completed', tutorialId, duration });\n};\n\nexport const emitTutorialDismissed = (tutorialId: string): void => {\n  onboardingEventBus.emit({ type: 'tutorial:dismissed', tutorialId });\n};\n\nexport const emitFeatureUnlocked = (featureId: string): void => {\n  onboardingEventBus.emit({ type: 'feature:unlocked', featureId });\n};\n\nexport const emitHelpViewed = (helpId: string): void => {\n  onboardingEventBus.emit({ type: 'help:viewed', helpId });\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/onboarding/onboarding-storage.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":23,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":23,"endColumn":20,"suggestions":[{"fix":{"range":[623,723],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":35,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":35,"endColumn":20,"suggestions":[{"fix":{"range":[903,977],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":44,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":44,"endColumn":20,"suggestions":[{"fix":{"range":[1177,1280],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":55,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":55,"endColumn":20,"suggestions":[{"fix":{"range":[1391,1464],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":69,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":69,"endColumn":20,"suggestions":[{"fix":{"range":[1768,1870],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":81,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":81,"endColumn":20,"suggestions":[{"fix":{"range":[2052,2152],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":93,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":93,"endColumn":20,"suggestions":[{"fix":{"range":[2354,2459],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":104,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":104,"endColumn":20,"suggestions":[{"fix":{"range":[2572,2671],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userId' is defined but never used. Allowed unused args must match /^_/u.","line":196,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":196,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userId' is defined but never used. Allowed unused args must match /^_/u.","line":200,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":200,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Onboarding Storage - Abstraction layer for persistence\n */\n\nimport type { OnboardingProgress, TutorialState } from './onboarding-engine';\n\nexport interface StorageAdapter {\n  get<T>(key: string): Promise<T | null>;\n  set<T>(key: string, value: T): Promise<void>;\n  remove(key: string): Promise<void>;\n  clear(): Promise<void>;\n}\n\nexport class LocalStorageAdapter implements StorageAdapter {\n  async get<T>(key: string): Promise<T | null> {\n    try {\n      const item = localStorage.getItem(key);\n      if (item === null) {\n        return null;\n      }\n      return JSON.parse(item) as T;\n    } catch (error) {\n      console.error(\n        '[OnboardingStorage] Failed to get from localStorage',\n        error\n      );\n      return null;\n    }\n  }\n\n  async set<T>(key: string, value: T): Promise<void> {\n    try {\n      localStorage.setItem(key, JSON.stringify(value));\n    } catch (error) {\n      console.error('[OnboardingStorage] Failed to set to localStorage', error);\n      throw new Error('Storage quota exceeded or storage disabled');\n    }\n  }\n\n  async remove(key: string): Promise<void> {\n    try {\n      localStorage.removeItem(key);\n    } catch (error) {\n      console.error(\n        '[OnboardingStorage] Failed to remove from localStorage',\n        error\n      );\n    }\n  }\n\n  async clear(): Promise<void> {\n    try {\n      localStorage.clear();\n    } catch (error) {\n      console.error('[OnboardingStorage] Failed to clear localStorage', error);\n    }\n  }\n}\n\nexport class SessionStorageAdapter implements StorageAdapter {\n  async get<T>(key: string): Promise<T | null> {\n    try {\n      const item = sessionStorage.getItem(key);\n      if (item === null) {\n        return null;\n      }\n      return JSON.parse(item) as T;\n    } catch (error) {\n      console.error(\n        '[OnboardingStorage] Failed to get from sessionStorage',\n        error\n      );\n      return null;\n    }\n  }\n\n  async set<T>(key: string, value: T): Promise<void> {\n    try {\n      sessionStorage.setItem(key, JSON.stringify(value));\n    } catch (error) {\n      console.error(\n        '[OnboardingStorage] Failed to set to sessionStorage',\n        error\n      );\n      throw new Error('Storage quota exceeded or storage disabled');\n    }\n  }\n\n  async remove(key: string): Promise<void> {\n    try {\n      sessionStorage.removeItem(key);\n    } catch (error) {\n      console.error(\n        '[OnboardingStorage] Failed to remove from sessionStorage',\n        error\n      );\n    }\n  }\n\n  async clear(): Promise<void> {\n    try {\n      sessionStorage.clear();\n    } catch (error) {\n      console.error(\n        '[OnboardingStorage] Failed to clear sessionStorage',\n        error\n      );\n    }\n  }\n}\n\nexport class OnboardingStorage {\n  private localStorage: LocalStorageAdapter;\n  private sessionStorage: SessionStorageAdapter;\n\n  constructor() {\n    this.localStorage = new LocalStorageAdapter();\n    this.sessionStorage = new SessionStorageAdapter();\n  }\n\n  /**\n   * Get onboarding progress (persistent)\n   */\n  async getProgress(\n    userId: string,\n    uiVersion: string\n  ): Promise<OnboardingProgress | null> {\n    const key = `onboarding_${userId}_${uiVersion}`;\n    return this.localStorage.get<OnboardingProgress>(key);\n  }\n\n  async setProgress(\n    userId: string,\n    uiVersion: string,\n    progress: OnboardingProgress\n  ): Promise<void> {\n    const key = `onboarding_${userId}_${uiVersion}`;\n    return this.localStorage.set(key, progress);\n  }\n\n  /**\n   * Get active tutorial state (session-only)\n   */\n  async getActiveTutorial(): Promise<TutorialState | null> {\n    return this.sessionStorage.get<TutorialState>('active_tutorial');\n  }\n\n  async setActiveTutorial(state: TutorialState | null): Promise<void> {\n    if (state === null) {\n      return this.sessionStorage.remove('active_tutorial');\n    }\n    return this.sessionStorage.set('active_tutorial', state);\n  }\n\n  /**\n   * User preferences (persistent)\n   */\n  async getPreferences<T>(userId: string, key: string): Promise<T | null> {\n    const storageKey = `onboarding_prefs_${userId}_${key}`;\n    return this.localStorage.get<T>(storageKey);\n  }\n\n  async setPreferences<T>(\n    userId: string,\n    key: string,\n    value: T\n  ): Promise<void> {\n    const storageKey = `onboarding_prefs_${userId}_${key}`;\n    return this.localStorage.set(storageKey, value);\n  }\n\n  /**\n   * Skip preferences (persistent)\n   */\n  async getSkipPreferences(\n    userId: string,\n    tutorialId: string\n  ): Promise<boolean> {\n    const key = `onboarding_skip_${userId}_${tutorialId}`;\n    const value = await this.localStorage.get<string>(key);\n    return value === 'true';\n  }\n\n  async setSkipPreferences(\n    userId: string,\n    tutorialId: string,\n    skipped: boolean\n  ): Promise<void> {\n    const key = `onboarding_skip_${userId}_${tutorialId}`;\n    return this.localStorage.set(key, skipped ? 'true' : 'false');\n  }\n\n  /**\n   * Cleanup\n   */\n  async clearUserSession(userId: string): Promise<void> {\n    await this.sessionStorage.remove('active_tutorial');\n  }\n\n  async clearAllUser(userId: string): Promise<void> {\n    // In a real implementation, we'd need to track all keys for this user\n    // For now, this is a placeholder\n    await this.sessionStorage.clear();\n  }\n}\n\nexport const onboardingStorage = new OnboardingStorage();\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/pricing.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/queryClient.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/responsive.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/results-organization.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[841,844],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[841,844],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":180,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":180,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4679,4682],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4679,4682],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":198,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":198,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5192,5195],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5192,5195],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":210,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":210,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5493,5496],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5493,5496],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":219,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":219,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5756,5759],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5756,5759],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":259,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":259,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6900,6903],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6900,6903],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":385,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":385,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10005,10008],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10005,10008],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":388,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":388,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10101,10104],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10101,10104],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Results Organization System\n * \n * Provides organized results visualization with:\n * - Results categorization and sectioning\n * - Search and filtering functionality\n * - Export to multiple formats (JSON, CSV, PDF)\n * \n * Validates: Requirements 2.5, 5.6\n */\n\n// Section categories for organizing metadata results\nexport type SectionCategory = \n  | 'file_info'\n  | 'integrity'\n  | 'forensic'\n  | 'camera'\n  | 'location'\n  | 'technical'\n  | 'timestamps'\n  | 'advanced'\n  | 'other';\n\nexport interface MetadataSection {\n  id: string;\n  category: SectionCategory;\n  title: string;\n  description: string;\n  icon: string;\n  priority: number; // Lower = higher priority (shown first)\n  fields: MetadataField[];\n  isCollapsible: boolean;\n  defaultExpanded: boolean;\n}\n\nexport interface MetadataField {\n  key: string;\n  label: string;\n  value: any;\n  formattedValue: string;\n  category: SectionCategory;\n  isLocked: boolean;\n  isCopyable: boolean;\n  description?: string;\n  searchableText: string;\n}\n\nexport interface SearchFilter {\n  query: string;\n  categories: SectionCategory[];\n  showLocked: boolean;\n  showEmpty: boolean;\n}\n\nexport interface OrganizedResults {\n  sections: MetadataSection[];\n  totalFields: number;\n  visibleFields: number;\n  lockedFields: number;\n  searchMatches: number;\n}\n\nexport type ExportFormat = 'json' | 'csv' | 'pdf';\n\nexport interface ExportOptions {\n  format: ExportFormat;\n  includeLockedFields: boolean;\n  includeSectionHeaders: boolean;\n  filename?: string;\n}\n\nexport interface ExportResult {\n  success: boolean;\n  format: ExportFormat;\n  filename: string;\n  data: string | Blob;\n  mimeType: string;\n  size: number;\n}\n\n// Section configuration with metadata\nconst SECTION_CONFIG: Record<SectionCategory, { title: string; description: string; icon: string; priority: number }> = {\n  file_info: {\n    title: 'File Information',\n    description: 'Basic file properties and identification',\n    icon: 'FileText',\n    priority: 1,\n  },\n  integrity: {\n    title: 'File Integrity',\n    description: 'Cryptographic hashes and verification data',\n    icon: 'Hash',\n    priority: 2,\n  },\n  forensic: {\n    title: 'Forensic Evidence',\n    description: 'Chain of custody and authenticity indicators',\n    icon: 'ShieldCheck',\n    priority: 3,\n  },\n  camera: {\n    title: 'Camera & EXIF',\n    description: 'Camera settings and capture information',\n    icon: 'Camera',\n    priority: 4,\n  },\n  location: {\n    title: 'GPS Location',\n    description: 'Geographic coordinates and location data',\n    icon: 'MapPin',\n    priority: 5,\n  },\n  timestamps: {\n    title: 'Timestamps',\n    description: 'Creation, modification, and access times',\n    icon: 'Calendar',\n    priority: 6,\n  },\n  technical: {\n    title: 'Technical Metadata',\n    description: 'IPTC, XMP, ICC profiles, and vendor data',\n    icon: 'Tag',\n    priority: 7,\n  },\n  advanced: {\n    title: 'Advanced Analysis',\n    description: 'AI detection, steganography, and manipulation analysis',\n    icon: 'Eye',\n    priority: 8,\n  },\n  other: {\n    title: 'Other Metadata',\n    description: 'Additional extracted metadata fields',\n    icon: 'Database',\n    priority: 9,\n  },\n};\n\n// Field categorization rules\nconst FIELD_CATEGORY_RULES: Array<{ pattern: RegExp; category: SectionCategory }> = [\n  { pattern: /^(filename|filesize|filetype|mime_type|file_size|file_name)$/i, category: 'file_info' },\n  { pattern: /^(md5|sha256|sha1|hash|checksum|integrity)/i, category: 'integrity' },\n  { pattern: /(forensic|authenticity|manipulation|chain_of_custody)/i, category: 'forensic' },\n  { pattern: /(camera|make|model|lens|aperture|shutter|iso|focal|exposure|flash|white_balance)/i, category: 'camera' },\n  { pattern: /(gps|latitude|longitude|altitude|location|coordinates|map)/i, category: 'location' },\n  { pattern: /(date|time|created|modified|accessed|timestamp)/i, category: 'timestamps' },\n  { pattern: /(iptc|xmp|icc|makernote|interop|thumbnail|namespace)/i, category: 'technical' },\n  { pattern: /(ai_|steganography|manipulation_detection|hidden_data)/i, category: 'advanced' },\n];\n\n/**\n * Categorize a field based on its key\n */\nexport function categorizeField(key: string): SectionCategory {\n  const lowerKey = key.toLowerCase();\n  \n  for (const rule of FIELD_CATEGORY_RULES) {\n    if (rule.pattern.test(lowerKey)) {\n      return rule.category;\n    }\n  }\n  \n  return 'other';\n}\n\n/**\n * Format a field label for display\n */\nexport function formatFieldLabel(key: string): string {\n  return key\n    .replace(/_/g, ' ')\n    .replace(/([a-z])([A-Z])/g, '$1 $2')\n    .replace(/\\b\\w/g, c => c.toUpperCase())\n    .trim();\n}\n\n/**\n * Format a field value for display\n */\nexport function formatFieldValue(value: any): string {\n  if (value === null || value === undefined) return 'N/A';\n  if (Array.isArray(value)) return value.join(', ');\n  if (typeof value === 'object') {\n    if (value instanceof Date) return value.toISOString();\n    if (value.rawValue !== undefined) return String(value.rawValue);\n    try {\n      return JSON.stringify(value);\n    } catch {\n      return '[Complex Object]';\n    }\n  }\n  return String(value);\n}\n\n/**\n * Check if a field value indicates it's locked\n */\nexport function isFieldLocked(value: any): boolean {\n  if (typeof value === 'string') {\n    return value === 'LOCKED' || \n           value === 'LOCKED_UPGRADE_TO_VIEW' || \n           value.startsWith('LOCKED');\n  }\n  return false;\n}\n\n/**\n * Create searchable text from a field\n */\nexport function createSearchableText(key: string, value: any): string {\n  const formattedValue = formatFieldValue(value);\n  return `${key} ${formatFieldLabel(key)} ${formattedValue}`.toLowerCase();\n}\n\n/**\n * Convert raw metadata to organized MetadataField array\n */\nexport function extractFields(\n  data: Record<string, any>,\n  prefix: string = ''\n): MetadataField[] {\n  const fields: MetadataField[] = [];\n  \n  if (!data || typeof data !== 'object') return fields;\n  \n  for (const [key, value] of Object.entries(data)) {\n    // Skip internal/private fields\n    if (key.startsWith('_') || key === 'data_base64') continue;\n    \n    const fullKey = prefix ? `${prefix}.${key}` : key;\n    \n    // Recursively handle nested objects (but not arrays)\n    if (value && typeof value === 'object' && !Array.isArray(value) && !(value instanceof Date)) {\n      fields.push(...extractFields(value, fullKey));\n    } else {\n      const category = categorizeField(fullKey);\n      const locked = isFieldLocked(value);\n      \n      fields.push({\n        key: fullKey,\n        label: formatFieldLabel(key),\n        value,\n        formattedValue: formatFieldValue(value),\n        category,\n        isLocked: locked,\n        isCopyable: !locked && typeof value !== 'object',\n        searchableText: createSearchableText(fullKey, value),\n      });\n    }\n  }\n  \n  return fields;\n}\n\n/**\n * Organize metadata into sections\n */\nexport function organizeMetadata(\n  metadata: Record<string, any>,\n  filter?: SearchFilter\n): OrganizedResults {\n  // Extract all fields from metadata\n  const allFields = extractFields(metadata);\n  \n  // Apply search filter\n  let filteredFields = allFields;\n  let searchMatches = allFields.length;\n  \n  if (filter) {\n    filteredFields = allFields.filter(field => {\n      // Category filter\n      if (filter.categories.length > 0 && !filter.categories.includes(field.category)) {\n        return false;\n      }\n      \n      // Locked filter\n      if (!filter.showLocked && field.isLocked) {\n        return false;\n      }\n      \n      // Empty filter\n      if (!filter.showEmpty && (field.value === null || field.value === undefined || field.value === '')) {\n        return false;\n      }\n      \n      // Search query\n      if (filter.query && filter.query.trim()) {\n        const queryLower = filter.query.trim().toLowerCase();\n        if (!field.searchableText.includes(queryLower)) {\n          return false;\n        }\n      }\n      \n      return true;\n    });\n    \n    searchMatches = filteredFields.length;\n  }\n  \n  // Group fields by category\n  const fieldsByCategory = new Map<SectionCategory, MetadataField[]>();\n  \n  for (const field of filteredFields) {\n    const existing = fieldsByCategory.get(field.category) || [];\n    existing.push(field);\n    fieldsByCategory.set(field.category, existing);\n  }\n  \n  // Create sections\n  const sections: MetadataSection[] = [];\n  \n  for (const [category, fields] of fieldsByCategory) {\n    const config = SECTION_CONFIG[category];\n    \n    sections.push({\n      id: category,\n      category,\n      title: config.title,\n      description: config.description,\n      icon: config.icon,\n      priority: config.priority,\n      fields,\n      isCollapsible: true,\n      defaultExpanded: config.priority <= 5, // Expand high-priority sections by default\n    });\n  }\n  \n  // Sort sections by priority\n  sections.sort((a, b) => a.priority - b.priority);\n  \n  // Calculate totals\n  const totalFields = allFields.length;\n  const visibleFields = filteredFields.length;\n  const lockedFields = allFields.filter(f => f.isLocked).length;\n  \n  return {\n    sections,\n    totalFields,\n    visibleFields,\n    lockedFields,\n    searchMatches,\n  };\n}\n\n/**\n * Search within organized results\n */\nexport function searchResults(\n  results: OrganizedResults,\n  query: string\n): OrganizedResults {\n  if (!query.trim()) return results;\n  \n  const queryLower = query.toLowerCase();\n  \n  const filteredSections = results.sections\n    .map(section => ({\n      ...section,\n      fields: section.fields.filter(field => \n        field.searchableText.includes(queryLower)\n      ),\n    }))\n    .filter(section => section.fields.length > 0);\n  \n  const searchMatches = filteredSections.reduce(\n    (sum, section) => sum + section.fields.length,\n    0\n  );\n  \n  return {\n    ...results,\n    sections: filteredSections,\n    visibleFields: searchMatches,\n    searchMatches,\n  };\n}\n\n/**\n * Export results to JSON format\n */\nexport function exportToJSON(\n  results: OrganizedResults,\n  options: ExportOptions\n): ExportResult {\n  const exportData: Record<string, any> = {};\n  \n  for (const section of results.sections) {\n    const sectionData: Record<string, any> = {};\n    \n    for (const field of section.fields) {\n      if (!options.includeLockedFields && field.isLocked) continue;\n      sectionData[field.key] = field.value;\n    }\n    \n    if (Object.keys(sectionData).length > 0) {\n      if (options.includeSectionHeaders) {\n        exportData[section.title] = sectionData;\n      } else {\n        Object.assign(exportData, sectionData);\n      }\n    }\n  }\n  \n  const jsonString = JSON.stringify(exportData, null, 2);\n  const filename = options.filename || `metadata_export_${Date.now()}.json`;\n  \n  return {\n    success: true,\n    format: 'json',\n    filename,\n    data: jsonString,\n    mimeType: 'application/json',\n    size: new Blob([jsonString]).size,\n  };\n}\n\n/**\n * Export results to CSV format\n */\nexport function exportToCSV(\n  results: OrganizedResults,\n  options: ExportOptions\n): ExportResult {\n  const rows: string[][] = [];\n  \n  // Header row\n  if (options.includeSectionHeaders) {\n    rows.push(['Section', 'Field', 'Value']);\n  } else {\n    rows.push(['Field', 'Value']);\n  }\n  \n  // Data rows\n  for (const section of results.sections) {\n    for (const field of section.fields) {\n      if (!options.includeLockedFields && field.isLocked) continue;\n      \n      // Escape CSV values\n      const escapedValue = field.formattedValue\n        .replace(/\"/g, '\"\"')\n        .replace(/\\n/g, ' ');\n      \n      if (options.includeSectionHeaders) {\n        rows.push([section.title, field.label, `\"${escapedValue}\"`]);\n      } else {\n        rows.push([field.label, `\"${escapedValue}\"`]);\n      }\n    }\n  }\n  \n  const csvString = rows.map(row => row.join(',')).join('\\n');\n  const filename = options.filename || `metadata_export_${Date.now()}.csv`;\n  \n  return {\n    success: true,\n    format: 'csv',\n    filename,\n    data: csvString,\n    mimeType: 'text/csv',\n    size: new Blob([csvString]).size,\n  };\n}\n\n/**\n * Export results to PDF format (generates HTML for PDF conversion)\n */\nexport function exportToPDF(\n  results: OrganizedResults,\n  options: ExportOptions\n): ExportResult {\n  // Generate HTML content for PDF\n  let html = `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <title>Metadata Export Report</title>\n  <style>\n    body { font-family: Arial, sans-serif; margin: 40px; color: #333; }\n    h1 { color: #2563eb; border-bottom: 2px solid #2563eb; padding-bottom: 10px; }\n    h2 { color: #1e40af; margin-top: 30px; }\n    .section { margin-bottom: 30px; }\n    .field { display: flex; padding: 8px 0; border-bottom: 1px solid #e5e7eb; }\n    .field-label { font-weight: 600; width: 40%; color: #4b5563; }\n    .field-value { width: 60%; word-break: break-word; }\n    .locked { color: #9ca3af; font-style: italic; }\n    .summary { background: #f3f4f6; padding: 20px; border-radius: 8px; margin-bottom: 30px; }\n    .summary-item { display: inline-block; margin-right: 30px; }\n    .summary-label { font-size: 12px; color: #6b7280; }\n    .summary-value { font-size: 24px; font-weight: bold; color: #2563eb; }\n    @media print { body { margin: 20px; } }\n  </style>\n</head>\n<body>\n  <h1>Metadata Export Report</h1>\n  <div class=\"summary\">\n    <div class=\"summary-item\">\n      <div class=\"summary-label\">Total Fields</div>\n      <div class=\"summary-value\">${results.totalFields}</div>\n    </div>\n    <div class=\"summary-item\">\n      <div class=\"summary-label\">Visible Fields</div>\n      <div class=\"summary-value\">${results.visibleFields}</div>\n    </div>\n    <div class=\"summary-item\">\n      <div class=\"summary-label\">Sections</div>\n      <div class=\"summary-value\">${results.sections.length}</div>\n    </div>\n  </div>\n`;\n\n  for (const section of results.sections) {\n    const visibleFields = options.includeLockedFields \n      ? section.fields \n      : section.fields.filter(f => !f.isLocked);\n    \n    if (visibleFields.length === 0) continue;\n    \n    html += `\n  <div class=\"section\">\n    <h2>${section.title}</h2>\n    <p style=\"color: #6b7280; font-size: 14px;\">${section.description}</p>\n`;\n    \n    for (const field of visibleFields) {\n      const valueClass = field.isLocked ? 'field-value locked' : 'field-value';\n      html += `\n    <div class=\"field\">\n      <div class=\"field-label\">${field.label}</div>\n      <div class=\"${valueClass}\">${field.isLocked ? '[Locked]' : escapeHtml(field.formattedValue)}</div>\n    </div>\n`;\n    }\n    \n    html += `  </div>\\n`;\n  }\n  \n  html += `\n  <footer style=\"margin-top: 40px; padding-top: 20px; border-top: 1px solid #e5e7eb; color: #9ca3af; font-size: 12px;\">\n    Generated on ${new Date().toISOString()}\n  </footer>\n</body>\n</html>\n`;\n\n  const filename = options.filename || `metadata_export_${Date.now()}.html`;\n  \n  return {\n    success: true,\n    format: 'pdf',\n    filename,\n    data: html,\n    mimeType: 'text/html',\n    size: new Blob([html]).size,\n  };\n}\n\n/**\n * Escape HTML special characters\n */\nfunction escapeHtml(text: string): string {\n  const map: Record<string, string> = {\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;',\n    '\"': '&quot;',\n    \"'\": '&#039;',\n  };\n  return text.replace(/[&<>\"']/g, m => map[m]);\n}\n\n/**\n * Export results in the specified format\n */\nexport function exportResults(\n  results: OrganizedResults,\n  options: ExportOptions\n): ExportResult {\n  switch (options.format) {\n    case 'json':\n      return exportToJSON(results, options);\n    case 'csv':\n      return exportToCSV(results, options);\n    case 'pdf':\n      return exportToPDF(results, options);\n    default:\n      return {\n        success: false,\n        format: options.format,\n        filename: '',\n        data: '',\n        mimeType: '',\n        size: 0,\n      };\n  }\n}\n\n/**\n * Download export result as a file\n */\nexport function downloadExport(result: ExportResult): void {\n  if (!result.success) return;\n  \n  const blob = typeof result.data === 'string' \n    ? new Blob([result.data], { type: result.mimeType })\n    : result.data;\n  \n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = result.filename;\n  document.body.appendChild(a);\n  a.click();\n  document.body.removeChild(a);\n  URL.revokeObjectURL(url);\n}\n\n/**\n * Get available export formats\n */\nexport function getAvailableExportFormats(): ExportFormat[] {\n  return ['json', 'csv', 'pdf'];\n}\n\n/**\n * Check if an export format is available\n */\nexport function isExportFormatAvailable(format: ExportFormat): boolean {\n  return getAvailableExportFormats().includes(format);\n}\n\n/**\n * Get export format metadata\n */\nexport function getExportFormatInfo(format: ExportFormat): { \n  name: string; \n  description: string; \n  mimeType: string; \n  extension: string;\n} {\n  const formats: Record<ExportFormat, { name: string; description: string; mimeType: string; extension: string }> = {\n    json: {\n      name: 'JSON',\n      description: 'JavaScript Object Notation - machine-readable format',\n      mimeType: 'application/json',\n      extension: '.json',\n    },\n    csv: {\n      name: 'CSV',\n      description: 'Comma-Separated Values - spreadsheet compatible',\n      mimeType: 'text/csv',\n      extension: '.csv',\n    },\n    pdf: {\n      name: 'PDF',\n      description: 'Portable Document Format - printable report',\n      mimeType: 'application/pdf',\n      extension: '.pdf',\n    },\n  };\n  \n  return formats[format];\n}\n\n/**\n * Get all section categories\n */\nexport function getAllCategories(): SectionCategory[] {\n  return Object.keys(SECTION_CONFIG) as SectionCategory[];\n}\n\n/**\n * Get section configuration\n */\nexport function getSectionConfig(category: SectionCategory) {\n  return SECTION_CONFIG[category];\n}\n\n/**\n * Create default search filter\n */\nexport function createDefaultFilter(): SearchFilter {\n  return {\n    query: '',\n    categories: [],\n    showLocked: true,\n    showEmpty: false,\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/sample-files/sample-analytics.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'rateSampleFile' is defined but never used.","line":5,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":44},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":35,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":35,"endColumn":16,"suggestions":[{"fix":{"range":[878,923],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":55,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":55,"endColumn":18,"suggestions":[{"fix":{"range":[1321,1392],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":214,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":214,"endColumn":14,"suggestions":[{"fix":{"range":[5191,5244],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Sample Analytics - Track sample file usage and metrics\n */\n\nimport { getSampleAnalytics, rateSampleFile } from './sample-loader';\n\nexport interface SampleMetrics {\n  totalLoads: number;\n  totalSamples: number;\n  averageLoadTime: number;\n  completionRate: number;\n  topCategories: Array<{ category: string; count: number }>;\n  topSamples: Array<{\n    sampleId: string;\n    loadCount: number;\n    averageRating?: number;\n  }>;\n}\n\nexport interface SampleCompletionEvent {\n  sampleId: string;\n  completed: boolean;\n  timeSpent: number; // milliseconds\n  completedSteps: number;\n  totalSteps: number;\n}\n\n/**\n * Initialize sample analytics tracking\n */\nexport function initializeSampleAnalytics(): void {\n  // Initialize storage if not present\n  if (!localStorage.getItem('sample_analytics_initialized')) {\n    localStorage.setItem('sample_analytics_initialized', 'true');\n    console.log('[SampleAnalytics] Initialized');\n  }\n}\n\n/**\n * Record sample completion event\n */\nexport function recordSampleCompletion(event: SampleCompletionEvent): void {\n  try {\n    const events = getCompletionEvents();\n    events.push({\n      ...event,\n      timestamp: Date.now(),\n    });\n\n    localStorage.setItem(\n      'sample_completion_events',\n      JSON.stringify(events.slice(-100))\n    ); // Keep last 100\n  } catch (error) {\n    console.error('[SampleAnalytics] Failed to record completion:', error);\n  }\n}\n\n/**\n * Get completion events\n */\nfunction getCompletionEvents(): Array<\n  SampleCompletionEvent & { timestamp: number }\n> {\n  try {\n    const stored = localStorage.getItem('sample_completion_events');\n    return stored ? JSON.parse(stored) : [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get overall sample metrics\n */\nexport function getSampleMetrics(): SampleMetrics {\n  const completionEvents = getCompletionEvents();\n  const sampleAnalytics = getAllSampleAnalytics();\n\n  const totalLoads = completionEvents.length;\n  const averageLoadTime =\n    totalLoads > 0\n      ? completionEvents.reduce((sum, event) => sum + event.timeSpent, 0) /\n        totalLoads\n      : 0;\n\n  const completions = completionEvents.filter(e => e.completed);\n  const completionRate =\n    totalLoads > 0 ? (completions.length / totalLoads) * 100 : 0;\n\n  // Category breakdown\n  const categoryCounts = new Map<string, number>();\n  completionEvents.forEach(event => {\n    // In a real implementation, we'd need to fetch the sample to get its category\n    // For now, we'll count by sample ID\n    const count = categoryCounts.get(event.sampleId) || 0;\n    categoryCounts.set(event.sampleId, count + 1);\n  });\n\n  const topCategories = Array.from(categoryCounts.entries())\n    .map(([category, count]) => ({ category, count }))\n    .sort((a, b) => b.count - a.count)\n    .slice(0, 5);\n\n  return {\n    totalLoads,\n    totalSamples: sampleAnalytics.length,\n    averageLoadTime,\n    completionRate,\n    topCategories,\n    topSamples: sampleAnalytics.slice(0, 5),\n  };\n}\n\n/**\n * Get all sample analytics\n */\nfunction getAllSampleAnalytics(): Array<{\n  sampleId: string;\n  loadCount: number;\n  lastLoaded: number;\n  averageRating?: number;\n}> {\n  const analytics: Array<{\n    sampleId: string;\n    loadCount: number;\n    lastLoaded: number;\n    averageRating?: number;\n  }> = [];\n\n  for (let i = 0; i < localStorage.length; i++) {\n    const key = localStorage.key(i);\n    if (key && key.startsWith('sample_analytics_')) {\n      const sampleId = key.replace('sample_analytics_', '');\n      const data = getSampleAnalytics(sampleId);\n      if (data) {\n        analytics.push(data);\n      }\n    }\n  }\n\n  return analytics.sort((a, b) => b.loadCount - a.loadCount);\n}\n\n/**\n * Get user proficiency level based on sample usage\n */\nexport function getUserProficiencyLevel():\n  | 'beginner'\n  | 'intermediate'\n  | 'advanced' {\n  const metrics = getSampleMetrics();\n\n  if (metrics.totalLoads < 5) {\n    return 'beginner';\n  }\n\n  if (metrics.totalLoads < 15 || metrics.completionRate < 70) {\n    return 'intermediate';\n  }\n\n  return 'advanced';\n}\n\n/**\n * Get sample difficulty progression\n */\nexport function getDifficultyProgression(): {\n  beginner: number;\n  intermediate: number;\n  advanced: number;\n} {\n  const completionEvents = getCompletionEvents();\n  const progression = {\n    beginner: 0,\n    intermediate: 0,\n    advanced: 0,\n  };\n\n  completionEvents.forEach(event => {\n    // In a real implementation, we'd look up the sample's difficulty\n    // For now, we'll use completion rate as proxy\n    if (event.completed) {\n      if (event.totalSteps > 8) {\n        progression.advanced++;\n      } else if (event.totalSteps > 5) {\n        progression.intermediate++;\n      } else {\n        progression.beginner++;\n      }\n    }\n  });\n\n  return progression;\n}\n\n/**\n * Reset sample analytics\n */\nexport function resetSampleAnalytics(): void {\n  const keysToRemove: string[] = [];\n\n  for (let i = 0; i < localStorage.length; i++) {\n    const key = localStorage.key(i);\n    if (key?.startsWith('sample_analytics_')) {\n      keysToRemove.push(key);\n    }\n  }\n\n  keysToRemove.forEach(key => localStorage.removeItem(key));\n  localStorage.removeItem('sample_completion_events');\n  localStorage.removeItem('sample_analytics_initialized');\n\n  console.log('[SampleAnalytics] Reset all analytics');\n}\n\n/**\n * Export analytics as JSON\n */\nexport function exportAnalytics(): string {\n  const metrics = getSampleMetrics();\n  const completionEvents = getCompletionEvents();\n\n  return JSON.stringify(\n    {\n      metrics,\n      completionEvents,\n      exportedAt: new Date().toISOString(),\n    },\n    null,\n    2\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/sample-files/sample-library.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/sample-files/sample-loader.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loadTime' is defined but never used. Allowed unused args must match /^_/u.","line":94,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":94,"endColumn":52},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":113,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":113,"endColumn":18,"suggestions":[{"fix":{"range":[2383,2451],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":146,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":146,"endColumn":18,"suggestions":[{"fix":{"range":[3115,3177],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Sample File Loader - Fetch and manage sample files\n */\n\nimport { SAMPLE_FILES, type SampleFile } from './sample-library';\n\nexport interface SampleLoadResult {\n  sample: SampleFile;\n  loaded: boolean;\n  error?: string;\n  loadTime: number;\n}\n\nexport interface SampleUsageAnalytics {\n  sampleId: string;\n  loadCount: number;\n  lastLoaded: number;\n  averageRating?: number;\n  completionRate?: number;\n}\n\n/**\n * Load sample file by ID\n */\nexport async function loadSampleFile(\n  sampleId: string\n): Promise<SampleLoadResult> {\n  const startTime = performance.now();\n\n  try {\n    const sample = SAMPLE_FILES.find(s => s.id === sampleId);\n\n    if (!sample) {\n      throw new Error(`Sample file not found: ${sampleId}`);\n    }\n\n    // Simulate network delay for realistic experience\n    await new Promise(resolve => setTimeout(resolve, 300));\n\n    const loadTime = performance.now() - startTime;\n\n    // Track analytics\n    trackSampleLoad(sampleId, loadTime);\n\n    return {\n      sample,\n      loaded: true,\n      loadTime,\n    };\n  } catch (error) {\n    const loadTime = performance.now() - startTime;\n\n    return {\n      sample: {} as SampleFile,\n      loaded: false,\n      error: error instanceof Error ? error.message : 'Unknown error',\n      loadTime,\n    };\n  }\n}\n\n/**\n * Load multiple sample files\n */\nexport async function loadSampleFiles(\n  sampleIds: string[]\n): Promise<SampleLoadResult[]> {\n  const results = await Promise.all(sampleIds.map(id => loadSampleFile(id)));\n\n  return results;\n}\n\n/**\n * Get sample usage analytics from localStorage\n */\nexport function getSampleAnalytics(\n  sampleId: string\n): SampleUsageAnalytics | null {\n  try {\n    const analyticsData = localStorage.getItem(`sample_analytics_${sampleId}`);\n    if (!analyticsData) {\n      return null;\n    }\n\n    return JSON.parse(analyticsData) as SampleUsageAnalytics;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Track sample file load\n */\nfunction trackSampleLoad(sampleId: string, loadTime: number): void {\n  try {\n    const existing = getSampleAnalytics(sampleId) || {\n      sampleId,\n      loadCount: 0,\n      lastLoaded: 0,\n    };\n\n    const updated: SampleUsageAnalytics = {\n      ...existing,\n      loadCount: existing.loadCount + 1,\n      lastLoaded: Date.now(),\n    };\n\n    localStorage.setItem(\n      `sample_analytics_${sampleId}`,\n      JSON.stringify(updated)\n    );\n  } catch (error) {\n    console.error('[SampleLoader] Failed to track sample load:', error);\n  }\n}\n\n/**\n * Rate sample file (1-5 stars)\n */\nexport function rateSampleFile(sampleId: string, rating: number): void {\n  if (rating < 1 || rating > 5) {\n    throw new Error('Rating must be between 1 and 5');\n  }\n\n  try {\n    const existing = getSampleAnalytics(sampleId) || {\n      sampleId,\n      loadCount: 0,\n      lastLoaded: 0,\n    };\n\n    const updated: SampleUsageAnalytics = {\n      ...existing,\n      averageRating: calculateNewRating(\n        existing.averageRating,\n        existing.loadCount,\n        rating\n      ),\n    };\n\n    localStorage.setItem(\n      `sample_analytics_${sampleId}`,\n      JSON.stringify(updated)\n    );\n  } catch (error) {\n    console.error('[SampleLoader] Failed to rate sample:', error);\n  }\n}\n\n/**\n * Calculate new average rating\n */\nfunction calculateNewRating(\n  currentRating: number | undefined,\n  ratingCount: number,\n  newRating: number\n): number {\n  if (currentRating === undefined) {\n    return newRating;\n  }\n\n  return (currentRating * ratingCount + newRating) / (ratingCount + 1);\n}\n\n/**\n * Get most popular samples\n */\nexport function getPopularSamples(limit = 5): SampleFile[] {\n  const sampleAnalytics: Array<{ sampleId: string; loadCount: number }> = [];\n\n  SAMPLE_FILES.forEach(sample => {\n    const analytics = getSampleAnalytics(sample.id);\n    if (analytics) {\n      sampleAnalytics.push({\n        sampleId: sample.id,\n        loadCount: analytics.loadCount,\n      });\n    }\n  });\n\n  sampleAnalytics.sort((a, b) => b.loadCount - a.loadCount);\n\n  const popularSampleIds = sampleAnalytics.slice(0, limit).map(s => s.sampleId);\n  return popularSampleIds\n    .map(id => SAMPLE_FILES.find(s => s.id === id))\n    .filter((sample): sample is SampleFile => sample !== undefined);\n}\n\n/**\n * Get recommended samples based on usage\n */\nexport function getRecommendedSamplesByUsage(limit = 3): SampleFile[] {\n  const recommended = new Set<string>();\n\n  // Add highly-rated samples\n  SAMPLE_FILES.forEach(sample => {\n    const analytics = getSampleAnalytics(sample.id);\n    if (analytics && analytics.averageRating && analytics.averageRating >= 4) {\n      recommended.add(sample.id);\n    }\n  });\n\n  // Add popular samples\n  const popular = getPopularSamples(limit * 2);\n  popular.forEach(sample => {\n    recommended.add(sample.id);\n  });\n\n  // Add diverse categories\n  const categories = new Set<string>();\n  SAMPLE_FILES.forEach(sample => {\n    if (recommended.size >= limit) return;\n    if (!categories.has(sample.category)) {\n      recommended.add(sample.id);\n      categories.add(sample.category);\n    }\n  });\n\n  return Array.from(recommended)\n    .map(id => SAMPLE_FILES.find(s => s.id === id))\n    .filter((sample): sample is SampleFile => sample !== undefined)\n    .slice(0, limit);\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/sample-library.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":664,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":664,"endColumn":19,"suggestions":[{"fix":{"range":[21001,21052],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":674,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":674,"endColumn":19,"suggestions":[{"fix":{"range":[21283,21341],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Sample File Library System\n * \n * Manages curated sample files for onboarding and demonstration purposes.\n * Provides metadata explanations, difficulty levels, and use case categorization.\n */\n\nimport React, { createContext, useContext, useState, useCallback } from 'react';\n\n// ============================================================================\n// Types and Interfaces\n// ============================================================================\n\nexport type FileType = 'image' | 'video' | 'audio' | 'document' | 'archive';\nexport type DifficultyLevel = 'basic' | 'intermediate' | 'advanced';\nexport type UseCase = 'personal' | 'professional' | 'forensic' | 'research' | 'legal';\n\nexport interface MetadataHighlight {\n  field: string;\n  value: string;\n  explanation: string;\n  importance: 'high' | 'medium' | 'low';\n  category: string;\n}\n\nexport interface SampleFile {\n  id: string;\n  name: string;\n  filename: string;\n  description: string;\n  fileType: FileType;\n  mimeType: string;\n  size: number;\n  sizeFormatted: string;\n  difficulty: DifficultyLevel;\n  useCases: UseCase[];\n  tierRequired: string;\n  \n  // Metadata information\n  metadataHighlights: MetadataHighlight[];\n  expectedFieldCount: number;\n  valueProposition: string;\n  \n  // Learning content\n  whatYouWillLearn: string[];\n  commonUses: string[];\n  \n  // Processing info\n  estimatedProcessingTime: number; // seconds\n  tags: string[];\n}\n\nexport interface SampleCategory {\n  id: string;\n  name: string;\n  description: string;\n  icon: string;\n  samples: SampleFile[];\n}\n\nexport interface SampleLibraryState {\n  categories: SampleCategory[];\n  allSamples: SampleFile[];\n  processedSamples: string[]; // IDs of samples user has processed\n  favoriteSamples: string[]; // IDs of favorited samples\n}\n\n// ============================================================================\n// Sample File Definitions\n// ============================================================================\n\nconst SAMPLE_FILES: SampleFile[] = [\n  // Basic Image Samples\n  {\n    id: 'sample-photo-basic',\n    name: 'Vacation Photo',\n    filename: 'vacation_beach.jpg',\n    description: 'A typical smartphone photo with GPS and camera metadata',\n    fileType: 'image',\n    mimeType: 'image/jpeg',\n    size: 2457600, // 2.4 MB\n    sizeFormatted: '2.4 MB',\n    difficulty: 'basic',\n    useCases: ['personal'],\n    tierRequired: 'free',\n    metadataHighlights: [\n      {\n        field: 'GPS Coordinates',\n        value: '34.0522 N, 118.2437 W',\n        explanation: 'Shows exactly where this photo was taken - useful for organizing travel photos',\n        importance: 'high',\n        category: 'Location'\n      },\n      {\n        field: 'Camera Model',\n        value: 'iPhone 13 Pro',\n        explanation: 'Identifies the device used to capture the image',\n        importance: 'medium',\n        category: 'Device'\n      },\n      {\n        field: 'Date Taken',\n        value: '2024-07-15 14:32:18',\n        explanation: 'Exact timestamp when the photo was captured',\n        importance: 'high',\n        category: 'Temporal'\n      },\n      {\n        field: 'Image Dimensions',\n        value: '4032 x 3024 pixels',\n        explanation: 'Resolution of the image - important for print quality',\n        importance: 'medium',\n        category: 'Technical'\n      }\n    ],\n    expectedFieldCount: 45,\n    valueProposition: 'Discover hidden location data, camera settings, and timestamps in your photos',\n    whatYouWillLearn: [\n      'How to find GPS coordinates in photos',\n      'Understanding EXIF camera data',\n      'Reading timestamps and date information',\n      'Identifying the device that took the photo'\n    ],\n    commonUses: [\n      'Organizing photo collections by location',\n      'Verifying when and where photos were taken',\n      'Understanding camera settings for better photography'\n    ],\n    estimatedProcessingTime: 2,\n    tags: ['gps', 'camera', 'exif', 'beginner-friendly']\n  },\n  \n  // Intermediate Image Sample\n  {\n    id: 'sample-photo-edited',\n    name: 'Edited Professional Photo',\n    filename: 'professional_edited.jpg',\n    description: 'A professionally edited image showing software modification history',\n    fileType: 'image',\n    mimeType: 'image/jpeg',\n    size: 5242880, // 5 MB\n    sizeFormatted: '5.0 MB',\n    difficulty: 'intermediate',\n    useCases: ['professional', 'forensic'],\n    tierRequired: 'professional',\n    metadataHighlights: [\n      {\n        field: 'Software Used',\n        value: 'Adobe Photoshop 2024',\n        explanation: 'Shows which editing software modified this image',\n        importance: 'high',\n        category: 'Editing'\n      },\n      {\n        field: 'Edit History',\n        value: '3 modifications detected',\n        explanation: 'Tracks how many times the image was edited',\n        importance: 'high',\n        category: 'Forensic'\n      },\n      {\n        field: 'Color Profile',\n        value: 'Adobe RGB (1998)',\n        explanation: 'Professional color space used for high-quality printing',\n        importance: 'medium',\n        category: 'Technical'\n      },\n      {\n        field: 'Creator',\n        value: 'John Smith Photography',\n        explanation: 'Copyright and attribution information',\n        importance: 'high',\n        category: 'Rights'\n      }\n    ],\n    expectedFieldCount: 78,\n    valueProposition: 'Uncover editing history, software used, and copyright information in professional images',\n    whatYouWillLearn: [\n      'Detecting image manipulation and edits',\n      'Understanding professional color profiles',\n      'Reading copyright and creator metadata',\n      'Analyzing software modification history'\n    ],\n    commonUses: [\n      'Verifying image authenticity',\n      'Copyright and attribution tracking',\n      'Understanding professional workflows'\n    ],\n    estimatedProcessingTime: 3,\n    tags: ['editing', 'photoshop', 'copyright', 'professional']\n  },\n  \n  // Advanced Forensic Sample\n  {\n    id: 'sample-photo-forensic',\n    name: 'Forensic Evidence Photo',\n    filename: 'evidence_analysis.jpg',\n    description: 'Image with detailed forensic metadata for digital evidence analysis',\n    fileType: 'image',\n    mimeType: 'image/jpeg',\n    size: 3145728, // 3 MB\n    sizeFormatted: '3.0 MB',\n    difficulty: 'advanced',\n    useCases: ['forensic', 'legal', 'research'],\n    tierRequired: 'forensic',\n    metadataHighlights: [\n      {\n        field: 'Hash Signature',\n        value: 'SHA-256: a3f5...',\n        explanation: 'Cryptographic fingerprint proving file integrity',\n        importance: 'high',\n        category: 'Forensic'\n      },\n      {\n        field: 'Modification Detection',\n        value: 'No alterations detected',\n        explanation: 'Forensic analysis confirms original file integrity',\n        importance: 'high',\n        category: 'Forensic'\n      },\n      {\n        field: 'Thumbnail Analysis',\n        value: 'Embedded thumbnail matches main image',\n        explanation: 'Verifies no thumbnail substitution occurred',\n        importance: 'high',\n        category: 'Forensic'\n      },\n      {\n        field: 'Device Serial',\n        value: 'DMCE123456789',\n        explanation: 'Unique identifier linking to specific camera device',\n        importance: 'high',\n        category: 'Device'\n      }\n    ],\n    expectedFieldCount: 120,\n    valueProposition: 'Perform deep forensic analysis to verify authenticity and trace digital evidence',\n    whatYouWillLearn: [\n      'Forensic hash verification techniques',\n      'Detecting image tampering and manipulation',\n      'Analyzing embedded thumbnails',\n      'Tracing images to specific devices'\n    ],\n    commonUses: [\n      'Legal evidence verification',\n      'Digital forensics investigations',\n      'Authenticity validation for court cases'\n    ],\n    estimatedProcessingTime: 5,\n    tags: ['forensic', 'evidence', 'hash', 'tampering', 'advanced']\n  },\n  \n  // Video Sample\n  {\n    id: 'sample-video-basic',\n    name: 'Short Video Clip',\n    filename: 'family_video.mp4',\n    description: 'A short video with codec, duration, and device metadata',\n    fileType: 'video',\n    mimeType: 'video/mp4',\n    size: 15728640, // 15 MB\n    sizeFormatted: '15.0 MB',\n    difficulty: 'intermediate',\n    useCases: ['personal', 'professional'],\n    tierRequired: 'professional',\n    metadataHighlights: [\n      {\n        field: 'Video Codec',\n        value: 'H.264/AVC',\n        explanation: 'Compression format used for the video',\n        importance: 'medium',\n        category: 'Technical'\n      },\n      {\n        field: 'Duration',\n        value: '00:02:34',\n        explanation: 'Total length of the video',\n        importance: 'high',\n        category: 'Content'\n      },\n      {\n        field: 'Frame Rate',\n        value: '30 fps',\n        explanation: 'Frames per second - affects smoothness',\n        importance: 'medium',\n        category: 'Technical'\n      },\n      {\n        field: 'Recording Device',\n        value: 'GoPro Hero 11',\n        explanation: 'Camera used to record the video',\n        importance: 'high',\n        category: 'Device'\n      }\n    ],\n    expectedFieldCount: 65,\n    valueProposition: 'Extract codec information, duration, frame rates, and recording device details',\n    whatYouWillLearn: [\n      'Understanding video codecs and formats',\n      'Reading video duration and frame rates',\n      'Identifying recording devices',\n      'Analyzing video quality settings'\n    ],\n    commonUses: [\n      'Video library organization',\n      'Quality assessment',\n      'Device identification'\n    ],\n    estimatedProcessingTime: 8,\n    tags: ['video', 'codec', 'duration', 'gopro']\n  },\n  \n  // Audio Sample\n  {\n    id: 'sample-audio-basic',\n    name: 'Music Track',\n    filename: 'song_sample.mp3',\n    description: 'Audio file with ID3 tags, artist info, and technical metadata',\n    fileType: 'audio',\n    mimeType: 'audio/mpeg',\n    size: 4194304, // 4 MB\n    sizeFormatted: '4.0 MB',\n    difficulty: 'basic',\n    useCases: ['personal'],\n    tierRequired: 'free',\n    metadataHighlights: [\n      {\n        field: 'Artist',\n        value: 'Sample Artist',\n        explanation: 'Performer or creator of the audio',\n        importance: 'high',\n        category: 'Content'\n      },\n      {\n        field: 'Album',\n        value: 'Greatest Hits 2024',\n        explanation: 'Album or collection this track belongs to',\n        importance: 'medium',\n        category: 'Content'\n      },\n      {\n        field: 'Bitrate',\n        value: '320 kbps',\n        explanation: 'Audio quality - higher is better',\n        importance: 'medium',\n        category: 'Technical'\n      },\n      {\n        field: 'Duration',\n        value: '00:03:45',\n        explanation: 'Length of the audio track',\n        importance: 'high',\n        category: 'Content'\n      }\n    ],\n    expectedFieldCount: 35,\n    valueProposition: 'Discover artist information, album details, and audio quality metrics',\n    whatYouWillLearn: [\n      'Reading ID3 tags in audio files',\n      'Understanding audio bitrates and quality',\n      'Extracting artist and album information',\n      'Analyzing audio technical specifications'\n    ],\n    commonUses: [\n      'Music library organization',\n      'Quality verification',\n      'Metadata cleanup and correction'\n    ],\n    estimatedProcessingTime: 3,\n    tags: ['audio', 'music', 'id3', 'mp3']\n  },\n  \n  // Document Sample\n  {\n    id: 'sample-document-basic',\n    name: 'PDF Document',\n    filename: 'report_sample.pdf',\n    description: 'PDF with author, creation date, and software metadata',\n    fileType: 'document',\n    mimeType: 'application/pdf',\n    size: 1048576, // 1 MB\n    sizeFormatted: '1.0 MB',\n    difficulty: 'basic',\n    useCases: ['professional', 'research'],\n    tierRequired: 'free',\n    metadataHighlights: [\n      {\n        field: 'Author',\n        value: 'Jane Doe',\n        explanation: 'Person who created the document',\n        importance: 'high',\n        category: 'Content'\n      },\n      {\n        field: 'Creation Date',\n        value: '2024-06-20 09:15:00',\n        explanation: 'When the document was first created',\n        importance: 'high',\n        category: 'Temporal'\n      },\n      {\n        field: 'Software',\n        value: 'Microsoft Word 2024',\n        explanation: 'Application used to create the PDF',\n        importance: 'medium',\n        category: 'Technical'\n      },\n      {\n        field: 'Page Count',\n        value: '12 pages',\n        explanation: 'Total number of pages in the document',\n        importance: 'medium',\n        category: 'Content'\n      }\n    ],\n    expectedFieldCount: 28,\n    valueProposition: 'Extract author information, creation dates, and document properties',\n    whatYouWillLearn: [\n      'Reading PDF metadata and properties',\n      'Identifying document authors and creators',\n      'Understanding creation and modification dates',\n      'Analyzing software used to create documents'\n    ],\n    commonUses: [\n      'Document authenticity verification',\n      'Author attribution',\n      'Version tracking'\n    ],\n    estimatedProcessingTime: 2,\n    tags: ['pdf', 'document', 'author', 'office']\n  }\n];\n\n// ============================================================================\n// Sample Categories\n// ============================================================================\n\nconst SAMPLE_CATEGORIES: SampleCategory[] = [\n  {\n    id: 'getting-started',\n    name: 'Getting Started',\n    description: 'Perfect for first-time users - simple files with clear, valuable metadata',\n    icon: 'Rocket',\n    samples: SAMPLE_FILES.filter(s => s.difficulty === 'basic')\n  },\n  {\n    id: 'professional',\n    name: 'Professional Use',\n    description: 'Advanced samples for professional workflows and detailed analysis',\n    icon: 'Briefcase',\n    samples: SAMPLE_FILES.filter(s => s.useCases.includes('professional'))\n  },\n  {\n    id: 'forensic',\n    name: 'Forensic Analysis',\n    description: 'Deep forensic examination samples for evidence and authenticity verification',\n    icon: 'Shield',\n    samples: SAMPLE_FILES.filter(s => s.useCases.includes('forensic'))\n  },\n  {\n    id: 'by-type',\n    name: 'By File Type',\n    description: 'Explore samples organized by file format',\n    icon: 'FolderOpen',\n    samples: SAMPLE_FILES\n  }\n];\n\n// ============================================================================\n// Context\n// ============================================================================\n\nexport interface SampleComparison {\n  samples: SampleFile[];\n  commonFields: string[];\n  uniqueFields: Map<string, string[]>; // sampleId -> unique field names\n  difficultyRange: { min: DifficultyLevel; max: DifficultyLevel };\n  sharedUseCases: UseCase[];\n  comparisonInsights: string[];\n}\n\ninterface SampleLibraryContextType {\n  state: SampleLibraryState;\n  getSampleById: (id: string) => SampleFile | undefined;\n  getSamplesByDifficulty: (difficulty: DifficultyLevel) => SampleFile[];\n  getSamplesByUseCase: (useCase: UseCase) => SampleFile[];\n  getSamplesByFileType: (fileType: FileType) => SampleFile[];\n  getRecommendedSamples: (userProfile: { \n    useCase: string; \n    technicalLevel: string;\n    primaryFileTypes?: string[];\n    goals?: string[];\n    industry?: string;\n  }) => SampleFile[];\n  compareSamples: (sampleIds: string[]) => SampleComparison | null;\n  markSampleProcessed: (sampleId: string) => void;\n  toggleFavorite: (sampleId: string) => void;\n  isSampleProcessed: (sampleId: string) => boolean;\n  isSampleFavorited: (sampleId: string) => boolean;\n}\n\nconst SampleLibraryContext = createContext<SampleLibraryContextType | null>(null);\n\nexport function SampleLibraryProvider({ children }: { children: React.ReactNode }) {\n  const [state, setState] = useState<SampleLibraryState>({\n    categories: SAMPLE_CATEGORIES,\n    allSamples: SAMPLE_FILES,\n    processedSamples: [],\n    favoriteSamples: []\n  });\n\n  const getSampleById = useCallback((id: string) => {\n    return state.allSamples.find(s => s.id === id);\n  }, [state.allSamples]);\n\n  const getSamplesByDifficulty = useCallback((difficulty: DifficultyLevel) => {\n    return state.allSamples.filter(s => s.difficulty === difficulty);\n  }, [state.allSamples]);\n\n  const getSamplesByUseCase = useCallback((useCase: UseCase) => {\n    return state.allSamples.filter(s => s.useCases.includes(useCase));\n  }, [state.allSamples]);\n\n  const getSamplesByFileType = useCallback((fileType: FileType) => {\n    return state.allSamples.filter(s => s.fileType === fileType);\n  }, [state.allSamples]);\n\n  const getRecommendedSamples = useCallback((userProfile: { \n    useCase: string; \n    technicalLevel: string;\n    primaryFileTypes?: string[];\n    goals?: string[];\n    industry?: string;\n  }) => {\n    // Map technical level to difficulty\n    const difficultyMap: Record<string, DifficultyLevel> = {\n      'beginner': 'basic',\n      'intermediate': 'intermediate',\n      'advanced': 'advanced'\n    };\n\n    const difficulty = difficultyMap[userProfile.technicalLevel] || 'basic';\n    const useCase = userProfile.useCase as UseCase;\n\n    // Score each sample based on multiple factors\n    const scoredSamples = state.allSamples.map(sample => {\n      let score = 0;\n\n      // Primary factor: Use case match (40 points)\n      if (sample.useCases.includes(useCase)) {\n        score += 40;\n      }\n\n      // Secondary factor: Difficulty match (30 points)\n      if (sample.difficulty === difficulty) {\n        score += 30;\n      } else if (\n        // Allow one level up or down\n        (difficulty === 'basic' && sample.difficulty === 'intermediate') ||\n        (difficulty === 'intermediate' && (sample.difficulty === 'basic' || sample.difficulty === 'advanced')) ||\n        (difficulty === 'advanced' && sample.difficulty === 'intermediate')\n      ) {\n        score += 15;\n      }\n\n      // Tertiary factor: File type preference (20 points)\n      if (userProfile.primaryFileTypes && userProfile.primaryFileTypes.length > 0) {\n        const fileTypeMatch = userProfile.primaryFileTypes.some(type => \n          sample.fileType === type || sample.tags.includes(type)\n        );\n        if (fileTypeMatch) {\n          score += 20;\n        }\n      }\n\n      // Quaternary factor: Goals alignment (10 points)\n      if (userProfile.goals && userProfile.goals.length > 0) {\n        const goalMatch = userProfile.goals.some(goal =>\n          sample.whatYouWillLearn.some(learning => \n            learning.toLowerCase().includes(goal.toLowerCase())\n          ) ||\n          sample.commonUses.some(use =>\n            use.toLowerCase().includes(goal.toLowerCase())\n          )\n        );\n        if (goalMatch) {\n          score += 10;\n        }\n      }\n\n      // Bonus: Industry-specific samples\n      if (userProfile.industry) {\n        const industryMatch = sample.tags.some(tag =>\n          tag.toLowerCase().includes(userProfile.industry!.toLowerCase())\n        );\n        if (industryMatch) {\n          score += 5;\n        }\n      }\n\n      // Bonus: Unprocessed samples (encourage exploration)\n      if (!state.processedSamples.includes(sample.id)) {\n        score += 5;\n      }\n\n      // Penalty: Already processed samples (but don't exclude completely)\n      if (state.processedSamples.includes(sample.id)) {\n        score -= 10;\n      }\n\n      return { sample, score };\n    });\n\n    // Sort by score and return top recommendations\n    const recommended = scoredSamples\n      .sort((a, b) => b.score - a.score)\n      .slice(0, 5) // Top 5 recommendations\n      .map(item => item.sample);\n\n    // Ensure we have at least 3 recommendations\n    if (recommended.length < 3) {\n      // Add more samples from same difficulty\n      const additional = state.allSamples\n        .filter(s => s.difficulty === difficulty && !recommended.includes(s))\n        .slice(0, 3 - recommended.length);\n      \n      return [...recommended, ...additional];\n    }\n\n    return recommended;\n  }, [state.allSamples, state.processedSamples]);\n\n  const markSampleProcessed = useCallback((sampleId: string) => {\n    setState(prev => ({\n      ...prev,\n      processedSamples: prev.processedSamples.includes(sampleId)\n        ? prev.processedSamples\n        : [...prev.processedSamples, sampleId]\n    }));\n  }, []);\n\n  const toggleFavorite = useCallback((sampleId: string) => {\n    setState(prev => ({\n      ...prev,\n      favoriteSamples: prev.favoriteSamples.includes(sampleId)\n        ? prev.favoriteSamples.filter(id => id !== sampleId)\n        : [...prev.favoriteSamples, sampleId]\n    }));\n  }, []);\n\n  const isSampleProcessed = useCallback((sampleId: string) => {\n    return state.processedSamples.includes(sampleId);\n  }, [state.processedSamples]);\n\n  const isSampleFavorited = useCallback((sampleId: string) => {\n    return state.favoriteSamples.includes(sampleId);\n  }, [state.favoriteSamples]);\n\n  /**\n   * Compare multiple sample files to identify similarities and differences\n   */\n  const compareSamples = useCallback((sampleIds: string[]): SampleComparison | null => {\n    if (sampleIds.length < 2) {\n      console.warn('Need at least 2 samples to compare');\n      return null;\n    }\n\n    // Get all samples\n    const samples = sampleIds\n      .map(id => state.allSamples.find(s => s.id === id))\n      .filter((s): s is SampleFile => s !== undefined);\n\n    if (samples.length < 2) {\n      console.warn('Could not find all samples for comparison');\n      return null;\n    }\n\n    // Find common metadata fields\n    const allFields = samples.map(s => \n      s.metadataHighlights.map(h => h.field)\n    );\n    \n    const commonFields = allFields[0].filter(field =>\n      allFields.every(fields => fields.includes(field))\n    );\n\n    // Find unique fields for each sample\n    const uniqueFields = new Map<string, string[]>();\n    samples.forEach(sample => {\n      const sampleFields = sample.metadataHighlights.map(h => h.field);\n      const unique = sampleFields.filter(field => !commonFields.includes(field));\n      uniqueFields.set(sample.id, unique);\n    });\n\n    // Determine difficulty range\n    const difficulties: DifficultyLevel[] = ['basic', 'intermediate', 'advanced'];\n    const sampleDifficulties = samples.map(s => s.difficulty);\n    const minDifficultyIndex = Math.min(...sampleDifficulties.map(d => difficulties.indexOf(d)));\n    const maxDifficultyIndex = Math.max(...sampleDifficulties.map(d => difficulties.indexOf(d)));\n\n    const difficultyRange = {\n      min: difficulties[minDifficultyIndex],\n      max: difficulties[maxDifficultyIndex]\n    };\n\n    // Find shared use cases\n    const allUseCases = samples.map(s => s.useCases);\n    const sharedUseCases = allUseCases[0].filter(useCase =>\n      allUseCases.every(cases => cases.includes(useCase))\n    );\n\n    // Generate comparison insights\n    const comparisonInsights: string[] = [];\n\n    // File type comparison\n    const fileTypes = new Set(samples.map(s => s.fileType));\n    if (fileTypes.size === 1) {\n      comparisonInsights.push(`All samples are ${Array.from(fileTypes)[0]} files`);\n    } else {\n      comparisonInsights.push(`Comparing ${fileTypes.size} different file types: ${Array.from(fileTypes).join(', ')}`);\n    }\n\n    // Difficulty comparison\n    if (difficultyRange.min === difficultyRange.max) {\n      comparisonInsights.push(`All samples are at ${difficultyRange.min} difficulty level`);\n    } else {\n      comparisonInsights.push(`Difficulty ranges from ${difficultyRange.min} to ${difficultyRange.max}`);\n    }\n\n    // Field count comparison\n    const fieldCounts = samples.map(s => s.expectedFieldCount);\n    const minFields = Math.min(...fieldCounts);\n    const maxFields = Math.max(...fieldCounts);\n    comparisonInsights.push(`Metadata field counts range from ${minFields} to ${maxFields} fields`);\n\n    // Common fields insight\n    if (commonFields.length > 0) {\n      comparisonInsights.push(`${commonFields.length} metadata fields are common across all samples`);\n    } else {\n      comparisonInsights.push('No common metadata fields - these files have very different metadata structures');\n    }\n\n    // Use case insight\n    if (sharedUseCases.length > 0) {\n      comparisonInsights.push(`Shared use cases: ${sharedUseCases.join(', ')}`);\n    } else {\n      comparisonInsights.push('These samples serve different use cases');\n    }\n\n    // Processing time comparison\n    const processingTimes = samples.map(s => s.estimatedProcessingTime);\n    const avgProcessingTime = processingTimes.reduce((sum, t) => sum + t, 0) / processingTimes.length;\n    comparisonInsights.push(`Average processing time: ${avgProcessingTime.toFixed(1)} seconds`);\n\n    // Tier requirement comparison\n    const tiers = new Set(samples.map(s => s.tierRequired));\n    if (tiers.size === 1) {\n      comparisonInsights.push(`All samples require ${Array.from(tiers)[0]} tier`);\n    } else {\n      comparisonInsights.push(`Requires different subscription tiers: ${Array.from(tiers).join(', ')}`);\n    }\n\n    return {\n      samples,\n      commonFields,\n      uniqueFields,\n      difficultyRange,\n      sharedUseCases,\n      comparisonInsights\n    };\n  }, [state.allSamples]);\n\n  return (\n    <SampleLibraryContext.Provider\n      value={{\n        state,\n        getSampleById,\n        getSamplesByDifficulty,\n        getSamplesByUseCase,\n        getSamplesByFileType,\n        getRecommendedSamples,\n        compareSamples,\n        markSampleProcessed,\n        toggleFavorite,\n        isSampleProcessed,\n        isSampleFavorited\n      }}\n    >\n      {children}\n    </SampleLibraryContext.Provider>\n  );\n}\n\nexport function useSampleLibrary() {\n  const context = useContext(SampleLibraryContext);\n  if (!context) {\n    throw new Error('useSampleLibrary must be used within a SampleLibraryProvider');\n  }\n  return context;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/subscription.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PricingTier' is defined but never used.","line":11,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Subscription Management System\n * \n * Handles plan upgrades, downgrades, free tier access, and billing updates.\n * \n * Requirements: 4.4, 4.5\n */\n\nimport {\n  type SubscriptionTier,\n  type PricingTier,\n  getPricingTier,\n  getFeatureDifferences,\n  calculateMonthlyPrice,\n  calculateAnnualPrice,\n  type CurrencyCode,\n} from './pricing';\n\n// Subscription status\nexport type SubscriptionStatus = \n  | 'active'\n  | 'trialing'\n  | 'past_due'\n  | 'canceled'\n  | 'unpaid'\n  | 'incomplete';\n\n// Billing cycle\nexport type BillingCycle = 'monthly' | 'annual';\n\n// Plan change type\nexport type PlanChangeType = 'upgrade' | 'downgrade' | 'same';\n\n/**\n * User subscription data\n */\nexport interface UserSubscription {\n  id: string;\n  userId: string;\n  tier: SubscriptionTier;\n  status: SubscriptionStatus;\n  billingCycle: BillingCycle;\n  currentPeriodStart: Date;\n  currentPeriodEnd: Date;\n  cancelAtPeriodEnd: boolean;\n  trialEnd?: Date;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\n/**\n * Plan change preview\n */\nexport interface PlanChangePreview {\n  fromTier: SubscriptionTier;\n  toTier: SubscriptionTier;\n  changeType: PlanChangeType;\n  proratedAmount: number;\n  newMonthlyPrice: number;\n  newAnnualPrice: number;\n  effectiveDate: Date;\n  featuresGained: string[];\n  featuresLost: string[];\n  warnings: string[];\n  requiresConfirmation: boolean;\n}\n\n/**\n * Plan change result\n */\nexport interface PlanChangeResult {\n  success: boolean;\n  subscription?: UserSubscription;\n  error?: string;\n  message: string;\n}\n\n/**\n * Usage data for a subscription\n */\nexport interface SubscriptionUsage {\n  uploadsThisMonth: number;\n  uploadsLimit: number | 'unlimited';\n  apiCallsThisMonth: number;\n  apiCallsLimit: number | 'unlimited';\n  storageUsedMB: number;\n  storageLimitMB: number;\n  periodStart: Date;\n  periodEnd: Date;\n}\n\n/**\n * Determine the type of plan change\n */\nexport function getPlanChangeType(\n  fromTier: SubscriptionTier,\n  toTier: SubscriptionTier\n): PlanChangeType {\n  const tierOrder: SubscriptionTier[] = ['free', 'professional', 'forensic', 'enterprise'];\n  const fromIndex = tierOrder.indexOf(fromTier);\n  const toIndex = tierOrder.indexOf(toTier);\n  \n  if (fromIndex < toIndex) return 'upgrade';\n  if (fromIndex > toIndex) return 'downgrade';\n  return 'same';\n}\n\n/**\n * Check if a plan change is allowed\n */\nexport function canChangePlan(\n  currentSubscription: UserSubscription,\n  targetTier: SubscriptionTier\n): { allowed: boolean; reason?: string } {\n  // Can't change to the same tier\n  if (currentSubscription.tier === targetTier) {\n    return { allowed: false, reason: 'You are already on this plan' };\n  }\n  \n  // Can't change if subscription is in certain states\n  if (currentSubscription.status === 'unpaid') {\n    return { allowed: false, reason: 'Please resolve your payment issue before changing plans' };\n  }\n  \n  if (currentSubscription.status === 'incomplete') {\n    return { allowed: false, reason: 'Please complete your current subscription setup first' };\n  }\n  \n  // Can always downgrade to free\n  if (targetTier === 'free') {\n    return { allowed: true };\n  }\n  \n  // Enterprise requires contact with sales\n  if (targetTier === 'enterprise') {\n    return { allowed: true }; // Will redirect to sales contact\n  }\n  \n  return { allowed: true };\n}\n\n/**\n * Calculate prorated amount for plan change\n */\nexport function calculateProratedAmount(\n  currentSubscription: UserSubscription,\n  targetTier: SubscriptionTier,\n  currency: CurrencyCode = 'USD'\n): number {\n  const currentTier = getPricingTier(currentSubscription.tier);\n  const newTier = getPricingTier(targetTier);\n  \n  if (!currentTier || !newTier) return 0;\n  \n  // Free tier has no proration\n  if (currentSubscription.tier === 'free' || targetTier === 'free') {\n    return 0;\n  }\n  \n  const now = new Date();\n  const periodEnd = new Date(currentSubscription.currentPeriodEnd);\n  const periodStart = new Date(currentSubscription.currentPeriodStart);\n  \n  // Calculate days remaining in current period\n  const totalDays = Math.ceil((periodEnd.getTime() - periodStart.getTime()) / (1000 * 60 * 60 * 24));\n  const daysRemaining = Math.max(0, Math.ceil((periodEnd.getTime() - now.getTime()) / (1000 * 60 * 60 * 24)));\n  \n  if (totalDays === 0) return 0;\n  \n  const currentMonthlyPrice = calculateMonthlyPrice(currentTier, currentSubscription.billingCycle, currency);\n  const newMonthlyPrice = calculateMonthlyPrice(newTier, currentSubscription.billingCycle, currency);\n  \n  // Calculate daily rates\n  const currentDailyRate = currentMonthlyPrice / 30;\n  const newDailyRate = newMonthlyPrice / 30;\n  \n  // Prorated amount = (new rate - current rate) * days remaining\n  const proratedAmount = (newDailyRate - currentDailyRate) * daysRemaining;\n  \n  // For downgrades, this will be negative (credit)\n  // For upgrades, this will be positive (charge)\n  return Math.round(proratedAmount * 100) / 100;\n}\n\n/**\n * Preview a plan change before executing\n */\nexport function previewPlanChange(\n  currentSubscription: UserSubscription,\n  targetTier: SubscriptionTier,\n  currency: CurrencyCode = 'USD'\n): PlanChangePreview {\n  const changeType = getPlanChangeType(currentSubscription.tier, targetTier);\n  const { gained, lost } = getFeatureDifferences(currentSubscription.tier, targetTier);\n  const newTier = getPricingTier(targetTier);\n  \n  const warnings: string[] = [];\n  \n  // Add warnings for downgrades\n  if (changeType === 'downgrade') {\n    if (lost.length > 0) {\n      warnings.push(`You will lose access to ${lost.length} feature(s)`);\n    }\n    warnings.push('Your current usage may exceed the new plan limits');\n  }\n  \n  // Add warning for enterprise\n  if (targetTier === 'enterprise') {\n    warnings.push('Enterprise plans require a sales consultation');\n  }\n  \n  const proratedAmount = calculateProratedAmount(currentSubscription, targetTier, currency);\n  \n  return {\n    fromTier: currentSubscription.tier,\n    toTier: targetTier,\n    changeType,\n    proratedAmount,\n    newMonthlyPrice: newTier ? calculateMonthlyPrice(newTier, currentSubscription.billingCycle, currency) : 0,\n    newAnnualPrice: newTier ? calculateAnnualPrice(newTier, currency) : 0,\n    effectiveDate: changeType === 'downgrade' \n      ? new Date(currentSubscription.currentPeriodEnd) \n      : new Date(),\n    featuresGained: gained.map(f => f.name),\n    featuresLost: lost.map(f => f.name),\n    warnings,\n    requiresConfirmation: changeType === 'downgrade' || lost.length > 0,\n  };\n}\n\n/**\n * Execute a plan change (mock implementation)\n * In production, this would call the backend API\n */\nexport async function changePlan(\n  currentSubscription: UserSubscription,\n  targetTier: SubscriptionTier,\n  options: {\n    billingCycle?: BillingCycle;\n    confirmDowngrade?: boolean;\n  } = {}\n): Promise<PlanChangeResult> {\n  // Check if change is allowed\n  const { allowed, reason } = canChangePlan(currentSubscription, targetTier);\n  if (!allowed) {\n    return {\n      success: false,\n      error: reason,\n      message: reason || 'Plan change not allowed',\n    };\n  }\n  \n  const changeType = getPlanChangeType(currentSubscription.tier, targetTier);\n  \n  // Require confirmation for downgrades\n  if (changeType === 'downgrade' && !options.confirmDowngrade) {\n    return {\n      success: false,\n      error: 'confirmation_required',\n      message: 'Please confirm the downgrade to proceed',\n    };\n  }\n  \n  // Enterprise requires sales contact\n  if (targetTier === 'enterprise') {\n    return {\n      success: false,\n      error: 'contact_sales',\n      message: 'Please contact our sales team for Enterprise plans',\n    };\n  }\n  \n  // Simulate API call\n  await new Promise(resolve => setTimeout(resolve, 500));\n  \n  // Create updated subscription\n  const now = new Date();\n  const periodEnd = new Date(now);\n  periodEnd.setMonth(periodEnd.getMonth() + 1);\n  \n  const updatedSubscription: UserSubscription = {\n    ...currentSubscription,\n    tier: targetTier,\n    billingCycle: options.billingCycle || currentSubscription.billingCycle,\n    status: targetTier === 'free' ? 'active' : currentSubscription.status,\n    currentPeriodStart: changeType === 'upgrade' ? now : currentSubscription.currentPeriodStart,\n    currentPeriodEnd: changeType === 'upgrade' ? periodEnd : currentSubscription.currentPeriodEnd,\n    updatedAt: now,\n  };\n  \n  return {\n    success: true,\n    subscription: updatedSubscription,\n    message: changeType === 'upgrade' \n      ? `Successfully upgraded to ${targetTier}!`\n      : changeType === 'downgrade'\n      ? `Your plan will change to ${targetTier} at the end of your billing period`\n      : 'Plan updated successfully',\n  };\n}\n\n/**\n * Cancel a subscription\n */\nexport async function cancelSubscription(\n  subscription: UserSubscription,\n  options: {\n    immediate?: boolean;\n    reason?: string;\n  } = {}\n): Promise<PlanChangeResult> {\n  // Simulate API call\n  await new Promise(resolve => setTimeout(resolve, 500));\n  \n  if (subscription.tier === 'free') {\n    return {\n      success: false,\n      error: 'already_free',\n      message: 'You are already on the free plan',\n    };\n  }\n  \n  const updatedSubscription: UserSubscription = {\n    ...subscription,\n    cancelAtPeriodEnd: !options.immediate,\n    status: options.immediate ? 'canceled' : subscription.status,\n    tier: options.immediate ? 'free' : subscription.tier,\n    updatedAt: new Date(),\n  };\n  \n  return {\n    success: true,\n    subscription: updatedSubscription,\n    message: options.immediate\n      ? 'Your subscription has been canceled'\n      : 'Your subscription will be canceled at the end of the billing period',\n  };\n}\n\n/**\n * Reactivate a canceled subscription\n */\nexport async function reactivateSubscription(\n  subscription: UserSubscription\n): Promise<PlanChangeResult> {\n  if (!subscription.cancelAtPeriodEnd && subscription.status !== 'canceled') {\n    return {\n      success: false,\n      error: 'not_canceled',\n      message: 'Your subscription is not scheduled for cancellation',\n    };\n  }\n  \n  // Simulate API call\n  await new Promise(resolve => setTimeout(resolve, 500));\n  \n  const updatedSubscription: UserSubscription = {\n    ...subscription,\n    cancelAtPeriodEnd: false,\n    status: 'active',\n    updatedAt: new Date(),\n  };\n  \n  return {\n    success: true,\n    subscription: updatedSubscription,\n    message: 'Your subscription has been reactivated',\n  };\n}\n\n/**\n * Get usage for a subscription\n */\nexport function getSubscriptionUsage(subscription: UserSubscription): SubscriptionUsage {\n  const tier = getPricingTier(subscription.tier);\n  \n  // Mock usage data - in production this would come from the backend\n  return {\n    uploadsThisMonth: Math.floor(Math.random() * 50),\n    uploadsLimit: tier?.limits.monthlyUploads || 0,\n    apiCallsThisMonth: Math.floor(Math.random() * 100),\n    apiCallsLimit: tier?.limits.apiCalls || 0,\n    storageUsedMB: Math.floor(Math.random() * 500),\n    storageLimitMB: tier?.limits.maxFileSize ? tier.limits.maxFileSize * 10 : 100,\n    periodStart: subscription.currentPeriodStart,\n    periodEnd: subscription.currentPeriodEnd,\n  };\n}\n\n/**\n * Check if usage exceeds limits for a target tier\n */\nexport function checkUsageAgainstTier(\n  usage: SubscriptionUsage,\n  targetTier: SubscriptionTier\n): { exceeds: boolean; warnings: string[] } {\n  const tier = getPricingTier(targetTier);\n  if (!tier) return { exceeds: false, warnings: [] };\n  \n  const warnings: string[] = [];\n  let exceeds = false;\n  \n  // Check uploads\n  if (tier.limits.monthlyUploads !== 'unlimited' && \n      usage.uploadsThisMonth > tier.limits.monthlyUploads) {\n    exceeds = true;\n    warnings.push(`Your current uploads (${usage.uploadsThisMonth}) exceed the ${tier.name} limit (${tier.limits.monthlyUploads})`);\n  }\n  \n  // Check API calls\n  if (tier.limits.apiCalls !== 'unlimited' && \n      typeof usage.apiCallsLimit === 'number' &&\n      usage.apiCallsThisMonth > tier.limits.apiCalls) {\n    exceeds = true;\n    warnings.push(`Your API usage (${usage.apiCallsThisMonth}) exceeds the ${tier.name} limit (${tier.limits.apiCalls})`);\n  }\n  \n  return { exceeds, warnings };\n}\n\n/**\n * Create a default free subscription for new users\n */\nexport function createFreeSubscription(userId: string): UserSubscription {\n  const now = new Date();\n  const periodEnd = new Date(now);\n  periodEnd.setMonth(periodEnd.getMonth() + 1);\n  \n  return {\n    id: `sub_${Date.now()}`,\n    userId,\n    tier: 'free',\n    status: 'active',\n    billingCycle: 'monthly',\n    currentPeriodStart: now,\n    currentPeriodEnd: periodEnd,\n    cancelAtPeriodEnd: false,\n    createdAt: now,\n    updatedAt: now,\n  };\n}\n\n/**\n * Check if a feature is available for a subscription\n */\nexport function hasFeatureAccess(\n  subscription: UserSubscription,\n  featureId: string\n): boolean {\n  const tier = getPricingTier(subscription.tier);\n  if (!tier) return false;\n  \n  // Check subscription status\n  if (subscription.status === 'canceled' || subscription.status === 'unpaid') {\n    // Fall back to free tier features\n    const freeTier = getPricingTier('free');\n    const freeFeature = freeTier?.features.find(f => f.id === featureId);\n    return freeFeature?.included ?? false;\n  }\n  \n  const feature = tier.features.find(f => f.id === featureId);\n  return feature?.included ?? false;\n}\n\n/**\n * Get the effective tier for a subscription (considering status)\n */\nexport function getEffectiveTier(subscription: UserSubscription): SubscriptionTier {\n  // If subscription is in a bad state, treat as free\n  if (subscription.status === 'canceled' || subscription.status === 'unpaid') {\n    return 'free';\n  }\n  \n  return subscription.tier;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/team/permission-manager.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":172,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":172,"endColumn":20,"suggestions":[{"fix":{"range":[4265,4315],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":310,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":310,"endColumn":22,"suggestions":[{"fix":{"range":[7800,7853],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":342,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":342,"endColumn":24,"suggestions":[{"fix":{"range":[8570,8623],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'teamId' is defined but never used. Allowed unused args must match /^_/u.","line":378,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":378,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'teamId' is defined but never used. Allowed unused args must match /^_/u.","line":395,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":395,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Permission Manager - Role-based access control for teams\n */\n\nexport interface Permission {\n  id: string;\n  name: string;\n  description: string;\n  resource: string;\n  action: string;\n  attributes?: string[];\n}\n\nexport interface Role {\n  id: string;\n  name: string;\n  description: string;\n  permissions: string[]; // Permission IDs\n  systemRole: boolean; // Whether this is a built-in system role\n}\n\nexport interface UserTeamRole {\n  userId: string;\n  teamId: string;\n  roleId: string;\n  assignedAt: Date;\n  assignedBy: string;\n}\n\nexport interface ResourceAccess {\n  resourceId: string;\n  resourceType: string;\n  teamId: string;\n  allowedActions: string[];\n  allowedAttributes?: string[];\n}\n\nexport class PermissionManager {\n  private roles: Map<string, Role> = new Map();\n  private permissions: Map<string, Permission> = new Map();\n  private userTeamRoles: Map<string, UserTeamRole[]> = new Map(); // userId -> roles\n  private resourceAccess: Map<string, ResourceAccess[]> = new Map(); // teamId -> resources\n\n  constructor() {\n    this.initializeDefaultRoles();\n    this.initializeDefaultPermissions();\n  }\n\n  /**\n   * Initialize default roles\n   */\n  private initializeDefaultRoles(): void {\n    const defaultRoles: Role[] = [\n      {\n        id: 'role-admin',\n        name: 'Administrator',\n        description: 'Full access to all team resources',\n        permissions: [\n          'team.manage',\n          'member.manage',\n          'resource.create',\n          'resource.read',\n          'resource.update',\n          'resource.delete',\n          'settings.manage'\n        ],\n        systemRole: true\n      },\n      {\n        id: 'role-editor',\n        name: 'Editor',\n        description: 'Can create, read, and update team resources',\n        permissions: [\n          'resource.create',\n          'resource.read',\n          'resource.update',\n          'member.read'\n        ],\n        systemRole: true\n      },\n      {\n        id: 'role-viewer',\n        name: 'Viewer',\n        description: 'Can only read team resources',\n        permissions: [\n          'resource.read',\n          'member.read'\n        ],\n        systemRole: true\n      }\n    ];\n\n    defaultRoles.forEach(role => {\n      this.roles.set(role.id, role);\n    });\n  }\n\n  /**\n   * Initialize default permissions\n   */\n  private initializeDefaultPermissions(): void {\n    const defaultPermissions: Permission[] = [\n      {\n        id: 'team.manage',\n        name: 'Manage Team',\n        description: 'Full control over team settings and members',\n        resource: 'team',\n        action: 'manage'\n      },\n      {\n        id: 'member.manage',\n        name: 'Manage Members',\n        description: 'Add, remove, and modify team members',\n        resource: 'member',\n        action: 'manage'\n      },\n      {\n        id: 'member.read',\n        name: 'Read Members',\n        description: 'View team member information',\n        resource: 'member',\n        action: 'read'\n      },\n      {\n        id: 'resource.create',\n        name: 'Create Resources',\n        description: 'Create new resources in the team',\n        resource: 'resource',\n        action: 'create'\n      },\n      {\n        id: 'resource.read',\n        name: 'Read Resources',\n        description: 'View resources in the team',\n        resource: 'resource',\n        action: 'read'\n      },\n      {\n        id: 'resource.update',\n        name: 'Update Resources',\n        description: 'Modify existing resources in the team',\n        resource: 'resource',\n        action: 'update'\n      },\n      {\n        id: 'resource.delete',\n        name: 'Delete Resources',\n        description: 'Remove resources from the team',\n        resource: 'resource',\n        action: 'delete'\n      },\n      {\n        id: 'settings.manage',\n        name: 'Manage Settings',\n        description: 'Change team settings and configurations',\n        resource: 'settings',\n        action: 'manage'\n      }\n    ];\n\n    defaultPermissions.forEach(permission => {\n      this.permissions.set(permission.id, permission);\n    });\n  }\n\n  /**\n   * Assign a role to a user in a team\n   */\n  async assignRole(userId: string, teamId: string, roleId: string, assignedBy: string): Promise<boolean> {\n    const role = this.roles.get(roleId);\n    if (!role) {\n      console.error(`Role with ID ${roleId} not found`);\n      return false;\n    }\n\n    // Get existing roles for user\n    const userRoles = this.userTeamRoles.get(userId) || [];\n    \n    // Check if user already has a role in this team\n    const existingRoleIndex = userRoles.findIndex(ur => ur.teamId === teamId);\n    \n    if (existingRoleIndex !== -1) {\n      // Update existing role\n      userRoles[existingRoleIndex] = {\n        userId,\n        teamId,\n        roleId,\n        assignedAt: new Date(),\n        assignedBy\n      };\n    } else {\n      // Add new role\n      userRoles.push({\n        userId,\n        teamId,\n        roleId,\n        assignedAt: new Date(),\n        assignedBy\n      });\n    }\n\n    this.userTeamRoles.set(userId, userRoles);\n    return true;\n  }\n\n  /**\n   * Remove a role from a user in a team\n   */\n  async removeRole(userId: string, teamId: string): Promise<boolean> {\n    const userRoles = this.userTeamRoles.get(userId) || [];\n    const filteredRoles = userRoles.filter(ur => ur.teamId !== teamId);\n    \n    if (filteredRoles.length !== userRoles.length) {\n      this.userTeamRoles.set(userId, filteredRoles);\n      return true;\n    }\n    \n    return false;\n  }\n\n  /**\n   * Check if a user has a specific permission in a team\n   */\n  async hasPermission(userId: string, teamId: string, permissionId: string): Promise<boolean> {\n    // Get user's role in the team\n    const userRoles = this.userTeamRoles.get(userId) || [];\n    const userTeamRole = userRoles.find(ur => ur.teamId === teamId);\n    \n    if (!userTeamRole) {\n      return false;\n    }\n\n    // Get the role\n    const role = this.roles.get(userTeamRole.roleId);\n    if (!role) {\n      return false;\n    }\n\n    // Check if the role has the required permission\n    return role.permissions.includes(permissionId);\n  }\n\n  /**\n   * Check if a user can perform an action on a resource\n   */\n  async canUserPerformAction(\n    userId: string,\n    teamId: string,\n    resourceType: string,\n    action: string\n  ): Promise<boolean> {\n    // Construct permission ID based on resource and action\n    const permissionId = `${resourceType}.${action}`;\n    \n    return await this.hasPermission(userId, teamId, permissionId);\n  }\n\n  /**\n   * Get all permissions for a user in a team\n   */\n  async getUserPermissions(userId: string, teamId: string): Promise<Permission[]> {\n    const userRoles = this.userTeamRoles.get(userId) || [];\n    const userTeamRole = userRoles.find(ur => ur.teamId === teamId);\n    \n    if (!userTeamRole) {\n      return [];\n    }\n\n    const role = this.roles.get(userTeamRole.roleId);\n    if (!role) {\n      return [];\n    }\n\n    return role.permissions\n      .map(permissionId => this.permissions.get(permissionId))\n      .filter((permission): permission is Permission => permission !== undefined);\n  }\n\n  /**\n   * Get all roles for a user in a team\n   */\n  async getUserRoles(userId: string, teamId: string): Promise<Role[]> {\n    const userRoles = this.userTeamRoles.get(userId) || [];\n    const userTeamRole = userRoles.find(ur => ur.teamId === teamId);\n    \n    if (!userTeamRole) {\n      return [];\n    }\n\n    const role = this.roles.get(userTeamRole.roleId);\n    if (!role) {\n      return [];\n    }\n\n    return [role];\n  }\n\n  /**\n   * Create a custom role\n   */\n  async createCustomRole(\n    name: string,\n    description: string,\n    permissions: string[],\n    teamId: string\n  ): Promise<Role | null> {\n    // Validate permissions exist\n    for (const permId of permissions) {\n      if (!this.permissions.has(permId)) {\n        console.error(`Permission ${permId} does not exist`);\n        return null;\n      }\n    }\n\n    const roleId = `role-${teamId}-${Date.now()}`;\n    const newRole: Role = {\n      id: roleId,\n      name,\n      description,\n      permissions,\n      systemRole: false\n    };\n\n    this.roles.set(roleId, newRole);\n    return newRole;\n  }\n\n  /**\n   * Update a custom role\n   */\n  async updateRole(roleId: string, updates: Partial<Role>): Promise<boolean> {\n    const role = this.roles.get(roleId);\n    if (!role || role.systemRole) {\n      // Cannot update system roles\n      return false;\n    }\n\n    // If updating permissions, validate them\n    if (updates.permissions) {\n      for (const permId of updates.permissions) {\n        if (!this.permissions.has(permId)) {\n          console.error(`Permission ${permId} does not exist`);\n          return false;\n        }\n      }\n    }\n\n    Object.assign(role, updates);\n    return true;\n  }\n\n  /**\n   * Delete a custom role\n   */\n  async deleteRole(roleId: string): Promise<boolean> {\n    const role = this.roles.get(roleId);\n    if (!role || role.systemRole) {\n      // Cannot delete system roles\n      return false;\n    }\n\n    // Check if any users have this role\n    for (const [userId, userRoles] of this.userTeamRoles) {\n      if (userRoles.some(ur => ur.roleId === roleId)) {\n        // Move users to default role (viewer) or return error\n        const updatedRoles = userRoles.filter(ur => ur.roleId !== roleId);\n        this.userTeamRoles.set(userId, updatedRoles);\n      }\n    }\n\n    this.roles.delete(roleId);\n    return true;\n  }\n\n  /**\n   * Get all roles in a team\n   */\n  async getTeamRoles(teamId: string): Promise<Role[]> {\n    // For system roles, return all of them\n    // For custom roles, we'd need to track which roles belong to which team\n    // In this simplified version, we'll return all roles\n    return Array.from(this.roles.values());\n  }\n\n  /**\n   * Get all system roles\n   */\n  getSystemRoles(): Role[] {\n    return Array.from(this.roles.values()).filter(role => role.systemRole);\n  }\n\n  /**\n   * Get all custom roles for a team\n   */\n  getCustomRoles(teamId: string): Role[] {\n    // In a real implementation, we'd track which custom roles belong to which team\n    // For now, return all non-system roles\n    return Array.from(this.roles.values()).filter(role => !role.systemRole);\n  }\n\n  /**\n   * Get all permissions\n   */\n  getAllPermissions(): Permission[] {\n    return Array.from(this.permissions.values());\n  }\n\n  /**\n   * Create a new permission\n   */\n  async createPermission(\n    name: string,\n    description: string,\n    resource: string,\n    action: string\n  ): Promise<Permission | null> {\n    // Generate a unique ID for the permission\n    const permissionId = `perm-${resource}-${action}-${Date.now()}`;\n    \n    const newPermission: Permission = {\n      id: permissionId,\n      name,\n      description,\n      resource,\n      action\n    };\n\n    this.permissions.set(permissionId, newPermission);\n    return newPermission;\n  }\n\n  /**\n   * Check multiple permissions at once\n   */\n  async checkMultiplePermissions(\n    userId: string,\n    teamId: string,\n    permissionIds: string[]\n  ): Promise<Record<string, boolean>> {\n    const results: Record<string, boolean> = {};\n    \n    for (const permId of permissionIds) {\n      results[permId] = await this.hasPermission(userId, teamId, permId);\n    }\n    \n    return results;\n  }\n\n  /**\n   * Get effective permissions for a user in a team\n   * This would combine role-based permissions with any direct resource permissions\n   */\n  async getEffectivePermissions(userId: string, teamId: string): Promise<Permission[]> {\n    // Get role-based permissions\n    const rolePermissions = await this.getUserPermissions(userId, teamId);\n    \n    // In a real implementation, we'd also check for direct resource permissions\n    // For now, just return role-based permissions\n    return rolePermissions;\n  }\n}\n\n// Singleton instance\nexport const permissionManager = new PermissionManager();\n\nexport default permissionManager;\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/team/shared-results.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[550,553],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[550,553],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1080,1083],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1080,1083],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":303,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":303,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8484,8487],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8484,8487],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":395,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":395,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10843,10846],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10843,10846],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Shared Results - Collaborative analysis and shared extractions\n */\n\nimport { v4 as uuidv4 } from 'uuid';\n\nexport interface SharedResult {\n  id: string;\n  resultId: string; // Reference to the original extraction result\n  teamId: string;\n  sharedBy: string; // User ID of the person who shared\n  sharedAt: Date;\n  permissions: 'view' | 'comment' | 'edit';\n  expirationDate?: Date;\n  viewers: string[]; // User IDs who can view\n  editors: string[]; // User IDs who can edit\n  title: string;\n  description?: string;\n  tags: string[];\n  metadata: any; // The actual shared metadata result\n  accessCount: number;\n  lastAccessed?: Date;\n  isArchived: boolean;\n}\n\nexport interface SharedResultComment {\n  id: string;\n  sharedResultId: string;\n  authorId: string;\n  content: string;\n  createdAt: Date;\n  updatedAt: Date;\n  resolved: boolean;\n  parentCommentId?: string; // For threaded comments\n}\n\nexport interface SharedResultAccessLog {\n  id: string;\n  sharedResultId: string;\n  userId: string;\n  action: 'view' | 'download' | 'comment' | 'edit';\n  timestamp: Date;\n  metadata?: any; // Additional context about the access\n}\n\nexport interface SharedResultNotification {\n  id: string;\n  sharedResultId: string;\n  userId: string; // The user to notify\n  type: 'new_comment' | 'result_updated' | 'access_revoked' | 'mention';\n  message: string;\n  read: boolean;\n  createdAt: Date;\n}\n\nexport class SharedResultsManager {\n  private sharedResults: Map<string, SharedResult> = new Map();\n  private comments: Map<string, SharedResultComment[]> = new Map();\n  private accessLogs: Map<string, SharedResultAccessLog[]> = new Map();\n  private notifications: Map<string, SharedResultNotification[]> = new Map();\n\n  /**\n   * Share a result with a team\n   */\n  async shareResult(\n    resultId: string,\n    teamId: string,\n    sharedBy: string,\n    title: string,\n    description: string | undefined,\n    permissions: 'view' | 'comment' | 'edit',\n    expirationDate?: Date,\n    tags: string[] = []\n  ): Promise<SharedResult | null> {\n    const sharedResultId = uuidv4();\n    \n    const newSharedResult: SharedResult = {\n      id: sharedResultId,\n      resultId,\n      teamId,\n      sharedBy,\n      sharedAt: new Date(),\n      permissions,\n      expirationDate,\n      viewers: [sharedBy], // Original sharer can always view\n      editors: permissions === 'edit' ? [sharedBy] : [],\n      title,\n      description,\n      tags,\n      metadata: {}, // This would be populated with the actual result data\n      accessCount: 0,\n      isArchived: false\n    };\n\n    this.sharedResults.set(sharedResultId, newSharedResult);\n    return newSharedResult;\n  }\n\n  /**\n   * Get a shared result by ID\n   */\n  async getSharedResult(sharedResultId: string): Promise<SharedResult | null> {\n    const result = this.sharedResults.get(sharedResultId);\n    \n    // Check if result is expired\n    if (result && result.expirationDate && result.expirationDate < new Date()) {\n      // In a real implementation, we'd remove expired results\n      // For now, just return null to indicate it's not accessible\n      return null;\n    }\n    \n    return result || null;\n  }\n\n  /**\n   * Check if a user can access a shared result\n   */\n  async canUserAccess(userId: string, sharedResultId: string): Promise<boolean> {\n    const result = await this.getSharedResult(sharedResultId);\n    if (!result) return false;\n\n    // Check if user is in the appropriate permission list\n    if (result.permissions === 'edit') {\n      return result.editors.includes(userId);\n    } else if (result.permissions === 'comment') {\n      return result.editors.includes(userId) || result.viewers.includes(userId);\n    } else { // view only\n      return result.viewers.includes(userId);\n    }\n  }\n\n  /**\n   * Add a user to a shared result\n   */\n  async addUserToSharedResult(\n    sharedResultId: string,\n    userId: string,\n    permission: 'view' | 'comment' | 'edit'\n  ): Promise<boolean> {\n    const result = this.sharedResults.get(sharedResultId);\n    if (!result) return false;\n\n    // Add user to appropriate list based on permission\n    if (permission === 'edit') {\n      if (!result.editors.includes(userId)) {\n        result.editors.push(userId);\n      }\n      if (!result.viewers.includes(userId)) {\n        result.viewers.push(userId);\n      }\n    } else if (permission === 'comment') {\n      if (!result.editors.includes(userId)) {\n        // Don't add to editors, but ensure they can view\n        if (!result.viewers.includes(userId)) {\n          result.viewers.push(userId);\n        }\n      }\n    } else { // view\n      if (!result.viewers.includes(userId)) {\n        result.viewers.push(userId);\n      }\n    }\n\n    result.accessCount += 1; // Increment access count when adding users\n    return true;\n  }\n\n  /**\n   * Remove a user from a shared result\n   */\n  async removeUserFromSharedResult(sharedResultId: string, userId: string): Promise<boolean> {\n    const result = this.sharedResults.get(sharedResultId);\n    if (!result) return false;\n\n    // Remove user from all permission lists\n    result.viewers = result.viewers.filter(id => id !== userId);\n    result.editors = result.editors.filter(id => id !== userId);\n\n    return true;\n  }\n\n  /**\n   * Get all shared results for a team\n   */\n  async getTeamSharedResults(teamId: string): Promise<SharedResult[]> {\n    return Array.from(this.sharedResults.values())\n      .filter(result => result.teamId === teamId && !result.isArchived)\n      .sort((a, b) => b.sharedAt.getTime() - a.sharedAt.getTime());\n  }\n\n  /**\n   * Get all shared results accessible to a user\n   */\n  async getUserAccessibleResults(userId: string): Promise<SharedResult[]> {\n    return Array.from(this.sharedResults.values())\n      .filter(result => \n        (result.viewers.includes(userId) || result.editors.includes(userId)) && \n        !result.isArchived &&\n        (!result.expirationDate || result.expirationDate > new Date())\n      )\n      .sort((a, b) => b.sharedAt.getTime() - a.sharedAt.getTime());\n  }\n\n  /**\n   * Add a comment to a shared result\n   */\n  async addComment(\n    sharedResultId: string,\n    authorId: string,\n    content: string,\n    parentCommentId?: string\n  ): Promise<SharedResultComment | null> {\n    if (!(await this.canUserAccess(authorId, sharedResultId))) {\n      return null;\n    }\n\n    const commentId = uuidv4();\n    const newComment: SharedResultComment = {\n      id: commentId,\n      sharedResultId,\n      authorId,\n      content,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n      resolved: false,\n      parentCommentId\n    };\n\n    if (!this.comments.has(sharedResultId)) {\n      this.comments.set(sharedResultId, []);\n    }\n\n    const commentList = this.comments.get(sharedResultId)!;\n    commentList.push(newComment);\n\n    // Update access count for the shared result\n    const result = this.sharedResults.get(sharedResultId);\n    if (result) {\n      result.accessCount += 1;\n    }\n\n    // Create notification for other collaborators\n    await this.createNotification(\n      sharedResultId,\n      authorId,\n      'new_comment',\n      `New comment on \"${this.sharedResults.get(sharedResultId)?.title || 'shared result'}\"`\n    );\n\n    return newComment;\n  }\n\n  /**\n   * Get comments for a shared result\n   */\n  async getComments(sharedResultId: string): Promise<SharedResultComment[]> {\n    return this.comments.get(sharedResultId) || [];\n  }\n\n  /**\n   * Update a comment\n   */\n  async updateComment(\n    commentId: string,\n    sharedResultId: string,\n    authorId: string,\n    newContent: string\n  ): Promise<boolean> {\n    const commentList = this.comments.get(sharedResultId) || [];\n    const commentIndex = commentList.findIndex(c => c.id === commentId && c.authorId === authorId);\n\n    if (commentIndex === -1) return false;\n\n    commentList[commentIndex].content = newContent;\n    commentList[commentIndex].updatedAt = new Date();\n    return true;\n  }\n\n  /**\n   * Delete a comment\n   */\n  async deleteComment(\n    commentId: string,\n    sharedResultId: string,\n    authorId: string\n  ): Promise<boolean> {\n    const commentList = this.comments.get(sharedResultId) || [];\n    const commentIndex = commentList.findIndex(c => c.id === commentId && c.authorId === authorId);\n\n    if (commentIndex === -1) return false;\n\n    commentList.splice(commentIndex, 1);\n    return true;\n  }\n\n  /**\n   * Log access to a shared result\n   */\n  async logAccess(\n    sharedResultId: string,\n    userId: string,\n    action: 'view' | 'download' | 'comment' | 'edit',\n    metadata?: any\n  ): Promise<boolean> {\n    const accessLogId = uuidv4();\n    const newLog: SharedResultAccessLog = {\n      id: accessLogId,\n      sharedResultId,\n      userId,\n      action,\n      timestamp: new Date(),\n      metadata\n    };\n\n    if (!this.accessLogs.has(sharedResultId)) {\n      this.accessLogs.set(sharedResultId, []);\n    }\n\n    const logList = this.accessLogs.get(sharedResultId)!;\n    logList.push(newLog);\n\n    // Update access count for the shared result\n    const result = this.sharedResults.get(sharedResultId);\n    if (result) {\n      result.accessCount += 1;\n      result.lastAccessed = new Date();\n    }\n\n    return true;\n  }\n\n  /**\n   * Get access logs for a shared result\n   */\n  async getAccessLogs(sharedResultId: string): Promise<SharedResultAccessLog[]> {\n    return this.accessLogs.get(sharedResultId) || [];\n  }\n\n  /**\n   * Create a notification\n   */\n  async createNotification(\n    sharedResultId: string,\n    userId: string,\n    type: 'new_comment' | 'result_updated' | 'access_revoked' | 'mention',\n    message: string\n  ): Promise<SharedResultNotification | null> {\n    const notificationId = uuidv4();\n    const newNotification: SharedResultNotification = {\n      id: notificationId,\n      sharedResultId,\n      userId, // The user to notify (in this simplified version, it's the same as the action performer)\n      type,\n      message,\n      read: false,\n      createdAt: new Date()\n    };\n\n    if (!this.notifications.has(userId)) {\n      this.notifications.set(userId, []);\n    }\n\n    const notificationList = this.notifications.get(userId)!;\n    notificationList.push(newNotification);\n\n    return newNotification;\n  }\n\n  /**\n   * Get notifications for a user\n   */\n  async getUserNotifications(userId: string): Promise<SharedResultNotification[]> {\n    return this.notifications.get(userId) || [];\n  }\n\n  /**\n   * Mark a notification as read\n   */\n  async markNotificationAsRead(notificationId: string, userId: string): Promise<boolean> {\n    const notificationList = this.notifications.get(userId) || [];\n    const notification = notificationList.find(n => n.id === notificationId);\n\n    if (!notification) return false;\n\n    notification.read = true;\n    return true;\n  }\n\n  /**\n   * Update shared result metadata\n   */\n  async updateSharedResultMetadata(\n    sharedResultId: string,\n    userId: string,\n    newMetadata: any\n  ): Promise<boolean> {\n    const result = this.sharedResults.get(sharedResultId);\n    if (!result) return false;\n\n    // Check if user has edit permissions\n    if (!result.editors.includes(userId)) {\n      return false;\n    }\n\n    result.metadata = { ...result.metadata, ...newMetadata };\n    result.accessCount += 1; // Increment access count when updating\n\n    // Create notification for other collaborators\n    await this.createNotification(\n      sharedResultId,\n      userId,\n      'result_updated',\n      `Shared result \"${result.title}\" has been updated`\n    );\n\n    return true;\n  }\n\n  /**\n   * Archive a shared result\n   */\n  async archiveSharedResult(sharedResultId: string, userId: string): Promise<boolean> {\n    const result = this.sharedResults.get(sharedResultId);\n    if (!result) return false;\n\n    // Only editors or the original sharer can archive\n    if (result.sharedBy !== userId && !result.editors.includes(userId)) {\n      return false;\n    }\n\n    result.isArchived = true;\n    return true;\n  }\n\n  /**\n   * Search shared results by tags or title\n   */\n  async searchSharedResults(\n    userId: string,\n    searchTerm: string,\n    tags?: string[]\n  ): Promise<SharedResult[]> {\n    const userResults = await this.getUserAccessibleResults(userId);\n    \n    return userResults.filter(result => {\n      // Check search term in title or description\n      const matchesSearch = !searchTerm || \n        result.title.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        (result.description && result.description.toLowerCase().includes(searchTerm.toLowerCase()));\n      \n      // Check tags\n      const matchesTags = !tags || tags.every(tag => result.tags.includes(tag));\n      \n      return matchesSearch && matchesTags;\n    });\n  }\n\n  /**\n   * Get shared result statistics for a team\n   */\n  async getTeamStats(teamId: string) {\n    const teamResults = await this.getTeamSharedResults(teamId);\n    \n    return {\n      totalShared: teamResults.length,\n      totalViews: teamResults.reduce((sum, result) => sum + result.accessCount, 0),\n      totalComments: Array.from(this.comments.values()).flat().length,\n      activeResults: teamResults.filter(r => !r.isArchived).length\n    };\n  }\n}\n\n// Singleton instance\nexport const sharedResultsManager = new SharedResultsManager();\n\nexport default sharedResultsManager;","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/team/team-analytics.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[243,246],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[243,246],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1550,1553],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1550,1553],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Team Analytics - Team metrics and activity tracking\n */\n\nexport interface TeamActivity {\n  id: string;\n  teamId: string;\n  userId: string;\n  action: string;\n  resourceType: string;\n  resourceId?: string;\n  timestamp: Date;\n  metadata?: any;\n}\n\nexport interface TeamMetrics {\n  teamId: string;\n  period: {\n    start: Date;\n    end: Date;\n  };\n  metrics: {\n    totalUsers: number;\n    activeUsers: number;\n    totalSharedResults: number;\n    sharedResultsViews: number;\n    totalComments: number;\n    collaborationEvents: number;\n    fileUploads: number;\n    extractionCount: number;\n    apiRequests: number;\n    storageUsed: number; // in MB\n  };\n  userEngagement: {\n    userId: string;\n    name: string;\n    activityCount: number;\n    lastActive: Date;\n    engagementScore: number; // 0-100\n  }[];\n  resourceUsage: {\n    resourceType: string;\n    count: number;\n    change: number; // compared to previous period\n  }[];\n}\n\nexport interface TeamReport {\n  id: string;\n  teamId: string;\n  title: string;\n  description: string;\n  generatedAt: Date;\n  generatedBy: string;\n  period: {\n    start: Date;\n    end: Date;\n  };\n  metrics: TeamMetrics;\n  insights: string[];\n  recommendations: string[];\n}\n\nexport class TeamAnalytics {\n  private teamActivities: Map<string, TeamActivity[]> = new Map();\n  private teamMetricsCache: Map<string, TeamMetrics> = new Map();\n\n  /**\n   * Log a team activity\n   */\n  async logActivity(\n    teamId: string,\n    userId: string,\n    action: string,\n    resourceType: string,\n    resourceId?: string,\n    metadata?: any\n  ): Promise<string> {\n    const activityId = `activity-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n    \n    const activity: TeamActivity = {\n      id: activityId,\n      teamId,\n      userId,\n      action,\n      resourceType,\n      resourceId,\n      timestamp: new Date(),\n      metadata\n    };\n\n    if (!this.teamActivities.has(teamId)) {\n      this.teamActivities.set(teamId, []);\n    }\n\n    const activities = this.teamActivities.get(teamId)!;\n    activities.push(activity);\n\n    // Invalidate metrics cache for this team\n    this.teamMetricsCache.delete(teamId);\n\n    return activityId;\n  }\n\n  /**\n   * Get team activities for a period\n   */\n  async getTeamActivities(\n    teamId: string,\n    startDate: Date,\n    endDate: Date\n  ): Promise<TeamActivity[]> {\n    const allActivities = this.teamActivities.get(teamId) || [];\n    return allActivities.filter(activity => \n      activity.timestamp >= startDate && activity.timestamp <= endDate\n    );\n  }\n\n  /**\n   * Calculate team metrics for a period\n   */\n  async calculateTeamMetrics(\n    teamId: string,\n    startDate: Date,\n    endDate: Date\n  ): Promise<TeamMetrics> {\n    // Check if we have cached metrics for this period\n    const cacheKey = `${teamId}-${startDate.toISOString()}-${endDate.toISOString()}`;\n    const cached = this.teamMetricsCache.get(cacheKey);\n    if (cached) {\n      return cached;\n    }\n\n    const activities = await this.getTeamActivities(teamId, startDate, endDate);\n\n    // Calculate basic metrics\n    const uniqueUsers = new Set(activities.map(a => a.userId));\n    const activeUsers = new Set<string>();\n    const userActivityCount = new Map<string, number>();\n    \n    let sharedResultsCount = 0;\n    let sharedResultsViews = 0;\n    let commentsCount = 0;\n    let collaborationEvents = 0;\n    let fileUploads = 0;\n    let extractionCount = 0;\n    let apiRequests = 0;\n\n    for (const activity of activities) {\n      activeUsers.add(activity.userId);\n      \n      // Count user activities\n      userActivityCount.set(\n        activity.userId, \n        (userActivityCount.get(activity.userId) || 0) + 1\n      );\n\n      // Count different types of activities\n      if (activity.resourceType === 'shared_result') {\n        sharedResultsCount++;\n        if (activity.action === 'view') sharedResultsViews++;\n      }\n      \n      if (activity.action === 'comment') commentsCount++;\n      if (activity.action.includes('collaborate')) collaborationEvents++;\n      if (activity.action === 'upload') fileUploads++;\n      if (activity.action === 'extract') extractionCount++;\n      if (activity.resourceType === 'api') apiRequests++;\n    }\n\n    // Calculate user engagement\n    const userEngagement = Array.from(uniqueUsers).map(userId => {\n      const activityCount = userActivityCount.get(userId) || 0;\n      // Engagement score based on activity count (simplified calculation)\n      const engagementScore = Math.min(100, Math.round((activityCount / 10) * 20));\n      \n      // Find last active date for this user\n      const userActivities = activities.filter(a => a.userId === userId);\n      const lastActive = userActivities.length > 0 \n        ? userActivities.reduce((latest, current) => \n            current.timestamp > latest ? current.timestamp : latest, \n            new Date(0)\n          )\n        : new Date(0);\n\n      return {\n        userId,\n        name: `User ${userId.substring(0, 8)}`, // In real app, get from user service\n        activityCount,\n        lastActive,\n        engagementScore\n      };\n    });\n\n    // Calculate resource usage\n    const resourceUsage = Array.from(\n      activities.reduce((acc, activity) => {\n        const count = acc.get(activity.resourceType) || 0;\n        acc.set(activity.resourceType, count + 1);\n        return acc;\n      }, new Map<string, number>())\n    ).map(([resourceType, count]) => ({\n      resourceType,\n      count,\n      change: 0 // Would compare to previous period in real implementation\n    }));\n\n    const metrics: TeamMetrics = {\n      teamId,\n      period: { start: startDate, end: endDate },\n      metrics: {\n        totalUsers: uniqueUsers.size,\n        activeUsers: activeUsers.size,\n        totalSharedResults: sharedResultsCount,\n        sharedResultsViews,\n        totalComments: commentsCount,\n        collaborationEvents,\n        fileUploads,\n        extractionCount,\n        apiRequests,\n        storageUsed: 0 // Would come from storage service\n      },\n      userEngagement,\n      resourceUsage\n    };\n\n    // Cache the metrics\n    this.teamMetricsCache.set(cacheKey, metrics);\n\n    return metrics;\n  }\n\n  /**\n   * Generate a team report\n   */\n  async generateTeamReport(\n    teamId: string,\n    title: string,\n    description: string,\n    startDate: Date,\n    endDate: Date,\n    generatedBy: string\n  ): Promise<TeamReport> {\n    const metrics = await this.calculateTeamMetrics(teamId, startDate, endDate);\n    \n    // Generate insights based on metrics\n    const insights = this.generateInsights(metrics);\n    \n    // Generate recommendations based on metrics\n    const recommendations = this.generateRecommendations(metrics);\n\n    const report: TeamReport = {\n      id: `report-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n      teamId,\n      title,\n      description,\n      generatedAt: new Date(),\n      generatedBy,\n      period: { start: startDate, end: endDate },\n      metrics,\n      insights,\n      recommendations\n    };\n\n    return report;\n  }\n\n  /**\n   * Generate insights from metrics\n   */\n  private generateInsights(metrics: TeamMetrics): string[] {\n    const insights: string[] = [];\n    const m = metrics.metrics;\n\n    // User engagement insights\n    if (m.activeUsers / m.totalUsers > 0.8) {\n      insights.push('High team engagement with 80%+ of members active');\n    } else if (m.activeUsers / m.totalUsers < 0.3) {\n      insights.push('Low team engagement with less than 30% of members active');\n    }\n\n    // Collaboration insights\n    if (m.totalComments > 0) {\n      insights.push(`Team is actively collaborating with ${m.totalComments} comments`);\n    }\n\n    if (m.sharedResultsViews > 0) {\n      insights.push(`Shared results viewed ${m.sharedResultsViews} times`);\n    }\n\n    // Activity insights\n    if (m.extractionCount > 100) {\n      insights.push(`High usage with ${m.extractionCount} extractions performed`);\n    }\n\n    // Top contributors\n    if (metrics.userEngagement.length > 0) {\n      const topContributor = metrics.userEngagement\n        .sort((a, b) => b.activityCount - a.activityCount)[0];\n      \n      if (topContributor.activityCount > 10) {\n        insights.push(`${topContributor.name} is the most active contributor`);\n      }\n    }\n\n    return insights;\n  }\n\n  /**\n   * Generate recommendations from metrics\n   */\n  private generateRecommendations(metrics: TeamMetrics): string[] {\n    const recommendations: string[] = [];\n    const m = metrics.metrics;\n\n    // Engagement recommendations\n    if (m.activeUsers / m.totalUsers < 0.5) {\n      recommendations.push('Consider onboarding activities to increase team engagement');\n    }\n\n    // Collaboration recommendations\n    if (m.totalComments < 5) {\n      recommendations.push('Encourage more collaboration through shared result discussions');\n    }\n\n    // Usage recommendations\n    if (m.extractionCount < 10) {\n      recommendations.push('Explore ways to increase platform usage within the team');\n    }\n\n    // Resource recommendations\n    if (metrics.resourceUsage.length > 0) {\n      const topResource = metrics.resourceUsage\n        .sort((a, b) => b.count - a.count)[0];\n      \n      if (topResource.count > 20) {\n        recommendations.push(`Focus on ${topResource.resourceType} resources as they're most used`);\n      }\n    }\n\n    // User-specific recommendations\n    if (metrics.userEngagement.length > 0) {\n      const leastActive = metrics.userEngagement\n        .sort((a, b) => a.activityCount - b.activityCount)[0];\n      \n      if (leastActive.activityCount === 0) {\n        recommendations.push(`Reach out to ${leastActive.name} to understand their needs`);\n      }\n    }\n\n    return recommendations;\n  }\n\n  /**\n   * Get team activity trends\n   */\n  async getActivityTrends(\n    teamId: string,\n    period: 'daily' | 'weekly' | 'monthly',\n    startDate: Date,\n    endDate: Date\n  ) {\n    const activities = await this.getTeamActivities(teamId, startDate, endDate);\n    \n    // Group activities by the specified period\n    const groupedActivities: Record<string, TeamActivity[]> = {};\n    \n    for (const activity of activities) {\n      let key: string;\n      \n      switch (period) {\n        case 'daily':\n          key = activity.timestamp.toISOString().split('T')[0];\n          break;\n        case 'weekly': {\n          const weekStart = new Date(activity.timestamp);\n          weekStart.setDate(weekStart.getDate() - weekStart.getDay());\n          key = weekStart.toISOString().split('T')[0];\n          break;\n        }\n        case 'monthly':\n          key = `${activity.timestamp.getFullYear()}-${activity.timestamp.getMonth() + 1}`;\n          break;\n        default:\n          key = activity.timestamp.toISOString();\n      }\n      \n      if (!groupedActivities[key]) {\n        groupedActivities[key] = [];\n      }\n      \n      groupedActivities[key].push(activity);\n    }\n    \n    // Convert to chart-ready format\n    const trendData = Object.entries(groupedActivities).map(([periodKey, acts]) => ({\n      period: periodKey,\n      totalActivities: acts.length,\n      uniqueUsers: new Set(acts.map(a => a.userId)).size,\n      actions: Array.from(\n        acts.reduce((acc, act) => {\n          const count = acc.get(act.action) || 0;\n          acc.set(act.action, count + 1);\n          return acc;\n        }, new Map<string, number>())\n      ).map(([action, count]) => ({ action, count }))\n    }));\n    \n    return trendData;\n  }\n\n  /**\n   * Get user activity summary\n   */\n  async getUserActivitySummary(\n    teamId: string,\n    userId: string,\n    startDate: Date,\n    endDate: Date\n  ) {\n    const activities = await this.getTeamActivities(teamId, startDate, endDate);\n    const userActivities = activities.filter(a => a.userId === userId);\n    \n    const actionCounts = userActivities.reduce((acc, activity) => {\n      const count = acc[activity.action] || 0;\n      acc[activity.action] = count + 1;\n      return acc;\n    }, {} as Record<string, number>);\n    \n    return {\n      userId,\n      totalActivities: userActivities.length,\n      actionBreakdown: actionCounts,\n      lastActive: userActivities.length > 0 \n        ? userActivities[userActivities.length - 1].timestamp \n        : null\n    };\n  }\n\n  /**\n   * Get resource usage statistics\n   */\n  async getResourceUsageStats(\n    teamId: string,\n    startDate: Date,\n    endDate: Date\n  ) {\n    const activities = await this.getTeamActivities(teamId, startDate, endDate);\n    \n    const resourceStats = activities.reduce((acc, activity) => {\n      const resourceType = activity.resourceType;\n      if (!acc[resourceType]) {\n        acc[resourceType] = {\n          count: 0,\n          actions: {} as Record<string, number>\n        };\n      }\n      \n      acc[resourceType].count++;\n      \n      const actionCount = acc[resourceType].actions[activity.action] || 0;\n      acc[resourceType].actions[activity.action] = actionCount + 1;\n      \n      return acc;\n    }, {} as Record<string, { count: number; actions: Record<string, number> }>);\n\n    return resourceStats;\n  }\n\n  /**\n   * Get team comparison metrics\n   */\n  async getTeamComparison(\n    teamIds: string[],\n    startDate: Date,\n    endDate: Date\n  ) {\n    const comparisons = await Promise.all(\n      teamIds.map(async teamId => {\n        const metrics = await this.calculateTeamMetrics(teamId, startDate, endDate);\n        return {\n          teamId,\n          metrics: metrics.metrics,\n          userEngagementAvg: metrics.userEngagement.length > 0\n            ? metrics.userEngagement.reduce((sum, u) => sum + u.engagementScore, 0) / metrics.userEngagement.length\n            : 0\n        };\n      })\n    );\n\n    return comparisons;\n  }\n}\n\n// Singleton instance\nexport const teamAnalytics = new TeamAnalytics();\n\nexport default teamAnalytics;\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/team/team-manager.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/theme-provider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/upload-guards.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/use-responsive.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useCallback' is defined but never used.","line":10,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":42}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Responsive React Hooks\n * \n * Custom hooks for responsive behavior in React components.\n * \n * @module use-responsive\n * @validates Requirements 1.5 - Responsive design compliance\n */\n\nimport { useState, useEffect, useCallback, useMemo } from 'react';\nimport { \n  breakpointValues, \n  BreakpointKey, \n  getCurrentBreakpoint,\n  isMobile,\n  isTablet,\n  isDesktop,\n  mediaQueries\n} from './responsive';\n\n// ============================================================================\n// useBreakpoint Hook\n// ============================================================================\n\nexport interface BreakpointState {\n  breakpoint: BreakpointKey;\n  width: number;\n  height: number;\n  isMobile: boolean;\n  isTablet: boolean;\n  isDesktop: boolean;\n  isXs: boolean;\n  isSm: boolean;\n  isMd: boolean;\n  isLg: boolean;\n  isXl: boolean;\n  is2xl: boolean;\n}\n\n/**\n * Hook to track current breakpoint and viewport dimensions\n */\nexport function useBreakpoint(): BreakpointState {\n  const [state, setState] = useState<BreakpointState>(() => {\n    if (typeof window === 'undefined') {\n      return {\n        breakpoint: 'xs',\n        width: 320,\n        height: 568,\n        isMobile: true,\n        isTablet: false,\n        isDesktop: false,\n        isXs: true,\n        isSm: false,\n        isMd: false,\n        isLg: false,\n        isXl: false,\n        is2xl: false,\n      };\n    }\n    \n    const width = window.innerWidth;\n    const breakpoint = getCurrentBreakpoint();\n    \n    return {\n      breakpoint,\n      width,\n      height: window.innerHeight,\n      isMobile: isMobile(),\n      isTablet: isTablet(),\n      isDesktop: isDesktop(),\n      isXs: width < breakpointValues.sm,\n      isSm: width >= breakpointValues.sm && width < breakpointValues.md,\n      isMd: width >= breakpointValues.md && width < breakpointValues.lg,\n      isLg: width >= breakpointValues.lg && width < breakpointValues.xl,\n      isXl: width >= breakpointValues.xl && width < breakpointValues['2xl'],\n      is2xl: width >= breakpointValues['2xl'],\n    };\n  });\n\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n\n    let rafId: number;\n    \n    const handleResize = () => {\n      cancelAnimationFrame(rafId);\n      rafId = requestAnimationFrame(() => {\n        const width = window.innerWidth;\n        const breakpoint = getCurrentBreakpoint();\n        \n        setState({\n          breakpoint,\n          width,\n          height: window.innerHeight,\n          isMobile: isMobile(),\n          isTablet: isTablet(),\n          isDesktop: isDesktop(),\n          isXs: width < breakpointValues.sm,\n          isSm: width >= breakpointValues.sm && width < breakpointValues.md,\n          isMd: width >= breakpointValues.md && width < breakpointValues.lg,\n          isLg: width >= breakpointValues.lg && width < breakpointValues.xl,\n          isXl: width >= breakpointValues.xl && width < breakpointValues['2xl'],\n          is2xl: width >= breakpointValues['2xl'],\n        });\n      });\n    };\n\n    window.addEventListener('resize', handleResize);\n    return () => {\n      window.removeEventListener('resize', handleResize);\n      cancelAnimationFrame(rafId);\n    };\n  }, []);\n\n  return state;\n}\n\n// ============================================================================\n// useMediaQuery Hook\n// ============================================================================\n\n/**\n * Hook to check if a media query matches\n */\nexport function useMediaQuery(query: string): boolean {\n  const [matches, setMatches] = useState(() => {\n    if (typeof window === 'undefined') return false;\n    return window.matchMedia(query).matches;\n  });\n\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n\n    const mediaQuery = window.matchMedia(query);\n    setMatches(mediaQuery.matches);\n\n    const handler = (event: MediaQueryListEvent) => {\n      setMatches(event.matches);\n    };\n\n    mediaQuery.addEventListener('change', handler);\n    return () => mediaQuery.removeEventListener('change', handler);\n  }, [query]);\n\n  return matches;\n}\n\n/**\n * Hook to check if viewport is at or above a breakpoint\n */\nexport function useMinBreakpoint(breakpoint: BreakpointKey): boolean {\n  return useMediaQuery(mediaQueries[breakpoint]);\n}\n\n// ============================================================================\n// useResponsiveValue Hook\n// ============================================================================\n\n/**\n * Hook to get a value based on current breakpoint\n */\nexport function useResponsiveValue<T>(\n  values: Partial<Record<BreakpointKey, T>>,\n  defaultValue: T\n): T {\n  const { breakpoint } = useBreakpoint();\n  \n  return useMemo(() => {\n    const orderedBreakpoints: BreakpointKey[] = ['2xl', 'xl', 'lg', 'md', 'sm', 'xs'];\n    const breakpointIndex = orderedBreakpoints.indexOf(breakpoint);\n    \n    for (let i = breakpointIndex; i < orderedBreakpoints.length; i++) {\n      const bp = orderedBreakpoints[i];\n      if (values[bp] !== undefined) {\n        return values[bp] as T;\n      }\n    }\n    \n    return defaultValue;\n  }, [breakpoint, values, defaultValue]);\n}\n\n// ============================================================================\n// useContainerQuery Hook (simulated)\n// ============================================================================\n\nexport interface ContainerSize {\n  width: number;\n  height: number;\n  breakpoint: 'xs' | 'sm' | 'md' | 'lg' | 'xl';\n}\n\n/**\n * Hook to track container size (simulated container queries)\n */\nexport function useContainerQuery(ref: React.RefObject<HTMLElement>): ContainerSize {\n  const [size, setSize] = useState<ContainerSize>({\n    width: 0,\n    height: 0,\n    breakpoint: 'xs',\n  });\n\n  useEffect(() => {\n    if (!ref.current) return;\n\n    const getBreakpoint = (width: number): ContainerSize['breakpoint'] => {\n      if (width >= 1024) return 'xl';\n      if (width >= 768) return 'lg';\n      if (width >= 480) return 'md';\n      if (width >= 320) return 'sm';\n      return 'xs';\n    };\n\n    const observer = new ResizeObserver((entries) => {\n      for (const entry of entries) {\n        const { width, height } = entry.contentRect;\n        setSize({\n          width,\n          height,\n          breakpoint: getBreakpoint(width),\n        });\n      }\n    });\n\n    observer.observe(ref.current);\n    return () => observer.disconnect();\n  }, [ref]);\n\n  return size;\n}\n\n// ============================================================================\n// useOrientation Hook\n// ============================================================================\n\nexport type Orientation = 'portrait' | 'landscape';\n\n/**\n * Hook to track device orientation\n */\nexport function useOrientation(): Orientation {\n  const [orientation, setOrientation] = useState<Orientation>(() => {\n    if (typeof window === 'undefined') return 'portrait';\n    return window.innerHeight > window.innerWidth ? 'portrait' : 'landscape';\n  });\n\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n\n    const handleResize = () => {\n      setOrientation(\n        window.innerHeight > window.innerWidth ? 'portrait' : 'landscape'\n      );\n    };\n\n    window.addEventListener('resize', handleResize);\n    return () => window.removeEventListener('resize', handleResize);\n  }, []);\n\n  return orientation;\n}\n\n// ============================================================================\n// useScrollDirection Hook\n// ============================================================================\n\nexport type ScrollDirection = 'up' | 'down' | null;\n\n/**\n * Hook to track scroll direction (useful for hiding/showing headers)\n */\nexport function useScrollDirection(threshold: number = 10): ScrollDirection {\n  const [scrollDirection, setScrollDirection] = useState<ScrollDirection>(null);\n\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n\n    let lastScrollY = window.scrollY;\n    let ticking = false;\n\n    const updateScrollDirection = () => {\n      const scrollY = window.scrollY;\n      const diff = scrollY - lastScrollY;\n\n      if (Math.abs(diff) > threshold) {\n        setScrollDirection(diff > 0 ? 'down' : 'up');\n        lastScrollY = scrollY;\n      }\n      \n      ticking = false;\n    };\n\n    const handleScroll = () => {\n      if (!ticking) {\n        requestAnimationFrame(updateScrollDirection);\n        ticking = true;\n      }\n    };\n\n    window.addEventListener('scroll', handleScroll, { passive: true });\n    return () => window.removeEventListener('scroll', handleScroll);\n  }, [threshold]);\n\n  return scrollDirection;\n}\n\n// ============================================================================\n// useTouchDevice Hook\n// ============================================================================\n\n/**\n * Hook to detect touch device\n */\nexport function useTouchDevice(): boolean {\n  const [isTouch, setIsTouch] = useState(false);\n\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n    \n    setIsTouch(\n      'ontouchstart' in window ||\n      navigator.maxTouchPoints > 0\n    );\n  }, []);\n\n  return isTouch;\n}\n\n// ============================================================================\n// Export All\n// ============================================================================\n\nexport const responsiveHooks = {\n  useBreakpoint,\n  useMediaQuery,\n  useMinBreakpoint,\n  useResponsiveValue,\n  useContainerQuery,\n  useOrientation,\n  useScrollDirection,\n  useTouchDevice,\n} as const;\n\nexport default responsiveHooks;\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/utils.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[330,333],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[330,333],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Utility functions for the MetaExtract application\n */\n\nimport clsx from 'clsx';\nimport { twMerge } from 'tailwind-merge';\n\n/**\n * Compose class names using clsx and resolve Tailwind class conflicts with twMerge.\n * Accepts strings, arrays, objects, and conditional values similar to clsx.\n */\nexport function cn(...inputs: any[]) {\n  return twMerge(clsx(...inputs));\n}\n\n/**\n * Format file size in human-readable format\n * @param bytes File size in bytes\n * @returns Formatted file size string\n */\nexport function formatFileSize(bytes: number): string {\n  if (bytes === 0) return '0 Bytes';\n  const k = 1024;\n  const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n}\n\n/**\n * Get appropriate icon for file type\n * @param fileType MIME type of the file\n * @returns Icon component name as string\n */\nexport function getFileIcon(fileType: string): string {\n  if (fileType.includes('image')) return 'FileImage';\n  if (fileType.includes('pdf')) return 'FileText';\n  if (fileType.includes('dicom') || fileType.includes('medical'))\n    return 'Database';\n  if (fileType.includes('audio')) return 'Music';\n  if (fileType.includes('video')) return 'Video';\n  return 'File';\n}\n\n/**\n * Get file extension from filename\n * @param filename Name of the file\n * @returns File extension without the dot\n */\nexport function getFileExtension(filename: string): string {\n  const parts = filename.split('.');\n  return parts.length > 1 ? parts[parts.length - 1].toLowerCase() : '';\n}\n\n/**\n * Validate if a file type is supported\n * @param fileType MIME type of the file\n * @returns True if the file type is supported\n */\nexport function isFileTypeSupported(fileType: string): boolean {\n  const supportedTypes = [\n    'image/jpeg',\n    'image/png',\n    'image/tiff',\n    'image/gif',\n    'image/bmp',\n    'image/webp',\n    'application/pdf',\n    'application/dicom',\n    'image/dicom',\n    'audio/mp3',\n    'audio/wav',\n    'audio/flac',\n    'video/mp4',\n    'video/avi',\n    'video/mov',\n  ];\n\n  return supportedTypes.includes(fileType.toLowerCase());\n}\n\n/**\n * Get a color based on authenticity score\n * @param score Authenticity score (0-100)\n * @returns Tailwind CSS color class\n */\nexport function getAuthenticityColor(score: number): string {\n  if (score >= 80) return 'text-emerald-400';\n  if (score >= 60) return 'text-yellow-400';\n  return 'text-red-400';\n}\n\n/**\n * Format a date string to a more readable format\n * @param dateStr Date string to format\n * @returns Formatted date string\n */\nexport function formatDate(dateStr: string): string {\n  try {\n    const date = new Date(dateStr);\n    return date.toLocaleString();\n  } catch {\n    return dateStr;\n  }\n}\n\n/**\n * Sanitize a filename to remove potentially problematic characters\n * @param filename Original filename\n * @returns Sanitized filename\n */\nexport function sanitizeFilename(filename: string): string {\n  return filename.replace(/[<>:\"/\\\\|?*]/g, '_');\n}\n\n/**\n * Generate a human-readable label for a metadata key\n * @param key Metadata key\n * @returns Human-readable label\n */\nexport function getMetadataLabel(key: string): string {\n  return key.replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase());\n}\n\n/**\n * Get a color based on the severity of a finding\n * @param severity Severity level ('info', 'warning', 'critical')\n * @returns Tailwind CSS color class\n */\nexport function getSeverityColor(\n  severity: 'info' | 'warning' | 'critical'\n): string {\n  switch (severity) {\n    case 'critical':\n      return 'text-red-400';\n    case 'warning':\n      return 'text-yellow-400';\n    case 'info':\n      return 'text-blue-400';\n    default:\n      return 'text-slate-400';\n  }\n}\n\n/**\n * Calculate the percentage of a value relative to a total\n * @param value The value to calculate percentage for\n * @param total The total value\n * @returns Percentage as a number\n */\nexport function calculatePercentage(value: number, total: number): number {\n  if (total === 0) return 0;\n  return Math.round((value / total) * 100);\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/lib/workflows/workflow-engine.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[690,693],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[690,693],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[905,908],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[905,908],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1267,1270],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1267,1270],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1488,1491],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1488,1491],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1608,1611],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1608,1611],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1725,1728],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1725,1728],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":410,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":410,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10217,10220],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10217,10220],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":464,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":464,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11793,11796],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11793,11796],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":491,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":491,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12574,12577],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12574,12577],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":492,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":492,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12591,12594],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12591,12594],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":494,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":494,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12684,12687],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12684,12687],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":508,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":508,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13078,13081],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13078,13081],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":510,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":510,"endColumn":22,"suggestions":[{"fix":{"range":[13180,13241],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":523,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":523,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13415,13418],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13415,13418],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":524,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":524,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13432,13435],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13432,13435],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":547,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":547,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14211,14214],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14211,14214],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":549,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":549,"endColumn":16,"suggestions":[{"fix":{"range":[14298,14336],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":556,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":556,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14442,14445],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14442,14445],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":556,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":556,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14456,14459],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14456,14459],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":558,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":558,"endColumn":16,"suggestions":[{"fix":{"range":[14523,14562],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":565,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":565,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14707,14710],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14707,14710],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":565,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":565,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14721,14724],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14721,14724],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":567,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":567,"endColumn":16,"suggestions":[{"fix":{"range":[14791,14831],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":574,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":574,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14995,14998],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14995,14998],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":574,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":574,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15009,15012],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15009,15012],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":576,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":576,"endColumn":16,"suggestions":[{"fix":{"range":[15082,15124],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":583,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":583,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15275,15278],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15275,15278],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":583,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":583,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15289,15292],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15289,15292],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":585,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":585,"endColumn":16,"suggestions":[{"fix":{"range":[15364,15409],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":594,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":594,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15623,15626],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15623,15626],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":595,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":595,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15664,15667],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15664,15667],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":607,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":607,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15898,15901],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15898,15901],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":607,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":607,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15912,15915],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15912,15915],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":607,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":607,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15918,15921],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15918,15921],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":616,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":616,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16359,16362],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16359,16362],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":35,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Workflow Automation System - Visual workflow builder and execution engine\n */\n\nimport { v4 as uuidv4 } from 'uuid';\n\nexport interface Workflow {\n  id: string;\n  name: string;\n  description: string;\n  userId: string;\n  isActive: boolean;\n  createdAt: Date;\n  updatedAt: Date;\n  triggers: WorkflowTrigger[];\n  actions: WorkflowAction[];\n  conditions: WorkflowCondition[];\n  variables: WorkflowVariable[];\n  executionCount: number;\n  lastExecutedAt?: Date;\n  errorCount: number;\n  lastError?: string;\n}\n\nexport interface WorkflowTrigger {\n  id: string;\n  type:\n    | 'file_uploaded'\n    | 'extraction_completed'\n    | 'schedule'\n    | 'manual'\n    | 'webhook';\n  config: Record<string, any>;\n  enabled: boolean;\n}\n\nexport interface WorkflowAction {\n  id: string;\n  type:\n    | 'send_email'\n    | 'export_data'\n    | 'call_webhook'\n    | 'update_database'\n    | 'notify_user';\n  config: Record<string, any>;\n  nextActionId?: string; // For sequential execution\n  enabled: boolean;\n}\n\nexport interface WorkflowCondition {\n  id: string;\n  type: 'field_value' | 'file_type' | 'processing_time' | 'confidence_score';\n  operator:\n    | 'equals'\n    | 'not_equals'\n    | 'greater_than'\n    | 'less_than'\n    | 'contains'\n    | 'matches_regex';\n  field: string;\n  value: any;\n  nextActionId: string;\n  elseActionId?: string;\n  enabled: boolean;\n}\n\nexport interface WorkflowVariable {\n  id: string;\n  name: string;\n  type: 'string' | 'number' | 'boolean' | 'object' | 'array';\n  defaultValue: any;\n  description: string;\n}\n\nexport interface WorkflowExecution {\n  id: string;\n  workflowId: string;\n  triggerEvent: any;\n  startedAt: Date;\n  completedAt?: Date;\n  status: 'running' | 'completed' | 'failed' | 'cancelled';\n  results: any[];\n  error?: string;\n}\n\nexport interface WorkflowTemplate {\n  id: string;\n  name: string;\n  description: string;\n  category: string;\n  triggers: WorkflowTrigger[];\n  actions: WorkflowAction[];\n  conditions: WorkflowCondition[];\n  variables: WorkflowVariable[];\n  isBuiltIn: boolean;\n}\n\nexport class WorkflowAutomation {\n  private workflows: Map<string, Workflow> = new Map();\n  private executions: Map<string, WorkflowExecution> = new Map();\n  private templates: WorkflowTemplate[] = [];\n  private activeExecutions: Set<string> = new Set();\n\n  constructor() {\n    this.initializeBuiltInTemplates();\n  }\n\n  /**\n   * Initialize built-in workflow templates\n   */\n  private initializeBuiltInTemplates(): void {\n    this.templates = [\n      {\n        id: 'template-email-notification',\n        name: 'Email Notification on Extraction Complete',\n        description:\n          'Send an email notification when metadata extraction is completed',\n        category: 'notifications',\n        isBuiltIn: true,\n        triggers: [\n          {\n            id: 'trigger-extraction-complete',\n            type: 'extraction_completed',\n            config: {},\n            enabled: true,\n          },\n        ],\n        actions: [\n          {\n            id: 'action-send-email',\n            type: 'send_email',\n            config: {\n              to: '{{user.email}}',\n              subject: 'Metadata extraction completed for {{file.name}}',\n              body: 'Your metadata extraction for {{file.name}} is complete. View results at: {{result.url}}',\n            },\n            enabled: true,\n          },\n        ],\n        conditions: [],\n        variables: [\n          {\n            id: 'var-user-email',\n            name: 'user.email',\n            type: 'string',\n            defaultValue: '',\n            description: 'Email of the user who initiated the extraction',\n          },\n          {\n            id: 'var-file-name',\n            name: 'file.name',\n            type: 'string',\n            defaultValue: '',\n            description: 'Name of the file that was processed',\n          },\n          {\n            id: 'var-result-url',\n            name: 'result.url',\n            type: 'string',\n            defaultValue: '',\n            description: 'URL to view the extraction results',\n          },\n        ],\n      },\n      {\n        id: 'template-webhook-on-gps-found',\n        name: 'Webhook on GPS Data Found',\n        description:\n          'Call a webhook when GPS coordinates are found in metadata',\n        category: 'integrations',\n        isBuiltIn: true,\n        triggers: [\n          {\n            id: 'trigger-file-uploaded',\n            type: 'file_uploaded',\n            config: {},\n            enabled: true,\n          },\n        ],\n        actions: [\n          {\n            id: 'action-call-webhook',\n            type: 'call_webhook',\n            config: {\n              url: '{{webhook.url}}',\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json',\n              },\n              body: {\n                event: 'gps_found',\n                file: '{{file}}',\n                gps_coordinates: '{{metadata.gps}}',\n                timestamp: '{{timestamp}}',\n              },\n            },\n            enabled: true,\n          },\n        ],\n        conditions: [\n          {\n            id: 'condition-gps-present',\n            type: 'field_value',\n            operator: 'not_equals',\n            field: 'metadata.gps.latitude',\n            value: null,\n            nextActionId: 'action-call-webhook',\n            enabled: true,\n          },\n        ],\n        variables: [\n          {\n            id: 'var-webhook-url',\n            name: 'webhook.url',\n            type: 'string',\n            defaultValue: '',\n            description: 'URL of the webhook endpoint',\n          },\n          {\n            id: 'var-file',\n            name: 'file',\n            type: 'object',\n            defaultValue: {},\n            description: 'File object containing metadata',\n          },\n          {\n            id: 'var-metadata-gps',\n            name: 'metadata.gps',\n            type: 'object',\n            defaultValue: {},\n            description: 'GPS metadata from the file',\n          },\n          {\n            id: 'var-timestamp',\n            name: 'timestamp',\n            type: 'string',\n            defaultValue: new Date().toISOString(),\n            description: 'Timestamp of the event',\n          },\n        ],\n      },\n      {\n        id: 'template-batch-export',\n        name: 'Batch Export on Schedule',\n        description:\n          'Automatically export metadata for all files in a folder on a schedule',\n        category: 'automation',\n        isBuiltIn: true,\n        triggers: [\n          {\n            id: 'trigger-schedule',\n            type: 'schedule',\n            config: {\n              cron: '0 9 * * 1', // Every Monday at 9 AM\n              timezone: 'UTC',\n            },\n            enabled: true,\n          },\n        ],\n        actions: [\n          {\n            id: 'action-export-data',\n            type: 'export_data',\n            config: {\n              format: 'json',\n              destination: 'folder',\n              folderPath: '{{export.folder}}',\n            },\n            enabled: true,\n          },\n        ],\n        conditions: [],\n        variables: [\n          {\n            id: 'var-export-folder',\n            name: 'export.folder',\n            type: 'string',\n            defaultValue: '/exports/weekly',\n            description: 'Folder path for exporting data',\n          },\n        ],\n      },\n    ];\n  }\n\n  /**\n   * Create a new workflow\n   */\n  async createWorkflow(\n    userId: string,\n    name: string,\n    description: string,\n    config: {\n      triggers: WorkflowTrigger[];\n      actions: WorkflowAction[];\n      conditions?: WorkflowCondition[];\n      variables?: WorkflowVariable[];\n    }\n  ): Promise<Workflow> {\n    const workflow: Workflow = {\n      id: uuidv4(),\n      name,\n      description,\n      userId,\n      isActive: true,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n      triggers: config.triggers,\n      actions: config.actions,\n      conditions: config.conditions || [],\n      variables: config.variables || [],\n      executionCount: 0,\n      errorCount: 0,\n    };\n\n    this.workflows.set(workflow.id, workflow);\n    return workflow;\n  }\n\n  /**\n   * Get a workflow by ID\n   */\n  async getWorkflow(\n    workflowId: string,\n    userId: string\n  ): Promise<Workflow | null> {\n    const workflow = this.workflows.get(workflowId);\n    if (!workflow || workflow.userId !== userId) {\n      return null;\n    }\n    return workflow;\n  }\n\n  /**\n   * Update a workflow\n   */\n  async updateWorkflow(\n    workflowId: string,\n    userId: string,\n    updates: Partial<Workflow>\n  ): Promise<boolean> {\n    const workflow = await this.getWorkflow(workflowId, userId);\n    if (!workflow) return false;\n\n    Object.assign(workflow, updates, { updatedAt: new Date() });\n    return true;\n  }\n\n  /**\n   * Delete a workflow\n   */\n  async deleteWorkflow(workflowId: string, userId: string): Promise<boolean> {\n    const workflow = await this.getWorkflow(workflowId, userId);\n    if (!workflow) return false;\n\n    this.workflows.delete(workflowId);\n    return true;\n  }\n\n  /**\n   * Activate a workflow\n   */\n  async activateWorkflow(workflowId: string, userId: string): Promise<boolean> {\n    const workflow = await this.getWorkflow(workflowId, userId);\n    if (!workflow) return false;\n\n    workflow.isActive = true;\n    workflow.updatedAt = new Date();\n    return true;\n  }\n\n  /**\n   * Deactivate a workflow\n   */\n  async deactivateWorkflow(\n    workflowId: string,\n    userId: string\n  ): Promise<boolean> {\n    const workflow = await this.getWorkflow(workflowId, userId);\n    if (!workflow) return false;\n\n    workflow.isActive = false;\n    workflow.updatedAt = new Date();\n    return true;\n  }\n\n  /**\n   * Get user workflows\n   */\n  async getUserWorkflows(userId: string): Promise<Workflow[]> {\n    return Array.from(this.workflows.values()).filter(w => w.userId === userId);\n  }\n\n  /**\n   * Get workflow templates\n   */\n  async getTemplates(category?: string): Promise<WorkflowTemplate[]> {\n    if (category) {\n      return this.templates.filter(t => t.category === category);\n    }\n    return [...this.templates];\n  }\n\n  /**\n   * Execute a workflow manually\n   */\n  async executeWorkflow(\n    workflowId: string,\n    userId: string,\n    triggerEvent: any\n  ): Promise<WorkflowExecution> {\n    const workflow = await this.getWorkflow(workflowId, userId);\n    if (!workflow || !workflow.isActive) {\n      throw new Error('Workflow not found or not active');\n    }\n\n    const executionId = uuidv4();\n    const execution: WorkflowExecution = {\n      id: executionId,\n      workflowId,\n      triggerEvent,\n      startedAt: new Date(),\n      status: 'running',\n      results: [],\n    };\n\n    this.executions.set(executionId, execution);\n    this.activeExecutions.add(executionId);\n\n    try {\n      // Process workflow triggers\n      for (const trigger of workflow.triggers) {\n        if (!trigger.enabled) continue;\n\n        // Check if trigger matches the event\n        if (this.isTriggerMatch(trigger, triggerEvent)) {\n          // Execute workflow actions\n          const result = await this.executeActions(workflow, triggerEvent);\n          execution.results.push(result);\n        }\n      }\n\n      execution.status = 'completed';\n      execution.completedAt = new Date();\n      workflow.executionCount++;\n      workflow.lastExecutedAt = new Date();\n    } catch (error) {\n      execution.status = 'failed';\n      execution.completedAt = new Date();\n      execution.error = (error as Error).message;\n      workflow.errorCount++;\n      workflow.lastError = (error as Error).message;\n    } finally {\n      this.activeExecutions.delete(executionId);\n      workflow.updatedAt = new Date();\n    }\n\n    return execution;\n  }\n\n  /**\n   * Check if a trigger matches an event\n   */\n  private isTriggerMatch(trigger: WorkflowTrigger, event: any): boolean {\n    switch (trigger.type) {\n      case 'file_uploaded':\n        return event.type === 'file_uploaded';\n      case 'extraction_completed':\n        return event.type === 'extraction_completed';\n      case 'webhook':\n        return (\n          event.type === 'webhook' && event.source === trigger.config.source\n        );\n      case 'schedule':\n        // For scheduled triggers, we'd check against cron schedule\n        // This is a simplified implementation\n        return true;\n      case 'manual':\n        // Manual triggers are always considered matching when executed manually\n        return true;\n      default:\n        return false;\n    }\n  }\n\n  /**\n   * Execute workflow actions\n   */\n  private async executeActions(\n    workflow: Workflow,\n    triggerEvent: any\n  ): Promise<any> {\n    // Create context with variables and event data\n    const context: Record<string, any> = {\n      ...this.createVariableContext(workflow.variables),\n      event: triggerEvent,\n      timestamp: new Date().toISOString(),\n    };\n\n    let result = null;\n\n    // Execute actions sequentially\n    for (const action of workflow.actions) {\n      if (!action.enabled) continue;\n\n      try {\n        result = await this.executeAction(action, context);\n        (context as Record<string, any>)[action.id] = result; // Store result in context for next action\n      } catch (error) {\n        console.error(`Error executing action ${action.id}:`, error);\n        throw error;\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * Execute a single action\n   */\n  private async executeAction(\n    action: WorkflowAction,\n    context: any\n  ): Promise<any> {\n    // Replace variables in action config\n    const resolvedConfig = this.resolveVariables(action.config, context);\n\n    switch (action.type) {\n      case 'send_email':\n        return await this.executeEmailAction(resolvedConfig);\n      case 'export_data':\n        return await this.executeExportAction(resolvedConfig);\n      case 'call_webhook':\n        return await this.executeWebhookAction(resolvedConfig);\n      case 'update_database':\n        return await this.executeDatabaseAction(resolvedConfig);\n      case 'notify_user':\n        return await this.executeNotificationAction(resolvedConfig);\n      default:\n        throw new Error(`Unknown action type: ${action.type}`);\n    }\n  }\n\n  /**\n   * Execute email action\n   */\n  private async executeEmailAction(config: any): Promise<boolean> {\n    // In a real implementation, this would send an email\n    console.log('Sending email:', config);\n    return true;\n  }\n\n  /**\n   * Execute export action\n   */\n  private async executeExportAction(config: any): Promise<any> {\n    // In a real implementation, this would export data\n    console.log('Exporting data:', config);\n    return { success: true, exportedAt: new Date() };\n  }\n\n  /**\n   * Execute webhook action\n   */\n  private async executeWebhookAction(config: any): Promise<any> {\n    // In a real implementation, this would call a webhook\n    console.log('Calling webhook:', config);\n    return { success: true, response: 'Webhook called successfully' };\n  }\n\n  /**\n   * Execute database action\n   */\n  private async executeDatabaseAction(config: any): Promise<any> {\n    // In a real implementation, this would update a database\n    console.log('Updating database:', config);\n    return { success: true, recordsAffected: 1 };\n  }\n\n  /**\n   * Execute notification action\n   */\n  private async executeNotificationAction(config: any): Promise<any> {\n    // In a real implementation, this would send a notification\n    console.log('Sending notification:', config);\n    return { success: true, notificationId: uuidv4() };\n  }\n\n  /**\n   * Create variable context from workflow variables\n   */\n  private createVariableContext(\n    variables: WorkflowVariable[]\n  ): Record<string, any> {\n    const context: Record<string, any> = {};\n\n    for (const variable of variables) {\n      context[variable.name] = variable.defaultValue;\n    }\n\n    return context;\n  }\n\n  /**\n   * Resolve variables in a configuration object\n   */\n  private resolveVariables(config: any, context: any): any {\n    if (typeof config === 'string') {\n      // Simple variable replacement: {{variable.name}}\n      return config.replace(/\\{\\{([^}]+)\\}\\}/g, (match, varName) => {\n        return context[varName.trim()] || match;\n      });\n    } else if (Array.isArray(config)) {\n      return config.map(item => this.resolveVariables(item, context));\n    } else if (typeof config === 'object' && config !== null) {\n      const resolved: Record<string, any> = {};\n      for (const [key, value] of Object.entries(config)) {\n        resolved[key] = this.resolveVariables(value, context);\n      }\n      return resolved;\n    }\n    return config;\n  }\n\n  /**\n   * Get workflow execution history\n   */\n  async getExecutionHistory(\n    workflowId: string,\n    userId: string,\n    limit: number = 50\n  ): Promise<WorkflowExecution[]> {\n    const workflow = await this.getWorkflow(workflowId, userId);\n    if (!workflow) return [];\n\n    return Array.from(this.executions.values())\n      .filter(e => e.workflowId === workflowId)\n      .sort((a, b) => b.startedAt.getTime() - a.startedAt.getTime())\n      .slice(0, limit);\n  }\n\n  /**\n   * Get workflow statistics\n   */\n  async getWorkflowStats(\n    workflowId: string,\n    userId: string\n  ): Promise<{\n    totalExecutions: number;\n    successfulExecutions: number;\n    failedExecutions: number;\n    successRate: number;\n    avgExecutionTime: number;\n    lastExecution: Date | null;\n  } | null> {\n    const workflow = await this.getWorkflow(workflowId, userId);\n    if (!workflow) return null;\n\n    const executions = await this.getExecutionHistory(workflowId, userId, 1000);\n\n    const total = executions.length;\n    const successful = executions.filter(e => e.status === 'completed').length;\n    const failed = executions.filter(e => e.status === 'failed').length;\n\n    const successRate = total > 0 ? (successful / total) * 100 : 0;\n\n    const avgExecutionTime =\n      executions.length > 0\n        ? executions.reduce((sum, e) => {\n            if (e.completedAt && e.startedAt) {\n              return sum + (e.completedAt.getTime() - e.startedAt.getTime());\n            }\n            return sum;\n          }, 0) / executions.length\n        : 0;\n\n    const lastExecution =\n      executions.length > 0 ? executions[0].startedAt : null;\n\n    return {\n      totalExecutions: total,\n      successfulExecutions: successful,\n      failedExecutions: failed,\n      successRate,\n      avgExecutionTime,\n      lastExecution,\n    };\n  }\n\n  /**\n   * Create workflow from template\n   */\n  async createFromTemplate(\n    templateId: string,\n    userId: string,\n    name: string,\n    configOverrides: Partial<Workflow> = {}\n  ): Promise<Workflow> {\n    const template = this.templates.find(t => t.id === templateId);\n    if (!template) {\n      throw new Error(`Template not found: ${templateId}`);\n    }\n\n    const workflow: Workflow = {\n      id: uuidv4(),\n      name,\n      description: template.description,\n      userId,\n      isActive: true,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n      triggers: JSON.parse(JSON.stringify(template.triggers)), // Deep clone\n      actions: JSON.parse(JSON.stringify(template.actions)), // Deep clone\n      conditions: JSON.parse(JSON.stringify(template.conditions || [])), // Deep clone\n      variables: JSON.parse(JSON.stringify(template.variables || [])), // Deep clone\n      executionCount: 0,\n      errorCount: 0,\n      ...configOverrides,\n    };\n\n    this.workflows.set(workflow.id, workflow);\n    return workflow;\n  }\n\n  /**\n   * Validate workflow configuration\n   */\n  async validateWorkflow(\n    workflow: Workflow\n  ): Promise<{ isValid: boolean; errors: string[] }> {\n    const errors: string[] = [];\n\n    // Validate triggers\n    if (!workflow.triggers || workflow.triggers.length === 0) {\n      errors.push('Workflow must have at least one trigger');\n    }\n\n    // Validate actions\n    if (!workflow.actions || workflow.actions.length === 0) {\n      errors.push('Workflow must have at least one action');\n    }\n\n    // Validate trigger/action references in conditions\n    for (const condition of workflow.conditions) {\n      if (\n        condition.nextActionId &&\n        !workflow.actions.some(a => a.id === condition.nextActionId)\n      ) {\n        errors.push(\n          `Condition ${condition.id} references non-existent action: ${condition.nextActionId}`\n        );\n      }\n      if (\n        condition.elseActionId &&\n        !workflow.actions.some(a => a.id === condition.elseActionId)\n      ) {\n        errors.push(\n          `Condition ${condition.id} references non-existent else action: ${condition.elseActionId}`\n        );\n      }\n    }\n\n    // Validate action sequence references\n    for (const action of workflow.actions) {\n      if (\n        action.nextActionId &&\n        !workflow.actions.some(a => a.id === action.nextActionId)\n      ) {\n        errors.push(\n          `Action ${action.id} references non-existent next action: ${action.nextActionId}`\n        );\n      }\n    }\n\n    return {\n      isValid: errors.length === 0,\n      errors,\n    };\n  }\n\n  /**\n   * Get active workflow count for a user\n   */\n  async getActiveWorkflowCount(userId: string): Promise<number> {\n    return Array.from(this.workflows.values()).filter(\n      w => w.userId === userId && w.isActive\n    ).length;\n  }\n}\n\n// Singleton instance\nexport const workflowAutomation = new WorkflowAutomation();\n\nexport default workflowAutomation;\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/main.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[310,313],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[310,313],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createRoot } from 'react-dom/client';\nimport App from './App';\nimport './index.css';\n\n// Bridge Vite-only env vars into shared code without requiring `import.meta`\n// in shared modules (which breaks Jest/ts-jest compilation in CommonJS mode).\nif (typeof globalThis !== 'undefined') {\n  (globalThis as any).__METAEXTRACT_DEV_FULL_ACCESS__ =\n    import.meta.env?.VITE_DEV_FULL_ACCESS;\n}\n\ncreateRoot(document.getElementById('root')!).render(<App />);\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/AlertsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle' is defined but never used.","line":6,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used.","line":10,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":13},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[398,401],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[398,401],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { \n  AlertTriangle, \n  CheckCircle, \n  Clock, \n  Activity,\n  Server,\n  TrendingUp\n} from 'lucide-react';\n\ninterface Alert {\n  name: string;\n  message: string;\n  severity: string;\n  timestamp: string;\n  metrics: any;\n}\n\ninterface AlertStatus {\n  active_rules: string[];\n  recent_alerts: Alert[];\n  severity_counts: {\n    critical: number;\n    high: number;\n    medium: number;\n    low: number;\n  };\n  total_alerts: number;\n}\n\nconst AlertsPage: React.FC = () => {\n  const [alertStatus, setAlertStatus] = useState<AlertStatus | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    const fetchAlertStatus = async () => {\n      try {\n        const response = await fetch('/api/monitoring/alerts');\n        if (!response.ok) {\n          throw new Error('Failed to fetch alert status');\n        }\n        const data = await response.json();\n        setAlertStatus(data);\n      } catch (err) {\n        setError(err instanceof Error ? err.message : 'An error occurred');\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchAlertStatus();\n    \n    // Set up polling for real-time updates\n    const interval = setInterval(fetchAlertStatus, 15000); // Every 15 seconds\n    return () => clearInterval(interval);\n  }, []);\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <div className=\"animate-spin rounded-full h-32 w-32 border-t-2 border-b-2 border-blue-500\"></div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"p-6 text-center\">\n        <AlertTriangle className=\"mx-auto h-12 w-12 text-red-500\" />\n        <h3 className=\"mt-2 text-lg font-medium\">Error Loading Data</h3>\n        <p className=\"mt-1 text-sm text-gray-500\">{error}</p>\n        <button \n          onClick={() => window.location.reload()} \n          className=\"mt-4 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600\"\n        >\n          Retry\n        </button>\n      </div>\n    );\n  }\n\n  if (!alertStatus) {\n    return (\n      <div className=\"p-6 text-center\">\n        <Server className=\"mx-auto h-12 w-12 text-gray-400\" />\n        <h3 className=\"mt-2 text-lg font-medium\">No Alert Data Available</h3>\n        <p className=\"mt-1 text-sm text-gray-500\">Alert monitoring data is not available</p>\n      </div>\n    );\n  }\n\n  const getSeverityColor = (severity: string) => {\n    switch (severity.toLowerCase()) {\n      case 'critical':\n        return 'destructive';\n      case 'high':\n        return 'destructive';\n      case 'medium':\n        return 'secondary';\n      case 'low':\n        return 'default';\n      default:\n        return 'default';\n    }\n  };\n\n  const getSeverityIcon = (severity: string) => {\n    switch (severity.toLowerCase()) {\n      case 'critical':\n        return <AlertTriangle className=\"h-4 w-4 text-red-500\" />;\n      case 'high':\n        return <AlertTriangle className=\"h-4 w-4 text-red-500\" />;\n      case 'medium':\n        return <AlertTriangle className=\"h-4 w-4 text-yellow-500\" />;\n      case 'low':\n        return <AlertTriangle className=\"h-4 w-4 text-blue-500\" />;\n      default:\n        return <AlertTriangle className=\"h-4 w-4 text-gray-500\" />;\n    }\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <h1 className=\"text-3xl font-bold flex items-center\">\n          <AlertTriangle className=\"mr-2 h-8 w-8\" />\n          Alert Management\n        </h1>\n        <Badge variant=\"default\">\n          Active Rules: {alertStatus.active_rules.length}\n        </Badge>\n      </div>\n\n      {/* Alert Summary Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Critical</CardTitle>\n            {getSeverityIcon('critical')}\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-red-600\">{alertStatus.severity_counts.critical}</div>\n            <p className=\"text-xs text-muted-foreground\">Critical alerts</p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">High</CardTitle>\n            {getSeverityIcon('high')}\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-red-500\">{alertStatus.severity_counts.high}</div>\n            <p className=\"text-xs text-muted-foreground\">High severity alerts</p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Medium</CardTitle>\n            {getSeverityIcon('medium')}\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-yellow-500\">{alertStatus.severity_counts.medium}</div>\n            <p className=\"text-xs text-muted-foreground\">Medium severity alerts</p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Low</CardTitle>\n            {getSeverityIcon('low')}\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-blue-500\">{alertStatus.severity_counts.low}</div>\n            <p className=\"text-xs text-muted-foreground\">Low severity alerts</p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Active Rules */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Active Alert Rules</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {alertStatus.active_rules.map((rule, index) => (\n              <div key={index} className=\"border rounded-lg p-3 bg-gray-50\">\n                <div className=\"flex items-center gap-2\">\n                  <Activity className=\"h-4 w-4 text-blue-500\" />\n                  <span className=\"font-medium\">{rule}</span>\n                </div>\n              </div>\n            ))}\n          </div>\n          {alertStatus.active_rules.length === 0 && (\n            <div className=\"text-center py-8 text-gray-500\">\n              No active alert rules configured\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Recent Alerts */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Recent Alerts</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {alertStatus.recent_alerts.length > 0 ? (\n            <div className=\"space-y-4\">\n              {alertStatus.recent_alerts.map((alert, index) => (\n                <div key={index} className=\"border rounded-lg p-4 hover:bg-gray-50 transition-colors\">\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center gap-2\">\n                        {getSeverityIcon(alert.severity)}\n                        <h4 className=\"font-medium truncate\">{alert.name}</h4>\n                        <Badge variant={getSeverityColor(alert.severity)}>\n                          {alert.severity}\n                        </Badge>\n                      </div>\n                      <p className=\"text-sm text-gray-600 mt-1\">{alert.message}</p>\n                      <div className=\"flex items-center gap-4 mt-2 text-xs text-gray-500\">\n                        <div className=\"flex items-center gap-1\">\n                          <Clock className=\"h-3 w-3\" />\n                          <span>{new Date(alert.timestamp).toLocaleString()}</span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <div className=\"text-center py-8 text-gray-500\">\n              No recent alerts\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Alert Configuration */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Alert Configuration</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between p-4 border rounded-lg\">\n              <div>\n                <h4 className=\"font-medium\">High Error Rate Detection</h4>\n                <p className=\"text-sm text-gray-600\">Triggers when success rate drops below 80%</p>\n              </div>\n              <Badge variant=\"default\">Enabled</Badge>\n            </div>\n            \n            <div className=\"flex items-center justify-between p-4 border rounded-lg\">\n              <div>\n                <h4 className=\"font-medium\">Slow Processing Detection</h4>\n                <p className=\"text-sm text-gray-600\">Triggers when average processing time exceeds 5 seconds</p>\n              </div>\n              <Badge variant=\"default\">Enabled</Badge>\n            </div>\n            \n            <div className=\"flex items-center justify-between p-4 border rounded-lg\">\n              <div>\n                <h4 className=\"font-medium\">High Error Count Detection</h4>\n                <p className=\"text-sm text-gray-600\">Triggers when error rate exceeds 30%</p>\n              </div>\n              <Badge variant=\"default\">Enabled</Badge>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n};\n\nexport default AlertsPage;","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/AnalyticsPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/MonitoringPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/PremiumTimelineDemoPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileVideo' is defined but never used.","line":17,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// client/src/pages/PremiumTimelineDemoPage.tsx\nimport React from 'react';\nimport { PremiumTimeline } from '@/components/viz';\nimport {\n  Card,\n  CardContent,\n  CardHeader,\n  CardTitle,\n  CardDescription,\n} from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport {\n  FileImage,\n  FileType,\n  FileText,\n  FileAudio,\n  FileVideo,\n} from 'lucide-react';\n\nconst sampleFiles = [\n  {\n    id: 1,\n    filename: 'summer_vacation_2024.jpg',\n    type: 'image' as const,\n    icon: FileImage,\n    created: new Date('2024-07-15T14:30:00'),\n    modified: new Date('2024-08-22T09:15:00'),\n    accessed: new Date('2025-01-03T16:45:00'),\n    dateTaken: new Date('2024-07-15T14:28:30'),\n    size: '4.2 MB',\n    sizeBytes: 4404019,\n    dimensions: '4032x3024',\n    location: 'Maldives',\n    camera: 'iPhone 15 Pro',\n    tags: ['vacation', 'beach', 'summer'],\n  },\n  {\n    id: 2,\n    filename: 'project_report.pdf',\n    type: 'document' as const,\n    icon: FileType,\n    created: new Date('2024-09-10T10:00:00'),\n    modified: new Date('2024-12-15T14:30:00'),\n    accessed: new Date('2025-01-04T11:20:00'),\n    size: '1.8 MB',\n    sizeBytes: 1887436,\n    pages: 24,\n    author: 'John Doe',\n    tags: ['work', 'report', 'Q4'],\n  },\n  {\n    id: 3,\n    filename: 'meeting_notes.txt',\n    type: 'text' as const,\n    icon: FileText,\n    created: new Date('2024-11-20T09:00:00'),\n    modified: new Date('2024-11-20T17:45:00'),\n    accessed: new Date('2025-01-02T08:30:00'),\n    size: '12 KB',\n    sizeBytes: 12288,\n    tags: ['meeting', 'notes'],\n  },\n  {\n    id: 4,\n    filename: 'photo_edited.psd',\n    type: 'image' as const,\n    icon: FileImage,\n    created: new Date('2024-06-20T10:20:00'),\n    modified: new Date('2024-12-01T16:30:00'),\n    accessed: new Date('2025-01-05T09:00:00'),\n    dateTaken: new Date('2024-06-20T10:15:00'),\n    size: '24.5 MB',\n    sizeBytes: 25690102,\n    dimensions: '6000x4000',\n    location: 'Studio',\n    camera: 'Adobe Photoshop',\n    tags: ['design', 'edited'],\n  },\n  {\n    id: 5,\n    filename: 'music_track.mp3',\n    type: 'audio' as const,\n    icon: FileAudio,\n    created: new Date('2024-05-01T12:00:00'),\n    modified: new Date('2024-05-01T12:00:00'),\n    accessed: new Date('2025-01-01T20:00:00'),\n    size: '8.7 MB',\n    sizeBytes: 9123456,\n    tags: ['music', 'demo'],\n  },\n  {\n    id: 6,\n    filename: 'screenshot.png',\n    type: 'image' as const,\n    icon: FileImage,\n    created: new Date('2024-10-05T08:45:00'),\n    modified: new Date('2024-10-05T08:45:00'),\n    accessed: new Date('2024-12-20T14:00:00'),\n    dateTaken: new Date('2024-10-05T08:45:00'),\n    size: '1.2 MB',\n    sizeBytes: 1258291,\n    dimensions: '2560x1440',\n    tags: ['screenshot', 'work'],\n  },\n];\n\nexport default function PremiumTimelineDemoPage() {\n  return (\n    <div className=\"container mx-auto py-8 px-4 max-w-7xl\">\n      <div className=\"mb-8\">\n        <div className=\"flex items-center gap-3 mb-2\">\n          <h1 className=\"text-3xl font-bold\">Premium Timeline Visualization</h1>\n          <Badge variant=\"secondary\">Interactive Demo</Badge>\n        </div>\n        <p className=\"text-muted-foreground text-lg\">\n          Advanced timeline component with playback controls, filters,\n          comparison mode, and export options.\n        </p>\n      </div>\n\n      <Card className=\"mb-6\">\n        <CardHeader>\n          <CardTitle>Features</CardTitle>\n          <CardDescription>\n            Comprehensive timeline visualization for file metadata analysis\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm\">\n            <div className=\"space-y-1\">\n              <strong className=\"text-primary\">Playback Controls</strong>\n              <p className=\"text-muted-foreground\">\n                Play/pause, speed control, seek\n              </p>\n            </div>\n            <div className=\"space-y-1\">\n              <strong className=\"text-primary\">Zoom & Pan</strong>\n              <p className=\"text-muted-foreground\">\n                Mouse wheel zoom, drag to pan\n              </p>\n            </div>\n            <div className=\"space-y-1\">\n              <strong className=\"text-primary\">Filters</strong>\n              <p className=\"text-muted-foreground\">\n                Event types, date range, file types\n              </p>\n            </div>\n            <div className=\"space-y-1\">\n              <strong className=\"text-primary\">Comparison</strong>\n              <p className=\"text-muted-foreground\">\n                Side-by-side file analysis\n              </p>\n            </div>\n            <div className=\"space-y-1\">\n              <strong className=\"text-primary\">Export</strong>\n              <p className=\"text-muted-foreground\">JSON and CSV export</p>\n            </div>\n            <div className=\"space-y-1\">\n              <strong className=\"text-primary\">Keyboard Shortcuts</strong>\n              <p className=\"text-muted-foreground\">\n                Space, arrows, +/- , D, F, S\n              </p>\n            </div>\n            <div className=\"space-y-1\">\n              <strong className=\"text-primary\">Dark/Light Mode</strong>\n              <p className=\"text-muted-foreground\">Toggle theme support</p>\n            </div>\n            <div className=\"space-y-1\">\n              <strong className=\"text-primary\">Minimap</strong>\n              <p className=\"text-muted-foreground\">\n                Overview with zoom indicator\n              </p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <PremiumTimeline files={sampleFiles} />\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/SecurityPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used.","line":8,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Activity' is defined but never used.","line":10,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Server' is defined but never used.","line":11,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":9}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { \n  Shield, \n  AlertTriangle, \n  CheckCircle, \n  Clock, \n  FileText,\n  Activity,\n  Server\n} from 'lucide-react';\n\ninterface SecurityCheckResult {\n  check_name: string;\n  is_safe: boolean;\n  details: string;\n  severity: string;\n}\n\ninterface SecurityReport {\n  filepath: string;\n  security_level: string;\n  timestamp: string;\n  checks_performed: number;\n  safe: boolean;\n  results: SecurityCheckResult[];\n  summary: {\n    safe_checks: number;\n    unsafe_checks: number;\n    overall_risk: string;\n  };\n}\n\nconst SecurityPage: React.FC = () => {\n  const [securityReports, setSecurityReports] = useState<SecurityReport[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    const fetchSecurityData = async () => {\n      try {\n        const response = await fetch('/api/security/reports');\n        if (!response.ok) {\n          throw new Error('Failed to fetch security reports');\n        }\n        const data = await response.json();\n        setSecurityReports(data.reports || []);\n      } catch (err) {\n        setError(err instanceof Error ? err.message : 'An error occurred');\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchSecurityData();\n    \n    // Set up polling for real-time updates\n    const interval = setInterval(fetchSecurityData, 30000); // Every 30 seconds\n    return () => clearInterval(interval);\n  }, []);\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <div className=\"animate-spin rounded-full h-32 w-32 border-t-2 border-b-2 border-blue-500\"></div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"p-6 text-center\">\n        <AlertTriangle className=\"mx-auto h-12 w-12 text-red-500\" />\n        <h3 className=\"mt-2 text-lg font-medium\">Error Loading Data</h3>\n        <p className=\"mt-1 text-sm text-gray-500\">{error}</p>\n        <button \n          onClick={() => window.location.reload()} \n          className=\"mt-4 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600\"\n        >\n          Retry\n        </button>\n      </div>\n    );\n  }\n\n  const getRiskColor = (risk: string) => {\n    switch (risk.toLowerCase()) {\n      case 'high':\n        return 'destructive';\n      case 'medium':\n        return 'secondary';\n      case 'low':\n        return 'default';\n      default:\n        return 'default';\n    }\n  };\n\n  const getSeverityColor = (severity: string) => {\n    switch (severity.toLowerCase()) {\n      case 'critical':\n        return 'destructive';\n      case 'high':\n        return 'destructive';\n      case 'medium':\n        return 'secondary';\n      case 'low':\n        return 'default';\n      default:\n        return 'default';\n    }\n  };\n\n  const getCheckStatusIcon = (isSafe: boolean) => {\n    return isSafe ? \n      <CheckCircle className=\"h-4 w-4 text-green-500\" /> : \n      <AlertTriangle className=\"h-4 w-4 text-red-500\" />;\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <h1 className=\"text-3xl font-bold flex items-center\">\n          <Shield className=\"mr-2 h-8 w-8\" />\n          Security Dashboard\n        </h1>\n        <Badge variant=\"default\">\n          Real-time Monitoring\n        </Badge>\n      </div>\n\n      {/* Security Summary Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Scans</CardTitle>\n            <FileText className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{securityReports.length}</div>\n            <p className=\"text-xs text-muted-foreground\">Files scanned</p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Safe Files</CardTitle>\n            <CheckCircle className=\"h-4 w-4 text-green-500\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {securityReports.filter(report => report.safe).length}\n            </div>\n            <p className=\"text-xs text-muted-foreground\">Successfully validated</p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Security Risk</CardTitle>\n            <AlertTriangle className=\"h-4 w-4 text-red-500\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {securityReports.filter(report => !report.safe).length}\n            </div>\n            <p className=\"text-xs text-muted-foreground\">Flagged for review</p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Security Configuration */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Security Configuration</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            <div>\n              <h3 className=\"font-medium mb-3\">Security Levels</h3>\n              <div className=\"space-y-3\">\n                {['Basic', 'Standard', 'Strict', 'Paranoid'].map((level, index) => (\n                  <div key={index} className=\"flex items-center justify-between p-3 border rounded-lg\">\n                    <span>{level}</span>\n                    <Badge variant={index === 1 ? \"default\" : \"secondary\"}>\n                      {index === 1 ? \"Active\" : \"Inactive\"}\n                    </Badge>\n                  </div>\n                ))}\n              </div>\n            </div>\n            \n            <div>\n              <h3 className=\"font-medium mb-3\">Active Security Checks</h3>\n              <div className=\"space-y-2\">\n                {[\n                  'File Extension Check',\n                  'File Size Check', \n                  'MIME Type Check',\n                  'File Signature Check',\n                  'Malicious Content Scan'\n                ].map((check, index) => (\n                  <div key={index} className=\"flex items-center gap-2\">\n                    <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                    <span>{check}</span>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Recent Security Reports */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Recent Security Reports</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {securityReports.length > 0 ? (\n            <div className=\"space-y-4\">\n              {securityReports.slice(0, 10).map((report, index) => (\n                <div key={index} className=\"border rounded-lg p-4 hover:bg-gray-50 transition-colors\">\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center gap-2 mb-2\">\n                        {getCheckStatusIcon(report.safe)}\n                        <h4 className=\"font-medium truncate\">{report.filepath}</h4>\n                        <Badge variant={getRiskColor(report.summary.overall_risk)}>\n                          {report.summary.overall_risk}\n                        </Badge>\n                        <Badge variant=\"secondary\">\n                          {report.security_level}\n                        </Badge>\n                      </div>\n                      \n                      <div className=\"grid grid-cols-2 gap-4 text-sm mt-2\">\n                        <div>\n                          <span className=\"text-gray-600\">Checks: </span>\n                          <span className=\"font-medium\">{report.checks_performed}</span>\n                        </div>\n                        <div>\n                          <span className=\"text-gray-600\">Safe: </span>\n                          <span className=\"font-medium\">{report.summary.safe_checks}</span>\n                          <span className=\"text-gray-500\">/{report.checks_performed}</span>\n                        </div>\n                      </div>\n                      \n                      <div className=\"mt-3\">\n                        <h5 className=\"font-medium text-sm mb-2\">Security Checks:</h5>\n                        <div className=\"space-y-2\">\n                          {report.results.slice(0, 3).map((result, idx) => (\n                            <div key={idx} className=\"flex items-center gap-2 text-xs\">\n                              {getCheckStatusIcon(result.is_safe)}\n                              <span className=\"truncate\">{result.check_name}</span>\n                              <Badge \n                                variant={getSeverityColor(result.severity)} \n                                className=\"text-xs\"\n                              >\n                                {result.severity}\n                              </Badge>\n                            </div>\n                          ))}\n                          {report.results.length > 3 && (\n                            <div className=\"text-xs text-gray-500\">\n                              +{report.results.length - 3} more checks...\n                            </div>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                    \n                    <div className=\"text-right text-xs text-gray-500 ml-4\">\n                      <div>{new Date(report.timestamp).toLocaleDateString()}</div>\n                      <div>{new Date(report.timestamp).toLocaleTimeString()}</div>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <div className=\"text-center py-8 text-gray-500\">\n              No security reports available\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Security Recommendations */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Security Recommendations</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-3\">\n            <div className=\"flex items-start gap-3 p-3 bg-blue-50 rounded-lg\">\n              <AlertTriangle className=\"h-5 w-5 text-blue-500 mt-0.5\" />\n              <div>\n                <h4 className=\"font-medium\">Enable Strict Security Level</h4>\n                <p className=\"text-sm text-gray-600\">Consider upgrading to strict security level for production environments</p>\n              </div>\n            </div>\n            \n            <div className=\"flex items-start gap-3 p-3 bg-green-50 rounded-lg\">\n              <CheckCircle className=\"h-5 w-5 text-green-500 mt-0.5\" />\n              <div>\n                <h4 className=\"font-medium\">File Type Validation</h4>\n                <p className=\"text-sm text-gray-600\">Current file type validation is properly configured</p>\n              </div>\n            </div>\n            \n            <div className=\"flex items-start gap-3 p-3 bg-yellow-50 rounded-lg\">\n              <AlertTriangle className=\"h-5 w-5 text-yellow-500 mt-0.5\" />\n              <div>\n                <h4 className=\"font-medium\">Review Dangerous Extensions</h4>\n                <p className=\"text-sm text-gray-600\">Consider blocking additional executable file extensions</p>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n};\n\nexport default SecurityPage;","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/VizDemoPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/analytics.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":58,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":58,"endColumn":20,"suggestions":[{"fix":{"range":[1840,1891],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'status' is defined but never used. Allowed unused args must match /^_/u.","line":256,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":256,"endColumn":9}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Analytics Dashboard Component\n * Real-time monitoring of extraction performance and system usage\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\n\ninterface PerformanceMetrics {\n  avg_extraction_time: number;\n  total_extractions: number;\n  success_rate: number;\n  fields_per_extraction: number;\n  throughput_per_minute: number;\n}\n\ninterface SystemUsage {\n  active_users: number;\n  images_processed_today: number;\n  data_processed_gb: number;\n  error_rate: number;\n}\n\ntype TopFormats = {\n  format: string;\n  count: number;\n  avg_time: number;\n}[];\n\nexport default function AnalyticsDashboard() {\n  const [metrics, setMetrics] = useState<PerformanceMetrics | null>(null);\n  const [usage, setUsage] = useState<SystemUsage | null>(null);\n  const [topFormats, setTopFormats] = useState<TopFormats>([] as TopFormats);\n  const [loading, setLoading] = useState(true);\n  const [timeRange, setTimeRange] = useState<'1h' | '24h' | '7d'>('24h');\n\n  const avgExtractionTime = metrics?.avg_extraction_time ?? 0;\n  const successRate = metrics?.success_rate ?? 0;\n  const fieldsPerExtraction = metrics?.fields_per_extraction ?? 0;\n  const throughputPerMinute = metrics?.throughput_per_minute ?? 0;\n  const errorRate = usage?.error_rate ?? 0;\n\n  useEffect(() => {\n    fetchAnalytics();\n    const interval = setInterval(fetchAnalytics, 30000); // Refresh every 30s\n    return () => clearInterval(interval);\n  }, [timeRange]);\n\n  const fetchAnalytics = async () => {\n    try {\n      const response = await fetch(`/api/analytics?range=${timeRange}`);\n      const data = await response.json();\n\n      setMetrics(data.performance);\n      setUsage(data.usage);\n      setTopFormats(Array.isArray(data.top_formats) ? data.top_formats : []);\n    } catch (error) {\n      console.error('Failed to fetch analytics:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header with Time Range Selector */}\n      <div className=\"flex justify-between items-center\">\n        <h2 className=\"text-3xl font-bold\">Analytics Dashboard</h2>\n        <div className=\"flex gap-2\">\n          {(['1h', '24h', '7d'] as const).map(range => (\n            <button\n              key={range}\n              onClick={() => setTimeRange(range)}\n              className={`px-4 py-2 rounded-lg ${\n                timeRange === range\n                  ? 'bg-blue-500 text-white'\n                  : 'bg-gray-200 text-gray-700'\n              }`}\n            >\n              {range === '1h'\n                ? 'Last Hour'\n                : range === '24h'\n                  ? '24 Hours'\n                  : '7 Days'}\n            </button>\n          ))}\n        </div>\n      </div>\n\n      {/* Performance Metrics Grid */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n        <PerformanceCard\n          title=\"Avg Extraction Time\"\n          value={`${avgExtractionTime.toFixed(3)}s`}\n          target=\"<0.5s\"\n          status={avgExtractionTime < 0.5 ? 'success' : 'warning'}\n          trend=\" 97% vs baseline\"\n        />\n        <PerformanceCard\n          title=\"Success Rate\"\n          value={`${(successRate * 100).toFixed(1)}%`}\n          target=\">99%\"\n          status={successRate > 0.99 ? 'success' : 'warning'}\n          trend=\"Stable\"\n        />\n        <PerformanceCard\n          title=\"Fields per Extraction\"\n          value={`${fieldsPerExtraction.toFixed(0)}`}\n          target=\"200+\"\n          status={fieldsPerExtraction >= 200 ? 'success' : 'warning'}\n          trend=\" 15% improvement\"\n        />\n        <PerformanceCard\n          title=\"Throughput\"\n          value={`${throughputPerMinute.toFixed(1)}/min`}\n          target=\"60+/min\"\n          status={throughputPerMinute >= 60 ? 'success' : 'warning'}\n          trend=\"Scaling well\"\n        />\n      </div>\n\n      {/* System Usage Section */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle>System Usage</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              <MetricRow\n                label=\"Active Users\"\n                value={usage?.active_users || 0}\n                icon=\"\"\n                trend=\"Current\"\n              />\n              <MetricRow\n                label=\"Images Today\"\n                value={usage?.images_processed_today || 0}\n                icon=\"\"\n                trend=\"+12% vs yesterday\"\n              />\n              <MetricRow\n                label=\"Data Processed\"\n                value={`${(usage?.data_processed_gb || 0).toFixed(1)} GB`}\n                icon=\"\"\n                trend=\"Efficient\"\n              />\n              <MetricRow\n                label=\"Error Rate\"\n                value={`${(errorRate * 100).toFixed(2)}%`}\n                icon=\"\"\n                trend=\"Low\"\n                status={errorRate < 0.01 ? 'success' : 'warning'}\n              />\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Top Formats Chart */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Top File Formats</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              {topFormats.map((format, index) => (\n                <div\n                  key={format.format}\n                  className=\"flex items-center justify-between\"\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <span className=\"text-lg font-bold\">#{index + 1}</span>\n                    <span className=\"font-medium\">\n                      {format.format.toUpperCase()}\n                    </span>\n                  </div>\n                  <div className=\"flex items-center gap-4\">\n                    <span className=\"text-gray-600\">{format.count} files</span>\n                    <span className=\"text-blue-600 font-mono\">\n                      {format.avg_time.toFixed(3)}s\n                    </span>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Real-time Performance Graph */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Extraction Performance Timeline</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"h-64 flex items-center justify-center bg-gray-50 rounded-lg\">\n            <p className=\"text-gray-500\">Performance graph visualization</p>\n            {/* In production, this would show a real-time chart */}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nfunction PerformanceCard({\n  title,\n  value,\n  target,\n  status,\n  trend,\n}: {\n  title: string;\n  value: string;\n  target: string;\n  status: 'success' | 'warning' | 'error';\n  trend: string;\n}) {\n  const statusColors = {\n    success: 'bg-green-100 border-green-500 text-green-800',\n    warning: 'bg-yellow-100 border-yellow-500 text-yellow-800',\n    error: 'bg-red-100 border-red-500 text-red-800',\n  };\n\n  return (\n    <Card className={`border-2 ${statusColors[status].split(' ')[0]}`}>\n      <CardHeader className=\"pb-2\">\n        <CardTitle className=\"text-sm font-medium text-gray-600\">\n          {title}\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"text-3xl font-bold\">{value}</div>\n        <div className=\"flex justify-between items-center mt-2 text-sm\">\n          <span className=\"text-gray-500\">Target: {target}</span>\n          <span className=\"text-blue-600\">{trend}</span>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction MetricRow({\n  label,\n  value,\n  icon,\n  trend,\n  status,\n}: {\n  label: string;\n  value: number | string;\n  icon: string;\n  trend: string;\n  status?: 'success' | 'warning' | 'error';\n}) {\n  return (\n    <div className=\"flex items-center justify-between py-2 border-b border-gray-100 last:border-0\">\n      <div className=\"flex items-center gap-3\">\n        <span className=\"text-2xl\">{icon}</span>\n        <span className=\"font-medium\">{label}</span>\n      </div>\n      <div className=\"text-right\">\n        <div className=\"font-bold\">{value}</div>\n        <div className=\"text-sm text-gray-500\">{trend}</div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/analytics/AnalyticsDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":5,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used.","line":11,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Filter' is defined but never used.","line":17,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Eye' is defined but never used.","line":19,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":6},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Tooltip' is defined but never used.","line":29,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'LineChart' is defined but never used.","line":32,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Line' is defined but never used.","line":33,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'dateRange' is assigned a value but never used.","line":107,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":107,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Advanced Analytics Dashboard - Main dashboard component\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { \n  BarChart3, \n  TrendingUp, \n  Users, \n  FileText, \n  DollarSign, \n  Calendar,\n  Download,\n  Filter,\n  Activity,\n  Eye,\n  Upload,\n  UserPlus\n} from 'lucide-react';\nimport { \n  BarChart, \n  Bar, \n  XAxis, \n  YAxis, \n  CartesianGrid, \n  Tooltip, \n  Legend, \n  ResponsiveContainer,\n  LineChart,\n  Line,\n  PieChart,\n  Pie,\n  Cell\n} from 'recharts';\nimport { ChartContainer, ChartTooltip, ChartTooltipContent } from '@/components/ui/chart';\n\ninterface MetricCardProps {\n  title: string;\n  value: string | number;\n  change: string;\n  icon: React.ReactNode;\n  color: string;\n}\n\nconst MetricCard: React.FC<MetricCardProps> = ({ title, value, change, icon, color }) => {\n  return (\n    <Card className=\"bg-card border-white/10\">\n      <CardContent className=\"p-4\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <p className=\"text-sm text-slate-300\">{title}</p>\n            <p className=\"text-2xl font-bold text-white\">{value}</p>\n            <p className={`text-xs mt-1 ${change.startsWith('+') ? 'text-emerald-400' : 'text-red-400'}`}>\n              {change}\n            </p>\n          </div>\n          <div className={`p-3 rounded-lg ${color}`}>\n            {icon}\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n};\n\ninterface DateRangeFilterProps {\n  onDateChange: (start: Date, end: Date) => void;\n}\n\nconst DateRangeFilter: React.FC<DateRangeFilterProps> = ({ onDateChange }) => {\n  const [startDate, setStartDate] = useState<string>('2025-01-01');\n  const [endDate, setEndDate] = useState<string>('2025-01-31');\n\n  const handleApply = () => {\n    onDateChange(new Date(startDate), new Date(endDate));\n  };\n\n  return (\n    <div className=\"flex items-center gap-3\">\n      <div className=\"flex items-center gap-2\">\n        <Calendar className=\"w-4 h-4 text-slate-300\" />\n        <input\n          type=\"date\"\n          value={startDate}\n          onChange={(e) => setStartDate(e.target.value)}\n          className=\"px-3 py-1 bg-muted border border-white/10 rounded text-white text-sm focus:outline-none focus:ring-1 focus:ring-primary\"\n        />\n        <span className=\"text-slate-300\">to</span>\n        <input\n          type=\"date\"\n          value={endDate}\n          onChange={(e) => setEndDate(e.target.value)}\n          className=\"px-3 py-1 bg-muted border border-white/10 rounded text-white text-sm focus:outline-none focus:ring-1 focus:ring-primary\"\n        />\n      </div>\n      <Button variant=\"outline\" size=\"sm\" onClick={handleApply}>\n        Apply\n      </Button>\n    </div>\n  );\n};\n\nconst AnalyticsDashboard: React.FC = () => {\n  const [dateRange, setDateRange] = useState<[Date, Date]>([\n    new Date(2025, 0, 1), // Jan 1, 2025\n    new Date(2025, 0, 31)  // Jan 31, 2025\n  ]);\n\n  // Mock data for metrics\n  const metrics = [\n    { title: 'Total Uploads', value: '12,458', change: '+12.5%', icon: <Upload className=\"w-5 h-5 text-white\" />, color: 'bg-blue-500/20' },\n    { title: 'Conversions', value: '3,241', change: '+8.2%', icon: <FileText className=\"w-5 h-5 text-white\" />, color: 'bg-emerald-500/20' },\n    { title: 'Active Users', value: '842', change: '+5.7%', icon: <Users className=\"w-5 h-5 text-white\" />, color: 'bg-purple-500/20' },\n    { title: 'Revenue', value: '$24,568', change: '+15.3%', icon: <DollarSign className=\"w-5 h-5 text-white\" />, color: 'bg-amber-500/20' },\n  ];\n\n  // Mock data for charts\n  const uploadData = [\n    { date: 'Jan 1', uploads: 45, conversions: 12 },\n    { date: 'Jan 2', uploads: 52, conversions: 15 },\n    { date: 'Jan 3', uploads: 48, conversions: 14 },\n    { date: 'Jan 4', uploads: 61, conversions: 18 },\n    { date: 'Jan 5', uploads: 55, conversions: 16 },\n    { date: 'Jan 6', uploads: 67, conversions: 20 },\n    { date: 'Jan 7', uploads: 72, conversions: 22 },\n  ];\n\n  const userData = [\n    { name: 'New Users', value: 400 },\n    { name: 'Returning', value: 300 },\n    { name: 'Inactive', value: 300 },\n  ];\n\n  const COLORS = ['#0088FE', '#00C49F', '#FFBB28'];\n\n  const tierData = [\n    { name: 'Free', value: 400 },\n    { name: 'Starter', value: 300 },\n    { name: 'Pro', value: 300 },\n    { name: 'Enterprise', value: 200 },\n  ];\n\n  const tierColors = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042'];\n\n  const handleDateChange = (start: Date, end: Date) => {\n    setDateRange([start, end]);\n  };\n\n  return (\n    <div className=\"container mx-auto py-8 px-4\">\n      <div className=\"mb-8\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-white mb-2\">Analytics Dashboard</h1>\n            <p className=\"text-slate-300\">Monitor platform performance and user engagement</p>\n          </div>\n          <Button variant=\"outline\" className=\"gap-2\">\n            <Download className=\"w-4 h-4\" />\n            Export Report\n          </Button>\n        </div>\n      </div>\n\n      {/* Date Range Filter */}\n      <div className=\"mb-6\">\n        <DateRangeFilter onDateChange={handleDateChange} />\n      </div>\n\n      {/* Metric Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6\">\n        {metrics.map((metric, index) => (\n          <MetricCard\n            key={index}\n            title={metric.title}\n            value={metric.value}\n            change={metric.change}\n            icon={metric.icon}\n            color={metric.color}\n          />\n        ))}\n      </div>\n\n      {/* Charts Grid */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\">\n        {/* Uploads vs Conversions Chart */}\n        <Card className=\"bg-card border-white/10\">\n          <CardHeader>\n            <CardTitle className=\"text-white flex items-center gap-2\">\n              <Activity className=\"w-5 h-5 text-primary\" />\n              Uploads vs Conversions\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <ChartContainer config={{}} className=\"h-80\">\n              <ResponsiveContainer width=\"100%\" height=\"100%\">\n                <BarChart data={uploadData}>\n                  <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#374151\" />\n                  <XAxis dataKey=\"date\" stroke=\"#9CA3AF\" />\n                  <YAxis stroke=\"#9CA3AF\" />\n                  <ChartTooltip content={<ChartTooltipContent />} />\n                  <Legend />\n                  <Bar dataKey=\"uploads\" fill=\"#3b82f6\" name=\"Uploads\" />\n                  <Bar dataKey=\"conversions\" fill=\"#10b981\" name=\"Conversions\" />\n                </BarChart>\n              </ResponsiveContainer>\n            </ChartContainer>\n          </CardContent>\n        </Card>\n\n        {/* User Distribution */}\n        <Card className=\"bg-card border-white/10\">\n          <CardHeader>\n            <CardTitle className=\"text-white flex items-center gap-2\">\n              <Users className=\"w-5 h-5 text-primary\" />\n              User Distribution\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <ChartContainer config={{}} className=\"h-80\">\n              <ResponsiveContainer width=\"100%\" height=\"100%\">\n                <PieChart>\n                  <ChartTooltip content={<ChartTooltipContent hideLabel />} />\n                  <Pie\n                    data={userData}\n                    cx=\"50%\"\n                    cy=\"50%\"\n                    labelLine={false}\n                    outerRadius={80}\n                    fill=\"#8884d8\"\n                    dataKey=\"value\"\n                    nameKey=\"name\"\n                    label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}\n                  >\n                    {userData.map((entry, index) => (\n                      <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\n                    ))}\n                  </Pie>\n                  <Legend />\n                </PieChart>\n              </ResponsiveContainer>\n            </ChartContainer>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Additional Charts */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Tier Distribution */}\n        <Card className=\"bg-card border-white/10\">\n          <CardHeader>\n            <CardTitle className=\"text-white flex items-center gap-2\">\n              <BarChart3 className=\"w-5 h-5 text-primary\" />\n              Tier Distribution\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <ChartContainer config={{}} className=\"h-80\">\n              <ResponsiveContainer width=\"100%\" height=\"100%\">\n                <BarChart data={uploadData}>\n                  <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#374151\" />\n                  <XAxis dataKey=\"date\" stroke=\"#9CA3AF\" />\n                  <YAxis stroke=\"#9CA3AF\" />\n                  <ChartTooltip content={<ChartTooltipContent />} />\n                  <Legend />\n                  <Bar dataKey=\"uploads\" fill=\"#8b5cf6\" name=\"Free Tier\" />\n                  <Bar dataKey=\"conversions\" fill=\"#ec4899\" name=\"Paid Tier\" />\n                </BarChart>\n              </ResponsiveContainer>\n            </ChartContainer>\n          </CardContent>\n        </Card>\n\n        {/* Revenue by Tier */}\n        <Card className=\"bg-card border-white/10\">\n          <CardHeader>\n            <CardTitle className=\"text-white flex items-center gap-2\">\n              <DollarSign className=\"w-5 h-5 text-primary\" />\n              Revenue by Tier\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <ChartContainer config={{}} className=\"h-80\">\n              <ResponsiveContainer width=\"100%\" height=\"100%\">\n                <PieChart>\n                  <ChartTooltip content={<ChartTooltipContent hideLabel />} />\n                  <Pie\n                    data={tierData}\n                    cx=\"50%\"\n                    cy=\"50%\"\n                    labelLine={false}\n                    outerRadius={80}\n                    fill=\"#8884d8\"\n                    dataKey=\"value\"\n                    nameKey=\"name\"\n                    label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}\n                  >\n                    {tierData.map((entry, index) => (\n                      <Cell key={`cell-${index}`} fill={tierColors[index % tierColors.length]} />\n                    ))}\n                  </Pie>\n                  <Legend />\n                </PieChart>\n              </ResponsiveContainer>\n            </ChartContainer>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Recent Activity */}\n      <div className=\"mt-6\">\n        <Card className=\"bg-card border-white/10\">\n          <CardHeader>\n            <CardTitle className=\"text-white flex items-center gap-2\">\n              <Activity className=\"w-5 h-5 text-primary\" />\n              Recent Activity\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center justify-between p-3 bg-muted/20 rounded\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"p-2 bg-emerald-500/20 rounded\">\n                    <Upload className=\"w-4 h-4 text-emerald-400\" />\n                  </div>\n                  <div>\n                    <p className=\"font-medium text-white\">New file uploaded</p>\n                    <p className=\"text-sm text-slate-300\">by John Doe  5 minutes ago</p>\n                  </div>\n                </div>\n                <Badge variant=\"outline\">Free Tier</Badge>\n              </div>\n              \n              <div className=\"flex items-center justify-between p-3 bg-muted/20 rounded\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"p-2 bg-blue-500/20 rounded\">\n                    <UserPlus className=\"w-4 h-4 text-blue-400\" />\n                  </div>\n                  <div>\n                    <p className=\"font-medium text-white\">New user registered</p>\n                    <p className=\"text-sm text-slate-300\">Sarah Johnson  12 minutes ago</p>\n                  </div>\n                </div>\n                <Badge variant=\"outline\">Trial</Badge>\n              </div>\n              \n              <div className=\"flex items-center justify-between p-3 bg-muted/20 rounded\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"p-2 bg-purple-500/20 rounded\">\n                    <FileText className=\"w-4 h-4 text-purple-400\" />\n                  </div>\n                  <div>\n                    <p className=\"font-medium text-white\">Report generated</p>\n                    <p className=\"text-sm text-slate-300\">by Alex Smith  1 hour ago</p>\n                  </div>\n                </div>\n                <Badge variant=\"outline\">Pro Tier</Badge>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n};\n\nexport default AnalyticsDashboard;","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/analytics/MetricsOverview.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Badge' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Metrics Overview - KPI cards for analytics dashboard\n */\n\nimport React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { \n  Upload, \n  FileText, \n  Users, \n  DollarSign, \n  TrendingUp, \n  Eye,\n  Calendar,\n  Activity,\n  BarChart3\n} from 'lucide-react';\n\ninterface MetricCardProps {\n  title: string;\n  value: string | number;\n  change: string;\n  icon: React.ReactNode;\n  color: string;\n  trend?: 'up' | 'down';\n  description?: string;\n}\n\nexport const MetricCard: React.FC<MetricCardProps> = ({ \n  title, \n  value, \n  change, \n  icon, \n  color, \n  trend,\n  description \n}) => {\n  return (\n    <Card className=\"bg-card border-white/10\">\n      <CardContent className=\"p-4\">\n        <div className=\"flex items-start justify-between\">\n          <div>\n            <p className=\"text-sm text-slate-300\">{title}</p>\n            <p className=\"text-2xl font-bold text-white mt-1\">{value}</p>\n            <div className=\"flex items-center gap-1 mt-1\">\n              {trend === 'up' ? (\n                <TrendingUp className=\"w-3 h-3 text-emerald-400\" />\n              ) : trend === 'down' ? (\n                <TrendingUp className=\"w-3 h-3 text-red-400 rotate-180\" />\n              ) : null}\n              <span className={`text-xs ${change.startsWith('+') ? 'text-emerald-400' : 'text-red-400'}`}>\n                {change}\n              </span>\n            </div>\n            {description && (\n              <p className=\"text-xs text-slate-500 mt-2\">{description}</p>\n            )}\n          </div>\n          <div className={`p-3 rounded-lg ${color}`}>\n            {icon}\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n};\n\ninterface MetricsOverviewProps {\n  dateRange?: string;\n}\n\nexport const MetricsOverview: React.FC<MetricsOverviewProps> = ({ \n  dateRange = 'Last 30 days' \n}) => {\n  // Mock data for metrics\n  const metrics: MetricCardProps[] = [\n    { \n      title: 'Total Uploads', \n      value: '12,458', \n      change: '+12.5%', \n      icon: <Upload className=\"w-5 h-5 text-white\" />, \n      color: 'bg-blue-500/20',\n      trend: 'up',\n      description: 'Files processed in period'\n    },\n    { \n      title: 'Conversions', \n      value: '3,241', \n      change: '+8.2%', \n      icon: <FileText className=\"w-5 h-5 text-white\" />, \n      color: 'bg-emerald-500/20',\n      trend: 'up',\n      description: 'Successful extractions'\n    },\n    { \n      title: 'Active Users', \n      value: '842', \n      change: '+5.7%', \n      icon: <Users className=\"w-5 h-5 text-white\" />, \n      color: 'bg-purple-500/20',\n      trend: 'up',\n      description: 'Unique users this period'\n    },\n    { \n      title: 'Revenue', \n      value: '$24,568', \n      change: '+15.3%', \n      icon: <DollarSign className=\"w-5 h-5 text-white\" />, \n      color: 'bg-amber-500/20',\n      trend: 'up',\n      description: 'Monthly recurring revenue'\n    },\n    { \n      title: 'Avg. Processing Time', \n      value: '2.4s', \n      change: '-3.2%', \n      icon: <Activity className=\"w-5 h-5 text-white\" />, \n      color: 'bg-cyan-500/20',\n      trend: 'down',\n      description: 'Faster than last period'\n    },\n    { \n      title: 'User Satisfaction', \n      value: '4.7/5', \n      change: '+0.2', \n      icon: <Eye className=\"w-5 h-5 text-white\" />, \n      color: 'bg-pink-500/20',\n      trend: 'up',\n      description: 'Based on user feedback'\n    },\n    { \n      title: 'API Requests', \n      value: '45,231', \n      change: '+22.1%', \n      icon: <BarChart3 className=\"w-5 h-5 text-white\" />, \n      color: 'bg-indigo-500/20',\n      trend: 'up',\n      description: 'Enterprise API usage'\n    },\n    { \n      title: 'Error Rate', \n      value: '0.3%', \n      change: '-0.1%', \n      icon: <Activity className=\"w-5 h-5 text-white\" />, \n      color: 'bg-rose-500/20',\n      trend: 'down',\n      description: 'System reliability metric'\n    }\n  ];\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-xl font-bold text-white\">Key Metrics</h2>\n          <p className=\"text-slate-300 text-sm\">Performance overview for {dateRange}</p>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Calendar className=\"w-4 h-4 text-slate-300\" />\n          <span className=\"text-sm text-slate-300\">{dateRange}</span>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        {metrics.map((metric, index) => (\n          <MetricCard\n            key={index}\n            title={metric.title}\n            value={metric.value}\n            change={metric.change}\n            icon={metric.icon}\n            color={metric.color}\n            trend={metric.trend}\n            description={metric.description}\n          />\n        ))}\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card className=\"bg-card border-white/10\">\n          <CardHeader>\n            <CardTitle className=\"text-white flex items-center gap-2 text-sm\">\n              <TrendingUp className=\"w-4 h-4 text-primary\" />\n              Growth Rate\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-emerald-400\">+12.5%</div>\n            <p className=\"text-slate-300 text-sm mt-1\">MoM growth in usage</p>\n            <div className=\"mt-3 w-full bg-muted rounded-full h-2\">\n              <div className=\"bg-emerald-500 h-2 rounded-full\" style={{ width: '75%' }}></div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"bg-card border-white/10\">\n          <CardHeader>\n            <CardTitle className=\"text-white flex items-center gap-2 text-sm\">\n              <Activity className=\"w-4 h-4 text-primary\" />\n              Performance\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-blue-400\">99.7%</div>\n            <p className=\"text-slate-300 text-sm mt-1\">Uptime this month</p>\n            <div className=\"mt-3 w-full bg-muted rounded-full h-2\">\n              <div className=\"bg-blue-500 h-2 rounded-full\" style={{ width: '99.7%' }}></div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"bg-card border-white/10\">\n          <CardHeader>\n            <CardTitle className=\"text-white flex items-center gap-2 text-sm\">\n              <Users className=\"w-4 h-4 text-primary\" />\n              Retention\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-purple-400\">84.3%</div>\n            <p className=\"text-slate-300 text-sm mt-1\">Monthly active users returning</p>\n            <div className=\"mt-3 w-full bg-muted rounded-full h-2\">\n              <div className=\"bg-purple-500 h-2 rounded-full\" style={{ width: '84.3%' }}></div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n};\n\nexport default MetricsOverview;\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/analytics/TrendCharts.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used.","line":5,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Tooltip' is defined but never used.","line":14,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Scatter' is defined but never used.","line":22,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Cell' is defined but never used.","line":23,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used.","line":31,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingDown' is defined but never used.","line":33,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileText' is defined but never used.","line":36,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Trend Charts - Time-series graphs for analytics dashboard\n */\n\nimport React, { useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport {\n  BarChart,\n  Bar,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  Legend,\n  ResponsiveContainer,\n  LineChart,\n  Line,\n  AreaChart,\n  Area,\n  ComposedChart,\n  Scatter,\n  Cell,\n} from 'recharts';\nimport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n} from '@/components/ui/chart';\nimport {\n  Calendar,\n  TrendingUp,\n  TrendingDown,\n  Activity,\n  Users,\n  FileText,\n  DollarSign,\n} from 'lucide-react';\n\ninterface TimeSeriesData {\n  date: string;\n  [key: string]: number | string | undefined;\n}\n\ninterface TrendChartProps {\n  title: string;\n  data: TimeSeriesData[];\n  dataKey: string;\n  color: string;\n  icon: React.ReactNode;\n  description?: string;\n  chartType?: 'line' | 'bar' | 'area';\n}\n\nexport const TrendChart: React.FC<TrendChartProps> = ({\n  title,\n  data,\n  dataKey,\n  color,\n  icon,\n  description,\n  chartType = 'line',\n}) => {\n  const renderChart = () => {\n    const chartProps = {\n      data,\n      margin: { top: 5, right: 30, left: 20, bottom: 5 },\n    };\n\n    switch (chartType) {\n      case 'bar':\n        return (\n          <BarChart {...chartProps}>\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#374151\" />\n            <XAxis dataKey=\"date\" stroke=\"#9CA3AF\" />\n            <YAxis stroke=\"#9CA3AF\" />\n            <ChartTooltip content={<ChartTooltipContent />} />\n            <Bar dataKey={dataKey} fill={color} />\n          </BarChart>\n        );\n\n      case 'area':\n        return (\n          <AreaChart {...chartProps}>\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#374151\" />\n            <XAxis dataKey=\"date\" stroke=\"#9CA3AF\" />\n            <YAxis stroke=\"#9CA3AF\" />\n            <ChartTooltip content={<ChartTooltipContent />} />\n            <Area\n              type=\"monotone\"\n              dataKey={dataKey}\n              fill={color}\n              stroke={color}\n            />\n          </AreaChart>\n        );\n\n      case 'line':\n      default:\n        return (\n          <LineChart {...chartProps}>\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#374151\" />\n            <XAxis dataKey=\"date\" stroke=\"#9CA3AF\" />\n            <YAxis stroke=\"#9CA3AF\" />\n            <ChartTooltip content={<ChartTooltipContent />} />\n            <Line\n              type=\"monotone\"\n              dataKey={dataKey}\n              stroke={color}\n              strokeWidth={2}\n              dot={{ r: 4 }}\n              activeDot={{ r: 6 }}\n            />\n          </LineChart>\n        );\n    }\n  };\n\n  return (\n    <Card className=\"bg-card border-white/10\">\n      <CardHeader>\n        <CardTitle className=\"text-white flex items-center gap-2\">\n          {icon}\n          {title}\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <ChartContainer config={{}} className=\"h-80\">\n          <ResponsiveContainer width=\"100%\" height=\"100%\">\n            {renderChart()}\n          </ResponsiveContainer>\n        </ChartContainer>\n        {description && (\n          <p className=\"text-sm text-slate-300 mt-4\">{description}</p>\n        )}\n      </CardContent>\n    </Card>\n  );\n};\n\ninterface TrendChartsProps {\n  dateRange?: string;\n}\n\nexport const TrendCharts: React.FC<TrendChartsProps> = ({\n  dateRange = 'Last 30 days',\n}) => {\n  // Mock data for different metrics\n  const uploadData: TimeSeriesData[] = [\n    { date: 'Jan 1', uploads: 45, conversions: 12 },\n    { date: 'Jan 2', uploads: 52, conversions: 15 },\n    { date: 'Jan 3', uploads: 48, conversions: 14 },\n    { date: 'Jan 4', uploads: 61, conversions: 18 },\n    { date: 'Jan 5', uploads: 55, conversions: 16 },\n    { date: 'Jan 6', uploads: 67, conversions: 20 },\n    { date: 'Jan 7', uploads: 72, conversions: 22 },\n    { date: 'Jan 8', uploads: 68, conversions: 19 },\n    { date: 'Jan 9', uploads: 75, conversions: 24 },\n    { date: 'Jan 10', uploads: 82, conversions: 26 },\n    { date: 'Jan 11', uploads: 78, conversions: 23 },\n    { date: 'Jan 12', uploads: 85, conversions: 28 },\n    { date: 'Jan 13', uploads: 92, conversions: 30 },\n    { date: 'Jan 14', uploads: 88, conversions: 27 },\n    { date: 'Jan 15', uploads: 95, conversions: 32 },\n  ];\n\n  const revenueData: TimeSeriesData[] = [\n    { date: 'Week 1', revenue: 1200, profit: 800 },\n    { date: 'Week 2', revenue: 1500, profit: 1000 },\n    { date: 'Week 3', revenue: 1800, profit: 1200 },\n    { date: 'Week 4', revenue: 2200, profit: 1500 },\n  ];\n\n  const userData: TimeSeriesData[] = [\n    { date: 'Mon', newUsers: 12, returning: 45 },\n    { date: 'Tue', newUsers: 18, returning: 52 },\n    { date: 'Wed', newUsers: 15, returning: 48 },\n    { date: 'Thu', newUsers: 22, returning: 61 },\n    { date: 'Fri', newUsers: 28, returning: 72 },\n    { date: 'Sat', newUsers: 19, returning: 58 },\n    { date: 'Sun', newUsers: 14, returning: 42 },\n  ];\n\n  const performanceData: TimeSeriesData[] = [\n    { date: 'Jan 1', responseTime: 2.4, errorRate: 0.3 },\n    { date: 'Jan 2', responseTime: 2.3, errorRate: 0.2 },\n    { date: 'Jan 3', responseTime: 2.2, errorRate: 0.2 },\n    { date: 'Jan 4', responseTime: 2.1, errorRate: 0.1 },\n    { date: 'Jan 5', responseTime: 2.0, errorRate: 0.1 },\n    { date: 'Jan 6', responseTime: 1.9, errorRate: 0.1 },\n    { date: 'Jan 7', responseTime: 1.8, errorRate: 0.0 },\n  ];\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-xl font-bold text-white\">Trend Analysis</h2>\n          <p className=\"text-slate-300 text-sm\">\n            Performance trends for {dateRange}\n          </p>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <TrendChart\n          title=\"Uploads & Conversions\"\n          data={uploadData}\n          dataKey=\"uploads\"\n          color=\"#3b82f6\"\n          icon={<Activity className=\"w-5 h-5 text-primary\" />}\n          description=\"Daily uploads and successful conversions\"\n          chartType=\"line\"\n        />\n\n        <TrendChart\n          title=\"User Growth\"\n          data={userData}\n          dataKey=\"newUsers\"\n          color=\"#10b981\"\n          icon={<Users className=\"w-5 h-5 text-primary\" />}\n          description=\"New vs returning users by day of week\"\n          chartType=\"bar\"\n        />\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <TrendChart\n          title=\"Revenue Growth\"\n          data={revenueData}\n          dataKey=\"revenue\"\n          color=\"#f59e0b\"\n          icon={<DollarSign className=\"w-5 h-5 text-primary\" />}\n          description=\"Weekly revenue and profit trends\"\n          chartType=\"area\"\n        />\n\n        <TrendChart\n          title=\"Performance Metrics\"\n          data={performanceData}\n          dataKey=\"responseTime\"\n          color=\"#8b5cf6\"\n          icon={<TrendingUp className=\"w-5 h-5 text-primary\" />}\n          description=\"Response time and error rate trends\"\n          chartType=\"line\"\n        />\n      </div>\n\n      {/* Combined chart */}\n      <Card className=\"bg-card border-white/10\">\n        <CardHeader>\n          <CardTitle className=\"text-white flex items-center gap-2\">\n            <TrendingUp className=\"w-5 h-5 text-primary\" />\n            Combined Metrics\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <ChartContainer config={{}} className=\"h-80\">\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\n              <ComposedChart\n                data={uploadData}\n                margin={{ top: 5, right: 30, left: 20, bottom: 5 }}\n              >\n                <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#374151\" />\n                <XAxis dataKey=\"date\" stroke=\"#9CA3AF\" />\n                <YAxis yAxisId=\"left\" stroke=\"#9CA3AF\" />\n                <YAxis yAxisId=\"right\" orientation=\"right\" stroke=\"#9CA3AF\" />\n                <ChartTooltip content={<ChartTooltipContent />} />\n                <Legend />\n                <Bar\n                  yAxisId=\"left\"\n                  dataKey=\"uploads\"\n                  fill=\"#3b82f6\"\n                  name=\"Uploads\"\n                />\n                <Line\n                  yAxisId=\"right\"\n                  type=\"monotone\"\n                  dataKey=\"conversions\"\n                  stroke=\"#10b981\"\n                  name=\"Conversions\"\n                  strokeWidth={2}\n                />\n              </ComposedChart>\n            </ResponsiveContainer>\n          </ChartContainer>\n        </CardContent>\n      </Card>\n    </div>\n  );\n};\n\nexport default TrendCharts;\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/analytics/UserSegmentation.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used.","line":5,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Badge' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used.","line":11,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'UserPlus' is defined but never used.","line":12,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used.","line":13,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileText' is defined but never used.","line":18,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DollarSign' is defined but never used.","line":19,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Tooltip' is defined but never used.","line":30,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'COLORS' is assigned a value but never used.","line":114,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":114,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * User Segmentation - User type breakdown for analytics dashboard\n */\n\nimport React, { useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { \n  Users, \n  User, \n  UserPlus, \n  Calendar, \n  TrendingUp, \n  BarChart3,\n  PieChart,\n  Activity,\n  FileText,\n  DollarSign\n} from 'lucide-react';\nimport { \n  PieChart as RechartsPieChart,\n  Pie,\n  Cell,\n  BarChart,\n  Bar,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  Legend,\n  ResponsiveContainer,\n  LineChart,\n  Line\n} from 'recharts';\nimport { ChartContainer, ChartTooltip, ChartTooltipContent } from '@/components/ui/chart';\n\ninterface UserSegment {\n  name: string;\n  value: number;\n  percentage: number;\n  color: string;\n  users: number;\n  activity: number;\n  conversion: number;\n}\n\ninterface UserSegmentationProps {\n  dateRange?: string;\n}\n\nexport const UserSegmentation: React.FC<UserSegmentationProps> = ({ \n  dateRange = 'Last 30 days' \n}) => {\n  // Mock data for user segments\n  const userSegments: UserSegment[] = [\n    { \n      name: 'Free Tier', \n      value: 45, \n      percentage: 45, \n      color: '#6b7280', \n      users: 4500,\n      activity: 12000,\n      conversion: 2\n    },\n    { \n      name: 'Starter', \n      value: 25, \n      percentage: 25, \n      color: '#3b82f6', \n      users: 2500,\n      activity: 8000,\n      conversion: 15\n    },\n    { \n      name: 'Pro', \n      value: 20, \n      percentage: 20, \n      color: '#10b981', \n      users: 2000,\n      activity: 15000,\n      conversion: 35\n    },\n    { \n      name: 'Enterprise', \n      value: 10, \n      percentage: 10, \n      color: '#8b5cf6', \n      users: 1000,\n      activity: 8000,\n      conversion: 65\n    }\n  ];\n\n  // Mock data for user activity over time\n  const activityData = [\n    { date: 'Jan 1', free: 120, starter: 80, pro: 60, enterprise: 30 },\n    { date: 'Jan 2', free: 130, starter: 85, pro: 65, enterprise: 32 },\n    { date: 'Jan 3', free: 125, starter: 82, pro: 62, enterprise: 31 },\n    { date: 'Jan 4', free: 140, starter: 90, pro: 70, enterprise: 35 },\n    { date: 'Jan 5', free: 135, starter: 88, pro: 68, enterprise: 34 },\n    { date: 'Jan 6', free: 150, starter: 95, pro: 75, enterprise: 38 },\n    { date: 'Jan 7', free: 145, starter: 92, pro: 72, enterprise: 36 },\n  ];\n\n  // Mock data for conversion rates\n  const conversionData = [\n    { tier: 'Free', rate: 2.1 },\n    { tier: 'Starter', rate: 15.3 },\n    { tier: 'Pro', rate: 35.7 },\n    { tier: 'Enterprise', rate: 65.2 },\n  ];\n\n  const COLORS = userSegments.map(segment => segment.color);\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-xl font-bold text-white\">User Segmentation</h2>\n          <p className=\"text-slate-300 text-sm\">User distribution by tier for {dateRange}</p>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Pie Chart - User Distribution */}\n        <Card className=\"bg-card border-white/10\">\n          <CardHeader>\n            <CardTitle className=\"text-white flex items-center gap-2\">\n              <PieChart className=\"w-5 h-5 text-primary\" />\n              User Distribution by Tier\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <ChartContainer config={{}} className=\"h-80\">\n              <ResponsiveContainer width=\"100%\" height=\"100%\">\n                <RechartsPieChart>\n                  <ChartTooltip content={<ChartTooltipContent hideLabel />} />\n                  <Pie\n                    data={userSegments}\n                    cx=\"50%\"\n                    cy=\"50%\"\n                    labelLine={false}\n                    outerRadius={80}\n                    fill=\"#8884d8\"\n                    dataKey=\"value\"\n                    nameKey=\"name\"\n                    label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}\n                  >\n                    {userSegments.map((entry, index) => (\n                      <Cell key={`cell-${index}`} fill={entry.color} />\n                    ))}\n                  </Pie>\n                  <Legend />\n                </RechartsPieChart>\n              </ResponsiveContainer>\n            </ChartContainer>\n          </CardContent>\n        </Card>\n\n        {/* Segment Details */}\n        <Card className=\"bg-card border-white/10\">\n          <CardHeader>\n            <CardTitle className=\"text-white flex items-center gap-2\">\n              <Users className=\"w-5 h-5 text-primary\" />\n              Segment Details\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              {userSegments.map((segment, index) => (\n                <div key={index} className=\"flex items-center justify-between p-3 bg-muted/20 rounded-lg\">\n                  <div className=\"flex items-center gap-3\">\n                    <div \n                      className=\"w-4 h-4 rounded-full\" \n                      style={{ backgroundColor: segment.color }}\n                    ></div>\n                    <div>\n                      <h3 className=\"font-medium text-white\">{segment.name}</h3>\n                      <p className=\"text-sm text-slate-300\">{segment.users.toLocaleString()} users</p>\n                    </div>\n                  </div>\n                  <div className=\"text-right\">\n                    <p className=\"font-medium text-white\">{segment.percentage}%</p>\n                    <p className=\"text-sm text-slate-300\">{segment.conversion}% conversion</p>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Activity Over Time */}\n        <Card className=\"bg-card border-white/10\">\n          <CardHeader>\n            <CardTitle className=\"text-white flex items-center gap-2\">\n              <Activity className=\"w-5 h-5 text-primary\" />\n              Activity by Tier Over Time\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <ChartContainer config={{}} className=\"h-80\">\n              <ResponsiveContainer width=\"100%\" height=\"100%\">\n                <BarChart data={activityData}>\n                  <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#374151\" />\n                  <XAxis dataKey=\"date\" stroke=\"#9CA3AF\" />\n                  <YAxis stroke=\"#9CA3AF\" />\n                  <ChartTooltip content={<ChartTooltipContent />} />\n                  <Legend />\n                  <Bar dataKey=\"free\" fill=\"#6b7280\" name=\"Free Tier\" />\n                  <Bar dataKey=\"starter\" fill=\"#3b82f6\" name=\"Starter\" />\n                  <Bar dataKey=\"pro\" fill=\"#10b981\" name=\"Pro\" />\n                  <Bar dataKey=\"enterprise\" fill=\"#8b5cf6\" name=\"Enterprise\" />\n                </BarChart>\n              </ResponsiveContainer>\n            </ChartContainer>\n          </CardContent>\n        </Card>\n\n        {/* Conversion Rates */}\n        <Card className=\"bg-card border-white/10\">\n          <CardHeader>\n            <CardTitle className=\"text-white flex items-center gap-2\">\n              <TrendingUp className=\"w-5 h-5 text-primary\" />\n              Conversion Rates by Tier\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <ChartContainer config={{}} className=\"h-80\">\n              <ResponsiveContainer width=\"100%\" height=\"100%\">\n                <LineChart data={conversionData}>\n                  <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#374151\" />\n                  <XAxis dataKey=\"tier\" stroke=\"#9CA3AF\" />\n                  <YAxis stroke=\"#9CA3AF\" domain={[0, 100]} />\n                  <ChartTooltip content={<ChartTooltipContent />} />\n                  <Line \n                    type=\"monotone\" \n                    dataKey=\"rate\" \n                    stroke=\"#10b981\" \n                    strokeWidth={2}\n                    dot={{ r: 4 }}\n                    activeDot={{ r: 6 }}\n                  />\n                </LineChart>\n              </ResponsiveContainer>\n            </ChartContainer>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Segment Performance Summary */}\n      <Card className=\"bg-card border-white/10\">\n        <CardHeader>\n          <CardTitle className=\"text-white flex items-center gap-2\">\n            <BarChart3 className=\"w-5 h-5 text-primary\" />\n            Segment Performance Summary\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full\">\n              <thead>\n                <tr className=\"border-b border-white/10\">\n                  <th className=\"text-left py-3 px-4 text-slate-300 font-medium\">Tier</th>\n                  <th className=\"text-left py-3 px-4 text-slate-300 font-medium\">Users</th>\n                  <th className=\"text-left py-3 px-4 text-slate-300 font-medium\">Activity</th>\n                  <th className=\"text-left py-3 px-4 text-slate-300 font-medium\">Conversion</th>\n                  <th className=\"text-left py-3 px-4 text-slate-300 font-medium\">Revenue</th>\n                  <th className=\"text-left py-3 px-4 text-slate-300 font-medium\">Growth</th>\n                </tr>\n              </thead>\n              <tbody>\n                {userSegments.map((segment, index) => (\n                  <tr key={index} className={index % 2 === 0 ? 'bg-muted/10' : ''}>\n                    <td className=\"py-3 px-4\">\n                      <div className=\"flex items-center gap-2\">\n                        <div \n                          className=\"w-3 h-3 rounded-full\" \n                          style={{ backgroundColor: segment.color }}\n                        ></div>\n                        <span className=\"text-white font-medium\">{segment.name}</span>\n                      </div>\n                    </td>\n                    <td className=\"py-3 px-4 text-white\">{segment.users.toLocaleString()}</td>\n                    <td className=\"py-3 px-4 text-white\">{segment.activity.toLocaleString()}</td>\n                    <td className=\"py-3 px-4\">\n                      <span className=\"text-white font-medium\">{segment.conversion}%</span>\n                    </td>\n                    <td className=\"py-3 px-4 text-white\">\n                      {segment.name === 'Free' ? '$0' : \n                       segment.name === 'Starter' ? '$2,400' : \n                       segment.name === 'Pro' ? '$10,500' : '$15,600'}\n                    </td>\n                    <td className=\"py-3 px-4\">\n                      <span className={`text-sm ${segment.conversion > 20 ? 'text-emerald-400' : 'text-amber-400'}`}>\n                        {segment.conversion > 20 ? '+12.5%' : '+5.2%'}\n                      </span>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n};\n\nexport default UserSegmentation;","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/batch-results.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":1,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMutation' is defined but never used.","line":2,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardHeader' is defined but never used.","line":3,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardTitle' is defined but never used.","line":3,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Tabs' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsContent' is defined but never used.","line":6,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsList' is defined but never used.","line":6,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsTrigger' is defined but never used.","line":6,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Download' is defined but never used.","line":9,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertTriangle' is defined but never used.","line":16,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used.","line":22,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used.","line":23,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Eye' is defined but never used.","line":27,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":6},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'EyeOff' is defined but never used.","line":28,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'parseApiError' is defined but never used.","line":30,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cn' is defined but never used.","line":43,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":43,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1396,1399],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1396,1399],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'toast' is assigned a value but never used.","line":92,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":92,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'queryClient' is assigned a value but never used.","line":93,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":93,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showExportDialog' is assigned a value but never used.","line":100,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":100,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showUploadZone' is assigned a value but never used.","line":101,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":101,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setItemsPerPage' is assigned a value but never used.","line":103,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":103,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isLoadingResults' is assigned a value but never used.","line":121,"column":47,"nodeType":null,"messageId":"unusedVar","endLine":121,"endColumn":63},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'format' is defined but never used. Allowed unused args must match /^_/u.","line":191,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":191,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":24,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport {\n  Upload,\n  Download,\n  FileText,\n  BarChart3,\n  FileJson,\n  FileSpreadsheet,\n  RotateCcw,\n  CheckCircle,\n  AlertTriangle,\n  XCircle,\n  Filter,\n  Search,\n  RefreshCw,\n  Clock,\n  Calendar,\n  TrendingUp,\n  AlertCircle,\n  Grid,\n  List,\n  Eye,\n  EyeOff,\n} from 'lucide-react';\nimport { parseApiError } from '@/utils/api-error-handler';\nimport { apiRequest } from '@/lib/queryClient';\nimport { useAuth, useCanAccessTier } from '@/lib/auth';\nimport { useToast } from '@/hooks/use-toast';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Input } from '@/components/ui/input';\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select';\nimport { cn } from '@/lib/utils';\n\ninterface BatchResult {\n  id: string;\n  filename: string;\n  status: 'success' | 'error' | 'processing' | 'pending';\n  extractionDate: string;\n  fieldsExtracted: number;\n  fileSize: number;\n  fileType: string;\n  authenticityScore?: number;\n  metadata: Record<string, any>;\n  processingTime?: number;\n  errorMessage?: string;\n  batchId?: string;\n}\n\ninterface BatchFilters {\n  status?: string;\n  fileType?: string;\n  dateRange?: { start: Date; end: Date };\n  minFields?: number;\n  maxFields?: number;\n}\n\ninterface BatchSummary {\n  totalFiles: number;\n  successfulFiles: number;\n  errorFiles: number;\n  processingFiles: number;\n  pendingFiles: number;\n  totalFields: number;\n  totalSize: number;\n  avgProcessingTime: number;\n  successRate: number;\n}\n\ninterface BatchJob {\n  id: string;\n  name: string;\n  createdAt: string;\n  status: 'pending' | 'processing' | 'completed' | 'failed';\n  totalFiles: number;\n  processedFiles: number;\n  results: BatchResult[];\n}\n\nexport const BatchResultsPage: React.FC = () => {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const canAccessProfessional = useCanAccessTier('professional');\n\n  const [selectedFiles, setSelectedFiles] = useState<string[]>([]);\n  const [viewMode, setViewMode] = useState<'grid' | 'list'>('grid');\n  const [filters, setFilters] = useState<BatchFilters>({});\n  const [searchTerm, setSearchTerm] = useState('');\n  const [showExportDialog, setShowExportDialog] = useState(false);\n  const [showUploadZone, setShowUploadZone] = useState(false);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [itemsPerPage, setItemsPerPage] = useState(12);\n\n  // Fetch batch jobs for the user\n  const { data: batchJobs = [], isLoading: isLoadingJobs } = useQuery<\n    BatchJob[]\n  >({\n    queryKey: ['/api/batch/jobs'],\n    queryFn: async () => {\n      const response = await apiRequest('GET', '/api/batch/jobs');\n      return response.json();\n    },\n    enabled: !!user && canAccessProfessional,\n  });\n\n  // Get the most recent batch job\n  const currentBatchJob = batchJobs[0];\n\n  // Fetch detailed results for current batch\n  const { data: batchResults = [], isLoading: isLoadingResults } = useQuery<\n    BatchResult[]\n  >({\n    queryKey: [`/api/batch/jobs/${currentBatchJob?.id}/results`],\n    queryFn: async () => {\n      if (!currentBatchJob?.id) return [];\n      const response = await apiRequest(\n        'GET',\n        `/api/batch/jobs/${currentBatchJob.id}/results`\n      );\n      return response.json();\n    },\n    enabled: !!currentBatchJob?.id && canAccessProfessional,\n    refetchInterval: currentBatchJob?.status === 'processing' ? 5000 : false,\n  });\n\n  // Filter and search results\n  const filteredResults = React.useMemo(() => {\n    if (!canAccessProfessional) return [];\n\n    let results = [...batchResults];\n\n    // Apply search filter\n    if (searchTerm) {\n      results = results.filter(\n        result =>\n          result.filename.toLowerCase().includes(searchTerm.toLowerCase()) ||\n          result.fileType.toLowerCase().includes(searchTerm.toLowerCase())\n      );\n    }\n\n    // Apply status filter\n    if (filters.status && filters.status !== 'all') {\n      results = results.filter(result => result.status === filters.status);\n    }\n\n    // Apply file type filter\n    if (filters.fileType && filters.fileType !== 'all') {\n      const fileTypeFilter = filters.fileType;\n      results = results.filter(\n        result => result.fileType && result.fileType.startsWith(fileTypeFilter)\n      );\n    }\n\n    return results;\n  }, [batchResults, searchTerm, filters, canAccessProfessional]);\n\n  // Pagination\n  const paginatedResults = React.useMemo(() => {\n    const startIndex = (currentPage - 1) * itemsPerPage;\n    const endIndex = startIndex + itemsPerPage;\n    return filteredResults.slice(startIndex, endIndex);\n  }, [filteredResults, currentPage, itemsPerPage]);\n\n  const totalPages = Math.ceil(filteredResults.length / itemsPerPage);\n\n  const handleSelectFile = (id: string) => {\n    setSelectedFiles(prev =>\n      prev.includes(id) ? prev.filter(fileId => fileId !== id) : [...prev, id]\n    );\n  };\n\n  const handleSelectAll = () => {\n    if (selectedFiles.length === paginatedResults.length) {\n      setSelectedFiles([]);\n    } else {\n      setSelectedFiles(paginatedResults.map(result => result.id));\n    }\n  };\n\n  const handleExport = (format: 'json' | 'csv') => {\n    setShowExportDialog(true);\n  };\n\n  const clearFilters = () => {\n    setFilters({});\n    setSearchTerm('');\n    setCurrentPage(1);\n  };\n\n  const getStatusIcon = (status: BatchResult['status']) => {\n    switch (status) {\n      case 'success':\n        return <CheckCircle className=\"w-4 h-4 text-emerald-500\" />;\n      case 'error':\n        return <XCircle className=\"w-4 h-4 text-red-500\" />;\n      case 'processing':\n        return <RefreshCw className=\"w-4 h-4 text-yellow-500 animate-spin\" />;\n      case 'pending':\n        return <Clock className=\"w-4 h-4 text-blue-500\" />;\n      default:\n        return null;\n    }\n  };\n\n  const getStatusBadge = (status: BatchResult['status']) => {\n    switch (status) {\n      case 'success':\n        return (\n          <Badge\n            variant=\"secondary\"\n            className=\"bg-emerald-500/20 text-emerald-400 border-emerald-500/30\"\n          >\n            Success\n          </Badge>\n        );\n      case 'error':\n        return (\n          <Badge\n            variant=\"secondary\"\n            className=\"bg-red-500/20 text-red-400 border-red-500/30\"\n          >\n            Error\n          </Badge>\n        );\n      case 'processing':\n        return (\n          <Badge\n            variant=\"secondary\"\n            className=\"bg-yellow-500/20 text-yellow-400 border-yellow-500/30 animate-pulse\"\n          >\n            Processing\n          </Badge>\n        );\n      case 'pending':\n        return (\n          <Badge\n            variant=\"secondary\"\n            className=\"bg-blue-500/20 text-blue-400 border-blue-500/30\"\n          >\n            Pending\n          </Badge>\n        );\n      default:\n        return <Badge variant=\"outline\">Unknown</Badge>;\n    }\n  };\n\n  const summary = React.useMemo((): BatchSummary => {\n    const totalFiles = filteredResults.length;\n    const successfulFiles = filteredResults.filter(\n      r => r.status === 'success'\n    ).length;\n    const errorFiles = filteredResults.filter(r => r.status === 'error').length;\n    const processingFiles = filteredResults.filter(\n      r => r.status === 'processing'\n    ).length;\n    const pendingFiles = filteredResults.filter(\n      r => r.status === 'pending'\n    ).length;\n    const totalFields = filteredResults.reduce(\n      (sum, r) => sum + r.fieldsExtracted,\n      0\n    );\n    const totalSize = filteredResults.reduce((sum, r) => sum + r.fileSize, 0);\n    const processingTimes = filteredResults.flatMap(result =>\n      typeof result.processingTime === 'number' ? [result.processingTime] : []\n    );\n    const avgProcessingTime =\n      processingTimes.length > 0\n        ? processingTimes.reduce((sum, time) => sum + time, 0) /\n          processingTimes.length\n        : 0;\n    const successRate =\n      totalFiles > 0 ? (successfulFiles / totalFiles) * 100 : 0;\n\n    return {\n      totalFiles,\n      successfulFiles,\n      errorFiles,\n      processingFiles,\n      pendingFiles,\n      totalFields,\n      totalSize,\n      avgProcessingTime,\n      successRate,\n    };\n  }, [filteredResults]);\n\n  // Tier restriction message\n  if (!canAccessProfessional) {\n    return (\n      <div className=\"container mx-auto py-8 px-4\">\n        <Card className=\"bg-card border-white/10\">\n          <CardContent className=\"py-12 text-center\">\n            <FileText className=\"w-12 h-12 mx-auto mb-4 text-slate-500\" />\n            <h2 className=\"text-xl font-semibold text-white mb-2\">\n              Professional Feature\n            </h2>\n            <p className=\"text-slate-300 mb-6\">\n              Batch processing is available for Professional tier and above.\n            </p>\n            <Button onClick={() => (window.location.href = '/credits')}>\n              Upgrade to Professional\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (isLoadingJobs) {\n    return (\n      <div className=\"container mx-auto py-8 px-4\">\n        <div className=\"space-y-4\">\n          <Skeleton className=\"h-8 w-64\" />\n          <Skeleton className=\"h-4 w-96\" />\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n            {[...Array(4)].map((_, i) => (\n              <Skeleton key={i} className=\"h-24\" />\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto py-8 px-4 max-w-7xl\">\n      {/* Header */}\n      <div className=\"mb-8\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-white mb-2\">\n              Batch Processing Results\n            </h1>\n            <p className=\"text-slate-300\">\n              Analyze and compare metadata from multiple files in a single batch\n            </p>\n          </div>\n          <Button onClick={() => setShowUploadZone(true)} className=\"gap-2\">\n            <Upload className=\"w-4 h-4\" />\n            New Batch\n          </Button>\n        </div>\n\n        {/* Current Batch Info */}\n        {currentBatchJob && (\n          <div className=\"flex items-center gap-4 text-sm text-slate-300\">\n            <span>Batch: {currentBatchJob.name}</span>\n            <span></span>\n            <span>\n              Created: {new Date(currentBatchJob.createdAt).toLocaleString()}\n            </span>\n            <span></span>\n            <Badge variant=\"outline\">{currentBatchJob.status}</Badge>\n          </div>\n        )}\n      </div>\n\n      {/* Statistics Overview */}\n      {currentBatchJob && (\n        <div className=\"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-6\">\n          <Card className=\"bg-card border-white/10\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-xs text-slate-300\">Total Files</p>\n                  <p className=\"text-2xl font-bold text-white\">\n                    {summary.totalFiles}\n                  </p>\n                </div>\n                <FileText className=\"w-6 h-6 text-primary\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-card border-white/10\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-xs text-slate-300\">Successful</p>\n                  <p className=\"text-2xl font-bold text-emerald-400\">\n                    {summary.successfulFiles}\n                  </p>\n                  <p className=\"text-xs text-slate-400\">\n                    {Math.round(summary.successRate)}%\n                  </p>\n                </div>\n                <CheckCircle className=\"w-6 h-6 text-emerald-500\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-card border-white/10\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-xs text-slate-300\">Errors</p>\n                  <p className=\"text-2xl font-bold text-red-400\">\n                    {summary.errorFiles}\n                  </p>\n                </div>\n                <XCircle className=\"w-6 h-6 text-red-500\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-card border-white/10\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-xs text-slate-300\">Processing</p>\n                  <p className=\"text-2xl font-bold text-yellow-400\">\n                    {summary.processingFiles}\n                  </p>\n                </div>\n                <AlertCircle className=\"w-6 h-6 text-yellow-500\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-card border-white/10\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-xs text-slate-300\">Avg Fields</p>\n                  <p className=\"text-2xl font-bold text-white\">\n                    {summary.totalFiles > 0\n                      ? Math.round(summary.totalFields / summary.totalFiles)\n                      : 0}\n                  </p>\n                </div>\n                <BarChart3 className=\"w-6 h-6 text-primary\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-card border-white/10\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-xs text-slate-300\">Avg Time</p>\n                  <p className=\"text-2xl font-bold text-white\">\n                    {summary.avgProcessingTime > 0\n                      ? `${Math.round(summary.avgProcessingTime / 1000)}s`\n                      : 'N/A'}\n                  </p>\n                </div>\n                <Clock className=\"w-6 h-6 text-primary\" />\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      )}\n\n      {/* Search and Controls */}\n      {currentBatchJob && (\n        <div className=\"flex flex-col md:flex-row gap-4 mb-6\">\n          <div className=\"flex-1\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400\" />\n              <Input\n                placeholder=\"Search files by name or type...\"\n                value={searchTerm}\n                onChange={e => setSearchTerm(e.target.value)}\n                className=\"pl-10\"\n              />\n            </div>\n          </div>\n\n          <div className=\"flex gap-2\">\n            <Select\n              value={filters.status || 'all'}\n              onValueChange={value =>\n                setFilters(prev => ({\n                  ...prev,\n                  status: value === 'all' ? undefined : value,\n                }))\n              }\n            >\n              <SelectTrigger className=\"w-32\">\n                <SelectValue placeholder=\"Status\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All Status</SelectItem>\n                <SelectItem value=\"success\">Success</SelectItem>\n                <SelectItem value=\"error\">Error</SelectItem>\n                <SelectItem value=\"processing\">Processing</SelectItem>\n                <SelectItem value=\"pending\">Pending</SelectItem>\n              </SelectContent>\n            </Select>\n\n            <Button\n              variant=\"outline\"\n              size=\"icon\"\n              onClick={() => setViewMode(viewMode === 'grid' ? 'list' : 'grid')}\n            >\n              {viewMode === 'grid' ? (\n                <List className=\"w-4 h-4\" />\n              ) : (\n                <Grid className=\"w-4 h-4\" />\n              )}\n            </Button>\n\n            {(searchTerm || filters.status) && (\n              <Button\n                variant=\"outline\"\n                onClick={clearFilters}\n                className=\"gap-2\"\n              >\n                <Filter className=\"w-4 h-4\" />\n                Clear\n              </Button>\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* Actions Toolbar */}\n      {currentBatchJob && (\n        <div className=\"flex flex-wrap gap-3 mb-6\">\n          <Button variant=\"outline\" onClick={handleSelectAll} className=\"gap-2\">\n            {selectedFiles.length === paginatedResults.length\n              ? 'Deselect All'\n              : 'Select All'}\n          </Button>\n\n          <Button\n            variant=\"outline\"\n            disabled={selectedFiles.length === 0}\n            className=\"gap-2\"\n          >\n            <RotateCcw className=\"w-4 h-4\" />\n            Reprocess\n          </Button>\n\n          <div className=\"flex gap-2 ml-auto\">\n            <Button\n              variant=\"outline\"\n              onClick={() => handleExport('json')}\n              className=\"gap-2\"\n              disabled={filteredResults.length === 0}\n            >\n              <FileJson className=\"w-4 h-4\" />\n              Export JSON\n            </Button>\n\n            <Button\n              variant=\"outline\"\n              onClick={() => handleExport('csv')}\n              className=\"gap-2\"\n              disabled={filteredResults.length === 0}\n            >\n              <FileSpreadsheet className=\"w-4 h-4\" />\n              Export CSV\n            </Button>\n          </div>\n        </div>\n      )}\n\n      {/* Main Content Area */}\n      {currentBatchJob ? (\n        <div className=\"space-y-6\">\n          {viewMode === 'grid' ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4\">\n              {paginatedResults.map(result => (\n                <Card\n                  key={result.id}\n                  className=\"bg-card border-white/10 hover:border-white/20 transition-colors\"\n                >\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-start justify-between mb-3\">\n                      <div className=\"flex items-center gap-2\">\n                        <input\n                          type=\"checkbox\"\n                          checked={selectedFiles.includes(result.id)}\n                          onChange={() => handleSelectFile(result.id)}\n                          className=\"rounded border-white/20 bg-background\"\n                        />\n                        {getStatusIcon(result.status)}\n                      </div>\n                      {getStatusBadge(result.status)}\n                    </div>\n\n                    <h3\n                      className=\"font-medium text-white mb-2 truncate\"\n                      title={result.filename}\n                    >\n                      {result.filename}\n                    </h3>\n\n                    <div className=\"space-y-1 text-sm text-slate-300\">\n                      <div className=\"flex justify-between\">\n                        <span>Fields:</span>\n                        <span className=\"text-white\">\n                          {result.fieldsExtracted}\n                        </span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span>Size:</span>\n                        <span className=\"text-white\">\n                          {Math.round(result.fileSize / 1024)}KB\n                        </span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span>Type:</span>\n                        <span className=\"text-white text-xs\">\n                          {result.fileType}\n                        </span>\n                      </div>\n                    </div>\n\n                    <div className=\"mt-3 pt-3 border-t border-white/10\">\n                      <p className=\"text-xs text-slate-400\">\n                        {new Date(result.extractionDate).toLocaleDateString()}\n                      </p>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          ) : (\n            <Card className=\"bg-card border-white/10\">\n              <div className=\"overflow-x-auto\">\n                <table className=\"w-full\">\n                  <thead className=\"border-b border-white/10\">\n                    <tr>\n                      <th className=\"text-left p-4\">\n                        <input\n                          type=\"checkbox\"\n                          checked={\n                            selectedFiles.length === paginatedResults.length &&\n                            paginatedResults.length > 0\n                          }\n                          onChange={handleSelectAll}\n                          className=\"rounded border-white/20 bg-background\"\n                        />\n                      </th>\n                      <th className=\"text-left p-4 text-slate-300 font-medium\">\n                        File\n                      </th>\n                      <th className=\"text-left p-4 text-slate-300 font-medium\">\n                        Status\n                      </th>\n                      <th className=\"text-left p-4 text-slate-300 font-medium\">\n                        Fields\n                      </th>\n                      <th className=\"text-left p-4 text-slate-300 font-medium\">\n                        Size\n                      </th>\n                      <th className=\"text-left p-4 text-slate-300 font-medium\">\n                        Type\n                      </th>\n                      <th className=\"text-left p-4 text-slate-300 font-medium\">\n                        Date\n                      </th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {paginatedResults.map(result => (\n                      <tr\n                        key={result.id}\n                        className=\"border-b border-white/5 hover:bg-white/5\"\n                      >\n                        <td className=\"p-4\">\n                          <input\n                            type=\"checkbox\"\n                            checked={selectedFiles.includes(result.id)}\n                            onChange={() => handleSelectFile(result.id)}\n                            className=\"rounded border-white/20 bg-background\"\n                          />\n                        </td>\n                        <td className=\"p-4\">\n                          <div className=\"flex items-center gap-2\">\n                            {getStatusIcon(result.status)}\n                            <span className=\"text-white font-medium\">\n                              {result.filename}\n                            </span>\n                          </div>\n                        </td>\n                        <td className=\"p-4\">{getStatusBadge(result.status)}</td>\n                        <td className=\"p-4 text-white\">\n                          {result.fieldsExtracted}\n                        </td>\n                        <td className=\"p-4 text-white\">\n                          {Math.round(result.fileSize / 1024)}KB\n                        </td>\n                        <td className=\"p-4 text-white text-sm\">\n                          {result.fileType}\n                        </td>\n                        <td className=\"p-4 text-slate-300 text-sm\">\n                          {new Date(result.extractionDate).toLocaleDateString()}\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            </Card>\n          )}\n\n          {/* Pagination */}\n          {totalPages > 1 && (\n            <div className=\"flex items-center justify-between\">\n              <div className=\"text-sm text-slate-300\">\n                Showing {(currentPage - 1) * itemsPerPage + 1} to{' '}\n                {Math.min(currentPage * itemsPerPage, filteredResults.length)}{' '}\n                of {filteredResults.length} results\n              </div>\n              <div className=\"flex gap-2\">\n                <Button\n                  variant=\"outline\"\n                  onClick={() => setCurrentPage(prev => Math.max(1, prev - 1))}\n                  disabled={currentPage === 1}\n                >\n                  Previous\n                </Button>\n                <span className=\"flex items-center px-3 text-white\">\n                  Page {currentPage} of {totalPages}\n                </span>\n                <Button\n                  variant=\"outline\"\n                  onClick={() =>\n                    setCurrentPage(prev => Math.min(totalPages, prev + 1))\n                  }\n                  disabled={currentPage === totalPages}\n                >\n                  Next\n                </Button>\n              </div>\n            </div>\n          )}\n        </div>\n      ) : (\n        <Card className=\"bg-card border-white/10\">\n          <CardContent className=\"py-12 text-center\">\n            <FileText className=\"w-12 h-12 mx-auto mb-4 text-slate-500\" />\n            <p className=\"text-white mb-2\">No batch jobs found</p>\n            <p className=\"text-sm text-slate-300 mb-4\">\n              Upload multiple files to create your first batch processing job\n            </p>\n            <Button onClick={() => setShowUploadZone(true)}>\n              <Upload className=\"w-4 h-4 mr-2\" />\n              Start Batch Processing\n            </Button>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n};\n\nexport default BatchResultsPage;\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/checkout-success.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/credits-success.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/credits.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":69,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2772,2775],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2772,2775],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2838,2841],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2838,2841],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3697,3700],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3697,3700],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\nimport { Layout } from '@/components/layout';\nimport { Button } from '@/components/ui/button';\n\ntype BalanceResponse = { credits?: number; balanceId?: string | null };\ntype Tx = {\n  id: string;\n  type: string;\n  amount: number;\n  description: string | null;\n  createdAt: string;\n  dodoPaymentId: string | null;\n};\n\nasync function fetchJson(path: string) {\n  const res = await fetch(path, { credentials: 'include' });\n  const data = await res.json().catch(() => null);\n  return { ok: res.ok, status: res.status, data };\n}\n\nexport default function CreditsPage() {\n  const [loading, setLoading] = useState(true);\n  const [coreBalance, setCoreBalance] = useState<{ credits: number; balanceId: string | null }>({\n    credits: 0,\n    balanceId: null,\n  });\n  const [imagesBalance, setImagesBalance] = useState<{ credits: number; balanceId: string | null }>({\n    credits: 0,\n    balanceId: null,\n  });\n  const [coreTx, setCoreTx] = useState<Tx[]>([]);\n  const [imagesTx, setImagesTx] = useState<Tx[]>([]);\n  const [error, setError] = useState<string | null>(null);\n  const isLocalDev =\n    typeof window !== 'undefined' &&\n    import.meta.env.DEV &&\n    (window.location.hostname === 'localhost' ||\n      window.location.hostname === '127.0.0.1');\n\n  const loadAll = async () => {\n    setLoading(true);\n    setError(null);\n    try {\n      const [core, images] = await Promise.all([\n        fetchJson('/api/credits/balance'),\n        fetchJson('/api/images_mvp/credits/balance'),\n      ]);\n\n      if (!core.ok || !images.ok) {\n        setError('Failed to load balances.');\n        return;\n      }\n\n      const coreData = (core.data || {}) as BalanceResponse;\n      const imagesData = (images.data || {}) as BalanceResponse;\n      const coreCredits = typeof coreData.credits === 'number' ? coreData.credits : 0;\n      const imagesCredits = typeof imagesData.credits === 'number' ? imagesData.credits : 0;\n      const coreBalanceId = typeof coreData.balanceId === 'string' ? coreData.balanceId : null;\n      const imagesBalanceId = typeof imagesData.balanceId === 'string' ? imagesData.balanceId : null;\n\n      setCoreBalance({ credits: coreCredits, balanceId: coreBalanceId });\n      setImagesBalance({ credits: imagesCredits, balanceId: imagesBalanceId });\n\n      const [coreTxRes, imagesTxRes] = await Promise.all([\n        coreBalanceId ? fetchJson(`/api/credits/transactions?balanceId=${encodeURIComponent(coreBalanceId)}`) : Promise.resolve({ ok: true, data: { transactions: [] } }),\n        imagesBalanceId ? fetchJson(`/api/images_mvp/credits/transactions?balanceId=${encodeURIComponent(imagesBalanceId)}`) : Promise.resolve({ ok: true, data: { transactions: [] } }),\n      ]);\n\n      const coreList = (coreTxRes.data as any)?.transactions;\n      const imagesList = (imagesTxRes.data as any)?.transactions;\n      setCoreTx(Array.isArray(coreList) ? coreList : []);\n      setImagesTx(Array.isArray(imagesList) ? imagesList : []);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    void loadAll();\n  }, []);\n\n  const grantDevCredits = async (scope: 'core' | 'images') => {\n    try {\n      const endpoint =\n        scope === 'core'\n          ? '/api/dev/credits/grant'\n          : '/api/dev/images_mvp/credits/grant';\n      const res = await fetch(endpoint, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({ credits: 100 }),\n      });\n      if (!res.ok) {\n        const data = await res.json().catch(() => null);\n        throw new Error(data?.error || 'Failed to grant credits');\n      }\n      await loadAll();\n    } catch (e: any) {\n      setError(e?.message || 'Failed to grant credits.');\n    }\n  };\n\n  return (\n    <Layout>\n      <div className=\"min-h-screen bg-[#0B0C10] text-white\">\n        <div className=\"max-w-5xl mx-auto px-4 py-10\">\n          <div className=\"flex items-start justify-between gap-4\">\n            <div>\n              <h1 className=\"text-2xl font-bold\">Credits</h1>\n              <p className=\"text-sm text-slate-300 mt-1\">\n                Balances are tracked separately for Images MVP and Core.\n              </p>\n            </div>\n            <Button\n              variant=\"outline\"\n              className=\"border-white/20 text-slate-200 hover:text-white hover:bg-white/10\"\n              onClick={() => void loadAll()}\n              disabled={loading}\n            >\n              Refresh\n            </Button>\n          </div>\n\n          {error && (\n            <div className=\"mt-6 rounded-lg border border-red-500/20 bg-red-500/10 p-4 text-sm text-red-200\">\n              {error}\n            </div>\n          )}\n\n          <div className=\"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div className=\"rounded-lg border border-white/10 bg-white/5 p-5\">\n              <div className=\"text-sm font-semibold\">Images credits (launch)</div>\n              <div className=\"mt-2 text-3xl font-bold\">\n                {loading ? '' : imagesBalance.credits}\n              </div>\n              <div className=\"mt-1 text-xs text-slate-400\">\n                Used by `Images MVP` uploads.\n              </div>\n              <div className=\"mt-4\">\n                <div className=\"text-xs text-slate-300 mb-2\">Recent activity</div>\n                <div className=\"space-y-2\">\n                  {(imagesTx.slice(0, 5) || []).map(t => (\n                    <div\n                      key={t.id}\n                      className=\"flex items-center justify-between text-xs border border-white/10 bg-black/20 rounded px-3 py-2\"\n                    >\n                      <div className=\"truncate pr-2\">\n                        <div className=\"text-slate-200 truncate\">{t.description || t.type}</div>\n                        <div className=\"text-slate-500\">{new Date(t.createdAt).toLocaleString()}</div>\n                      </div>\n                      <div className=\"font-mono text-slate-200\">\n                        {t.type === 'usage' ? '-' : '+'}\n                        {Math.abs(t.amount)}\n                      </div>\n                    </div>\n                  ))}\n                  {(!loading && imagesTx.length === 0) && (\n                    <div className=\"text-xs text-slate-500\">No transactions yet.</div>\n                  )}\n                </div>\n              </div>\n            </div>\n\n            <div className=\"rounded-lg border border-white/10 bg-white/5 p-5\">\n              <div className=\"text-sm font-semibold\">Core credits (internal)</div>\n              <div className=\"mt-2 text-3xl font-bold\">\n                {loading ? '' : coreBalance.credits}\n              </div>\n              <div className=\"mt-1 text-xs text-slate-400\">\n                Used by the Core extractor routes.\n              </div>\n              <div className=\"mt-4\">\n                <div className=\"text-xs text-slate-300 mb-2\">Recent activity</div>\n                <div className=\"space-y-2\">\n                  {(coreTx.slice(0, 5) || []).map(t => (\n                    <div\n                      key={t.id}\n                      className=\"flex items-center justify-between text-xs border border-white/10 bg-black/20 rounded px-3 py-2\"\n                    >\n                      <div className=\"truncate pr-2\">\n                        <div className=\"text-slate-200 truncate\">{t.description || t.type}</div>\n                        <div className=\"text-slate-500\">{new Date(t.createdAt).toLocaleString()}</div>\n                      </div>\n                      <div className=\"font-mono text-slate-200\">\n                        {t.type === 'usage' ? '-' : '+'}\n                        {Math.abs(t.amount)}\n                      </div>\n                    </div>\n                  ))}\n                  {(!loading && coreTx.length === 0) && (\n                    <div className=\"text-xs text-slate-500\">No transactions yet.</div>\n                  )}\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {isLocalDev && (\n            <div className=\"mt-6 rounded-lg border border-amber-500/20 bg-amber-500/10 p-4\">\n              <div className=\"text-sm font-semibold text-amber-200\">\n                Dev tools\n              </div>\n              <div className=\"mt-1 text-xs text-amber-200/90\">\n                Grants +100 credits for quick testing (dev-only endpoints).\n              </div>\n              <div className=\"mt-3 flex flex-wrap gap-2\">\n                <Button\n                  variant=\"outline\"\n                  className=\"border-amber-400/30 text-amber-100 hover:text-amber-50 hover:bg-amber-500/10\"\n                  onClick={() => void grantDevCredits('images')}\n                  disabled={loading}\n                >\n                  +100 Images MVP credits\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  className=\"border-amber-400/30 text-amber-100 hover:text-amber-50 hover:bg-amber-500/10\"\n                  onClick={() => void grantDevCredits('core')}\n                  disabled={loading}\n                >\n                  +100 Core credits\n                </Button>\n              </div>\n            </div>\n          )}\n\n          <div className=\"mt-6 text-xs text-slate-500\">\n            Refunds are available within 7 days for unused credit packs only. Credits do not expire.\n          </div>\n        </div>\n      </div>\n    </Layout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/dashboard-improved.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/dashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":59,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":59,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Dashboard Page\n * \n * Protected dashboard showing user information and system status\n */\n\nimport React, { useState, useEffect } from \"react\";\nimport { useAuth } from \"@/lib/auth\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  User, \n  Shield, \n  Activity, \n  FileText, \n  Upload, \n  Settings,\n  CheckCircle2,\n  AlertCircle,\n  Clock\n} from \"lucide-react\";\nimport Navigation from \"@/components/navigation\";\n\ninterface SystemStatus {\n  server: \"online\" | \"offline\" | \"checking\";\n  auth: \"active\" | \"inactive\" | \"checking\";\n  processing: \"ready\" | \"busy\" | \"checking\";\n}\n\nexport default function Dashboard() {\n  const { user, isAuthenticated } = useAuth();\n  const [systemStatus, setSystemStatus] = useState<SystemStatus>({\n    server: \"checking\",\n    auth: \"checking\", \n    processing: \"checking\"\n  });\n\n  useEffect(() => {\n    checkSystemStatus();\n  }, []);\n\n  const checkSystemStatus = async () => {\n    try {\n      // Check server health\n      const healthResponse = await fetch(\"/api/health\");\n      const serverStatus = healthResponse.ok ? \"online\" : \"offline\";\n\n      // Check auth status\n      const authResponse = await fetch(\"/api/auth/me\");\n      const authData = await authResponse.json();\n      const authStatus = authData.authenticated ? \"active\" : \"inactive\";\n\n      setSystemStatus({\n        server: serverStatus,\n        auth: authStatus,\n        processing: \"ready\"\n      });\n    } catch (error) {\n      setSystemStatus({\n        server: \"offline\",\n        auth: \"inactive\",\n        processing: \"ready\"\n      });\n    }\n  };\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case \"online\":\n      case \"active\":\n      case \"ready\":\n        return <CheckCircle2 className=\"w-4 h-4 text-green-500\" />;\n      case \"offline\":\n      case \"inactive\":\n        return <AlertCircle className=\"w-4 h-4 text-red-500\" />;\n      case \"busy\":\n        return <Clock className=\"w-4 h-4 text-yellow-500\" />;\n      default:\n        return <Clock className=\"w-4 h-4 text-gray-500\" />;\n    }\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case \"online\":\n      case \"active\":\n      case \"ready\":\n        return \"bg-green-500/10 text-green-500 border-green-500/20\";\n      case \"offline\":\n      case \"inactive\":\n        return \"bg-red-500/10 text-red-500 border-red-500/20\";\n      case \"busy\":\n        return \"bg-yellow-500/10 text-yellow-500 border-yellow-500/20\";\n      default:\n        return \"bg-gray-500/10 text-gray-500 border-gray-500/20\";\n    }\n  };\n\n  const getTierColor = (tier: string) => {\n    switch (tier) {\n      case \"free\":\n        return \"bg-gray-600\";\n      case \"professional\":\n        return \"bg-blue-600\";\n      case \"forensic\":\n        return \"bg-purple-600\";\n      case \"enterprise\":\n        return \"bg-green-600\";\n      default:\n        return \"bg-gray-600\";\n    }\n  };\n\n  const getTierFeatures = (tier: string) => {\n    switch (tier) {\n      case \"professional\":\n        return [\n          \"Advanced metadata extraction\",\n          \"Batch processing\",\n          \"Export capabilities\",\n          \"Priority support\"\n        ];\n      case \"forensic\":\n        return [\n          \"All Professional features\",\n          \"Forensic analysis tools\",\n          \"Timeline reconstruction\",\n          \"Evidence reporting\"\n        ];\n      case \"enterprise\":\n        return [\n          \"All Forensic features\",\n          \"API access\",\n          \"Custom integrations\",\n          \"Dedicated support\"\n        ];\n      default:\n        return [\n          \"Basic metadata extraction\",\n          \"Single file processing\",\n          \"Standard formats\"\n        ];\n    }\n  };\n\n  if (!isAuthenticated || !user) {\n    return (\n      <div className=\"min-h-screen bg-[#0B0C10]\">\n        <Navigation />\n        <div className=\"flex items-center justify-center min-h-[calc(100vh-64px)]\">\n          <Card className=\"bg-[#1a1a2e] border-white/10 text-white\">\n            <CardContent className=\"p-6 text-center\">\n              <AlertCircle className=\"w-12 h-12 text-red-500 mx-auto mb-4\" />\n              <h2 className=\"text-xl font-bold mb-2\">Access Denied</h2>\n              <p className=\"text-slate-300\">Please log in to access the dashboard.</p>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-[#0B0C10]\">\n      <Navigation />\n      \n      <div className=\"max-w-7xl mx-auto p-6\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold text-white mb-2\">Dashboard</h1>\n          <p className=\"text-slate-300\">Welcome back, {user.username}! Here's your account overview.</p>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n          {/* User Information */}\n          <Card className=\"bg-[#1a1a2e] border-white/10 text-white\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <User className=\"w-5 h-5\" />\n                Account Information\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div>\n                <label className=\"text-sm text-slate-300\">Username</label>\n                <p className=\"font-medium\">{user.username}</p>\n              </div>\n              <div>\n                <label className=\"text-sm text-slate-300\">Email</label>\n                <p className=\"font-medium\">{user.email}</p>\n              </div>\n              <div>\n                <label className=\"text-sm text-slate-300\">Subscription Tier</label>\n                <div className=\"flex items-center gap-2 mt-1\">\n                  <Badge className={`${getTierColor(user.tier)} text-white`}>\n                    {user.tier.toUpperCase()}\n                  </Badge>\n                  <span className=\"text-sm text-slate-300\">\n                    ({user.subscriptionStatus || \"active\"})\n                  </span>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* System Status */}\n          <Card className=\"bg-[#1a1a2e] border-white/10 text-white\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Activity className=\"w-5 h-5\" />\n                System Status\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-sm\">Server</span>\n                <div className=\"flex items-center gap-2\">\n                  {getStatusIcon(systemStatus.server)}\n                  <Badge className={getStatusColor(systemStatus.server)}>\n                    {systemStatus.server}\n                  </Badge>\n                </div>\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-sm\">Authentication</span>\n                <div className=\"flex items-center gap-2\">\n                  {getStatusIcon(systemStatus.auth)}\n                  <Badge className={getStatusColor(systemStatus.auth)}>\n                    {systemStatus.auth}\n                  </Badge>\n                </div>\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-sm\">Processing</span>\n                <div className=\"flex items-center gap-2\">\n                  {getStatusIcon(systemStatus.processing)}\n                  <Badge className={getStatusColor(systemStatus.processing)}>\n                    {systemStatus.processing}\n                  </Badge>\n                </div>\n              </div>\n              <Button \n                onClick={checkSystemStatus}\n                variant=\"outline\" \n                size=\"sm\" \n                className=\"w-full border-white/20 text-slate-200 hover:text-white hover:bg-white/10\"\n              >\n                Refresh Status\n              </Button>\n            </CardContent>\n          </Card>\n\n          {/* Quick Actions */}\n          <Card className=\"bg-[#1a1a2e] border-white/10 text-white\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Settings className=\"w-5 h-5\" />\n                Quick Actions\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-3\">\n              <Button \n                className=\"w-full bg-[#6366f1] hover:bg-[#5855eb] text-white\"\n                onClick={() => window.location.href = \"/\"}\n              >\n                <Upload className=\"w-4 h-4 mr-2\" />\n                Upload Files\n              </Button>\n              <Button \n                variant=\"outline\" \n                className=\"w-full border-white/20 text-slate-200 hover:text-white hover:bg-white/10\"\n                onClick={() => window.location.href = \"/images_mvp/results\"}\n              >\n                <FileText className=\"w-4 h-4 mr-2\" />\n                View Results\n              </Button>\n              {process.env.NODE_ENV === 'development' && (\n                <Button \n                  variant=\"outline\" \n                  className=\"w-full border-white/20 text-slate-200 hover:text-white hover:bg-white/10\"\n                  onClick={() => window.open(\"/api/dev/auth-test\", \"_blank\")}\n                >\n                  <Shield className=\"w-4 h-4 mr-2\" />\n                  Test Authentication (Dev)\n                </Button>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Tier Features */}\n        <Card className=\"bg-[#1a1a2e] border-white/10 text-white mt-6\">\n          <CardHeader>\n            <CardTitle>Your {user.tier.charAt(0).toUpperCase() + user.tier.slice(1)} Features</CardTitle>\n            <CardDescription className=\"text-slate-300\">\n              Features available with your current subscription tier\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              {getTierFeatures(user.tier).map((feature, index) => (\n                <div key={index} className=\"flex items-center gap-2\">\n                  <CheckCircle2 className=\"w-4 h-4 text-green-500 flex-shrink-0\" />\n                  <span className=\"text-sm\">{feature}</span>\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/gdpr-compliance.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Tabs' is defined but never used.","line":15,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsContent' is defined but never used.","line":15,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsList' is defined but never used.","line":15,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsTrigger' is defined but never used.","line":15,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RadioGroup' is defined but never used.","line":16,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RadioGroupItem' is defined but never used.","line":16,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Download' is defined but never used.","line":19,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":73,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":73,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/*\n * GDPR Compliance Page Component\n * Provides information about GDPR compliance and user rights\n */\n\nimport React, { useState } from 'react';\nimport { Link } from 'react-router-dom';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Shield, User, FileText, Download, Mail, AlertTriangle } from 'lucide-react';\n\nexport default function GDPRCompliancePage() {\n  const [requestType, setRequestType] = useState('');\n  const [reason, setReason] = useState('');\n  const [email, setEmail] = useState('');\n  const [confirmationCode, setConfirmationCode] = useState('');\n  const [consentChecked, setConsentChecked] = useState(false);\n  const [submitting, setSubmitting] = useState(false);\n  const [submitSuccess, setSubmitSuccess] = useState(false);\n  const [error, setError] = useState('');\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!consentChecked) {\n      setError('You must consent to submit this request');\n      return;\n    }\n    \n    setSubmitting(true);\n    setError('');\n    \n    try {\n      // In a real implementation, this would make an API call\n      const response = await fetch('/api/legal/gdpr', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          requestType,\n          reason,\n          verification: {\n            email,\n            confirmationCode\n          }\n        })\n      });\n      \n      if (!response.ok) {\n        throw new Error('Failed to submit GDPR request');\n      }\n      \n      setSubmitSuccess(true);\n      // Reset form after successful submission\n      setTimeout(() => {\n        setRequestType('');\n        setReason('');\n        setEmail('');\n        setConfirmationCode('');\n        setConsentChecked(false);\n        setSubmitSuccess(false);\n      }, 3000);\n    } catch (err) {\n      setError('Failed to submit your request. Please try again later.');\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-gray-900 dark:to-gray-800 py-12 px-4\">\n      <div className=\"max-w-6xl mx-auto\">\n        <div className=\"text-center mb-12\">\n          <div className=\"inline-flex items-center justify-center w-16 h-16 bg-blue-100 dark:bg-blue-900/50 rounded-full mb-6\">\n            <Shield className=\"w-8 h-8 text-blue-600 dark:text-blue-400\" />\n          </div>\n          <h1 className=\"text-4xl font-bold text-gray-900 dark:text-white mb-4\">\n            GDPR Compliance & Data Rights\n          </h1>\n          <p className=\"text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto\">\n            Understand your rights under the General Data Protection Regulation (GDPR) and exercise control over your personal data\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n          <div className=\"lg:col-span-2 space-y-8\">\n            <Card className=\"shadow-lg\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2 text-2xl\">\n                  <User className=\"w-6 h-6 text-blue-600\" />\n                  Your GDPR Rights\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <ScrollArea className=\"h-[500px] pr-4\">\n                  <div className=\"space-y-6\">\n                    <section>\n                      <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-2\">Right to Access</h3>\n                      <p className=\"text-gray-600 dark:text-gray-400\">\n                        You have the right to obtain confirmation about whether we process your personal data and, if so, to access that data. \n                        We will provide you with a copy of your personal data being processed.\n                      </p>\n                    </section>\n\n                    <section>\n                      <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-2\">Right to Rectification</h3>\n                      <p className=\"text-gray-600 dark:text-gray-400\">\n                        You have the right to have inaccurate personal data rectified. Taking into account the purposes of the processing, \n                        you have the right to have incomplete personal data completed, including by means of providing a supplementary statement.\n                      </p>\n                    </section>\n\n                    <section>\n                      <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-2\">Right to Erasure</h3>\n                      <p className=\"text-gray-600 dark:text-gray-400\">\n                        You have the right to have your personal data erased when the personal data is no longer necessary for the purposes \n                        for which it was processed, or when you withdraw consent and there is no other legal ground for processing.\n                      </p>\n                    </section>\n\n                    <section>\n                      <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-2\">Right to Restrict Processing</h3>\n                      <p className=\"text-gray-600 dark:text-gray-400\">\n                        You have the right to restrict processing of your personal data when the accuracy of the personal data is contested, \n                        the processing is unlawful, or we no longer need the personal data for the purposes of processing.\n                      </p>\n                    </section>\n\n                    <section>\n                      <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-2\">Right to Data Portability</h3>\n                      <p className=\"text-gray-600 dark:text-gray-400\">\n                        You have the right to receive your personal data in a structured, commonly used, and machine-readable format, \n                        and to transmit that data to another controller without hindrance from us.\n                      </p>\n                    </section>\n\n                    <section>\n                      <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-2\">Right to Object</h3>\n                      <p className=\"text-gray-600 dark:text-gray-400\">\n                        You have the right to object to processing of your personal data based on legitimate interests or direct marketing. \n                        We will cease processing unless we demonstrate compelling legitimate grounds for the processing.\n                      </p>\n                    </section>\n\n                    <section>\n                      <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-2\">Right to Withdraw Consent</h3>\n                      <p className=\"text-gray-600 dark:text-gray-400\">\n                        You have the right to withdraw your consent at any time. Withdrawing your consent will not affect the lawfulness \n                        of processing based on consent before its withdrawal.\n                      </p>\n                    </section>\n                  </div>\n                </ScrollArea>\n              </CardContent>\n            </Card>\n          </div>\n\n          <div className=\"space-y-8\">\n            <Card className=\"shadow-lg\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <FileText className=\"w-5 h-5 text-blue-600\" />\n                  Submit Request\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <form onSubmit={handleSubmit} className=\"space-y-6\">\n                  {error && (\n                    <Alert variant=\"destructive\">\n                      <AlertTriangle className=\"h-4 w-4\" />\n                      <AlertDescription>{error}</AlertDescription>\n                    </Alert>\n                  )}\n                  \n                  {submitSuccess && (\n                    <Alert className=\"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800\">\n                      <AlertDescription className=\"text-green-800 dark:text-green-200\">\n                        Your GDPR request has been submitted successfully. We will process it within 30 days.\n                      </AlertDescription>\n                    </Alert>\n                  )}\n\n                  <div className=\"space-y-4\">\n                    <div>\n                      <Label htmlFor=\"requestType\">Request Type</Label>\n                      <Select value={requestType} onValueChange={setRequestType}>\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select a request type\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"access\">Right of Access</SelectItem>\n                          <SelectItem value=\"rectification\">Right to Rectification</SelectItem>\n                          <SelectItem value=\"erasure\">Right to Erasure</SelectItem>\n                          <SelectItem value=\"portability\">Right to Data Portability</SelectItem>\n                          <SelectItem value=\"restriction\">Right to Restriction</SelectItem>\n                          <SelectItem value=\"objection\">Right to Object</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n\n                    <div>\n                      <Label htmlFor=\"reason\">Reason for Request</Label>\n                      <Textarea\n                        id=\"reason\"\n                        value={reason}\n                        onChange={(e) => setReason(e.target.value)}\n                        placeholder=\"Provide a detailed reason for your request...\"\n                        rows={4}\n                        required\n                      />\n                    </div>\n\n                    <div>\n                      <Label htmlFor=\"email\">Email Address</Label>\n                      <Input\n                        id=\"email\"\n                        type=\"email\"\n                        value={email}\n                        onChange={(e) => setEmail(e.target.value)}\n                        placeholder=\"your.email@example.com\"\n                        required\n                      />\n                    </div>\n\n                    <div>\n                      <Label htmlFor=\"confirmationCode\">Confirmation Code</Label>\n                      <Input\n                        id=\"confirmationCode\"\n                        value={confirmationCode}\n                        onChange={(e) => setConfirmationCode(e.target.value)}\n                        placeholder=\"Enter confirmation code sent to your email\"\n                        required\n                      />\n                      <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\n                        A confirmation code will be sent to verify your identity\n                      </p>\n                    </div>\n\n                    <div className=\"flex items-start space-x-2 pt-2\">\n                      <Checkbox\n                        id=\"consent\"\n                        checked={consentChecked}\n                        onCheckedChange={(checked) => setConsentChecked(!!checked)}\n                      />\n                      <div className=\"grid gap-1.5 leading-none\">\n                        <label\n                          htmlFor=\"consent\"\n                          className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n                        >\n                          I confirm that I am the data subject or authorized representative\n                        </label>\n                        <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n                          By checking this box, you consent to submitting this GDPR request\n                        </p>\n                      </div>\n                    </div>\n\n                    <Button \n                      type=\"submit\" \n                      className=\"w-full\" \n                      disabled={!requestType || !reason || !email || !confirmationCode || !consentChecked || submitting}\n                    >\n                      {submitting ? 'Submitting...' : 'Submit Request'}\n                    </Button>\n                  </div>\n                </form>\n              </CardContent>\n            </Card>\n\n            <Card className=\"shadow-lg\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Mail className=\"w-5 h-5 text-blue-600\" />\n                  Contact Information\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <p className=\"text-gray-600 dark:text-gray-400\">\n                    For questions about GDPR compliance or to exercise your rights, contact our Data Protection Officer:\n                  </p>\n                  <div className=\"space-y-2\">\n                    <p className=\"font-medium text-gray-900 dark:text-white\">Email:</p>\n                    <p className=\"text-blue-600 dark:text-blue-400\">dpo@metaextract.com</p>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <p className=\"font-medium text-gray-900 dark:text-white\">Address:</p>\n                    <p className=\"text-gray-600 dark:text-gray-400\">\n                      Data Protection Officer<br />\n                      MetaExtract<br />\n                      [Company Address]\n                    </p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n\n        <div className=\"mt-12 text-center\">\n          <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-6\">Additional Legal Resources</h2>\n          <div className=\"flex flex-wrap justify-center gap-4\">\n            <Button variant=\"outline\" asChild>\n              <Link to=\"/privacy\" className=\"flex items-center gap-2\">\n                <Shield className=\"w-4 h-4\" />\n                Privacy Policy\n              </Link>\n            </Button>\n            <Button variant=\"outline\" asChild>\n              <Link to=\"/terms\" className=\"flex items-center gap-2\">\n                <FileText className=\"w-4 h-4\" />\n                Terms of Service\n              </Link>\n            </Button>\n            <Button variant=\"outline\" asChild>\n              <Link to=\"/data-processing-agreement\" className=\"flex items-center gap-2\">\n                <FileText className=\"w-4 h-4\" />\n                Data Processing Agreement\n              </Link>\n            </Button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/home.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CREDIT_EXPLANATION' is defined but never used.","line":7,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Lock' is defined but never used.","line":20,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Info' is defined but never used.","line":22,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Share2' is defined but never used.","line":26,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Coins' is defined but never used.","line":31,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useScroll' is defined but never used.","line":37,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useTransform' is defined but never used.","line":37,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useSpring' is defined but never used.","line":37,"column":43,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":52},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Tooltip' is defined but never used.","line":39,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TooltipContent' is defined but never used.","line":40,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":40,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TooltipProvider' is defined but never used.","line":41,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TooltipTrigger' is defined but never used.","line":42,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":42,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SESSION_STORAGE_LIMIT' is assigned a value but never used.","line":51,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":51,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2372,2375],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2372,2375],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":92,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":92,"endColumn":21,"suggestions":[{"fix":{"range":[2630,2747],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":144,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":144,"endColumn":20,"suggestions":[{"fix":{"range":[4425,4472],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":196,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":196,"endColumn":20,"suggestions":[{"fix":{"range":[6052,6092],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":17,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useRef, useState, useEffect } from 'react';\nimport { PublicLayout as Layout } from '@/components/public-layout';\nimport { EnhancedUploadZone } from '@/components/enhanced-upload-zone';\nimport {\n  PRICING_TIERS,\n  CREDIT_PACKS,\n  CREDIT_EXPLANATION,\n} from '@/lib/mockData';\nimport { Button } from '@/components/ui/button';\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport {\n  Database,\n  Lock,\n  Globe,\n  Info,\n  MoveRight,\n  ScanLine,\n  Terminal,\n  Share2,\n  ShieldAlert,\n  Zap,\n  CheckCircle2,\n  Loader2,\n  Coins,\n  User,\n  LogIn,\n  UserPlus,\n  Upload,\n} from 'lucide-react';\nimport { motion, useScroll, useTransform, useSpring } from 'framer-motion';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from '@/components/ui/tooltip';\nimport generatedBackground from '@assets/generated_images/chaotic_dark_forensic_data_visualization_with_connecting_lines.png';\nimport { useToast } from '@/hooks/use-toast';\nimport { useNavigate } from 'react-router-dom';\nimport { useAuth } from '@/lib/auth';\nimport { cn } from '@/lib/utils';\n\n// Constants for configuration\nconst SESSION_STORAGE_LIMIT = 4 * 1024 * 1024; // 4MB\n\n// Custom hook for mouse parallax\nfunction useParallax(sensitivity = 20) {\n  const [position, setPosition] = useState({ x: 0, y: 0 });\n\n  useEffect(() => {\n    const handleMouseMove = (e: MouseEvent) => {\n      setPosition({\n        x: (e.clientX - window.innerWidth / 2) / sensitivity,\n        y: (e.clientY - window.innerHeight / 2) / sensitivity,\n      });\n    };\n    window.addEventListener('mousemove', handleMouseMove);\n    return () => window.removeEventListener('mousemove', handleMouseMove);\n  }, [sensitivity]);\n\n  return position;\n}\n\nexport default function Home() {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const parallax = useParallax(30);\n  const parallaxBg = useParallax(80);\n  const [checkoutLoading, setCheckoutLoading] = useState<string | null>(null);\n  const [creditPackLoading, setCreditPackLoading] = useState<string | null>(\n    null\n  );\n  const [advancedMode, setAdvancedMode] = useState(false);\n  const { toast } = useToast();\n  const navigate = useNavigate();\n  const { user, isAuthenticated, isLoading } = useAuth();\n\n  const handleUploadResults = (results: any[]) => {\n    if (results.length > 0) {\n      const result = results[0];\n\n      // Try to store in session storage (might fail if too large)\n      try {\n        sessionStorage.setItem('currentMetadata', JSON.stringify(result));\n      } catch (e) {\n        console.warn(\n          'Metadata too large for session storage, using navigation state only',\n          e\n        );\n        // Clear old data to prevent confusion\n        sessionStorage.removeItem('currentMetadata');\n      }\n\n      // Navigate with state AND ID param if available (for shareable links)\n      const search = result.id ? `?id=${result.id}` : '';\n      navigate(`/images_mvp/results${search}`, { state: { metadata: result } });\n    }\n  };\n\n  const handleCreditPurchase = async (packName: string) => {\n    const packKey = packName.toLowerCase() as 'single' | 'batch' | 'bulk';\n    setCreditPackLoading(packKey);\n\n    try {\n      const response = await fetch('/api/credits/purchase', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({ pack: packKey }),\n      });\n\n      // Check if response is ok before parsing JSON\n      if (!response.ok) {\n        if (response.status === 401) {\n          const loginButton = document.querySelector(\n            '[data-auth=\"login\"]'\n          ) as HTMLButtonElement | null;\n          loginButton?.click();\n          throw new Error('Please sign in to purchase credits.');\n        }\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(\n          errorData.error || `HTTP error! status: ${response.status}`\n        );\n      }\n\n      const data = await response.json().catch(() => {\n        throw new Error('Invalid response format from server');\n      });\n\n      if (data.checkout_url) {\n        // Open checkout in new tab to preserve app state\n        window.open(data.checkout_url, '_blank');\n      } else {\n        throw new Error('No checkout URL received from server');\n      }\n    } catch (error) {\n      console.error('Credit purchase error:', error);\n      toast({\n        title: 'Credit Purchase Error',\n        description:\n          error instanceof Error\n            ? error.message\n            : 'Failed to start credit purchase',\n        variant: 'destructive',\n      });\n    } finally {\n      setCreditPackLoading(null);\n    }\n  };\n\n  const handleCheckout = async (tier: string) => {\n    if (tier === 'free') {\n      // Check for reduced motion preference\n      const prefersReducedMotion = window.matchMedia(\n        '(prefers-reduced-motion: reduce)'\n      ).matches;\n      const behavior = prefersReducedMotion ? 'auto' : 'smooth';\n      document.getElementById('enhanced-upload')?.scrollIntoView({ behavior });\n      return;\n    }\n\n    setCheckoutLoading(tier);\n    try {\n      const response = await fetch('/api/checkout/create-session', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ tier }),\n      });\n\n      // Check if response is ok before parsing JSON\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(\n          errorData.error || `HTTP error! status: ${response.status}`\n        );\n      }\n\n      const data = await response.json().catch(() => {\n        throw new Error('Invalid response format from server');\n      });\n\n      if (data.checkout_url) {\n        // Open checkout in new tab to preserve app state\n        window.open(data.checkout_url, '_blank');\n      } else {\n        throw new Error('No checkout URL received from server');\n      }\n    } catch (error) {\n      console.error('Checkout error:', error);\n      toast({\n        title: 'Checkout Error',\n        description:\n          error instanceof Error ? error.message : 'Failed to start checkout',\n        variant: 'destructive',\n      });\n    } finally {\n      setCheckoutLoading(null);\n    }\n  };\n\n  // Check if user has access to advanced features\n  const hasAdvancedAccess = !!(\n    user && ['professional', 'forensic', 'enterprise'].includes(user.tier)\n  );\n\n  return (\n    <Layout showHeader={true} showFooter={true}>\n      <div\n        ref={containerRef}\n        id=\"main-content\"\n        className=\"relative min-h-[200vh] bg-[#0B0C10] overflow-hidden selection:bg-primary/30\"\n      >\n        {/* Global animated background elements */}\n        <div\n          className=\"fixed inset-0 z-0 pointer-events-none\"\n          aria-hidden=\"true\"\n        >\n          <motion.div\n            style={{ x: parallaxBg.x, y: parallaxBg.y }}\n            className=\"absolute inset-0 opacity-20\"\n          >\n            <img\n              src={generatedBackground}\n              alt=\"\"\n              className=\"w-full h-full object-cover mix-blend-screen scale-110\"\n            />\n          </motion.div>\n          <div className=\"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 brightness-100 contrast-150 mix-blend-overlay\"></div>\n\n          {/* Floating data shards */}\n          {[...Array(5)].map((_, i) => (\n            <motion.div\n              key={i}\n              className=\"absolute border border-white/5 bg-black/40 backdrop-blur-sm p-4 font-mono text-[10px] text-primary/60\"\n              style={{\n                top: `${Math.random() * 80 + 10}%`,\n                left: `${Math.random() * 80 + 10}%`,\n                rotate: `${Math.random() * 20 - 10}deg`,\n              }}\n              animate={{\n                y: [0, -20, 0],\n                opacity: [0.3, 0.6, 0.3],\n              }}\n              transition={{\n                duration: 5 + Math.random() * 5,\n                repeat: Infinity,\n                ease: 'easeInOut',\n              }}\n            >\n              {`0x${Math.floor(Math.random() * 16777215)\n                .toString(16)\n                .toUpperCase()}`}{' '}\n              {/* SEGMENT_{i} */}\n            </motion.div>\n          ))}\n        </div>\n\n        {/* SECTION 1: HERO */}\n        <section className=\"relative min-h-screen flex flex-col justify-center px-6 md:px-20 z-10 pt-20\">\n          <div className=\"max-w-[1400px] mx-auto w-full grid grid-cols-1 md:grid-cols-12 gap-8 items-center\">\n            {/* Left text block */}\n            <div className=\"md:col-span-7 relative\">\n              <motion.div\n                initial={{ opacity: 0, x: -50 }}\n                animate={{ opacity: 1, x: 0 }}\n                className=\"relative z-20\"\n              >\n                <h1 className=\"text-3xl sm:text-4xl md:text-6xl lg:text-7xl font-bold text-white tracking-tight leading-tight mb-6\">\n                  Extract forensic metadata{' '}\n                  <span className=\"text-primary\">competitors miss.</span>\n                </h1>\n\n                <p className=\"text-base md:text-lg lg:text-xl text-slate-200 max-w-xl leading-relaxed mb-8\">\n                    Courts, journalists, and security teams trust MetaExtract to\n                    uncover <span className=\"text-primary font-semibold\">131,000+</span> hidden fields, detect AI-generated content, verify C2PA provenance, and\n                    preserve digital evidence.\n                  </p>\n\n                  <div className=\"flex flex-wrap gap-4 items-center mb-12\">\n                    <div className=\"flex items-center gap-2 text-sm text-slate-200\">\n                      <CheckCircle2 className=\"w-4 h-4 text-emerald-500\" />\n                      <span>AI Detection</span>\n                    </div>\n                    <div className=\"flex items-center gap-2 text-sm text-slate-200\">\n                      <CheckCircle2 className=\"w-4 h-4 text-emerald-500\" />\n                      <span>C2PA Provenance</span>\n                    </div>\n                    <div className=\"flex items-center gap-2 text-sm text-slate-200\">\n                      <CheckCircle2 className=\"w-4 h-4 text-emerald-500\" />\n                      <span>Bitstream Forensics</span>\n                    </div>\n                  </div>\n\n                <div className=\"flex gap-4 items-center\">\n                  <Button\n                    onClick={() =>\n                      document\n                        .getElementById('enhanced-upload')\n                        ?.scrollIntoView({ behavior: 'smooth' })\n                    }\n                    className=\"h-14 px-8 bg-primary hover:bg-white text-black font-bold text-lg rounded shadow-[0_0_20px_rgba(99,102,241,0.3)] hover:shadow-[0_0_30px_rgba(255,255,255,0.4)] transition-all transform hover:-translate-y-1\"\n                  >\n                    START EXTRACTION\n                  </Button>\n                  <div className=\"flex flex-col gap-1 text-sm text-slate-300\">\n                    <span>No sign-up required for free scan.</span>\n                    <a\n                      href=\"#pricing\"\n                      className=\"text-primary hover:underline text-xs\"\n                    >\n                      Plans start at FREE\n                    </a>\n                  </div>\n                </div>\n              </motion.div>\n            </div>\n\n            {/* Right Interactive Zone */}\n            <motion.div\n              style={{ x: parallax.x, y: parallax.y }}\n              className=\"md:col-span-5 relative h-[500px] flex items-center justify-center\"\n            >\n              <div className=\"absolute inset-0 border border-white/10 rounded-3xl bg-black/20 backdrop-blur-sm -rotate-6 z-0\"></div>\n              <div\n                id=\"enhanced-upload\"\n                className=\"relative z-10 w-full transform rotate-3 transition-transform hover:rotate-0 duration-500\"\n              >\n                {isAuthenticated && hasAdvancedAccess && (\n                  <div className=\"mb-4 flex items-center justify-center gap-3 p-3 bg-purple-500/10 border border-purple-500/20 rounded-lg backdrop-blur-sm\">\n                    <ShieldAlert className=\"w-4 h-4 text-purple-400\" />\n                    <span className=\"text-sm text-purple-300 font-medium\">\n                      Advanced Forensic Analysis\n                    </span>\n                    <Button\n                      onClick={() => setAdvancedMode(!advancedMode)}\n                      variant={advancedMode ? 'default' : 'outline'}\n                      size=\"sm\"\n                      className={cn(\n                        'transition-all duration-200',\n                        advancedMode\n                          ? 'bg-purple-600 hover:bg-purple-700 text-white border-purple-600'\n                          : 'border-purple-400/50 text-purple-300 hover:text-purple-200 hover:bg-purple-500/10'\n                      )}\n                    >\n                      <Zap className=\"w-3 h-3 mr-1\" />\n                      {advancedMode ? 'Enabled' : 'Enable'}\n                    </Button>\n                  </div>\n                )}\n                <EnhancedUploadZone\n                  onResults={handleUploadResults}\n                  tier={\n                    import.meta.env.DEV ? 'enterprise' : user?.tier || 'free'\n                  }\n                  maxFiles={1}\n                  advanced={advancedMode && hasAdvancedAccess}\n                />\n\n                {/* Decorative orbiting elements */}\n                <motion.div\n                  animate={{ rotate: 360 }}\n                  transition={{\n                    duration: 20,\n                    repeat: Infinity,\n                    ease: 'linear',\n                  }}\n                  className=\"absolute -top-10 -right-10 w-32 h-32 border border-dashed border-primary/30 rounded-full\"\n                ></motion.div>\n              </div>\n            </motion.div>\n          </div>\n        </section>\n\n        {/* AUTHENTICATION STATUS SECTION */}\n        <section className=\"relative py-12 z-10\">\n          <div className=\"container mx-auto px-4 max-w-4xl\">\n            <Card className=\"bg-[#1a1a2e] border-white/10 text-white\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <User className=\"w-5 h-5\" />\n                  Authentication Status\n                </CardTitle>\n                <CardDescription className=\"text-slate-300\">\n                  {isAuthenticated\n                    ? 'You are logged in and can access all features'\n                    : 'Login to access advanced features and save your work'}\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                {isLoading ? (\n                  <div className=\"flex items-center gap-2\">\n                    <Loader2 className=\"w-4 h-4 animate-spin\" />\n                    <span>Checking authentication...</span>\n                  </div>\n                ) : isAuthenticated && user ? (\n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-center justify-between p-4 bg-green-500/10 border border-green-500/20 rounded-lg\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-10 h-10 bg-green-500/20 rounded-full flex items-center justify-center\">\n                          <CheckCircle2 className=\"w-5 h-5 text-green-500\" />\n                        </div>\n                        <div>\n                          <p className=\"font-medium\">\n                            Welcome back, {user.username}!\n                          </p>\n                          <p className=\"text-sm text-slate-300\">{user.email}</p>\n                        </div>\n                      </div>\n                      <Badge\n                        className={`${user.tier === 'professional' ? 'bg-blue-600' : user.tier === 'forensic' ? 'bg-purple-600' : user.tier === 'enterprise' ? 'bg-green-600' : 'bg-gray-600'} text-white`}\n                      >\n                        {user.tier.toUpperCase()}\n                      </Badge>\n                    </div>\n\n                    <div className=\"flex gap-3\">\n                      <Button\n                        onClick={() => navigate('/images_mvp')}\n                        className=\"bg-[#6366f1] hover:bg-[#5855eb] text-white\"\n                      >\n                        <Upload className=\"w-4 h-4 mr-2\" />\n                        Start Extracting\n                      </Button>\n                      <Button\n                        onClick={() => navigate('/images_mvp/results')}\n                        variant=\"outline\"\n                        className=\"border-white/20 text-slate-200 hover:text-white hover:bg-white/10\"\n                      >\n                        View Results\n                      </Button>\n                    </div>\n                  </div>\n                ) : (\n                  <div className=\"space-y-4\">\n                    <div className=\"p-4 bg-blue-500/10 border border-blue-500/20 rounded-lg\">\n                      <h4 className=\"font-medium mb-2\">\n                        Test the Authentication System\n                      </h4>\n                      <p className=\"text-sm text-slate-300 mb-4\">\n                        Use these test credentials to login and explore\n                        different subscription tiers:\n                      </p>\n\n                      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3 mb-4\">\n                        <div className=\"p-3 bg-white/5 rounded border border-white/10\">\n                          <p className=\"text-xs font-mono text-blue-400 mb-1\">\n                            PROFESSIONAL\n                          </p>\n                          <p className=\"text-xs font-mono\">\n                            test@metaextract.com\n                          </p>\n                          <p className=\"text-xs font-mono\">\n                            TestPassword123!\n                          </p>\n                        </div>\n                        <div className=\"p-3 bg-white/5 rounded border border-white/10\">\n                          <p className=\"text-xs font-mono text-purple-400 mb-1\">\n                            FORENSIC\n                          </p>\n                          <p className=\"text-xs font-mono\">\n                            forensic@metaextract.com\n                          </p>\n                          <p className=\"text-xs font-mono\">\n                            ForensicPassword123!\n                          </p>\n                        </div>\n                        <div className=\"p-3 bg-white/5 rounded border border-white/10\">\n                          <p className=\"text-xs font-mono text-green-400 mb-1\">\n                            ENTERPRISE\n                          </p>\n                          <p className=\"text-xs font-mono\">\n                            admin@metaextract.com\n                          </p>\n                          <p className=\"text-xs font-mono\">\n                            AdminPassword123!\n                          </p>\n                        </div>\n                      </div>\n                      <p className=\"text-xs text-slate-500\">\n                        If you dont have these users in your DB yet, run{' '}\n                        <span className=\"font-mono\">npm run seed:test-users</span>.\n                      </p>\n                    </div>\n\n                    <div className=\"flex gap-3\">\n                      <Button\n                        onClick={() => {\n                          // Trigger login modal - this will be handled by the Layout component\n                          const loginButton = document.querySelector(\n                            '[data-auth=\"login\"]'\n                          ) as HTMLButtonElement;\n                          if (loginButton) loginButton.click();\n                        }}\n                        className=\"bg-[#6366f1] hover:bg-[#5855eb] text-white\"\n                      >\n                        <LogIn className=\"w-4 h-4 mr-2\" />\n                        Sign In\n                      </Button>\n                      <Button\n                        onClick={() => {\n                          // Trigger register modal\n                          const registerButton = document.querySelector(\n                            '[data-auth=\"register\"]'\n                          ) as HTMLButtonElement;\n                          if (registerButton) registerButton.click();\n                        }}\n                        variant=\"outline\"\n                        className=\"border-white/20 text-slate-200 hover:text-white hover:bg-white/10\"\n                      >\n                        <UserPlus className=\"w-4 h-4 mr-2\" />\n                        Register\n                      </Button>\n                    </div>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n        </section>\n\n        {/* SECTION 2: COMPACT FEATURE GRID */}\n        <section className=\"relative py-20 z-10\">\n          <div className=\"container mx-auto px-4 max-w-7xl\">\n            <div className=\"flex items-end justify-between mb-8\">\n              <div>\n                <h2 className=\"text-2xl sm:text-3xl md:text-4xl font-black text-white mb-2 tracking-tighter\">\n                  CORE CAPABILITIES\n                </h2>\n                <p className=\"font-mono text-slate-200 text-sm\">{`SYSTEM_MODULES // V2.4`}</p>\n              </div>\n            </div>\n\n            {/* Tighter Grid Layout */}\n            <div className=\"grid grid-cols-1 md:grid-cols-12 gap-4 h-auto md:h-[500px]\">\n              {/* Feature 1: Deep Extract (Wide) */}\n              <motion.div\n                whileHover={{ scale: 0.99 }}\n                className=\"md:col-span-5 bg-[#121217] border border-white/5 p-8 relative group overflow-hidden flex flex-col justify-between\"\n              >\n                <div className=\"absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-100 transition-opacity duration-500\">\n                  <Database className=\"w-32 h-32 text-primary -rotate-12 translate-x-10 -translate-y-10\" />\n                </div>\n\n                  <div>\n                    <div className=\"flex items-center gap-2 mb-4 text-primary font-mono text-xs\">\n                      <ScanLine className=\"w-4 h-4\" />\n                      <span>DEEP_PACKET_INSPECTION</span>\n                    </div>\n                    <h3 className=\"text-2xl md:text-3xl font-bold text-white mb-4\">\n                      131,000+ Fields\n                    </h3>\n                    <p className=\"text-slate-200 leading-relaxed max-w-md\">\n                      7x more data than ExifTool. Our engine extracts deep bitstream\n                      forensics, C2PA provenance, AI-generation markers, and\n                      professional broadcast metadata for complete chain of custody.\n                    </p>\n                  </div>\n\n                  <div className=\"mt-8 flex flex-wrap gap-2\">\n                    {['C2PA', 'AI-DETECT', 'BITSTREAM', 'SMPTE/EBU'].map(\n                      (tag, i) => (\n                        <span\n                          key={i}\n                          className=\"px-2 py-1 bg-white/10 text-[10px] font-mono text-slate-200 border border-white/20 rounded\"\n                        >\n                          {tag}\n                        </span>\n                      )\n                    )}\n                  </div>\n              </motion.div>\n\n              {/* Center Column: Stacked */}\n              <div className=\"md:col-span-3 flex flex-col gap-4\">\n                {/* Zero Trace */}\n                <motion.div\n                  whileHover={{ scale: 0.99 }}\n                  className=\"flex-1 bg-primary text-black p-6 relative overflow-hidden group flex flex-col justify-center\"\n                >\n                  <ShieldAlert className=\"w-8 h-8 mb-4 opacity-80\" />\n                  <h3 className=\"text-xl font-bold mb-2\">No Data Retention</h3>\n                  <p className=\"text-black/80 text-sm font-medium leading-tight\">\n                    Files are processed in temporary RAM and permanently deleted\n                    immediately after analysis. We never store your evidence.\n                  </p>\n                </motion.div>\n\n                {/* Compliance */}\n                <motion.div\n                  whileHover={{ scale: 0.99 }}\n                  className=\"flex-1 border border-white/10 bg-black/50 backdrop-blur-md p-6 flex flex-col justify-center\"\n                >\n                  <div className=\"flex items-center gap-2 mb-2 text-slate-200 font-mono text-xs\">\n                    <Globe className=\"w-4 h-4\" />\n                    <span>GLOBAL_STANDARDS</span>\n                  </div>\n                  <p className=\"text-slate-200 text-sm leading-tight\">\n                    Full compliance with C2PA, Dublin Core, and GDPR\n                    Right-to-Erasure protocols.\n                  </p>\n                </motion.div>\n              </div>\n\n              {/* Feature 3: Raw Analysis (Tall Right) */}\n              <motion.div\n                whileHover={{ scale: 0.99 }}\n                className=\"md:col-span-4 bg-[#0f0f13] border border-white/10 p-8 flex flex-col relative overflow-hidden\"\n              >\n                <div className=\"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-10 mix-blend-overlay\"></div>\n\n                <div className=\"flex items-center gap-2 mb-4 text-emerald-500 font-mono text-xs\">\n                  <Terminal className=\"w-4 h-4\" />\n                  <span>BINARY_LEVEL_ACCESS</span>\n                </div>\n\n                <h3 className=\"text-xl md:text-2xl font-bold text-white mb-4\">\n                  Hex & Entropy Analysis\n                </h3>\n                <p className=\"text-slate-200 text-sm leading-relaxed mb-8\">\n                  Direct hex-level access allows you to inspect raw file\n                  headers. Entropy analysis helps detect if a file has been\n                  artificially manipulated or edited.\n                </p>\n\n                <div className=\"mt-auto space-y-3 font-mono text-xs\">\n                  <div className=\"flex justify-between items-center p-2 bg-white/5 border-l-2 border-emerald-500\">\n                    <span className=\"text-slate-300\">HEX_DUMP</span>\n                    <span className=\"text-emerald-500\">AVAILABLE</span>\n                  </div>\n                  <div className=\"flex justify-between items-center p-2 bg-white/5 border-l-2 border-emerald-500\">\n                    <span className=\"text-slate-300\">ENTROPY_MAP</span>\n                    <span className=\"text-emerald-500\">GENERATING...</span>\n                  </div>\n                  <div className=\"flex justify-between items-center p-2 bg-white/5 border-l-2 border-emerald-500\">\n                    <span className=\"text-slate-300\">GPS_RECON</span>\n                    <span className=\"text-emerald-500\">PRECISE</span>\n                  </div>\n                </div>\n\n                <Button\n                  variant=\"link\"\n                  className=\"text-primary p-0 h-auto justify-start mt-6 group hover:no-underline\"\n                >\n                  View Technical Specs{' '}\n                  <MoveRight className=\"w-4 h-4 ml-2 group-hover:translate-x-2 transition-transform\" />\n                </Button>\n              </motion.div>\n            </div>\n          </div>\n        </section>\n\n        {/* SECTION 3: PRICING */}\n        <section className=\"relative py-20 bg-white/5 border-y border-white/5 overflow-hidden\">\n          <div className=\"container mx-auto px-4 max-w-7xl\">\n            <div className=\"flex items-end justify-between mb-12\">\n              <div>\n                <h2 className=\"text-3xl sm:text-4xl md:text-6xl font-black text-white mb-2\">\n                  ACCESS\n                </h2>\n                <p className=\"font-mono text-primary text-sm\">{`// SELECT_TIER`}</p>\n              </div>\n              <div className=\"hidden md:block w-1/3 h-px bg-white/20\"></div>\n            </div>\n\n            {/* Pricing Cards with Hover Expansion */}\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n              {PRICING_TIERS.map((tier, i) => (\n                <motion.div\n                  key={i}\n                  whileHover={{ y: -5 }}\n                  className={`relative p-6 flex flex-col h-[400px] transition-all duration-300 group ${tier.recommended ? 'bg-primary text-black' : 'bg-black border border-white/10 hover:border-white/30'}`}\n                >\n                  <div className=\"flex justify-between items-start mb-8\">\n                    <h3\n                      className={`font-mono text-xl font-bold ${tier.recommended ? 'text-black' : 'text-white'}`}\n                    >\n                      {tier.name}\n                    </h3>\n                    {tier.recommended && (\n                      <Zap className=\"w-5 h-5 text-black animate-pulse\" />\n                    )}\n                  </div>\n\n                  <div className=\"mb-auto\">\n                    <div className=\"text-4xl font-bold mb-1 tracking-tighter\">\n                      {tier.price}\n                      <span className=\"text-sm font-normal opacity-60\">\n                        {tier.period}\n                      </span>\n                    </div>\n                    <p\n                      className={`text-xs ${tier.recommended ? 'text-black/80' : 'text-slate-300'} mb-6`}\n                    >\n                      {tier.description}\n                    </p>\n\n                    <ul className=\"space-y-3\">\n                      {tier.features.map((feat, j) => (\n                        <li\n                          key={j}\n                          className=\"flex items-center gap-2 text-xs font-mono\"\n                        >\n                          <div\n                            className={`w-1 h-1 ${tier.recommended ? 'bg-black' : 'bg-primary'}`}\n                          ></div>\n                          <span\n                            className={\n                              tier.recommended\n                                ? 'text-black/90'\n                                : 'text-slate-200'\n                            }\n                          >\n                            {feat}\n                          </span>\n                        </li>\n                      ))}\n                    </ul>\n                  </div>\n\n                  <Button\n                    onClick={() => handleCheckout(tier.tier)}\n                    disabled={checkoutLoading === tier.tier}\n                    data-testid={`button-checkout-${tier.tier}`}\n                    className={`w-full mt-6 rounded-sm font-bold tracking-wide border ${tier.recommended ? 'bg-black text-white hover:bg-black/80 border-black' : 'bg-transparent text-white hover:bg-white hover:text-black border-white/20'}`}\n                  >\n                    {checkoutLoading === tier.tier ? (\n                      <>\n                        <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />{' '}\n                        Processing...\n                      </>\n                    ) : (\n                      tier.cta\n                    )}\n                  </Button>\n                </motion.div>\n              ))}\n            </div>\n\n            {/* Adhoc Credits Strip */}\n            <div className=\"mt-20 border-t border-white/10 pt-10\">\n              <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-8\">\n                <div className=\"flex items-center gap-4\">\n                  <div className=\"bg-white/10 p-3 rounded\">\n                    <CreditCard className=\"w-6 h-6 text-white\" />\n                  </div>\n                  <div>\n                    <h4 className=\"text-white font-bold font-mono\">\n                      PAY-AS-YOU-GO CREDITS\n                    </h4>\n                    <p className=\"text-slate-300 text-xs max-w-sm mb-2\">\n                      No subscription required. Buy credits for one-off forensic\n                      extractions.\n                    </p>\n                    <p className=\"text-primary text-xs font-mono border-l-2 border-primary/30 pl-2\">\n                      1 Credit = 1 Standard File Extraction{' '}\n                      <span className=\"text-slate-500\">\n                        (Video = 3 Credits)\n                      </span>\n                    </p>\n                  </div>\n                </div>\n\n                <div className=\"flex gap-4 overflow-x-auto pb-4 md:pb-0\">\n                  {CREDIT_PACKS.map((pack, i) => {\n                    const packKey = pack.name.toLowerCase() as\n                      | 'single'\n                      | 'batch'\n                      | 'bulk';\n                    const isLoading = creditPackLoading === packKey;\n                    return (\n                      <button\n                        key={i}\n                        type=\"button\"\n                        onClick={() => handleCreditPurchase(pack.name)}\n                        disabled={isLoading}\n                        data-testid={`button-credits-${packKey}`}\n                        className=\"flex-shrink-0 bg-black border border-white/10 p-4 min-w-[160px] hover:border-primary/50 transition-colors cursor-pointer group text-left disabled:opacity-50\"\n                      >\n                        {isLoading ? (\n                          <div className=\"flex items-center justify-center h-full\">\n                            <Loader2 className=\"w-6 h-6 animate-spin text-primary\" />\n                          </div>\n                        ) : (\n                          <>\n                            <div className=\"text-xs text-slate-300 mb-1\">\n                              {pack.name}\n                            </div>\n                            <div className=\"text-xl font-bold text-white group-hover:text-primary\">\n                              {pack.price}\n                            </div>\n                            <div className=\"text-[10px] text-slate-500 font-mono mt-1\">\n                              {pack.credits} Credits\n                            </div>\n                            <div className=\"text-[10px] text-primary/80 font-mono mt-2 border-t border-white/10 pt-2\">\n                              {pack.per_credit}\n                            </div>\n                          </>\n                        )}\n                      </button>\n                    );\n                  })}\n                </div>\n              </div>\n            </div>\n          </div>\n        </section>\n      </div>\n    </Layout>\n  );\n}\n\nfunction CreditCard(props: React.SVGProps<SVGSVGElement>) {\n  return (\n    <svg\n      {...props}\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      stroke=\"currentColor\"\n      strokeWidth=\"2\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    >\n      <rect width=\"20\" height=\"14\" x=\"2\" y=\"5\" rx=\"2\" />\n      <line x1=\"2\" x2=\"22\" y1=\"10\" y2=\"10\" />\n    </svg>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/images-mvp/analytics.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/images-mvp/credits-success.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/images-mvp/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/images-mvp/results.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ProgressTracker' is defined but never used.","line":32,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'QualityIndicator' is defined but never used.","line":33,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sessionId' is assigned a value but never used.","line":154,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":154,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setSessionId' is assigned a value but never used.","line":154,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":154,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fieldCount' is assigned a value but never used.","line":240,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":240,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport {\n  MapPin,\n  Camera,\n  Calendar,\n  FileImage,\n  ShieldAlert,\n  Lock,\n  ArrowRight,\n  CheckCircle2,\n  Hash,\n  Fingerprint,\n  Search,\n  Info,\n  Clipboard,\n  Upload,\n  ChevronDown,\n  Download,\n  FileJson,\n  FileText,\n} from 'lucide-react';\nimport { useNavigate } from 'react-router-dom';\nimport { motion } from 'framer-motion';\n\nimport { PricingModal } from '@/components/images-mvp/pricing-modal';\nimport { ProgressTracker } from '@/components/images-mvp/progress-tracker';\nimport { QualityIndicator } from '@/components/images-mvp/quality-indicator';\nimport { PublicLayout as Layout } from '@/components/public-layout';\nimport {\n  Accordion,\n  AccordionContent,\n  AccordionItem,\n  AccordionTrigger,\n} from '@/components/ui/accordion';\nimport { Button } from '@/components/ui/button';\nimport {\n  Card,\n  CardContent,\n  CardHeader,\n  CardTitle,\n  CardDescription,\n} from '@/components/ui/card';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogTitle,\n} from '@/components/ui/dialog';\nimport { Input } from '@/components/ui/input';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { ToggleGroup, ToggleGroupItem } from '@/components/ui/toggle-group';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from '@/components/ui/tooltip';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { useToast } from '@/hooks/use-toast';\nimport { trackImagesMvpEvent } from '@/lib/images-mvp-analytics';\n\ninterface MvpMetadata {\n  filename: string;\n  filesize: string;\n  filetype: string;\n  mime_type: string;\n  gps: Record<string, unknown> | null;\n  exif: Record<string, unknown>;\n  filesystem?: { created?: string; modified?: string };\n  hashes?: Record<string, unknown>;\n  file_integrity?: Record<string, unknown>;\n  perceptual_hashes?: Record<string, unknown>;\n  burned_metadata?: {\n    has_burned_metadata: boolean;\n    extracted_text?: string | null;\n    confidence?: string;\n    parsed_data?: {\n      gps?: { latitude: number; longitude: number; google_maps_url?: string };\n      timestamp?: string;\n      plus_code?: string;\n      address?: string;\n    };\n  } | null;\n  metadata_comparison?: {\n    warnings?: string[];\n    summary?: {\n      overall_status?: string;\n      gps_comparison?: string;\n      timestamp_comparison?: string;\n    };\n  } | null;\n  normalized?: Record<string, unknown> | null;\n  calculated?: Record<string, unknown> | null;\n  processing_ms?: number;\n  fields_extracted?: number;\n  quality_metrics?: {\n    confidence_score?: number;\n    extraction_completeness?: number;\n    format_support_level?: string;\n  };\n  processing_insights?: {\n    total_fields_extracted?: number;\n    processing_time_ms?: number;\n  };\n  access: {\n    trial_granted: boolean;\n    trial_email_present: boolean;\n    credits_charged?: number;\n    credits_required?: number;\n    mode?: 'device_free' | 'trial_limited' | 'paid';\n    free_used?: number;\n  };\n  _trial_limited?: boolean;\n  client_last_modified_iso?: string;\n  registry_summary?: Record<string, unknown>;\n  locked_fields?: string[];\n  [key: string]: unknown;\n}\n\ntype TabValue = 'privacy' | 'authenticity' | 'photography' | 'raw';\ntype PurposeValue = 'privacy' | 'authenticity' | 'photography' | 'explore';\ntype DensityMode = 'normal' | 'advanced';\ntype ResultsViewState = 'idle' | 'processing' | 'success' | 'empty' | 'fail';\n\nconst PURPOSE_STORAGE_KEY = 'images_mvp_purpose';\nconst DENSITY_STORAGE_KEY = 'images_mvp_density';\n\nexport default function ImagesMvpResults() {\n  const [metadata, setMetadata] = useState<MvpMetadata | null>(null);\n  const [viewState, setViewState] = useState<ResultsViewState>('processing');\n  const [errorInfo, setErrorInfo] = useState<{\n    status?: number;\n    message?: string;\n  } | null>(null);\n  const [activeTab, setActiveTab] = useState<TabValue>('privacy');\n  const [rawSearch, setRawSearch] = useState('');\n  const [showOverlayText, setShowOverlayText] = useState(false);\n  const [showAllExif, setShowAllExif] = useState(false);\n  const [showEmptyRaw, setShowEmptyRaw] = useState(false);\n  const [purpose, setPurpose] = useState<PurposeValue | null>(null);\n  const [showPurposeModal, setShowPurposeModal] = useState(false);\n  const [densityMode, setDensityMode] = useState<DensityMode>('normal');\n  const [showPricingModal, setShowPricingModal] = useState(false);\n  const [sessionId, setSessionId] = useState<string>('');\n  const ocrSelected =\n    typeof window !== 'undefined' &&\n    sessionStorage.getItem('images_mvp_ocr') === 'true';\n  const navigate = useNavigate();\n  const { toast } = useToast();\n  const purposePromptLogged = useRef(false);\n  const formatHintLogged = useRef(false);\n  const paywallLogged = useRef(false);\n  const resultsLogged = useRef(false);\n\n  // Calculate limited report status (must be declared before any useEffect)\n  // Report is limited only when in 'trial_limited' mode  device_free is not considered limited\n  const isLimitedReport = metadata?.access?.mode === 'trial_limited';\n  const canExport = metadata?.access?.mode !== 'trial_limited';\n\n  const hasValue = (value: unknown): boolean => {\n    if (value === null || value === undefined) return false;\n    if (typeof value === 'boolean') return value;\n    if (typeof value === 'number') return Number.isFinite(value);\n    if (typeof value === 'string') {\n      const trimmed = value.trim();\n      return (\n        trimmed.length > 0 &&\n        trimmed.toLowerCase() !== 'n/a' &&\n        trimmed.toLowerCase() !== 'unknown'\n      );\n    }\n    if (Array.isArray(value)) return value.length > 0;\n    if (typeof value === 'object') return Object.keys(value).length > 0;\n    return true;\n  };\n\n  useEffect(() => {\n    const stored = sessionStorage.getItem('currentMetadata');\n    const status = sessionStorage.getItem('images_mvp_status');\n    const errorRaw = sessionStorage.getItem('images_mvp_error');\n\n    if (status === 'fail') {\n      setViewState('fail');\n      if (errorRaw) {\n        try {\n          setErrorInfo(JSON.parse(errorRaw));\n        } catch {\n          setErrorInfo({ message: 'Extraction failed' });\n        }\n      } else {\n        setErrorInfo({ message: 'Extraction failed' });\n      }\n      return;\n    }\n\n    if (!stored) {\n      if (status === 'uploading' || status === 'processing') {\n        setViewState('processing');\n      } else {\n        setViewState('idle');\n      }\n      return;\n    }\n\n    try {\n      const parsed = JSON.parse(stored) as MvpMetadata;\n      setMetadata(parsed);\n      const countMeaningfulFields = (obj: unknown): number => {\n        if (obj === null || obj === undefined) return 0;\n        if (typeof obj !== 'object') return hasValue(obj) ? 1 : 0;\n        if (Array.isArray(obj)) return hasValue(obj) ? 1 : 0;\n        const record = obj as Record<string, unknown>;\n        let count = 0;\n        for (const key of Object.keys(record)) {\n          if (key.startsWith('_') || key === 'access') continue;\n          const value = record[key];\n          if (\n            value !== null &&\n            typeof value === 'object' &&\n            !Array.isArray(value)\n          ) {\n            count += countMeaningfulFields(value);\n          } else if (hasValue(value)) {\n            count += 1;\n          }\n        }\n        return count;\n      };\n      const meaningfulCount = countMeaningfulFields(parsed);\n      const fieldCount =\n        typeof parsed.fields_extracted === 'number'\n          ? parsed.fields_extracted\n          : typeof parsed.processing_insights?.total_fields_extracted ===\n              'number'\n            ? parsed.processing_insights.total_fields_extracted\n            : 0;\n      setViewState(meaningfulCount > 0 ? 'success' : 'empty');\n    } catch {\n      setViewState('fail');\n      setErrorInfo({ message: 'Failed to load results' });\n    }\n  }, []);\n\n  const isTabValue = (value: string): value is TabValue =>\n    value === 'privacy' ||\n    value === 'authenticity' ||\n    value === 'photography' ||\n    value === 'raw';\n\n  const isPurposeValue = (value: string): value is PurposeValue =>\n    value === 'privacy' ||\n    value === 'authenticity' ||\n    value === 'photography' ||\n    value === 'explore';\n\n  const mapPurposeToTab = (value: PurposeValue): TabValue => {\n    if (value === 'authenticity') return 'authenticity';\n    if (value === 'photography') return 'photography';\n    return 'privacy';\n  };\n\n  const getFormatHint = (mimeType: string, filename: string) => {\n    const normalizedMime = (mimeType || '').toLowerCase();\n    const filenameLower = (filename || '').toLowerCase();\n    if (normalizedMime.includes('heic') || normalizedMime.includes('heif')) {\n      return {\n        title: 'HEIC photo detected',\n        body: 'HEIC photos (common on iPhones) usually include rich metadata such as capture settings and device details.',\n        tone: 'emerald',\n      };\n    }\n    if (normalizedMime.includes('webp')) {\n      return {\n        title: 'WebP image detected',\n        body: 'WebP metadata support varies by source. Some uploads may only include basic file details.',\n        tone: 'amber',\n      };\n    }\n    if (normalizedMime.includes('png')) {\n      const screenshotHint =\n        filenameLower.includes('screenshot') ||\n        filenameLower.includes('screen shot');\n      return {\n        title: screenshotHint ? 'Screenshot detected' : 'PNG image detected',\n        body: screenshotHint\n          ? 'Screenshots often contain minimal metadata. For richer data, try the original photo.'\n          : 'PNG files (especially graphics) often contain minimal metadata compared to camera photos.',\n        tone: 'amber',\n      };\n    }\n    if (normalizedMime.includes('jpeg') || normalizedMime.includes('jpg')) {\n      return {\n        title: 'JPEG photo detected',\n        body: 'JPEG photos usually include camera metadata such as device, timestamps, and settings.',\n        tone: 'emerald',\n      };\n    }\n    return null;\n  };\n\n  const trackEvent = useCallback(\n    (event: string, properties: Record<string, unknown> = {}) => {\n      trackImagesMvpEvent(event, properties);\n    },\n    []\n  );\n\n  useEffect(() => {\n    if (!metadata) return;\n    const storedPurpose = localStorage.getItem(PURPOSE_STORAGE_KEY);\n    const storedDensity = localStorage.getItem(DENSITY_STORAGE_KEY);\n    if (storedDensity === 'advanced' || storedDensity === 'normal') {\n      setDensityMode(storedDensity);\n    }\n    if (storedPurpose && isPurposeValue(storedPurpose)) {\n      setPurpose(storedPurpose);\n      setActiveTab(mapPurposeToTab(storedPurpose));\n    } else {\n      setShowPurposeModal(true);\n    }\n  }, [metadata]);\n\n  useEffect(() => {\n    if (densityMode === 'normal' && activeTab === 'raw') {\n      setActiveTab('privacy');\n    }\n  }, [densityMode, activeTab]);\n\n  useEffect(() => {\n    if (!showPurposeModal || purposePromptLogged.current) return;\n    trackEvent('purpose_prompt_shown', { location: 'results' });\n    purposePromptLogged.current = true;\n  }, [showPurposeModal, trackEvent]);\n\n  useEffect(() => {\n    if (!metadata) return;\n    trackEvent('tab_changed', {\n      tab: activeTab,\n      density: densityMode,\n      purpose: purpose || 'unset',\n    });\n  }, [activeTab, densityMode, metadata, purpose, trackEvent]);\n\n  useEffect(() => {\n    if (!metadata || formatHintLogged.current) return;\n    const hint = getFormatHint(metadata.mime_type, metadata.filename);\n    if (!hint) return;\n    trackEvent('format_hint_shown', {\n      mime_type: metadata.mime_type,\n      hint: hint.title,\n    });\n    formatHintLogged.current = true;\n  }, [metadata, trackEvent]);\n\n  useEffect(() => {\n    if (!metadata || resultsLogged.current) return;\n    trackEvent('results_viewed', {\n      filetype: metadata.filetype,\n      mime_type: metadata.mime_type,\n    });\n    resultsLogged.current = true;\n  }, [metadata, trackEvent]);\n\n  useEffect(() => {\n    if (!metadata || paywallLogged.current) return;\n    const trialLimited = isLimitedReport;\n    const summary = metadata.registry_summary?.image as\n      | { exif?: number; iptc?: number; xmp?: number }\n      | undefined;\n    const lockedTotal =\n      (summary?.exif ?? 0) + (summary?.iptc ?? 0) + (summary?.xmp ?? 0);\n    if (trialLimited && lockedTotal > 0) {\n      trackEvent('paywall_preview_shown', {\n        locked_total: lockedTotal,\n      });\n      paywallLogged.current = true;\n    }\n  }, [metadata, trackEvent]);\n\n  useEffect(() => {\n    if (metadata?.filename) {\n      document.title = `Results: ${metadata.filename} | MetaExtract`;\n    } else {\n      document.title = 'MetaExtract | Analysis Results';\n    }\n  }, [metadata?.filename]);\n\n  type DetailEntry = { path: string; valuePreview: string; value: unknown };\n\n  const previewValue = (value: unknown): string => {\n    if (value === null || value === undefined) return '';\n    if (typeof value === 'string')\n      return value.length > 180 ? `${value.slice(0, 180)}` : value;\n    if (typeof value === 'number' || typeof value === 'boolean')\n      return String(value);\n\n    try {\n      const text = JSON.stringify(value);\n      return text.length > 180 ? `${text.slice(0, 180)}` : text;\n    } catch {\n      return String(value);\n    }\n  };\n\n  const collectDetailEntries = (\n    obj: unknown,\n    prefix = '',\n    depth = 0,\n    maxDepth = 4,\n    out: DetailEntry[] = [],\n    maxEntries = 200\n  ): DetailEntry[] => {\n    if (out.length >= maxEntries) return out;\n    if (depth > maxDepth) return out;\n    if (obj === null || obj === undefined) return out;\n    if (typeof obj !== 'object') {\n      if (!hasValue(obj)) return out;\n      out.push({\n        path: prefix || '(root)',\n        valuePreview: previewValue(obj),\n        value: obj,\n      });\n      return out;\n    }\n    if (Array.isArray(obj)) {\n      if (!hasValue(obj)) return out;\n      out.push({\n        path: prefix || '(root)',\n        valuePreview: previewValue(obj),\n        value: obj,\n      });\n      return out;\n    }\n    const record = obj as Record<string, unknown>;\n    for (const key of Object.keys(record)) {\n      if (key.startsWith('_')) continue;\n      if (key === 'access') continue;\n      if (key === 'extracted_text') continue;\n      const next = prefix ? `${prefix}.${key}` : key;\n      const value = record[key];\n      if (\n        value !== null &&\n        typeof value === 'object' &&\n        !Array.isArray(value)\n      ) {\n        collectDetailEntries(value, next, depth + 1, maxDepth, out, maxEntries);\n      } else {\n        if (!hasValue(value)) continue;\n        out.push({\n          path: next,\n          valuePreview: previewValue(value),\n          value,\n        });\n      }\n      if (out.length >= maxEntries) break;\n    }\n    return out;\n  };\n\n  const fieldsFound = useMemo(() => {\n    if (!metadata) return 0;\n    return collectDetailEntries(metadata, '', 0, 4, [], 1000).length;\n  }, [metadata]);\n\n  if (viewState === 'processing') {\n    return (\n      <Layout showHeader={true} showFooter={true}>\n        <div className=\"min-h-screen bg-[#0B0C10] text-white pt-20 pb-20\">\n          <div className=\"container mx-auto px-4 max-w-3xl\">\n            <Card className=\"bg-[#11121a] border-white/10\">\n              <CardContent className=\"p-8 text-center text-slate-200\">\n                Processing your image...\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </Layout>\n    );\n  }\n\n  if (viewState === 'idle') {\n    return (\n      <Layout showHeader={true} showFooter={true}>\n        <div className=\"min-h-screen bg-[#0B0C10] text-white pt-20 pb-20\">\n          <div className=\"container mx-auto px-4 max-w-3xl\">\n            <Card className=\"bg-[#11121a] border-white/10\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <FileImage className=\"w-5 h-5 text-primary\" />\n                  Ready when you are\n                </CardTitle>\n                <CardDescription className=\"text-slate-200\">\n                  Upload an image to extract metadata and view the analysis\n                  here.\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"flex flex-col gap-3\">\n                <Button\n                  className=\"w-full bg-[#6366f1] hover:bg-[#5855eb] text-white\"\n                  onClick={() => navigate('/images_mvp')}\n                >\n                  <Upload className=\"w-4 h-4 mr-2\" />\n                  Upload an image\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  className=\"w-full border-white/20 text-slate-200 hover:text-white hover:bg-white/10\"\n                  onClick={() => navigate('/images_mvp?pricing=1')}\n                >\n                  Learn about credits\n                </Button>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </Layout>\n    );\n  }\n\n  if (viewState === 'fail') {\n    return (\n      <Layout showHeader={true} showFooter={true}>\n        <div className=\"min-h-screen bg-[#0B0C10] text-white pt-20 pb-20\">\n          <div className=\"container mx-auto px-4 max-w-3xl\">\n            <Card className=\"bg-[#11121a] border-white/10\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <ShieldAlert className=\"w-5 h-5 text-amber-400\" />\n                  Extraction failed\n                </CardTitle>\n                <CardDescription className=\"text-slate-200\">\n                  {errorInfo?.message || 'We could not process this file.'}\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"flex flex-col gap-3\">\n                {errorInfo?.status && (\n                  <p className=\"text-xs text-slate-400\">\n                    Error code: {errorInfo.status}\n                  </p>\n                )}\n                <Button\n                  className=\"w-full bg-[#6366f1] hover:bg-[#5855eb] text-white\"\n                  onClick={() => navigate('/images_mvp')}\n                >\n                  <Upload className=\"w-4 h-4 mr-2\" />\n                  Try another image\n                </Button>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </Layout>\n    );\n  }\n\n  if (viewState === 'empty' || !metadata) {\n    return (\n      <Layout showHeader={true} showFooter={true}>\n        <div className=\"min-h-screen bg-[#0B0C10] text-white pt-20 pb-20\">\n          <div className=\"container mx-auto px-4 max-w-3xl\">\n            <Card className=\"bg-[#11121a] border-white/10\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Info className=\"w-5 h-5 text-primary\" />\n                  No metadata found\n                </CardTitle>\n                <CardDescription className=\"text-slate-200\">\n                  We didnt detect metadata in this file. Try another image or a\n                  different format.\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"flex flex-col gap-3\">\n                <Button\n                  className=\"w-full bg-[#6366f1] hover:bg-[#5855eb] text-white\"\n                  onClick={() => navigate('/images_mvp')}\n                >\n                  <Upload className=\"w-4 h-4 mr-2\" />\n                  Upload another image\n                </Button>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </Layout>\n    );\n  }\n  const creditsRequired = metadata.access?.credits_required ?? 0;\n  const creditsCharged = metadata.access?.credits_charged ?? 0;\n\n  const handleDownloadJson = () => {\n    if (!canExport) {\n      return;\n    }\n    trackEvent('export_json_downloaded', {\n      filetype: metadata.filetype,\n      mime_type: metadata.mime_type,\n      purpose: purpose || 'unset',\n    });\n    const payload = JSON.stringify(metadata, null, 2);\n    const blob = new Blob([payload], { type: 'application/json' });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    const baseName = metadata.filename?.replace(/\\.[^/.]+$/, '') || 'metadata';\n    link.href = url;\n    link.download = `${baseName}.json`;\n    link.click();\n    URL.revokeObjectURL(url);\n  };\n\n  const handleDownloadFullTxt = () => {\n    if (!canExport) {\n      return;\n    }\n    trackEvent('export_full_txt_downloaded', {\n      filetype: metadata.filetype,\n      mime_type: metadata.mime_type,\n      purpose: purpose || 'unset',\n    });\n    const payload = JSON.stringify(metadata, null, 2);\n    const blob = new Blob([payload], { type: 'text/plain' });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    const baseName = metadata.filename?.replace(/\\.[^/.]+$/, '') || 'metadata';\n    link.href = url;\n    link.download = `${baseName}-full.txt`;\n    link.click();\n    URL.revokeObjectURL(url);\n  };\n\n  const handleDownloadSummary = () => {\n    const payload = buildSummaryLines();\n    const blob = new Blob([payload], { type: 'text/plain' });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    const baseName = metadata.filename?.replace(/\\.[^/.]+$/, '') || 'metadata';\n    link.href = url;\n    link.download = `${baseName}-summary.txt`;\n    link.click();\n    URL.revokeObjectURL(url);\n    trackEvent('export_summary_downloaded', {\n      filetype: metadata.filetype,\n      mime_type: metadata.mime_type,\n      purpose: purpose || 'unset',\n    });\n  };\n\n  // Format Date Helper\n  const formatDate = (\n    dateStr?: string,\n    emptyMessage = 'Not present in this file'\n  ) => {\n    if (!dateStr) return emptyMessage;\n    try {\n      return new Date(dateStr).toLocaleString();\n    } catch {\n      return dateStr;\n    }\n  };\n\n  const getGpsCoords = (gps: Record<string, unknown> | null | undefined) => {\n    if (!gps || typeof gps !== 'object') return null;\n    const record = gps as Record<string, unknown>;\n    const latRaw =\n      record.latitude ??\n      record.lat ??\n      record.GPSLatitude ??\n      record.gps_latitude ??\n      record.Latitude;\n    const lonRaw =\n      record.longitude ??\n      record.lon ??\n      record.lng ??\n      record.GPSLongitude ??\n      record.gps_longitude ??\n      record.Longitude;\n    const lat =\n      typeof latRaw === 'number' ? latRaw : parseFloat(String(latRaw));\n    const lon =\n      typeof lonRaw === 'number' ? lonRaw : parseFloat(String(lonRaw));\n    if (!Number.isFinite(lat) || !Number.isFinite(lon)) return null;\n    return { latitude: lat, longitude: lon };\n  };\n\n  const parseOverlayGps = (burned?: MvpMetadata['burned_metadata']) => {\n    const raw = burned?.parsed_data?.gps;\n    if (!raw) return null;\n    const lat =\n      typeof raw.latitude === 'number'\n        ? raw.latitude\n        : parseFloat(String(raw.latitude));\n    const lon =\n      typeof raw.longitude === 'number'\n        ? raw.longitude\n        : parseFloat(String(raw.longitude));\n    if (!Number.isFinite(lat) || !Number.isFinite(lon)) return null;\n    return {\n      latitude: lat,\n      longitude: lon,\n      google_maps_url: raw.google_maps_url,\n    };\n  };\n\n  const gpsCoords = getGpsCoords(metadata.gps);\n  const overlayGps = parseOverlayGps(metadata.burned_metadata);\n  const hasGps = !!gpsCoords;\n  const gpsMapUrl = gpsCoords\n    ? ((metadata.gps as Record<string, unknown> | null)?.google_maps_url as\n        | string\n        | undefined) ||\n      `https://maps.google.com/?q=${gpsCoords.latitude},${gpsCoords.longitude}`\n    : overlayGps\n      ? overlayGps.google_maps_url ||\n        `https://maps.google.com/?q=${overlayGps.latitude},${overlayGps.longitude}`\n      : '';\n  const parseWhatsappFilenameDate = (name?: string) => {\n    if (!name) return null;\n    const match = name.match(\n      /WhatsApp Image (\\d{4})-(\\d{2})-(\\d{2}) at (\\d{2})\\.(\\d{2})\\.(\\d{2})/i\n    );\n    if (!match) return null;\n    const [, year, month, day, hour, minute, second] = match;\n    return new Date(`${year}-${month}-${day}T${hour}:${minute}:${second}`);\n  };\n  const parseExifDate = (value?: string | null) => {\n    if (!value) return null;\n    // Handle EXIF format: YYYY:MM:DD HH:MM:SS\n    const match = value.match(\n      /(\\\\d{4}):(\\\\d{2}):(\\\\d{2})[ T](\\\\d{2}):(\\\\d{2}):(\\\\d{2})/\n    );\n    if (match) {\n      const [, y, m, d, hh, mm, ss] = match;\n      return new Date(`${y}-${m}-${d}T${hh}:${mm}:${ss}`);\n    }\n    const dt = new Date(value);\n    return Number.isNaN(dt.getTime()) ? null : dt;\n  };\n  const filenameDate = parseWhatsappFilenameDate(metadata.filename);\n  const captureDateFromExif = parseExifDate(\n    (metadata.exif?.DateTimeOriginal as string | null | undefined) ||\n      (metadata.exif?.CreateDate as string | null | undefined)\n  );\n  const captureDateFromCalculated = parseExifDate(\n    (metadata.calculated?.capture_date as string | null | undefined) || null\n  );\n  const hasCalculatedCapture = !!captureDateFromCalculated;\n  const captureDateLabel = captureDateFromExif\n    ? 'CAPTURE DATE (EXIF)'\n    : filenameDate\n      ? 'CAPTURE DATE (FILENAME)'\n      : hasCalculatedCapture && !isLimitedReport\n        ? 'CAPTURE DATE (INFERRED)'\n        : 'CAPTURE DATE';\n  const captureDateValue = captureDateFromExif\n    ? captureDateFromExif.toISOString()\n    : filenameDate\n      ? filenameDate.toISOString()\n      : hasCalculatedCapture && !isLimitedReport\n        ? captureDateFromCalculated?.toISOString() || null\n        : null;\n  const filesystemTimestamp =\n    metadata.filesystem?.created || metadata.filesystem?.modified || null;\n  const localModifiedValue = metadata.client_last_modified_iso || null;\n\n  const embeddedGpsState = hasGps\n    ? 'embedded'\n    : overlayGps\n      ? 'overlay'\n      : 'none';\n  const burnedTimestamp =\n    metadata.burned_metadata?.parsed_data?.timestamp || null;\n  const filenameSuggestsMap = /gps|map|location|coords|coordinate|geotag/i.test(\n    metadata.filename || ''\n  );\n  const hashSha256 =\n    metadata.hashes?.sha256 || metadata.file_integrity?.sha256 || null;\n  const hashMd5 = metadata.hashes?.md5 || metadata.file_integrity?.md5 || null;\n  const fieldsExtracted = metadata.fields_extracted ?? null;\n  const processingMs = metadata.processing_ms ?? null;\n  const software = (metadata.exif?.Software as string | undefined) || null;\n  const extractionInfo = metadata.extraction_info as\n    | {\n        dynamic_modules_enabled?: boolean;\n        specialized_engines?: Record<string, boolean>;\n      }\n    | undefined;\n  const enabledEnginesCount = extractionInfo?.specialized_engines\n    ? Object.values(extractionInfo.specialized_engines).filter(Boolean).length\n    : null;\n  const formatHint = getFormatHint(metadata.mime_type, metadata.filename);\n  const formatToneClass =\n    formatHint?.tone === 'emerald'\n      ? 'border-emerald-500/20 bg-emerald-500/5 text-emerald-100'\n      : 'border-amber-500/20 bg-amber-500/5 text-amber-100';\n\n  const scrollTo = (tab: typeof activeTab, anchorId: string) => {\n    setActiveTab(tab);\n    window.setTimeout(() => {\n      const el = document.getElementById(anchorId);\n      if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });\n    }, 50);\n  };\n\n  const highlightIcon = (\n    intent: 'Privacy' | 'Authenticity' | 'Photography'\n  ) => {\n    if (intent === 'Privacy') return <MapPin className=\"w-4 h-4\" />;\n    if (intent === 'Authenticity') return <Fingerprint className=\"w-4 h-4\" />;\n    return <Camera className=\"w-4 h-4\" />;\n  };\n\n  const highlightAccent = (\n    intent: 'Privacy' | 'Authenticity' | 'Photography'\n  ) => {\n    if (intent === 'Privacy')\n      return 'border-emerald-500/20 bg-emerald-500/5 text-emerald-200';\n    if (intent === 'Authenticity')\n      return 'border-purple-500/20 bg-purple-500/5 text-purple-200';\n    return 'border-blue-500/20 bg-blue-500/5 text-blue-200';\n  };\n\n  const highlights: Array<{\n    text: string;\n    intent: 'Privacy' | 'Authenticity' | 'Photography';\n    impact: 'Privacy' | 'Authenticity' | 'Workflow' | 'None';\n    confidence: 'High' | 'Medium' | 'Low';\n    icon: React.ReactNode;\n    accentClass: string;\n    target?: { tab: typeof activeTab; anchorId: string };\n  }> = [];\n  if (captureDateValue) {\n    highlights.push({\n      text: `Capture time found (${captureDateLabel === 'CAPTURE DATE (FILENAME)' ? 'from filename' : 'from EXIF'}).`,\n      intent: 'Photography',\n      impact: 'Workflow',\n      confidence: captureDateLabel === 'CAPTURE DATE (FILENAME)' ? 'Medium' : 'High',\n      icon: highlightIcon('Photography'),\n      accentClass: highlightAccent('Photography'),\n      target: { tab: 'privacy', anchorId: 'section-timestamps' },\n    });\n  } else if (isLimitedReport && hasCalculatedCapture) {\n    highlights.push({\n      text: 'Capture time is available in the full report.',\n      intent: 'Photography',\n      impact: 'Workflow',\n      confidence: 'Medium',\n      icon: highlightIcon('Photography'),\n      accentClass: highlightAccent('Photography'),\n      target: { tab: 'privacy', anchorId: 'section-timestamps' },\n    });\n  } else if (filesystemTimestamp) {\n    highlights.push({\n      text: 'Capture time not in metadata; file timestamps are available (upload time).',\n      intent: 'Photography',\n      impact: 'Workflow',\n      confidence: 'Low',\n      icon: highlightIcon('Photography'),\n      accentClass: highlightAccent('Photography'),\n      target: { tab: 'privacy', anchorId: 'section-timestamps' },\n    });\n  } else {\n    highlights.push({\n      text: 'Capture time not present in metadata (common after sharing apps).',\n      intent: 'Photography',\n      impact: 'Workflow',\n      confidence: 'Medium',\n      icon: highlightIcon('Photography'),\n      accentClass: highlightAccent('Photography'),\n      target: { tab: 'privacy', anchorId: 'section-timestamps' },\n    });\n  }\n  if (embeddedGpsState === 'embedded') {\n    highlights.push({\n      text: 'Location is embedded in EXIF.',\n      intent: 'Privacy',\n      impact: 'Privacy',\n      confidence: 'High',\n      icon: highlightIcon('Privacy'),\n      accentClass: highlightAccent('Privacy'),\n      target: { tab: 'privacy', anchorId: 'section-location' },\n    });\n  } else if (embeddedGpsState === 'overlay') {\n    highlights.push({\n      text: 'Location not embedded in EXIF, but found in overlay text (pixels).',\n      intent: 'Privacy',\n      impact: 'Privacy',\n      confidence: 'Medium',\n      icon: highlightIcon('Privacy'),\n      accentClass: highlightAccent('Privacy'),\n      target: { tab: 'privacy', anchorId: 'section-location' },\n    });\n  } else {\n    const locationCopy = !ocrSelected\n      ? 'No GPS in metadata. Text scan was off, so stamped locations were not checked.'\n      : isLimitedReport\n        ? 'No GPS in metadata. Text scan results are limited in this free report.'\n        : 'No GPS in metadata or overlay text.';\n    highlights.push({\n      text: locationCopy,\n      intent: 'Privacy',\n      impact: 'Privacy',\n      confidence: ocrSelected && !isLimitedReport ? 'Medium' : 'High',\n      icon: highlightIcon('Privacy'),\n      accentClass: highlightAccent('Privacy'),\n      target: { tab: 'privacy', anchorId: 'section-location' },\n    });\n  }\n  if (hasValue(metadata.exif?.Make) || hasValue(metadata.exif?.Model)) {\n    highlights.push({\n      text: `Device detected: ${[metadata.exif?.Make, metadata.exif?.Model].filter(Boolean).join(' ')}`,\n      intent: 'Photography',\n      impact: 'Privacy',\n      confidence: 'High',\n      icon: highlightIcon('Photography'),\n      accentClass: highlightAccent('Photography'),\n      target: { tab: 'privacy', anchorId: 'section-device' },\n    });\n  }\n  if (hasValue(software)) {\n    highlights.push({\n      text: `Software tag present: ${software}`,\n      intent: 'Authenticity',\n      impact: 'Authenticity',\n      confidence: 'High',\n      icon: highlightIcon('Authenticity'),\n      accentClass: highlightAccent('Authenticity'),\n      target: { tab: 'authenticity', anchorId: 'section-auth-signals' },\n    });\n  } else {\n    highlights.push({\n      text: 'No editing software tag present (inconclusive).',\n      intent: 'Authenticity',\n      impact: 'Authenticity',\n      confidence: 'Low',\n      icon: highlightIcon('Authenticity'),\n      accentClass: highlightAccent('Authenticity'),\n      target: { tab: 'authenticity', anchorId: 'section-auth-signals' },\n    });\n  }\n  if (hasValue(hashSha256)) {\n    highlights.push({\n      text: 'SHA-256 hash computed for integrity.',\n      intent: 'Authenticity',\n      impact: 'Authenticity',\n      confidence: 'High',\n      icon: highlightIcon('Authenticity'),\n      accentClass: highlightAccent('Authenticity'),\n      target: { tab: 'privacy', anchorId: 'section-integrity' },\n    });\n  }\n\n  // Compute preferred intent (moved outside of useMemo to fix hook order issues)\n  const preferredIntent =\n    purpose === 'authenticity'\n      ? 'Authenticity'\n      : purpose === 'photography'\n        ? 'Photography'\n        : 'Privacy';\n\n  // Order highlights by preferred intent (moved outside of useMemo to fix hook order issues)\n  const orderedHighlights = (() => {\n    // Create a copy of highlights to avoid mutating the original array\n    const highlightsCopy = [...highlights];\n\n    // Sort by preferred intent\n    highlightsCopy.sort((a, b) => {\n      const aScore = a.intent === preferredIntent ? 1 : 0;\n      const bScore = b.intent === preferredIntent ? 1 : 0;\n      return bScore - aScore;\n    });\n\n    return highlightsCopy;\n  })();\n\n  const buildSummaryLines = () => {\n    const intentLabel = purpose\n      ? `${purpose.charAt(0).toUpperCase()}${purpose.slice(1)}`\n      : 'Unspecified';\n    const lines = [\n      `File: ${metadata.filename}`,\n      `Type: ${metadata.filetype} (${metadata.mime_type})`,\n      `Size: ${metadata.filesize}`,\n      `Intent: ${intentLabel}`,\n      '',\n      'Highlights:',\n    ];\n    orderedHighlights.slice(0, 6).forEach(h => {\n      lines.push(\n        `- ${h.text} (Impact: ${h.impact}, Confidence: ${h.confidence})`\n      );\n    });\n    lines.push('');\n    lines.push(\n      'Limitations: Metadata can be missing or stripped. Absence is not proof.'\n    );\n    return lines.join('\\n');\n  };\n\n  const handleCopySummary = async () => {\n    try {\n      await navigator.clipboard?.writeText(buildSummaryLines());\n      toast({\n        title: 'Summary copied',\n        description: 'Highlights copied to your clipboard.',\n      });\n      trackEvent('summary_copied', {\n        filetype: metadata.filetype,\n        mime_type: metadata.mime_type,\n        purpose: purpose || 'unset',\n      });\n    } catch {\n      toast({\n        title: 'Unable to copy',\n        description: 'Clipboard access was blocked by your browser.',\n        variant: 'destructive',\n      });\n    }\n  };\n\n  const handlePurposeSelect = (value: PurposeValue) => {\n    setPurpose(value);\n    localStorage.setItem(PURPOSE_STORAGE_KEY, value);\n    trackEvent('purpose_selected', {\n      purpose: value,\n    });\n    if (value === 'explore') {\n      setDensityMode('advanced');\n      localStorage.setItem(DENSITY_STORAGE_KEY, 'advanced');\n      trackEvent('density_changed', {\n        mode: 'advanced',\n        source: 'purpose_select',\n      });\n    }\n    setActiveTab(mapPurposeToTab(value));\n    setShowPurposeModal(false);\n  };\n\n  const handleDensityChange = (value: string | null) => {\n    if (value !== 'normal' && value !== 'advanced') return;\n    setDensityMode(value);\n    localStorage.setItem(DENSITY_STORAGE_KEY, value);\n    trackEvent('density_changed', { mode: value });\n  };\n\n  const isAdvanced = densityMode === 'advanced';\n  const purposeLabel = purpose\n    ? `${purpose.charAt(0).toUpperCase()}${purpose.slice(1)}`\n    : 'Not set';\n  const trialEmail =\n    typeof window !== 'undefined'\n      ? localStorage.getItem('metaextract_trial_email')\n      : null;\n\n  const exifEntries = Object.entries(metadata.exif || {}).filter(([, v]) =>\n    hasValue(v)\n  );\n  const exifEntriesForList =\n    showAllExif || canExport ? exifEntries : exifEntries.slice(0, 14);\n\n  const registrySummary = metadata.registry_summary?.image as\n    | {\n        exif?: number;\n        iptc?: number;\n        xmp?: number;\n        mobile?: number;\n        perceptual_hashes?: number;\n      }\n    | undefined;\n  const lockedGroups = [\n    {\n      key: 'exif',\n      label: 'Full EXIF fields',\n      count: registrySummary?.exif ?? 0,\n    },\n    {\n      key: 'iptc',\n      label: 'IPTC (author/rights)',\n      count: registrySummary?.iptc ?? 0,\n    },\n    {\n      key: 'xmp',\n      label: 'XMP (edit history)',\n      count: registrySummary?.xmp ?? 0,\n    },\n  ].filter(group => group.count > 0);\n  const lockedTotal = lockedGroups.reduce((sum, group) => sum + group.count, 0);\n  const lockedFields = Array.isArray(metadata.locked_fields)\n    ? metadata.locked_fields\n        .filter((field): field is string => typeof field === 'string')\n        .map(field => field.trim())\n        .filter(field => field.length > 0)\n    : [];\n  const showUnlock =\n    !canExport &&\n    lockedTotal > 0 &&\n    creditsRequired > 0 &&\n    creditsCharged === 0;\n\n  const imageWidth = metadata.exif?.ImageWidth;\n  const imageHeight = metadata.exif?.ImageHeight ?? metadata.exif?.ImageLength;\n  const dimensionsValue =\n    hasValue(imageWidth) && hasValue(imageHeight)\n      ? `${String(imageWidth)}  ${String(imageHeight)}`\n      : null;\n  const megapixelsValue = hasValue(metadata.calculated?.megapixels)\n    ? String(metadata.calculated?.megapixels)\n    : null;\n  const colorSpaceNumeric = Number(metadata.exif?.ColorSpace);\n  const colorSpaceValue =\n    Number.isFinite(colorSpaceNumeric) && colorSpaceNumeric === 1\n      ? 'sRGB'\n      : hasValue(metadata.exif?.ColorSpace)\n        ? String(metadata.exif?.ColorSpace)\n        : null;\n\n  const collectPaths = (\n    obj: unknown,\n    prefix = '',\n    depth = 0,\n    out: DetailEntry[] = [],\n    includeEmpty = false\n  ): DetailEntry[] => {\n    if (out.length >= 500) return out;\n    if (depth > 5) return out;\n    if (obj === null || obj === undefined) return out;\n    if (typeof obj !== 'object') {\n      out.push({\n        path: prefix || '(root)',\n        valuePreview: previewValue(obj).slice(0, 140),\n        value: obj,\n      });\n      return out;\n    }\n    if (Array.isArray(obj)) {\n      const preview = previewValue(obj.slice(0, 5));\n      out.push({\n        path: prefix || '(root)',\n        valuePreview: preview.slice(0, 140),\n        value: obj,\n      });\n      return out;\n    }\n    const record = obj as Record<string, unknown>;\n    for (const key of Object.keys(record)) {\n      const next = prefix ? `${prefix}.${key}` : key;\n      const value = record[key];\n      if (\n        value !== null &&\n        typeof value === 'object' &&\n        !Array.isArray(value)\n      ) {\n        collectPaths(value, next, depth + 1, out, includeEmpty);\n      } else if (Array.isArray(value)) {\n        const preview = previewValue(value.slice(0, 5));\n        out.push({\n          path: next,\n          valuePreview: preview.slice(0, 140),\n          value,\n        });\n      } else {\n        if (!includeEmpty && !hasValue(value)) continue;\n        out.push({\n          path: next,\n          valuePreview: previewValue(value).slice(0, 140),\n          value,\n        });\n      }\n      if (out.length >= 500) break;\n    }\n    return out;\n  };\n\n  const allRawPaths = collectPaths(metadata, '', 0, [], showEmptyRaw);\n  const q = rawSearch.trim().toLowerCase();\n  const rawMatches = q\n    ? allRawPaths\n        .filter(\n          e =>\n            e.path.toLowerCase().includes(q) ||\n            e.valuePreview.toLowerCase().includes(q)\n        )\n        .slice(0, 80)\n    : allRawPaths.slice(0, 40);\n\n  return (\n    <Layout showHeader={true} showFooter={true}>\n      <div\n        className=\"min-h-screen bg-[#0B0C10] text-white pt-16 sm:pt-20 pb-20\"\n        data-testid=\"results-root\"\n      >\n        <div className=\"container mx-auto px-3 sm:px-4 max-w-4xl\">\n          <PricingModal\n            isOpen={showPricingModal}\n            onClose={() => setShowPricingModal(false)}\n            defaultEmail={trialEmail || undefined}\n          />\n          <Dialog open={showPurposeModal} onOpenChange={setShowPurposeModal}>\n            <DialogContent className=\"sm:max-w-[520px] bg-[#0A0A0A] border border-white/10 text-white\">\n              <DialogTitle className=\"text-lg font-semibold\">\n                What brings you here?\n              </DialogTitle>\n              <DialogDescription className=\"text-sm text-slate-200\">\n                Pick a focus so we can highlight what matters most. You can\n                change this later.\n              </DialogDescription>\n              <div className=\"mt-5 grid grid-cols-1 gap-3\">\n                <button\n                  type=\"button\"\n                  onClick={() => handlePurposeSelect('privacy')}\n                  className=\"border border-white/10 rounded-lg p-4 text-left hover:border-primary/60 hover:bg-white/5 transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 focus:ring-offset-black\"\n                >\n                  <div className=\"text-sm font-semibold text-white\">\n                    Privacy check\n                  </div>\n                  <div className=\"text-xs text-slate-200\">\n                    Find location data, device details, and personal\n                    identifiers.\n                  </div>\n                </button>\n                <button\n                  type=\"button\"\n                  onClick={() => handlePurposeSelect('authenticity')}\n                  className=\"border border-white/10 rounded-lg p-4 text-left hover:border-primary/60 hover:bg-white/5 transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 focus:ring-offset-black\"\n                >\n                  <div className=\"text-sm font-semibold text-white\">\n                    Verify authenticity\n                  </div>\n                  <div className=\"text-xs text-slate-200\">\n                    Check edit history, hashes, and integrity signals.\n                  </div>\n                </button>\n                <button\n                  type=\"button\"\n                  onClick={() => handlePurposeSelect('photography')}\n                  className=\"border border-white/10 rounded-lg p-4 text-left hover:border-primary/60 hover:bg-white/5 transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 focus:ring-offset-black\"\n                >\n                  <div className=\"text-sm font-semibold text-white\">\n                    Photography details\n                  </div>\n                  <div className=\"text-xs text-slate-200\">\n                    Review camera settings, lens info, and capture details.\n                  </div>\n                </button>\n              </div>\n              <div className=\"mt-5 flex items-center justify-between\">\n                <Button\n                  variant=\"outline\"\n                  className=\"border-white/10 hover:bg-white/5\"\n                  onClick={() => handlePurposeSelect('explore')}\n                >\n                  Show everything\n                </Button>\n                <Button\n                  variant=\"ghost\"\n                  className=\"text-slate-200 hover:text-white\"\n                  onClick={() => {\n                    trackEvent('purpose_skipped', { location: 'results' });\n                    setShowPurposeModal(false);\n                  }}\n                >\n                  Skip for now\n                </Button>\n              </div>\n            </DialogContent>\n          </Dialog>\n\n          {/* Header */}\n          <div className=\"mb-6 sm:mb-8 flex flex-col gap-3 sm:gap-4\">\n            <div className=\"min-w-full\">\n              <h1 className=\"text-xl sm:text-2xl font-bold flex items-center gap-2 break-words\">\n                <FileImage className=\"w-5 h-5 sm:w-6 sm:h-6 text-primary shrink-0\" />\n                <span title={metadata.filename} className=\"line-clamp-2\">\n                  {metadata.filename}\n                </span>\n              </h1>\n              <p\n                className=\"text-slate-200 text-xs sm:text-sm font-mono mt-1 break-words\"\n                data-testid=\"key-field-mime-type\"\n              >\n                {metadata.filesize}  {metadata.mime_type}\n              </p>\n            </div>\n            <div className=\"flex flex-col gap-2 sm:flex-row sm:flex-wrap items-stretch sm:items-center w-full sm:w-auto\">\n              <Button\n                variant=\"outline\"\n                onClick={() => navigate('/images_mvp')}\n                className=\"border-white/10 hover:bg-white/5 w-full sm:w-auto\"\n              >\n                Analyze Another Photo\n              </Button>\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button\n                    variant=\"outline\"\n                    className=\"border-white/10 hover:bg-white/5 flex items-center gap-2 w-full sm:w-auto justify-center sm:justify-between\"\n                  >\n                    <Clipboard className=\"w-4 h-4\" />\n                    <span className=\"flex-1 sm:flex-none\">Summary actions</span>\n                    <ChevronDown className=\"w-4 h-4 text-slate-200\" />\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent\n                  align=\"start\"\n                  className=\"border-[#1b1b24] bg-[#050608] text-white\"\n                >\n                  <DropdownMenuItem onSelect={handleCopySummary}>\n                    <Clipboard className=\"w-4 h-4 text-slate-200\" />\n                    Copy summary\n                  </DropdownMenuItem>\n                  <DropdownMenuItem onSelect={handleDownloadSummary}>\n                    <FileText className=\"w-4 h-4 text-slate-200\" />\n                    Download summary\n                  </DropdownMenuItem>\n                </DropdownMenuContent>\n              </DropdownMenu>\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button\n                    variant=\"outline\"\n                    className=\"border-white/10 hover:bg-white/5 flex items-center gap-2 w-full sm:w-auto justify-center sm:justify-between\"\n                  >\n                    <Download className=\"w-4 h-4\" />\n                    <span className=\"flex-1 sm:flex-none\">Export data</span>\n                    <ChevronDown className=\"w-4 h-4 text-slate-200\" />\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent\n                  align=\"start\"\n                  className=\"border-[#1b1b24] bg-[#050608] text-white\"\n                >\n                  <DropdownMenuItem\n                    onSelect={handleDownloadJson}\n                    disabled={!canExport}\n                  >\n                    <FileJson className=\"w-4 h-4 text-slate-200\" />\n                    Download JSON\n                  </DropdownMenuItem>\n                  <DropdownMenuItem\n                    onSelect={handleDownloadFullTxt}\n                    disabled={!canExport}\n                  >\n                    <FileText className=\"w-4 h-4 text-slate-200\" />\n                    Download full report (txt)\n                  </DropdownMenuItem>\n                </DropdownMenuContent>\n              </DropdownMenu>\n            </div>\n          </div>\n          {!canExport && (\n            <p className=\"text-xs text-slate-500 mb-6\">\n              JSON export is available after credits are applied. Summary export\n              stays available.\n            </p>\n          )}\n\n          {metadata?.access?.mode === 'device_free' && (\n            <motion.div\n              initial={{ opacity: 0, y: -10 }}\n              animate={{ opacity: 1, y: 0 }}\n              className=\"mb-8 p-4 bg-primary/10 border border-primary/20 rounded-lg flex items-start gap-3\"\n            >\n              <Info className=\"w-5 h-5 text-primary shrink-0 mt-0.5\" />\n              <div>\n                <h4 className=\"font-bold text-primary text-sm mb-1\">\n                  Free check used ({metadata.access?.free_used ?? 1}/2). Credits\n                  not used yet.\n                </h4>\n                <p className=\"text-slate-200 text-xs leading-relaxed\">\n                  Sensitive identifiers hidden: exact GPS, device IDs,\n                  owner/contact fields, and OCR-extracted address text. Credits\n                  are charged after 2 free checks.\n                </p>\n              </div>\n            </motion.div>\n          )}\n\n          {isLimitedReport && (\n            <motion.div\n              initial={{ opacity: 0, y: -10 }}\n              animate={{ opacity: 1, y: 0 }}\n              className=\"mb-8 p-4 bg-primary/10 border border-primary/20 rounded-lg flex items-start gap-3\"\n            >\n              <ShieldAlert className=\"w-5 h-5 text-primary shrink-0 mt-0.5\" />\n              <div>\n                <h4 className=\"font-bold text-primary text-sm mb-1\">\n                  Limited report\n                </h4>\n                <p className=\"text-slate-200 text-xs leading-relaxed\">\n                  You are viewing a limited free report. Raw IPTC and XMP data\n                  has been summarized or redacted. Use credits to view the full\n                  report and raw exports.\n                </p>\n              </div>\n            </motion.div>\n          )}\n          {isLimitedReport && lockedFields.length > 0 && (\n            <Card className=\"mb-6 bg-[#121217] border-white/10\">\n              <CardHeader>\n                <CardTitle className=\"text-sm font-mono text-slate-200\">\n                  LOCKED FIELDS PREVIEW\n                </CardTitle>\n                <CardDescription className=\"text-xs text-slate-400\">\n                  Field names are visible, values are hidden.{' '}\n                  {lockedFields.length} total locked fields.\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-3 text-sm\">\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 text-xs\">\n                  {lockedFields.slice(0, 12).map(field => (\n                    <div\n                      key={field}\n                      className=\"flex items-center justify-between border border-white/5 rounded px-3 py-2 bg-white/5\"\n                    >\n                      <span className=\"text-slate-200 truncate pr-2\">\n                        {field}\n                      </span>\n                      <span className=\"text-slate-500\"></span>\n                    </div>\n                  ))}\n                </div>\n                {lockedFields.length > 12 && (\n                  <div className=\"text-xs text-slate-500\">\n                    +{lockedFields.length - 12} more locked fields hidden\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          )}\n          {formatHint && (\n            <Card className={`mb-6 border ${formatToneClass}`}>\n              <CardContent className=\"pt-6 flex items-start gap-3 text-sm\">\n                <Info className=\"w-5 h-5 mt-0.5\" />\n                <div>\n                  <div className=\"font-semibold text-white\">\n                    {formatHint.title}\n                  </div>\n                  <div className=\"text-xs text-slate-200 mt-1\">\n                    {formatHint.body}\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n          {showUnlock && (\n            <Card className=\"mb-6 bg-[#121217] border-white/10\">\n              <CardHeader>\n                <CardTitle className=\"text-sm font-mono text-slate-200\">\n                  UNLOCK FULL REPORT\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4 text-sm\">\n                <div className=\"text-slate-200\">\n                  Use credits to unlock {lockedTotal} additional fields for this\n                  file.\n                </div>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-xs\">\n                  {lockedGroups.slice(0, 6).map(group => (\n                    <div\n                      key={group.key}\n                      className=\"flex items-center justify-between border border-white/5 rounded px-3 py-2 bg-white/5\"\n                    >\n                      <span className=\"text-slate-200\">{group.label}</span>\n                      <span className=\"text-slate-200 font-mono\">\n                        {group.count}\n                      </span>\n                    </div>\n                  ))}\n                </div>\n                <div className=\"flex flex-col sm:flex-row gap-3\">\n                  <Button\n                    onClick={() => {\n                      trackEvent('paywall_cta_clicked', {\n                        locked_total: lockedTotal,\n                      });\n                      setShowPricingModal(true);\n                    }}\n                    className=\"bg-primary text-black hover:bg-primary/90\"\n                  >\n                    Get credits\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    className=\"border-white/10 hover:bg-white/5\"\n                    onClick={() => navigate('/images_mvp')}\n                  >\n                    Analyze another file\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n\n          <Card className=\"bg-[#121217] border-white/5 mb-6\">\n            <CardHeader>\n              <CardTitle className=\"text-sm font-mono text-slate-200\">\n                HIGHLIGHTS\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-3\">\n              {orderedHighlights.slice(0, 6).map((h, idx) => (\n                <button\n                  key={idx}\n                  type=\"button\"\n                  onClick={() =>\n                    h.target\n                      ? scrollTo(h.target.tab, h.target.anchorId)\n                      : undefined\n                  }\n                  className={`w-full text-left flex items-start gap-3 rounded-lg border px-3 py-2 transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 focus:ring-offset-black ${h.accentClass} ${h.target ? 'hover:bg-white/5' : ''}`}\n                >\n                  <div className=\"mt-0.5 opacity-90\">{h.icon}</div>\n                  <div className=\"flex-1\">\n                    <div className=\"text-sm\">{h.text}</div>\n                    <div className=\"mt-2 flex flex-wrap gap-2 text-[10px] font-mono\">\n                      <span className=\"px-2 py-1 rounded-full bg-white/5 border border-white/10 text-slate-200\">\n                        Impact: {h.impact}\n                      </span>\n                      <span className=\"px-2 py-1 rounded-full bg-white/5 border border-white/10 text-slate-200\">\n                        Confidence: {h.confidence}\n                      </span>\n                    </div>\n                  </div>\n                </button>\n              ))}\n              <div className=\"text-xs text-slate-500\">\n                Limitations: Metadata can be missing or stripped. Absence is not\n                proof.\n              </div>\n              {(fieldsExtracted || fieldsFound || processingMs) && (\n                <div className=\"pt-2 text-xs text-slate-500 font-mono\">\n                  {fieldsExtracted ? `${fieldsExtracted} fields checked` : null}\n                  {fieldsExtracted && (fieldsFound || processingMs)\n                    ? '  '\n                    : null}\n                  {fieldsFound ? `${fieldsFound} fields found` : null}\n                  {fieldsFound && processingMs ? '  ' : null}\n                  {processingMs ? `${Math.round(processingMs)} ms` : null}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          <div className=\"mb-4 flex flex-col gap-3\">\n            <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\n              <div className=\"flex items-center gap-2 sm:gap-3 text-xs text-slate-500 font-mono\">\n                <span className=\"whitespace-nowrap\">\n                  Focus: {typeof purposeLabel === 'string' ? purposeLabel : ''}\n                </span>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"text-slate-200 hover:text-white h-7 px-2 text-xs\"\n                  onClick={() => {\n                    trackEvent('purpose_prompt_opened', {\n                      location: 'results',\n                    });\n                    setShowPurposeModal(true);\n                  }}\n                >\n                  Change focus\n                </Button>\n              </div>\n              <ToggleGroup\n                type=\"single\"\n                value={densityMode}\n                onValueChange={handleDensityChange}\n                className=\"bg-[#121217] border border-white/10 rounded-lg p-1 w-fit\"\n              >\n                <ToggleGroupItem\n                  value=\"normal\"\n                  className=\"text-xs px-2 sm:px-3 py-1 text-slate-200 data-[state=on]:bg-white/10 data-[state=on]:text-white\"\n                >\n                  Normal\n                </ToggleGroupItem>\n                <ToggleGroupItem\n                  value=\"advanced\"\n                  className=\"text-xs px-2 sm:px-3 py-1 text-slate-200 data-[state=on]:bg-white/10 data-[state=on]:text-white\"\n                >\n                  Advanced\n                </ToggleGroupItem>\n              </ToggleGroup>\n            </div>\n          </div>\n\n          <Tabs\n            value={activeTab}\n            onValueChange={v => (isTabValue(v) ? setActiveTab(v) : undefined)}\n            className=\"w-full\"\n          >\n            <TabsList\n              className=\"bg-[#121217] border border-white/5 overflow-x-auto flex-nowrap\"\n              aria-label=\"Metadata categories\"\n            >\n              <TabsTrigger\n                value=\"privacy\"\n                className=\"text-xs sm:text-sm whitespace-nowrap\"\n              >\n                Privacy\n              </TabsTrigger>\n              <TabsTrigger\n                value=\"authenticity\"\n                className=\"text-xs sm:text-sm whitespace-nowrap\"\n              >\n                Authenticity\n              </TabsTrigger>\n              <TabsTrigger\n                value=\"photography\"\n                className=\"text-xs sm:text-sm whitespace-nowrap\"\n              >\n                Photography\n              </TabsTrigger>\n              {isAdvanced && (\n                <TabsTrigger\n                  value=\"raw\"\n                  className=\"text-xs sm:text-sm whitespace-nowrap\"\n                >\n                  <span className=\"inline-flex items-center gap-1 sm:gap-2\">\n                    {!canExport && (\n                      <Lock\n                        className=\"w-3 h-3 sm:w-3.5 sm:h-3.5 opacity-70\"\n                        aria-hidden=\"true\"\n                      />\n                    )}\n                    Raw\n                  </span>\n                </TabsTrigger>\n              )}\n            </TabsList>\n\n            <TabsContent value=\"privacy\" className=\"mt-6\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                {/* Location Card */}\n                <Card\n                  className=\"bg-[#121217] border-white/5\"\n                  id=\"section-location\"\n                >\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2 text-sm font-mono text-slate-200\">\n                      <MapPin className=\"w-4 h-4\" aria-hidden=\"true\" /> LOCATION\n                      DATA\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    {hasGps && gpsCoords ? (\n                      <div className=\"space-y-4\">\n                        <div className=\"p-4 bg-red-500/10 border border-red-500/20 rounded-lg text-red-200 text-sm flex items-center gap-2\">\n                          <ShieldAlert className=\"w-5 h-5\" />\n                          <span>Location data present in this file.</span>\n                        </div>\n                        <div className=\"grid grid-cols-2 gap-4 text-sm font-mono text-white\">\n                          <div>\n                            <span className=\"text-slate-500 block text-xs\">\n                              LATITUDE\n                            </span>\n                            {gpsCoords.latitude}\n                          </div>\n                          <div>\n                            <span className=\"text-slate-500 block text-xs\">\n                              LONGITUDE\n                            </span>\n                            {gpsCoords.longitude}\n                          </div>\n                        </div>\n                        {gpsMapUrl && (\n                          <a\n                            href={gpsMapUrl}\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                            className=\"block w-full py-2 bg-white/5 hover:bg-white/10 text-center rounded text-sm transition-colors text-primary\"\n                          >\n                            View on Google Maps{' '}\n                            <ArrowRight className=\"w-3 h-3 inline ml-1\" />\n                          </a>\n                        )}\n                      </div>\n                    ) : overlayGps ? (\n                      <div className=\"space-y-4\">\n                        <div className=\"p-4 bg-amber-500/10 border border-amber-500/20 rounded-lg text-amber-200 text-sm flex items-center gap-2\">\n                          <ShieldAlert className=\"w-5 h-5\" />\n                          <span>\n                            Overlay GPS detected from burned-in text (pixels).\n                          </span>\n                        </div>\n                        <div className=\"grid grid-cols-2 gap-4 text-sm font-mono text-white\">\n                          <div>\n                            <span className=\"text-slate-500 block text-xs\">\n                              LATITUDE (Overlay)\n                            </span>\n                            {overlayGps.latitude}\n                          </div>\n                          <div>\n                            <span className=\"text-slate-500 block text-xs\">\n                              LONGITUDE (Overlay)\n                            </span>\n                            {overlayGps.longitude}\n                          </div>\n                        </div>\n                        {gpsMapUrl && (\n                          <a\n                            href={gpsMapUrl}\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                            className=\"block w-full py-2 bg-white/5 hover:bg-white/10 text-center rounded text-sm transition-colors text-primary\"\n                          >\n                            View on Google Maps{' '}\n                            <ArrowRight className=\"w-3 h-3 inline ml-1\" />\n                          </a>\n                        )}\n                        {(burnedTimestamp ||\n                          metadata.burned_metadata?.parsed_data?.plus_code) && (\n                          <div className=\"text-xs text-slate-200 space-y-1\">\n                            {burnedTimestamp && (\n                              <div>\n                                <span className=\"text-slate-500\">\n                                  Overlay time:\n                                </span>{' '}\n                                {burnedTimestamp}\n                              </div>\n                            )}\n                            {metadata.burned_metadata?.parsed_data\n                              ?.plus_code && (\n                              <div>\n                                <span className=\"text-slate-500\">\n                                  Plus code:\n                                </span>{' '}\n                                {metadata.burned_metadata.parsed_data.plus_code}\n                              </div>\n                            )}\n                          </div>\n                        )}\n                        <div className=\"pt-2\">\n                          <Button\n                            variant=\"outline\"\n                            className=\"border-white/10 hover:bg-white/5 w-full\"\n                            onClick={() => setShowOverlayText(s => !s)}\n                          >\n                            {showOverlayText\n                              ? 'Hide overlay text'\n                              : 'View overlay text'}\n                          </Button>\n                          {showOverlayText && (\n                            <div className=\"mt-3 text-xs text-slate-200 bg-black/30 border border-white/5 rounded p-3 max-h-40 overflow-auto\">\n                              {metadata.burned_metadata?.extracted_text?.slice(\n                                0,\n                                1200\n                              ) || 'Text not available'}\n                            </div>\n                          )}\n                        </div>\n                      </div>\n                    ) : (\n                      <div className=\"py-8 text-center\">\n                        <CheckCircle2 className=\"w-12 h-12 text-emerald-500 mx-auto mb-3 opacity-20\" />\n                        <p className=\"text-emerald-500 font-bold\">\n                          Location not found\n                        </p>\n                        <p className=\"text-slate-500 text-xs mt-1\">\n                          No GPS coordinates are embedded in the metadata.\n                        </p>\n                        {!ocrSelected && (\n                          <div className=\"mt-3 space-y-2 text-xs text-slate-300\">\n                            <div>\n                              Text scan was off, so stamped map/location text\n                              wasnt checked. Enable text scan to look for\n                              overlays (+6 credits if text found).\n                            </div>\n                            <Button\n                              variant=\"outline\"\n                              className=\"border-white/10 hover:bg-white/5 w-full\"\n                              onClick={() =>\n                                navigate('/images_mvp?ocr=1')\n                              }\n                            >\n                              Re-run with text scan (+6 credits if text found)\n                            </Button>\n                          </div>\n                        )}\n                        {ocrSelected && isLimitedReport && (\n                          <div className=\"mt-3 text-xs text-slate-300\">\n                            Text scan results are limited in the free report.\n                            Use credits to view full overlay findings.\n                          </div>\n                        )}\n                        {ocrSelected && !isLimitedReport && (\n                          <div className=\"mt-3 text-xs text-slate-300\">\n                            Text scan ran and found no stamped location text.\n                          </div>\n                        )}\n                        {filenameSuggestsMap && !ocrSelected && (\n                          <div className=\"mt-2 text-[11px] text-slate-400\">\n                            Filename suggests a map/GPS overlay.\n                          </div>\n                        )}\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n\n                {/* Device Info */}\n                <Card\n                  className=\"bg-[#121217] border-white/5\"\n                  id=\"section-device\"\n                >\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2 text-sm font-mono text-slate-200\">\n                      <Camera className=\"w-4 h-4\" aria-hidden=\"true\" /> DEVICE\n                      INFORMATION\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <div className=\"grid grid-cols-1 gap-4\">\n                      {!hasValue(metadata.exif?.Make) &&\n                      !hasValue(metadata.exif?.Model) ? (\n                        <div className=\"text-xs text-slate-500\">\n                          No camera make/model tags present in this file.\n                        </div>\n                      ) : (\n                        <>\n                          {hasValue(metadata.exif?.Make) && (\n                            <div className=\"pb-3 border-b border-white/5\">\n                              <span className=\"text-slate-500 block text-xs font-mono mb-1\">\n                                CAMERA MAKE\n                              </span>\n                              <span className=\"text-white font-medium\">\n                                {String(metadata.exif?.Make)}\n                              </span>\n                            </div>\n                          )}\n                          {hasValue(metadata.exif?.Model) && (\n                            <div className=\"pb-3 border-b border-white/5\">\n                              <span className=\"text-slate-500 block text-xs font-mono mb-1\">\n                                CAMERA MODEL\n                              </span>\n                              <span className=\"text-white font-medium\">\n                                {String(metadata.exif?.Model)}\n                              </span>\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {hasValue(software) && (\n                        <div>\n                          <span className=\"text-slate-500 block text-xs font-mono mb-1\">\n                            SOFTWARE\n                          </span>\n                          <span className=\"text-white font-medium\">\n                            {software}\n                          </span>\n                        </div>\n                      )}\n                    </div>\n                  </CardContent>\n                </Card>\n\n                {/* Timestamps */}\n                <Card\n                  className=\"bg-[#121217] border-white/5\"\n                  id=\"section-timestamps\"\n                >\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2 text-sm font-mono text-slate-200\">\n                      <Calendar className=\"w-4 h-4\" aria-hidden=\"true\" />{' '}\n                      TIMESTAMPS\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <div className=\"grid grid-cols-1 gap-4\">\n                      <div className=\"pb-3 border-b border-white/5\">\n                        <Tooltip>\n                          <TooltipTrigger asChild>\n                            <span className=\"text-slate-500 inline-flex items-center gap-1 text-xs font-mono mb-1\">\n                              {captureDateLabel}\n                              <Info className=\"w-3 h-3 text-slate-600\" />\n                            </span>\n                          </TooltipTrigger>\n                          <TooltipContent className=\"max-w-xs text-xs\">\n                            {captureDateFromExif\n                              ? 'From camera EXIF metadata (original capture time).'\n                              : filenameDate\n                                ? 'Parsed from filename; may be approximate.'\n                                : hasCalculatedCapture && !isLimitedReport\n                                  ? 'Inferred from available metadata.'\n                                  : 'No capture timestamp found in metadata.'}\n                          </TooltipContent>\n                        </Tooltip>\n                        <span className=\"text-white font-medium\">\n                          {captureDateValue\n                            ? formatDate(captureDateValue)\n                            : isLimitedReport && hasCalculatedCapture\n                              ? 'Available in full report'\n                              : 'Not present in metadata'}\n                        </span>\n                      </div>\n                      {hasValue(burnedTimestamp) && (\n                        <div className=\"pb-3 border-b border-white/5\">\n                          <span className=\"text-slate-500 block text-xs font-mono mb-1\">\n                            OVERLAY TIMESTAMP\n                          </span>\n                          <span className=\"text-white font-medium\">\n                            {burnedTimestamp}\n                          </span>\n                        </div>\n                      )}\n                      <div>\n                        <Tooltip>\n                          <TooltipTrigger asChild>\n                            <span className=\"text-slate-500 inline-flex items-center gap-1 text-xs font-mono mb-1\">\n                              ORIGINAL FILE MODIFIED (BROWSER)\n                              <Info className=\"w-3 h-3 text-slate-600\" />\n                            </span>\n                          </TooltipTrigger>\n                          <TooltipContent className=\"max-w-xs text-xs\">\n                            From your device/browser (file last modified). This\n                            is not the capture time.\n                          </TooltipContent>\n                        </Tooltip>\n                        <span className=\"text-white font-medium\">\n                          {formatDate(\n                            localModifiedValue || undefined,\n                            'Not available (browser did not provide)'\n                          )}\n                        </span>\n                      </div>\n                      {filesystemTimestamp && (\n                        <div>\n                          <Tooltip>\n                            <TooltipTrigger asChild>\n                              <span className=\"text-slate-500 inline-flex items-center gap-1 text-xs font-mono mb-1\">\n                                SERVER FILE TIMESTAMP\n                                <Info className=\"w-3 h-3 text-slate-600\" />\n                              </span>\n                            </TooltipTrigger>\n                            <TooltipContent className=\"max-w-xs text-xs\">\n                              Timestamp from server-side processing/storage. Not\n                              the camera capture time.\n                            </TooltipContent>\n                          </Tooltip>\n                          <span className=\"text-white font-medium\">\n                            {formatDate(filesystemTimestamp)}\n                          </span>\n                        </div>\n                      )}\n                      {!captureDateValue && filesystemTimestamp && (\n                        <div className=\"text-xs text-slate-400\">\n                          File system dates reflect upload/server time, not when\n                          the photo was captured.\n                        </div>\n                      )}\n                    </div>\n                  </CardContent>\n                </Card>\n\n                {/* Hidden Data Summary */}\n                <Card className=\"bg-[#121217] border-white/5\">\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2 text-sm font-mono text-slate-200\">\n                      <Lock className=\"w-4 h-4\" aria-hidden=\"true\" /> HIDDEN\n                      DATA\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    {(() => {\n                      const exifKeys = Object.keys(metadata.exif || {});\n                      const hasMakerNotes =\n                        hasValue(metadata.exif?.MakerNote) ||\n                        exifKeys.some(k => k.toLowerCase().includes('maker'));\n                      const serial =\n                        (metadata.exif?.BodySerialNumber as\n                          | string\n                          | undefined) ||\n                        (metadata.exif?.LensSerialNumber as\n                          | string\n                          | undefined) ||\n                        (metadata.exif?.SerialNumber as string | undefined) ||\n                        null;\n                      const colorProfile = colorSpaceValue;\n\n                      if (\n                        !hasMakerNotes &&\n                        !hasValue(serial) &&\n                        !hasValue(colorProfile)\n                      ) {\n                        return (\n                          <div className=\"text-xs text-slate-500\">\n                            No hidden identifiers present in this file.\n                          </div>\n                        );\n                      }\n\n                      return (\n                        <ul className=\"space-y-3\">\n                          {hasMakerNotes && (\n                            <li className=\"flex justify-between text-sm\">\n                              <span className=\"text-slate-200\">MakerNotes</span>\n                              <span className=\"text-red-400\">Detected</span>\n                            </li>\n                          )}\n                          {hasValue(serial) && (\n                            <li className=\"flex justify-between text-sm\">\n                              <span className=\"text-slate-200\">\n                                Serial Numbers\n                              </span>\n                              <span className=\"text-slate-200 truncate max-w-[55%]\">\n                                {serial}\n                              </span>\n                            </li>\n                          )}\n                          {hasValue(colorProfile) && (\n                            <li className=\"flex justify-between text-sm\">\n                              <span className=\"text-slate-200\">\n                                Color Profile\n                              </span>\n                              <span className=\"text-slate-200\">\n                                {colorProfile}\n                              </span>\n                            </li>\n                          )}\n                        </ul>\n                      );\n                    })()}\n                  </CardContent>\n                </Card>\n\n                {/* Integrity */}\n                {(hasValue(hashSha256) || hasValue(hashMd5)) && (\n                  <Card\n                    className=\"bg-[#121217] border-white/5\"\n                    id=\"section-integrity\"\n                  >\n                    <CardHeader>\n                      <CardTitle className=\"flex items-center gap-2 text-sm font-mono text-slate-200\">\n                        <Hash className=\"w-4 h-4\" aria-hidden=\"true\" />{' '}\n                        INTEGRITY\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"space-y-3 text-sm font-mono\">\n                      {hasValue(hashSha256) && (\n                        <div className=\"flex justify-between gap-3\">\n                          <span className=\"text-slate-200\">SHA256</span>\n                          <span className=\"text-slate-200 truncate max-w-[60%]\">\n                            {String(hashSha256)}\n                          </span>\n                        </div>\n                      )}\n                      {hasValue(hashMd5) && (\n                        <div className=\"flex justify-between gap-3\">\n                          <span className=\"text-slate-200\">MD5</span>\n                          <span className=\"text-slate-200 truncate max-w-[60%]\">\n                            {String(hashMd5)}\n                          </span>\n                        </div>\n                      )}\n                    </CardContent>\n                  </Card>\n                )}\n\n                {isAdvanced && (\n                  <Card className=\"bg-[#121217] border-white/5 md:col-span-2\">\n                    <CardHeader>\n                      <CardTitle className=\"text-sm font-mono text-slate-200\">\n                        ADVANCED DETAILS\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <Accordion\n                        type=\"single\"\n                        collapsible\n                        className=\"border-white/10\"\n                      >\n                        <AccordionItem\n                          value=\"privacy-advanced\"\n                          className=\"border-white/10\"\n                        >\n                          <AccordionTrigger className=\"text-slate-200 hover:no-underline\">\n                            Privacy details (filtered)\n                          </AccordionTrigger>\n                          <AccordionContent>\n                            {(() => {\n                              const maxEntries = canExport ? 200 : 20;\n                              const details = collectDetailEntries(\n                                {\n                                  location: {\n                                    embedded_gps: gpsCoords,\n                                    overlay_gps: overlayGps,\n                                    overlay_plus_code:\n                                      metadata.burned_metadata?.parsed_data\n                                        ?.plus_code,\n                                    overlay_address:\n                                      metadata.burned_metadata?.parsed_data\n                                        ?.address,\n                                  },\n                                  timestamps: {\n                                    capture_date: captureDateValue || null,\n                                    overlay_timestamp: burnedTimestamp,\n                                    local_file_modified: localModifiedValue,\n                                  },\n                                  device: {\n                                    make: metadata.exif?.Make,\n                                    model: metadata.exif?.Model,\n                                    software,\n                                  },\n                                  identifiers: {\n                                    maker_notes_detected:\n                                      hasValue(metadata.exif?.MakerNote) ||\n                                      Object.keys(metadata.exif || {}).some(k =>\n                                        k.toLowerCase().includes('maker')\n                                      ),\n                                    serial_numbers:\n                                      metadata.exif?.BodySerialNumber ||\n                                      metadata.exif?.LensSerialNumber ||\n                                      metadata.exif?.SerialNumber,\n                                  },\n                                  registry_summary:\n                                    metadata.registry_summary ?? null,\n                                },\n                                '',\n                                0,\n                                4,\n                                [],\n                                maxEntries\n                              );\n\n                              if (details.length === 0) {\n                                return (\n                                  <div className=\"text-xs text-slate-500\">\n                                    No additional fields in this view.\n                                  </div>\n                                );\n                              }\n\n                              return (\n                                <>\n                                  {!canExport && (\n                                    <div className=\"text-xs text-slate-500 mb-3\">\n                                      Showing the first {maxEntries} entries.\n                                      Use credits to unlock the full report and\n                                      search everything.\n                                    </div>\n                                  )}\n                                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2\">\n                                    {details.map(d => (\n                                      <button\n                                        key={d.path}\n                                        type=\"button\"\n                                        className=\"text-left bg-white/5 border border-white/5 rounded px-3 py-2 hover:bg-white/10 transition-colors min-h-[44px] flex flex-col justify-center\"\n                                        onClick={() =>\n                                          navigator.clipboard?.writeText(\n                                            JSON.stringify(\n                                              { [d.path]: d.value },\n                                              null,\n                                              2\n                                            )\n                                          )\n                                        }\n                                      >\n                                        <div className=\"text-xs font-mono text-slate-200 truncate\">\n                                          {d.path}\n                                        </div>\n                                        <div className=\"text-xs text-slate-500 truncate\">\n                                          {d.valuePreview}\n                                        </div>\n                                      </button>\n                                    ))}\n                                  </div>\n                                </>\n                              );\n                            })()}\n                          </AccordionContent>\n                        </AccordionItem>\n                      </Accordion>\n                    </CardContent>\n                  </Card>\n                )}\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"authenticity\" className=\"mt-6\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <Card\n                  className=\"bg-[#121217] border-white/5\"\n                  id=\"section-auth-signals\"\n                >\n                  <CardHeader>\n                    <CardTitle className=\"text-sm font-mono text-slate-200\">\n                      AUTHENTICITY SIGNALS\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-3 text-sm\">\n                    <div className=\"text-slate-200\">\n                      <span className=\"text-slate-500 block text-xs font-mono mb-1\">\n                        EDIT SOFTWARE\n                      </span>\n                      <span className=\"text-white\">\n                        {hasValue(software)\n                          ? software\n                          : 'No tag present (inconclusive)'}\n                      </span>\n                    </div>\n                    <div className=\"text-slate-200\">\n                      <span className=\"text-slate-500 block text-xs font-mono mb-1\">\n                        METADATA STATE\n                      </span>\n                      <span className=\"text-white\">\n                        {metadata.metadata_comparison?.summary\n                          ?.overall_status || 'Not available for this file'}\n                      </span>\n                    </div>\n                    {metadata.metadata_comparison?.warnings?.length ? (\n                      <ul className=\"list-disc pl-5 text-slate-200 text-xs space-y-1\">\n                        {metadata.metadata_comparison.warnings\n                          .slice(0, 3)\n                          .map((w, i) => (\n                            <li key={i}>{w}</li>\n                          ))}\n                      </ul>\n                    ) : (\n                      <div className=\"text-xs text-slate-500\">\n                        No additional authenticity warnings present.\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n\n                <Card className=\"bg-[#121217] border-white/5\">\n                  <CardHeader>\n                    <CardTitle className=\"text-sm font-mono text-slate-200\">\n                      FINGERPRINTS\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-3 text-sm font-mono\">\n                    {hasValue(metadata.perceptual_hashes?.phash) && (\n                      <div className=\"flex justify-between gap-3\">\n                        <span className=\"text-slate-200\">pHash</span>\n                        <span className=\"text-slate-200 truncate max-w-[60%]\">\n                          {String(metadata.perceptual_hashes?.phash)}\n                        </span>\n                      </div>\n                    )}\n                    {hasValue(metadata.perceptual_hashes?.dhash) && (\n                      <div className=\"flex justify-between gap-3\">\n                        <span className=\"text-slate-200\">dHash</span>\n                        <span className=\"text-slate-200 truncate max-w-[60%]\">\n                          {String(metadata.perceptual_hashes?.dhash)}\n                        </span>\n                      </div>\n                    )}\n                    {!hasValue(metadata.perceptual_hashes?.phash) &&\n                      !hasValue(metadata.perceptual_hashes?.dhash) && (\n                        <div className=\"text-xs text-slate-500\">\n                          Perceptual hashes not present for this file.\n                        </div>\n                      )}\n                  </CardContent>\n                </Card>\n\n                {isAdvanced && (\n                  <Card className=\"bg-[#121217] border-white/5 md:col-span-2\">\n                    <CardHeader>\n                      <CardTitle className=\"text-sm font-mono text-slate-200\">\n                        ADVANCED DETAILS\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <Accordion\n                        type=\"single\"\n                        collapsible\n                        className=\"border-white/10\"\n                      >\n                        <AccordionItem\n                          value=\"auth-advanced\"\n                          className=\"border-white/10\"\n                        >\n                          <AccordionTrigger className=\"text-slate-200 hover:no-underline\">\n                            Authenticity details (filtered)\n                          </AccordionTrigger>\n                          <AccordionContent>\n                            {(() => {\n                              const maxEntries = canExport ? 200 : 20;\n                              const details = collectDetailEntries(\n                                {\n                                  hashes: metadata.hashes ?? null,\n                                  file_integrity:\n                                    metadata.file_integrity ?? null,\n                                  perceptual_hashes:\n                                    metadata.perceptual_hashes ?? null,\n                                  metadata_comparison:\n                                    metadata.metadata_comparison ?? null,\n                                  software,\n                                  processing: {\n                                    fields_extracted: fieldsExtracted,\n                                    processing_ms: processingMs,\n                                  },\n                                },\n                                '',\n                                0,\n                                4,\n                                [],\n                                maxEntries\n                              );\n\n                              if (details.length === 0) {\n                                return (\n                                  <div className=\"text-xs text-slate-500\">\n                                    No additional fields in this view.\n                                  </div>\n                                );\n                              }\n\n                              return (\n                                <>\n                                  {!canExport && (\n                                    <div className=\"text-xs text-slate-500 mb-3\">\n                                      Showing the first {maxEntries} entries.\n                                      Use credits to unlock the full report and\n                                      search everything.\n                                    </div>\n                                  )}\n                                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2\">\n                                    {details.map(d => (\n                                      <button\n                                        key={d.path}\n                                        type=\"button\"\n                                        className=\"text-left bg-white/5 border border-white/5 rounded px-3 py-2 hover:bg-white/10 transition-colors min-h-[44px] flex flex-col justify-center\"\n                                        onClick={() =>\n                                          navigator.clipboard?.writeText(\n                                            JSON.stringify(\n                                              { [d.path]: d.value },\n                                              null,\n                                              2\n                                            )\n                                          )\n                                        }\n                                      >\n                                        <div className=\"text-xs font-mono text-slate-200 truncate\">\n                                          {d.path}\n                                        </div>\n                                        <div className=\"text-xs text-slate-500 truncate\">\n                                          {d.valuePreview}\n                                        </div>\n                                      </button>\n                                    ))}\n                                  </div>\n                                </>\n                              );\n                            })()}\n                          </AccordionContent>\n                        </AccordionItem>\n                      </Accordion>\n                    </CardContent>\n                  </Card>\n                )}\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"photography\" className=\"mt-6\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <Card className=\"bg-[#121217] border-white/5\">\n                  <CardHeader>\n                    <CardTitle className=\"text-sm font-mono text-slate-200\">\n                      CAMERA SETTINGS\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-3 text-sm\">\n                    {hasValue(metadata.normalized?.exposure_triangle) && (\n                      <div className=\"text-slate-200\">\n                        <span className=\"text-slate-500 block text-xs font-mono mb-1\">\n                          EXPOSURE\n                        </span>\n                        <span className=\"text-white\">\n                          {String(metadata.normalized?.exposure_triangle)}\n                        </span>\n                      </div>\n                    )}\n                    <div className=\"grid grid-cols-2 gap-4 font-mono text-xs\">\n                      {hasValue(metadata.exif?.ISO) && (\n                        <div>\n                          <span className=\"text-slate-500 block\">ISO</span>\n                          <span className=\"text-slate-200\">\n                            {String(metadata.exif?.ISO)}\n                          </span>\n                        </div>\n                      )}\n                      {hasValue(metadata.exif?.FNumber) && (\n                        <div>\n                          <span className=\"text-slate-500 block\">APERTURE</span>\n                          <span className=\"text-slate-200\">\n                            f/{String(metadata.exif?.FNumber)}\n                          </span>\n                        </div>\n                      )}\n                      {hasValue(metadata.exif?.ExposureTime) && (\n                        <div>\n                          <span className=\"text-slate-500 block\">SHUTTER</span>\n                          <span className=\"text-slate-200\">\n                            {String(metadata.exif?.ExposureTime)}s\n                          </span>\n                        </div>\n                      )}\n                      {hasValue(metadata.exif?.FocalLength) && (\n                        <div>\n                          <span className=\"text-slate-500 block\">\n                            FOCAL LENGTH\n                          </span>\n                          <span className=\"text-slate-200\">\n                            {String(metadata.exif?.FocalLength)}mm\n                          </span>\n                        </div>\n                      )}\n                    </div>\n                    {!hasValue(metadata.exif?.ISO) &&\n                      !hasValue(metadata.exif?.FNumber) &&\n                      !hasValue(metadata.exif?.ExposureTime) &&\n                      !hasValue(metadata.exif?.FocalLength) && (\n                        <div className=\"text-xs text-slate-500\">\n                          No camera setting fields present in this file.\n                        </div>\n                      )}\n                  </CardContent>\n                </Card>\n\n                <Card className=\"bg-[#121217] border-white/5\">\n                  <CardHeader>\n                    <CardTitle className=\"text-sm font-mono text-slate-200\">\n                      IMAGE INFO\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-3 text-sm\">\n                    {!dimensionsValue &&\n                    !megapixelsValue &&\n                    !colorSpaceValue ? (\n                      <div className=\"text-xs text-slate-500\">\n                        No image info fields present in this file.\n                      </div>\n                    ) : (\n                      <>\n                        {dimensionsValue && (\n                          <div className=\"text-slate-200\">\n                            <span className=\"text-slate-500 block text-xs font-mono mb-1\">\n                              DIMENSIONS\n                            </span>\n                            <span className=\"text-white\">\n                              {dimensionsValue}\n                            </span>\n                          </div>\n                        )}\n                        {megapixelsValue && (\n                          <div className=\"text-slate-200\">\n                            <span className=\"text-slate-500 block text-xs font-mono mb-1\">\n                              MEGAPIXELS\n                            </span>\n                            <span className=\"text-white\">\n                              {megapixelsValue}\n                            </span>\n                          </div>\n                        )}\n                        {colorSpaceValue && (\n                          <div className=\"text-slate-200\">\n                            <span className=\"text-slate-500 block text-xs font-mono mb-1\">\n                              COLOR SPACE\n                            </span>\n                            <span className=\"text-white\">\n                              {colorSpaceValue}\n                            </span>\n                          </div>\n                        )}\n                      </>\n                    )}\n                  </CardContent>\n                </Card>\n\n                <Card className=\"bg-[#121217] border-white/5 md:col-span-2\">\n                  <CardHeader>\n                    <CardTitle className=\"text-sm font-mono text-slate-200\">\n                      EXIF FIELDS\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-3\">\n                    <div className=\"text-xs text-slate-500\">\n                      {exifEntries.length} fields present\n                      {!canExport && exifEntries.length > 14\n                        ? '  Use credits to see all fields'\n                        : ''}\n                    </div>\n                    {exifEntries.length === 0 ? (\n                      <div className=\"text-xs text-slate-500\">\n                        No EXIF fields present in this file.\n                      </div>\n                    ) : (\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-xs font-mono\">\n                        {exifEntriesForList.map(([k, v]) => (\n                          <div\n                            key={k}\n                            className=\"flex justify-between gap-3 bg-white/5 border border-white/5 rounded px-3 py-2\"\n                          >\n                            <span className=\"text-slate-200 truncate\">{k}</span>\n                            <span className=\"text-slate-200 truncate max-w-[55%]\">\n                              {String(v)}\n                            </span>\n                          </div>\n                        ))}\n                      </div>\n                    )}\n                    {exifEntries.length > 14 && (\n                      <div className=\"pt-2\">\n                        <Button\n                          variant=\"outline\"\n                          className=\"border-white/10 hover:bg-white/5\"\n                          onClick={() => setShowAllExif(s => !s)}\n                        >\n                          {showAllExif ? 'Show fewer' : 'Show more'}\n                        </Button>\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n\n                {isAdvanced && (\n                  <Card className=\"bg-[#121217] border-white/5 md:col-span-2\">\n                    <CardHeader>\n                      <CardTitle className=\"text-sm font-mono text-slate-200\">\n                        ADVANCED DETAILS\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <Accordion\n                        type=\"single\"\n                        collapsible\n                        className=\"border-white/10\"\n                      >\n                        <AccordionItem\n                          value=\"photo-advanced\"\n                          className=\"border-white/10\"\n                        >\n                          <AccordionTrigger className=\"text-slate-200 hover:no-underline\">\n                            Photography details (filtered)\n                          </AccordionTrigger>\n                          <AccordionContent>\n                            {(() => {\n                              const maxEntries = canExport ? 200 : 20;\n                              const details = collectDetailEntries(\n                                {\n                                  camera: {\n                                    make: metadata.exif?.Make,\n                                    model: metadata.exif?.Model,\n                                  },\n                                  capture: {\n                                    capture_date: captureDateValue || null,\n                                    date_source: captureDateLabel,\n                                  },\n                                  settings: {\n                                    iso: metadata.exif?.ISO,\n                                    f_number: metadata.exif?.FNumber,\n                                    exposure_time: metadata.exif?.ExposureTime,\n                                    focal_length: metadata.exif?.FocalLength,\n                                    focal_length_35mm:\n                                      metadata.exif?.FocalLengthIn35mmFormat,\n                                  },\n                                  image: {\n                                    dimensions: dimensionsValue,\n                                    megapixels: megapixelsValue,\n                                    color_space: colorSpaceValue,\n                                  },\n                                  normalized: metadata.normalized ?? null,\n                                  calculated: metadata.calculated ?? null,\n                                },\n                                '',\n                                0,\n                                4,\n                                [],\n                                maxEntries\n                              );\n\n                              if (details.length === 0) {\n                                return (\n                                  <div className=\"text-xs text-slate-500\">\n                                    No additional fields in this view.\n                                  </div>\n                                );\n                              }\n\n                              return (\n                                <>\n                                  {!canExport && (\n                                    <div className=\"text-xs text-slate-500 mb-3\">\n                                      Showing the first {maxEntries} entries.\n                                      Use credits to unlock the full report and\n                                      search everything.\n                                    </div>\n                                  )}\n                                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2\">\n                                    {details.map(d => (\n                                      <button\n                                        key={d.path}\n                                        type=\"button\"\n                                        className=\"text-left bg-white/5 border border-white/5 rounded px-3 py-2 hover:bg-white/10 transition-colors min-h-[44px] flex flex-col justify-center\"\n                                        onClick={() =>\n                                          navigator.clipboard?.writeText(\n                                            JSON.stringify(\n                                              { [d.path]: d.value },\n                                              null,\n                                              2\n                                            )\n                                          )\n                                        }\n                                      >\n                                        <div className=\"text-xs font-mono text-slate-200 truncate\">\n                                          {d.path}\n                                        </div>\n                                        <div className=\"text-xs text-slate-500 truncate\">\n                                          {d.valuePreview}\n                                        </div>\n                                      </button>\n                                    ))}\n                                  </div>\n                                </>\n                              );\n                            })()}\n                          </AccordionContent>\n                        </AccordionItem>\n                      </Accordion>\n                    </CardContent>\n                  </Card>\n                )}\n              </div>\n            </TabsContent>\n\n            {isAdvanced && (\n              <TabsContent value=\"raw\" className=\"mt-6\">\n                <Card className=\"bg-[#121217] border-white/5\">\n                  <CardHeader>\n                    <CardTitle className=\"text-sm font-mono text-slate-200\">\n                      {canExport ? 'RAW JSON' : 'RAW JSON (PREVIEW)'}\n                    </CardTitle>\n                    <p className=\"text-xs text-slate-500\">\n                      Engine flags indicate enabled modules, not that data was\n                      found. Toggle empty fields to see nulls/absent values.\n                    </p>\n                  </CardHeader>\n                  <CardContent>\n                    {!canExport && (\n                      <div className=\"text-sm text-slate-200 mb-4\">\n                        Raw JSON export is locked on free scans, but you can\n                        preview and search a subset of extracted fields here.\n                      </div>\n                    )}\n                    <div className=\"mb-3 flex flex-col sm:flex-row items-stretch sm:items-center gap-2\">\n                      <div className=\"flex-1 flex items-center gap-2\">\n                        <Search className=\"w-4 h-4 text-slate-500\" />\n                        <Input\n                          value={rawSearch}\n                          onChange={e => setRawSearch(e.target.value)}\n                          placeholder=\"Search keys/values...\"\n                          className=\"bg-black/30 border-white/10 text-slate-200 placeholder:text-slate-600\"\n                        />\n                      </div>\n                      <Button\n                        variant=\"outline\"\n                        className=\"border-white/10 hover:bg-white/5\"\n                        onClick={() => setShowEmptyRaw(v => !v)}\n                      >\n                        {showEmptyRaw ? 'Hide empty' : 'Show empty'}\n                      </Button>\n                    </div>\n                    <div className=\"mb-4 grid grid-cols-1 md:grid-cols-2 gap-2\">\n                      {(canExport ? rawMatches : rawMatches.slice(0, 20)).map(\n                        m => (\n                          <button\n                            key={m.path}\n                            type=\"button\"\n                            className=\"text-left bg-white/5 border border-white/5 rounded px-3 py-2 hover:bg-white/10 transition-colors min-h-[44px] flex flex-col justify-center\"\n                            onClick={() =>\n                              navigator.clipboard?.writeText(\n                                JSON.stringify({ [m.path]: m.value }, null, 2)\n                              )\n                            }\n                          >\n                            <div className=\"text-xs font-mono text-slate-200 truncate\">\n                              {m.path}\n                            </div>\n                            <div className=\"text-xs text-slate-500 truncate\">\n                              {m.valuePreview}\n                            </div>\n                          </button>\n                        )\n                      )}\n                    </div>\n                    {canExport ? (\n                      <pre className=\"text-xs text-slate-200 bg-black/30 border border-white/5 rounded p-3 overflow-auto max-h-[520px]\">\n                        {JSON.stringify(metadata, null, 2)}\n                      </pre>\n                    ) : (\n                      <div className=\"text-xs text-slate-500\">\n                        Showing up to 20 matches. Use credits to download the\n                        full report and view complete raw JSON.\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n              </TabsContent>\n            )}\n          </Tabs>\n          {(metadata.quality_metrics || metadata.processing_insights) && (\n            <div className=\"mt-8 flex items-center gap-2 text-xs text-slate-500\">\n              <span>Extraction details</span>\n              <Tooltip>\n                <TooltipTrigger asChild>\n                  <button\n                    type=\"button\"\n                    className=\"inline-flex items-center justify-center w-5 h-5 rounded-full border border-white/10 text-slate-200 hover:text-white hover:bg-white/5\"\n                    aria-label=\"Extraction details\"\n                  >\n                    i\n                  </button>\n                </TooltipTrigger>\n                <TooltipContent className=\"max-w-xs text-xs leading-relaxed\">\n                  <div className=\"space-y-1\">\n                    {metadata.quality_metrics?.confidence_score ? (\n                      <div>\n                        Confidence:{' '}\n                        {(\n                          metadata.quality_metrics.confidence_score * 100\n                        ).toFixed(0)}\n                        %\n                      </div>\n                    ) : null}\n                    {metadata.quality_metrics?.extraction_completeness ? (\n                      <div>\n                        Coverage:{' '}\n                        {(\n                          metadata.quality_metrics.extraction_completeness * 100\n                        ).toFixed(0)}\n                        %\n                      </div>\n                    ) : null}\n                    {metadata.processing_insights?.total_fields_extracted ? (\n                      <div>\n                        Fields extracted:{' '}\n                        {metadata.processing_insights.total_fields_extracted.toLocaleString()}\n                      </div>\n                    ) : null}\n                    {metadata.processing_insights?.processing_time_ms ? (\n                      <div>\n                        Processing time:{' '}\n                        {(\n                          metadata.processing_insights.processing_time_ms / 1000\n                        ).toFixed(1)}\n                        s\n                      </div>\n                    ) : null}\n                    {metadata.quality_metrics?.format_support_level ? (\n                      <div>\n                        Format support:{' '}\n                        {metadata.quality_metrics.format_support_level.replace(\n                          /_/g,\n                          ' '\n                        )}\n                      </div>\n                    ) : null}\n                    {typeof extractionInfo?.dynamic_modules_enabled ===\n                    'boolean' ? (\n                      <div>\n                        Engine mode:{' '}\n                        {extractionInfo.dynamic_modules_enabled\n                          ? 'dynamic selection'\n                          : 'fixed engine set'}{' '}\n                        (capability flags only)\n                      </div>\n                    ) : null}\n                    {typeof enabledEnginesCount === 'number' ? (\n                      <div>\n                        Specialized engines enabled:{' '}\n                        {enabledEnginesCount.toLocaleString()} (not data\n                        found)\n                      </div>\n                    ) : null}\n                    {!metadata.quality_metrics?.confidence_score &&\n                    !metadata.quality_metrics?.extraction_completeness &&\n                    !metadata.processing_insights?.total_fields_extracted &&\n                    !metadata.processing_insights?.processing_time_ms &&\n                    !metadata.quality_metrics?.format_support_level &&\n                    typeof extractionInfo?.dynamic_modules_enabled !==\n                      'boolean' &&\n                    typeof enabledEnginesCount !== 'number' ? (\n                      <div>Quality data not reported for this file.</div>\n                    ) : null}\n                  </div>\n                </TooltipContent>\n              </Tooltip>\n            </div>\n          )}\n        </div>\n      </div>\n    </Layout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/not-found.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/onboarding/images-mvp/images-help-content.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/onboarding/images-mvp/images-progression-tracker.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":164,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":164,"endColumn":20,"suggestions":[{"fix":{"range":[4283,4384],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":179,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":179,"endColumn":20,"suggestions":[{"fix":{"range":[4650,4751],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Images MVP Progression Tracker\n * Purpose-based progression tracking for Images MVP\n */\n\nimport type { OnboardingProgress } from '@/lib/onboarding/onboarding-engine';\n\nexport type ImagesPurpose = 'privacy' | 'photography' | 'authenticity';\n\nexport interface ImagesMilestone {\n  id: string;\n  purpose: ImagesPurpose;\n  name: string;\n  description: string;\n  completed: boolean;\n  completedAt?: number;\n}\n\nexport const IMAGES_MILESTONES: ImagesMilestone[] = [\n  {\n    id: 'privacy-first-check',\n    purpose: 'privacy',\n    name: 'First Privacy Check',\n    description: 'Complete your first privacy check',\n    completed: false,\n  },\n  {\n    id: 'privacy-cleaned',\n    purpose: 'privacy',\n    name: 'Cleaned 10 Photos',\n    description: 'Clean metadata from 10 photos',\n    completed: false,\n  },\n  {\n    id: 'photo-analyzed',\n    purpose: 'photography',\n    name: 'Analyzed Settings',\n    description: 'Review camera settings for a photo',\n    completed: false,\n  },\n  {\n    id: 'photo-learned',\n    purpose: 'photography',\n    name: 'Learned from Settings',\n    description: 'Understand what your settings reveal about your technique',\n    completed: false,\n  },\n  {\n    id: 'auth-verified',\n    purpose: 'authenticity',\n    name: 'Verified Authenticity',\n    description: 'Check authenticity of a photo',\n    completed: false,\n  },\n  {\n    id: 'auth-compared',\n    purpose: 'authenticity',\n    name: 'Compared Metadata',\n    description: 'Compare embedded vs burned-in metadata',\n    completed: false,\n  },\n];\n\nexport class ImagesProgressionTracker {\n  private progress: OnboardingProgress | null = null;\n  private milestones: Map<string, ImagesMilestone>;\n  private currentPurpose: ImagesPurpose | null = null;\n\n  constructor(progress: OnboardingProgress | null) {\n    this.progress = progress;\n    this.milestones = new Map(\n      IMAGES_MILESTONES.map(m => [m.id, { ...m, completed: false }])\n    );\n    this.loadMilestones();\n  }\n\n  /**\n   * Set current purpose\n   */\n  setPurpose(purpose: ImagesPurpose): void {\n    this.currentPurpose = purpose;\n  }\n\n  /**\n   * Get completion percentage for purpose\n   */\n  getCompletionPercentage(purpose: ImagesPurpose): number {\n    const purposeMilestones = Array.from(this.milestones.values()).filter(\n      m => m.purpose === purpose\n    );\n    const completedCount = purposeMilestones.filter(m => m.completed).length;\n    return purposeMilestones.length > 0\n      ? (completedCount / purposeMilestones.length) * 100\n      : 0;\n  }\n\n  /**\n   * Mark milestone complete\n   */\n  completeMilestone(milestoneId: string): void {\n    const milestone = this.milestones.get(milestoneId);\n    if (milestone) {\n      milestone.completed = true;\n      milestone.completedAt = Date.now();\n      this.saveMilestones();\n    }\n  }\n\n  /**\n   * Check if milestone is complete\n   */\n  isMilestoneComplete(milestoneId: string): boolean {\n    const milestone = this.milestones.get(milestoneId);\n    return milestone?.completed ?? false;\n  }\n\n  /**\n   * Get next uncompleted milestone for purpose\n   */\n  getNextMilestone(purpose: ImagesPurpose): ImagesMilestone | null {\n    const uncompleted = Array.from(this.milestones.values()).filter(\n      m => m.purpose === purpose && !m.completed\n    );\n    return uncompleted.length > 0 ? uncompleted[0] : null;\n  }\n\n  /**\n   * Get all milestones for purpose\n   */\n  getMilestonesByPurpose(purpose: ImagesPurpose): ImagesMilestone[] {\n    return Array.from(this.milestones.values()).filter(\n      m => m.purpose === purpose\n    );\n  }\n\n  /**\n   * Get recommended tutorial based on current state\n   */\n  getRecommendedTutorial(): string | null {\n    const completedSteps = this.progress?.totalStepsCompleted ?? 0;\n\n    if (completedSteps === 0) {\n      return 'images-privacy-tour';\n    } else if (completedSteps < 5) {\n      return 'images-photography-tour';\n    } else if (completedSteps < 10) {\n      return 'images-authenticity-tour';\n    }\n\n    return null;\n  }\n\n  /**\n   * Load milestones from localStorage\n   */\n  private loadMilestones(): void {\n    try {\n      const stored = localStorage.getItem('images_mvp_milestones');\n      if (stored) {\n        const loaded: ImagesMilestone[] = JSON.parse(stored);\n        loaded.forEach(m => this.milestones.set(m.id, m));\n      }\n    } catch (error) {\n      console.error(\n        '[ImagesProgressionTracker] Failed to load milestones',\n        error\n      );\n    }\n  }\n\n  /**\n   * Save milestones to localStorage\n   */\n  private saveMilestones(): void {\n    try {\n      const data = Array.from(this.milestones.values());\n      localStorage.setItem('images_mvp_milestones', JSON.stringify(data));\n    } catch (error) {\n      console.error(\n        '[ImagesProgressionTracker] Failed to save milestones',\n        error\n      );\n    }\n  }\n\n  /**\n   * Reset all milestones\n   */\n  resetMilestones(): void {\n    IMAGES_MILESTONES.forEach(m => {\n      this.milestones.set(m.id, {\n        ...m,\n        completed: false,\n        completedAt: undefined,\n      });\n    });\n    this.saveMilestones();\n  }\n}\n\nexport function createImagesProgressionTracker(\n  progress: OnboardingProgress | null\n): ImagesProgressionTracker {\n  return new ImagesProgressionTracker(progress);\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/onboarding/images-mvp/images-tour.steps.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'OnboardingStep' is defined but never used.","line":8,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Images MVP Tour Steps\n * Purpose-driven onboarding for Images MVP (privacy, photography, authenticity)\n */\n\nimport type {\n  OnboardingTutorial,\n  OnboardingStep,\n} from '@/lib/onboarding/onboarding-engine';\n\nexport const IMAGES_PRIVACY_TUTORIAL: OnboardingTutorial = {\n  id: 'images-privacy-tour',\n  name: 'Privacy Check',\n  description: 'Protect your privacy by checking image metadata',\n  uiVersion: 'images-mvp',\n  difficulty: 'beginner',\n  estimatedDuration: 3,\n  steps: [\n    {\n      id: 'privacy-welcome',\n      title: 'Check Your Privacy',\n      description: 'See what personal information is in your photos.',\n      position: 'center',\n      skippable: false,\n      duration: 8,\n    },\n    {\n      id: 'privacy-upload',\n      title: 'Upload a Photo',\n      description:\n        'Drop your photo here to check for GPS, timestamps, and camera info.',\n      target: '[data-testid=\"images-upload\"]',\n      position: 'top',\n      action: 'click',\n      skippable: false,\n      duration: 30,\n    },\n    {\n      id: 'privacy-tab',\n      title: 'Privacy Tab',\n      description:\n        'View all privacy-sensitive metadata like location and timestamps.',\n      target: '[data-testid=\"tab-privacy\"]',\n      position: 'bottom',\n      skippable: false,\n      duration: 15,\n    },\n    {\n      id: 'burn-in',\n      title: 'Burned-in Text',\n      description: 'We check for text burned into image pixels.',\n      target: '[data-testid=\"burned-text\"]',\n      position: 'left',\n      skippable: true,\n      duration: 15,\n    },\n    {\n      id: 'privacy-complete',\n      title: 'Privacy Check Complete',\n      description:\n        'You now know what personal data your photos contain. Clean them before sharing!',\n      position: 'center',\n      skippable: false,\n      duration: 8,\n    },\n  ],\n};\n\nexport const IMAGES_PHOTOGRAPHY_TUTORIAL: OnboardingTutorial = {\n  id: 'images-photography-tour',\n  name: 'Photography Insights',\n  description: 'Analyze camera settings and photo metadata',\n  uiVersion: 'images-mvp',\n  difficulty: 'beginner',\n  estimatedDuration: 3,\n  steps: [\n    {\n      id: 'photo-welcome',\n      title: 'Photography Mode',\n      description: 'Explore camera settings and learn from your photos.',\n      position: 'center',\n      skippable: false,\n      duration: 8,\n    },\n    {\n      id: 'photo-upload',\n      title: 'Upload a Photo',\n      description: 'Drop a photo to see camera settings and lens info.',\n      target: '[data-testid=\"images-upload\"]',\n      position: 'top',\n      action: 'click',\n      skippable: false,\n      duration: 30,\n    },\n    {\n      id: 'photo-tab',\n      title: 'Photography Tab',\n      description: 'View camera settings, exposure data, and more.',\n      target: '[data-testid=\"tab-photography\"]',\n      position: 'bottom',\n      skippable: false,\n      duration: 15,\n    },\n    {\n      id: 'quality',\n      title: 'Quality Score',\n      description: \"See how complete your photo's metadata is.\",\n      target: '[data-testid=\"quality-indicator\"]',\n      position: 'left',\n      skippable: true,\n      duration: 15,\n    },\n    {\n      id: 'photo-complete',\n      title: 'Photography Mode Complete',\n      description:\n        'Use this mode to learn about camera settings and improve your photography!',\n      position: 'center',\n      skippable: false,\n      duration: 8,\n    },\n  ],\n};\n\nexport const IMAGES_AUTHENTICITY_TUTORIAL: OnboardingTutorial = {\n  id: 'images-authenticity-tour',\n  name: 'Authenticity Check',\n  description: 'Verify if photos have been tampered with',\n  uiVersion: 'images-mvp',\n  difficulty: 'intermediate',\n  estimatedDuration: 4,\n  steps: [\n    {\n      id: 'auth-welcome',\n      title: 'Authenticity Mode',\n      description: 'Detect if a photo has been edited or tampered with.',\n      position: 'center',\n      skippable: false,\n      duration: 8,\n    },\n    {\n      id: 'auth-upload',\n      title: 'Upload a Photo',\n      description: 'Upload to check for inconsistencies and tampering signs.',\n      target: '[data-testid=\"images-upload\"]',\n      position: 'top',\n      action: 'click',\n      skippable: false,\n      duration: 30,\n    },\n    {\n      id: 'auth-tab',\n      title: 'Authenticity Tab',\n      description: 'View authenticity analysis and warnings.',\n      target: '[data-testid=\"tab-authenticity\"]',\n      position: 'bottom',\n      skippable: false,\n      duration: 15,\n    },\n    {\n      id: 'comparison',\n      title: 'Metadata Comparison',\n      description: 'Compare embedded vs burned-in metadata for tampering.',\n      target: '[data-testid=\"metadata-comparison\"]',\n      position: 'left',\n      skippable: true,\n      duration: 20,\n    },\n    {\n      id: 'auth-complete',\n      title: 'Authenticity Check Complete',\n      description:\n        'You can now verify photo authenticity. Great for forensic work!',\n      position: 'center',\n      skippable: false,\n      duration: 8,\n    },\n  ],\n};\n\nexport const IMAGES_MVP_TUTORIALS: OnboardingTutorial[] = [\n  IMAGES_PRIVACY_TUTORIAL,\n  IMAGES_PHOTOGRAPHY_TUTORIAL,\n  IMAGES_AUTHENTICITY_TUTORIAL,\n];\n\nexport function getImagesTutorialByPurpose(\n  purpose: 'privacy' | 'photography' | 'authenticity'\n): OnboardingTutorial | undefined {\n  switch (purpose) {\n    case 'privacy':\n      return IMAGES_PRIVACY_TUTORIAL;\n    case 'photography':\n      return IMAGES_PHOTOGRAPHY_TUTORIAL;\n    case 'authenticity':\n      return IMAGES_AUTHENTICITY_TUTORIAL;\n  }\n}\n\nexport function getAllImagesMvpTutorials(): OnboardingTutorial[] {\n  return IMAGES_MVP_TUTORIALS;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/onboarding/images-mvp/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/onboarding/original/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/onboarding/original/original-help-content.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/onboarding/original/original-progression-tracker.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":248,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":248,"endColumn":20,"suggestions":[{"fix":{"range":[6326,6431],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":265,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":265,"endColumn":20,"suggestions":[{"fix":{"range":[6681,6786],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Original UI Progression Tracker\n * Tracks feature unlock, milestones, and achievements for Original UI\n */\n\nimport type { OnboardingProgress } from '@/lib/onboarding/onboarding-engine';\n\nexport interface ProgressionMilestone {\n  id: string;\n  name: string;\n  description: string;\n  requiredSteps: number;\n  reward: string;\n  unlockedFeatures: string[];\n}\n\nexport interface Achievement {\n  id: string;\n  name: string;\n  description: string;\n  icon: string;\n  unlocked: boolean;\n  unlockedAt?: number;\n}\n\nexport const ORIGINAL_MILESTONES: ProgressionMilestone[] = [\n  {\n    id: 'first-upload',\n    name: 'First Upload',\n    description: 'Upload your first file to extract metadata',\n    requiredSteps: 1,\n    reward: 'Explorer Badge',\n    unlockedFeatures: ['basic-extraction'],\n  },\n  {\n    id: 'gps-discovery',\n    name: 'GPS Explorer',\n    description: 'View GPS location data for the first time',\n    requiredSteps: 4,\n    reward: 'Navigator Badge',\n    unlockedFeatures: ['gps-visualization'],\n  },\n  {\n    id: 'exif-master',\n    name: 'EXIF Master',\n    description: 'Successfully view EXIF camera settings',\n    requiredSteps: 5,\n    reward: 'Photographer Badge',\n    unlockedFeatures: ['advanced-exif-analysis'],\n  },\n  {\n    id: 'forensic-beginner',\n    name: 'Forensic Beginner',\n    description: 'Explore advanced forensic features like metadata comparison',\n    requiredSteps: 12,\n    reward: 'Investigator Badge',\n    unlockedFeatures: ['forensic-tools', 'metadata-comparison'],\n  },\n  {\n    id: 'data-exporter',\n    name: 'Data Exporter',\n    description: 'Export metadata in at least one format',\n    requiredSteps: 7,\n    reward: 'Exporter Badge',\n    unlockedFeatures: ['export-options', 'batch-export'],\n  },\n  {\n    id: 'batch-processor',\n    name: 'Batch Processor',\n    description: 'Process multiple files in a single session',\n    requiredSteps: 15,\n    reward: 'Efficiency Badge',\n    unlockedFeatures: ['batch-upload', 'parallel-processing'],\n  },\n  {\n    id: 'power-user',\n    name: 'Power User',\n    description: 'Complete all basic tour steps and explore advanced features',\n    requiredSteps: 20,\n    reward: 'Power User Badge',\n    unlockedFeatures: ['all-basic-features', 'advanced-features-unlocked'],\n  },\n];\n\nexport const ORIGINAL_ACHIEVEMENTS: Achievement[] = [\n  {\n    id: 'metadata-novice',\n    name: 'Metadata Novice',\n    description: 'Complete 1 file extraction',\n    icon: '',\n    unlocked: false,\n  },\n  {\n    id: 'metadata-explorer',\n    name: 'Metadata Explorer',\n    description: 'Complete 5 file extractions',\n    icon: '',\n    unlocked: false,\n  },\n  {\n    id: 'gps-hunter',\n    name: 'GPS Hunter',\n    description: 'View GPS data in 10 files',\n    icon: '',\n    unlocked: false,\n  },\n  {\n    id: 'forensic-detective',\n    name: 'Forensic Detective',\n    description: 'Use metadata comparison 5 times',\n    icon: '',\n    unlocked: false,\n  },\n  {\n    id: 'batch-master',\n    name: 'Batch Master',\n    description: 'Process 50 files in batch mode',\n    icon: '',\n    unlocked: false,\n  },\n  {\n    id: 'metadata-virtuoso',\n    name: 'Metadata Virtuoso',\n    description: 'Extract metadata from 100 different files',\n    icon: '',\n    unlocked: false,\n  },\n  {\n    id: 'metaextract-expert',\n    name: 'MetaExtract Expert',\n    description: 'Complete all tutorials and unlock all features',\n    icon: '',\n    unlocked: false,\n  },\n];\n\nexport class OriginalProgressionTracker {\n  private progress: OnboardingProgress | null = null;\n  private achievements: Achievement[];\n\n  constructor(progress: OnboardingProgress | null) {\n    this.progress = progress;\n    this.achievements = ORIGINAL_ACHIEVEMENTS.map(a => ({\n      ...a,\n      unlocked: false,\n    }));\n    this.loadAchievements();\n  }\n\n  /**\n   * Calculate completion percentage\n   */\n  getCompletionPercentage(): number {\n    if (!this.progress) return 0;\n    return (\n      (this.progress.totalStepsCompleted / ORIGINAL_MILESTONES.length) * 100\n    );\n  }\n\n  /**\n   * Get next milestone\n   */\n  getNextMilestone(): ProgressionMilestone | null {\n    const completedSteps = this.progress?.totalStepsCompleted ?? 0;\n    return (\n      ORIGINAL_MILESTONES.find(m => m.requiredSteps > completedSteps) || null\n    );\n  }\n\n  /**\n   * Check if milestone is complete\n   */\n  isMilestoneComplete(milestoneId: string): boolean {\n    const milestone = ORIGINAL_MILESTONES.find(m => m.id === milestoneId);\n    if (!milestone || !this.progress) return false;\n    return this.progress.totalStepsCompleted >= milestone.requiredSteps;\n  }\n\n  /**\n   * Update achievement status\n   */\n  updateAchievement(achievementId: string, unlocked: boolean): void {\n    const achievement = this.achievements.find(a => a.id === achievementId);\n    if (achievement) {\n      achievement.unlocked = unlocked;\n      achievement.unlockedAt = unlocked ? Date.now() : undefined;\n      this.saveAchievements();\n    }\n  }\n\n  /**\n   * Get unlocked achievements\n   */\n  getUnlockedAchievements(): Achievement[] {\n    return this.achievements.filter(a => a.unlocked);\n  }\n\n  /**\n   * Get locked achievements\n   */\n  getLockedAchievements(): Achievement[] {\n    return this.achievements.filter(a => !a.unlocked);\n  }\n\n  /**\n   * Check if feature is unlocked\n   */\n  isFeatureUnlocked(featureId: string): boolean {\n    const unlockedFeatures = new Set<string>();\n    const completedSteps = this.progress?.totalStepsCompleted ?? 0;\n\n    ORIGINAL_MILESTONES.forEach(milestone => {\n      if (completedSteps >= milestone.requiredSteps) {\n        milestone.unlockedFeatures.forEach(f => unlockedFeatures.add(f));\n      }\n    });\n\n    return unlockedFeatures.has(featureId);\n  }\n\n  /**\n   * Get recommended next tutorial\n   */\n  getRecommendedTutorial(): string | null {\n    const completedSteps = this.progress?.totalStepsCompleted ?? 0;\n\n    if (completedSteps === 0) {\n      return 'original-basic-tour';\n    } else if (completedSteps < 7) {\n      return 'original-basic-tour';\n    } else if (completedSteps < 20) {\n      return 'original-advanced-tour';\n    }\n\n    return null;\n  }\n\n  /**\n   * Load achievements from localStorage\n   */\n  private loadAchievements(): void {\n    try {\n      const stored = localStorage.getItem('original_achievements');\n      if (stored) {\n        this.achievements = JSON.parse(stored);\n      }\n    } catch (error) {\n      console.error(\n        '[OriginalProgressionTracker] Failed to load achievements',\n        error\n      );\n    }\n  }\n\n  /**\n   * Save achievements to localStorage\n   */\n  private saveAchievements(): void {\n    try {\n      localStorage.setItem(\n        'original_achievements',\n        JSON.stringify(this.achievements)\n      );\n    } catch (error) {\n      console.error(\n        '[OriginalProgressionTracker] Failed to save achievements',\n        error\n      );\n    }\n  }\n\n  /**\n   * Reset all achievements\n   */\n  resetAchievements(): void {\n    this.achievements = ORIGINAL_ACHIEVEMENTS.map(a => ({\n      ...a,\n      unlocked: false,\n    }));\n    this.saveAchievements();\n  }\n}\n\nexport function createOriginalProgressionTracker(\n  progress: OnboardingProgress | null\n): OriginalProgressionTracker {\n  return new OriginalProgressionTracker(progress);\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/onboarding/original/original-tour.steps.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'OnboardingStep' is defined but never used.","line":8,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Original UI Tour Steps\n * Comprehensive onboarding for full-featured UI\n */\n\nimport type {\n  OnboardingTutorial,\n  OnboardingStep,\n} from '@/lib/onboarding/onboarding-engine';\n\nexport const ORIGINAL_BASIC_TOUR: OnboardingTutorial = {\n  id: 'original-basic-tour',\n  name: 'Basic Tour',\n  description: 'Learn fundamentals of metadata extraction',\n  uiVersion: 'original',\n  difficulty: 'beginner',\n  estimatedDuration: 5,\n  steps: [\n    {\n      id: 'welcome',\n      title: 'Welcome to MetaExtract',\n      description:\n        \"This tour will guide you through extracting metadata from your files. Let's get started!\",\n      position: 'center',\n      skippable: false,\n      duration: 10,\n    },\n    {\n      id: 'upload-file',\n      title: 'Upload a File',\n      description:\n        'Click or drag and drop a file here to extract its metadata. We support images, documents, videos, and more.',\n      target: '[data-testid=\"upload-zone\"]',\n      position: 'top',\n      action: 'click',\n      skippable: false,\n      duration: 30,\n    },\n    {\n      id: 'view-results',\n      title: 'View Results',\n      description:\n        'Your extracted metadata will appear here. We organize it into easy-to-understand sections.',\n      target: '[data-testid=\"results-container\"]',\n      position: 'top',\n      skippable: false,\n      duration: 15,\n    },\n    {\n      id: 'explore-gps',\n      title: 'GPS Location',\n      description:\n        'See where your photo was taken. This shows camera location data embedded in your image.',\n      target: '[data-testid=\"gps-section\"]',\n      position: 'left',\n      skippable: true,\n      duration: 20,\n    },\n    {\n      id: 'check-exif',\n      title: 'Camera Settings',\n      description:\n        'View camera settings like aperture, ISO, and shutter speed. Great for photographers!',\n      target: '[data-testid=\"exif-section\"]',\n      position: 'left',\n      skippable: true,\n      duration: 20,\n    },\n    {\n      id: 'explore-filesystem',\n      title: 'File System',\n      description:\n        'View file system metadata like creation and modification dates.',\n      target: '[data-testid=\"filesystem-section\"]',\n      position: 'left',\n      skippable: true,\n      duration: 15,\n    },\n    {\n      id: 'download-results',\n      title: 'Download Results',\n      description:\n        'Save your extracted metadata as JSON or PDF for your records.',\n      target: '[data-testid=\"download-button\"]',\n      position: 'top',\n      skippable: true,\n      duration: 15,\n    },\n    {\n      id: 'tour-complete',\n      title: \"You're All Set!\",\n      description:\n        \"You've completed the basic tour. Upload any file to start extracting metadata!\",\n      position: 'center',\n      skippable: false,\n      duration: 10,\n    },\n  ],\n};\n\nexport const ORIGINAL_ADVANCED_TOUR: OnboardingTutorial = {\n  id: 'original-advanced-tour',\n  name: 'Advanced Features',\n  description: 'Learn about powerful features for professionals',\n  uiVersion: 'original',\n  difficulty: 'intermediate',\n  estimatedDuration: 10,\n  steps: [\n    {\n      id: 'advanced-welcome',\n      title: 'Advanced Features',\n      description:\n        'Discover powerful tools for forensic analysis and professional workflows.',\n      position: 'center',\n      skippable: false,\n      duration: 10,\n    },\n    {\n      id: 'burned-metadata',\n      title: 'Burned-in Metadata',\n      description:\n        'We can extract text from image pixels using OCR technology.',\n      target: '[data-testid=\"burned-metadata\"]',\n      position: 'left',\n      skippable: true,\n      duration: 20,\n    },\n    {\n      id: 'metadata-comparison',\n      title: 'Metadata Comparison',\n      description:\n        'Compare embedded metadata with burned-in text to detect tampering.',\n      target: '[data-testid=\"metadata-comparison\"]',\n      position: 'left',\n      skippable: true,\n      duration: 20,\n    },\n    {\n      id: 'file-integrity',\n      title: 'File Integrity',\n      description: 'View cryptographic hashes to verify file authenticity.',\n      target: '[data-testid=\"file-integrity\"]',\n      position: 'left',\n      skippable: true,\n      duration: 15,\n    },\n    {\n      id: 'filters-and-search',\n      title: 'Filters & Search',\n      description:\n        'Use powerful search and filter tools to find specific metadata.',\n      target: '[data-testid=\"search-bar\"]',\n      position: 'top',\n      skippable: true,\n      duration: 15,\n    },\n    {\n      id: 'export-options',\n      title: 'Export Options',\n      description:\n        'Choose from multiple export formats including CSV, JSON, and PDF.',\n      target: '[data-testid=\"export-menu\"]',\n      position: 'top',\n      skippable: true,\n      duration: 15,\n    },\n    {\n      id: 'batch-operations',\n      title: 'Batch Operations',\n      description: 'Process multiple files at once with batch upload.',\n      target: '[data-testid=\"batch-upload\"]',\n      position: 'top',\n      skippable: true,\n      duration: 20,\n    },\n    {\n      id: 'advanced-complete',\n      title: 'Advanced Complete!',\n      description: 'You now know about advanced forensic features. Great job!',\n      position: 'center',\n      skippable: false,\n      duration: 10,\n    },\n  ],\n};\n\nexport const ORIGINAL_TUTORIALS: OnboardingTutorial[] = [\n  ORIGINAL_BASIC_TOUR,\n  ORIGINAL_ADVANCED_TOUR,\n];\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/onboarding/v2/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/onboarding/v2/v2-help-content.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/onboarding/v2/v2-progression-tracker.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":133,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":133,"endColumn":20,"suggestions":[{"fix":{"range":[3153,3226],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":145,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":145,"endColumn":20,"suggestions":[{"fix":{"range":[3484,3557],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * V2 UI Progression Tracker\n * Lightweight progression tracking for minimalist V2 UI\n */\n\nimport type { OnboardingProgress } from '@/lib/onboarding/onboarding-engine';\n\nexport interface V2Milestone {\n  id: string;\n  name: string;\n  description: string;\n  completed: boolean;\n  completedAt?: number;\n}\n\nexport const V2_MILESTONES: V2Milestone[] = [\n  {\n    id: 'first-upload',\n    name: 'First Upload',\n    description: 'Upload your first file with V2',\n    completed: false,\n  },\n  {\n    id: 'five-extractions',\n    name: '5 Extractions',\n    description: 'Complete 5 file extractions',\n    completed: false,\n  },\n  {\n    id: 'privacy-check',\n    name: 'Privacy Check',\n    description: 'Review privacy data for a file',\n    completed: false,\n  },\n  {\n    id: 'download-results',\n    name: 'Download Results',\n    description: 'Download extraction results',\n    completed: false,\n  },\n  {\n    id: 'v2-master',\n    name: 'V2 Master',\n    description: 'Complete all V2 milestones',\n    completed: false,\n  },\n];\n\nexport class V2ProgressionTracker {\n  private progress: OnboardingProgress | null = null;\n  private milestones: Map<string, V2Milestone>;\n\n  constructor(progress: OnboardingProgress | null) {\n    this.progress = progress;\n    this.milestones = new Map(\n      V2_MILESTONES.map(m => [m.id, { ...m, completed: false }])\n    );\n    this.loadMilestones();\n  }\n\n  /**\n   * Get completion percentage\n   */\n  getCompletionPercentage(): number {\n    const completedCount = Array.from(this.milestones.values()).filter(\n      m => m.completed\n    ).length;\n    return (completedCount / V2_MILESTONES.length) * 100;\n  }\n\n  /**\n   * Mark milestone complete\n   */\n  completeMilestone(milestoneId: string): void {\n    const milestone = this.milestones.get(milestoneId);\n    if (milestone) {\n      milestone.completed = true;\n      milestone.completedAt = Date.now();\n      this.saveMilestones();\n    }\n  }\n\n  /**\n   * Check if milestone is complete\n   */\n  isMilestoneComplete(milestoneId: string): boolean {\n    const milestone = this.milestones.get(milestoneId);\n    return milestone?.completed ?? false;\n  }\n\n  /**\n   * Get next uncompleted milestone\n   */\n  getNextMilestone(): V2Milestone | null {\n    const uncompleted = Array.from(this.milestones.values()).filter(\n      m => !m.completed\n    );\n    return uncompleted.length > 0 ? uncompleted[0] : null;\n  }\n\n  /**\n   * Get all milestones\n   */\n  getAllMilestones(): V2Milestone[] {\n    return Array.from(this.milestones.values());\n  }\n\n  /**\n   * Get completed milestones\n   */\n  getCompletedMilestones(): V2Milestone[] {\n    return Array.from(this.milestones.values()).filter(m => m.completed);\n  }\n\n  /**\n   * Get pending milestones\n   */\n  getPendingMilestones(): V2Milestone[] {\n    return Array.from(this.milestones.values()).filter(m => !m.completed);\n  }\n\n  /**\n   * Load milestones from localStorage\n   */\n  private loadMilestones(): void {\n    try {\n      const stored = localStorage.getItem('v2_milestones');\n      if (stored) {\n        const loaded: V2Milestone[] = JSON.parse(stored);\n        loaded.forEach(m => this.milestones.set(m.id, m));\n      }\n    } catch (error) {\n      console.error('[V2ProgressionTracker] Failed to load milestones', error);\n    }\n  }\n\n  /**\n   * Save milestones to localStorage\n   */\n  private saveMilestones(): void {\n    try {\n      const data = Array.from(this.milestones.values());\n      localStorage.setItem('v2_milestones', JSON.stringify(data));\n    } catch (error) {\n      console.error('[V2ProgressionTracker] Failed to save milestones', error);\n    }\n  }\n\n  /**\n   * Reset all milestones\n   */\n  resetMilestones(): void {\n    V2_MILESTONES.forEach(m => {\n      this.milestones.set(m.id, {\n        ...m,\n        completed: false,\n        completedAt: undefined,\n      });\n    });\n    this.saveMilestones();\n  }\n}\n\nexport function createV2ProgressionTracker(\n  progress: OnboardingProgress | null\n): V2ProgressionTracker {\n  return new V2ProgressionTracker(progress);\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/onboarding/v2/v2-tour.steps.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'OnboardingStep' is defined but never used.","line":8,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * V2 UI Tour Steps\n * Minimalist onboarding for V2 UI\n */\n\nimport type {\n  OnboardingTutorial,\n  OnboardingStep,\n} from '@/lib/onboarding/onboarding-engine';\n\nexport const V2_QUICK_START: OnboardingTutorial = {\n  id: 'v2-quick-start',\n  name: 'Quick Start',\n  description: 'Get started with V2 in 2 minutes',\n  uiVersion: 'v2',\n  difficulty: 'beginner',\n  estimatedDuration: 2,\n  steps: [\n    {\n      id: 'v2-welcome',\n      title: 'Welcome to MetaExtract V2',\n      description: 'A cleaner, faster way to extract metadata.',\n      position: 'center',\n      skippable: false,\n      duration: 5,\n    },\n    {\n      id: 'v2-upload',\n      title: 'Upload',\n      description: 'Drop a file or click to upload.',\n      target: '[data-testid=\"v2-upload\"]',\n      position: 'top',\n      action: 'click',\n      skippable: false,\n      duration: 30,\n    },\n    {\n      id: 'v2-results',\n      title: 'Your Results',\n      description: 'Key findings appear here for quick insights.',\n      target: '[data-testid=\"v2-results\"]',\n      position: 'top',\n      skippable: false,\n      duration: 15,\n    },\n    {\n      id: 'v2-done',\n      title: 'Ready!',\n      description: \"You're all set. Start exploring!\",\n      position: 'center',\n      skippable: false,\n      duration: 5,\n    },\n  ],\n};\n\nexport const V2_TUTORIALS: OnboardingTutorial[] = [V2_QUICK_START];\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/privacy-policy.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cn' is defined but never used.","line":13,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'theme' is assigned a value but never used.","line":16,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":16},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":37,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":37,"endColumn":20,"suggestions":[{"fix":{"range":[1261,1314],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/*\n * Privacy Policy Page Component\n * Displays the privacy policy for MetaExtract\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { Link } from 'react-router-dom';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { useTheme } from 'next-themes';\nimport { Shield, FileText, Download, ExternalLink } from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\nexport default function PrivacyPolicyPage() {\n  const { theme } = useTheme();\n  const [policyContent, setPolicyContent] = useState('');\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    // In a real implementation, this would fetch from the API\n    // For now, we'll use a static version\n    fetchPrivacyPolicy();\n  }, []);\n\n  const fetchPrivacyPolicy = async () => {\n    try {\n      // Simulate API call\n      const response = await fetch('/api/legal/privacy');\n      if (!response.ok) {\n        throw new Error('Failed to fetch privacy policy');\n      }\n      const data = await response.json();\n      setPolicyContent(data.content);\n    } catch (err) {\n      console.error('Error fetching privacy policy:', err);\n      setError('Could not load privacy policy. Please try again later.');\n      // Use a default policy content as fallback\n      setPolicyContent(defaultPrivacyPolicyContent);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleDownload = () => {\n    // Create a blob with the policy content and download it\n    const blob = new Blob([policyContent], { type: 'text/plain' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = 'metaextract-privacy-policy.txt';\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4\"></div>\n          <p className=\"text-gray-600 dark:text-gray-400\">Loading privacy policy...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 p-4\">\n        <Card className=\"w-full max-w-4xl\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2 text-red-600\">\n              <Shield className=\"w-5 h-5\" />\n              Privacy Policy Error\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-red-500 mb-4\">{error}</p>\n            <p className=\"text-gray-600 dark:text-gray-400 mb-6\">\n              Please try again later or contact support if the problem persists.\n            </p>\n            <Button onClick={() => window.location.reload()}>\n              Retry Loading\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 py-12 px-4\">\n      <div className=\"max-w-4xl mx-auto\">\n        <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-2\">\n              <Shield className=\"w-8 h-8 text-blue-600\" />\n              Privacy Policy\n            </h1>\n            <p className=\"text-gray-600 dark:text-gray-400 mt-2\">\n              Last Updated: {new Date().toLocaleDateString()}\n            </p>\n          </div>\n          <Button onClick={handleDownload} variant=\"outline\" className=\"flex items-center gap-2\">\n            <Download className=\"w-4 h-4\" />\n            Download\n          </Button>\n        </div>\n\n        <Card className=\"shadow-lg\">\n          <CardHeader className=\"border-b border-gray-200 dark:border-gray-700\">\n            <CardTitle className=\"text-xl text-gray-800 dark:text-gray-200\">\n              Your Privacy Rights\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"p-6\">\n            <ScrollArea className=\"h-[60vh] pr-4\">\n              <div className=\"prose prose-gray dark:prose-invert max-w-none\">\n                <div dangerouslySetInnerHTML={{ __html: policyContent }} />\n              </div>\n            </ScrollArea>\n          </CardContent>\n        </Card>\n\n        <div className=\"mt-8 flex flex-wrap gap-4 justify-center\">\n          <Button variant=\"outline\" asChild>\n            <Link to=\"/terms\" className=\"flex items-center gap-2\">\n              <FileText className=\"w-4 h-4\" />\n              Terms of Service\n            </Link>\n          </Button>\n          <Button variant=\"outline\" asChild>\n            <a\n              href=\"mailto:support@metaextract.com?subject=MetaExtract%20Support\"\n              className=\"flex items-center gap-2\"\n            >\n              <ExternalLink className=\"w-4 h-4\" />\n              Contact Support\n            </a>\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// Default privacy policy content as fallback\nconst defaultPrivacyPolicyContent = `\n<h1>Privacy Policy for MetaExtract</h1>\n\n<p><strong>Last Updated:</strong> ${new Date().toISOString().split('T')[0]}</p>\n\n<h2>Information We Collect</h2>\n<p>We collect the following types of information when you use our service:</p>\n\n<h3>File Data</h3>\n<ul>\n<li>Metadata from uploaded files (EXIF, IPTC, XMP, etc.)</li>\n<li>File hashes for integrity verification</li>\n<li>File type, size, and basic properties</li>\n<li>Processing results and analysis</li>\n</ul>\n\n<h3>Technical Information</h3>\n<ul>\n<li>IP address and browser information</li>\n<li>Device type and operating system</li>\n<li>Timestamps of file uploads and downloads</li>\n<li>Usage patterns and feature preferences</li>\n</ul>\n\n<h3>Account Information</h3>\n<ul>\n<li>Email address and username</li>\n<li>Subscription tier and payment information</li>\n<li>Credit usage and transaction history</li>\n<li>Communication preferences</li>\n</ul>\n\n<h2>How We Use Your Information</h2>\n<p>We use your information for the following purposes:</p>\n\n<h3>Service Provision</h3>\n<ul>\n<li>To provide metadata extraction services</li>\n<li>To process and analyze your uploaded files</li>\n<li>To generate reports and results</li>\n<li>To maintain service functionality</li>\n</ul>\n\n<h3>Account Management</h3>\n<ul>\n<li>To authenticate and identify users</li>\n<li>To manage subscriptions and billing</li>\n<li>To track credit usage</li>\n<li>To provide customer support</li>\n</ul>\n\n<h3>Security and Compliance</h3>\n<ul>\n<li>To protect against unauthorized access</li>\n<li>To detect and prevent fraudulent activities</li>\n<li>To comply with legal obligations</li>\n<li>To maintain service integrity</li>\n</ul>\n\n<h2>Data Retention and Deletion</h2>\n\n<h3>File Data</h3>\n<ul>\n<li>Uploaded files are deleted immediately after processing</li>\n<li>Metadata results are retained for 30 days unless you have an active subscription</li>\n<li>For subscribed users, data retention follows your selected plan</li>\n</ul>\n\n<h3>Account Data</h3>\n<ul>\n<li>Account information is retained as long as your account remains active</li>\n<li>Upon account deletion, personal information is removed within 30 days</li>\n<li>Aggregated, anonymized data may be retained for service improvement</li>\n</ul>\n\n<h2>Your Rights</h2>\n<p>Under GDPR and other privacy laws, you have the following rights:</p>\n\n<h3>Right of Access</h3>\n<ul>\n<li>Request a copy of your personal data</li>\n<li>Know how your data is being used</li>\n<li>Receive information about data processing</li>\n</ul>\n\n<h3>Right to Rectification</h3>\n<ul>\n<li>Correct inaccurate personal data</li>\n<li>Complete incomplete personal data</li>\n<li>Update outdated information</li>\n</ul>\n\n<h3>Right to Erasure</h3>\n<ul>\n<li>Request deletion of your personal data</li>\n<li>Remove consent for data processing</li>\n<li>Close your account with data deletion</li>\n</ul>\n\n<h3>Right to Data Portability</h3>\n<ul>\n<li>Receive your personal data in a structured format</li>\n<li>Transfer your data to another service</li>\n<li>Obtain copies of your processed metadata</li>\n</ul>\n\n<h2>Security Measures</h2>\n<p>We implement appropriate technical and organizational measures to ensure a level of security appropriate to the risk, including:</p>\n\n<h3>Technical Safeguards</h3>\n<ul>\n<li>Encryption in transit (TLS 1.3)</li>\n<li>Secure file processing (temporary storage only)</li>\n<li>Regular security assessments</li>\n<li>Access controls and authentication</li>\n</ul>\n\n<h3>Organizational Safeguards</h3>\n<ul>\n<li>Employee confidentiality agreements</li>\n<li>Regular security training</li>\n<li>Incident response procedures</li>\n<li>Third-party security reviews</li>\n</ul>\n\n<h2>Data Sharing and Disclosure</h2>\n<p>We do not sell, trade, or rent your personal identification information to others. We may share your information in the following situations:</p>\n\n<h3>Service Providers</h3>\n<ul>\n<li>Cloud infrastructure providers</li>\n<li>Payment processors</li>\n<li>Analytics services</li>\n<li>Customer support platforms</li>\n</ul>\n\n<h3>Legal Requirements</h3>\n<ul>\n<li>Compliance with legal obligations</li>\n<li>Protection of our rights</li>\n<li>Response to legal requests</li>\n<li>Prevention of fraud</li>\n</ul>\n\n<h2>International Transfers</h2>\n<p>If you are located outside the country where our servers are located, your information may be transferred to and processed in that country. We ensure appropriate safeguards are in place for international transfers.</p>\n\n<h2>Children's Privacy</h2>\n<p>Our service does not address anyone under the age of 13. We do not knowingly collect personal information from children under 13.</p>\n\n<h2>Changes to This Privacy Policy</h2>\n<p>We may update this privacy policy periodically. We will notify you of any changes by posting the new privacy policy on this page and updating the \"Last Updated\" date.</p>\n\n<h2>Contact Us</h2>\n<p>If you have questions about this privacy policy, please contact us at:</p>\n<p>Email: privacy@metaextract.com<br />\nAddress: [Company Address]</p>\n`;\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/reset-password.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2180,2183],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2180,2183],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\nimport { PublicLayout as Layout } from '@/components/public-layout';\nimport { Button } from '@/components/ui/button';\nimport { useAuth } from '@/lib/auth';\n\ntype RequestResponse = {\n  message?: string;\n  token?: string;\n};\n\nexport default function ResetPasswordPage() {\n  const { user } = useAuth();\n  const [email, setEmail] = useState('');\n  const [requested, setRequested] = useState(false);\n  const [token, setToken] = useState<string | null>(null);\n  const [newPassword, setNewPassword] = useState('');\n  const [confirmPassword, setConfirmPassword] = useState('');\n  const [status, setStatus] = useState<string | null>(null);\n  const [loading, setLoading] = useState(false);\n\n  useEffect(() => {\n    if (!email && user?.email) {\n      setEmail(user.email);\n    }\n  }, [email, user?.email]);\n\n  const requestReset = async () => {\n    setLoading(true);\n    setStatus(null);\n    try {\n      const res = await fetch('/api/auth/password-reset/request', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({ email }),\n      });\n      const data = (await res.json().catch(() => null)) as RequestResponse | null;\n      setRequested(true);\n      if (data?.token) setToken(data.token);\n      setStatus(data?.message || 'If an account exists, a reset link was sent.');\n    } catch {\n      setStatus('Failed to request password reset. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const confirmReset = async () => {\n    if (newPassword !== confirmPassword) {\n      setStatus('Passwords do not match.');\n      return;\n    }\n    if (!token) {\n      setStatus('Missing reset token.');\n      return;\n    }\n    setLoading(true);\n    setStatus(null);\n    try {\n      const res = await fetch('/api/auth/password-reset/confirm', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({ token, password: newPassword }),\n      });\n      const data = await res.json().catch(() => null);\n      if (!res.ok) {\n        setStatus((data as any)?.error || 'Password reset failed.');\n        return;\n      }\n      setStatus('Password updated. You can now sign in.');\n    } catch {\n      setStatus('Password reset failed. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <Layout showHeader={true} showFooter={true}>\n      <div className=\"min-h-screen bg-[#0B0C10] flex items-center justify-center px-4\">\n        <div className=\"max-w-md w-full\">\n          <h1 className=\"text-2xl font-bold text-white mb-2\">Reset password</h1>\n          <p className=\"text-sm text-slate-300 mb-6\">\n            Enter your email to request a password reset. In local dev, well show\n            the token on-screen.\n          </p>\n\n          <div className=\"space-y-3\">\n            <label className=\"text-xs text-slate-300\">Email</label>\n            <input\n              className=\"w-full px-3 py-2 bg-[#1A1A1A] border border-white/10 rounded-md text-sm text-white focus:ring-1 focus:ring-primary outline-none transition-all placeholder:text-slate-500\"\n              value={email}\n              onChange={(e) => setEmail(e.target.value)}\n              placeholder=\"you@example.com\"\n              autoComplete=\"email\"\n            />\n            <Button\n              className=\"w-full bg-primary text-black hover:bg-primary/90 font-semibold\"\n              disabled={loading || !email}\n              onClick={requestReset}\n            >\n              Request reset\n            </Button>\n          </div>\n\n          {requested && (\n            <div className=\"mt-6 space-y-3 rounded-lg border border-white/10 bg-white/5 p-4\">\n              <div className=\"text-sm font-semibold text-white\">Set new password</div>\n              <div className=\"text-xs text-slate-300\">\n                {token\n                  ? 'Dev token populated below.'\n                  : 'Check your email for a reset link/token.'}\n              </div>\n              <label className=\"text-xs text-slate-300\">Reset token</label>\n              <input\n                className=\"w-full px-3 py-2 bg-[#1A1A1A] border border-white/10 rounded-md text-sm text-white focus:ring-1 focus:ring-primary outline-none transition-all placeholder:text-slate-500\"\n                value={token || ''}\n                onChange={(e) => setToken(e.target.value)}\n                placeholder=\"token\"\n                autoComplete=\"off\"\n              />\n              <label className=\"text-xs text-slate-300\">New password</label>\n              <input\n                type=\"password\"\n                className=\"w-full px-3 py-2 bg-[#1A1A1A] border border-white/10 rounded-md text-sm text-white focus:ring-1 focus:ring-primary outline-none transition-all placeholder:text-slate-500\"\n                value={newPassword}\n                onChange={(e) => setNewPassword(e.target.value)}\n                placeholder=\"\"\n                autoComplete=\"new-password\"\n              />\n              <label className=\"text-xs text-slate-300\">Confirm password</label>\n              <input\n                type=\"password\"\n                className=\"w-full px-3 py-2 bg-[#1A1A1A] border border-white/10 rounded-md text-sm text-white focus:ring-1 focus:ring-primary outline-none transition-all placeholder:text-slate-500\"\n                value={confirmPassword}\n                onChange={(e) => setConfirmPassword(e.target.value)}\n                placeholder=\"\"\n                autoComplete=\"new-password\"\n              />\n              <Button\n                className=\"w-full bg-primary text-black hover:bg-primary/90 font-semibold\"\n                disabled={loading}\n                onClick={confirmReset}\n              >\n                Update password\n              </Button>\n            </div>\n          )}\n\n          {status && (\n            <div className=\"mt-4 text-xs text-slate-300\">{status}</div>\n          )}\n        </div>\n      </div>\n    </Layout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/results-v2.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'KeyFindings' is defined but never used.","line":5,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'KeyFindingsCompact' is defined but never used.","line":6,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1264,1267],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1264,1267],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1278,1281],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1278,1281],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1298,1301],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1298,1301],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1315,1318],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1315,1318],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1337,1340],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1337,1340],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":72,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":72,"endColumn":18,"suggestions":[{"fix":{"range":[2230,2295],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":75,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":75,"endColumn":18,"suggestions":[{"fix":{"range":[2390,2454],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":83,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":83,"endColumn":22,"suggestions":[{"fix":{"range":[2728,2782],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":89,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":89,"endColumn":24,"suggestions":[{"fix":{"range":[2935,2998],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":96,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":96,"endColumn":18,"suggestions":[{"fix":{"range":[3103,3166],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":100,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":100,"endColumn":18,"suggestions":[{"fix":{"range":[3267,3309],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":104,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":104,"endColumn":19,"suggestions":[{"fix":{"range":[3389,3461],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":158,"column":87,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":90,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5898,5901],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5898,5901],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":193,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":193,"endColumn":18,"suggestions":[{"fix":{"range":[7484,7577],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":204,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":204,"endColumn":22,"suggestions":[{"fix":{"range":[7810,7861],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":209,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":209,"endColumn":24,"suggestions":[{"fix":{"range":[7967,8024],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":18,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useMemo } from 'react';\nimport { useNavigate, useLocation, useSearchParams } from 'react-router-dom';\nimport { useToast } from '@/hooks/use-toast';\nimport {\n  KeyFindings,\n  KeyFindingsCompact,\n} from '@/components/v2-results/KeyFindings';\nimport {\n  ProgressiveDisclosure,\n  ProgressiveDisclosureMobile,\n  type ProgressiveDisclosureData,\n} from '@/components/v2-results/ProgressiveDisclosure';\nimport {\n    ActionsToolbar,\n    ActionsToolbarCompact,\n    ExpertView,\n  } from '@/components/v2-results';\n\nimport { Button } from '@/components/ui/button';\nimport { ArrowLeft, Download, FileText, Cpu, Smartphone } from 'lucide-react';\nimport generatedBackground from '@assets/generated_images/chaotic_dark_forensic_data_visualization_with_connecting_lines.png';\nimport { cn } from '@/lib/utils';\nimport { extractKeyFindings } from '@/utils/metadataTransformers';\nimport type { LocationData } from '@/components/v2-results/LocationSection';\n\ninterface MetadataResponse {\n  filename: string;\n  filesize: string;\n  filetype: string;\n  mime_type: string;\n  tier: string;\n  fields_extracted: number;\n  processing_ms: number;\n  file_integrity?: {\n    md5: string;\n    sha256: string;\n    sha1?: string;\n    crc32?: string;\n  };\n  gps?: any;\n  exif?: any;\n  filesystem?: any;\n  summary?: any;\n  [key: string]: any;\n}\n\nexport default function ResultsV2() {\n  const navigate = useNavigate();\n  const location = useLocation();\n  const [searchParams] = useSearchParams();\n  const resultId = searchParams.get('id');\n  const { toast } = useToast();\n  const [metadata, setMetadata] = useState<MetadataResponse | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [isMobile, setIsMobile] = useState(window.innerWidth < 768);\n\n  // Handle window resize for responsive design\n  useEffect(() => {\n    const handleResize = () => {\n      setIsMobile(window.innerWidth < 768);\n    };\n\n    window.addEventListener('resize', handleResize);\n    return () => window.removeEventListener('resize', handleResize);\n  }, []);\n\n  useEffect(() => {\n    // Priority 1: Load from navigation state (handles large payloads, fresh upload)\n    let metadataData = null;\n\n    if (location.state?.metadata) {\n      console.log('[ResultsV2] Loaded metadata from navigation state');\n      metadataData = location.state.metadata;\n    } else if (location.state?.results) {\n      console.log('[ResultsV2] Loaded results from navigation state');\n      metadataData = location.state.results;\n    } else {\n      // Priority 2: Try sessionStorage (V2 button uses this)\n      const stored = sessionStorage.getItem('currentMetadata');\n      if (stored) {\n        try {\n          metadataData = JSON.parse(stored);\n          console.log('[ResultsV2] Loaded from sessionStorage');\n          toast({\n            title: 'Using last result',\n            description: 'Loaded from memory.',\n          });\n        } catch (e) {\n          console.error('[ResultsV2] Failed to parse sessionStorage', e);\n        }\n      }\n    }\n\n    // Handle if data is an array\n    if (Array.isArray(metadataData)) {\n      console.log('[ResultsV2] Data is array, taking first element');\n      setMetadata(metadataData[0]);\n      setIsLoading(false);\n    } else if (metadataData) {\n      console.log('[ResultsV2] Data is object');\n      setMetadata(metadataData);\n      setIsLoading(false);\n    } else {\n      console.warn('[ResultsV2] No metadata in navigation or sessionStorage');\n      setIsLoading(false);\n    }\n  }, [location.state, toast]);\n\n  // Transform metadata for ProgressiveDisclosure\n  const progressiveDisclosureData =\n    useMemo<ProgressiveDisclosureData | null>(() => {\n      if (!metadata) return null;\n\n      // Extract key findings\n      const keyFindings = extractKeyFindings(metadata);\n\n      // Extract quick details\n      const quickDetails = {\n        resolution:\n          metadata.resolution ||\n          (metadata.exif?.image_width && metadata.exif?.image_height)\n            ? `${metadata.exif.image_width}x${metadata.exif.image_height}`\n            : undefined,\n        fileSize: metadata.filesize,\n        dimensions:\n          metadata.exif?.image_width && metadata.exif?.image_height\n            ? `${metadata.exif.image_width} x ${metadata.exif.image_height} pixels`\n            : undefined,\n        colorSpace: metadata.exif?.color_space,\n        iso: metadata.exif?.iso_speed,\n        focalLength: metadata.exif?.focal_length,\n        exposure: metadata.exif?.exposure_time,\n        aperture: metadata.exif?.f_number,\n      };\n\n      // Extract location data\n      const locationData: LocationData | undefined =\n        metadata.gps?.latitude && metadata.gps?.longitude\n          ? {\n              latitude: metadata.gps.latitude,\n              longitude: metadata.gps.longitude,\n            }\n          : undefined;\n\n      // Extract forensic analysis data if available\n      const forensicAnalysis = metadata.steganography_analysis || metadata.manipulation_detection || metadata.ai_detection\n        ? {\n            steganography: metadata.steganography_analysis ? {\n              detected: metadata.steganography_analysis.suspicious_score > 0.3,\n              confidence: Math.round((metadata.steganography_analysis.suspicious_score || 0) * 100),\n              methodsChecked: metadata.steganography_analysis.methods_checked || ['LSB Analysis', 'FFT Analysis'],\n              findings: metadata.steganography_analysis.findings || [],\n              details: metadata.steganography_analysis.analysis_details,\n            } : undefined,\n            manipulation: metadata.manipulation_detection ? {\n              detected: metadata.manipulation_detection.manipulation_probability > 0.5,\n              confidence: Math.round((metadata.manipulation_detection.manipulation_probability || 0) * 100),\n              indicators: metadata.manipulation_detection.indicators?.map((indicator: any) => ({\n                type: indicator.type || 'Manipulation',\n                severity: indicator.severity || (indicator.confidence > 0.7 ? 'high' : indicator.confidence > 0.4 ? 'medium' : 'low'),\n                description: indicator.description || 'Manipulation detected',\n                confidence: Math.round((indicator.confidence || 0) * 100),\n              })) || [],\n              originalityScore: metadata.manipulation_detection.originality_score ? Math.round(metadata.manipulation_detection.originality_score * 100) : undefined,\n            } : undefined,\n            aiDetection: metadata.ai_detection ? {\n              aiGenerated: metadata.ai_detection.ai_probability > 0.7,\n              confidence: Math.round((metadata.ai_detection.ai_probability || 0) * 100),\n              modelHints: metadata.ai_detection.model_hints || [],\n              detectionMethods: metadata.ai_detection.detection_methods || ['Neural Network Analysis'],\n            } : undefined,\n            authenticityScore: metadata.advanced_analysis?.forensic_score || metadata.forensic_score || 100,\n          }\n        : undefined;\n\n      // Extract advanced metadata (keep all original fields so advanced view is consistent)\n      const advancedMetadata = {\n        ...metadata,\n      };\n\n      return {\n        keyFindings,\n        quickDetails,\n        location: locationData,\n        advancedMetadata,\n        forensicAnalysis,\n      };\n    }, [metadata]);\n\n  // Priority 3: Fetch from DB if ID param exists and no data loaded yet\n  useEffect(() => {\n    if (resultId && !metadata) {\n      console.log(\n        `[ResultsV2] ID found in URL: ${resultId}. Fetching from DB...`\n      );\n      setIsLoading(true);\n\n      fetch(`/api/extract/results/${resultId}`)\n        .then(res => {\n          if (!res.ok) throw new Error('Result not found');\n          return res.json();\n        })\n        .then(data => {\n          console.log('[ResultsV2] Loaded metadata from DB');\n          setMetadata(data);\n          setIsLoading(false);\n        })\n        .catch(err => {\n          console.error('[ResultsV2] Failed to fetch by ID:', err);\n          toast({\n            title: 'Error loading result',\n            description: 'Could not load saved analysis.',\n            variant: 'destructive',\n          });\n          setIsLoading(false);\n          // Redirect to home after showing error\n          setTimeout(() => navigate('/'), 1500);\n        });\n    } else if (!metadata && !isLoading) {\n      // No data available from any source\n      toast({\n        title: 'No metadata found',\n        description: 'Please upload a file first.',\n        variant: 'destructive',\n      });\n      setTimeout(() => navigate('/'), 900);\n    }\n  }, [resultId, metadata, isLoading, navigate, toast]);\n\n  const handleDownload = () => {\n    if (!metadata) return;\n\n    const dataStr = JSON.stringify(metadata, null, 2);\n    const dataBlob = new Blob([dataStr], { type: 'application/json' });\n    const url = URL.createObjectURL(dataBlob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = `${metadata.filename}_metadata.json`;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    URL.revokeObjectURL(url);\n\n    toast({\n      title: 'Download started',\n      description: 'Your metadata file is being downloaded',\n    });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"relative min-h-screen overflow-hidden\">\n        <div className=\"absolute inset-0 z-0\">\n          <div className=\"absolute inset-0 bg-background/90 z-10\"></div>\n          <img\n            src={generatedBackground}\n            alt=\"\"\n            aria-hidden=\"true\"\n            className=\"w-full h-full object-cover opacity-10 mix-blend-screen scale-110\"\n          />\n        </div>\n        <div className=\"relative z-10 flex items-center justify-center min-h-screen\">\n          <div className=\"text-center\">\n            <div\n              className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4\"\n              role=\"status\"\n            >\n              <span className=\"sr-only\">Loading results...</span>\n            </div>\n            <p className=\"text-white font-mono\" aria-live=\"polite\">\n              Loading your results...\n            </p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!metadata) {\n    return (\n      <div className=\"relative min-h-screen overflow-hidden\">\n        <div className=\"absolute inset-0 z-0\">\n          <div className=\"absolute inset-0 bg-background/90 z-10\"></div>\n          <img\n            src={generatedBackground}\n            alt=\"\"\n            aria-hidden=\"true\"\n            className=\"w-full h-full object-cover opacity-10 mix-blend-screen scale-110\"\n          />\n        </div>\n        <div className=\"relative z-10 flex items-center justify-center min-h-screen\">\n          <div className=\"text-center\">\n            <h2 className=\"text-2xl font-bold text-white mb-4 font-mono\">\n              No Results Found\n            </h2>\n            <Button\n              onClick={() => navigate('/')}\n              variant=\"default\"\n              className=\"gap-2\"\n            >\n              <ArrowLeft className=\"w-4 h-4\" />\n              Go Home\n            </Button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"relative min-h-[calc(100vh-64px)] overflow-hidden\">\n      {/* Background */}\n      <div className=\"absolute inset-0 z-0 pointer-events-none\">\n        <div className=\"absolute inset-0 bg-background/90 z-10\"></div>\n        <img\n          src={generatedBackground}\n          alt=\"Background\"\n          className=\"w-full h-full object-cover opacity-10 mix-blend-screen scale-110\"\n        />\n      </div>\n\n      {/* Header */}\n      <div className=\"relative z-10 border-b border-white/10\">\n        <div className=\"container mx-auto px-4 py-4\">\n          <div className=\"flex items-center justify-between\">\n            <Button\n              variant=\"ghost\"\n              onClick={() => navigate('/')}\n              className=\"gap-2 text-white hover:text-white hover:bg-white/10 min-h-[44px]\"\n            >\n              <ArrowLeft className=\"w-4 h-4\" />\n              Back to Home\n            </Button>\n\n            <div className=\"flex gap-3\">\n              <div className=\"flex items-center gap-2 px-3 py-2 bg-blue-600/20 border border-blue-500/30 rounded text-blue-300 text-xs font-mono\">\n                <Cpu className=\"w-4 h-4\" aria-hidden=\"true\" />\n                V2 RESULTS\n              </div>\n\n              <Button\n                variant=\"outline\"\n                onClick={handleDownload}\n                className=\"gap-2 font-mono text-xs border-emerald-500/50 text-emerald-300 hover:bg-emerald-500/10 min-h-[44px]\"\n              >\n                <Download className=\"w-4 h-4\" aria-hidden=\"true\" />\n                JSON\n              </Button>\n              <Button\n                variant=\"outline\"\n                onClick={() => toast({ title: 'PDF export coming soon to V2' })}\n                className=\"gap-2 font-mono text-xs border-emerald-500/50 text-emerald-300 hover:bg-emerald-500/10 min-h-[44px]\"\n              >\n                <FileText className=\"w-4 h-4\" aria-hidden=\"true\" />\n                PDF\n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Main Content */}\n      <div className=\"container mx-auto px-4 py-8 relative z-10\">\n        <div className=\"max-w-7xl mx-auto space-y-8\">\n          {/* File Header - Matching forensic theme */}\n          <div className=\"flex items-center justify-between pb-6 border-b border-white/10\">\n            <div className=\"flex items-center gap-4 flex-1\">\n              <div className=\"w-12 h-12 bg-white/5 rounded border border-white/10 flex items-center justify-center flex-shrink-0\">\n                <Cpu className=\"w-6 h-6 text-primary\" aria-hidden=\"true\" />\n              </div>\n              <div className=\"min-w-0\">\n                <h1 className=\"text-xl font-bold text-white font-mono tracking-tight truncate\">\n                  {metadata.filename}\n                </h1>\n                <div\n                  className={cn(\n                    'text-xs text-slate-500 font-mono mt-1',\n                    isMobile ? 'flex flex-col gap-1' : 'flex gap-4'\n                  )}\n                >\n                  <span>SIZE: {metadata.filesize}</span>\n                  <span className=\"hidden sm:inline\">\n                    TYPE: {metadata.filetype}\n                  </span>\n                  <span className=\"text-primary hidden md:inline\">\n                    SHA256:{' '}\n                    {metadata.file_integrity?.sha256?.substring(0, 12) || 'N/A'}\n                    ...\n                  </span>\n                </div>\n              </div>\n            </div>\n            {isMobile && (\n              <div className=\"ml-2 flex-shrink-0\">\n                <Smartphone\n                  className=\"w-5 h-5 text-blue-400\"\n                  aria-hidden=\"true\"\n                />\n              </div>\n            )}\n          </div>\n\n          {/* Progressive Disclosure Section */}\n          {progressiveDisclosureData && (\n            <div\n              className={cn(\n                'bg-black/40 backdrop-blur-md border border-white/10 rounded-lg shadow-lg',\n                isMobile ? 'p-4' : 'p-6'\n              )}\n            >\n              {isMobile ? (\n                <ProgressiveDisclosureMobile \n                  data={progressiveDisclosureData} \n                  showForensicAnalysis={metadata?.tier === 'forensic' || metadata?.tier === 'enterprise' || metadata?.tier === 'professional' || import.meta.env.DEV}\n                />\n              ) : (\n                <ProgressiveDisclosure \n                  data={progressiveDisclosureData} \n                  showForensicAnalysis={metadata?.tier === 'forensic' || metadata?.tier === 'enterprise' || metadata?.tier === 'professional' || import.meta.env.DEV}\n                />\n              )}\n            </div>\n          )}\n\n            {/* Actions Toolbar */}\n            <div\n              className={cn(\n                'bg-black/40 backdrop-blur-md border border-white/10 rounded-lg shadow-lg'\n              )}\n            >\n              {isMobile ? (\n                <ActionsToolbarCompact\n                  filename={metadata.filename}\n                  metadata={metadata}\n                  className=\"m-4\"\n                />\n              ) : (\n                <ActionsToolbar\n                  filename={metadata.filename}\n                  metadata={metadata}\n                  className=\"p-6\"\n                />\n              )}\n            </div>\n\n            {/* Expert Registry View (v4.0 Launch Enhancement) */}\n            <ExpertView \n              metadata={metadata} \n              className=\"bg-black/40 backdrop-blur-md border border-white/10 rounded-lg shadow-lg\"\n            />\n          </div>\n        </div>\n      </div>\n\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/results.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Alert' is defined but never used.","line":30,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertDescription' is defined but never used.","line":30,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used.","line":51,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":51,"endColumn":13},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2747,2750],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2747,2750],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":89,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2765,2768],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2765,2768],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2787,2790],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2787,2790],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":126,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3708,3711],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3708,3711],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":127,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3743,3746],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3743,3746],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":128,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3771,3774],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3771,3774],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":129,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3810,3813],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3810,3813],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":130,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3843,3846],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3843,3846],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":131,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3872,3875],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3872,3875],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":132,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3906,3909],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3906,3909],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":133,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3940,3943],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3940,3943],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":134,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3982,3985],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3982,3985],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":135,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4011,4014],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4011,4014],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":136,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4039,4042],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4039,4042],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":137,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4079,4082],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4079,4082],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":138,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4123,4126],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4123,4126],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":139,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4164,4167],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4164,4167],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":140,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4201,4204],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4201,4204],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":141,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4235,4238],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4235,4238],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":142,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4268,4271],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4268,4271],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":143,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4303,4306],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4303,4306],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":144,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4348,4351],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4348,4351],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":145,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4391,4394],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4391,4394],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":146,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4427,4430],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4427,4430],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":147,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4465,4468],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4465,4468],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":148,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4503,4506],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4503,4506],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":149,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4544,4547],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4544,4547],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":150,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":150,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4580,4583],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4580,4583],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":151,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4623,4626],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4623,4626],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":152,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4662,4665],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4662,4665],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":153,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4704,4707],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4704,4707],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":154,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4742,4745],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4742,4745],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":155,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":155,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4773,4776],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4773,4776],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":156,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":156,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4813,4816],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4813,4816],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":157,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4853,4856],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4853,4856],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":158,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4901,4904],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4901,4904],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":159,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4949,4952],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4949,4952],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":160,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4987,4990],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4987,4990],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":161,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5030,5033],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5030,5033],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":162,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5066,5069],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5066,5069],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":163,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5107,5110],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5107,5110],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":164,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5140,5143],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5140,5143],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":165,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5185,5188],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5185,5188],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":178,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":178,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5642,5645],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5642,5645],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'resultId' is assigned a value but never used.","line":185,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":185,"endColumn":17},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":226,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":226,"endColumn":24,"suggestions":[{"fix":{"range":[7335,7399],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":228,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":228,"endColumn":25,"suggestions":[{"fix":{"range":[7460,7517],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":237,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":237,"endColumn":23,"suggestions":[{"fix":{"range":[7790,7840],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":241,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":241,"endColumn":22,"suggestions":[{"fix":{"range":[7910,7967],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":260,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":260,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8560,8563],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8560,8563],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":261,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":261,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8631,8634],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8631,8634],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":262,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":262,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8698,8701],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8698,8701],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":263,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":263,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8765,8768],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8765,8768],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":270,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":270,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9048,9051],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9048,9051],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'addWrappedText' is assigned a value but never used.","line":346,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":346,"endColumn":25},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":549,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":549,"endColumn":22,"suggestions":[{"fix":{"range":[16935,17039],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":555,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":555,"endColumn":20,"suggestions":[{"fix":{"range":[17076,17125],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":582,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":582,"endColumn":20,"suggestions":[{"fix":{"range":[17774,17816],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":609,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":609,"endColumn":20,"suggestions":[{"fix":{"range":[18468,18508],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":633,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":633,"endColumn":20,"suggestions":[{"fix":{"range":[19084,19133],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":645,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":645,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19434,19437],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19434,19437],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":661,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":661,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19995,19998],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19995,19998],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":661,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":661,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20029,20032],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20029,20032],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":663,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":663,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20124,20127],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20124,20127],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":677,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":677,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20587,20590],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20587,20590],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":721,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":721,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22004,22007],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22004,22007],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":724,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":724,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22197,22200],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22197,22200],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":779,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":779,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23756,23759],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23756,23759],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":808,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":808,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24652,24655],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24652,24655],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":812,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":812,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24744,24747],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24744,24747],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":823,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":823,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24993,24996],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24993,24996],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":848,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":848,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25663,25666],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25663,25666],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":913,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":913,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28132,28135],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28132,28135],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1329,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1329,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[48110,48113],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[48110,48113],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1723,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1723,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[68177,68180],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[68177,68180],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":78,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useMemo, useEffect } from 'react';\nimport { useLocation, useSearchParams, useNavigate } from 'react-router-dom';\nimport { useToast } from '@/hooks/use-toast';\nimport { Layout } from '@/components/layout';\nimport { PaymentModal } from '@/components/payment-modal';\nimport { BurnedMetadataDisplay } from '@/components/burned-metadata-display';\nimport { MetadataComparisonDisplay } from '@/components/metadata-comparison-display';\nimport { AdvancedResultsIntegration } from '@/components/advanced-results-integration';\nimport { MedicalAnalysisResult } from '@/components/medical-analysis-result';\nimport { ForensicAnalysis } from '@/components/v2-results/ForensicAnalysis';\nimport { AuthenticityBadge } from '@/components/v2-results/AuthenticityBadge';\nimport { AlertTriangle } from 'lucide-react';\nimport { PersonaDisplay } from '@/components/persona-display';\nimport {\n  MetadataExplorer,\n  convertMetadataToProcessedFile,\n} from '@/components/metadata-explorer';\nimport {\n  UIAdaptationProvider,\n  ContextBanner,\n  ContextIndicator,\n} from '@/components/ui-adaptation-controller';\nimport {\n  ErrorBoundary,\n  MetadataErrorBoundary,\n} from '@/components/error-boundary';\nimport { Button } from '@/components/ui/button';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport {\n  Download,\n  MapPin,\n  Camera,\n  FileText,\n  Image as ImageIcon,\n  Lock,\n  Search,\n  Database,\n  Cpu,\n  Hash,\n  Folder,\n  Calculator,\n  Tag,\n  ExternalLink,\n  Copy,\n  Check,\n  ShieldCheck,\n  Zap,\n  Eye,\n  TrendingUp,\n} from 'lucide-react';\nimport { motion } from 'framer-motion';\nimport { cn } from '@/lib/utils';\nimport generatedBackground from '@assets/generated_images/chaotic_dark_forensic_data_visualization_with_connecting_lines.png';\nimport jsPDF from 'jspdf';\nimport 'jspdf-autotable';\n\ninterface BurnedMetadata {\n  has_burned_metadata: boolean;\n  ocr_available: boolean;\n  confidence: 'none' | 'low' | 'medium' | 'high';\n  extracted_text?: string | null;\n  parsed_data?: {\n    gps?: { latitude: number; longitude: number; google_maps_url: string };\n    location?: { city: string; state: string; country: string };\n    address?: string;\n    plus_code?: string;\n    timestamp?: string;\n    weather?: {\n      temperature?: string;\n      humidity?: string;\n      speed?: string;\n      altitude?: string;\n    };\n    compass?: { degrees: string; direction: string };\n    camera_app?: string;\n  };\n}\n\ninterface MetadataComparison {\n  has_both: boolean;\n  has_embedded_only: boolean;\n  has_burned_only: boolean;\n  matches: Array<{\n    field: string;\n    matches: boolean;\n    embedded?: any;\n    burned?: any;\n    difference?: any;\n  }>;\n  discrepancies: Array<{ field: string; matches: boolean; warning?: string }>;\n  warnings: string[];\n  summary: {\n    embedded_metadata_present: boolean;\n    burned_metadata_present: boolean;\n    gps_comparison: string;\n    timestamp_comparison: string;\n    overall_status:\n      | 'verified'\n      | 'suspicious'\n      | 'stripped_exif'\n      | 'no_overlay'\n      | 'no_metadata';\n  };\n}\n\ninterface MetadataResponse {\n  filename: string;\n  filesize: string;\n  filetype: string;\n  mime_type: string;\n  tier: string;\n  fields_extracted: number;\n  file_integrity: { md5: string; sha256: string };\n  hashes?: { md5: string; sha256: string };\n  hash?: string;\n  file?: { created?: string; modified?: string };\n  advanced_analysis?: {\n    enabled: boolean;\n    processing_time_ms: number;\n    modules_run: string[];\n    forensic_score: number;\n    authenticity_assessment: string;\n  };\n  filesystem: Record<string, any>;\n  calculated: Record<string, any>;\n  gps: Record<string, any> | null;\n  summary: Record<string, any>;\n  forensic: Record<string, any>;\n  exif: Record<string, any>;\n  exif_ifd?: Record<string, any>;\n  makernote: Record<string, any>;\n  interoperability?: Record<string, any>;\n  iptc: Record<string, any>;\n  xmp: Record<string, any>;\n  xmp_namespaces?: Record<string, any>;\n  thumbnail_metadata?: Record<string, any>;\n  image_container?: Record<string, any>;\n  icc_profile?: Record<string, any>;\n  iptc_raw?: Record<string, any>;\n  xmp_raw?: Record<string, any>;\n  thumbnail?: Record<string, any>;\n  embedded_thumbnails?: Record<string, any>;\n  perceptual_hashes?: Record<string, any>;\n  normalized?: Record<string, any>;\n  web_metadata?: Record<string, any>;\n  social_media?: Record<string, any>;\n  mobile_metadata?: Record<string, any>;\n  camera_360?: Record<string, any>;\n  forensic_security?: Record<string, any>;\n  action_camera?: Record<string, any>;\n  print_publishing?: Record<string, any>;\n  workflow_dam?: Record<string, any>;\n  video?: Record<string, any>;\n  audio_advanced?: Record<string, any>;\n  video_advanced?: Record<string, any>;\n  steganography_analysis?: Record<string, any>;\n  manipulation_detection?: Record<string, any>;\n  ai_detection?: Record<string, any>;\n  timeline_analysis?: Record<string, any>;\n  scientific?: Record<string, any>;\n  scientific_data?: Record<string, any>;\n  extended: Record<string, any>;\n  extended_attributes?: Record<string, any>;\n  burned_metadata?: BurnedMetadata | null;\n  metadata_comparison?: MetadataComparison | null;\n  locked_fields: string[];\n  access?: {\n    trial_email_present?: boolean;\n    trial_granted?: boolean;\n    credits_charged?: number;\n    credits_required?: number;\n    mode?: 'device_free' | 'trial_limited' | 'paid';\n    free_used?: number;\n  };\n  persona_interpretation?: import('@shared/schema').PersonaInterpretation;\n  medical_imaging?: Record<string, any>;\n}\n\nexport default function Results() {\n  const location = useLocation();\n  const navigate = useNavigate();\n  const [searchParams] = useSearchParams();\n  const resultId = searchParams.get('id');\n  const { toast } = useToast();\n\n  const [metadata, setMetadata] = useState<MetadataResponse | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const creditsCharged = metadata?.access?.credits_charged;\n  const creditsRequired = metadata?.access?.credits_required;\n\n  // Fetch metadata from the database instead of using session storage\n  useEffect(() => {\n    const fetchMetadata = async () => {\n      try {\n        setError(null);\n        // Priority 1: Navigation State (In-Memory, handles large payloads)\n        if (location.state?.metadata) {\n          // Handle both array and object formats\n          const metadataObj = Array.isArray(location.state.metadata)\n            ? location.state.metadata[0]\n            : location.state.metadata;\n\n          setMetadata(metadataObj);\n          setLoading(false);\n          return;\n        }\n\n        // Priority 2: Query Parameter (for sharing links)\n        const urlParams = new URLSearchParams(location.search);\n        const metadataId = urlParams.get('id');\n\n        if (metadataId) {\n          // Fetch from database via API\n          const response = await fetch(`/api/extract/results/${metadataId}`, {\n            headers: {\n              Authorization: `Bearer ${localStorage.getItem('auth_token') || ''}`,\n            },\n          });\n\n          if (response.ok) {\n            const result = await response.json();\n            setMetadata(result);\n            console.log('[Results] Loaded metadata from database:', result);\n          } else if (response.status === 404) {\n            console.warn('[Results] Metadata not found in database');\n            setMetadata(null);\n          } else {\n            throw new Error(\n              `Failed to fetch metadata: ${response.status} ${response.statusText}`\n            );\n          }\n        } else {\n          // No metadata ID provided, show empty state\n          console.warn('[Results] No metadata ID provided');\n          setMetadata(null);\n        }\n      } catch (err) {\n        console.error('[Results] Error fetching metadata:', err);\n        setError(err instanceof Error ? err.message : 'Unknown error');\n        setMetadata(null);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchMetadata();\n  }, [location]);\n\n  // Fetch from DB if ID is present and we don't have fresh data\n\n  const [showPayment, setShowPayment] = useState(false);\n  const [isUnlocked, setIsUnlocked] = useState(false);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [copiedField, setCopiedField] = useState<string | null>(null);\n\n  // Advanced analysis state\n  const [advancedAnalysis, setAdvancedAnalysis] = useState<any>(null);\n  const [comparisonResult, setComparisonResult] = useState<any>(null);\n  const [timelineResult, setTimelineResult] = useState<any>(null);\n  const [forensicReport, setForensicReport] = useState<any>(null);\n  const [isProcessingAdvanced, setIsProcessingAdvanced] = useState(false);\n\n  // Metadata explorer state\n  const [explorerViewMode, setExplorerViewMode] = useState<\n    'simple' | 'advanced' | 'raw'\n  >('advanced');\n  const [processedFiles, setProcessedFiles] = useState<any[]>([]);\n\n  // Initialize processed files for metadata explorer\n  useEffect(() => {\n    if (metadata) {\n      const processedFile = convertMetadataToProcessedFile(\n        metadata,\n        'current-file'\n      );\n      setProcessedFiles([processedFile]);\n\n      // Extract advanced analysis from metadata if available\n      if (metadata.advanced_analysis) {\n        setAdvancedAnalysis(metadata.advanced_analysis);\n      }\n    }\n  }, [metadata]);\n\n  useEffect(() => {\n    const access = metadata?.access;\n    if (!access) return;\n    // Prefer explicit access.mode when available\n    const unlocked = access.mode\n      ? access.mode === 'paid' || access.mode === 'device_free'\n      : access.trial_granted || (access.credits_charged ?? 0) > 0;\n    if (unlocked) {\n      setIsUnlocked(true);\n    }\n  }, [metadata]);\n\n  const handleDownload = () => {\n    // CRITICAL FIX: Handle null metadata gracefully\n    if (!metadata) {\n      toast({\n        title: 'Download Error',\n        description: 'No metadata available to download',\n        variant: 'destructive',\n      });\n      return;\n    }\n\n    if (isUnlocked) {\n      const dataStr = JSON.stringify(metadata, null, 2);\n      const blob = new Blob([dataStr], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `${metadata.filename}_metadata.json`;\n      a.click();\n      URL.revokeObjectURL(url);\n    } else {\n      setShowPayment(true);\n    }\n  };\n\n  const handlePDFExport = () => {\n    // CRITICAL FIX: Handle null metadata gracefully\n    if (!metadata) {\n      toast({\n        title: 'Export Error',\n        description: 'No metadata available to export',\n        variant: 'destructive',\n      });\n      return;\n    }\n\n    if (!isUnlocked) {\n      setShowPayment(true);\n      return;\n    }\n\n    const doc = new jsPDF();\n    const pageWidth = doc.internal.pageSize.width;\n    let yPosition = 20;\n\n    // Helper function to add text with word wrapping\n    const addWrappedText = (\n      text: string,\n      x: number,\n      y: number,\n      maxWidth: number,\n      fontSize: number = 10\n    ) => {\n      doc.setFontSize(fontSize);\n      const lines = doc.splitTextToSize(text, maxWidth);\n      doc.text(lines, x, y);\n      return y + lines.length * fontSize * 0.4;\n    };\n\n    // Title\n    doc.setFontSize(18);\n    doc.setFont('helvetica', 'bold');\n    doc.text('METADATA ANALYSIS REPORT', pageWidth / 2, yPosition, {\n      align: 'center',\n    });\n    yPosition += 15;\n\n    // File Info\n    doc.setFontSize(12);\n    doc.setFont('helvetica', 'normal');\n    doc.text(`File: ${metadata.filename || 'Unknown'}`, 20, yPosition);\n    yPosition += 8;\n    doc.text(`Size: ${metadata.filesize || 0} bytes`, 20, yPosition);\n    yPosition += 8;\n    doc.text(`Type: ${metadata.filetype || 'Unknown'}`, 20, yPosition);\n    yPosition += 8;\n    doc.text(`MIME Type: ${metadata.mime_type || 'Unknown'}`, 20, yPosition);\n    yPosition += 8;\n    doc.text(`Analyzed: ${new Date().toLocaleString()}`, 20, yPosition);\n    yPosition += 15;\n\n    // Summary\n    doc.setFontSize(14);\n    doc.setFont('helvetica', 'bold');\n    doc.text('ANALYSIS SUMMARY', 20, yPosition);\n    yPosition += 10;\n\n    doc.setFontSize(10);\n    doc.setFont('helvetica', 'normal');\n    doc.text(\n      `Fields Extracted: ${metadata.fields_extracted || 0}`,\n      20,\n      yPosition\n    );\n    yPosition += 8;\n    doc.text(`Tier: ${metadata.tier || 'free'}`, 20, yPosition);\n    yPosition += 15;\n\n    // Advanced Analysis (if available)\n    if (advancedAnalysis?.enabled) {\n      doc.setFontSize(14);\n      doc.setFont('helvetica', 'bold');\n      doc.text('ADVANCED FORENSIC ANALYSIS', 20, yPosition);\n      yPosition += 10;\n\n      doc.setFontSize(10);\n      doc.setFont('helvetica', 'normal');\n      doc.text(\n        `Forensic Score: ${advancedAnalysis.forensic_score?.toFixed(2) || 'N/A'}`,\n        20,\n        yPosition\n      );\n      yPosition += 8;\n      doc.text(\n        `Authenticity Assessment: ${advancedAnalysis.authenticity_assessment || 'Unknown'}`,\n        20,\n        yPosition\n      );\n      yPosition += 8;\n      doc.text(\n        `Modules Run: ${advancedAnalysis.modules_run?.join(', ') || 'None'}`,\n        20,\n        yPosition\n      );\n      yPosition += 8;\n      doc.text(\n        `Processing Time: ${(advancedAnalysis.processing_time_ms || 0).toFixed(0)}ms`,\n        20,\n        yPosition\n      );\n      yPosition += 15;\n    }\n\n    // Key Findings\n    doc.setFontSize(14);\n    doc.setFont('helvetica', 'bold');\n    doc.text('KEY FINDINGS', 20, yPosition);\n    yPosition += 10;\n\n    // Extract some key metadata fields for the report\n    const captureDate = metadata.calculated?.capture_date;\n    const modifiedDate =\n      metadata.filesystem?.modified ||\n      metadata.file?.modified ||\n      metadata.calculated?.file_modified;\n\n    const keyFields = [\n      {\n        label: 'MD5 Hash',\n        value: metadata.hashes?.md5 || metadata.file_integrity?.md5 || 'N/A',\n      },\n      {\n        label: 'SHA256 Hash',\n        value:\n          metadata.hashes?.sha256 || metadata.file_integrity?.sha256 || 'N/A',\n      },\n      { label: 'Capture Date', value: captureDate || 'Not embedded' },\n      {\n        label: 'Modified Date (server file)',\n        value: modifiedDate || 'Not available',\n      },\n      {\n        label: 'GPS Location',\n        value: gpsCoords\n          ? `${gpsCoords.latitude}, ${gpsCoords.longitude}`\n          : 'Not embedded',\n      },\n      { label: 'Camera Make', value: metadata.exif?.Make || 'Not embedded' },\n      { label: 'Camera Model', value: metadata.exif?.Model || 'Not embedded' },\n    ];\n\n    doc.setFontSize(9);\n    keyFields.forEach(field => {\n      if (yPosition > doc.internal.pageSize.height - 30) {\n        doc.addPage();\n        yPosition = 20;\n      }\n      doc.text(`${field.label}: ${field.value}`, 20, yPosition);\n      yPosition += 6;\n    });\n\n    // Footer\n    const totalPages = doc.getNumberOfPages();\n    for (let i = 1; i <= totalPages; i++) {\n      doc.setPage(i);\n      doc.setFontSize(8);\n      doc.setFont('helvetica', 'italic');\n      doc.text(\n        `Generated by MetaExtract - Page ${i} of ${totalPages}`,\n        pageWidth / 2,\n        doc.internal.pageSize.height - 10,\n        { align: 'center' }\n      );\n    }\n\n    doc.save(`${metadata.filename}_analysis_report.pdf`);\n  };\n\n  const onPaymentSuccess = () => {\n    // CRITICAL FIX: Only unlock if metadata exists\n    if (metadata) {\n      setIsUnlocked(true);\n    } else {\n      toast({\n        title: 'Payment Error',\n        description: 'No metadata available to unlock',\n        variant: 'destructive',\n      });\n    }\n  };\n\n  // Advanced analysis API calls\n  const runAdvancedAnalysis = async () => {\n    // CRITICAL FIX: Handle null metadata gracefully\n    if (!metadata || !metadata.filename) {\n      toast({\n        title: 'Analysis Error',\n        description: 'No metadata available for analysis',\n        variant: 'destructive',\n      });\n      return;\n    }\n\n    setIsProcessingAdvanced(true);\n    try {\n      // Get the original file from session storage or create a mock file\n      const formData = new FormData();\n\n      // For demo purposes, we'll use the test.jpg file\n      const response = await fetch('/test.jpg');\n      const blob = await response.blob();\n      const file = new File([blob], metadata?.filename || 'unknown', {\n        type: metadata?.mime_type || 'application/octet-stream',\n      });\n\n      formData.append('file', file);\n\n      const analysisResponse = await fetch(\n        `/api/extract/advanced?tier=${import.meta.env.DEV ? 'enterprise' : 'professional'}`,\n        {\n          method: 'POST',\n          body: formData,\n        }\n      );\n\n      if (analysisResponse.ok) {\n        const result = await analysisResponse.json();\n        setAdvancedAnalysis(result);\n      } else {\n        console.error(\n          'Advanced analysis failed:',\n          await analysisResponse.text()\n        );\n      }\n    } catch (error) {\n      console.error('Advanced analysis error:', error);\n    } finally {\n      setIsProcessingAdvanced(false);\n    }\n  };\n\n  const runComparison = async (files: FileList) => {\n    setIsProcessingAdvanced(true);\n    try {\n      const formData = new FormData();\n      Array.from(files).forEach(file => {\n        formData.append('files', file);\n      });\n\n      const response = await fetch(\n        `/api/compare/batch?tier=${import.meta.env.DEV ? 'enterprise' : 'professional'}`,\n        {\n          method: 'POST',\n          body: formData,\n        }\n      );\n\n      if (response.ok) {\n        const result = await response.json();\n        setComparisonResult(result);\n      }\n    } catch (error) {\n      console.error('Comparison error:', error);\n    } finally {\n      setIsProcessingAdvanced(false);\n    }\n  };\n\n  const runTimeline = async (files: FileList) => {\n    setIsProcessingAdvanced(true);\n    try {\n      const formData = new FormData();\n      Array.from(files).forEach(file => {\n        formData.append('files', file);\n      });\n\n      const response = await fetch(\n        `/api/timeline/reconstruct?tier=${import.meta.env.DEV ? 'enterprise' : 'professional'}`,\n        {\n          method: 'POST',\n          body: formData,\n        }\n      );\n\n      if (response.ok) {\n        const result = await response.json();\n        setTimelineResult(result);\n      }\n    } catch (error) {\n      console.error('Timeline error:', error);\n    } finally {\n      setIsProcessingAdvanced(false);\n    }\n  };\n\n  const generateReport = async (files: FileList) => {\n    setIsProcessingAdvanced(true);\n    try {\n      const formData = new FormData();\n      Array.from(files).forEach(file => {\n        formData.append('files', file);\n      });\n\n      const response = await fetch('/api/forensic/report?tier=enterprise', {\n        method: 'POST',\n        body: formData,\n      });\n\n      if (response.ok) {\n        const result = await response.json();\n        setForensicReport(result);\n      }\n    } catch (error) {\n      console.error('Report generation error:', error);\n    } finally {\n      setIsProcessingAdvanced(false);\n    }\n  };\n\n  const copyToClipboard = (value: string, field: string) => {\n    navigator.clipboard.writeText(value);\n    setCopiedField(field);\n    setTimeout(() => setCopiedField(null), 2000);\n  };\n\n  const filterFields = (fields: Record<string, any>) => {\n    if (!fields) return [];\n    // If no search query, return all fields (excluding internal ones)\n    if (!searchQuery.trim()) {\n      return Object.entries(fields).filter(([key]) => !key.startsWith('_'));\n    }\n    return Object.entries(fields).filter(([key, val]) => {\n      if (key.startsWith('_')) return false;\n      const searchLower = searchQuery.toLowerCase();\n      return (\n        key.toLowerCase().includes(searchLower) ||\n        String(val).toLowerCase().includes(searchLower)\n      );\n    });\n  };\n\n  const flattenForDisplay = (data: any, prefix = ''): Record<string, any> => {\n    if (!data || typeof data !== 'object') return {};\n    const flat: Record<string, any> = {};\n    Object.entries(data).forEach(([key, value]) => {\n      if (key.startsWith('_') || key === 'data_base64') return;\n      const nextKey = prefix ? `${prefix}.${key}` : key;\n      if (value && typeof value === 'object' && !Array.isArray(value)) {\n        Object.assign(flat, flattenForDisplay(value, nextKey));\n      } else {\n        flat[nextKey] = value;\n      }\n    });\n    return flat;\n  };\n\n  const isSectionLocked = (\n    section: Record<string, any> | null | undefined\n  ): boolean => {\n    if (!section) return false;\n    return section._locked === true;\n  };\n\n  const totalFields = useMemo(() => {\n    // CRITICAL FIX: Handle null metadata gracefully\n    if (!metadata) {\n      return 0;\n    }\n\n    if (metadata.fields_extracted && metadata.fields_extracted > 0) {\n      return metadata.fields_extracted;\n    }\n    return (\n      Object.keys(metadata.summary || {}).length +\n      Object.keys(metadata.forensic || {}).length +\n      Object.keys(metadata.exif || {}).length +\n      Object.keys(metadata.filesystem || {}).length +\n      Object.keys(metadata.calculated || {}).length +\n      Object.keys(metadata.makernote || {}).length +\n      Object.keys(metadata.iptc || {}).length +\n      Object.keys(metadata.xmp || {}).length +\n      Object.keys(metadata.scientific || {}).length +\n      Object.keys(metadata.scientific_data || {}).length +\n      Object.keys(metadata.extended || {}).length +\n      (metadata.video?.telemetry\n        ? Object.keys(metadata.video.telemetry || {}).length\n        : 0) +\n      (metadata.gps ? Object.keys(metadata.gps).length : 0) +\n      2\n    );\n  }, [metadata]);\n\n  const flatXmpNamespaces = useMemo(() => {\n    // CRITICAL FIX: Handle null metadata gracefully\n    if (\n      !metadata ||\n      !metadata.xmp_namespaces ||\n      metadata.xmp_namespaces._locked\n    ) {\n      return {};\n    }\n    const flat: Record<string, any> = {};\n    Object.entries(metadata.xmp_namespaces).forEach(([namespace, fields]) => {\n      if (!fields || typeof fields !== 'object') return;\n      Object.entries(fields as Record<string, any>).forEach(([key, value]) => {\n        flat[`${namespace}.${key}`] = value;\n      });\n    });\n    return flat;\n  }, [metadata]);\n\n  const flatEmbeddedThumbnails = useMemo(() => {\n    // CRITICAL FIX: Handle null metadata gracefully\n    if (\n      !metadata ||\n      !metadata.embedded_thumbnails ||\n      metadata.embedded_thumbnails._locked\n    ) {\n      return {};\n    }\n    return flattenForDisplay(metadata.embedded_thumbnails);\n  }, [metadata]);\n\n  const flatCamera360 = useMemo(() => {\n    // CRITICAL FIX: Handle null metadata gracefully\n    if (!metadata || !metadata.camera_360) {\n      return {};\n    }\n    return flattenForDisplay(metadata.camera_360);\n  }, [metadata]);\n\n  const flatScientific = useMemo(() => {\n    // CRITICAL FIX: Handle null metadata gracefully\n    if (!metadata || !metadata.scientific || metadata.scientific._locked) {\n      return {};\n    }\n    return flattenForDisplay(metadata.scientific);\n  }, [metadata]);\n\n  const flatScientificData = useMemo(() => {\n    // CRITICAL FIX: Handle null metadata gracefully\n    if (\n      !metadata ||\n      !metadata.scientific_data ||\n      metadata.scientific_data._locked\n    ) {\n      return {};\n    }\n    return flattenForDisplay(metadata.scientific_data);\n  }, [metadata]);\n\n  const flatTelemetry = useMemo(() => {\n    // CRITICAL FIX: Handle null metadata gracefully\n    if (!metadata || !metadata.video || !metadata.video.telemetry) {\n      return {};\n    }\n    return flattenForDisplay(metadata.video.telemetry);\n  }, [metadata]);\n\n  const getGpsCoords = (gps: Record<string, any> | null | undefined) => {\n    if (!gps || typeof gps !== 'object') return null;\n    const latRaw =\n      gps.latitude ??\n      gps.lat ??\n      gps.latitude_decimal ??\n      gps.GPSLatitude ??\n      gps.gps_latitude ??\n      gps.Latitude;\n    const lonRaw =\n      gps.longitude ??\n      gps.lon ??\n      gps.longitude_decimal ??\n      gps.GPSLongitude ??\n      gps.gps_longitude ??\n      gps.Longitude;\n    const lat =\n      typeof latRaw === 'number' ? latRaw : parseFloat(String(latRaw));\n    const lon =\n      typeof lonRaw === 'number' ? lonRaw : parseFloat(String(lonRaw));\n    if (!Number.isFinite(lat) || !Number.isFinite(lon)) return null;\n    return { latitude: lat, longitude: lon };\n  };\n\n  const gpsCoords = useMemo(() => {\n    // CRITICAL FIX: Handle null metadata gracefully\n    if (!metadata || !metadata.gps) {\n      return null;\n    }\n    return getGpsCoords(metadata.gps as any);\n  }, [metadata?.gps]);\n  const hasGPS = !!gpsCoords;\n\n  const isFieldLocked = (value: any): boolean => {\n    if (typeof value === 'string') {\n      return (\n        value === 'LOCKED' ||\n        value === 'LOCKED_UPGRADE_TO_VIEW' ||\n        value.startsWith('LOCKED')\n      );\n    }\n    return false;\n  };\n\n  const formatValue = (val: any): string => {\n    if (val === null || val === undefined) return 'N/A';\n    if (Array.isArray(val)) return val.join(', ');\n    if (typeof val === 'object') {\n      if (val instanceof Date) return val.toISOString();\n      if (val.rawValue !== undefined) return String(val.rawValue);\n      if (val.toString && val.toString() !== '[object Object]')\n        return val.toString();\n      try {\n        return JSON.stringify(val);\n      } catch {\n        return '[Complex Object]';\n      }\n    }\n    return String(val);\n  };\n\n  const FieldRow = ({\n    label,\n    value,\n    locked = false,\n    index = 0,\n    copyable = false,\n  }: {\n    label: string;\n    value: string | any;\n    locked?: boolean;\n    index?: number;\n    copyable?: boolean;\n  }) => {\n    const stringValue = formatValue(value);\n    const isLocked = locked || isFieldLocked(value);\n\n    return (\n      <motion.div\n        initial={{ opacity: 0, x: -10 }}\n        animate={{ opacity: 1, x: 0 }}\n        transition={{ delay: index * 0.003 }}\n        className=\"group grid grid-cols-2 gap-4 py-2 px-3 border-b border-white/5 hover:bg-white/5 rounded transition-colors font-mono text-xs\"\n        data-testid={`field-row-${label\n          .toLowerCase()\n          .replace(/[^a-z0-9]/g, '-')}`}\n      >\n        <span className=\"text-slate-300 group-hover:text-primary/80 transition-colors break-all\">\n          {label}\n        </span>\n        <div className=\"flex items-center gap-2 justify-end min-w-0\">\n          {isLocked && !isUnlocked ? (\n            <button\n              type=\"button\"\n              className=\"flex items-center gap-2 text-slate-600 select-none bg-black/40 px-2 py-0.5 rounded border border-white/5 cursor-pointer hover:border-primary/30 transition-colors shrink-0 focus:outline-none focus:ring-2 focus:ring-primary/50\"\n              onClick={() => setShowPayment(true)}\n            >\n              <span className=\"text-xs text-slate-500\">Upgrade to view</span>\n              <Lock className=\"w-3 h-3 text-primary/60\" />\n            </button>\n          ) : (\n            <>\n              <span className=\"text-slate-200 text-right break-all selection:bg-primary/30 min-w-0\">\n                {stringValue}\n              </span>\n              {copyable && !isLocked && (\n                <button\n                  type=\"button\"\n                  onClick={() => copyToClipboard(stringValue, label)}\n                  className=\"opacity-0 group-hover:opacity-100 transition-opacity p-1 hover:bg-white/10 rounded shrink-0 focus:outline-none focus:ring-1 focus:ring-primary/50\"\n                  data-testid={`copy-${label\n                    .toLowerCase()\n                    .replace(/[^a-z0-9]/g, '-')}`}\n                >\n                  {copiedField === label ? (\n                    <Check className=\"w-3 h-3 text-emerald-500\" />\n                  ) : (\n                    <Copy className=\"w-3 h-3 text-slate-500\" />\n                  )}\n                </button>\n              )}\n            </>\n          )}\n        </div>\n      </motion.div>\n    );\n  };\n\n  const SectionHeader = ({\n    icon: Icon,\n    title,\n    color,\n    count,\n  }: {\n    icon: any;\n    title: string;\n    color: string;\n    count?: number;\n  }) => (\n    <h4\n      className={`flex items-center gap-2 text-xs font-bold mb-3 uppercase tracking-widest ${color}`}\n    >\n      <Icon className=\"w-3 h-3\" /> {title}\n      {count !== undefined && (\n        <span className=\"text-slate-600 font-normal\">({count})</span>\n      )}\n    </h4>\n  );\n\n  // Show loading state while fetching metadata\n  if (loading) {\n    return (\n      <UIAdaptationProvider initialMetadata={undefined}>\n        <Layout>\n          <div className=\"flex items-center justify-center min-h-[calc(100vh-64px)]\">\n            <div className=\"flex flex-col items-center gap-4\">\n              <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\n              <p className=\"text-white text-lg\">Loading metadata...</p>\n              <p className=\"text-slate-300 text-sm\">Fetching from database</p>\n            </div>\n          </div>\n        </Layout>\n      </UIAdaptationProvider>\n    );\n  }\n\n  // Show error state if there was an error\n  if (error) {\n    return (\n      <UIAdaptationProvider initialMetadata={undefined}>\n        <Layout>\n          <div className=\"flex items-center justify-center min-h-[calc(100vh-64px)]\">\n            <div className=\"max-w-md w-full bg-red-900/30 border border-red-700/50 rounded-lg p-6 text-center\">\n              <AlertTriangle className=\"w-12 h-12 text-red-500 mx-auto mb-4\" />\n              <h2 className=\"text-xl font-bold text-white mb-2\">\n                Error Loading Metadata\n              </h2>\n              <p className=\"text-slate-200 mb-4\">{error}</p>\n              <Button\n                onClick={() => navigate('/images_mvp')}\n                className=\"bg-[#6366f1] hover:bg-[#5855eb] text-white w-full\"\n              >\n                Upload a file\n              </Button>\n            </div>\n          </div>\n        </Layout>\n      </UIAdaptationProvider>\n    );\n  }\n\n  // Show error if no metadata was loaded\n  if (!metadata) {\n    return (\n      <UIAdaptationProvider initialMetadata={undefined}>\n        <Layout>\n          <div className=\"flex items-center justify-center min-h-[calc(100vh-64px)]\">\n            <div className=\"max-w-md w-full bg-[#11121a] border border-white/10 rounded-lg p-6 text-center\">\n              <AlertTriangle className=\"w-12 h-12 text-yellow-500 mx-auto mb-4\" />\n              <h2 className=\"text-xl font-bold text-white mb-2\">\n                No Results Yet\n              </h2>\n              <p className=\"text-slate-200 mb-4\">\n                Upload a file to view extracted metadata and analysis here.\n              </p>\n              <Button\n                onClick={() => navigate('/images_mvp')}\n                className=\"bg-[#6366f1] hover:bg-[#5855eb] text-white w-full\"\n              >\n                Start extraction\n              </Button>\n            </div>\n          </div>\n        </Layout>\n      </UIAdaptationProvider>\n    );\n  }\n\n  return (\n    <UIAdaptationProvider initialMetadata={metadata}>\n      <Layout>\n        <ErrorBoundary level=\"page\">\n          <div className=\"relative min-h-[calc(100vh-64px)] overflow-hidden\">\n            <div className=\"absolute inset-0 z-0 pointer-events-none\">\n              <div className=\"absolute inset-0 bg-background/90 z-10\"></div>\n              <img\n                src={generatedBackground}\n                alt=\"Background\"\n                className=\"w-full h-full object-cover opacity-10 mix-blend-screen scale-110\"\n              />\n            </div>\n\n            <div className=\"container mx-auto px-4 py-8 relative z-10 h-full flex flex-col\">\n              <div className=\"flex flex-col md:flex-row md:items-center justify-between mb-8 pb-6 border-b border-white/10 gap-4\">\n                <div className=\"flex items-center gap-4\">\n                  <div className=\"w-12 h-12 bg-white/5 rounded border border-white/10 flex items-center justify-center\">\n                    <Cpu className=\"w-6 h-6 text-primary\" />\n                  </div>\n                  <div>\n                    <h1\n                      className=\"text-xl font-bold text-white font-mono tracking-tight\"\n                      data-testid=\"text-filename\"\n                    >\n                      {metadata?.filename || 'Unknown'}\n                    </h1>\n                    <div className=\"flex gap-4 text-xs text-slate-500 font-mono mt-1\">\n                      <span data-testid=\"text-filesize\">\n                        SIZE: {metadata?.filesize || 'Unknown'}\n                      </span>\n                      <span data-testid=\"text-filetype\">\n                        TYPE: {metadata?.filetype || 'Unknown'}\n                      </span>\n                      <span className=\"text-primary\" data-testid=\"text-hash\">\n                        SHA256:{' '}\n                        {metadata?.file_integrity?.sha256?.substring(0, 12) ||\n                          metadata?.hash?.substring(0, 12) ||\n                          'N/A'}\n                        ...\n                      </span>\n                      <ContextIndicator />\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"flex gap-3 items-center\">\n                  {typeof creditsRequired === 'number' && (\n                    <div className=\"px-3 py-2 bg-white/5 border border-white/10 rounded text-xs text-slate-200 font-mono\">\n                      {typeof creditsCharged === 'number' && creditsCharged > 0\n                        ? `Charged: ${creditsCharged} credits`\n                        : `Cost: ${creditsRequired} credits (covered by free check)`}\n                      {creditsRequired > 4 ? ' (Text scan applied)' : ''}\n                    </div>\n                  )}\n                  {isProcessingAdvanced && (\n                    <div className=\"flex items-center gap-2 px-3 py-2 bg-blue-600/20 border border-blue-500/30 rounded text-blue-300 text-xs font-mono\">\n                      <Zap className=\"w-4 h-4 animate-pulse\" />\n                      PROCESSING_ADVANCED_ANALYSIS...\n                    </div>\n                  )}\n                  <Button\n                    onClick={handleDownload}\n                    className={cn(\n                      'gap-2 font-mono text-xs tracking-wider',\n                      isUnlocked\n                        ? 'bg-emerald-600 hover:bg-emerald-700'\n                        : 'bg-primary hover:bg-primary/90 text-black'\n                    )}\n                    data-testid=\"button-download\"\n                  >\n                    {isUnlocked ? (\n                      <Download className=\"w-4 h-4\" />\n                    ) : (\n                      <Lock className=\"w-4 h-4\" />\n                    )}\n                    {isUnlocked ? 'JSON' : 'UNLOCK_FULL_DATA'}\n                  </Button>\n                  {isUnlocked && (\n                    <Button\n                      onClick={handlePDFExport}\n                      variant=\"outline\"\n                      className=\"gap-2 font-mono text-xs tracking-wider border-emerald-500/50 text-emerald-300 hover:bg-emerald-500/10\"\n                    >\n                      <FileText className=\"w-4 h-4\" />\n                      PDF\n                    </Button>\n                  )}\n                  {import.meta.env.DEV && (\n                    <Button\n                      onClick={() =>\n                        navigate('/results-v2', {\n                          state: { metadata },\n                        })\n                      }\n                      variant=\"outline\"\n                      className=\"gap-2 font-mono text-xs tracking-wider border-blue-500/50 text-blue-300 hover:bg-blue-500/10\"\n                    >\n                      <Cpu className=\"w-4 h-4\" />\n                      V2\n                    </Button>\n                  )}\n                </div>\n              </div>\n\n              <ContextBanner />\n\n              <div className=\"flex-1 flex flex-col md:flex-row gap-8 min-h-0\">\n                <div className=\"w-full md:w-72 shrink-0 space-y-4 md:overflow-y-auto pr-2 custom-scrollbar\">\n                  <div className=\"bg-black/40 backdrop-blur-md border border-white/10 rounded-lg p-4 shadow-lg\">\n                    <h3 className=\"text-xs font-bold text-white mb-4 uppercase tracking-widest border-b border-white/5 pb-2\">\n                      Analysis Summary\n                    </h3>\n                    <div className=\"space-y-4\">\n                      <div>\n                        <div className=\"text-[10px] text-slate-500 uppercase\">\n                          Total Fields\n                        </div>\n                        <div\n                          className=\"text-2xl font-mono text-primary font-bold\"\n                          data-testid=\"text-total-fields\"\n                        >\n                          {totalFields}\n                        </div>\n                      </div>\n                      <div>\n                        <div className=\"text-[10px] text-slate-500 uppercase\">\n                          File Integrity\n                        </div>\n                        <div className=\"text-sm font-mono text-emerald-500 font-bold\">\n                          VERIFIED [MD5+SHA256]\n                        </div>\n                      </div>\n                      <div>\n                        <div className=\"text-[10px] text-slate-500 uppercase\">\n                          Location Data\n                        </div>\n                        <div className=\"text-sm font-mono text-white flex items-center gap-2\">\n                          <MapPin\n                            className={`w-3 h-3 ${\n                              hasGPS ? 'text-primary' : 'text-slate-600'\n                            }`}\n                          />\n                          {hasGPS ? 'Present' : 'Not Embedded'}\n                        </div>\n                      </div>\n                      {metadata?.calculated && (\n                        <div>\n                          <div className=\"text-[10px] text-slate-500 uppercase\">\n                            Dimensions\n                          </div>\n                          <div className=\"text-sm font-mono text-white\">\n                            {metadata?.calculated?.megapixels\n                              ? `${metadata?.calculated?.megapixels} MP`\n                              : 'N/A'}\n                            {metadata?.calculated?.aspect_ratio &&\n                              ` (${metadata?.calculated?.aspect_ratio})`}\n                          </div>\n                        </div>\n                      )}\n                      <div>\n                        <div className=\"text-[10px] text-slate-500 uppercase\">\n                          Advanced Analysis\n                        </div>\n                        <div className=\"text-sm font-mono text-white flex items-center gap-2\">\n                          <Eye\n                            className={`w-3 h-3 ${\n                              advancedAnalysis\n                                ? 'text-primary'\n                                : 'text-slate-600'\n                            }`}\n                          />\n                          {advancedAnalysis ? 'Available' : 'Not Run'}\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n\n                  {hasGPS && metadata?.gps?.google_maps_url && (\n                    <div className=\"bg-black/40 backdrop-blur-md border border-white/10 rounded-lg p-4 shadow-lg\">\n                      <h3 className=\"text-xs font-bold text-white mb-4 uppercase tracking-widest border-b border-white/5 pb-2\">\n                        GPS Location\n                      </h3>\n                      <div className=\"space-y-2 font-mono text-xs\">\n                        <div className=\"text-slate-300\">\n                          <span className=\"text-slate-600\">LAT:</span>{' '}\n                          {gpsCoords?.latitude.toFixed(6)}\n                        </div>\n                        <div className=\"text-slate-300\">\n                          <span className=\"text-slate-600\">LON:</span>{' '}\n                          {gpsCoords?.longitude.toFixed(6)}\n                        </div>\n                        <a\n                          href={metadata?.gps?.google_maps_url}\n                          target=\"_blank\"\n                          rel=\"noopener noreferrer\"\n                          className=\"flex items-center gap-2 text-primary hover:text-primary/80 transition-colors mt-3\"\n                          data-testid=\"link-google-maps\"\n                        >\n                          <MapPin className=\"w-3 h-3\" /> View on Maps{' '}\n                          <ExternalLink className=\"w-3 h-3\" />\n                        </a>\n                      </div>\n                    </div>\n                  )}\n\n                  <div className=\"bg-black/40 backdrop-blur-md border border-white/10 rounded-lg p-4 shadow-lg\">\n                    <h3 className=\"text-xs font-bold text-white mb-4 uppercase tracking-widest border-b border-white/5 pb-2\">\n                      File Preview\n                    </h3>\n                    <div className=\"aspect-square bg-black/50 rounded flex items-center justify-center border border-white/5 mb-2 relative overflow-hidden group\">\n                      <div className=\"absolute inset-0 bg-grid opacity-20\"></div>\n                      <ImageIcon className=\"w-8 h-8 text-slate-600 group-hover:text-primary transition-colors\" />\n                    </div>\n                    <div className=\"text-[10px] text-slate-500 text-center font-mono\">\n                      ZERO_DATA_RETENTION\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"flex-1 bg-black/40 backdrop-blur-md border border-white/10 rounded-lg flex flex-col overflow-hidden shadow-2xl\">\n                  {/* PERSONA DISPLAY - Show Sarah-friendly answers first */}\n                  {metadata?.persona_interpretation && (\n                    <div className=\"p-4 border-b border-white/10 bg-black/20\">\n                      <PersonaDisplay\n                        interpretation={metadata?.persona_interpretation}\n                      />\n                    </div>\n                  )}\n\n                  <Tabs defaultValue=\"all\" className=\"flex-1 flex flex-col\">\n                    <div className=\"flex flex-col md:flex-row md:items-center justify-between p-4 border-b border-white/10 bg-black/20 gap-4\">\n                      <TabsList className=\"bg-white/5 border border-white/5 h-9 w-full md:w-auto\">\n                        <TabsTrigger\n                          value=\"all\"\n                          className=\"text-xs font-mono data-[state=active]:bg-primary data-[state=active]:text-black relative\"\n                          data-testid=\"tab-all\"\n                        >\n                          ALL\n                          {metadata.metadata_comparison?.summary\n                            ?.overall_status === 'suspicious' && (\n                            <div className=\"absolute -top-1 -right-1 w-2 h-2 bg-rose-500 rounded-full\"></div>\n                          )}\n                        </TabsTrigger>\n                        <TabsTrigger\n                          value=\"explorer\"\n                          className=\"text-xs font-mono data-[state=active]:bg-primary data-[state=active]:text-black relative\"\n                          data-testid=\"tab-explorer\"\n                        >\n                          EXPLORER\n                          <div className=\"absolute -top-1 -right-1 w-2 h-2 bg-green-500 rounded-full\"></div>\n                        </TabsTrigger>\n                        {metadata?.medical_imaging?.available && (\n                          <TabsTrigger\n                            value=\"medical\"\n                            className=\"text-xs font-mono data-[state=active]:bg-primary data-[state=active]:text-black relative\"\n                          >\n                            MEDICAL\n                            <div className=\"absolute -top-1 -right-1 w-2 h-2 bg-blue-500 rounded-full\"></div>\n                          </TabsTrigger>\n                        )}\n                        <TabsTrigger\n                          value=\"advanced\"\n                          className=\"text-xs font-mono data-[state=active]:bg-primary data-[state=active]:text-black relative\"\n                          data-testid=\"tab-advanced\"\n                        >\n                          ADVANCED\n                          {advancedAnalysis && (\n                            <div className=\"absolute -top-1 -right-1 w-2 h-2 bg-blue-500 rounded-full\"></div>\n                          )}\n                        </TabsTrigger>\n                        <TabsTrigger\n                          value=\"forensic\"\n                          className=\"text-xs font-mono data-[state=active]:bg-primary data-[state=active]:text-black relative\"\n                          data-testid=\"tab-forensic\"\n                        >\n                          FORENSIC\n                          {metadata.metadata_comparison?.summary\n                            ?.overall_status === 'suspicious' && (\n                            <div className=\"absolute -top-1 -right-1 w-2 h-2 bg-rose-500 rounded-full\"></div>\n                          )}\n                        </TabsTrigger>\n                        <TabsTrigger\n                          value=\"technical\"\n                          className=\"text-xs font-mono data-[state=active]:bg-primary data-[state=active]:text-black\"\n                          data-testid=\"tab-technical\"\n                        >\n                          TECHNICAL\n                        </TabsTrigger>\n                        <TabsTrigger\n                          value=\"raw\"\n                          className=\"text-xs font-mono data-[state=active]:bg-primary data-[state=active]:text-black\"\n                          data-testid=\"tab-raw\"\n                        >\n                          RAW\n                        </TabsTrigger>\n                      </TabsList>\n\n                      <div className=\"relative w-64\">\n                        <Search className=\"absolute left-2.5 top-2.5 h-3 w-3 text-slate-500\" />\n                        <input\n                          type=\"text\"\n                          placeholder=\"FILTER_FIELDS...\"\n                          className=\"w-full bg-black/40 border border-white/10 rounded-md pl-8 pr-3 py-1.5 text-xs text-white placeholder:text-slate-600 focus:border-primary/50 focus:ring-0 outline-none font-mono\"\n                          value={searchQuery}\n                          onChange={e => setSearchQuery(e.target.value)}\n                          data-testid=\"input-search\"\n                        />\n                      </div>\n                    </div>\n\n                    <div className=\"flex-1 overflow-hidden relative\">\n                      <ScrollArea className=\"h-full\">\n                        <div className=\"p-4 space-y-6\">\n                          <TabsContent\n                            value=\"explorer\"\n                            className=\"mt-0 h-[600px]\"\n                          >\n                            <MetadataErrorBoundary>\n                              <MetadataExplorer\n                                files={processedFiles}\n                                viewMode={explorerViewMode}\n                                onViewModeChange={setExplorerViewMode}\n                              />\n                            </MetadataErrorBoundary>\n                          </TabsContent>\n\n                          <TabsContent value=\"medical\" className=\"mt-0\">\n                            <MedicalAnalysisResult\n                              data={\n                                (metadata?.medical_imaging || {\n                                  available: false,\n                                }) as any\n                              }\n                              isUnlocked={isUnlocked}\n                            />\n                          </TabsContent>\n\n                          <TabsContent value=\"all\" className=\"mt-0 space-y-6\">\n                            {metadata?.file_integrity && (\n                              <section>\n                                <SectionHeader\n                                  icon={Hash}\n                                  title=\"File Integrity\"\n                                  color=\"text-amber-500\"\n                                  count={2}\n                                />\n                                <div className=\"grid grid-cols-1 gap-y-1\">\n                                  <FieldRow\n                                    label=\"MD5\"\n                                    value={\n                                      metadata?.file_integrity?.md5 || 'N/A'\n                                    }\n                                    copyable\n                                    index={0}\n                                  />\n                                  <FieldRow\n                                    label=\"SHA256\"\n                                    value={\n                                      metadata?.file_integrity?.sha256 || 'N/A'\n                                    }\n                                    copyable\n                                    index={1}\n                                  />\n                                </div>\n                              </section>\n                            )}\n\n                            {metadata?.metadata_comparison &&\n                              (metadata?.fields_extracted === 0 ||\n                                metadata?.metadata_comparison?.summary\n                                  ?.overall_status !== 'no_metadata' ||\n                                metadata?.metadata_comparison?.has_both) && (\n                                <section>\n                                  <MetadataComparisonDisplay\n                                    comparison={metadata?.metadata_comparison}\n                                  />\n                                </section>\n                              )}\n\n                            {metadata?.burned_metadata &&\n                              metadata?.burned_metadata\n                                ?.has_burned_metadata && (\n                                <section>\n                                  <BurnedMetadataDisplay\n                                    burned_metadata={metadata?.burned_metadata}\n                                    isUnlocked={isUnlocked}\n                                  />\n                                </section>\n                              )}\n\n                            <section>\n                              <SectionHeader\n                                icon={ShieldCheck}\n                                title=\"Forensic Evidence\"\n                                color=\"text-emerald-500\"\n                                count={\n                                  filterFields(metadata.forensic || {}).length\n                                }\n                              />\n                              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1\">\n                                {filterFields(metadata.forensic || {}).map(\n                                  ([key, val], i) => (\n                                    <FieldRow\n                                      key={key}\n                                      label={key}\n                                      value={val}\n                                      index={i}\n                                      locked={\n                                        key.includes('Serial') && !isUnlocked\n                                      }\n                                      copyable\n                                    />\n                                  )\n                                )}\n                              </div>\n                            </section>\n\n                            <section>\n                              <SectionHeader\n                                icon={FileText}\n                                title=\"File Summary\"\n                                color=\"text-primary\"\n                                count={\n                                  filterFields(metadata.summary || {}).length\n                                }\n                              />\n                              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1\">\n                                {filterFields(metadata.summary || {}).map(\n                                  ([key, val], i) => (\n                                    <FieldRow\n                                      key={key}\n                                      label={key}\n                                      value={val}\n                                      index={i}\n                                    />\n                                  )\n                                )}\n                              </div>\n                            </section>\n\n                            {metadata.calculated && (\n                              <section>\n                                <SectionHeader\n                                  icon={Calculator}\n                                  title=\"Calculated Fields\"\n                                  color=\"text-cyan-500\"\n                                  count={\n                                    filterFields(metadata.calculated || {})\n                                      .length\n                                  }\n                                />\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1\">\n                                  {filterFields(metadata.calculated || {}).map(\n                                    ([key, val], i) => (\n                                      <FieldRow\n                                        key={key}\n                                        label={key}\n                                        value={val}\n                                        index={i}\n                                        locked={!isUnlocked}\n                                      />\n                                    )\n                                  )}\n                                </div>\n                              </section>\n                            )}\n\n                            <section>\n                              <SectionHeader\n                                icon={Camera}\n                                title=\"Camera & EXIF\"\n                                color=\"text-purple-400\"\n                                count={filterFields(metadata.exif || {}).length}\n                              />\n                              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1\">\n                                {filterFields(metadata.exif || {}).map(\n                                  ([key, val], i) => (\n                                    <FieldRow\n                                      key={key}\n                                      label={key}\n                                      value={val}\n                                      index={i}\n                                    />\n                                  )\n                                )}\n                              </div>\n                            </section>\n\n                            {hasGPS && metadata.gps && (\n                              <section>\n                                <SectionHeader\n                                  icon={MapPin}\n                                  title=\"GPS Location\"\n                                  color=\"text-rose-500\"\n                                  count={\n                                    filterFields(metadata.gps || {}).length\n                                  }\n                                />\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1\">\n                                  {filterFields(metadata.gps || {}).map(\n                                    ([key, val], i) => (\n                                      <FieldRow\n                                        key={key}\n                                        label={key}\n                                        value={val}\n                                        index={i}\n                                        copyable\n                                      />\n                                    )\n                                  )}\n                                </div>\n                              </section>\n                            )}\n\n                            {!isUnlocked && (\n                              <div className=\"p-4 border border-dashed border-white/10 rounded bg-white/5 text-center\">\n                                <p className=\"text-xs text-slate-300 font-mono mb-2\">\n                                  {Object.keys(metadata?.makernote || {})\n                                    .length +\n                                    Object.keys(metadata?.extended || {})\n                                      .length}{' '}\n                                  ADDITIONAL FIELDS AVAILABLE\n                                </p>\n                                <Button\n                                  variant=\"link\"\n                                  onClick={() => setShowPayment(true)}\n                                  className=\"text-primary text-xs h-auto p-0\"\n                                  data-testid=\"button-unlock-fields\"\n                                >\n                                  UNLOCK_ALL_FIELDS\n                                </Button>\n                              </div>\n                            )}\n                          </TabsContent>\n\n                          <TabsContent value=\"advanced\" className=\"mt-0\">\n                            <AdvancedResultsIntegration\n                              metadata={metadata}\n                              advancedAnalysis={advancedAnalysis}\n                              comparisonResult={comparisonResult}\n                              timelineResult={timelineResult}\n                              forensicReport={forensicReport}\n                              tier={\n                                import.meta.env.DEV\n                                  ? 'enterprise'\n                                  : metadata?.tier || 'free'\n                              }\n                              onUpgrade={() => setShowPayment(true)}\n                              onRunAdvancedAnalysis={runAdvancedAnalysis}\n                              onRunComparison={runComparison}\n                              onRunTimeline={runTimeline}\n                              onGenerateReport={generateReport}\n                            />\n                          </TabsContent>\n\n                          <TabsContent\n                            value=\"forensic\"\n                            className=\"mt-0 space-y-6\"\n                          >\n                            {metadata?.metadata_comparison && (\n                              <section>\n                                <MetadataComparisonDisplay\n                                  comparison={metadata?.metadata_comparison}\n                                />\n                              </section>\n                            )}\n\n                            {metadata?.burned_metadata &&\n                              metadata?.burned_metadata\n                                ?.has_burned_metadata && (\n                                <section>\n                                  <BurnedMetadataDisplay\n                                    burned_metadata={metadata?.burned_metadata}\n                                    isUnlocked={isUnlocked}\n                                  />\n                                </section>\n                              )}\n\n                            <section>\n                              <SectionHeader\n                                icon={Hash}\n                                title=\"File Integrity Hashes\"\n                                color=\"text-amber-500\"\n                              />\n                              <div className=\"space-y-1\">\n                                <FieldRow\n                                  label=\"MD5\"\n                                  value={metadata?.file_integrity?.md5 || 'N/A'}\n                                  locked={!isUnlocked}\n                                  copyable\n                                  index={0}\n                                />\n                                <FieldRow\n                                  label=\"SHA256\"\n                                  value={\n                                    metadata?.file_integrity?.sha256 || 'N/A'\n                                  }\n                                  locked={!isUnlocked}\n                                  copyable\n                                  index={1}\n                                />\n                              </div>\n                            </section>\n\n                            <section>\n                              <SectionHeader\n                                icon={ShieldCheck}\n                                title=\"Chain of Custody\"\n                                color=\"text-emerald-500\"\n                              />\n                              <div className=\"space-y-1\">\n                                {filterFields(metadata.forensic || {}).map(\n                                  ([key, val], i) => (\n                                    <FieldRow\n                                      key={key}\n                                      label={key}\n                                      value={val}\n                                      index={i}\n                                      copyable\n                                    />\n                                  )\n                                )}\n                              </div>\n                            </section>\n\n                            <section>\n                              <SectionHeader\n                                icon={Folder}\n                                title=\"Filesystem Metadata\"\n                                color=\"text-blue-400\"\n                              />\n                              <div className=\"space-y-1\">\n                                {filterFields(metadata.filesystem || {}).map(\n                                  ([key, val], i) => (\n                                    <FieldRow\n                                      key={key}\n                                      label={key}\n                                      value={val}\n                                      index={i}\n                                    />\n                                  )\n                                )}\n                              </div>\n                            </section>\n\n                            {/* Forensic Analysis Components */}\n                            {(metadata?.steganography_analysis ||\n                              metadata?.manipulation_detection ||\n                              metadata?.ai_detection) &&\n                              (metadata?.tier === 'forensic' ||\n                                metadata?.tier === 'enterprise' ||\n                                metadata?.tier === 'professional' ||\n                                import.meta.env.DEV) && (\n                                <section>\n                                  <SectionHeader\n                                    icon={ShieldCheck}\n                                    title=\"Advanced Forensic Analysis\"\n                                    color=\"text-red-400\"\n                                  />\n                                  <div className=\"space-y-6\">\n                                    {metadata?.advanced_analysis\n                                      ?.forensic_score !== undefined && (\n                                      <div className=\"flex items-center justify-between p-4 bg-black/20 rounded-lg border border-white/10\">\n                                        <div className=\"flex items-center gap-3\">\n                                          <ShieldCheck className=\"w-5 h-5 text-primary\" />\n                                          <div>\n                                            <h4 className=\"text-sm font-medium text-white\">\n                                              Overall Authenticity Score\n                                            </h4>\n                                            <p className=\"text-xs text-slate-400\">\n                                              Based on forensic analysis\n                                            </p>\n                                          </div>\n                                        </div>\n                                        <AuthenticityBadge\n                                          score={\n                                            metadata.advanced_analysis\n                                              .forensic_score\n                                          }\n                                          variant=\"detailed\"\n                                          showConfidence={true}\n                                        />\n                                      </div>\n                                    )}\n\n                                    <ForensicAnalysis\n                                      steganography={\n                                        metadata?.steganography_analysis\n                                          ? {\n                                              detected:\n                                                metadata.steganography_analysis\n                                                  .suspicious_score > 0.3,\n                                              confidence: Math.round(\n                                                (metadata.steganography_analysis\n                                                  .suspicious_score || 0) * 100\n                                              ),\n                                              methodsChecked: metadata\n                                                .steganography_analysis\n                                                .methods_checked || [\n                                                'LSB Analysis',\n                                                'FFT Analysis',\n                                              ],\n                                              findings:\n                                                metadata.steganography_analysis\n                                                  .findings || [],\n                                              details:\n                                                metadata.steganography_analysis\n                                                  .analysis_details,\n                                            }\n                                          : undefined\n                                      }\n                                      manipulation={\n                                        metadata?.manipulation_detection\n                                          ? {\n                                              detected:\n                                                metadata.manipulation_detection\n                                                  .manipulation_probability >\n                                                0.5,\n                                              confidence: Math.round(\n                                                (metadata.manipulation_detection\n                                                  .manipulation_probability ||\n                                                  0) * 100\n                                              ),\n                                              indicators:\n                                                metadata.manipulation_detection.indicators?.map(\n                                                  (indicator: any) => ({\n                                                    type:\n                                                      indicator.type ||\n                                                      'Manipulation',\n                                                    severity:\n                                                      indicator.severity ||\n                                                      (indicator.confidence >\n                                                      0.7\n                                                        ? 'high'\n                                                        : indicator.confidence >\n                                                            0.4\n                                                          ? 'medium'\n                                                          : 'low'),\n                                                    description:\n                                                      indicator.description ||\n                                                      'Manipulation detected',\n                                                    confidence: Math.round(\n                                                      (indicator.confidence ||\n                                                        0) * 100\n                                                    ),\n                                                  })\n                                                ) || [],\n                                              originalityScore: metadata\n                                                .manipulation_detection\n                                                .originality_score\n                                                ? Math.round(\n                                                    metadata\n                                                      .manipulation_detection\n                                                      .originality_score * 100\n                                                  )\n                                                : undefined,\n                                            }\n                                          : undefined\n                                      }\n                                      aiDetection={\n                                        metadata?.ai_detection\n                                          ? {\n                                              aiGenerated:\n                                                metadata.ai_detection\n                                                  .ai_probability > 0.7,\n                                              confidence: Math.round(\n                                                (metadata.ai_detection\n                                                  .ai_probability || 0) * 100\n                                              ),\n                                              modelHints:\n                                                metadata.ai_detection\n                                                  .model_hints || [],\n                                              detectionMethods: metadata\n                                                .ai_detection\n                                                .detection_methods || [\n                                                'Neural Network Analysis',\n                                              ],\n                                            }\n                                          : undefined\n                                      }\n                                      authenticityScore={\n                                        metadata?.advanced_analysis\n                                          ?.forensic_score || 100\n                                      }\n                                      className=\"bg-black/20 border border-white/10\"\n                                    />\n                                  </div>\n                                </section>\n                              )}\n\n                            {/* Forensic Analysis Upgrade Message */}\n                            {(metadata?.tier === 'free' ||\n                              metadata?.tier === 'basic') && (\n                              <section>\n                                <div className=\"p-6 text-center bg-black/20 rounded-lg border border-white/10\">\n                                  <ShieldCheck className=\"w-12 h-12 mx-auto mb-4 text-slate-500\" />\n                                  <h4 className=\"text-lg font-semibold text-white mb-2\">\n                                    Advanced Forensic Analysis\n                                  </h4>\n                                  <p className=\"text-slate-300 mb-4\">\n                                    Unlock steganography detection, manipulation\n                                    analysis, and AI content detection\n                                  </p>\n                                  <Button\n                                    variant=\"outline\"\n                                    onClick={() => setShowPayment(true)}\n                                    className=\"gap-2 border-primary text-primary hover:bg-primary/10\"\n                                  >\n                                    <ShieldCheck className=\"w-4 h-4\" />\n                                    Upgrade to Professional\n                                  </Button>\n                                </div>\n                              </section>\n                            )}\n                          </TabsContent>\n\n                          <TabsContent\n                            value=\"technical\"\n                            className=\"mt-0 space-y-6\"\n                          >\n                            <section>\n                              <SectionHeader\n                                icon={Camera}\n                                title=\"Camera Settings\"\n                                color=\"text-purple-400\"\n                              />\n                              {filterFields(metadata.exif || {}).length > 0 ? (\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1\">\n                                  {filterFields(metadata.exif || {}).map(\n                                    ([key, val], i) => (\n                                      <FieldRow\n                                        key={key}\n                                        label={key}\n                                        value={val}\n                                        index={i}\n                                      />\n                                    )\n                                  )}\n                                </div>\n                              ) : (\n                                <div className=\"text-gray-500 text-sm italic\">\n                                  No camera settings found in this image\n                                </div>\n                              )}\n                            </section>\n\n                            {Object.keys(metadata.interoperability || {})\n                              .length > 0 && (\n                              <section>\n                                <SectionHeader\n                                  icon={Tag}\n                                  title=\"Interoperability (IFD)\"\n                                  color=\"text-cyan-400\"\n                                  count={\n                                    Object.keys(metadata.interoperability || {})\n                                      .length\n                                  }\n                                />\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1\">\n                                  {filterFields(\n                                    metadata.interoperability || {}\n                                  ).map(([key, val], i) => (\n                                    <FieldRow\n                                      key={key}\n                                      label={key}\n                                      value={val}\n                                      index={i}\n                                    />\n                                  ))}\n                                </div>\n                              </section>\n                            )}\n\n                            {(metadata?.makernote?._count > 0 ||\n                              Object.keys(metadata?.makernote || {}).length >\n                                1) && (\n                              <section>\n                                <SectionHeader\n                                  icon={Tag}\n                                  title=\"MakerNote (Vendor-Specific)\"\n                                  color=\"text-orange-400\"\n                                  count={\n                                    metadata?.makernote?._count ||\n                                    Object.keys(metadata?.makernote || {})\n                                      .length\n                                  }\n                                />\n                                {!isSectionLocked(metadata?.makernote) &&\n                                isUnlocked ? (\n                                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1\">\n                                    {filterFields(metadata.makernote || {})\n                                      .slice(0, 50)\n                                      .map(([key, val], i) => (\n                                        <FieldRow\n                                          key={key}\n                                          label={key}\n                                          value={val}\n                                          index={i}\n                                        />\n                                      ))}\n                                  </div>\n                                ) : (\n                                  <div className=\"p-4 border border-dashed border-white/10 rounded bg-white/5 text-center\">\n                                    <Lock className=\"w-6 h-6 text-slate-600 mx-auto mb-2\" />\n                                    <p className=\"text-xs text-slate-300 font-mono mb-2\">\n                                      {metadata?.makernote?._count || 0}{' '}\n                                      VENDOR-SPECIFIC FIELDS LOCKED\n                                    </p>\n                                    <Button\n                                      variant=\"link\"\n                                      onClick={() => setShowPayment(true)}\n                                      className=\"text-primary text-xs h-auto p-0\"\n                                    >\n                                      UNLOCK_MAKERNOTES\n                                    </Button>\n                                  </div>\n                                )}\n                              </section>\n                            )}\n\n                            {Object.keys(metadata.iptc || {}).length > 0 && (\n                              <section>\n                                <SectionHeader\n                                  icon={Tag}\n                                  title=\"IPTC Metadata\"\n                                  color=\"text-indigo-400\"\n                                  count={\n                                    Object.keys(metadata.iptc || {}).length\n                                  }\n                                />\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1\">\n                                  {filterFields(metadata.iptc || {}).map(\n                                    ([key, val], i) => (\n                                      <FieldRow\n                                        key={key}\n                                        label={key}\n                                        value={val}\n                                        index={i}\n                                        locked={!isUnlocked}\n                                      />\n                                    )\n                                  )}\n                                </div>\n                              </section>\n                            )}\n\n                            {Object.keys(metadata.xmp || {}).length > 0 && (\n                              <section>\n                                <SectionHeader\n                                  icon={Tag}\n                                  title=\"XMP Metadata\"\n                                  color=\"text-pink-400\"\n                                  count={Object.keys(metadata.xmp || {}).length}\n                                />\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1\">\n                                  {filterFields(metadata.xmp || {}).map(\n                                    ([key, val], i) => (\n                                      <FieldRow\n                                        key={key}\n                                        label={key}\n                                        value={val}\n                                        index={i}\n                                        locked={!isUnlocked}\n                                      />\n                                    )\n                                  )}\n                                </div>\n                              </section>\n                            )}\n\n                            {(metadata?.xmp_namespaces?._locked ||\n                              Object.keys(flatXmpNamespaces).length > 0) && (\n                              <section>\n                                <SectionHeader\n                                  icon={Tag}\n                                  title=\"XMP Namespaces\"\n                                  color=\"text-fuchsia-400\"\n                                  count={\n                                    metadata?.xmp_namespaces?._count ||\n                                    Object.keys(flatXmpNamespaces).length\n                                  }\n                                />\n                                {!isSectionLocked(metadata?.xmp_namespaces) &&\n                                isUnlocked ? (\n                                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1\">\n                                    {filterFields(flatXmpNamespaces)\n                                      .slice(0, 80)\n                                      .map(([key, val], i) => (\n                                        <FieldRow\n                                          key={key}\n                                          label={key}\n                                          value={val}\n                                          index={i}\n                                        />\n                                      ))}\n                                  </div>\n                                ) : (\n                                  <div className=\"p-4 border border-dashed border-white/10 rounded bg-white/5 text-center\">\n                                    <Lock className=\"w-6 h-6 text-slate-600 mx-auto mb-2\" />\n                                    <p className=\"text-xs text-slate-300 font-mono mb-2\">\n                                      {metadata?.xmp_namespaces?._count || 0}{' '}\n                                      NAMESPACE FIELDS LOCKED\n                                    </p>\n                                    <Button\n                                      variant=\"link\"\n                                      onClick={() => setShowPayment(true)}\n                                      className=\"text-primary text-xs h-auto p-0\"\n                                    >\n                                      UNLOCK_XMP_NAMESPACES\n                                    </Button>\n                                  </div>\n                                )}\n                              </section>\n                            )}\n\n                            {Object.keys(metadata.icc_profile || {}).length >\n                              0 && (\n                              <section>\n                                <SectionHeader\n                                  icon={Tag}\n                                  title=\"ICC Profile\"\n                                  color=\"text-emerald-400\"\n                                  count={\n                                    Object.keys(metadata.icc_profile || {})\n                                      .length\n                                  }\n                                />\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1\">\n                                  {filterFields(metadata.icc_profile || {}).map(\n                                    ([key, val], i) => (\n                                      <FieldRow\n                                        key={key}\n                                        label={key}\n                                        value={val}\n                                        index={i}\n                                      />\n                                    )\n                                  )}\n                                </div>\n                              </section>\n                            )}\n\n                            {Object.keys(metadata.thumbnail_metadata || {})\n                              .length > 0 && (\n                              <section>\n                                <SectionHeader\n                                  icon={Tag}\n                                  title=\"Thumbnail Metadata\"\n                                  color=\"text-amber-400\"\n                                  count={\n                                    Object.keys(\n                                      metadata.thumbnail_metadata || {}\n                                    ).length\n                                  }\n                                />\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1\">\n                                  {filterFields(\n                                    metadata.thumbnail_metadata || {}\n                                  ).map(([key, val], i) => (\n                                    <FieldRow\n                                      key={key}\n                                      label={key}\n                                      value={val}\n                                      index={i}\n                                    />\n                                  ))}\n                                </div>\n                              </section>\n                            )}\n\n                            {(metadata?.embedded_thumbnails?._locked ||\n                              Object.keys(flatEmbeddedThumbnails).length >\n                                0) && (\n                              <section>\n                                <SectionHeader\n                                  icon={ImageIcon}\n                                  title=\"Embedded Thumbnails\"\n                                  color=\"text-yellow-400\"\n                                  count={\n                                    metadata?.embedded_thumbnails?._count ||\n                                    Object.keys(flatEmbeddedThumbnails).length\n                                  }\n                                />\n                                {!isSectionLocked(\n                                  metadata?.embedded_thumbnails\n                                ) && isUnlocked ? (\n                                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1\">\n                                    {filterFields(flatEmbeddedThumbnails).map(\n                                      ([key, val], i) => (\n                                        <FieldRow\n                                          key={key}\n                                          label={key}\n                                          value={val}\n                                          index={i}\n                                        />\n                                      )\n                                    )}\n                                  </div>\n                                ) : (\n                                  <div className=\"p-4 border border-dashed border-white/10 rounded bg-white/5 text-center\">\n                                    <Lock className=\"w-6 h-6 text-slate-600 mx-auto mb-2\" />\n                                    <p className=\"text-xs text-slate-300 font-mono mb-2\">\n                                      {metadata?.embedded_thumbnails?._count ||\n                                        0}{' '}\n                                      EMBEDDED THUMBNAILS LOCKED\n                                    </p>\n                                    <Button\n                                      variant=\"link\"\n                                      onClick={() => setShowPayment(true)}\n                                      className=\"text-primary text-xs h-auto p-0\"\n                                    >\n                                      UNLOCK_EMBEDDED_THUMBNAILS\n                                    </Button>\n                                  </div>\n                                )}\n                              </section>\n                            )}\n\n                            {Object.keys(metadata.image_container || {})\n                              .length > 0 && (\n                              <section>\n                                <SectionHeader\n                                  icon={Tag}\n                                  title=\"Image Container\"\n                                  color=\"text-blue-400\"\n                                  count={\n                                    Object.keys(metadata.image_container || {})\n                                      .length\n                                  }\n                                />\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1\">\n                                  {filterFields(\n                                    metadata.image_container || {}\n                                  ).map(([key, val], i) => (\n                                    <FieldRow\n                                      key={key}\n                                      label={key}\n                                      value={val}\n                                      index={i}\n                                    />\n                                  ))}\n                                </div>\n                              </section>\n                            )}\n\n                            {(metadata?.scientific?._locked ||\n                              Object.keys(flatScientific).length > 0) && (\n                              <section>\n                                <SectionHeader\n                                  icon={Database}\n                                  title=\"Scientific Metadata\"\n                                  color=\"text-sky-400\"\n                                  count={\n                                    metadata?.scientific?._count ||\n                                    Object.keys(flatScientific).length\n                                  }\n                                />\n                                {!isSectionLocked(metadata?.scientific) ? (\n                                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1\">\n                                    {filterFields(flatScientific).map(\n                                      ([key, val], i) => (\n                                        <FieldRow\n                                          key={key}\n                                          label={key}\n                                          value={val}\n                                          index={i}\n                                        />\n                                      )\n                                    )}\n                                  </div>\n                                ) : (\n                                  <div className=\"p-4 border border-dashed border-white/10 rounded bg-white/5 text-center\">\n                                    <Lock className=\"w-6 h-6 text-slate-600 mx-auto mb-2\" />\n                                    <p className=\"text-xs text-slate-300 font-mono mb-2\">\n                                      SCIENTIFIC_METADATA_LOCKED\n                                    </p>\n                                    <Button\n                                      variant=\"link\"\n                                      onClick={() => setShowPayment(true)}\n                                      className=\"text-primary text-xs h-auto p-0\"\n                                    >\n                                      UNLOCK_SCIENTIFIC_METADATA\n                                    </Button>\n                                  </div>\n                                )}\n                              </section>\n                            )}\n\n                            {(metadata?.scientific_data?._locked ||\n                              Object.keys(flatScientificData).length > 0) && (\n                              <section>\n                                <SectionHeader\n                                  icon={FileText}\n                                  title=\"Scientific Data (HDF5/NetCDF)\"\n                                  color=\"text-emerald-400\"\n                                  count={\n                                    metadata?.scientific_data?._count ||\n                                    Object.keys(flatScientificData).length\n                                  }\n                                />\n                                {!isSectionLocked(metadata?.scientific_data) ? (\n                                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1\">\n                                    {filterFields(flatScientificData).map(\n                                      ([key, val], i) => (\n                                        <FieldRow\n                                          key={key}\n                                          label={key}\n                                          value={val}\n                                          index={i}\n                                        />\n                                      )\n                                    )}\n                                  </div>\n                                ) : (\n                                  <div className=\"p-4 border border-dashed border-white/10 rounded bg-white/5 text-center\">\n                                    <Lock className=\"w-6 h-6 text-slate-600 mx-auto mb-2\" />\n                                    <p className=\"text-xs text-slate-300 font-mono mb-2\">\n                                      SCIENTIFIC_DATA_LOCKED\n                                    </p>\n                                    <Button\n                                      variant=\"link\"\n                                      onClick={() => setShowPayment(true)}\n                                      className=\"text-primary text-xs h-auto p-0\"\n                                    >\n                                      UNLOCK_SCIENTIFIC_DATA\n                                    </Button>\n                                  </div>\n                                )}\n                              </section>\n                            )}\n\n                            {Object.keys(flatTelemetry).length > 0 && (\n                              <section>\n                                <SectionHeader\n                                  icon={Zap}\n                                  title=\"Video Telemetry\"\n                                  color=\"text-rose-400\"\n                                  count={Object.keys(flatTelemetry).length}\n                                />\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1\">\n                                  {filterFields(flatTelemetry).map(\n                                    ([key, val], i) => (\n                                      <FieldRow\n                                        key={key}\n                                        label={key}\n                                        value={val}\n                                        index={i}\n                                      />\n                                    )\n                                  )}\n                                </div>\n                              </section>\n                            )}\n\n                            {Object.keys(flatCamera360).length > 0 && (\n                              <section>\n                                <SectionHeader\n                                  icon={Camera}\n                                  title=\"360 / Panorama\"\n                                  color=\"text-teal-400\"\n                                  count={Object.keys(flatCamera360).length}\n                                />\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1\">\n                                  {filterFields(flatCamera360).map(\n                                    ([key, val], i) => (\n                                      <FieldRow\n                                        key={key}\n                                        label={key}\n                                        value={val}\n                                        index={i}\n                                      />\n                                    )\n                                  )}\n                                </div>\n                              </section>\n                            )}\n                          </TabsContent>\n\n                          <TabsContent value=\"raw\" className=\"mt-0\">\n                            {isUnlocked ? (\n                              <div className=\"font-mono text-xs text-slate-300\">\n                                <div className=\"mb-4 text-xs text-slate-500 uppercase tracking-widest\">\n                                  Extended Fields:{' '}\n                                  {Object.keys(metadata?.extended || {}).length}\n                                </div>\n                                <div className=\"space-y-1\">\n                                  {filterFields(metadata.extended || {})\n                                    .slice(0, 200)\n                                    .map(([key, val], i) => (\n                                      <FieldRow\n                                        key={key}\n                                        label={key}\n                                        value={val}\n                                        index={i}\n                                      />\n                                    ))}\n                                  {filterFields(metadata.extended || {})\n                                    .length > 200 && (\n                                    <div className=\"py-4 text-center text-slate-600 italic\">\n                                      ...{' '}\n                                      {Object.keys(metadata.extended || {})\n                                        .length - 200}{' '}\n                                      more fields in JSON export ...\n                                    </div>\n                                  )}\n                                </div>\n                              </div>\n                            ) : (\n                              <div className=\"flex flex-col items-center justify-center h-[400px] text-center\">\n                                <Database className=\"w-16 h-16 text-white/5 mb-4\" />\n                                <h3 className=\"text-lg font-bold text-white font-mono mb-2\">\n                                  RAW_DATA_LOCKED\n                                </h3>\n                                <p className=\"text-slate-500 max-w-sm mb-6 text-sm\">\n                                  Access to{' '}\n                                  {Object.keys(metadata?.extended || {}).length}{' '}\n                                  extended metadata fields including MakerNotes,\n                                  IPTC, XMP, and proprietary tags requires a\n                                  license.\n                                </p>\n                                <Button\n                                  onClick={() => setShowPayment(true)}\n                                  className=\"bg-primary text-black\"\n                                  data-testid=\"button-purchase-raw\"\n                                >\n                                  PURCHASE_LICENSE ($5.00)\n                                </Button>\n                              </div>\n                            )}\n                          </TabsContent>\n                        </div>\n                      </ScrollArea>\n                    </div>\n                  </Tabs>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <PaymentModal\n            isOpen={showPayment}\n            onClose={() => setShowPayment(false)}\n            onSuccess={onPaymentSuccess}\n          />\n        </ErrorBoundary>\n      </Layout>\n    </UIAdaptationProvider>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/terms-of-service.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cn' is defined but never used.","line":13,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'theme' is assigned a value but never used.","line":16,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loading' is assigned a value but never used.","line":18,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":17},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":37,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":37,"endColumn":20,"suggestions":[{"fix":{"range":[1265,1320],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/*\n * Terms of Service Page Component\n * Displays the terms of service for MetaExtract\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { Link } from 'react-router-dom';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { useTheme } from 'next-themes';\nimport { Shield, FileText, Download, ExternalLink } from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\nexport default function TermsOfServicePage() {\n  const { theme } = useTheme();\n  const [termsContent, setTermsContent] = useState('');\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    // In a real implementation, this would fetch from the API\n    // For now, we'll use a static version\n    fetchTermsOfService();\n  }, []);\n\n  const fetchTermsOfService = async () => {\n    try {\n      // Simulate API call\n      const response = await fetch('/api/legal/terms');\n      if (!response.ok) {\n        throw new Error('Failed to fetch terms of service');\n      }\n      const data = await response.json();\n      setTermsContent(data.content);\n    } catch (err) {\n      console.error('Error fetching terms of service:', err);\n      setError('Could not load terms of service. Please try again later.');\n      // Use a default terms content as fallback\n      setTermsContent(defaultTermsOfServiceContent);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleDownload = () => {\n    // Create a blob with the terms content and download it\n    const blob = new Blob([termsContent], { type: 'text/plain' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = 'metaextract-terms-of-service.txt';\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  };\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 p-4\">\n        <Card className=\"w-full max-w-4xl\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2 text-red-600\">\n              <Shield className=\"w-5 h-5\" />\n              Terms of Service Error\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-red-500 mb-4\">{error}</p>\n            <p className=\"text-gray-600 dark:text-gray-400 mb-6\">\n              Please try again later or contact support if the problem persists.\n            </p>\n            <Button onClick={() => window.location.reload()}>\n              Retry Loading\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 py-12 px-4\">\n      <div className=\"max-w-4xl mx-auto\">\n        <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-2\">\n              <FileText className=\"w-8 h-8 text-blue-600\" />\n              Terms of Service\n            </h1>\n            <p className=\"text-gray-600 dark:text-gray-400 mt-2\">\n              Last Updated: {new Date().toLocaleDateString()}\n            </p>\n          </div>\n          <Button onClick={handleDownload} variant=\"outline\" className=\"flex items-center gap-2\">\n            <Download className=\"w-4 h-4\" />\n            Download\n          </Button>\n        </div>\n\n        <Card className=\"shadow-lg\">\n          <CardHeader className=\"border-b border-gray-200 dark:border-gray-700\">\n            <CardTitle className=\"text-xl text-gray-800 dark:text-gray-200\">\n              Service Terms\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"p-6\">\n            <ScrollArea className=\"h-[60vh] pr-4\">\n              <div className=\"prose prose-gray dark:prose-invert max-w-none\">\n                <div dangerouslySetInnerHTML={{ __html: termsContent }} />\n              </div>\n            </ScrollArea>\n          </CardContent>\n        </Card>\n\n        <div className=\"mt-8 flex flex-wrap gap-4 justify-center\">\n          <Button variant=\"outline\" asChild>\n            <Link to=\"/privacy\" className=\"flex items-center gap-2\">\n              <Shield className=\"w-4 h-4\" />\n              Privacy Policy\n            </Link>\n          </Button>\n          <Button variant=\"outline\" asChild>\n            <a\n              href=\"mailto:support@metaextract.com?subject=MetaExtract%20Support\"\n              className=\"flex items-center gap-2\"\n            >\n              <ExternalLink className=\"w-4 h-4\" />\n              Contact Support\n            </a>\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// Default terms of service content as fallback\nconst defaultTermsOfServiceContent = `\n<h1>Terms of Service for MetaExtract</h1>\n\n<p><strong>Last Updated:</strong> ${new Date().toISOString().split('T')[0]}</p>\n\n<h2>Acceptance of Terms</h2>\n<p>By accessing and using MetaExtract, you accept and agree to be bound by the terms and provisions of this agreement.</p>\n\n<h2>Description of Service</h2>\n<p>MetaExtract provides comprehensive metadata extraction services for various file types including images, videos, documents, and more.</p>\n\n<h2>User Responsibilities</h2>\n\n<h3>Acceptable Use</h3>\n<ul>\n<li>Use the service in compliance with applicable laws</li>\n<li>Respect intellectual property rights</li>\n<li>Do not upload illegal content</li>\n<li>Do not attempt to circumvent security measures</li>\n</ul>\n\n<h3>Prohibited Activities</h3>\n<ul>\n<li>Uploading copyrighted material without permission</li>\n<li>Using the service for illegal activities</li>\n<li>Attempting to disrupt service operations</li>\n<li>Scraping or reverse engineering the service</li>\n</ul>\n\n<h2>Intellectual Property</h2>\n<p>The service and its original content, features, and functionality are owned by MetaExtract and are protected by international copyright, trademark, and other intellectual property laws.</p>\n\n<h2>Limitation of Liability</h2>\n<p>In no event shall MetaExtract, nor its directors, employees, partners, agents, suppliers, or affiliates, be liable for any indirect, incidental, special, consequential, or punitive damages.</p>\n\n<h2>Termination</h2>\n<p>We may terminate or suspend your account immediately, without prior notice, for any reason whatsoever, including without limitation if you breach the Terms.</p>\n\n<h2>Refund Policy (Credit Packs)</h2>\n<p><strong>Refunds are available within 7 days of purchase for unused credit packs only.</strong> If any credits are used, the purchase is non-refundable. Credits do not expire.</p>\n\n<h2>Governing Law</h2>\n<p>These Terms shall be governed and construed in accordance with the laws of [Jurisdiction], without regard to its conflict of law provisions.</p>\n\n<h2>Contact Information</h2>\n<p>If you have any questions about these Terms, please contact us at:</p>\n<p>Email: legal@metaextract.com<br />\nAddress: [Company Address]</p>\n`;\n\nexport { defaultTermsOfServiceContent };\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/pages/timeline-view.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Card' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardContent' is defined but never used.","line":2,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardHeader' is defined but never used.","line":2,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardTitle' is defined but never used.","line":2,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":50}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Timeline } from '@/components/v2-results/Timeline';\n\ninterface TimelineEvent {\n  id: string;\n  timestamp: string;\n  eventType: string;\n  description: string;\n  location?: string;\n  confidence?: number;\n  source: string;\n  tags?: string[];\n}\n\nconst TimelineViewPage: React.FC = () => {\n  const [events, setEvents] = useState<TimelineEvent[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  // Mock data for demonstration\n  useEffect(() => {\n    // Simulate loading timeline data\n    const mockEvents: TimelineEvent[] = [\n      {\n        id: '1',\n        timestamp: '2025-01-04T10:30:00Z',\n        eventType: 'file creation',\n        description: 'Original image file created',\n        location: 'New York, NY',\n        confidence: 95,\n        source: 'Camera EXIF data',\n        tags: ['original', 'capture']\n      },\n      {\n        id: '2',\n        timestamp: '2025-01-04T10:31:15Z',\n        eventType: 'location',\n        description: 'GPS coordinates recorded',\n        location: 'New York, NY',\n        confidence: 98,\n        source: 'GPS sensor',\n        tags: ['gps', 'coordinates']\n      },\n      {\n        id: '3',\n        timestamp: '2025-01-04T10:32:30Z',\n        eventType: 'capture',\n        description: 'Photo captured with Canon EOS R5',\n        location: 'New York, NY',\n        confidence: 92,\n        source: 'Camera make/model',\n        tags: ['camera', 'capture']\n      },\n      {\n        id: '4',\n        timestamp: '2025-01-04T11:15:22Z',\n        eventType: 'transfer',\n        description: 'File transferred to computer',\n        confidence: 88,\n        source: 'File system timestamp',\n        tags: ['transfer', 'computer']\n      },\n      {\n        id: '5',\n        timestamp: '2025-01-04T12:45:10Z',\n        eventType: 'extraction',\n        description: 'Metadata extracted using MetaExtract',\n        confidence: 96,\n        source: 'MetaExtract analysis',\n        tags: ['analysis', 'metadata']\n      },\n      {\n        id: '6',\n        timestamp: '2025-01-04T13:20:05Z',\n        eventType: 'modification',\n        description: 'File edited in photo editor',\n        confidence: 75,\n        source: 'File modification timestamp',\n        tags: ['edit', 'modification']\n      },\n      {\n        id: '7',\n        timestamp: '2025-01-04T14:30:45Z',\n        eventType: 'upload',\n        description: 'File uploaded to cloud storage',\n        confidence: 90,\n        source: 'Cloud service log',\n        tags: ['upload', 'cloud']\n      }\n    ];\n\n    setTimeout(() => {\n      setEvents(mockEvents);\n      setLoading(false);\n    }, 800);\n  }, []);\n\n  if (loading) {\n    return (\n      <div className=\"container mx-auto py-8 px-4\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold text-white mb-2\">Timeline View</h1>\n          <p className=\"text-slate-300\">Reconstructing the chronological sequence of events</p>\n        </div>\n        \n        <div className=\"flex items-center justify-center py-12\">\n          <div className=\"text-center\">\n            <div className=\"inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary mb-4\"></div>\n            <p className=\"text-white\">Loading timeline data...</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto py-8 px-4\">\n      <div className=\"mb-8\">\n        <h1 className=\"text-3xl font-bold text-white mb-2\">Timeline View</h1>\n        <p className=\"text-slate-300\">Reconstructed chronological sequence of events for the selected file</p>\n      </div>\n\n      <Timeline \n        events={events} \n        title=\"File History Timeline\" \n      />\n    </div>\n  );\n};\n\nexport default TimelineViewPage;","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/utils/api-error-handler.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/utils/educationalExamples.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/utils/fieldExplanations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/utils/fileAnalysis.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/utils/metadataCategories.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":221,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":221,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5901,5904],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5901,5904],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":222,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":222,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5939,5942],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5939,5942],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":223,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":223,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5994,5997],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5994,5997],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Metadata Category Definitions\n * \n * Logical grouping of metadata fields to reduce overwhelm and improve\n * navigation for users exploring 7,000+ metadata fields.\n */\n\nimport { \n  Camera, \n  MapPin, \n  HardDrive, \n  Settings, \n  Palette, \n  FileText, \n  Edit3, \n  Shield, \n  Wrench,\n  LucideIcon\n} from 'lucide-react';\n\nexport interface CategoryDefinition {\n  /** Internal category key */\n  key: string;\n  \n  /** Display name shown to users */\n  displayName: string;\n  \n  /** Icon component */\n  icon: LucideIcon;\n  \n  /** Brief description of what's in this category */\n  description: string;\n  \n  /** Field key patterns that belong to this category */\n  fieldPatterns: string[];\n  \n  /** Whether this category should be expanded by default */\n  expandedByDefault: boolean;\n  \n  /** Priority order (lower = shown higher in list) */\n  priority: number;\n}\n\n/**\n * Logical category definitions for metadata organization\n */\nexport const METADATA_CATEGORIES: CategoryDefinition[] = [\n  {\n    key: 'capture',\n    displayName: ' Capture Settings',\n    icon: Camera,\n    description: 'Camera settings when photo was taken',\n    fieldPatterns: [\n      'iso', 'aperture', 'fnumber', 'shutterspeed', 'exposuretime',\n      'focallength', 'flash', 'meteringmode', 'exposuremode',\n      'exposurecompensation', 'brightness', 'contrast', 'saturation',\n      'sharpness', 'scenetype', 'lightsource'\n    ],\n    expandedByDefault: true,\n    priority: 1\n  },\n  {\n    key: 'location',\n    displayName: ' Location & Time',\n    icon: MapPin,\n    description: 'When and where the photo was taken',\n    fieldPatterns: [\n      'gps', 'latitude', 'longitude', 'altitude', 'datetime',\n      'date', 'time', 'timezone', 'location', 'city', 'country',\n      'datetimeoriginal', 'createdate', 'modifydate'\n    ],\n    expandedByDefault: true,\n    priority: 2\n  },\n  {\n    key: 'file',\n    displayName: ' File Information',\n    icon: HardDrive,\n    description: 'File properties and technical details',\n    fieldPatterns: [\n      'filesize', 'filename', 'filetype', 'mimetype', 'extension',\n      'width', 'height', 'dimension', 'resolution', 'bitdepth',\n      'compression', 'encoding', 'format'\n    ],\n    expandedByDefault: true,\n    priority: 3\n  },\n  {\n    key: 'camera',\n    displayName: ' Camera & Lens Details',\n    icon: Settings,\n    description: 'Equipment used to capture the image',\n    fieldPatterns: [\n      'make', 'model', 'serialnumber', 'lens', 'lensmodel',\n      'lensmake', 'lensserial', 'firmware', 'software',\n      'orientation', 'cameraserialnumber', 'internalserialnumber',\n      'shuttercount', 'imagecount'\n    ],\n    expandedByDefault: false,\n    priority: 4\n  },\n  {\n    key: 'color',\n    displayName: ' Color & Processing',\n    icon: Palette,\n    description: 'Color profiles and in-camera processing',\n    fieldPatterns: [\n      'colorspace', 'whitebalance', 'colortemperature', 'tint',\n      'icc', 'profile', 'gamma', 'colormatrix', 'calibration',\n      'renderingintent', 'chromaticity'\n    ],\n    expandedByDefault: false,\n    priority: 5\n  },\n  {\n    key: 'professional',\n    displayName: ' Professional Metadata',\n    icon: FileText,\n    description: 'IPTC, keywords, copyright, and captions',\n    fieldPatterns: [\n      'iptc', 'keyword', 'caption', 'description', 'title',\n      'copyright', 'artist', 'creator', 'credit', 'byline',\n      'headline', 'instructions', 'category', 'subject',\n      'usageterms', 'rights'\n    ],\n    expandedByDefault: false,\n    priority: 6\n  },\n  {\n    key: 'editing',\n    displayName: ' Edit History',\n    icon: Edit3,\n    description: 'Software edits and modification history',\n    fieldPatterns: [\n      'xmp', 'history', 'photoshop', 'lightroom', 'edited',\n      'software', 'application', 'creator', 'processingdate',\n      'historyaction', 'historyparameters', 'rawfilename',\n      'derivedfrom', 'documentid'\n    ],\n    expandedByDefault: false,\n    priority: 7\n  },\n  {\n    key: 'security',\n    displayName: ' Security & Integrity',\n    icon: Shield,\n    description: 'File hashes and verification',\n    fieldPatterns: [\n      'md5', 'sha', 'hash', 'checksum', 'signature',\n      'certificate', 'encryption', 'verified'\n    ],\n    expandedByDefault: false,\n    priority: 8\n  },\n  {\n    key: 'advanced',\n    displayName: ' Advanced Technical',\n    icon: Wrench,\n    description: 'MakerNotes and low-level technical data',\n    fieldPatterns: [\n      'makernote', 'exif', 'subifd', 'ifd', 'tag',\n      'binary', 'hex', 'raw', 'proprietary', 'vendor',\n      'canon', 'nikon', 'sony', 'fuji', 'olympus'\n    ],\n    expandedByDefault: false,\n    priority: 9\n  }\n];\n\n/**\n * Categorize a metadata field based on its key\n */\nexport function categorizeField(fieldKey: string): string {\n  const normalizedKey = fieldKey.toLowerCase();\n  \n  // Find matching category\n  for (const category of METADATA_CATEGORIES) {\n    for (const pattern of category.fieldPatterns) {\n      if (normalizedKey.includes(pattern)) {\n        return category.key;\n      }\n    }\n  }\n  \n  // Default to advanced if no match\n  return 'advanced';\n}\n\n/**\n * Get category definition by key\n */\nexport function getCategoryDefinition(key: string): CategoryDefinition | undefined {\n  return METADATA_CATEGORIES.find(cat => cat.key === key);\n}\n\n/**\n * Get default expanded categories\n */\nexport function getDefaultExpandedCategories(): string[] {\n  return METADATA_CATEGORIES\n    .filter(cat => cat.expandedByDefault)\n    .map(cat => cat.key);\n}\n\n/**\n * Sort categories by priority\n */\nexport function sortCategories(categoryKeys: string[]): string[] {\n  return categoryKeys.sort((a, b) => {\n    const catA = getCategoryDefinition(a);\n    const catB = getCategoryDefinition(b);\n    if (!catA || !catB) return 0;\n    return catA.priority - catB.priority;\n  });\n}\n\n/**\n * Group metadata fields by category\n */\nexport function groupFieldsByCategory(\n  fields: Record<string, any>\n): Record<string, Record<string, any>> {\n  const grouped: Record<string, Record<string, any>> = {};\n  \n  // Initialize all categories\n  METADATA_CATEGORIES.forEach(cat => {\n    grouped[cat.key] = {};\n  });\n  \n  // Assign fields to categories\n  Object.entries(fields).forEach(([key, value]) => {\n    const category = categorizeField(key);\n    grouped[category][key] = value;\n  });\n  \n  // Remove empty categories\n  Object.keys(grouped).forEach(key => {\n    if (Object.keys(grouped[key]).length === 0) {\n      delete grouped[key];\n    }\n  });\n  \n  return grouped;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/utils/metadataSearch.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[671,674],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[671,674],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":128,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3056,3059],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3056,3059],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'categories' is assigned a value but never used.","line":132,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":132,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":205,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5327,5330],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5327,5330],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":253,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":253,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6403,6406],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6403,6406],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":255,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":255,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6454,6457],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6454,6457],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":256,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":256,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6494,6497],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6494,6497],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":309,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":309,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7873,7876],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7873,7876],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Search Utilities for Metadata\n * \n * Intelligent search and filtering across metadata fields with\n * fuzzy matching, category filtering, and value search.\n */\n\nexport interface SearchOptions {\n  /** Search query string */\n  query: string;\n  \n  /** Filter by specific categories */\n  categories?: string[];\n  \n  /** Search in field names only */\n  fieldsOnly?: boolean;\n  \n  /** Search in values only */\n  valuesOnly?: boolean;\n  \n  /** Case sensitive search */\n  caseSensitive?: boolean;\n  \n  /** Use fuzzy matching */\n  fuzzyMatch?: boolean;\n}\n\nexport interface SearchResult {\n  /** Matching field key */\n  fieldKey: string;\n  \n  /** Field value */\n  fieldValue: any;\n  \n  /** Category this field belongs to */\n  category: string;\n  \n  /** Match score (0-1, higher is better) */\n  score: number;\n  \n  /** What matched (field name, value, or both) */\n  matchType: 'field' | 'value' | 'both';\n  \n  /** Highlighted match for display */\n  highlightedField?: string;\n  highlightedValue?: string;\n}\n\n/**\n * Calculate Levenshtein distance for fuzzy matching\n */\nfunction levenshteinDistance(str1: string, str2: string): number {\n  const matrix: number[][] = [];\n  \n  for (let i = 0; i <= str2.length; i++) {\n    matrix[i] = [i];\n  }\n  \n  for (let j = 0; j <= str1.length; j++) {\n    matrix[0][j] = j;\n  }\n  \n  for (let i = 1; i <= str2.length; i++) {\n    for (let j = 1; j <= str1.length; j++) {\n      if (str2.charAt(i - 1) === str1.charAt(j - 1)) {\n        matrix[i][j] = matrix[i - 1][j - 1];\n      } else {\n        matrix[i][j] = Math.min(\n          matrix[i - 1][j - 1] + 1, // substitution\n          matrix[i][j - 1] + 1,     // insertion\n          matrix[i - 1][j] + 1      // deletion\n        );\n      }\n    }\n  }\n  \n  return matrix[str2.length][str1.length];\n}\n\n/**\n * Calculate fuzzy match score (0-1, higher is better)\n */\nfunction fuzzyMatchScore(query: string, target: string, caseSensitive = false): number {\n  const q = caseSensitive ? query : query.toLowerCase();\n  const t = caseSensitive ? target : target.toLowerCase();\n  \n  // Exact match\n  if (t === q) return 1.0;\n  \n  // Starts with\n  if (t.startsWith(q)) return 0.9;\n  \n  // Contains\n  if (t.includes(q)) return 0.8;\n  \n  // Fuzzy match with Levenshtein\n  const distance = levenshteinDistance(q, t);\n  const maxLength = Math.max(q.length, t.length);\n  const similarity = 1 - (distance / maxLength);\n  \n  // Only return scores above threshold\n  return similarity > 0.6 ? similarity * 0.7 : 0;\n}\n\n/**\n * Highlight matching parts of text\n */\nfunction highlightMatch(text: string, query: string, caseSensitive = false): string {\n  if (!query) return text;\n  \n  const q = caseSensitive ? query : query.toLowerCase();\n  const t = caseSensitive ? text : text.toLowerCase();\n  \n  const index = t.indexOf(q);\n  if (index === -1) return text;\n  \n  return (\n    text.slice(0, index) +\n    '<mark>' + text.slice(index, index + query.length) + '</mark>' +\n    text.slice(index + query.length)\n  );\n}\n\n/**\n * Search metadata fields\n */\nexport function searchMetadata(\n  metadata: Record<string, any>,\n  options: SearchOptions\n): SearchResult[] {\n  const results: SearchResult[] = [];\n  const { query, categories, fieldsOnly, valuesOnly, caseSensitive, fuzzyMatch } = options;\n  \n  if (!query || query.trim().length === 0) {\n    return results;\n  }\n  \n  const searchQuery = caseSensitive ? query : query.toLowerCase();\n  \n  // Search through all fields\n  Object.entries(metadata).forEach(([key, value]) => {\n    // Skip internal fields\n    if (key.startsWith('_')) return;\n    \n    const fieldText = caseSensitive ? key : key.toLowerCase();\n    const valueText = caseSensitive \n      ? String(value) \n      : String(value).toLowerCase();\n    \n    let fieldScore = 0;\n    let valueScore = 0;\n    let matchType: 'field' | 'value' | 'both' = 'field';\n    \n    // Search in field name\n    if (!valuesOnly) {\n      if (fuzzyMatch) {\n        fieldScore = fuzzyMatchScore(searchQuery, fieldText, caseSensitive);\n      } else {\n        fieldScore = fieldText.includes(searchQuery) ? 1.0 : 0;\n      }\n    }\n    \n    // Search in value\n    if (!fieldsOnly && value !== null && value !== undefined) {\n      if (fuzzyMatch) {\n        valueScore = fuzzyMatchScore(searchQuery, valueText, caseSensitive);\n      } else {\n        valueScore = valueText.includes(searchQuery) ? 0.8 : 0;\n      }\n    }\n    \n    // Determine match type and score\n    const hasFieldMatch = fieldScore > 0;\n    const hasValueMatch = valueScore > 0;\n    \n    if (!hasFieldMatch && !hasValueMatch) return;\n    \n    if (hasFieldMatch && hasValueMatch) {\n      matchType = 'both';\n    } else if (hasValueMatch) {\n      matchType = 'value';\n    }\n    \n    const finalScore = Math.max(fieldScore, valueScore);\n    \n    results.push({\n      fieldKey: key,\n      fieldValue: value,\n      category: '', // Will be set by caller\n      score: finalScore,\n      matchType,\n      highlightedField: hasFieldMatch ? highlightMatch(key, query, caseSensitive) : undefined,\n      highlightedValue: hasValueMatch ? highlightMatch(String(value), query, caseSensitive) : undefined\n    });\n  });\n  \n  // Sort by score (highest first)\n  return results.sort((a, b) => b.score - a.score);\n}\n\n/**\n * Search across categorized metadata\n */\nexport function searchCategorizedMetadata(\n  categorizedData: Record<string, Record<string, any>>,\n  options: SearchOptions\n): SearchResult[] {\n  const results: SearchResult[] = [];\n  \n  Object.entries(categorizedData).forEach(([category, fields]) => {\n    // Filter by category if specified\n    if (options.categories && !options.categories.includes(category)) {\n      return;\n    }\n    \n    const categoryResults = searchMetadata(fields, options);\n    \n    // Add category to results\n    categoryResults.forEach(result => {\n      results.push({\n        ...result,\n        category\n      });\n    });\n  });\n  \n  // Sort by score\n  return results.sort((a, b) => b.score - a.score);\n}\n\n/**\n * Filter metadata by criteria\n */\nexport interface FilterCriteria {\n  /** Has value (not null/undefined/empty) */\n  hasValue?: boolean;\n  \n  /** Value type */\n  valueType?: 'string' | 'number' | 'boolean' | 'object' | 'array';\n  \n  /** Min value (for numbers) */\n  minValue?: number;\n  \n  /** Max value (for numbers) */\n  maxValue?: number;\n  \n  /** String length range */\n  minLength?: number;\n  maxLength?: number;\n}\n\nexport function filterMetadata(\n  metadata: Record<string, any>,\n  criteria: FilterCriteria\n): Record<string, any> {\n  const filtered: Record<string, any> = {};\n  \n  Object.entries(metadata).forEach(([key, value]) => {\n    let include = true;\n    \n    // Check has value\n    if (criteria.hasValue !== undefined) {\n      const hasVal = value !== null && value !== undefined && value !== '';\n      if (criteria.hasValue !== hasVal) {\n        include = false;\n      }\n    }\n    \n    // Check value type\n    if (include && criteria.valueType) {\n      const actualType = Array.isArray(value) ? 'array' : typeof value;\n      if (actualType !== criteria.valueType) {\n        include = false;\n      }\n    }\n    \n    // Check numeric range\n    if (include && typeof value === 'number') {\n      if (criteria.minValue !== undefined && value < criteria.minValue) {\n        include = false;\n      }\n      if (criteria.maxValue !== undefined && value > criteria.maxValue) {\n        include = false;\n      }\n    }\n    \n    // Check string length\n    if (include && typeof value === 'string') {\n      if (criteria.minLength !== undefined && value.length < criteria.minLength) {\n        include = false;\n      }\n      if (criteria.maxLength !== undefined && value.length > criteria.maxLength) {\n        include = false;\n      }\n    }\n    \n    if (include) {\n      filtered[key] = value;\n    }\n  });\n  \n  return filtered;\n}\n\n/**\n * Get search suggestions based on partial query\n */\nexport function getSearchSuggestions(\n  metadata: Record<string, any>,\n  partialQuery: string,\n  limit = 5\n): string[] {\n  if (!partialQuery || partialQuery.length < 2) {\n    return [];\n  }\n  \n  const query = partialQuery.toLowerCase();\n  const suggestions = new Set<string>();\n  \n  // Add matching field names\n  Object.keys(metadata).forEach(key => {\n    if (key.toLowerCase().includes(query)) {\n      suggestions.add(key);\n    }\n  });\n  \n  // Convert to array and limit\n  return Array.from(suggestions).slice(0, limit);\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/utils/metadataTransformers.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1343,1346],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1343,1346],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1823,1826],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1823,1826],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":95,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":95,"endColumn":17,"suggestions":[{"fix":{"range":[2720,2770],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":167,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":167,"endColumn":20,"suggestions":[{"fix":{"range":[5171,5240],"text":""},"messageId":"removeConsole","data":{"propertyName":"debug"},"desc":"Remove the console.debug()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":201,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":201,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5993,5996],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5993,5996],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":218,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":218,"endColumn":17,"suggestions":[{"fix":{"range":[6483,6533],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":244,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":244,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7161,7164],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7161,7164],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":263,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":263,"endColumn":17,"suggestions":[{"fix":{"range":[7712,7765],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'idx' is defined but never used. Allowed unused args must match /^_/u.","line":289,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":289,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":307,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":307,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8900,8903],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8900,8903],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":336,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":336,"endColumn":17,"suggestions":[{"fix":{"range":[9630,9678],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":345,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":345,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9843,9846],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9843,9846],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":359,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":359,"endColumn":17,"suggestions":[{"fix":{"range":[10236,10289],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":368,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":368,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10460,10463],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10460,10463],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'checksPerformed' is assigned a value but never used.","line":418,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":418,"endColumn":20},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":423,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":423,"endColumn":17,"suggestions":[{"fix":{"range":[11871,11932],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":432,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":432,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12141,12144],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12141,12144],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":475,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":475,"endColumn":17,"suggestions":[{"fix":{"range":[13183,13236],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":483,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":483,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13358,13361],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13358,13361],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":522,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":522,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14632,14635],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14632,14635],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":20,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Metadata Transformers\n *\n * Convert raw technical metadata into user-friendly insights and findings.\n * This module translates metadata into plain English answers to key questions:\n * - When was this captured?\n * - Where was it captured?\n * - What device captured it?\n * - Is it authentic?\n */\n\n/**\n * Key findings extracted from metadata\n */\nexport interface KeyFindings {\n  when: string | null; // \"January 3, 2025 at 3:45 PM\"\n  where: string | null; // \"San Francisco, California\"\n  device: string | null; // \"iPhone 15 Pro\"\n  edited: boolean; // false\n  authenticity: string; // \"Appears authentic\"\n  confidence: 'high' | 'medium' | 'low';\n}\n\n/**\n * Enhanced location information\n */\nexport interface EnhancedLocation {\n  formatted: string; // \"San Francisco, CA, USA\"\n  coordinates: string; // \"37.7749 N, 122.4194 W\"\n  mapUrl: string; // Google Maps URL\n  confidence: 'high' | 'medium' | 'low';\n  country?: string;\n  region?: string;\n  city?: string;\n}\n\n/**\n * Quick details for summary display\n */\nexport interface QuickDetails {\n  resolution: string; // \"12.2 megapixels\"\n  fileSize: string; // \"3.2 MB\"\n  cameraSettings: string; // \"f/1.6, 1/120s, ISO 64\"\n  colorSpace: string; // \"sRGB\"\n  dimensions: string; // \"4032 x 3024\"\n}\n\n/**\n * Extract key findings from raw metadata\n */\nexport function extractKeyFindings(metadata: any): KeyFindings {\n  const findings: KeyFindings = {\n    when: formatDateTimeOriginal(metadata),\n    where: extractLocation(metadata),\n    device: formatDeviceName(metadata),\n    edited: detectEditing(metadata),\n    authenticity: assessAuthenticity(metadata),\n    confidence: calculateConfidence(metadata),\n  };\n\n  return findings;\n}\n\n/**\n * Format datetime original into readable format\n * e.g., \"January 3, 2025 at 3:45 PM\"\n */\nexport function formatDateTimeOriginal(metadata: any): string | null {\n  try {\n    // Try EXIF DateTimeOriginal first (most accurate)\n    const dateTimeOriginal =\n      metadata?.exif?.DateTimeOriginal ||\n      metadata?.metadata?.exif?.DateTimeOriginal;\n    if (dateTimeOriginal) {\n      const date = parseExifDate(dateTimeOriginal);\n      // If we could parse into a valid Date, present a standardized human-friendly format\n      if (!isNaN(date.getTime())) {\n        return formatDateWithTime(date);\n      }\n\n      // If parsing failed, prefer to display the original EXIF string rather than forcing null\n      return String(dateTimeOriginal);\n    }\n\n    // Fall back to file modification time\n    const fileModified =\n      metadata?.file?.modified || metadata?.metadata?.file?.modified;\n    if (fileModified) {\n      const date = new Date(fileModified);\n      return formatDateWithTime(date);\n    }\n\n    return null;\n  } catch (error) {\n    console.warn('Error formatting datetime:', error);\n    return null;\n  }\n}\n\n/**\n * Parse EXIF date format: \"2025:01:03 15:45:32\"\n */\n/**\n * Parse EXIF date format with fallbacks\n * Supports:\n * - \"2025:01:03 15:45:32\" (Standard EXIF)\n * - \"2025-01-03T15:45:32\" (ISO)\n * - \"2025/01/03 15:45:32\" (Common variation)\n */\nexport function parseExifDate(exifDateString: string): Date {\n  if (!exifDateString) throw new Error('Invalid EXIF date');\n\n  try {\n    // 1. Try standard EXIF format (YYYY:MM:DD HH:MM:SS)\n    const exifMatch = exifDateString.match(\n      /(\\d{4}):(\\d{2}):(\\d{2})\\s(\\d{2}):(\\d{2}):(\\d{2})/\n    );\n    if (exifMatch) {\n      const [, year, month, day, hour, minute, second] = exifMatch;\n      return new Date(\n        parseInt(year),\n        parseInt(month) - 1,\n        parseInt(day),\n        parseInt(hour),\n        parseInt(minute),\n        parseInt(second)\n      );\n    }\n\n    // 1b. Try human-friendly format like \"December 25, 2025 at 4:48 PM\"\n    const humanMatch = exifDateString.match(\n      /([A-Za-z]+)\\s+(\\d{1,2}),\\s+(\\d{4})\\s+at\\s+(\\d{1,2}):(\\d{2})\\s*(AM|PM)/i\n    );\n    if (humanMatch) {\n      const [, monthName, dayStr, yearStr, hourStr, minuteStr, ampm] =\n        humanMatch;\n      const month = new Date(`${monthName} 1, ${yearStr}`).getMonth();\n      let hour = parseInt(hourStr, 10);\n      const minute = parseInt(minuteStr, 10);\n      const year = parseInt(yearStr, 10);\n      if (/pm/i.test(ampm) && hour !== 12) hour += 12;\n      if (/am/i.test(ampm) && hour === 12) hour = 0;\n      return new Date(year, month, parseInt(dayStr, 10), hour, minute);\n    }\n\n    // 2. Try ISO format or standard Date string\n    const isoDate = new Date(exifDateString);\n    if (!isNaN(isoDate.getTime())) {\n      return isoDate;\n    }\n\n    // 3. Try handling variations like dashes or slashes\n    const cleanString = exifDateString\n      .replace(/(\\d{4}):(\\d{2}):(\\d{2})/, '$1-$2-$3') // Convert colons to dashes for date part\n      .replace(/(\\d{4})\\/(\\d{2})\\/(\\d{2})/, '$1-$2-$3');\n\n    const fallbackDate = new Date(cleanString);\n    if (!isNaN(fallbackDate.getTime())) {\n      return fallbackDate;\n    }\n\n    throw new Error(`Unknown date format: ${exifDateString}`);\n  } catch (error) {\n    // Parsing failures are normal for non-standard EXIF strings; keep debug-level logging\n    if (process.env.NODE_ENV === 'test') {\n      // In tests we keep the log to help debugging, but prefer not to spam in other environments\n      console.debug(`Failed to parse EXIF date: ${exifDateString}`, error);\n    }\n    return new Date(NaN);\n  }\n}\n\n/**\n * Format date with time: \"January 3, 2025 at 3:45 PM\"\n */\nfunction formatDateWithTime(date: Date): string | null {\n  if (!date || isNaN(date.getTime())) return null;\n\n  const dateOptions: Intl.DateTimeFormatOptions = {\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric',\n  };\n\n  const timeOptions: Intl.DateTimeFormatOptions = {\n    hour: 'numeric',\n    minute: '2-digit',\n    hour12: true,\n  };\n\n  const dateStr = date.toLocaleDateString('en-US', dateOptions);\n  const timeStr = date.toLocaleTimeString('en-US', timeOptions);\n\n  return `${dateStr} at ${timeStr}`;\n}\n\n/**\n * Extract location from GPS metadata\n * Returns formatted address or \"Unknown location\"\n */\nfunction extractLocation(metadata: any): string | null {\n  try {\n    const gps = metadata?.gps || metadata?.metadata?.gps;\n    if (!gps || (!gps.latitude && !gps.Latitude)) {\n      return null;\n    }\n\n    // For now, just show coordinates\n    // This will be enhanced with reverse geocoding in Phase 1.2\n    const lat = gps.latitude || gps.Latitude;\n    const lng = gps.longitude || gps.Longitude;\n\n    if (!lat || !lng) return null;\n\n    // Format coordinates\n    return formatCoordinates(lat, lng);\n  } catch (error) {\n    console.warn('Error extracting location:', error);\n    return null;\n  }\n}\n\n/**\n * Format coordinates: \"37.7749 N, 122.4194 W\"\n */\nexport function formatCoordinates(latitude: number, longitude: number): string {\n  const formatLat = (lat: number) => {\n    const dir = lat >= 0 ? 'N' : 'S';\n    return `${Math.abs(lat).toFixed(4)} ${dir}`;\n  };\n\n  const formatLng = (lng: number) => {\n    const dir = lng >= 0 ? 'E' : 'W';\n    return `${Math.abs(lng).toFixed(4)} ${dir}`;\n  };\n\n  return `${formatLat(latitude)}, ${formatLng(longitude)}`;\n}\n\n/**\n * Format device name from EXIF data\n * e.g., \"iPhone 15 Pro\" instead of \"Apple iPhone15,5\"\n */\nfunction formatDeviceName(metadata: any): string | null {\n  try {\n    const exif = metadata?.exif || metadata?.metadata?.exif;\n    if (!exif) return null;\n\n    const make = exif.Make || exif.make;\n    const model = exif.Model || exif.model;\n\n    if (!make && !model) return null;\n\n    // Clean up device names\n    const cleanMake = make ? cleanDeviceName(make) : '';\n    const cleanModel = model ? cleanDeviceName(model) : '';\n\n    if (cleanMake && cleanModel) {\n      return `${cleanMake} ${cleanModel}`.trim();\n    }\n    return cleanMake || cleanModel || null;\n  } catch (error) {\n    console.warn('Error formatting device name:', error);\n    return null;\n  }\n}\n\n/**\n * Clean device names for display\n * \"Apple\"  \"Apple\" (unchanged for Apple devices)\n * \"NIKON CORPORATION\"  \"Nikon\"\n * \"Canon\"  \"Canon\"\n */\nfunction cleanDeviceName(name: string): string {\n  if (!name) return '';\n\n  // Replace common patterns\n  const cleaned = name\n    .replace(/CORPORATION/gi, '')\n    .replace(/ELECTRONICS?/gi, '')\n    .replace(/INC\\.?/gi, '')\n    .trim();\n\n  // Special handling for common models like \"iPhone 15 Pro\"\n  // Keep \"iPhone\" as-is, only clean other words\n  if (cleaned.toLowerCase().includes('iphone')) {\n    const parts = cleaned.split(' ');\n    return parts\n      .map((word, idx) => {\n        if (word.toLowerCase() === 'iphone') return 'iPhone';\n        return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();\n      })\n      .join(' ');\n  }\n\n  // Standard cleaning for other brands\n  return cleaned\n    .split(' ')\n    .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\n    .join(' ');\n}\n\n/**\n * Detect if image has been edited\n * Looks for editing software markers, metadata modifications, etc.\n */\nfunction detectEditing(metadata: any): boolean {\n  try {\n    const exif = metadata?.exif || metadata?.metadata?.exif;\n    if (!exif) return false;\n\n    // Software tags indicating editing\n    const editingSoftware = [\n      'Photoshop',\n      'GIMP',\n      'Lightroom',\n      'Snapseed',\n      'Pixlr',\n      'Affinity',\n      'Procreate',\n    ];\n\n    const software = exif.Software || exif.software || '';\n    const hasEditingSoftware = editingSoftware.some(s =>\n      software.toLowerCase().includes(s.toLowerCase())\n    );\n\n    // Check for processing software\n    const processingMarkers = [\n      exif.ProcessingSoftware,\n      exif.processing,\n    ].filter(Boolean);\n\n    return hasEditingSoftware || processingMarkers.length > 0;\n  } catch (error) {\n    console.warn('Error detecting editing:', error);\n    return false;\n  }\n}\n\n/**\n * Assess file authenticity based on multiple factors\n * Returns a human-readable assessment\n */\nfunction assessAuthenticity(metadata: any): string {\n  try {\n    const score = calculateAuthenticityScore(metadata);\n\n    if (score >= 85) {\n      return 'Appears authentic';\n    } else if (score >= 60) {\n      return 'Mostly authentic with minor modifications';\n    } else if (score >= 40) {\n      return 'Shows signs of modification';\n    } else {\n      return 'Significant modifications detected';\n    }\n  } catch (error) {\n    console.warn('Error assessing authenticity:', error);\n    return 'Unable to assess';\n  }\n}\n\n/**\n * Calculate authenticity score (0-100)\n * Based on multiple integrity checks\n */\nfunction calculateAuthenticityScore(metadata: any): number {\n  let score = 100;\n  let checksPerformed = 0;\n\n  try {\n    // Check for editing software (major penalty)\n    if (detectEditing(metadata)) {\n      score -= 30;\n    }\n    checksPerformed++;\n\n    // Check EXIF integrity\n    const exif = metadata?.exif || metadata?.metadata?.exif;\n    if (!exif || Object.keys(exif).length === 0) {\n      score -= 10; // No EXIF is suspicious\n    }\n    checksPerformed++;\n\n    // Check GPS consistency\n    const gps = metadata?.gps || metadata?.metadata?.gps;\n    if (gps) {\n      const lat = gps.latitude || gps.Latitude;\n      const lng = gps.longitude || gps.Longitude;\n\n      // Impossible coordinates indicate tampering\n      if (lat && (lat > 90 || lat < -90)) {\n        score -= 25;\n      }\n      if (lng && (lng > 180 || lng < -180)) {\n        score -= 25;\n      }\n    }\n    checksPerformed++;\n\n    // Check timestamp consistency\n    const creationDate = formatDateTimeOriginal(metadata);\n    if (creationDate) {\n      const date = parseExifDate(creationDate);\n      const now = new Date();\n\n      // Future dates indicate tampering\n      if (date > now) {\n        score -= 20;\n      }\n\n      // Very old dates (before digital cameras) are suspicious\n      if (date.getFullYear() < 2000) {\n        score -= 15;\n      }\n    }\n    checksPerformed++;\n\n    // Ensure score doesn't go below 0\n    return Math.max(0, Math.min(100, score));\n  } catch (error) {\n    console.warn('Error calculating authenticity score:', error);\n    return 50; // Neutral score if calculation fails\n  }\n}\n\n/**\n * Calculate confidence level (high/medium/low)\n * Based on amount and quality of metadata available\n */\nfunction calculateConfidence(metadata: any): 'high' | 'medium' | 'low' {\n  try {\n    let confidence = 0;\n    let maxScore = 0;\n\n    // Check for EXIF data\n    const exif = metadata?.exif || metadata?.metadata?.exif;\n    if (exif && Object.keys(exif).length > 10) {\n      confidence += 30;\n    }\n    maxScore += 30;\n\n    // Check for GPS data\n    const gps = metadata?.gps || metadata?.metadata?.gps;\n    if (gps && (gps.latitude || gps.Latitude)) {\n      confidence += 20;\n    }\n    maxScore += 20;\n\n    // Check for ISO and other technical data\n    if (exif?.ISO || exif?.iso) {\n      confidence += 15;\n    }\n    maxScore += 15;\n\n    // Check for datetime\n    if (metadata?.file?.created || exif?.DateTimeOriginal) {\n      confidence += 20;\n    }\n    maxScore += 20;\n\n    // Check for lens/camera data\n    if (exif?.LensModel || exif?.lensModel) {\n      confidence += 15;\n    }\n    maxScore += 15;\n\n    const percentile = (confidence / maxScore) * 100;\n\n    if (percentile >= 70) return 'high';\n    if (percentile >= 40) return 'medium';\n    return 'low';\n  } catch (error) {\n    console.warn('Error calculating confidence:', error);\n    return 'low';\n  }\n}\n\n/**\n * Extract quick details for summary card\n */\nexport function extractQuickDetails(metadata: any): QuickDetails {\n  const exif = metadata?.exif || metadata?.metadata?.exif;\n  const file = metadata?.file || metadata?.metadata?.file;\n\n  return {\n    resolution: formatResolution(exif?.PixelXDimension, exif?.PixelYDimension),\n    fileSize: formatFileSize(file?.size || metadata?.size),\n    cameraSettings: formatCameraSettings(exif),\n    colorSpace: exif?.ColorSpace || exif?.colorSpace || 'Unknown',\n    dimensions: formatDimensions(exif?.PixelXDimension, exif?.PixelYDimension),\n  };\n}\n\n/**\n * Format resolution: \"12.2 megapixels\"\n */\nfunction formatResolution(width?: number, height?: number): string {\n  if (!width || !height) return 'Unknown';\n\n  const megapixels = (width * height) / 1_000_000;\n  return `${megapixels.toFixed(1)} megapixels`;\n}\n\n/**\n * Format file size: \"3.2 MB\"\n */\nexport function formatFileSize(bytes?: number): string {\n  if (bytes === undefined || bytes === null) return 'Unknown';\n\n  if (bytes < 1024) return `${bytes} B`;\n  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n  if (bytes < 1024 * 1024 * 1024)\n    return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n  return `${(bytes / (1024 * 1024 * 1024)).toFixed(1)} GB`;\n}\n\n/**\n * Format camera settings: \"f/1.6, 1/120s, ISO 64\"\n */\nfunction formatCameraSettings(exif?: any): string {\n  if (!exif) return 'Unknown';\n\n  const parts = [];\n\n  // Aperture\n  if (exif.FNumber || exif.fNumber) {\n    const fNum = exif.FNumber || exif.fNumber;\n    parts.push(`f/${typeof fNum === 'string' ? fNum : fNum.toFixed(1)}`);\n  }\n\n  // Shutter speed\n  if (exif.ExposureTime || exif.exposureTime) {\n    const exposure = exif.ExposureTime || exif.exposureTime;\n    if (exposure < 1) {\n      parts.push(`1/${Math.round(1 / exposure)}s`);\n    } else {\n      parts.push(`${exposure}s`);\n    }\n  }\n\n  // ISO\n  if (exif.ISOSpeedRatings || exif.iso) {\n    parts.push(`ISO ${exif.ISOSpeedRatings || exif.iso}`);\n  }\n\n  return parts.length > 0 ? parts.join(', ') : 'Unknown';\n}\n\n/**\n * Format dimensions: \"4032 x 3024\"\n */\nfunction formatDimensions(width?: number, height?: number): string {\n  if (!width || !height) return 'Unknown';\n  return `${width} x ${height}`;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/utils/processingEstimates.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/client/src/utils/userPreferences.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[623,626],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[623,626],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":49,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":49,"endColumn":18,"suggestions":[{"fix":{"range":[1061,1113],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":61,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":61,"endColumn":18,"suggestions":[{"fix":{"range":[1376,1428],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":98,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":98,"endColumn":18,"suggestions":[{"fix":{"range":[2157,2210],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * User Preferences Storage\n * \n * Persist user preferences across sessions using localStorage.\n */\n\nexport interface UserPreferences {\n  /** Expanded category keys in metadata explorer */\n  expandedCategories?: string[];\n  \n  /** Preferred view mode */\n  viewMode?: 'simple' | 'advanced' | 'raw';\n  \n  /** Show tooltips */\n  showTooltips?: boolean;\n  \n  /** Dark mode preference */\n  darkMode?: boolean;\n  \n  /** Dismissed onboarding */\n  dismissedOnboarding?: boolean;\n  \n  /** Last used tier */\n  lastTier?: string;\n  \n  /** Search history */\n  searchHistory?: string[];\n  \n  /** Custom settings */\n  [key: string]: any;\n}\n\nconst STORAGE_KEY = 'metaextract_preferences';\nconst MAX_SEARCH_HISTORY = 10;\n\n/**\n * Load user preferences from localStorage\n */\nexport function loadPreferences(): UserPreferences {\n  try {\n    const stored = localStorage.getItem(STORAGE_KEY);\n    if (!stored) {\n      return getDefaultPreferences();\n    }\n    \n    const parsed = JSON.parse(stored);\n    return { ...getDefaultPreferences(), ...parsed };\n  } catch (error) {\n    console.error('Failed to load preferences:', error);\n    return getDefaultPreferences();\n  }\n}\n\n/**\n * Save user preferences to localStorage\n */\nexport function savePreferences(preferences: UserPreferences): void {\n  try {\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(preferences));\n  } catch (error) {\n    console.error('Failed to save preferences:', error);\n  }\n}\n\n/**\n * Update specific preference\n */\nexport function updatePreference<K extends keyof UserPreferences>(\n  key: K,\n  value: UserPreferences[K]\n): void {\n  const prefs = loadPreferences();\n  prefs[key] = value;\n  savePreferences(prefs);\n}\n\n/**\n * Get default preferences\n */\nexport function getDefaultPreferences(): UserPreferences {\n  return {\n    expandedCategories: ['capture', 'location', 'file'], // Default to Phase 1 smart defaults\n    viewMode: 'advanced',\n    showTooltips: true,\n    darkMode: false,\n    dismissedOnboarding: false,\n    searchHistory: []\n  };\n}\n\n/**\n * Clear all preferences\n */\nexport function clearPreferences(): void {\n  try {\n    localStorage.removeItem(STORAGE_KEY);\n  } catch (error) {\n    console.error('Failed to clear preferences:', error);\n  }\n}\n\n/**\n * Add search query to history\n */\nexport function addToSearchHistory(query: string): void {\n  if (!query || query.trim().length === 0) return;\n  \n  const prefs = loadPreferences();\n  const history = prefs.searchHistory || [];\n  \n  // Remove duplicates\n  const filtered = history.filter(h => h !== query);\n  \n  // Add to front\n  filtered.unshift(query);\n  \n  // Limit size\n  prefs.searchHistory = filtered.slice(0, MAX_SEARCH_HISTORY);\n  \n  savePreferences(prefs);\n}\n\n/**\n * Get search history\n */\nexport function getSearchHistory(): string[] {\n  const prefs = loadPreferences();\n  return prefs.searchHistory || [];\n}\n\n/**\n * Clear search history\n */\nexport function clearSearchHistory(): void {\n  updatePreference('searchHistory', []);\n}\n\n/**\n * Toggle expanded category\n */\nexport function toggleCategory(category: string): string[] {\n  const prefs = loadPreferences();\n  const expanded = prefs.expandedCategories || [];\n  \n  const newExpanded = expanded.includes(category)\n    ? expanded.filter(c => c !== category)\n    : [...expanded, category];\n  \n  updatePreference('expandedCategories', newExpanded);\n  return newExpanded;\n}\n\n/**\n * Set expanded categories\n */\nexport function setExpandedCategories(categories: string[]): void {\n  updatePreference('expandedCategories', categories);\n}\n\n/**\n * React hook for preferences (if using React)\n */\nexport function usePreferences() {\n  const [prefs, setPrefs] = React.useState<UserPreferences>(loadPreferences);\n  \n  const update = React.useCallback(<K extends keyof UserPreferences>(\n    key: K,\n    value: UserPreferences[K]\n  ) => {\n    setPrefs(prev => {\n      const updated = { ...prev, [key]: value };\n      savePreferences(updated);\n      return updated;\n    });\n  }, []);\n  \n  return { preferences: prefs, updatePreference: update };\n}\n\n// Export React if available\nimport React from 'react';\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/auth-enhanced.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'express' is defined but never used.","line":12,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Enhanced Authentication System for MetaExtract API\n * \n * Implements security best practices including:\n * - Secure token handling with httpOnly cookies\n * - Rate limiting\n * - Password policies\n * - 2FA support\n * - Session management\n */\n\nimport express, { Request, Response, NextFunction } from 'express';\nimport jwt, { type SignOptions } from 'jsonwebtoken';\nimport bcrypt from 'bcryptjs';\nimport crypto from 'crypto';\nimport speakeasy from 'speakeasy';\nimport QRCode from 'qrcode';\nimport rateLimit from 'express-rate-limit';\nimport validator from 'validator';\nimport { storage } from './storage';\nimport type { User } from './storage/types';\n\n// ============================================================================\n// Configuration\n// ============================================================================\n\ninterface AuthConfig {\n  jwtSecret: string;\n  jwtRefreshSecret: string;\n  jwtExpiration: string;\n  refreshTokenExpiration: string;\n  bcryptRounds: number;\n  maxLoginAttempts: number;\n  lockoutDuration: number;\n  passwordMinLength: number;\n  requireUppercase: boolean;\n  requireLowercase: boolean;\n  requireNumbers: boolean;\n  requireSymbols: boolean;\n}\n\nexport const AUTH_CONFIG: AuthConfig = {\n  jwtSecret: process.env.JWT_SECRET || 'fallback_jwt_secret_for_development',\n  jwtRefreshSecret: process.env.JWT_REFRESH_SECRET || 'fallback_refresh_secret_for_development',\n  jwtExpiration: process.env.JWT_EXPIRATION || '15m', // 15 minutes\n  refreshTokenExpiration: process.env.JWT_REFRESH_EXPIRATION || '7d', // 7 days\n  bcryptRounds: parseInt(process.env.BCRYPT_ROUNDS || '12', 10),\n  maxLoginAttempts: parseInt(process.env.MAX_LOGIN_ATTEMPTS || '5', 10),\n  lockoutDuration: parseInt(process.env.LOCKOUT_DURATION || '900000', 10), // 15 minutes in ms\n  passwordMinLength: parseInt(process.env.PASSWORD_MIN_LENGTH || '8', 10),\n  requireUppercase: process.env.PASSWORD_REQUIRE_UPPERCASE === 'true',\n  requireLowercase: process.env.PASSWORD_REQUIRE_LOWERCASE === 'true',\n  requireNumbers: process.env.PASSWORD_REQUIRE_NUMBERS === 'true',\n  requireSymbols: process.env.PASSWORD_REQUIRE_SYMBOLS === 'true',\n};\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport type AuthUser = User & {\n  firstName?: string;\n  lastName?: string;\n  emailVerified?: boolean;\n  twoFactorEnabled?: boolean;\n  twoFactorSecret?: string | null;\n  failedLoginAttempts?: number;\n  lastFailedLoginAttempt?: Date | null;\n  resetToken?: string | null;\n  resetTokenExpiry?: Date | null;\n  updatedAt?: Date;\n};\n\nexport interface AuthRequest extends Request {\n  user?: AuthUser;\n}\n\nexport interface TokenPayload {\n  userId: string;\n  email: string;\n  iat: number;\n  exp: number;\n}\n\nexport interface RefreshTokenPayload {\n  tokenId: string;\n  userId: string;\n  iat: number;\n  exp: number;\n}\n\n// ============================================================================\n// Utility Functions\n// ============================================================================\n\n/**\n * Validates password strength based on configuration\n */\nexport function validatePasswordStrength(password: string): { isValid: boolean; errors: string[] } {\n  const errors: string[] = [];\n\n  if (password.length < AUTH_CONFIG.passwordMinLength) {\n    errors.push(`Password must be at least ${AUTH_CONFIG.passwordMinLength} characters long`);\n  }\n\n  if (AUTH_CONFIG.requireUppercase && !/[A-Z]/.test(password)) {\n    errors.push('Password must contain at least one uppercase letter');\n  }\n\n  if (AUTH_CONFIG.requireLowercase && !/[a-z]/.test(password)) {\n    errors.push('Password must contain at least one lowercase letter');\n  }\n\n  if (AUTH_CONFIG.requireNumbers && !/\\d/.test(password)) {\n    errors.push('Password must contain at least one number');\n  }\n\n  if (AUTH_CONFIG.requireSymbols && !/[!@#$%^&*(),.?\":{}|<>]/.test(password)) {\n    errors.push('Password must contain at least one special character');\n  }\n\n  return {\n    isValid: errors.length === 0,\n    errors\n  };\n}\n\n/**\n * Generates a secure random token\n */\nexport function generateSecureToken(length: number = 32): string {\n  return crypto.randomBytes(length).toString('hex');\n}\n\n/**\n * Hashes a password using bcrypt\n */\nexport async function hashPassword(password: string): Promise<string> {\n  return await bcrypt.hash(password, AUTH_CONFIG.bcryptRounds);\n}\n\n/**\n * Verifies a password against a hash\n */\nexport async function verifyPassword(password: string, hash: string): Promise<boolean> {\n  return await bcrypt.compare(password, hash);\n}\n\n/**\n * Signs a JWT access token\n */\nexport function signAccessToken(payload: Partial<TokenPayload>): string {\n  return jwt.sign(payload, AUTH_CONFIG.jwtSecret, {\n    expiresIn: AUTH_CONFIG.jwtExpiration as SignOptions['expiresIn'],\n  });\n}\n\n/**\n * Signs a JWT refresh token\n */\nexport function signRefreshToken(payload: Partial<RefreshTokenPayload>): string {\n  return jwt.sign(payload, AUTH_CONFIG.jwtRefreshSecret, {\n    expiresIn: AUTH_CONFIG.refreshTokenExpiration as SignOptions['expiresIn'],\n  });\n}\n\nfunction buildUsername(email: string): string {\n  const base = email\n    .split('@')[0]\n    .replace(/[^a-zA-Z0-9_]/g, '')\n    .slice(0, 16);\n  const suffix = crypto.randomBytes(3).toString('hex');\n  return `${base || 'user'}_${suffix}`;\n}\n\nfunction requireStorageMethod<K extends keyof typeof storage>(\n  name: K\n): NonNullable<(typeof storage)[K]> {\n  const method = storage[name];\n  if (!method) {\n    throw new Error(`Storage method ${String(name)} is not available`);\n  }\n  return method.bind(storage) as NonNullable<(typeof storage)[K]>;\n}\n\n/**\n * Verifies a JWT access token\n */\nexport function verifyAccessToken(token: string): TokenPayload | null {\n  try {\n    return jwt.verify(token, AUTH_CONFIG.jwtSecret) as TokenPayload;\n  } catch (error) {\n    console.error('Access token verification failed:', error);\n    return null;\n  }\n}\n\n/**\n * Verifies a JWT refresh token\n */\nexport function verifyRefreshToken(token: string): RefreshTokenPayload | null {\n  try {\n    return jwt.verify(token, AUTH_CONFIG.jwtRefreshSecret) as RefreshTokenPayload;\n  } catch (error) {\n    console.error('Refresh token verification failed:', error);\n    return null;\n  }\n}\n\n// ============================================================================\n// Rate Limiting\n// ============================================================================\n\n/**\n * Login rate limiter to prevent brute force attacks\n */\nexport const loginLimiter = rateLimit({\n  windowMs: 15 * 60 * 1000, // 15 minutes\n  max: 5, // Limit each IP to 5 requests per windowMs\n  message: {\n    error: 'Too many login attempts, please try again later.',\n    retryAfter: '15 minutes'\n  },\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n\n/**\n * General API rate limiter\n */\nexport const apiLimiter = rateLimit({\n  windowMs: 15 * 60 * 1000, // 15 minutes\n  max: 100, // Limit each IP to 100 requests per windowMs\n  message: {\n    error: 'Too many requests from this IP, please try again later.'\n  },\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n\n// ============================================================================\n// Authentication Middleware\n// ============================================================================\n\n/**\n * Middleware to authenticate requests using JWT\n */\nexport async function authenticateToken(req: AuthRequest, res: Response, next: NextFunction): Promise<void> {\n  const authHeader = req.headers['authorization'];\n  const token = authHeader && authHeader.split(' ')[1]; // Bearer TOKEN\n\n  if (!token) {\n    res.status(401).json({ error: 'Access token required' });\n    return;\n  }\n\n  const decoded = verifyAccessToken(token);\n  if (!decoded) {\n    res.status(403).json({ error: 'Invalid or expired access token' });\n    return;\n  }\n\n  try {\n    // Verify user still exists in database\n    const getUserById = requireStorageMethod('getUserById');\n    const user = (await getUserById(decoded.userId)) as AuthUser | undefined;\n    if (!user) {\n      res.status(403).json({ error: 'User no longer exists' });\n      return;\n    }\n\n    req.user = user;\n    next();\n  } catch (error) {\n    console.error('Authentication error:', error);\n    res.status(500).json({ error: 'Authentication error' });\n  }\n}\n\n/**\n * Middleware to authenticate requests using refresh token\n */\nexport async function authenticateRefreshToken(req: Request, res: Response, next: NextFunction): Promise<void> {\n  const token = req.cookies?.refreshToken || req.body.refreshToken;\n\n  if (!token) {\n    res.status(401).json({ error: 'Refresh token required' });\n    return;\n  }\n\n  const decoded = verifyRefreshToken(token);\n  if (!decoded) {\n    res.status(403).json({ error: 'Invalid or expired refresh token' });\n    return;\n  }\n\n  // In a real implementation, you'd verify the refresh token exists in the database\n  // and hasn't been revoked. For now, we'll just pass through.\n  (req as AuthRequest).user = { id: decoded.userId } as AuthUser; // Minimal user object\n  next();\n}\n\n// ============================================================================\n// Authentication Controllers\n// ============================================================================\n\n/**\n * Register a new user\n */\nexport async function register(req: Request, res: Response): Promise<void> {\n  try {\n    const { email, password, firstName, lastName } = req.body;\n\n    // Validate input\n    if (!email || !password) {\n      res.status(400).json({ error: 'Email and password are required' });\n      return;\n    }\n\n    if (!validator.isEmail(email)) {\n      res.status(400).json({ error: 'Invalid email format' });\n      return;\n    }\n\n    // Check if user already exists\n    const getUserByEmail = requireStorageMethod('getUserByEmail');\n    const existingUser = await getUserByEmail(email);\n    if (existingUser) {\n      res.status(409).json({ error: 'User with this email already exists' });\n      return;\n    }\n\n    // Validate password strength\n    const passwordValidation = validatePasswordStrength(password);\n    if (!passwordValidation.isValid) {\n      res.status(400).json({ error: 'Password validation failed', details: passwordValidation.errors });\n      return;\n    }\n\n    // Hash password\n    const hashedPassword = await hashPassword(password);\n    const username = buildUsername(email);\n\n    // Create user\n    const createUser = requireStorageMethod('createUser');\n    const newUser = (await createUser({\n      email,\n      password: hashedPassword,\n      username,\n    })) as AuthUser;\n    const authUser: AuthUser = {\n      ...newUser,\n      firstName: newUser.firstName ?? firstName ?? '',\n      lastName: newUser.lastName ?? lastName ?? '',\n      emailVerified: newUser.emailVerified ?? false,\n      twoFactorEnabled: newUser.twoFactorEnabled ?? false,\n      twoFactorSecret: newUser.twoFactorSecret ?? null,\n    };\n\n    // Create initial credit balance (account-bound)\n    const getOrCreateCreditBalance = requireStorageMethod(\n      'getOrCreateCreditBalance'\n    );\n    await getOrCreateCreditBalance(\n      `credits:core:user:${authUser.id}`,\n      authUser.id\n    );\n\n    // In a real implementation, you'd send a verification email here\n    console.log(`Verification email would be sent to: ${email}`);\n\n    // Generate tokens\n    const accessToken = signAccessToken({ \n      userId: authUser.id, \n      email: authUser.email \n    });\n    \n    const refreshToken = signRefreshToken({ \n      tokenId: generateSecureToken(16), // In real implementation, store this in DB\n      userId: authUser.id \n    });\n\n    // Set refresh token as httpOnly cookie\n    res.cookie('refreshToken', refreshToken, {\n      httpOnly: true,\n      secure: process.env.NODE_ENV === 'production', // Use HTTPS in production\n      maxAge: 7 * 24 * 60 * 60 * 1000, // 7 days\n      // Lax is required so refresh persists across external checkout redirects.\n      sameSite: 'lax',\n    });\n\n    res.status(201).json({\n      message: 'User registered successfully',\n      user: {\n        id: authUser.id,\n        email: authUser.email,\n        firstName: authUser.firstName,\n        lastName: authUser.lastName,\n        emailVerified: authUser.emailVerified,\n      },\n      accessToken, // Send access token in response body\n    });\n  } catch (error) {\n    console.error('Registration error:', error);\n    res.status(500).json({ error: 'Registration failed' });\n  }\n}\n\n/**\n * Login user\n */\nexport async function login(req: Request, res: Response): Promise<void> {\n  try {\n    const { email, password } = req.body;\n\n    if (!email || !password) {\n      res.status(400).json({ error: 'Email and password are required' });\n      return;\n    }\n\n    // Get user from database\n    const getUserByEmail = requireStorageMethod('getUserByEmail');\n    const user = (await getUserByEmail(email)) as AuthUser | undefined;\n    if (!user) {\n      res.status(401).json({ error: 'Invalid credentials' });\n      return;\n    }\n\n    // Verify password\n    const isValidPassword = await verifyPassword(password, user.password);\n    if (!isValidPassword) {\n      res.status(401).json({ error: 'Invalid credentials' });\n      return;\n    }\n\n    // Check if account is locked\n    const failedAttempts = user.failedLoginAttempts ?? 0;\n    const lastFailed = user.lastFailedLoginAttempt ?? null;\n    if (failedAttempts >= AUTH_CONFIG.maxLoginAttempts && lastFailed) {\n      const lockoutTime = lastFailed.getTime() + AUTH_CONFIG.lockoutDuration;\n      if (Date.now() < lockoutTime) {\n        const remainingTime = Math.ceil((lockoutTime - Date.now()) / 1000 / 60);\n        res.status(423).json({ \n          error: 'Account temporarily locked due to multiple failed login attempts', \n          remainingMinutes: remainingTime \n        });\n        return;\n      } else {\n        // Reset failed attempts after lockout period\n        await storage.resetFailedLoginAttempts?.(user.id);\n      }\n    }\n\n    // If user has 2FA enabled, verify the code\n    if (user.twoFactorEnabled) {\n      const twoFactorCode = req.body.twoFactorCode;\n      if (!twoFactorCode) {\n        res.status(401).json({ \n          error: 'Two-factor authentication required',\n          twoFactorRequired: true \n        });\n        return;\n      }\n\n      const verified = speakeasy.totp.verify({\n        secret: user.twoFactorSecret || '',\n        encoding: 'base32',\n        token: twoFactorCode,\n        window: 2, // Allow 2 steps before or after\n      });\n\n      if (!verified) {\n        res.status(401).json({ error: 'Invalid two-factor authentication code' });\n        return;\n      }\n    }\n\n    // Reset failed login attempts\n    await storage.resetFailedLoginAttempts?.(user.id);\n\n    // Generate tokens\n    const accessToken = signAccessToken({ \n      userId: user.id, \n      email: user.email \n    });\n    \n    const refreshToken = signRefreshToken({ \n      tokenId: generateSecureToken(16), // In real implementation, store this in DB\n      userId: user.id \n    });\n\n    // Set refresh token as httpOnly cookie\n    res.cookie('refreshToken', refreshToken, {\n      httpOnly: true,\n      secure: process.env.NODE_ENV === 'production', // Use HTTPS in production\n      maxAge: 7 * 24 * 60 * 60 * 1000, // 7 days\n      sameSite: 'lax',\n    });\n\n    res.json({\n      message: 'Login successful',\n      user: {\n        id: user.id,\n        email: user.email,\n        firstName: user.firstName,\n        lastName: user.lastName,\n        emailVerified: user.emailVerified,\n        twoFactorEnabled: user.twoFactorEnabled,\n      },\n      accessToken,\n    });\n  } catch (error) {\n    console.error('Login error:', error);\n    res.status(500).json({ error: 'Login failed' });\n  }\n}\n\n/**\n * Logout user\n */\nexport async function logout(req: AuthRequest, res: Response): Promise<void> {\n  try {\n    // In a real implementation, you'd invalidate the refresh token in the database\n    // For now, we'll just clear the cookie\n    res.clearCookie('refreshToken');\n    \n    res.json({ message: 'Logout successful' });\n  } catch (error) {\n    console.error('Logout error:', error);\n    res.status(500).json({ error: 'Logout failed' });\n  }\n}\n\n/**\n * Refresh access token using refresh token\n */\nexport async function refreshAccessToken(req: Request, res: Response): Promise<void> {\n  try {\n    const refreshToken = req.cookies?.refreshToken || req.body.refreshToken;\n\n    if (!refreshToken) {\n      res.status(401).json({ error: 'Refresh token required' });\n      return;\n    }\n\n    const decoded = verifyRefreshToken(refreshToken);\n    if (!decoded) {\n      res.status(403).json({ error: 'Invalid or expired refresh token' });\n      return;\n    }\n\n    // In a real implementation, you'd check if the refresh token exists in the database\n    // and hasn't been revoked. For now, we'll proceed.\n\n    // Get user to ensure they still exist\n    const getUserById = requireStorageMethod('getUserById');\n    const user = (await getUserById(decoded.userId)) as AuthUser | undefined;\n    if (!user) {\n      res.status(403).json({ error: 'User no longer exists' });\n      return;\n    }\n\n    // Generate new access token\n    const newAccessToken = signAccessToken({ \n      userId: user.id, \n      email: user.email \n    });\n\n    res.json({\n      accessToken: newAccessToken,\n    });\n  } catch (error) {\n    console.error('Token refresh error:', error);\n    res.status(500).json({ error: 'Token refresh failed' });\n  }\n}\n\n/**\n * Enable 2FA for user\n */\nexport async function enableTwoFactor(req: AuthRequest, res: Response): Promise<void> {\n  try {\n    if (!req.user) {\n      res.status(401).json({ error: 'Authentication required' });\n      return;\n    }\n\n    // Generate a new secret for 2FA\n    const secret = speakeasy.generateSecret({\n      name: `MetaExtract (${req.user.email})`,\n      issuer: 'MetaExtract',\n    });\n\n    // In a real implementation, you'd temporarily store the secret in the database\n    // and not finalize until the user verifies the code\n    // For now, we'll just return the QR code data\n\n    const qrCodeUrl = await QRCode.toDataURL(secret.otpauth_url!);\n\n    res.json({\n      secret: secret.base32,\n      qrCodeUrl,\n      manualEntryKey: secret.ascii,\n    });\n  } catch (error) {\n    console.error('Enable 2FA error:', error);\n    res.status(500).json({ error: 'Failed to enable 2FA' });\n  }\n}\n\n/**\n * Verify 2FA setup\n */\nexport async function verifyTwoFactorSetup(req: AuthRequest, res: Response): Promise<void> {\n  try {\n    if (!req.user) {\n      res.status(401).json({ error: 'Authentication required' });\n      return;\n    }\n\n    const { token, secret } = req.body;\n\n    if (!token || !secret) {\n      res.status(400).json({ error: 'Token and secret are required' });\n      return;\n    }\n\n    // Verify the token against the secret\n    const verified = speakeasy.totp.verify({\n      secret,\n      encoding: 'base32',\n      token,\n      window: 2,\n    });\n\n    if (!verified) {\n      res.status(400).json({ error: 'Invalid token' });\n      return;\n    }\n\n    // Update user to enable 2FA\n    if (!storage.enableTwoFactor) {\n      res.status(501).json({ error: 'Two-factor authentication is unavailable' });\n      return;\n    }\n    await storage.enableTwoFactor(req.user.id, secret);\n\n    res.json({\n      message: 'Two-factor authentication enabled successfully',\n      twoFactorEnabled: true,\n    });\n  } catch (error) {\n    console.error('Verify 2FA setup error:', error);\n    res.status(500).json({ error: 'Failed to verify 2FA setup' });\n  }\n}\n\n/**\n * Disable 2FA for user\n */\nexport async function disableTwoFactor(req: AuthRequest, res: Response): Promise<void> {\n  try {\n    if (!req.user) {\n      res.status(401).json({ error: 'Authentication required' });\n      return;\n    }\n\n    if (!storage.disableTwoFactor) {\n      res.status(501).json({ error: 'Two-factor authentication is unavailable' });\n      return;\n    }\n    await storage.disableTwoFactor(req.user.id);\n\n    res.json({\n      message: 'Two-factor authentication disabled successfully',\n      twoFactorEnabled: false,\n    });\n  } catch (error) {\n    console.error('Disable 2FA error:', error);\n    res.status(500).json({ error: 'Failed to disable 2FA' });\n  }\n}\n\n/**\n * Request password reset\n */\nexport async function requestPasswordReset(req: Request, res: Response): Promise<void> {\n  try {\n    const { email } = req.body;\n\n    if (!email) {\n      res.status(400).json({ error: 'Email is required' });\n      return;\n    }\n\n    if (!validator.isEmail(email)) {\n      res.status(400).json({ error: 'Invalid email format' });\n      return;\n    }\n\n    // Get user from database\n    const getUserByEmail = requireStorageMethod('getUserByEmail');\n    const user = (await getUserByEmail(email)) as AuthUser | undefined;\n    if (!user) {\n      // Don't reveal if email exists to prevent enumeration\n      res.json({ message: 'If an account exists with this email, a reset link has been sent' });\n      return;\n    }\n\n    // Generate password reset token\n    const resetToken = generateSecureToken(32);\n    const resetTokenExpiry = new Date(Date.now() + 15 * 60 * 1000); // 15 minutes\n\n    // Store reset token in database\n    if (!storage.setPasswordResetToken) {\n      res.status(501).json({ error: 'Password reset is unavailable' });\n      return;\n    }\n    await storage.setPasswordResetToken(user.id, resetToken, resetTokenExpiry);\n\n    // In a real implementation, you'd send an email with the reset link\n    console.log(`Password reset email would be sent to: ${email} with token: ${resetToken}`);\n\n    res.json({ message: 'If an account exists with this email, a reset link has been sent' });\n  } catch (error) {\n    console.error('Password reset request error:', error);\n    res.status(500).json({ error: 'Password reset request failed' });\n  }\n}\n\n/**\n * Reset password\n */\nexport async function resetPassword(req: Request, res: Response): Promise<void> {\n  try {\n    const { token, newPassword } = req.body;\n\n    if (!token || !newPassword) {\n      res.status(400).json({ error: 'Token and new password are required' });\n      return;\n    }\n\n    // Validate password strength\n    const passwordValidation = validatePasswordStrength(newPassword);\n    if (!passwordValidation.isValid) {\n      res.status(400).json({ error: 'Password validation failed', details: passwordValidation.errors });\n      return;\n    }\n\n    // Get user by reset token\n    if (!storage.getUserByResetToken) {\n      res.status(501).json({ error: 'Password reset is unavailable' });\n      return;\n    }\n    const user = (await storage.getUserByResetToken(token)) as AuthUser | null;\n    if (!user) {\n      res.status(400).json({ error: 'Invalid or expired reset token' });\n      return;\n    }\n\n    // Check if token is expired\n    if (user.resetTokenExpiry && user.resetTokenExpiry < new Date()) {\n      res.status(400).json({ error: 'Reset token has expired' });\n      return;\n    }\n\n    // Hash new password\n    const hashedPassword = await hashPassword(newPassword);\n\n    // Update user password and clear reset token\n    if (!storage.updateUserPassword) {\n      res.status(501).json({ error: 'Password reset is unavailable' });\n      return;\n    }\n    await storage.updateUserPassword(user.id, hashedPassword);\n\n    // In a real implementation, you'd invalidate all sessions for this user\n    // For now, we'll just log that this would happen\n\n    res.json({ message: 'Password reset successfully' });\n  } catch (error) {\n    console.error('Password reset error:', error);\n    res.status(500).json({ error: 'Password reset failed' });\n  }\n}\n\n/**\n * Change user password\n */\nexport async function changePassword(req: AuthRequest, res: Response): Promise<void> {\n  try {\n    if (!req.user) {\n      res.status(401).json({ error: 'Authentication required' });\n      return;\n    }\n\n    const { currentPassword, newPassword } = req.body;\n\n    if (!currentPassword || !newPassword) {\n      res.status(400).json({ error: 'Current password and new password are required' });\n      return;\n    }\n\n    // Validate new password strength\n    const passwordValidation = validatePasswordStrength(newPassword);\n    if (!passwordValidation.isValid) {\n      res.status(400).json({ error: 'New password does not meet requirements', details: passwordValidation.errors });\n      return;\n    }\n\n    // Get user to verify current password\n    const getUserById = requireStorageMethod('getUserById');\n    const user = (await getUserById(req.user.id)) as AuthUser | undefined;\n    if (!user) {\n      res.status(404).json({ error: 'User not found' });\n      return;\n    }\n\n    // Verify current password\n    const isValidPassword = await verifyPassword(currentPassword, user.password);\n    if (!isValidPassword) {\n      res.status(401).json({ error: 'Current password is incorrect' });\n      return;\n    }\n\n    // Hash new password\n    const hashedNewPassword = await hashPassword(newPassword);\n\n    // Update password\n    if (!storage.updateUserPassword) {\n      res.status(501).json({ error: 'Password changes are unavailable' });\n      return;\n    }\n    await storage.updateUserPassword(user.id, hashedNewPassword);\n\n    res.json({ message: 'Password changed successfully' });\n  } catch (error) {\n    console.error('Change password error:', error);\n    res.status(500).json({ error: 'Password change failed' });\n  }\n}\n\n/**\n * Get current user profile\n */\nexport async function getProfile(req: AuthRequest, res: Response): Promise<void> {\n  try {\n    if (!req.user) {\n      res.status(401).json({ error: 'Authentication required' });\n      return;\n    }\n\n    // Get user with sensitive data removed\n    const getUserById = requireStorageMethod('getUserById');\n    const user = (await getUserById(req.user.id)) as AuthUser | undefined;\n    if (!user) {\n      res.status(404).json({ error: 'User not found' });\n      return;\n    }\n\n    res.json({\n      id: user.id,\n      email: user.email,\n      firstName: user.firstName,\n      lastName: user.lastName,\n      emailVerified: user.emailVerified,\n      twoFactorEnabled: user.twoFactorEnabled,\n      createdAt: user.createdAt,\n      updatedAt: user.updatedAt,\n    });\n  } catch (error) {\n    console.error('Get profile error:', error);\n    res.status(500).json({ error: 'Failed to get profile' });\n  }\n}\n\n/**\n * Update user profile\n */\nexport async function updateProfile(req: AuthRequest, res: Response): Promise<void> {\n  try {\n    if (!req.user) {\n      res.status(401).json({ error: 'Authentication required' });\n      return;\n    }\n\n    const { firstName, lastName } = req.body;\n\n    // Validate input\n    if (firstName !== undefined && typeof firstName !== 'string') {\n      res.status(400).json({ error: 'First name must be a string' });\n      return;\n    }\n\n    if (lastName !== undefined && typeof lastName !== 'string') {\n      res.status(400).json({ error: 'Last name must be a string' });\n      return;\n    }\n\n    if (!storage.updateUserProfile) {\n      res.status(501).json({ error: 'Profile updates are unavailable' });\n      return;\n    }\n    const profileUpdates: Partial<User> = {};\n    if (firstName !== undefined) {\n      (profileUpdates as AuthUser).firstName = firstName;\n    }\n    if (lastName !== undefined) {\n      (profileUpdates as AuthUser).lastName = lastName;\n    }\n    await storage.updateUserProfile(req.user.id, profileUpdates);\n    const getUserById = requireStorageMethod('getUserById');\n    const updatedUser = (await getUserById(req.user.id)) as AuthUser | undefined;\n    if (!updatedUser) {\n      res.status(404).json({ error: 'User not found' });\n      return;\n    }\n\n    res.json({\n      message: 'Profile updated successfully',\n      user: {\n        id: updatedUser.id,\n        email: updatedUser.email,\n        firstName: updatedUser.firstName,\n        lastName: updatedUser.lastName,\n        emailVerified: updatedUser.emailVerified,\n        twoFactorEnabled: updatedUser.twoFactorEnabled,\n      },\n    });\n  } catch (error) {\n    console.error('Update profile error:', error);\n    res.status(500).json({ error: 'Profile update failed' });\n  }\n}\n\n// Export the enhanced auth system\nexport default {\n  authenticateToken,\n  authenticateRefreshToken,\n  register,\n  login,\n  logout,\n  refreshAccessToken,\n  enableTwoFactor,\n  verifyTwoFactorSetup,\n  disableTwoFactor,\n  requestPasswordReset,\n  resetPassword,\n  changePassword,\n  getProfile,\n  updateProfile,\n  loginLimiter,\n  apiLimiter,\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/auth-mock.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/auth.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":391,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":391,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11009,11012],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11009,11012],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":404,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":404,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11322,11325],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11322,11325],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":466,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":466,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13328,13331],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13328,13331],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":466,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":466,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13345,13348],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13345,13348],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":472,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":472,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13554,13557],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13554,13557],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * MetaExtract Authentication System\n *\n * Provides:\n * - User registration with email/password\n * - Login with JWT session tokens\n * - Session validation middleware\n * - Tier enforcement based on subscription status\n */\n\nimport type { Express, Request, Response, NextFunction } from 'express';\nimport bcrypt from 'bcryptjs';\nimport jwt from 'jsonwebtoken';\nimport { z } from 'zod';\nimport crypto from 'crypto';\nimport { db } from './db';\nimport { users, subscriptions, creditBalances } from '@shared/schema';\nimport { eq, sql } from 'drizzle-orm';\nimport { normalizeTier } from '@shared/tierConfig';\nimport {\n  isLockedOut,\n  recordFailedAttempt,\n  clearFailedAttempts,\n  generateUserCSRFToken,\n  validateUserCSRFToken,\n} from './security-utils';\nimport {\n  handleEmailVerification,\n  handleResendVerification,\n} from './utils/email-verification';\nimport {\n  handleLogoutWithRevocation,\n  handleRevokeAllSessions,\n} from './utils/session-revocation';\n\n// ============================================================================\n// CSRF Protection Middleware\n// ============================================================================\n\n/**\n * Simple CSRF protection middleware for auth routes\n * Validates CSRF token from header against user-specific token\n */\nfunction csrfProtection(req: Request, res: Response, next: NextFunction): void {\n  // Skip CSRF for GET, HEAD, OPTIONS requests\n  if (['GET', 'HEAD', 'OPTIONS'].includes(req.method)) {\n    next();\n    return;\n  }\n\n  // Check for CSRF token in header\n  const csrfToken = req.headers['x-csrf-token'] as string;\n  if (!csrfToken) {\n    res.status(403).json({\n      error: 'CSRF token required',\n      message: 'Please include X-CSRF-Token header',\n    });\n    return;\n  }\n\n  // Get user ID from authenticated request\n  const userId = (req as AuthRequest).user?.id;\n  if (!userId) {\n    res.status(401).json({\n      error: 'Authentication required',\n      message: 'Please authenticate before performing this action',\n    });\n    return;\n  }\n\n  // Validate CSRF token\n  if (!validateUserCSRFToken(csrfToken, userId)) {\n    res.status(403).json({\n      error: 'Invalid CSRF token',\n      message: 'Please refresh the page and try again',\n    });\n    return;\n  }\n\n  next();\n}\n\n// ============================================================================\n// Route Registration\n// ============================================================================\n\nconst JWT_SECRET = process.env.JWT_SECRET;\nif (!JWT_SECRET) {\n  throw new Error(\n    'CRITICAL: JWT_SECRET environment variable is required for security. ' +\n      'Please set this in your .env file before starting the server. ' +\n      'Generate a strong random secret: openssl rand -hex 32'\n  );\n}\n\n// Token and session configuration\nconst JWT_EXPIRES_IN = '7d'; // 7 days\nconst TOKEN_EXPIRY_MS = 7 * 24 * 60 * 60 * 1000; // Must match JWT_EXPIRES_IN\nconst SALT_ROUNDS = 12;\n\n// Cookie configuration - enhanced security\nconst COOKIE_NAME = 'auth_token';\nconst COOKIE_OPTIONS = {\n  httpOnly: true,\n  // Lax is required so login persists across Dodo checkout redirects.\n  sameSite: 'lax' as const,\n  secure: process.env.NODE_ENV === 'production',\n  maxAge: TOKEN_EXPIRY_MS,\n};\n\n// Token parsing\nconst BEARER_PREFIX = 'Bearer ';\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface AuthUser {\n  id: string;\n  email: string;\n  username: string;\n  tier: string;\n  subscriptionStatus: string | null;\n  subscriptionId: string | null;\n}\n\nexport interface AuthRequest extends Request {\n  user?: AuthUser;\n  isAuthenticated?: boolean;\n}\n\n// ============================================================================\n// Validation Schemas\n// ============================================================================\n\nconst registerSchema = z.object({\n  email: z.string().email('Invalid email address'),\n  username: z.string().min(3, 'Username must be at least 3 characters').max(50),\n  password: z\n    .string()\n    .min(8, 'Password must be at least 8 characters')\n    .regex(/[A-Z]/, 'Password must contain at least one uppercase letter')\n    .regex(/[a-z]/, 'Password must contain at least one lowercase letter')\n    .regex(/[0-9]/, 'Password must contain at least one number')\n    .regex(\n      /[^A-Za-z0-9]/,\n      'Password must contain at least one special character'\n    ),\n});\n\nconst loginSchema = z.object({\n  email: z.string().email('Invalid email address'),\n  password: z.string().min(1, 'Password is required'),\n  tier: z.string().optional(),\n});\n\nconst passwordResetRequestSchema = z.object({\n  email: z.string().email('Invalid email address'),\n});\n\nconst passwordResetConfirmSchema = z.object({\n  token: z.string().min(10, 'Invalid token'),\n  password: registerSchema.shape.password,\n});\n\ntype ResetTokenRecord = {\n  userId: string;\n  tokenHash: string;\n  expiresAt: number;\n};\nconst inMemoryResetTokens = new Map<string, ResetTokenRecord>();\n\nfunction hashResetToken(token: string): string {\n  return crypto.createHash('sha256').update(token).digest('hex');\n}\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\n/**\n * Create an AuthUser object from database user data\n */\nfunction createAuthUser(user: {\n  id: string;\n  email: string;\n  username: string;\n  tier: string;\n  subscriptionStatus: string | null;\n  subscriptionId: string | null;\n}): AuthUser {\n  return {\n    id: user.id,\n    email: user.email,\n    username: user.username,\n    tier: user.tier,\n    subscriptionStatus: user.subscriptionStatus,\n    subscriptionId: user.subscriptionId,\n  };\n}\n\n/**\n * Set authentication cookie on response\n */\nfunction setAuthCookie(res: Response, token: string): void {\n  res.cookie(COOKIE_NAME, token, {\n    ...COOKIE_OPTIONS,\n    secure: process.env.NODE_ENV === 'production',\n    maxAge: TOKEN_EXPIRY_MS,\n  });\n}\n\nfunction generateToken(user: AuthUser): string {\n  return jwt.sign(\n    {\n      id: user.id,\n      email: user.email,\n      username: user.username,\n      tier: user.tier,\n    },\n    JWT_SECRET!,\n    { expiresIn: JWT_EXPIRES_IN }\n  );\n}\n\nexport function verifyToken(token: string): AuthUser | null {\n  try {\n    const decoded = jwt.verify(token, JWT_SECRET!) as AuthUser;\n    return decoded;\n  } catch {\n    return null;\n  }\n}\n\nfunction isDatabaseConnectionError(error: unknown): boolean {\n  if (!error || typeof error !== 'object') {\n    return false;\n  }\n  const code = (error as { code?: string }).code;\n  return (\n    code === 'ECONNREFUSED' ||\n    code === 'ECONNRESET' ||\n    code === 'ETIMEDOUT' ||\n    code === 'ENOTFOUND' ||\n    code === '57P01' ||\n    code === '3D000'\n  );\n}\n\n// ============================================================================\n// Middleware\n// ============================================================================\n\n/**\n * Authentication middleware - validates JWT and attaches user to request\n * Does NOT block unauthenticated requests - use requireAuth for that\n */\nexport function authMiddleware(\n  req: AuthRequest,\n  res: Response,\n  next: NextFunction\n) {\n  const authHeader = req.headers.authorization;\n  const cookieToken = req.cookies?.[COOKIE_NAME];\n\n  const token = authHeader?.startsWith(BEARER_PREFIX)\n    ? authHeader.slice(BEARER_PREFIX.length)\n    : cookieToken;\n\n  if (token) {\n    const user = verifyToken(token);\n    if (user) {\n      req.user = user;\n      req.isAuthenticated = true;\n    }\n  }\n\n  req.isAuthenticated = req.isAuthenticated || false;\n  next();\n}\n\n/**\n * Require authentication - returns 401 if not authenticated\n */\nexport function requireAuth(\n  req: AuthRequest,\n  res: Response,\n  next: NextFunction\n) {\n  if (!req.isAuthenticated || !req.user) {\n    return res.status(401).json({\n      error: 'Authentication required',\n      code: 'AUTH_REQUIRED',\n    });\n  }\n  next();\n}\n\n/**\n * Require specific tier - returns 403 if user's tier is insufficient\n */\nexport function requireTier(...allowedTiers: string[]) {\n  return (req: AuthRequest, res: Response, next: NextFunction) => {\n    if (!req.user) {\n      return res.status(401).json({\n        error: 'Authentication required',\n        code: 'AUTH_REQUIRED',\n      });\n    }\n\n    if (!allowedTiers.includes(req.user.tier)) {\n      return res.status(403).json({\n        error: 'Upgrade required',\n        code: 'TIER_UPGRADE_REQUIRED',\n        current_tier: req.user.tier,\n        required_tiers: allowedTiers,\n      });\n    }\n\n    next();\n  };\n}\n\n/**\n * Get effective tier for a request\n * - Authenticated users: use their subscription tier\n * - Unauthenticated users: \"enterprise\" tier (full access)\n */\nexport function getEffectiveTier(req: AuthRequest): string {\n  if (req.user && req.user.subscriptionStatus === 'active') {\n    return req.user.tier;\n  }\n  return 'enterprise';\n}\n\n// ============================================================================\n// Route Handlers\n// ============================================================================\n\nexport function registerAuthRoutes(app: Express) {\n  // -------------------------------------------------------------------------\n  // Password Reset (dev-friendly)\n  // -------------------------------------------------------------------------\n  // This does not send email yet; in development we return the token so you can test.\n  app.post(\n    '/api/auth/password-reset/request',\n    async (req: Request, res: Response) => {\n      try {\n        const validation = passwordResetRequestSchema.safeParse(req.body);\n        if (!validation.success) {\n          return res.status(400).json({\n            error: 'Validation failed',\n            details: validation.error.flatten().fieldErrors,\n          });\n        }\n\n        if (!db) {\n          return res.status(503).json({\n            error: 'Database not available',\n            message: 'Please configure DATABASE_URL',\n          });\n        }\n\n        const email = validation.data.email;\n        const [user] = await db\n          .select()\n          .from(users)\n          .where(eq(users.email, email))\n          .limit(1);\n\n        // Always return a generic message to avoid email enumeration.\n        if (!user) {\n          return res.json({\n            message:\n              'If an account exists with this email, a reset link has been sent.',\n          });\n        }\n\n        const token = crypto.randomBytes(24).toString('hex');\n        const tokenHash = hashResetToken(token);\n        const expiresAt = Date.now() + 15 * 60 * 1000; // 15 minutes\n\n        // Persist token if table exists; otherwise fall back to in-memory (dev/test).\n        try {\n          await db.execute(sql`\n          insert into password_reset_tokens\n            (user_id, token_hash, expires_at, used_at, created_at)\n          values\n            (${user.id}, ${tokenHash}, to_timestamp(${expiresAt} / 1000.0), null, now())\n        `);\n        } catch (e: any) {\n          // 42P01: undefined_table\n          if (e?.code === '42P01') {\n            inMemoryResetTokens.set(tokenHash, {\n              userId: user.id,\n              tokenHash,\n              expiresAt,\n            });\n          } else {\n            throw e;\n          }\n        }\n\n        const response: any = {\n          message:\n            'If an account exists with this email, a reset link has been sent.',\n        };\n        if (process.env.NODE_ENV === 'development') {\n          response.token = token;\n        }\n        return res.json(response);\n      } catch (error: unknown) {\n        console.error('Password reset request error:', error);\n        return res.status(500).json({ error: 'Password reset request failed' });\n      }\n    }\n  );\n\n  app.post(\n    '/api/auth/password-reset/confirm',\n    csrfProtection, // Add CSRF protection for password reset\n    async (req: Request, res: Response) => {\n      try {\n        const validation = passwordResetConfirmSchema.safeParse(req.body);\n        if (!validation.success) {\n          return res.status(400).json({\n            error: 'Validation failed',\n            details: validation.error.flatten().fieldErrors,\n          });\n        }\n\n        if (!db) {\n          return res.status(503).json({\n            error: 'Database not available',\n            message: 'Please configure DATABASE_URL',\n          });\n        }\n\n        const { token, password } = validation.data;\n        const tokenHash = hashResetToken(token);\n\n        // Prefer DB-backed tokens, fall back to in-memory if table missing.\n        let userId: string | null = null;\n        let expiresAtMs: number | null = null;\n        let tokenRowId: string | null = null;\n\n        // Security: Ensure token is a string and not empty\n        if (!token || typeof token !== 'string' || token.length < 10) {\n          return res\n            .status(400)\n            .json({ error: 'Invalid or expired reset token' });\n        }\n\n        try {\n          const result = await db.execute(sql`\n          select\n            id,\n            user_id as \"userId\",\n            extract(epoch from expires_at) * 1000 as \"expiresAtMs\",\n            used_at as \"usedAt\"\n          from password_reset_tokens\n          where token_hash = ${tokenHash}\n          limit 1\n        `);\n\n          const row: any = (result as any).rows?.[0] ?? null;\n          if (row && !row.usedAt) {\n            userId = row.userId;\n            expiresAtMs = Number(row.expiresAtMs);\n            tokenRowId = row.id;\n          }\n        } catch (e: any) {\n          if (e?.code === '42P01') {\n            const rec = inMemoryResetTokens.get(tokenHash);\n            if (rec) {\n              userId = rec.userId;\n              expiresAtMs = rec.expiresAt;\n            }\n          } else {\n            throw e;\n          }\n        }\n\n        if (!userId || !expiresAtMs || Date.now() > expiresAtMs) {\n          return res\n            .status(400)\n            .json({ error: 'Invalid or expired reset token' });\n        }\n\n        const hashedPassword = await bcrypt.hash(password, SALT_ROUNDS);\n        await db\n          .update(users)\n          .set({ password: hashedPassword, updatedAt: new Date() })\n          .where(eq(users.id, userId));\n\n        if (tokenRowId) {\n          try {\n            await db.execute(sql`\n            update password_reset_tokens set used_at = now() where id = ${tokenRowId}\n          `);\n          } catch {\n            // ignore\n          }\n        } else {\n          inMemoryResetTokens.delete(tokenHash);\n        }\n\n        return res.json({ success: true });\n      } catch (error: unknown) {\n        console.error('Password reset confirm error:', error);\n        return res.status(500).json({ error: 'Password reset failed' });\n      }\n    }\n  );\n\n  // -------------------------------------------------------------------------\n  // Register\n  // -------------------------------------------------------------------------\n  app.post('/api/auth/register', async (req: Request, res: Response) => {\n    try {\n      // Validate input\n      const validation = registerSchema.safeParse(req.body);\n      if (!validation.success) {\n        return res.status(400).json({\n          error: 'Validation failed',\n          details: validation.error.flatten().fieldErrors,\n        });\n      }\n\n      const { email, username, password } = validation.data;\n\n      // Check if db is available\n      if (!db) {\n        return res.status(503).json({\n          error: 'Database not available',\n          message: 'Please configure DATABASE_URL for user registration',\n        });\n      }\n\n      // Check if email already exists\n      const existingEmail = await db\n        .select()\n        .from(users)\n        .where(eq(users.email, email))\n        .limit(1);\n      if (existingEmail.length > 0) {\n        return res.status(409).json({\n          error: 'Email already registered',\n          code: 'EMAIL_EXISTS',\n        });\n      }\n\n      // Check if username already exists\n      const existingUsername = await db\n        .select()\n        .from(users)\n        .where(eq(users.username, username))\n        .limit(1);\n      if (existingUsername.length > 0) {\n        return res.status(409).json({\n          error: 'Username already taken',\n          code: 'USERNAME_EXISTS',\n        });\n      }\n\n      // Hash password\n      const hashedPassword = await bcrypt.hash(password, SALT_ROUNDS);\n\n      // Create user\n      const [newUser] = await db\n        .insert(users)\n        .values({\n          email,\n          username,\n          password: hashedPassword,\n          tier: 'enterprise',\n          subscriptionStatus: 'none',\n        })\n        .returning();\n\n      //  Use helper to create AuthUser\n      const authUser = createAuthUser(newUser);\n      const token = generateToken(authUser);\n\n      //  Use helper to set cookie\n      setAuthCookie(res, token);\n\n      // Create initial credit balance for new user\n      try {\n        await db.insert(creditBalances).values({\n          userId: newUser.id,\n          sessionId: `credits:core:user:${newUser.id}`,\n          credits: 0, // New users start with 0 credits\n        });\n      } catch (creditError) {\n        console.error(\n          'Could not create initial credit balance for user:',\n          creditError\n        );\n        // Continue registration even if credit balance creation fails\n      }\n\n      res.status(201).json({\n        success: true,\n        user: {\n          id: newUser.id,\n          email: newUser.email,\n          username: newUser.username,\n          tier: newUser.tier,\n          credits: 0, // New users start with 0 credits\n        },\n        token,\n      });\n    } catch (error: unknown) {\n      console.error('Registration error:', error);\n      const status = isDatabaseConnectionError(error) ? 503 : 500;\n      res.status(status).json({\n        error: 'Registration failed',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  });\n\n  // -------------------------------------------------------------------------\n  // Login\n  // -------------------------------------------------------------------------\n  app.post('/api/auth/login', async (req: Request, res: Response) => {\n    try {\n      // Check for brute force - use email as identifier\n      const loginIdentifier =\n        (req.body?.email as string) || req.ip || 'unknown';\n      const lockStatus = isLockedOut(\n        `login:${loginIdentifier}`,\n        5,\n        15 * 60 * 1000\n      );\n\n      if (lockStatus.locked) {\n        res.setHeader(\n          'Retry-After',\n          Math.ceil((lockStatus.resetTime - Date.now()) / 1000)\n        );\n        return res.status(429).json({\n          error: 'Too many login attempts',\n          message: 'Please wait 15 minutes before trying again',\n          retryAfter: Math.ceil((lockStatus.resetTime - Date.now()) / 1000),\n        });\n      }\n\n      // Validate input\n      const validation = loginSchema.safeParse(req.body);\n      if (!validation.success) {\n        return res.status(400).json({\n          error: 'Validation failed',\n          details: validation.error.flatten().fieldErrors,\n        });\n      }\n\n      const { email, password, tier } = validation.data;\n\n      // Check if db is available\n      if (!db) {\n        return res.status(503).json({\n          error: 'Database not available',\n          message: 'Please configure DATABASE_URL',\n        });\n      }\n\n      // Find user\n      const [user] = await db\n        .select()\n        .from(users)\n        .where(eq(users.email, email))\n        .limit(1);\n\n      if (!user) {\n        // Record failed attempt even for non-existent users (prevent username enumeration)\n        recordFailedAttempt(`login:${loginIdentifier}`, 5, 15 * 60 * 1000);\n        return res.status(401).json({\n          error: 'Invalid credentials',\n          code: 'INVALID_CREDENTIALS',\n        });\n      }\n\n      // Verify password\n      const isValid = await bcrypt.compare(password, user.password);\n      if (!isValid) {\n        recordFailedAttempt(`login:${loginIdentifier}`, 5, 15 * 60 * 1000);\n        return res.status(401).json({\n          error: 'Invalid credentials',\n          code: 'INVALID_CREDENTIALS',\n        });\n      }\n\n      // Clear failed attempts on successful login\n      clearFailedAttempts(`login:${loginIdentifier}`);\n\n      // Check subscription status (refresh from DB)\n      let currentTier = user.tier;\n      let subscriptionStatus = user.subscriptionStatus;\n\n      if (user.subscriptionId) {\n        const [sub] = await db\n          .select()\n          .from(subscriptions)\n          .where(eq(subscriptions.dodoSubscriptionId, user.subscriptionId))\n          .limit(1);\n\n        if (sub) {\n          currentTier = sub.tier;\n          subscriptionStatus = sub.status;\n        }\n      }\n\n      // Tier override is DISABLED by default and requires explicit environment variable\n      // This should NEVER be enabled in production\n      const allowTierOverride =\n        process.env.ALLOW_TIER_OVERRIDE === 'true' &&\n        process.env.NODE_ENV === 'development';\n\n      if (allowTierOverride && tier) {\n        const overrideTier = normalizeTier(tier);\n        currentTier = overrideTier;\n        subscriptionStatus = 'active';\n        await db\n          .update(users)\n          .set({ tier: overrideTier, subscriptionStatus: 'active' })\n          .where(eq(users.id, user.id));\n      }\n\n      //  Create AuthUser with subscription-aware tier\n      const authUser: AuthUser = {\n        id: user.id,\n        email: user.email,\n        username: user.username,\n        tier: currentTier,\n        subscriptionStatus,\n        subscriptionId: user.subscriptionId,\n      };\n\n      const token = generateToken(authUser);\n\n      //  Use helper to set cookie\n      setAuthCookie(res, token);\n\n      // Get user's credit balance\n      let creditBalance = 0;\n      try {\n        const [balance] = await db\n          .select({ credits: creditBalances.credits })\n          .from(creditBalances)\n          .where(eq(creditBalances.userId, user.id))\n          .limit(1);\n\n        if (balance) {\n          creditBalance = balance.credits;\n        }\n      } catch (creditError) {\n        console.warn('Could not fetch credit balance for user:', creditError);\n        // Continue without credit info if there's an error\n      }\n\n      res.json({\n        success: true,\n        user: {\n          id: user.id,\n          email: user.email,\n          username: user.username,\n          tier: currentTier,\n          subscriptionStatus,\n          credits: creditBalance, // Include credit balance in user response\n        },\n        token,\n      });\n    } catch (error: unknown) {\n      console.error('Login error:', error);\n      const status = isDatabaseConnectionError(error) ? 503 : 500;\n      res.status(status).json({\n        error: 'Login failed',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  });\n\n  // -------------------------------------------------------------------------\n  // Logout\n  // -------------------------------------------------------------------------\n  app.post('/api/auth/logout', async (req: Request, res: Response) => {\n    await handleLogoutWithRevocation(req, res);\n  });\n\n  // -------------------------------------------------------------------------\n  // CSRF Token Generation\n  // -------------------------------------------------------------------------\n  app.get(\n    '/api/auth/csrf-token',\n    authMiddleware,\n    async (req: AuthRequest, res: Response) => {\n      try {\n        if (!req.user?.id) {\n          return res.status(401).json({ error: 'Authentication required' });\n        }\n\n        const token = generateUserCSRFToken(req.user.id);\n\n        // Set CSRF token in cookie for client-side access\n        res.cookie('csrf_token', token, {\n          httpOnly: false, // Allow client-side JavaScript to read for AJAX requests\n          secure: process.env.NODE_ENV === 'production',\n          sameSite: 'strict',\n          maxAge: 60 * 60 * 1000, // 1 hour\n        });\n\n        res.json({\n          token,\n          expiresAt: Date.now() + 60 * 60 * 1000,\n        });\n      } catch (error) {\n        console.error('CSRF token generation error:', error);\n        res.status(500).json({\n          error: 'Failed to generate CSRF token',\n          message: error instanceof Error ? error.message : 'Unknown error',\n        });\n      }\n    }\n  );\n\n  // -------------------------------------------------------------------------\n  // CSRF Token Generation\n  // -------------------------------------------------------------------------\n  app.get(\n    '/api/auth/csrf-token',\n    authMiddleware,\n    async (req: AuthRequest, res: Response) => {\n      try {\n        if (!req.user?.id) {\n          return res.status(401).json({ error: 'Authentication required' });\n        }\n\n        // Generate user-specific CSRF token\n        const token = generateUserCSRFToken(req.user.id);\n\n        // Set CSRF token in cookie for client-side access\n        res.cookie('csrf_token', token, {\n          httpOnly: false, // Allow client-side JavaScript to read for AJAX requests\n          secure: process.env.NODE_ENV === 'production',\n          sameSite: 'strict',\n          maxAge: 60 * 60 * 1000, // 1 hour\n        });\n\n        res.json({\n          token,\n          expiresAt: Date.now() + 60 * 60 * 1000,\n        });\n      } catch (error) {\n        console.error('CSRF token generation error:', error);\n        res.status(500).json({\n          error: 'Failed to generate CSRF token',\n          message: error instanceof Error ? error.message : 'Unknown error',\n        });\n      }\n    }\n  );\n\n  // -------------------------------------------------------------------------\n  // Get Current User (Session Validation)\n  // -------------------------------------------------------------------------\n  app.get(\n    '/api/auth/me',\n    authMiddleware,\n    async (req: AuthRequest, res: Response) => {\n      try {\n        if (!req.isAuthenticated || !req.user) {\n          return res.json({\n            authenticated: false,\n            user: null,\n          });\n        }\n\n        // Refresh user data from DB if available\n        if (db) {\n          try {\n            const [freshUser] = await db\n              .select()\n              .from(users)\n              .where(eq(users.id, req.user.id))\n              .limit(1);\n\n            if (freshUser) {\n              return res.json({\n                authenticated: true,\n                user: {\n                  id: freshUser.id,\n                  email: freshUser.email,\n                  username: freshUser.username,\n                  tier: freshUser.tier,\n                  subscriptionStatus: freshUser.subscriptionStatus,\n                },\n              });\n            }\n          } catch {\n            // Fall back to token data\n          }\n        }\n\n        res.json({\n          authenticated: true,\n          user: {\n            id: req.user.id,\n            email: req.user.email,\n            username: req.user.username,\n            tier: req.user.tier,\n            subscriptionStatus: req.user.subscriptionStatus,\n          },\n        });\n      } catch (error) {\n        console.error('Auth session check error:', error);\n        res.status(200).json({\n          authenticated: false,\n          user: null,\n          error: 'Session check failed',\n        });\n      }\n    }\n  );\n\n  // -------------------------------------------------------------------------\n  // Refresh Token\n  // -------------------------------------------------------------------------\n  app.post(\n    '/api/auth/refresh',\n    authMiddleware,\n    async (req: AuthRequest, res: Response) => {\n      if (!req.isAuthenticated || !req.user) {\n        return res.status(401).json({\n          error: 'Not authenticated',\n          code: 'NOT_AUTHENTICATED',\n        });\n      }\n\n      // Refresh user data from DB\n      if (db) {\n        try {\n          const [freshUser] = await db\n            .select()\n            .from(users)\n            .where(eq(users.id, req.user.id))\n            .limit(1);\n\n          if (freshUser) {\n            //  Use helper to create AuthUser\n            const authUser = createAuthUser(freshUser);\n            const token = generateToken(authUser);\n\n            //  Use helper to set cookie\n            setAuthCookie(res, token);\n\n            return res.json({\n              success: true,\n              user: {\n                id: freshUser.id,\n                email: freshUser.email,\n                username: freshUser.username,\n                tier: freshUser.tier,\n                subscriptionStatus: freshUser.subscriptionStatus,\n              },\n              token,\n            });\n          }\n        } catch {\n          // Fall through\n        }\n      }\n\n      // Re-issue token with existing data\n      const token = generateToken(req.user);\n\n      //  Use helper to set cookie\n      setAuthCookie(res, token);\n\n      res.json({\n        success: true,\n        user: req.user,\n        token,\n      });\n    }\n  );\n\n  // -------------------------------------------------------------------------\n  // Update User Tier (Called by webhook handlers)\n  // -------------------------------------------------------------------------\n  app.post(\n    '/api/auth/update-tier',\n    authMiddleware,\n    async (req: AuthRequest, res: Response) => {\n      // This should only be called internally by webhook handlers\n      // Now requires authentication - only authenticated users can call this\n\n      if (!req.user) {\n        return res.status(401).json({ error: 'Authentication required' });\n      }\n\n      // Only allow admin users or the user themselves to update tiers\n      const { userId, tier, subscriptionId, subscriptionStatus } = req.body;\n\n      //  Validate required fields (single check, not duplicate)\n      if (!userId || !tier) {\n        return res.status(400).json({ error: 'userId and tier required' });\n      }\n\n      // For now, only allow users to update their own tier\n      // In production, this should be restricted to admin/internal calls only\n      if (req.user.id !== userId) {\n        return res.status(403).json({ error: 'Can only update your own tier' });\n      }\n\n      if (!db) {\n        return res.status(503).json({ error: 'Database not available' });\n      }\n\n      try {\n        await db\n          .update(users)\n          .set({\n            tier,\n            subscriptionId: subscriptionId || null,\n            subscriptionStatus: subscriptionStatus || 'active',\n          })\n          .where(eq(users.id, userId));\n\n        res.json({ success: true });\n      } catch (error) {\n        console.error('Update tier error:', error);\n        res.status(500).json({ error: 'Failed to update tier' });\n      }\n    }\n  );\n\n  // -------------------------------------------------------------------------\n  // Email Verification\n  // -------------------------------------------------------------------------\n  app.post('/api/auth/verify-email', async (req: Request, res: Response) => {\n    await handleEmailVerification(req, res);\n  });\n\n  app.post(\n    '/api/auth/resend-verification',\n    requireAuth,\n    async (req: AuthRequest, res: Response) => {\n      await handleResendVerification(req, res);\n    }\n  );\n\n  // -------------------------------------------------------------------------\n  // Session Revocation\n  // -------------------------------------------------------------------------\n  app.post(\n    '/api/auth/logout-all',\n    requireAuth,\n    async (req: AuthRequest, res: Response) => {\n      await handleRevokeAllSessions(req, res);\n    }\n  );\n\n  app.post('/api/auth/logout', async (req: Request, res: Response) => {\n    await handleLogoutWithRevocation(req, res);\n  });\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/cache.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":178,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":178,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5301,5304],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5301,5304],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":299,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":299,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8416,8419],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8416,8419],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":323,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":323,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":350,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":350,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9995,9998],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9995,9998],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":351,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":351,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10035,10038],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10035,10038],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'reason' is assigned a value but never used. Allowed unused args must match /^_/u.","line":393,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":393,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":448,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":448,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12176,12179],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12176,12179],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":457,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":457,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12451,12454],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12451,12454],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":465,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":465,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12596,12599],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12596,12599],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":471,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":471,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12761,12764],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12761,12764],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":472,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":472,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12818,12821],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12818,12821],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Redis Caching Layer for MetaExtract API\n *\n * Provides intelligent caching for API responses to improve performance\n * and reduce database load. Includes cache invalidation, monitoring,\n * and configurable TTL strategies.\n */\n\nimport { createClient, RedisClientType } from 'redis';\n\n// ============================================================================\n// Cache Configuration\n// ============================================================================\n\nexport interface CacheConfig {\n  enabled: boolean;\n  url: string;\n  defaultTTL: number; // Time to live in seconds\n  maxMemory: string; // Redis max memory configuration\n  evictionPolicy: string; // Redis eviction policy\n}\n\nexport const DEFAULT_CACHE_CONFIG: CacheConfig = {\n  enabled: process.env.REDIS_CACHE_ENABLED !== 'false',\n  url: process.env.REDIS_URL || 'redis://localhost:6379',\n  defaultTTL: 300, // 5 minutes default\n  maxMemory: '256mb',\n  evictionPolicy: 'allkeys-lru',\n};\n\n// ============================================================================\n// Cache Entry Structure\n// ============================================================================\n\nexport interface CacheEntry<T> {\n  key: string;\n  value: T;\n  ttl: number;\n  createdAt: number;\n  accessedAt: number;\n  hitCount: number;\n  metadata: {\n    tags?: string[];\n    version?: string;\n    tier?: string;\n  };\n}\n\n// ============================================================================\n// Cache Strategies\n// ============================================================================\n\nexport enum CacheStrategy {\n  SHORT_TERM = 'short',      // 5 minutes - frequently changing data\n  MEDIUM_TERM = 'medium',    // 1 hour - semi-static data\n  LONG_TERM = 'long',        // 1 day - rarely changing data\n  DYNAMIC = 'dynamic',       // Based on data characteristics\n}\n\nexport const CACHE_TTL = {\n  [CacheStrategy.SHORT_TERM]: 300,      // 5 minutes\n  [CacheStrategy.MEDIUM_TERM]: 3600,    // 1 hour\n  [CacheStrategy.LONG_TERM]: 86400,     // 1 day\n  [CacheStrategy.DYNAMIC]: 0,           // Calculated at runtime\n};\n\n// ============================================================================\n// Cache Manager Class\n// ============================================================================\n\nexport class CacheManager {\n  private client: RedisClientType | null = null;\n  private config: CacheConfig;\n  private metrics: CacheMetrics;\n  private initialized: boolean = false;\n\n  constructor(config: Partial<CacheConfig> = {}) {\n    this.config = { ...DEFAULT_CACHE_CONFIG, ...config };\n    this.metrics = new CacheMetrics();\n  }\n\n  async initialize(): Promise<void> {\n    if (!this.config.enabled) {\n      console.log(' Redis caching disabled');\n      return;\n    }\n\n    try {\n      this.client = createClient({\n        url: this.config.url,\n        socket: {\n          reconnectStrategy: (retries: number) => {\n            if (retries > 10) {\n              console.error(' Redis reconnection failed after 10 attempts');\n              return new Error('Reconnection failed');\n            }\n            return Math.min(retries * 100, 3000);\n          },\n        },\n      });\n\n      this.client.on('error', (err: Error) => {\n        console.error(' Redis client error:', err);\n        this.metrics.incrementError();\n      });\n\n      this.client.on('connect', () => {\n        console.log(' Redis cache connected');\n        this.initialized = true;\n      });\n\n      this.client.on('reconnecting', () => {\n        console.log(' Redis cache reconnecting...');\n      });\n\n      await this.client.connect();\n      await this.configureRedis();\n\n      console.log(' Redis cache layer initialized');\n    } catch (error) {\n      console.error(' Failed to initialize Redis cache:', error);\n      this.client = null;\n      this.initialized = false;\n    }\n  }\n\n  private async configureRedis(): Promise<void> {\n    if (!this.client) return;\n\n    try {\n      // Configure memory limits and eviction policy\n      await this.client.configSet('maxmemory', this.config.maxMemory);\n      await this.client.configSet('maxmemory-policy', this.config.evictionPolicy);\n\n      console.log(' Redis configured:', {\n        maxMemory: this.config.maxMemory,\n        evictionPolicy: this.config.evictionPolicy,\n      });\n    } catch (error) {\n      console.error(' Failed to configure Redis:', error);\n    }\n  }\n\n  // ============================================================================\n  // Cache Operations\n  // ============================================================================\n\n  async get<T>(key: string): Promise<T | null> {\n    if (!this.client || !this.initialized) {\n      this.metrics.incrementMiss('cache_disabled');\n      return null;\n    }\n\n    try {\n      const data = await this.client.get(key);\n      if (data) {\n        this.metrics.incrementHit();\n        await this.updateAccessTime(key);\n        return JSON.parse(data) as T;\n      }\n\n      this.metrics.incrementMiss();\n      return null;\n    } catch (error) {\n      console.error(` Cache get error for key ${key}:`, error);\n      this.metrics.incrementError();\n      return null;\n    }\n  }\n\n  async set<T>(\n    key: string,\n    value: T,\n    options: {\n      ttl?: number;\n      tags?: string[];\n      strategy?: CacheStrategy;\n      metadata?: Record<string, any>;\n    } = {}\n  ): Promise<boolean> {\n    if (!this.client || !this.initialized) {\n      return false;\n    }\n\n    try {\n      const ttl = options.ttl || this.config.defaultTTL;\n      const entry: CacheEntry<T> = {\n        key,\n        value,\n        ttl,\n        createdAt: Date.now(),\n        accessedAt: Date.now(),\n        hitCount: 0,\n        metadata: options.metadata || {},\n      };\n\n      // Add tags if provided\n      if (options.tags && options.tags.length > 0) {\n        entry.metadata.tags = options.tags;\n        await this.addToTags(key, options.tags);\n      }\n\n      await this.client.setEx(key, ttl, JSON.stringify(value));\n      this.metrics.incrementSet();\n\n      return true;\n    } catch (error) {\n      console.error(` Cache set error for key ${key}:`, error);\n      this.metrics.incrementError();\n      return false;\n    }\n  }\n\n  async delete(key: string): Promise<boolean> {\n    if (!this.client || !this.initialized) {\n      return false;\n    }\n\n    try {\n      await this.client.del(key);\n      this.metrics.incrementDelete();\n      return true;\n    } catch (error) {\n      console.error(` Cache delete error for key ${key}:`, error);\n      this.metrics.incrementError();\n      return false;\n    }\n  }\n\n  async invalidateByTag(tag: string): Promise<number> {\n    if (!this.client || !this.initialized) {\n      return 0;\n    }\n\n    try {\n      const keys = await this.getKeysByTag(tag);\n      if (keys.length > 0) {\n        await this.client.del(keys);\n        this.metrics.incrementInvalidation(keys.length);\n        return keys.length;\n      }\n      return 0;\n    } catch (error) {\n      console.error(` Cache invalidation error for tag ${tag}:`, error);\n      this.metrics.incrementError();\n      return 0;\n    }\n  }\n\n  async invalidatePattern(pattern: string): Promise<number> {\n    if (!this.client || !this.initialized) {\n      return 0;\n    }\n\n    try {\n      const keys = await this.client.keys(pattern);\n      if (keys.length > 0) {\n        await this.client.del(keys);\n        this.metrics.incrementInvalidation(keys.length);\n        return keys.length;\n      }\n      return 0;\n    } catch (error) {\n      console.error(` Cache pattern invalidation error:`, error);\n      this.metrics.incrementError();\n      return 0;\n    }\n  }\n\n  // ============================================================================\n  // Cache Management\n  // ============================================================================\n\n  async clear(): Promise<boolean> {\n    if (!this.client || !this.initialized) {\n      return false;\n    }\n\n    try {\n      await this.client.flushDb();\n      this.metrics.reset();\n      console.log(' Cache cleared');\n      return true;\n    } catch (error) {\n      console.error(' Cache clear error:', error);\n      return false;\n    }\n  }\n\n  async getMetrics(): Promise<CacheMetricsSnapshot> {\n    const info = this.client ? await this.client.info('stats') : '';\n    return {\n      ...this.metrics.getSnapshot(),\n      redisInfo: this.parseRedisInfo(info),\n      initialized: this.initialized,\n    };\n  }\n\n  async warmup(keys: Array<{ key: string; value: any; ttl?: number }>): Promise<number> {\n    if (!this.client || !this.initialized) {\n      return 0;\n    }\n\n    let warmed = 0;\n    for (const { key, value, ttl } of keys) {\n      const success = await this.set(key, value, { ttl });\n      if (success) warmed++;\n    }\n\n    console.log(` Cache warmed with ${warmed}/${keys.length} entries`);\n    return warmed;\n  }\n\n  // ============================================================================\n  // Private Helper Methods\n  // ============================================================================\n\n  private async updateAccessTime(key: string): Promise<void> {\n    if (!this.client) return;\n    try {\n      // Update access time in metadata (stored separately)\n      await this.client.hSet(`access:${key}`, 'lastAccess', Date.now().toString());\n    } catch (error) {\n      // Silently fail to avoid impacting cache performance\n    }\n  }\n\n  private async addToTags(key: string, tags: string[]): Promise<void> {\n    if (!this.client) return;\n    try {\n      for (const tag of tags) {\n        await this.client.sAdd(`tag:${tag}`, key);\n      }\n    } catch (error) {\n      console.error(` Error adding tags for key ${key}:`, error);\n    }\n  }\n\n  private async getKeysByTag(tag: string): Promise<string[]> {\n    if (!this.client) return [];\n    try {\n      const members = await this.client.sMembers(`tag:${tag}`);\n      return members as string[];\n    } catch (error) {\n      console.error(` Error getting keys by tag ${tag}:`, error);\n      return [];\n    }\n  }\n\n  private parseRedisInfo(info: string): Record<string, any> {\n    const parsed: Record<string, any> = {};\n    const lines = info.split('\\r\\n');\n\n    for (const line of lines) {\n      if (line.includes(':')) {\n        const [key, value] = line.split(':');\n        parsed[key] = value;\n      }\n    }\n\n    return parsed;\n  }\n\n  // ============================================================================\n  // Shutdown\n  // ============================================================================\n\n  async shutdown(): Promise<void> {\n    if (this.client) {\n      await this.client.quit();\n      this.initialized = false;\n      console.log(' Redis cache disconnected');\n    }\n  }\n}\n\n// ============================================================================\n// Cache Metrics\n// ============================================================================\n\nexport class CacheMetrics {\n  private hits: number = 0;\n  private misses: number = 0;\n  private sets: number = 0;\n  private deletes: number = 0;\n  private errors: number = 0;\n  private invalidations: number = 0;\n\n  incrementHit(): void {\n    this.hits++;\n  }\n\n  incrementMiss(reason: string = 'unknown'): void {\n    this.misses++;\n  }\n\n  incrementSet(): void {\n    this.sets++;\n  }\n\n  incrementDelete(): void {\n    this.deletes++;\n  }\n\n  incrementError(): void {\n    this.errors++;\n  }\n\n  incrementInvalidation(count: number = 1): void {\n    this.invalidations += count;\n  }\n\n  reset(): void {\n    this.hits = 0;\n    this.misses = 0;\n    this.sets = 0;\n    this.deletes = 0;\n    this.errors = 0;\n    this.invalidations = 0;\n  }\n\n  getSnapshot(): CacheMetricsSnapshot {\n    const total = this.hits + this.misses;\n    const hitRate = total > 0 ? (this.hits / total) * 100 : 0;\n\n    return {\n      hits: this.hits,\n      misses: this.misses,\n      sets: this.sets,\n      deletes: this.deletes,\n      errors: this.errors,\n      invalidations: this.invalidations,\n      hitRate: hitRate.toFixed(2) + '%',\n      totalOperations: total,\n    };\n  }\n}\n\nexport interface CacheMetricsSnapshot {\n  hits: number;\n  misses: number;\n  sets: number;\n  deletes: number;\n  errors: number;\n  invalidations: number;\n  hitRate: string;\n  totalOperations: number;\n  redisInfo?: Record<string, any>;\n  initialized?: boolean;\n}\n\n// ============================================================================\n// Cache Decorators\n// ============================================================================\n\nexport function cacheResponse<T>(\n  keyGenerator: (...args: any[]) => string,\n  options: {\n    ttl?: number;\n    tags?: string[];\n    strategy?: CacheStrategy;\n  } = {}\n) {\n  return function (\n    target: any,\n    propertyKey: string,\n    descriptor: PropertyDescriptor\n  ) {\n    const originalMethod = descriptor.value;\n\n    descriptor.value = async function (...args: any[]): Promise<T> {\n      const cacheManager = (this as any).cacheManager as CacheManager;\n      if (!cacheManager) {\n        return originalMethod.apply(this, args);\n      }\n\n      const key = keyGenerator(...args);\n\n      // Try to get from cache\n      const cached = await cacheManager.get<T>(key);\n      if (cached !== null) {\n        return cached;\n      }\n\n      // Execute original method\n      const result = await originalMethod.apply(this, args);\n\n      // Cache the result\n      await cacheManager.set(key, result, options);\n\n      return result;\n    };\n\n    return descriptor;\n  };\n}\n\n// ============================================================================\n// Export singleton instance\n// ============================================================================\n\nexport const cacheManager = new CacheManager();","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/cache/cache-config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/cache/extraction-cache.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[996,999],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[996,999],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1566,1569],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1566,1569],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2242,2245],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2242,2245],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2261,2264],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2261,2264],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":119,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3458,3461],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3458,3461],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":120,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3480,3483],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3480,3483],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":145,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4117,4120],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4117,4120],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":179,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":179,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5011,5014],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5011,5014],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":204,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5660,5663],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5660,5663],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":238,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":238,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6642,6645],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6642,6645],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":284,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":284,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7986,7989],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7986,7989],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Extraction Result Caching Layer\n * Caches metadata extraction results to reduce redundant processing\n */\n\nimport { Redis } from 'ioredis';\nimport crypto from 'crypto';\nimport { CacheConfig, DEFAULT_CACHE_CONFIG } from './cache-config';\n\nexport interface ExtractionCacheConfig extends CacheConfig {\n  /** TTL for extraction results in seconds */\n  extractionTTL: number;\n  /** TTL for field-specific results in seconds */\n  fieldTTL: number;\n  /** TTL for tier-filtered results in seconds */\n  tierTTL: number;\n  /** Maximum size of cached extraction results in MB */\n  maxResultSize: number;\n}\n\nexport const DEFAULT_EXTRACTION_CACHE_CONFIG: ExtractionCacheConfig = {\n  ...DEFAULT_CACHE_CONFIG,\n  extractionTTL: 3600, // 1 hour for extraction results\n  fieldTTL: 1800,      // 30 minutes for field-specific results\n  tierTTL: 7200,       // 2 hours for tier-filtered results\n  maxResultSize: 10,   // 10MB max result size\n};\n\nexport interface ExtractionCacheEntry {\n  key: string;\n  value: any;\n  timestamp: number;\n  ttl: number;\n  metadata: {\n    fileType: string;\n    tier: string;\n    fieldsExtracted: number;\n    processingTime: number;\n    size: number;\n  };\n}\n\nexport class ExtractionCache {\n  private redis: Redis;\n  private config: ExtractionCacheConfig;\n\n  constructor(redis: Redis, config?: Partial<ExtractionCacheConfig>) {\n    this.redis = redis;\n    this.config = { ...DEFAULT_EXTRACTION_CACHE_CONFIG, ...config };\n  }\n\n  /**\n   * Generate a cache key for extraction results\n   */\n  generateExtractionKey(filePath: string, tier: string, options: any = {}): string {\n    const fileHash = crypto.createHash('sha256').update(filePath).digest('hex');\n    const optionsHash = crypto.createHash('sha256').update(JSON.stringify(options)).digest('hex');\n    \n    return `extraction:${fileHash}:${tier}:${optionsHash}`;\n  }\n\n  /**\n   * Generate a cache key for field-specific results\n   */\n  generateFieldKey(filePath: string, tier: string, field: string): string {\n    const fileHash = crypto.createHash('sha256').update(filePath).digest('hex');\n    \n    return `field:${fileHash}:${tier}:${field}`;\n  }\n\n  /**\n   * Cache extraction results\n   */\n  async setExtractionResult(\n    filePath: string, \n    tier: string, \n    result: any, \n    options: any = {}\n  ): Promise<boolean> {\n    try {\n      const key = this.generateExtractionKey(filePath, tier, options);\n      const size = JSON.stringify(result).length;\n      \n      // Don't cache if result is too large\n      if (size > this.config.maxResultSize * 1024 * 1024) {\n        console.log(`Extraction result too large to cache: ${size} bytes`);\n        return false;\n      }\n\n      const entry: ExtractionCacheEntry = {\n        key,\n        value: result,\n        timestamp: Date.now(),\n        ttl: this.config.extractionTTL,\n        metadata: {\n          fileType: options.fileType || 'unknown',\n          tier,\n          fieldsExtracted: result.fieldsExtracted || 0,\n          processingTime: result.processingTime || 0,\n          size,\n        }\n      };\n\n      await this.redis.setex(key, this.config.extractionTTL, JSON.stringify(entry));\n      console.log(`Cached extraction result for ${filePath} (tier: ${tier})`);\n      return true;\n    } catch (error) {\n      console.error('Error caching extraction result:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Get cached extraction results\n   */\n  async getExtractionResult(\n    filePath: string, \n    tier: string, \n    options: any = {}\n  ): Promise<any | null> {\n    try {\n      const key = this.generateExtractionKey(filePath, tier, options);\n      const cached = await this.redis.get(key);\n      \n      if (!cached) {\n        return null;\n      }\n\n      const entry: ExtractionCacheEntry = JSON.parse(cached);\n      console.log(`Cache hit for extraction result: ${filePath} (tier: ${tier})`);\n      return entry.value;\n    } catch (error) {\n      console.error('Error getting cached extraction result:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Cache a specific field result\n   */\n  async setFieldResult(\n    filePath: string,\n    tier: string,\n    field: string,\n    result: any\n  ): Promise<boolean> {\n    try {\n      const key = this.generateFieldKey(filePath, tier, field);\n      const entry: ExtractionCacheEntry = {\n        key,\n        value: result,\n        timestamp: Date.now(),\n        ttl: this.config.fieldTTL,\n        metadata: {\n          fileType: 'unknown', // Would need to be passed in\n          tier,\n          fieldsExtracted: 1,\n          processingTime: 0,\n          size: JSON.stringify(result).length,\n        }\n      };\n\n      await this.redis.setex(key, this.config.fieldTTL, JSON.stringify(entry));\n      console.log(`Cached field result for ${filePath} (field: ${field})`);\n      return true;\n    } catch (error) {\n      console.error('Error caching field result:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Get cached field result\n   */\n  async getFieldResult(\n    filePath: string,\n    tier: string,\n    field: string\n  ): Promise<any | null> {\n    try {\n      const key = this.generateFieldKey(filePath, tier, field);\n      const cached = await this.redis.get(key);\n      \n      if (!cached) {\n        return null;\n      }\n\n      const entry: ExtractionCacheEntry = JSON.parse(cached);\n      console.log(`Cache hit for field result: ${filePath} (field: ${field})`);\n      return entry.value;\n    } catch (error) {\n      console.error('Error getting cached field result:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Cache tier-specific filtered results\n   */\n  async setTierFilteredResult(\n    filePath: string,\n    originalTier: string,\n    targetTier: string,\n    result: any\n  ): Promise<boolean> {\n    try {\n      const key = `tier-filter:${filePath}:${originalTier}:${targetTier}`;\n      const entry: ExtractionCacheEntry = {\n        key,\n        value: result,\n        timestamp: Date.now(),\n        ttl: this.config.tierTTL,\n        metadata: {\n          fileType: 'unknown',\n          tier: targetTier,\n          fieldsExtracted: result.fieldsExtracted || 0,\n          processingTime: 0,\n          size: JSON.stringify(result).length,\n        }\n      };\n\n      await this.redis.setex(key, this.config.tierTTL, JSON.stringify(entry));\n      console.log(`Cached tier-filtered result for ${filePath} (${originalTier} -> ${targetTier})`);\n      return true;\n    } catch (error) {\n      console.error('Error caching tier-filtered result:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Get cached tier-specific filtered results\n   */\n  async getTierFilteredResult(\n    filePath: string,\n    originalTier: string,\n    targetTier: string\n  ): Promise<any | null> {\n    try {\n      const key = `tier-filter:${filePath}:${originalTier}:${targetTier}`;\n      const cached = await this.redis.get(key);\n      \n      if (!cached) {\n        return null;\n      }\n\n      const entry: ExtractionCacheEntry = JSON.parse(cached);\n      console.log(`Cache hit for tier-filtered result: ${filePath} (${originalTier} -> ${targetTier})`);\n      return entry.value;\n    } catch (error) {\n      console.error('Error getting cached tier-filtered result:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Invalidate extraction cache for a specific file\n   */\n  async invalidateExtractionCache(filePath: string): Promise<number> {\n    try {\n      const fileHash = crypto.createHash('sha256').update(filePath).digest('hex');\n      const pattern = `extraction:${fileHash}:*`;\n      \n      // Get all keys matching the pattern\n      const keys = await this.redis.keys(pattern);\n      \n      if (keys.length === 0) {\n        return 0;\n      }\n\n      // Delete all matching keys\n      const result = await this.redis.del(...keys);\n      console.log(`Invalidated ${result} extraction cache entries for ${filePath}`);\n      return result;\n    } catch (error) {\n      console.error('Error invalidating extraction cache:', error);\n      return 0;\n    }\n  }\n\n  /**\n   * Get cache statistics\n   */\n  async getStats(): Promise<any> {\n    try {\n      const info = await this.redis.info('keyspace');\n      return {\n        extractionCacheEnabled: this.config.enabled,\n        extractionTTL: this.config.extractionTTL,\n        fieldTTL: this.config.fieldTTL,\n        tierTTL: this.config.tierTTL,\n        maxResultSize: this.config.maxResultSize,\n        redisInfo: info,\n      };\n    } catch (error) {\n      console.error('Error getting cache stats:', error);\n      return null;\n    }\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/cache/geocoding-cache.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1113,1116],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1113,1116],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1233,1236],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1233,1236],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2016,2019],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2016,2019],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2497,2500],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2497,2500],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":104,"column":91,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":94,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3008,3011],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3008,3011],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":122,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3493,3496],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3493,3496],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":154,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4410,4413],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4410,4413],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":179,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":179,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5150,5153],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5150,5153],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":212,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":212,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6123,6126],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6123,6126],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":236,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":236,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6864,6867],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6864,6867],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":237,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":237,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6884,6887],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6884,6887],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":274,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":274,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7997,8000],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7997,8000],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":275,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":275,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8019,8022],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8019,8022],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":286,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":286,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8383,8386],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8383,8386],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":348,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":348,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10132,10135],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10132,10135],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":15,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Geocoding Result Caching Layer\n * Caches reverse geocoding results to reduce API calls and improve performance\n */\n\nimport { Redis } from 'ioredis';\nimport crypto from 'crypto';\nimport { CacheConfig, DEFAULT_CACHE_CONFIG } from './cache-config';\n\nexport interface GeocodingCacheConfig extends CacheConfig {\n  /** TTL for reverse geocoding results in seconds */\n  reverseGeocodeTTL: number;\n  /** TTL for forward geocoding results in seconds */\n  forwardGeocodeTTL: number;\n  /** TTL for batch geocoding results in seconds */\n  batchGeocodeTTL: number;\n  /** Maximum number of locations to cache in batch results */\n  maxBatchSize: number;\n}\n\nexport const DEFAULT_GEOCODING_CACHE_CONFIG: GeocodingCacheConfig = {\n  ...DEFAULT_CACHE_CONFIG,\n  reverseGeocodeTTL: 86400,    // 24 hours for reverse geocoding (addresses don't change often)\n  forwardGeocodeTTL: 604800,   // 7 days for forward geocoding (more stable)\n  batchGeocodeTTL: 43200,      // 12 hours for batch results\n  maxBatchSize: 100,           // Maximum 100 locations per batch\n};\n\nexport interface GeocodingCacheEntry {\n  key: string;\n  value: any;\n  timestamp: number;\n  ttl: number;\n  metadata: {\n    queryType: 'reverse' | 'forward' | 'batch';\n    queryParams: any;\n    resultCount: number;\n    cacheHit: boolean;\n  };\n}\n\nexport interface ReverseGeocodeResult {\n  address: string;\n  city: string;\n  region: string;\n  country: string;\n  postalCode?: string;\n  confidence: number;\n  accuracy?: string;\n  placeId?: string;\n}\n\nexport interface ForwardGeocodeResult {\n  latitude: number;\n  longitude: number;\n  accuracy?: string;\n  placeId?: string;\n}\n\nexport class GeocodingCache {\n  private redis: Redis;\n  private config: GeocodingCacheConfig;\n\n  constructor(redis: Redis, config?: Partial<GeocodingCacheConfig>) {\n    this.redis = redis;\n    this.config = { ...DEFAULT_GEOCODING_CACHE_CONFIG, ...config };\n  }\n\n  /**\n   * Generate a cache key for reverse geocoding\n   */\n  generateReverseGeocodeKey(latitude: number, longitude: number, options: any = {}): string {\n    const locationHash = crypto\n      .createHash('sha256')\n      .update(`${latitude},${longitude}`)\n      .digest('hex');\n    \n    const optionsHash = options.includeDetails \n      ? crypto.createHash('sha256').update(JSON.stringify(options)).digest('hex')\n      : 'basic';\n    \n    return `reverse-geocode:${locationHash}:${optionsHash}`;\n  }\n\n  /**\n   * Generate a cache key for forward geocoding\n   */\n  generateForwardGeocodeKey(address: string, options: any = {}): string {\n    const addressHash = crypto\n      .createHash('sha256')\n      .update(address.toLowerCase().trim())\n      .digest('hex');\n    \n    const optionsHash = options.exactMatch \n      ? crypto.createHash('sha256').update(JSON.stringify(options)).digest('hex')\n      : 'fuzzy';\n    \n    return `forward-geocode:${addressHash}:${optionsHash}`;\n  }\n\n  /**\n   * Generate a cache key for batch geocoding\n   */\n  generateBatchGeocodeKey(queries: Array<string | { lat: number; lng: number }>, options: any = {}): string {\n    const queriesHash = crypto\n      .createHash('sha256')\n      .update(JSON.stringify(queries))\n      .digest('hex');\n    \n    const optionsHash = crypto.createHash('sha256').update(JSON.stringify(options)).digest('hex');\n    \n    return `batch-geocode:${queriesHash}:${optionsHash}`;\n  }\n\n  /**\n   * Cache reverse geocoding result\n   */\n  async setReverseGeocodeResult(\n    latitude: number,\n    longitude: number,\n    result: ReverseGeocodeResult,\n    options: any = {}\n  ): Promise<boolean> {\n    try {\n      const key = this.generateReverseGeocodeKey(latitude, longitude, options);\n      const entry: GeocodingCacheEntry = {\n        key,\n        value: result,\n        timestamp: Date.now(),\n        ttl: this.config.reverseGeocodeTTL,\n        metadata: {\n          queryType: 'reverse',\n          queryParams: { latitude, longitude, ...options },\n          resultCount: 1,\n          cacheHit: false,\n        }\n      };\n\n      await this.redis.setex(key, this.config.reverseGeocodeTTL, JSON.stringify(entry));\n      console.log(`Cached reverse geocode result for ${latitude},${longitude}`);\n      return true;\n    } catch (error) {\n      console.error('Error caching reverse geocode result:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Get cached reverse geocoding result\n   */\n  async getReverseGeocodeResult(\n    latitude: number,\n    longitude: number,\n    options: any = {}\n  ): Promise<ReverseGeocodeResult | null> {\n    try {\n      const key = this.generateReverseGeocodeKey(latitude, longitude, options);\n      const cached = await this.redis.get(key);\n      \n      if (!cached) {\n        return null;\n      }\n\n      const entry: GeocodingCacheEntry = JSON.parse(cached);\n      console.log(`Cache hit for reverse geocode: ${latitude},${longitude}`);\n      return entry.value as ReverseGeocodeResult;\n    } catch (error) {\n      console.error('Error getting cached reverse geocode result:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Cache forward geocoding result\n   */\n  async setForwardGeocodeResult(\n    address: string,\n    result: ForwardGeocodeResult | ForwardGeocodeResult[],\n    options: any = {}\n  ): Promise<boolean> {\n    try {\n      const key = this.generateForwardGeocodeKey(address, options);\n      const results = Array.isArray(result) ? result : [result];\n      \n      const entry: GeocodingCacheEntry = {\n        key,\n        value: results,\n        timestamp: Date.now(),\n        ttl: this.config.forwardGeocodeTTL,\n        metadata: {\n          queryType: 'forward',\n          queryParams: { address, ...options },\n          resultCount: results.length,\n          cacheHit: false,\n        }\n      };\n\n      await this.redis.setex(key, this.config.forwardGeocodeTTL, JSON.stringify(entry));\n      console.log(`Cached forward geocode result for \"${address}\" (${results.length} result(s))`);\n      return true;\n    } catch (error) {\n      console.error('Error caching forward geocode result:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Get cached forward geocoding result\n   */\n  async getForwardGeocodeResult(\n    address: string,\n    options: any = {}\n  ): Promise<ForwardGeocodeResult | ForwardGeocodeResult[] | null> {\n    try {\n      const key = this.generateForwardGeocodeKey(address, options);\n      const cached = await this.redis.get(key);\n      \n      if (!cached) {\n        return null;\n      }\n\n      const entry: GeocodingCacheEntry = JSON.parse(cached);\n      console.log(`Cache hit for forward geocode: \"${address}\"`);\n      return entry.value as ForwardGeocodeResult | ForwardGeocodeResult[];\n    } catch (error) {\n      console.error('Error getting cached forward geocode result:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Cache batch geocoding result\n   */\n  async setBatchGeocodeResult(\n    queries: Array<string | { lat: number; lng: number }>,\n    results: any[],\n    options: any = {}\n  ): Promise<boolean> {\n    try {\n      // Check if batch is too large\n      if (queries.length > this.config.maxBatchSize) {\n        console.log(`Batch geocode too large to cache: ${queries.length} queries`);\n        return false;\n      }\n\n      const key = this.generateBatchGeocodeKey(queries, options);\n      const entry: GeocodingCacheEntry = {\n        key,\n        value: results,\n        timestamp: Date.now(),\n        ttl: this.config.batchGeocodeTTL,\n        metadata: {\n          queryType: 'batch',\n          queryParams: { queries, ...options },\n          resultCount: results.length,\n          cacheHit: false,\n        }\n      };\n\n      await this.redis.setex(key, this.config.batchGeocodeTTL, JSON.stringify(entry));\n      console.log(`Cached batch geocode result for ${queries.length} queries`);\n      return true;\n    } catch (error) {\n      console.error('Error caching batch geocode result:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Get cached batch geocoding result\n   */\n  async getBatchGeocodeResult(\n    queries: Array<string | { lat: number; lng: number }>,\n    options: any = {}\n  ): Promise<any[] | null> {\n    try {\n      const key = this.generateBatchGeocodeKey(queries, options);\n      const cached = await this.redis.get(key);\n      \n      if (!cached) {\n        return null;\n      }\n\n      const entry: GeocodingCacheEntry = JSON.parse(cached);\n      console.log(`Cache hit for batch geocode: ${queries.length} queries`);\n      return entry.value as any[];\n    } catch (error) {\n      console.error('Error getting cached batch geocode result:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Invalidate reverse geocoding cache for specific coordinates\n   */\n  async invalidateReverseGeocodeCache(latitude: number, longitude: number): Promise<number> {\n    try {\n      const locationHash = crypto\n        .createHash('sha256')\n        .update(`${latitude},${longitude}`)\n        .digest('hex');\n      \n      const pattern = `reverse-geocode:${locationHash}:*`;\n      const keys = await this.redis.keys(pattern);\n      \n      if (keys.length === 0) {\n        return 0;\n      }\n\n      const result = await this.redis.del(...keys);\n      console.log(`Invalidated ${result} reverse geocode cache entries for ${latitude},${longitude}`);\n      return result;\n    } catch (error) {\n      console.error('Error invalidating reverse geocode cache:', error);\n      return 0;\n    }\n  }\n\n  /**\n   * Invalidate forward geocoding cache for specific address\n   */\n  async invalidateForwardGeocodeCache(address: string): Promise<number> {\n    try {\n      const addressHash = crypto\n        .createHash('sha256')\n        .update(address.toLowerCase().trim())\n        .digest('hex');\n      \n      const pattern = `forward-geocode:${addressHash}:*`;\n      const keys = await this.redis.keys(pattern);\n      \n      if (keys.length === 0) {\n        return 0;\n      }\n\n      const result = await this.redis.del(...keys);\n      console.log(`Invalidated ${result} forward geocode cache entries for \"${address}\"`);\n      return result;\n    } catch (error) {\n      console.error('Error invalidating forward geocode cache:', error);\n      return 0;\n    }\n  }\n\n  /**\n   * Get cache statistics\n   */\n  async getStats(): Promise<any> {\n    try {\n      const info = await this.redis.info('keyspace');\n      return {\n        reverseGeocodeTTL: this.config.reverseGeocodeTTL,\n        forwardGeocodeTTL: this.config.forwardGeocodeTTL,\n        batchGeocodeTTL: this.config.batchGeocodeTTL,\n        maxBatchSize: this.config.maxBatchSize,\n        redisInfo: info,\n      };\n    } catch (error) {\n      console.error('Error getting geocoding cache stats:', error);\n      return null;\n    }\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/cache/metadata-cache.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'createClient' is defined but never used.","line":15,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RedisClientType' is defined but never used.","line":15,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fs' is defined but never used.","line":17,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DEFAULT_CACHE_CONFIG' is defined but never used.","line":19,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":59},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'key' is defined but never used. Allowed unused args must match /^_/u.","line":374,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":374,"endColumn":37},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":383,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":383,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12557,12560],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12557,12560],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Optimized Metadata Caching Layer for MetaExtract API\n *\n * Provides intelligent caching for metadata extraction results to improve performance\n * and reduce redundant processing. Includes cache invalidation, memory management,\n * and configurable TTL strategies based on file type and tier.\n *\n * Key features:\n * - Tier-based cache TTL strategies\n * - Automatic compression for large metadata\n * - File extension and tier-based invalidation\n * - Memory-efficient storage with size limits\n */\n\nimport { createClient, RedisClientType } from 'redis';\nimport crypto from 'crypto';\nimport fs from 'fs/promises';\nimport path from 'path';\nimport { cacheManager, CacheStrategy, DEFAULT_CACHE_CONFIG } from '../cache';\nimport type { PythonMetadataResponse } from '../utils/extraction-helpers';\n\n// ============================================================================\n// Metadata Cache Configuration\n// ============================================================================\n\n/**\n * Configuration options for the metadata cache system\n */\nexport interface MetadataCacheConfig {\n  /** Whether caching is enabled */\n  enabled: boolean;\n  /** Redis connection URL */\n  url: string;\n  /** Default time-to-live in seconds */\n  defaultTTL: number; // Time to live in seconds\n  /** Maximum cache size in MB */\n  maxSize: number; // Maximum cache size in MB\n  /** Maximum number of cache entries */\n  maxEntries: number; // Maximum number of entries\n  /** Redis eviction policy */\n  evictionPolicy: string; // Redis eviction policy\n  /** Whether to compress large metadata */\n  compression: boolean; // Whether to compress large metadata\n  /** Size in bytes above which to compress */\n  compressionThreshold: number; // Size in bytes above which to compress\n}\n\n/**\n * Default configuration for metadata caching\n * - 1 hour default TTL for metadata\n * - 512MB max cache size\n * - 10,000 max entries\n * - LRU eviction policy\n * - Compression enabled for metadata > 10KB\n */\nexport const DEFAULT_METADATA_CACHE_CONFIG: MetadataCacheConfig = {\n  enabled: process.env.METADATA_CACHE_ENABLED !== 'false',\n  url: process.env.REDIS_URL || 'redis://localhost:6379',\n  defaultTTL: 3600, // 1 hour default for metadata\n  maxSize: 512, // 512MB max cache size\n  maxEntries: 10000, // Maximum 10,000 entries\n  evictionPolicy: 'allkeys-lru',\n  compression: true, // Enable compression for large metadata\n  compressionThreshold: 1024 * 10, // 10KB threshold for compression\n};\n\n// ============================================================================\n// Cache Entry Structure\n// ============================================================================\n\n/**\n * Structure for a metadata cache entry\n * Contains the cached metadata response along with metadata about the cache entry\n */\nexport interface MetadataCacheEntry {\n  /** The cache key */\n  key: string;\n  /** The cached metadata response */\n  value: PythonMetadataResponse;\n  /** Time-to-live in seconds */\n  ttl: number;\n  /** Creation timestamp */\n  createdAt: number;\n  /** Last access timestamp */\n  accessedAt: number;\n  /** Number of times accessed */\n  hitCount: number;\n  /** Additional metadata about the cached entry */\n  metadata: {\n    /** Cache tags for invalidation */\n    tags?: string[];\n    /** Schema version */\n    version?: string;\n    /** Tier associated with this cache entry */\n    tier?: string;\n    /** File size of the original file */\n    fileSize?: number;\n    /** MIME type of the original file */\n    mimeType?: string;\n    /** Whether the metadata was compressed */\n    compressed?: boolean;\n  };\n}\n\n// ============================================================================\n// Metadata Cache Manager Class\n// ============================================================================\n\n/**\n * Manages caching for metadata extraction results\n * Provides methods to get, set, and invalidate cached metadata with tier-based strategies\n */\nexport class MetadataCacheManager {\n  private config: MetadataCacheConfig;\n  private initialized: boolean = false;\n  private compressionEnabled: boolean;\n\n  /**\n   * Creates a new metadata cache manager instance\n   * @param config Optional configuration to override defaults\n   */\n  constructor(config: Partial<MetadataCacheConfig> = {}) {\n    this.config = { ...DEFAULT_METADATA_CACHE_CONFIG, ...config };\n    this.compressionEnabled = this.config.compression ?? true;\n  }\n\n  /**\n   * Initializes the metadata cache manager\n   * Sets up Redis connection and validates configuration\n   */\n  async initialize(): Promise<void> {\n    if (!this.config.enabled) {\n      console.log(' Metadata caching disabled');\n      return;\n    }\n\n    // Initialize the main cache manager if not already done\n    if (!cacheManager['initialized']) {\n      await cacheManager.initialize();\n    }\n\n    this.initialized = true;\n    console.log(' Metadata cache layer initialized');\n  }\n\n  /**\n   * Generate a cache key based on file properties\n   * Creates a unique key combining file hash and extraction parameters\n   * @param filePath Path to the file being cached\n   * @param tier The tier for which metadata was extracted\n   * @param options Additional options that affect the extraction\n   * @returns A unique cache key for the metadata\n   */\n  generateCacheKey(filePath: string, tier: string, options: {\n    includePerformance?: boolean;\n    enableAdvancedAnalysis?: boolean\n  } = {}): string {\n    // Create a hash of the file path and other parameters\n    const fileHash = crypto.createHash('sha256').update(filePath).digest('hex');\n    const params = [\n      tier,\n      options.includePerformance ? 'perf' : 'basic',\n      options.enableAdvancedAnalysis ? 'adv' : 'std'\n    ].join(':');\n\n    return `metadata:${fileHash}:${params}`;\n  }\n\n  /**\n   * Retrieve cached metadata for a file\n   * @param filePath Path to the file to retrieve metadata for\n   * @param tier The tier for which metadata was extracted\n   * @param options Additional options that affect the extraction\n   * @returns Cached metadata response or null if not found\n   */\n  async get(filePath: string, tier: string, options: {\n    includePerformance?: boolean;\n    enableAdvancedAnalysis?: boolean\n  } = {}): Promise<PythonMetadataResponse | null> {\n    if (!this.initialized || !this.config.enabled) {\n      return null;\n    }\n\n    try {\n      const key = this.generateCacheKey(filePath, tier, options);\n      const cached = await cacheManager.get<MetadataCacheEntry>(key);\n\n      if (cached) {\n        // Update access time and hit count\n        await this.updateAccessTime(key);\n\n        console.log(` Metadata cache HIT for ${path.basename(filePath)}`);\n        return cached.value;\n      }\n\n      console.log(` Metadata cache MISS for ${path.basename(filePath)}`);\n      return null;\n    } catch (error) {\n      console.error(` Metadata cache get error:`, error);\n      return null;\n    }\n  }\n\n  /**\n   * Store metadata in cache\n   * @param filePath Path to the file being cached\n   * @param tier The tier for which metadata was extracted\n   * @param metadata The metadata response to cache\n   * @param options Additional options that affect the caching\n   * @returns True if caching was successful, false otherwise\n   */\n  async set(\n    filePath: string,\n    tier: string,\n    metadata: PythonMetadataResponse,\n    options: {\n      includePerformance?: boolean;\n      enableAdvancedAnalysis?: boolean;\n      customTTL?: number;\n    } = {}\n  ): Promise<boolean> {\n    if (!this.initialized || !this.config.enabled) {\n      return false;\n    }\n\n    try {\n      const key = this.generateCacheKey(filePath, tier, options);\n      const ttl = options.customTTL || this.config.defaultTTL;\n\n      // Determine if we should compress based on size\n      const metadataSize = JSON.stringify(metadata).length;\n      const shouldCompress = this.compressionEnabled &&\n                            metadataSize > this.config.compressionThreshold;\n      const fileSize =\n        typeof metadata.filesystem?.file_size === 'number'\n          ? metadata.filesystem.file_size\n          : undefined;\n\n      const entry: MetadataCacheEntry = {\n        key,\n        value: metadata,\n        ttl,\n        createdAt: Date.now(),\n        accessedAt: Date.now(),\n        hitCount: 0,\n        metadata: {\n          tier,\n          fileSize,\n          mimeType: metadata.file?.mime_type,\n          compressed: shouldCompress,\n        },\n      };\n\n      // Add tags for easier invalidation\n      const tags = [`tier:${tier}`, `file:${path.extname(filePath)}`];\n      entry.metadata.tags = tags;\n\n      // Store in cache with appropriate options\n      const success = await cacheManager.set(key, entry, {\n        ttl,\n        tags,\n        strategy: this.getCacheStrategyForTier(tier),\n        metadata: entry.metadata\n      });\n\n      if (success) {\n        console.log(` Metadata cached for ${path.basename(filePath)} (${metadata.extraction_info?.fields_extracted || 0} fields)`);\n      }\n\n      return success;\n    } catch (error) {\n      console.error(` Metadata cache set error:`, error);\n      return false;\n    }\n  }\n\n  /**\n   * Remove cached metadata for a file\n   * @param filePath Path to the file to remove from cache\n   * @param tier The tier for which metadata was extracted\n   * @param options Additional options that affect the extraction\n   * @returns True if deletion was successful, false otherwise\n   */\n  async delete(filePath: string, tier: string, options: {\n    includePerformance?: boolean;\n    enableAdvancedAnalysis?: boolean\n  } = {}): Promise<boolean> {\n    if (!this.initialized || !this.config.enabled) {\n      return false;\n    }\n\n    try {\n      const key = this.generateCacheKey(filePath, tier, options);\n      const success = await cacheManager.delete(key);\n\n      if (success) {\n        console.log(`  Metadata cache deleted for ${path.basename(filePath)}`);\n      }\n\n      return success;\n    } catch (error) {\n      console.error(` Metadata cache delete error:`, error);\n      return false;\n    }\n  }\n\n  /**\n   * Invalidate all cached metadata for a specific tier\n   * @param tier The tier to invalidate cache for\n   * @returns Number of entries invalidated\n   */\n  async invalidateByTier(tier: string): Promise<number> {\n    if (!this.initialized || !this.config.enabled) {\n      return 0;\n    }\n\n    try {\n      const count = await cacheManager.invalidateByTag(`tier:${tier}`);\n      console.log(` Invalidated ${count} metadata cache entries for tier: ${tier}`);\n      return count;\n    } catch (error) {\n      console.error(` Metadata cache invalidation error for tier ${tier}:`, error);\n      return 0;\n    }\n  }\n\n  /**\n   * Invalidate all cached metadata for a specific file extension\n   * @param extension The file extension to invalidate cache for\n   * @returns Number of entries invalidated\n   */\n  async invalidateByFileExtension(extension: string): Promise<number> {\n    if (!this.initialized || !this.config.enabled) {\n      return 0;\n    }\n\n    try {\n      const count = await cacheManager.invalidateByTag(`file:${extension}`);\n      console.log(` Invalidated ${count} metadata cache entries for extension: ${extension}`);\n      return count;\n    } catch (error) {\n      console.error(` Metadata cache invalidation error for extension ${extension}:`, error);\n      return 0;\n    }\n  }\n\n  /**\n   * Determine the appropriate cache strategy based on the tier\n   * Different tiers have different cache TTL requirements\n   * @param tier The tier to get cache strategy for\n   * @returns The appropriate cache strategy\n   */\n  private getCacheStrategyForTier(tier: string): CacheStrategy {\n    switch (tier.toLowerCase()) {\n      case 'free':\n        return CacheStrategy.SHORT_TERM; // 5 minutes for free tier\n      case 'starter':\n        return CacheStrategy.SHORT_TERM; // 5 minutes for starter tier\n      case 'pro':\n        return CacheStrategy.MEDIUM_TERM; // 1 hour for pro tier\n      case 'super':\n      case 'enterprise':\n        return CacheStrategy.LONG_TERM; // 1 day for premium tiers\n      default:\n        return CacheStrategy.MEDIUM_TERM; // Default to 1 hour\n    }\n  }\n\n  /**\n   * Update access time for cache entry\n   * This is handled by the main cache manager\n   * @param key The cache key to update\n   */\n  private async updateAccessTime(key: string): Promise<void> {\n    // This is handled by the main cache manager\n    // We can add additional logic here if needed\n  }\n\n  /**\n   * Get cache metrics and statistics\n   * @returns Object containing cache metrics and configuration\n   */\n  async getMetrics(): Promise<any> {\n    if (!this.initialized) {\n      return { initialized: false };\n    }\n\n    const metrics = await cacheManager.getMetrics();\n    return {\n      ...metrics,\n      config: {\n        enabled: this.config.enabled,\n        maxSize: this.config.maxSize,\n        maxEntries: this.config.maxEntries,\n        compression: this.config.compression,\n        compressionThreshold: this.config.compressionThreshold,\n      },\n      initialized: this.initialized,\n    };\n  }\n\n  /**\n   * Clear all metadata cache entries\n   * @returns True if clear was successful, false otherwise\n   */\n  async clear(): Promise<boolean> {\n    if (!this.initialized || !this.config.enabled) {\n      return false;\n    }\n\n    try {\n      // We'll use a pattern to clear only metadata cache entries\n      const count = await cacheManager.invalidatePattern('metadata:*');\n      console.log(`  Cleared ${count} metadata cache entries`);\n      return true;\n    } catch (error) {\n      console.error(' Metadata cache clear error:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Shutdown the cache manager\n   * Cleans up resources and closes connections\n   */\n  async shutdown(): Promise<void> {\n    // The main cache manager handles shutdown\n    console.log(' Metadata cache manager shutdown');\n  }\n}\n\n// ============================================================================\n// Export singleton instance\n// ============================================================================\n\nexport const metadataCacheManager = new MetadataCacheManager();\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/cacheExamples.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Response' is defined but never used.","line":17,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":444,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":444,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14481,14484],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14481,14484],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":452,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":452,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14770,14773],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14770,14773],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":457,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":457,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14977,14980],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14977,14980],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":464,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":464,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15189,15192],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15189,15192],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'query' is defined but never used. Allowed unused args must match /^_/u.","line":470,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":470,"endColumn":39},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":470,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":470,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15385,15388],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15385,15388],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":470,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":470,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15399,15402],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15399,15402],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'query' is defined but never used. Allowed unused args must match /^_/u.","line":475,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":475,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'filters' is defined but never used. Allowed unused args must match /^_/u.","line":475,"column":45,"nodeType":null,"messageId":"unusedVar","endLine":475,"endColumn":52},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":475,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":475,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15615,15618],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15615,15618],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":475,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":475,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15629,15632],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15629,15632],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userId' is defined but never used. Allowed unused args must match /^_/u.","line":480,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":480,"endColumn":41},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":480,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":480,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15830,15833],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15830,15833],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":485,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":485,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16002,16005],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16002,16005],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'credentials' is defined but never used. Allowed unused args must match /^_/u.","line":494,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":494,"endColumn":44},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":494,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":494,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16225,16228],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16225,16228],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":494,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":494,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16239,16242],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16239,16242],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'paymentData' is defined but never used. Allowed unused args must match /^_/u.","line":499,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":499,"endColumn":42},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":499,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":499,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16411,16414],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16411,16414],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":499,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":499,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16425,16428],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16425,16428],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":504,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":504,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16607,16610],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16607,16610],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":509,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":509,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16791,16794],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16791,16794],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":23,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Cache Integration Examples\n *\n * Shows how to integrate the Redis caching layer into existing MetaExtract routes.\n * Each example demonstrates different caching patterns and strategies.\n *\n * ## Caching Strategy Guide\n *\n * - **Tier Config (24h)**: Rarely changes, high cost to compute\n * - **Metadata (1h)**: User may request same file, moderate cost\n * - **Analytics (10m)**: Users want near-real-time, high cost to compute\n * - **Search (30m)**: Popular queries benefit from caching, high cost\n * - **User Prefs (2h)**: Relatively static, frequent access pattern\n * - **Health (1m)**: Lightweight but called frequently\n */\n\nimport { Router, Request, Response } from 'express';\nimport {\n  cacheMiddleware,\n  cacheMetadata,\n  cacheTierConfig,\n  invalidateMetadataCache,\n  invalidateTierCache,\n  cacheKeys,\n  preventCaching,\n  setCacheControl,\n} from './cacheMiddleware';\nimport { cacheManager } from './cache';\nimport type { AuthRequest } from './auth';\n\n// ============================================================================\n// Constants\n// ============================================================================\n\nconst TTL = {\n  TIER_CONFIG: 24 * 60 * 60, // 24 hours - rarely changes\n  METADATA: 60 * 60, // 1 hour - good balance of freshness and reuse\n  ANALYTICS: 10 * 60, // 10 minutes - near real-time with caching benefit\n  SEARCH: 30 * 60, // 30 minutes - popular queries benefit from cache\n  USER_PREFERENCES: 2 * 60 * 60, // 2 hours - relatively static user data\n  HEALTH_CHECK: 60, // 1 minute - lightweight, frequent checks\n};\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\n/**\n * Safely extract user ID from request with proper typing\n * @throws Error if user is not authenticated\n */\nfunction extractUserId(req: Request): string {\n  const user = (req as AuthRequest).user;\n  if (!user?.id) {\n    throw new Error('User not authenticated');\n  }\n  return user.id;\n}\n\n/**\n * Safely extract user tier from request with fallback\n */\nfunction getUserTier(req: Request): string {\n  return (req as AuthRequest).user?.tier || 'anonymous';\n}\n\n/**\n * Parse URL and extract query parameters safely\n */\nfunction parseQueryUrl(req: Request): URL {\n  return new URL(req.url, `http://${req.headers.host}`);\n}\n\n/**\n * Check if request explicitly bypasses cache via headers\n */\nfunction shouldBypassCache(req: Request): boolean {\n  return req.headers['cache-control'] === 'no-cache';\n}\n\n/**\n * Check if URL has real-time or live parameters\n */\nfunction isRealTimeRequest(url: URL): boolean {\n  return url.searchParams.has('realtime') || url.searchParams.has('live');\n}\n\n// ============================================================================\n// Example 1: Basic Route Caching\n// ============================================================================\n\nexport function setupCachedRoutes(router: Router): void {\n  // GET /api/tiers - Cache tier configurations for 1 day\n  router.get('/tiers', cacheTierConfig(), async (req, res) => {\n    // Expensive database operation\n    const tiers = await fetchAllTiersFromDatabase();\n\n    res.json(tiers);\n  });\n\n  // POST /api/tiers - Invalidate cache when tiers change\n  router.post('/tiers', invalidateTierCache(), async (req, res) => {\n    // Update tier configuration\n    await updateTierConfiguration(req.body);\n\n    res.json({\n      success: true,\n      message: 'Tier configuration updated',\n    });\n  });\n}\n\n// ============================================================================\n// Example 2: Metadata Caching with Custom Keys\n// ============================================================================\n\n/**\n * Setup metadata caching with tier-aware cache keys\n * Ensures users with different tiers don't share cached metadata\n * (e.g., forensic tier may see more fields than free tier)\n */\nexport function setupMetadataCaching(router: Router): void {\n  // GET /api/metadata/:fileId - Cache specific file metadata\n  router.get(\n    '/metadata/:fileId',\n    cacheMetadata({\n      keyGenerator: (req: Request) => {\n        const fileId = req.params.fileId;\n        const tier = getUserTier(req);\n        return cacheKeys.metadata(fileId, tier);\n      },\n      ttl: TTL.METADATA,\n      tags: ['metadata'],\n    }),\n    async (req, res) => {\n      const fileId = req.params.fileId;\n      // Expensive metadata extraction or database query\n      const metadata = await fetchMetadataForFile(fileId);\n      res.json(metadata);\n    }\n  );\n\n  // POST /api/metadata/:fileId - Invalidate cache on updates\n  router.post(\n    '/metadata/:fileId',\n    invalidateMetadataCache(),\n    async (req, res) => {\n      const fileId = req.params.fileId;\n      // Update metadata\n      await updateFileMetadata(fileId, req.body);\n      res.json({\n        success: true,\n        message: 'Metadata updated',\n      });\n    }\n  );\n}\n\n// ============================================================================\n// Example 3: Conditional Caching\n// ============================================================================\n\n/**\n * Setup conditional caching for analytics\n * Bypasses cache for real-time/live requests to show fresh data\n * Regular requests use 10-minute cache for cost savings\n */\nexport function setupConditionalCaching(router: Router): void {\n  router.get(\n    '/analytics',\n    cacheMiddleware({\n      keyGenerator: (req: Request) => {\n        const url = parseQueryUrl(req);\n        const period = url.searchParams.get('period') || '24h';\n        return cacheKeys.analytics('overview', period);\n      },\n      ttl: TTL.ANALYTICS,\n      skipCache: (req: Request) => {\n        // Don't cache if requesting real-time data\n        const url = parseQueryUrl(req);\n        return isRealTimeRequest(url);\n      },\n      tags: ['analytics'],\n    }),\n    async (req, res) => {\n      const analytics = await generateAnalytics(req.query);\n      res.json(analytics);\n    }\n  );\n}\n\n// ============================================================================\n// Example 4: Search Results Caching\n// ============================================================================\n\n/**\n * Setup search result caching with query-based keys\n * Popular searches are cached for 30 minutes\n * Users can bypass cache with cache-control: no-cache header for fresh results\n */\nexport function setupSearchCaching(router: Router): void {\n  router.get(\n    '/search',\n    cacheMiddleware({\n      keyGenerator: (req: Request) => {\n        const url = parseQueryUrl(req);\n        const query = url.searchParams.get('q') || '';\n        const filters = url.searchParams.toString();\n        return cacheKeys.search(query, filters);\n      },\n      ttl: TTL.SEARCH,\n      tags: ['search'],\n      skipCache: shouldBypassCache,\n    }),\n    async (req, res) => {\n      const query = req.query.q as string;\n      const filters = req.query.filters || {};\n      const results = await performSearch(query, filters);\n      res.json(results);\n    }\n  );\n}\n\n// ============================================================================\n// Example 5: User-Specific Caching\n// ============================================================================\n\n/**\n * Setup user preferences caching\n * Requires authentication. Caches per-user preferences for 2 hours.\n * Users can force refresh with cache-control: no-cache header\n */\nexport function setupUserCaching(router: Router): void {\n  router.get(\n    '/user/preferences',\n    cacheMiddleware({\n      keyGenerator: (req: Request) => {\n        const userId = extractUserId(req);\n        return cacheKeys.userSession(userId);\n      },\n      ttl: TTL.USER_PREFERENCES,\n      tags: ['user'],\n      skipCache: shouldBypassCache,\n    }),\n    async (req, res) => {\n      try {\n        const userId = extractUserId(req);\n        const preferences = await getUserPreferences(userId);\n        res.json(preferences);\n      } catch (error: unknown) {\n        const errMessage = error instanceof Error ? error.message : String(error);\n        res.status(401).json({ error: errMessage });\n      }\n    }\n  );\n}\n\n// ============================================================================\n// Example 6: Health Check Caching\n// ============================================================================\n\n/**\n * Setup health check caching with short TTL\n * Minimizes impact of frequent health checks while keeping data reasonably fresh\n */\nexport function setupHealthCheckCaching(router: Router): void {\n  router.get(\n    '/health',\n    cacheMiddleware({\n      keyGenerator: () => cacheKeys.health('system'),\n      ttl: TTL.HEALTH_CHECK,\n      tags: ['health'],\n    }),\n    async (req, res) => {\n      const health = await checkSystemHealth();\n      res.json(health);\n    }\n  );\n}\n\n// ============================================================================\n// Example 7: No-Cache Zones for Sensitive Data\n// ============================================================================\n\n/**\n * Setup routes that must never be cached\n * Critical for security and correctness: authentication and payments\n */\nexport function setupNoCacheZones(router: Router): void {\n  /**\n   * POST /api/auth/login - Never cache authentication responses\n   * Each login must be fresh to prevent token reuse attacks\n   */\n  router.post('/auth/login', async (req, res) => {\n    const authResult = await authenticateUser(req.body);\n    preventCaching(res);\n    res.json(authResult);\n  });\n\n  /**\n   * POST /api/payment - Never cache payment operations\n   * Payment state changes every request, must never be cached\n   */\n  router.post('/payment', async (req, res) => {\n    const paymentResult = await processPayment(req.body);\n    setCacheControl(res, 0, { noStore: true });\n    res.json(paymentResult);\n  });\n}\n\n// ============================================================================\n// Example 8: Cache Invalidation Triggers\n// ============================================================================\n\n/**\n * Setup cache management endpoints (admin only)\n * Allows fine-grained control over cache invalidation and warming\n */\nexport function setupCacheInvalidation(router: Router): void {\n  /**\n   * POST /api/admin/cache/clear - Manual cache clearing\n   * Supports three invalidation strategies: tags, pattern, or full clear\n   */\n  router.post('/admin/cache/clear', async (req, res) => {\n    const { tags, pattern } = req.body;\n\n    try {\n      let invalidated: number;\n      let method: string;\n\n      if (tags && Array.isArray(tags)) {\n        // Invalidate by tags (e.g., ['metadata', 'search'])\n        let totalInvalidated = 0;\n        for (const tag of tags) {\n          const count = await cacheManager.invalidateByTag(tag);\n          totalInvalidated += count;\n        }\n        invalidated = totalInvalidated;\n        method = 'tags';\n      } else if (pattern) {\n        // Invalidate by pattern (e.g., 'metadata:*')\n        invalidated = await cacheManager.invalidatePattern(pattern);\n        method = 'pattern';\n      } else {\n        // Clear entire cache\n        await cacheManager.clear();\n        invalidated = -1; // -1 indicates full clear\n        method = 'full';\n      }\n\n      res.json({\n        success: true,\n        invalidated,\n        method,\n      });\n    } catch (error: unknown) {\n      const errMessage = error instanceof Error ? error.message : String(error);\n      res.status(500).json({\n        success: false,\n        error: errMessage,\n      });\n    }\n  });\n\n  /**\n   * POST /api/admin/cache/warmup - Pre-warm cache with important data\n   * Reduces initial latency for frequently accessed data\n   */\n  router.post('/admin/cache/warmup', async (req, res) => {\n    const keys = req.body.keys || [];\n\n    try {\n      const defaultKeys = [\n        {\n          key: cacheKeys.tierConfig('free'),\n          value: await getTierConfig('free'),\n          ttl: TTL.TIER_CONFIG,\n        },\n        {\n          key: cacheKeys.tierConfig('premium'),\n          value: await getTierConfig('premium'),\n          ttl: TTL.TIER_CONFIG,\n        },\n        {\n          key: cacheKeys.health('system'),\n          value: await getSystemHealth(),\n          ttl: TTL.HEALTH_CHECK,\n        },\n      ];\n\n      const keysToWarm = keys.length > 0 ? keys : defaultKeys;\n      const warmed = await cacheManager.warmup(keysToWarm);\n\n      res.json({\n        success: true,\n        warmed,\n        total: keysToWarm.length,\n      });\n    } catch (error: unknown) {\n      const errMessage = error instanceof Error ? error.message : String(error);\n      res.status(500).json({\n        success: false,\n        error: errMessage,\n      });\n    }\n  });\n}\n\n// ============================================================================\n// Implementation Notes\n// ============================================================================\n\n/**\n * The helper functions below should be implemented in actual route handlers.\n * They're placeholders for demonstration purposes.\n *\n * Implement these functions with your actual business logic:\n * - fetchAllTiersFromDatabase() - Query tier data from database\n * - updateTierConfiguration() - Update tier config in database\n * - fetchMetadataForFile() - Extract/retrieve file metadata\n * - updateFileMetadata() - Persist metadata changes\n * - generateAnalytics() - Compute analytics from logs/data\n * - performSearch() - Query search index/database\n * - getUserPreferences() - Fetch user settings\n * - authenticateUser() - Validate credentials via auth provider\n * - processPayment() - Process payment through payment gateway\n * - checkSystemHealth() - Query service health status\n * - getTierConfig() - Fetch tier configuration\n * - getSystemHealth() - Aggregate system metrics\n */\n\n// These function signatures are shown for reference only.\n// Implement them with your actual business logic.\n\n// declare function fetchAllTiersFromDatabase(): Promise<any>;\n// declare function updateTierConfiguration(config: any): Promise<void>;\n// declare function fetchMetadataForFile(fileId: string): Promise<any>;\n// declare function updateFileMetadata(fileId: string, metadata: any): Promise<void>;\n// declare function generateAnalytics(query: any): Promise<any>;\n// ============================================================================\n// Stub Implementations (for demonstration purposes)\n// ============================================================================\n\nasync function fetchAllTiersFromDatabase(): Promise<any[]> {\n  // Stub: In real implementation, this would query the database\n  return [\n    { id: 'free', name: 'Free', limits: { files: 10, size: '100MB' } },\n    { id: 'premium', name: 'Premium', limits: { files: 100, size: '1GB' } },\n  ];\n}\n\nasync function updateTierConfiguration(config: any): Promise<void> {\n  // Stub: In real implementation, this would update the database\n  console.log('Updating tier configuration:', config);\n}\n\nasync function fetchMetadataForFile(fileId: string): Promise<any> {\n  // Stub: In real implementation, this would query the database\n  return { id: fileId, metadata: { size: '1MB', type: 'image/jpeg' } };\n}\n\nasync function updateFileMetadata(\n  fileId: string,\n  metadata: any\n): Promise<void> {\n  // Stub: In real implementation, this would update the database\n  console.log('Updating metadata for file:', fileId, metadata);\n}\n\nasync function generateAnalytics(query: any): Promise<any> {\n  // Stub: In real implementation, this would perform complex analytics\n  return { totalFiles: 1000, totalSize: '10GB', popularTypes: ['jpeg', 'png'] };\n}\n\nasync function performSearch(query: string, filters: any): Promise<any[]> {\n  // Stub: In real implementation, this would perform search\n  return [{ id: 'file1', name: 'example.jpg', matches: ['query'] }];\n}\n\nasync function getUserPreferences(userId: string): Promise<any> {\n  // Stub: In real implementation, this would query user preferences\n  return { theme: 'dark', notifications: true };\n}\n\nasync function checkSystemHealth(): Promise<any> {\n  // Stub: In real implementation, this would check system components\n  return {\n    status: 'healthy',\n    uptime: '99.9%',\n    services: ['db', 'cache', 'api'],\n  };\n}\n\nasync function authenticateUser(credentials: any): Promise<any> {\n  // Stub: In real implementation, this would authenticate user\n  return { id: 'user123', email: 'user@example.com' };\n}\n\nasync function processPayment(paymentData: any): Promise<any> {\n  // Stub: In real implementation, this would process payment\n  return { transactionId: 'txn_123', status: 'success' };\n}\n\nasync function getTierConfig(tier: string): Promise<any> {\n  // Stub: In real implementation, this would get tier configuration\n  return { name: tier, limits: { files: 50, size: '500MB' } };\n}\n\nasync function getSystemHealth(): Promise<any> {\n  // Stub: In real implementation, this would check system health\n  return { status: 'healthy', services: ['api', 'db', 'cache'] };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/cacheMiddleware.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CacheMetricsSnapshot' is defined but never used.","line":9,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":59},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1348,1351],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1348,1351],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'strategy' is assigned a value but never used.","line":68,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":68,"endColumn":13},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2573,2576],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2573,2576],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":104,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3131,3134],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3131,3134],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":149,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4470,4473],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4470,4473],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":183,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5481,5484],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5481,5484],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Cache Middleware for Express Routes\n *\n * Provides intelligent caching for API responses with configurable\n * strategies, automatic invalidation, and monitoring integration.\n */\n\nimport { Request, Response, NextFunction } from 'express';\nimport { cacheManager, CacheStrategy, CacheMetricsSnapshot } from './cache';\n\n// ============================================================================\n// Cache Middleware Options\n// ============================================================================\n\nexport interface CacheMiddlewareOptions {\n  enabled?: boolean;\n  keyGenerator?: (req: Request) => string;\n  ttl?: number;\n  strategy?: CacheStrategy;\n  tags?: string[];\n  skipCache?: (req: Request) => boolean;\n  varyOn?: string[];\n}\n\nexport interface CachedResponse extends Response {\n  _cached?: boolean;\n  _cacheKey?: string;\n}\n\n// ============================================================================\n// Default Key Generators\n// ============================================================================\n\nexport const defaultKeyGenerator = (req: Request): string => {\n  const parts = [\n    'api',\n    req.method,\n    req.path,\n    // Include query parameters for GET requests\n    req.method === 'GET' ? new URLSearchParams(req.url as string).toString() : '',\n    // Include user tier for authenticated requests\n    (req as any).user?.tier || 'anonymous',\n  ].filter(Boolean).join(':');\n\n  return parts;\n};\n\nexport const metadataKeyGenerator = (req: Request): string => {\n  const url = new URL(req.url as string, `http://${req.headers.host}`);\n  const fileId = url.searchParams.get('file_id');\n\n  if (fileId) {\n    return `metadata:file:${fileId}`;\n  }\n\n  return `metadata:${req.method}:${req.path}:${url.searchParams.toString()}`;\n};\n\n// ============================================================================\n// Cache Middleware Factory\n// ============================================================================\n\nexport function cacheMiddleware(options: CacheMiddlewareOptions = {}) {\n  const {\n    enabled = true,\n    keyGenerator = defaultKeyGenerator,\n    ttl = 300, // 5 minutes default\n    strategy = CacheStrategy.SHORT_TERM,\n    tags = [],\n    skipCache = () => false,\n  } = options;\n\n  return async (req: Request, res: CachedResponse, next: NextFunction) => {\n    // Skip caching if disabled or should skip\n    if (!enabled || skipCache(req)) {\n      return next();\n    }\n\n    const cacheKey = keyGenerator(req);\n    res._cacheKey = cacheKey;\n\n    try {\n      // Try to get from cache\n      const cached = await cacheManager.get<any>(cacheKey);\n      if (cached !== null) {\n        res._cached = true;\n\n        // Set cache headers\n        res.setHeader('X-Cache', 'HIT');\n        res.setHeader('X-Cache-Key', cacheKey);\n        if (cached.etag) {\n          res.setHeader('ETag', cached.etag);\n        }\n\n        return res.json(cached.data);\n      }\n\n      // Cache miss - intercept response\n      res.setHeader('X-Cache', 'MISS');\n      res.setHeader('X-Cache-Key', cacheKey);\n\n      // Store original json method\n      const originalJson = res.json.bind(res);\n      res.json = (data: any) => {\n        // Cache the response\n        cacheManager.set(cacheKey, { data, etag: res.getHeader('ETag') }, { ttl, tags })\n          .catch((err) => console.error('Cache set error:', err));\n\n        return originalJson(data);\n      };\n\n      next();\n    } catch (error) {\n      console.error('Cache middleware error:', error);\n      // Continue without caching on error\n      next();\n    }\n  };\n}\n\n// ============================================================================\n// Specialized Cache Middleware\n// ============================================================================\n\n/**\n * Cache middleware for metadata endpoints\n */\nexport function cacheMetadata(options: Partial<CacheMiddlewareOptions> = {}) {\n  return cacheMiddleware({\n    ...options,\n    keyGenerator: metadataKeyGenerator,\n    ttl: 3600, // 1 hour for metadata\n    tags: ['metadata'],\n    strategy: CacheStrategy.MEDIUM_TERM,\n  });\n}\n\n/**\n * Cache middleware for tier configuration\n */\nexport function cacheTierConfig(options: Partial<CacheMiddlewareOptions> = {}) {\n  return cacheMiddleware({\n    ...options,\n    ttl: 86400, // 1 day for tier configs (rarely change)\n    tags: ['tier', 'config'],\n    strategy: CacheStrategy.LONG_TERM,\n    skipCache: (req) => {\n      // Don't cache if user is authenticated and tier might vary\n      return !!(req as any).user;\n    },\n  });\n}\n\n/**\n * Cache middleware for analytics data\n */\nexport function cacheAnalytics(options: Partial<CacheMiddlewareOptions> = {}) {\n  return cacheMiddleware({\n    ...options,\n    ttl: 600, // 10 minutes for analytics\n    tags: ['analytics'],\n    strategy: CacheStrategy.SHORT_TERM,\n    skipCache: (req) => {\n      // Don't cache if requesting real-time data\n      const url = new URL(req.url as string, `http://${req.headers.host}`);\n      return url.searchParams.has('realtime') || url.searchParams.has('live');\n    },\n  });\n}\n\n// ============================================================================\n// Cache Invalidation Middleware\n// ============================================================================\n\n/**\n * Invalidate cache after mutations\n */\nexport function invalidateCache(tags: string[]) {\n  return async (req: Request, res: Response, next: NextFunction) => {\n    // Store original json method\n    const originalJson = res.json.bind(res);\n\n    res.json = (data: any) => {\n      // Invalidate caches by tags after successful response\n      if (res.statusCode >= 200 && res.statusCode < 300) {\n        tags.forEach(tag => {\n          cacheManager.invalidateByTag(tag)\n            .catch((err) => console.error(`Cache invalidation error for tag ${tag}:`, err));\n        });\n      }\n\n      return originalJson(data);\n    };\n\n    next();\n  };\n}\n\n/**\n * Invalidate cache for specific metadata\n */\nexport function invalidateMetadataCache() {\n  return invalidateCache(['metadata']);\n}\n\n/**\n * Invalidate cache for tier configurations\n */\nexport function invalidateTierCache() {\n  return invalidateCache(['tier', 'config']);\n}\n\n// ============================================================================\n// Cache Monitoring Middleware\n// ============================================================================\n\n/**\n * Add cache metrics to response headers\n */\nexport function cacheMetrics(req: Request, res: Response, next: NextFunction) {\n  // Send metrics as response headers\n  res.setHeader('X-Cache-Enabled', 'true');\n\n  next();\n}\n\n/**\n * Cache monitoring endpoint\n */\nexport async function getCacheMetrics(req: Request, res: Response): Promise<void> {\n  try {\n    const metrics = await cacheManager.getMetrics();\n    res.json(metrics);\n  } catch (error) {\n    res.status(500).json({\n      error: 'Failed to retrieve cache metrics',\n      details: error instanceof Error ? error.message : 'Unknown error'\n    });\n  }\n}\n\n/**\n * Cache warming endpoint\n */\nexport async function warmCache(req: Request, res: Response): Promise<void> {\n  try {\n    const { keys } = req.body;\n    if (!Array.isArray(keys)) {\n      res.status(400).json({\n        error: 'Invalid request: keys must be an array'\n      });\n      return;\n    }\n\n    const warmed = await cacheManager.warmup(keys);\n    res.json({\n      success: true,\n      warmed,\n      total: keys.length\n    });\n  } catch (error) {\n    res.status(500).json({\n      error: 'Cache warming failed',\n      details: error instanceof Error ? error.message : 'Unknown error'\n    });\n  }\n}\n\n/**\n * Cache clearing endpoint\n */\nexport async function clearCache(req: Request, res: Response): Promise<void> {\n  try {\n    const success = await cacheManager.clear();\n    res.json({\n      success,\n      message: success ? 'Cache cleared successfully' : 'Failed to clear cache'\n    });\n  } catch (error) {\n    res.status(500).json({\n      error: 'Cache clearing failed',\n      details: error instanceof Error ? error.message : 'Unknown error'\n    });\n  }\n}\n\n// ============================================================================\n// Cache Control Helpers\n// ============================================================================\n\n/**\n * Generate cache control headers\n */\nexport function setCacheControl(\n  res: Response,\n  maxAge: number,\n  options: {\n    mustRevalidate?: boolean;\n    noCache?: boolean;\n    noStore?: boolean;\n    private?: boolean;\n  } = {}\n): void {\n  const parts: string[] = [];\n\n  if (options.noStore) {\n    parts.push('no-store');\n  } else {\n    if (options.noCache) {\n      parts.push('no-cache');\n    }\n    if (maxAge > 0) {\n      parts.push(`max-age=${maxAge}`);\n    }\n    if (options.mustRevalidate) {\n      parts.push('must-revalidate');\n    }\n    if (options.private) {\n      parts.push('private');\n    }\n  }\n\n  res.setHeader('Cache-Control', parts.join(', '));\n}\n\n/**\n * Prevent caching for sensitive responses\n */\nexport function preventCaching(res: Response): void {\n  setCacheControl(res, 0, {\n    noStore: true,\n    noCache: true,\n    mustRevalidate: true,\n  });\n}\n\n// ============================================================================\n// Cache Key Generators for Common Patterns\n// ============================================================================\n\nexport const cacheKeys = {\n  // Metadata caching\n  metadata: (fileId: string, tier?: string) =>\n    `metadata:file:${fileId}:${tier || 'default'}`,\n\n  // Tier configuration caching\n  tierConfig: (tier: string) =>\n    `tier:config:${tier}`,\n\n  // User session caching\n  userSession: (userId: string) =>\n    `session:user:${userId}`,\n\n  // Analytics caching\n  analytics: (type: string, period: string) =>\n    `analytics:${type}:${period}`,\n\n  // Search results caching\n  search: (query: string, filters: string) =>\n    `search:${query}:${filters}`,\n\n  // Health check caching\n  health: (service: string) =>\n    `health:${service}`,\n};","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/db.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DatabaseConfig' is defined but never used.","line":10,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1159,1162],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1159,1162],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_db' is assigned a value but never used.","line":252,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":252,"endColumn":10},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":254,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":254,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7264,7267],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7264,7267],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":261,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":261,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7472,7475],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7472,7475],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { drizzle } from 'drizzle-orm/node-postgres';\nimport { Pool } from 'pg';\nimport * as schema from '@shared/schema';\nimport { config as loadEnv } from 'dotenv';\n\n// ============================================================================\n// Types\n// ============================================================================\n\ninterface DatabaseConfig {\n  url: string;\n  maxConnections?: number;\n  idleTimeout?: number;\n  connectionTimeout?: number;\n}\n\ninterface DatabaseInstance {\n  client: ReturnType<typeof drizzle>;\n  pool: Pool;\n  isConnected: boolean;\n}\n\n// ============================================================================\n// Configuration\n// ============================================================================\n\nconst DEFAULT_POOL_CONFIG = {\n  max: 25, // Increased connections for better concurrency under load\n  idleTimeoutMillis: 30000, // 30 seconds\n  connectionTimeoutMillis: 5000, // 5 seconds\n};\n\n/**\n * Load and validate environment variables\n * @throws Error if .env file cannot be loaded\n */\nfunction loadEnvironment(): void {\n  const result = loadEnv({ path: './.env' });\n  if (result.error && (result.error as any).code !== 'ENOENT') {\n    throw new Error(`Failed to load environment: ${result.error.message}`);\n  }\n}\n\n/**\n * Validate DATABASE_URL format\n * @throws Error if DATABASE_URL is missing or invalid\n */\nfunction validateDatabaseUrl(): string {\n  const dbUrl = process.env.DATABASE_URL;\n\n  const requireDatabase =\n    process.env.STORAGE_REQUIRE_DATABASE?.toLowerCase() === 'true' ||\n    process.env.NODE_ENV === 'production';\n\n  if (!dbUrl) {\n    if (requireDatabase) {\n      throw new Error(\n        'DATABASE_URL environment variable is not set. STORAGE_REQUIRE_DATABASE is true; please configure it in .env file.'\n      );\n    }\n\n    // DB not required, return empty string to allow in-memory fallback\n    return '';\n  }\n\n  // Check for placeholder pattern\n  if (dbUrl.includes('user:password@host')) {\n    throw new Error(\n      'DATABASE_URL contains placeholder values. Please update with actual database credentials.'\n    );\n  }\n\n  // Validate PostgreSQL URL format\n  if (!dbUrl.startsWith('postgresql://') && !dbUrl.startsWith('postgres://')) {\n    throw new Error(\n      'DATABASE_URL must be a valid PostgreSQL connection string (postgresql:// or postgres://)'\n    );\n  }\n\n  return dbUrl;\n}\n\n/**\n * Initialize database connection with validation\n * @throws Error if connection fails\n */\nfunction initializeDatabase(): DatabaseInstance | null {\n  const dbUrl = validateDatabaseUrl();\n\n  // If dbUrl is empty and DB is not required, return null to indicate no DB configured\n  if (!dbUrl) {\n    return null;\n  }\n\n  const pool = new Pool({\n    connectionString: dbUrl,\n    ...DEFAULT_POOL_CONFIG,\n  });\n\n  // Set up error listeners for the pool\n  pool.on('error', error => {\n    console.error(' Unexpected error on database connection pool:', error);\n  });\n\n  // Create Drizzle client\n  const client = drizzle(pool, { schema });\n\n  return {\n    client,\n    pool,\n    isConnected: false,\n  };\n}\n\n/**\n * Verify database connectivity by running a test query\n * @throws Error if connection test fails\n */\nasync function testDatabaseConnection(db: DatabaseInstance): Promise<void> {\n  try {\n    // Simple test query to verify connection\n    await db.pool.query('SELECT 1');\n    db.isConnected = true;\n  } catch (error: unknown) {\n    throw new Error(\n      `Failed to connect to database: ${error instanceof Error ? error.message : String(error)}`\n    );\n  }\n}\n\n// ============================================================================\n// Database Initialization\n// ============================================================================\n\nlet dbInstance: DatabaseInstance | null = null;\nlet initError: Error | null = null;\n\ntry {\n  loadEnvironment();\n  dbInstance = initializeDatabase();\n\n  if (!dbInstance) {\n    console.log(\n      '  Database not configured. STORAGE_REQUIRE_DATABASE is not set or DATABASE_URL missing; using in-memory storage if available.'\n    );\n  } else {\n    // Optimistically mark connected so downstream modules (e.g., storage index) don't throw\n    dbInstance.isConnected = true;\n\n    const requireDb =\n      process.env.STORAGE_REQUIRE_DATABASE?.toLowerCase() === 'true' ||\n      process.env.NODE_ENV === 'production';\n\n    // Verify connection asynchronously; if verification fails and DB is required, exit fast\n    if (process.env.NODE_ENV === 'test') {\n      // Skip real DB connection tests in unit tests to avoid opening real DB sockets\n      dbInstance.isConnected = true;\n      console.log(' Skipping database verification in test environment');\n    } else {\n      testDatabaseConnection(dbInstance)\n        .then(() => {\n          console.log(' Database connection verified');\n        })\n        .catch((error: unknown) => {\n          initError = error as Error;\n          console.error(\n            ` Failed to verify database connection: ${initError.message}`\n          );\n          if (requireDb) {\n            console.error(\n              ' STORAGE_REQUIRE_DATABASE=true and database verification failed. Exiting.'\n            );\n            process.exit(1);\n          } else {\n            // Mark disconnected but allow the app to continue using in-memory storage\n            dbInstance!.isConnected = false;\n          }\n        });\n    }\n  }\n\n  console.log(' Database initialization complete');\n} catch (error) {\n  initError = error as Error;\n  console.error(` Failed to initialize database: ${initError.message}`);\n}\n\n// ============================================================================\n// Exports\n// ============================================================================\n\n/**\n * Get the Drizzle ORM client\n * @throws Error if database failed to initialize\n */\nexport function getDatabase(): ReturnType<typeof drizzle> {\n  if (!dbInstance) {\n    throw new Error(\n      'Database is not initialized. Check console for initialization errors.'\n    );\n  }\n  return dbInstance.client;\n}\n\n/**\n * Check if database is connected\n */\nexport function isDatabaseConnected(): boolean {\n  return dbInstance?.isConnected ?? false;\n}\n\n/**\n * Get the underlying PostgreSQL connection pool\n * Useful for raw queries or advanced operations\n */\nexport function getDatabasePool(): Pool {\n  if (!dbInstance) {\n    throw new Error('Database is not initialized');\n  }\n  return dbInstance.pool;\n}\n\n/**\n * Close database connection gracefully\n * Should be called during application shutdown\n */\nexport async function closeDatabase(): Promise<void> {\n  if (dbInstance?.pool) {\n    try {\n      await dbInstance.pool.end();\n      console.log(' Database connection closed');\n    } catch (error: unknown) {\n      console.error(\n        ` Error closing database: ${error instanceof Error ? error.message : String(error)}`\n      );\n    }\n  }\n}\n\n/**\n * For backward compatibility with code using `db` directly\n * Returns the Drizzle ORM client that can be used for queries\n */\nexport function getDb(): ReturnType<typeof drizzle> {\n  return getDatabase();\n}\n\n/**\n * Direct export for code that imports `db` directly\n * This is the actual Drizzle client instance\n */\nconst _db: ReturnType<typeof drizzle> | null = null;\n\nexport const db = new Proxy({} as any, {\n  get: (target, prop) => {\n    if (!dbInstance) {\n      throw new Error(\n        'Database is not initialized. Check console for initialization errors.'\n      );\n    }\n    return (dbInstance.client as any)[prop];\n  },\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/index.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'db' is defined but never used.","line":15,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getClientIP' is defined but never used.","line":20,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'securityEventLogger' is defined but never used.","line":28,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'wsApp' is assigned a value but never used.","line":36,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'capturedJsonResponse' is assigned a value but never used.","line":129,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":129,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":129,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3904,3907],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3904,3907],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":254,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":254,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8059,8062],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8059,8062],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":261,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":261,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8382,8385],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8382,8385],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":313,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":313,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10096,10099],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10096,10099],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Load environment variables FIRST\nimport { config } from 'dotenv';\nconfig({ path: './.env' });\n\nimport express, { type Request, Response, NextFunction } from 'express';\nimport cookieParser from 'cookie-parser';\nimport { registerRoutes } from './routes';\nimport { registerAuthRoutes, authMiddleware } from './auth';\nimport {\n  registerMockAuthRoutes,\n  authMiddleware as mockAuthMiddleware,\n} from './auth-mock';\nimport { serveStatic } from './static';\nimport { createServer } from 'http';\nimport { db } from './db';\nimport expressWs from 'express-ws';\nimport crypto from 'crypto';\nimport {\n  applySecurityHeaders,\n  getClientIP,\n  sanitizeErrorMessage,\n} from './security-utils';\nimport { pythonExecutable } from './utils/extraction-helpers';\nimport { cleanupOrphanedTempFiles, startPeriodicCleanup, cleanupOnExit } from './startup-cleanup';\nimport { registerHealthRoutes } from './routes/health';\nimport { registerMonitoringRoutes } from './routes/monitoring';\nimport { securityAlertManager } from './monitoring/security-alerts';\nimport { securityEventLogger } from './monitoring/security-events';\nimport { applyUploadRateLimiting } from './middleware/upload-rate-limit';\n\nconst app = express();\nconst httpServer = createServer(app);\n\n// Add WebSocket support to Express\nconst expressWsInstance = expressWs(app, httpServer);\nconst wsApp = expressWsInstance.app;\n\ndeclare module 'http' {\n  interface IncomingMessage {\n    rawBody: unknown;\n    requestId?: string;\n  }\n}\n\n// Cookie parser (must be before other middleware)\napp.use(cookieParser());\n\napp.use(\n  express.json({\n    limit: '10kb', // Limit body size to prevent DoS\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  })\n);\n\napp.use(express.urlencoded({ extended: false, limit: '10kb' }));\n\n// Debug middleware to track request flow\napp.use((req: Request, res: Response, next: NextFunction) => {\n  console.log(`[DEBUG] ${req.method} ${req.path} - Request received`);\n  next();\n});\n\n// Apply security headers to all responses\napp.use((req: Request, res: Response, next: NextFunction) => {\n  try {\n    applySecurityHeaders(res, req);\n    next();\n  } catch (error) {\n    console.error('Security headers middleware error:', error);\n    next(error);\n  }\n});\n\n// Generate request ID for audit trail\napp.use((req: Request, res: Response, next: NextFunction) => {\n  try {\n    req.requestId =\n      (req.headers['x-request-id'] as string) || crypto.randomUUID();\n    res.setHeader('X-Request-ID', req.requestId);\n    next();\n  } catch (error) {\n    console.error('Request ID middleware error:', error);\n    next(error);\n  }\n});\n\n// Auth middleware - attaches user to request if authenticated\n// Use mock auth if database is not available\nconst isDatabaseAvailable = !!process.env.DATABASE_URL;\nif (isDatabaseAvailable) {\n  app.use(authMiddleware);\n  log('Using database authentication system');\n} else {\n  app.use(mockAuthMiddleware);\n  console.log(\n    '\\x1b[33m%s\\x1b[0m',\n    '----------------------------------------------------------------'\n  );\n  console.log('\\x1b[33m%s\\x1b[0m', '  WARNING: DATABASE_URL not configured!');\n  console.log('\\x1b[33m%s\\x1b[0m', '   - Using mock authentication system');\n  console.log(\n    '\\x1b[33m%s\\x1b[0m',\n    '   - Using in-memory storage (DATA WILL BE LOST ON RESTART)'\n  );\n  console.log(\n    '\\x1b[33m%s\\x1b[0m',\n    '----------------------------------------------------------------'\n  );\n}\n\nexport function log(message: string, source = 'express') {\n  const formattedTime = new Date().toLocaleTimeString('en-US', {\n    hour: 'numeric',\n    minute: '2-digit',\n    second: '2-digit',\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nlog(`Python executable: ${pythonExecutable}`, 'startup');\n\napp.use((req: Request, res: Response, next: NextFunction) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on('finish', () => {\n    const duration = Date.now() - start;\n    if (path.startsWith('/api')) {\n      const logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  // Register auth routes - use mock auth if database is not available\n  const isDatabaseAvailable = !!process.env.DATABASE_URL;\n  if (isDatabaseAvailable) {\n    registerAuthRoutes(app);\n    log('Registered database authentication routes');\n  } else {\n    registerMockAuthRoutes(app);\n    log('  Registered mock authentication routes (development mode)');\n    log(' Test credentials available at /api/auth/dev/users');\n  }\n\n  // Register main API routes\n  await registerRoutes(httpServer, app);\n\n  // Register health check routes\n  registerHealthRoutes(app);\n  log('Registered health check routes');\n\n  // Register monitoring routes\n  registerMonitoringRoutes(app);\n  log('Registered monitoring routes');\n\n  // Apply upload rate limiting (skip in test environment)\n  if (process.env.NODE_ENV !== 'test') {\n    applyUploadRateLimiting(app);\n    log('Applied upload rate limiting');\n  } else {\n    log('Skipping rate limiting in test environment');\n  }\n\n  // Initialize temp file cleanup system (skip in test environment)\n  if (process.env.NODE_ENV !== 'test') {\n    log('Initializing temp file cleanup system...');\n    try {\n      // Run cleanup on startup\n      const startupResult = await cleanupOrphanedTempFiles();\n      log(`Startup cleanup completed: removed ${startupResult.totalFilesRemoved} files, freed ${Math.round(startupResult.totalSpaceFreed / (1024 * 1024))}MB`);\n      \n      // Start periodic cleanup (hourly)\n      const cleanupInterval = startPeriodicCleanup(60 * 60 * 1000);\n      log('Periodic cleanup scheduled every hour');\n      \n      // Initialize security monitoring\n      log('Initializing security monitoring system...');\n      try {\n        // Start periodic security monitoring (every 5 minutes)\n        const monitoringInterval = securityAlertManager.startPeriodicMonitoring(5 * 60 * 1000);\n        log('Security monitoring active - checking every 5 minutes');\n        \n        // Cleanup monitoring on exit\n        process.on('exit', () => {\n          securityAlertManager.stopPeriodicMonitoring(monitoringInterval);\n        });\n        \n        process.on('SIGINT', async () => {\n          securityAlertManager.stopPeriodicMonitoring(monitoringInterval);\n        });\n        \n        process.on('SIGTERM', async () => {\n          securityAlertManager.stopPeriodicMonitoring(monitoringInterval);\n        });\n        \n      } catch (error) {\n        log(`Warning: Security monitoring initialization failed: ${error}`, 'startup');\n      }\n      \n      // Cleanup on process exit\n      process.on('exit', async () => {\n        clearInterval(cleanupInterval);\n        await cleanupOnExit();\n      });\n      \n      // Handle graceful shutdown\n      process.on('SIGINT', async () => {\n        log('Received SIGINT, cleaning up...');\n        clearInterval(cleanupInterval);\n        await cleanupOnExit();\n        process.exit(0);\n      });\n      \n      process.on('SIGTERM', async () => {\n        log('Received SIGTERM, cleaning up...');\n        clearInterval(cleanupInterval);\n        await cleanupOnExit();\n        process.exit(0);\n      });\n      \n    } catch (error) {\n      log(`Warning: Temp cleanup system initialization failed: ${error}`, 'startup');\n      // Continue startup even if cleanup fails\n    }\n  } else {\n    log('Skipping temp cleanup system initialization in test environment');\n  }\n\n  // CRITICAL FIX: Add API 404 handler for undefined API routes\n  app.use('/api/*', (req: Request, res: Response) => {\n    res.status(404).json({\n      error: 'API endpoint not found',\n      message: `The endpoint ${req.originalUrl} does not exist`,\n      requestId: req.requestId,\n    });\n  });\n\n  // Enhanced error handler with sanitization\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const context =\n      process.env.NODE_ENV === 'production' ? 'production' : 'development';\n\n    try {\n      const message = sanitizeErrorMessage(err.message, context);\n      const requestId = (_req as any).requestId || 'unknown';\n\n      // Log full error with request ID for debugging (without sensitive data)\n      console.error(`[${requestId}] Error:`, {\n        status,\n        message: sanitizeErrorMessage(err.message, context),\n        stack: process.env.NODE_ENV === 'development' ? err.stack : undefined,\n      });\n\n      res.status(status).json({\n        error: status >= 500 ? 'Internal Server Error' : message,\n        requestId,\n      });\n    } catch (handlerError) {\n      // If the error handler itself fails, log and return a safe response\n      console.error('Error handler failed:', handlerError);\n      console.error('Original error:', err);\n      res.status(500).json({\n        error: 'Internal Server Error',\n        requestId: 'unknown',\n      });\n    }\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === 'production') {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import('./vite');\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 3000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '3000', 10);\n  const host = process.env.HOST || '0.0.0.0';\n\n  const startServer = (portToUse: number) => {\n    httpServer\n      .listen(\n        {\n          port: portToUse,\n          host,\n        },\n        () => {\n          log(`serving on ${host}:${portToUse}`);\n        }\n      )\n      .on('error', (err: any) => {\n        if (err.code === 'EADDRINUSE') {\n          log(`Port ${portToUse} is in use, retrying on ${portToUse + 1}...`);\n          startServer(portToUse + 1);\n        } else {\n          console.error('Server failed to start:', err);\n        }\n      });\n  };\n\n  startServer(port);\n})();\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/middleware/admin-auth.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'clearFailedAttempts' is defined but never used.","line":12,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[832,835],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[832,835],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1135,1138],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1135,1138],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1170,1173],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1170,1173],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Admin Authentication Middleware\n * Protects admin endpoints with authentication and rate limiting\n */\n\nimport { Request, Response, NextFunction } from 'express';\nimport { verifyToken } from '../auth';\nimport {\n  checkRateLimit,\n  isLockedOut,\n  recordFailedAttempt,\n  clearFailedAttempts,\n} from '../security-utils';\n\n// Admin API key for programmatic access (should be set in environment)\nconst ADMIN_API_KEY = process.env.ADMIN_API_KEY;\n\n/**\n * Admin authentication middleware\n * Supports both JWT token and API key authentication\n */\nexport function adminAuthMiddleware(\n  req: Request,\n  res: Response,\n  next: NextFunction\n): void {\n  // Check for API key first (for programmatic access)\n  const apiKey = req.headers['x-admin-api-key'] as string;\n  if (apiKey && ADMIN_API_KEY && apiKey === ADMIN_API_KEY) {\n    (req as any).isAdmin = true;\n    next();\n    return;\n  }\n\n  // Check for JWT token\n  const authHeader = req.headers.authorization;\n  if (authHeader?.startsWith('Bearer ')) {\n    const token = authHeader.slice(7);\n    const user = verifyToken(token);\n\n    if (user && user.tier === 'enterprise') {\n      (req as any).isAdmin = true;\n      (req as any).user = user;\n      next();\n      return;\n    }\n  }\n\n  res.status(401).json({\n    error: 'Unauthorized',\n    message: 'Admin authentication required',\n  });\n}\n\n/**\n * Admin rate limiting middleware\n * Stricter limits for admin endpoints\n */\nexport function adminRateLimitMiddleware(\n  req: Request,\n  res: Response,\n  next: NextFunction\n): void {\n  const adminKey = 'admin:' + (req.ip || 'unknown');\n\n  // Check if locked out\n  const lockStatus = isLockedOut(adminKey, 10, 15 * 60 * 1000);\n  if (lockStatus.locked) {\n    res.setHeader(\n      'Retry-After',\n      Math.ceil((lockStatus.resetTime - Date.now()) / 1000)\n    );\n    res.status(429).json({\n      error: 'Too Many Requests',\n      message: 'Admin rate limit exceeded. Please try again later.',\n      retryAfter: Math.ceil((lockStatus.resetTime - Date.now()) / 1000),\n    });\n    return;\n  }\n\n  // Check rate limit (10 requests per minute for admin)\n  const rateLimitResult = checkRateLimit(adminKey, 10, 60 * 1000);\n  res.setHeader('X-RateLimit-Limit', '10');\n  res.setHeader('X-RateLimit-Remaining', rateLimitResult.remaining);\n  res.setHeader(\n    'X-RateLimit-Reset',\n    new Date(rateLimitResult.resetTime).toISOString()\n  );\n\n  if (!rateLimitResult.allowed) {\n    recordFailedAttempt(adminKey, 10, 15 * 60 * 1000);\n    res.setHeader(\n      'Retry-After',\n      Math.ceil((rateLimitResult.resetTime - Date.now()) / 1000)\n    );\n    res.status(429).json({\n      error: 'Too Many Requests',\n      message: 'Admin rate limit exceeded',\n      retryAfter: Math.ceil((rateLimitResult.resetTime - Date.now()) / 1000),\n    });\n    return;\n  }\n\n  next();\n}\n\n/**\n * Combine admin auth and rate limit middleware\n */\nexport function adminProtectionMiddleware(\n  req: Request,\n  res: Response,\n  next: NextFunction\n): void {\n  adminAuthMiddleware(req, res, (err?: unknown) => {\n    if (err) {\n      next(err as Error);\n      return;\n    }\n    adminRateLimitMiddleware(req, res, next);\n  });\n}\n\n/**\n * Health check - no auth required\n */\nexport function healthCheckAuth(\n  req: Request,\n  res: Response,\n  next: NextFunction\n): void {\n  next();\n}\n\n/**\n * Get admin API key status\n */\nexport function getAdminApiKeyStatus(): { configured: boolean } {\n  return {\n    configured: !!ADMIN_API_KEY,\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/middleware/advanced-protection.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1403,1406],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1403,1406],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1452,1455],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1452,1455],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1578,1581],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1578,1581],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":96,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2521,2524],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2521,2524],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":109,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2860,2863],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2860,2863],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":125,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":125,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":136,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3774,3777],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3774,3777],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":137,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3841,3844],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3841,3844],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":167,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4475,4478],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4475,4478],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":168,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":168,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4504,4507],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4504,4507],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":226,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":226,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6200,6203],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6200,6203],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":329,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":329,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8996,8999],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8996,8999],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":350,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":350,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9520,9523],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9520,9523],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":376,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":376,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10311,10314],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10311,10314],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":507,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":507,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13828,13831],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13828,13831],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":517,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":517,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14192,14195],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14192,14195],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":542,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":542,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14717,14720],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14717,14720],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":563,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":563,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15312,15315],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15312,15315],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":18,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Advanced Protection Middleware\n * \n * Combines browser fingerprinting and ML-based anomaly detection\n * for comprehensive abuse prevention\n */\n\nimport { Request, Response, NextFunction } from 'express';\nimport { generateFingerprint, trackFingerprint, EnhancedFingerprint } from '../monitoring/browser-fingerprint';\nimport { mlAnomalyDetector } from '../monitoring/ml-anomaly-detection';\nimport { securityEventLogger } from '../monitoring/security-events';\nimport { securityAlertManager } from '../monitoring/security-alerts';\n\n// Protection configuration\nconst PROTECTION_CONFIG = {\n  // Enable/disable features\n  BROWSER_FINGERPRINTING: true,\n  ML_ANOMALY_DETECTION: true,\n  REAL_TIME_ANALYSIS: true,\n  \n  // Thresholds (0-100 scale)\n  BLOCK_THRESHOLD: 90,\n  CHALLENGE_THRESHOLD: 70,\n  MONITOR_THRESHOLD: 50,\n  \n  // Response actions\n  ACTIONS: {\n    ALLOW: 'allow',\n    CHALLENGE: 'challenge',\n    BLOCK: 'block',\n    MONITOR: 'monitor'\n  },\n  \n  // Challenge types\n  CHALLENGES: {\n    CAPTCHA: 'captcha',\n    DELAY: 'delay',\n    MFA: 'mfa',\n    RATE_LIMIT: 'rate_limit'\n  }\n} as const;\n\n// Protection result\ninterface ProtectionResult {\n  action: 'allow' | 'challenge' | 'block' | 'monitor';\n  confidence: number;\n  riskScore: number;\n  riskLevel: 'low' | 'medium' | 'high' | 'critical';\n  reasons: string[];\n  recommendations: string[];\n  fingerprint?: EnhancedFingerprint;\n  anomalyResult?: any;\n  challengeType?: string;\n  challengeData?: any;\n}\n\n// Challenge response\ninterface ChallengeResponse {\n  type: string;\n  difficulty: 'easy' | 'medium' | 'hard';\n  data: any;\n  expiresAt: Date;\n  sessionId: string;\n}\n\n/**\n * Advanced protection middleware\n */\nexport async function advancedProtectionMiddleware(\n  req: Request,\n  res: Response,\n  next: NextFunction\n): Promise<void> {\n  try {\n    // Skip if protection is disabled\n    if (!shouldApplyProtection(req)) {\n      return next();\n    }\n\n    // Generate browser fingerprint\n    let fingerprint: EnhancedFingerprint | undefined;\n    if (PROTECTION_CONFIG.BROWSER_FINGERPRINTING) {\n      const clientData = req.body.fingerprintData; // Client-side fingerprint data\n      fingerprint = await generateFingerprint(req, clientData);\n    }\n\n    // Run ML anomaly detection\n    let anomalyResult;\n    if (PROTECTION_CONFIG.ML_ANOMALY_DETECTION) {\n      anomalyResult = await mlAnomalyDetector.detectUploadAnomaly(req, fingerprint);\n    }\n\n    // Track fingerprint across sessions\n    let fingerprintTracking;\n    if (fingerprint) {\n      const userId = (req as any).user?.id;\n      fingerprintTracking = await trackFingerprint(fingerprint, userId);\n    }\n\n    // Make protection decision\n    const protectionResult = await makeProtectionDecision(\n      req,\n      fingerprint,\n      anomalyResult,\n      fingerprintTracking\n    );\n\n    // Store protection result in request for later use\n    (req as any).protectionResult = protectionResult;\n\n    // Execute protection action\n    await executeProtectionAction(req, res, next, protectionResult);\n\n  } catch (error: unknown) {\n    console.error('[AdvancedProtection] Error:', error);\n\n    // Normalize error details safely\n    const errorDetails: { message?: string; stack?: string; raw?: string } = {};\n    if (error instanceof Error) {\n      errorDetails.message = error.message;\n      errorDetails.stack = error.stack;\n    } else {\n      try {\n        errorDetails.raw = typeof error === 'string' ? error : JSON.stringify(error);\n      } catch (e) {\n        errorDetails.raw = String(error);\n      }\n    }\n    \n    // On error, allow request but log the failure\n    await securityEventLogger.logEvent({\n      event: 'protection_error',\n      severity: 'medium',\n      timestamp: new Date(),\n      source: 'advanced_protection',\n      ipAddress: req.ip || (req as any).connection?.remoteAddress || 'unknown',\n      userId: (req as any).user?.id,\n      details: errorDetails\n    });\n\n    // Allow request to continue on protection failure\n    return next();\n  }\n}\n\n/**\n * Determine if protection should be applied\n */\nfunction shouldApplyProtection(req: Request): boolean {\n  // Skip for health checks and monitoring endpoints\n  const skipPaths = [\n    '/health',\n    '/api/monitoring',\n    '/metrics',\n    '/favicon.ico'\n  ];\n\n  return !skipPaths.some(path => req.path.startsWith(path));\n}\n\n/**\n * Make protection decision based on all available data\n */\nasync function makeProtectionDecision(\n  req: Request,\n  fingerprint?: EnhancedFingerprint,\n  anomalyResult?: any,\n  fingerprintTracking?: any\n): Promise<ProtectionResult> {\n  let riskScore = 0;\n  let confidence = 0;\n  const reasons: string[] = [];\n  const recommendations: string[] = [];\n\n  // Factor in ML anomaly detection\n  if (anomalyResult) {\n    riskScore = Math.max(riskScore, anomalyResult.riskScore);\n    confidence = Math.max(confidence, anomalyResult.confidence);\n    reasons.push(...anomalyResult.contributingFactors);\n    recommendations.push(...anomalyResult.recommendations);\n  }\n\n  // Factor in fingerprint analysis\n  if (fingerprint && fingerprintTracking) {\n    // New device risk\n    if (fingerprintTracking.isNewDevice) {\n      riskScore += 10;\n      reasons.push('New device detected');\n    }\n\n    // Multiple sessions risk\n    if (fingerprintTracking.previousSessions > 5) {\n      riskScore += 15;\n      reasons.push('Multiple sessions from same device');\n    }\n\n    // Fingerprint anomalies\n    if (fingerprint.anomalies && fingerprint.anomalies.length > 0) {\n      riskScore += 20;\n      reasons.push(...fingerprint.anomalies);\n    }\n\n    // Low confidence fingerprint\n    if (fingerprint.confidence < 0.5) {\n      riskScore += 15;\n      reasons.push('Low fingerprint confidence');\n    }\n  }\n\n  // Factor in request characteristics\n  const requestRisk = await calculateRequestRisk(req);\n  riskScore += requestRisk.score;\n  if (requestRisk.reasons.length > 0) {\n    reasons.push(...requestRisk.reasons);\n  }\n\n  // Normalize risk score\n  riskScore = Math.min(100, riskScore);\n\n  // Determine risk level\n  const riskLevel = getRiskLevel(riskScore);\n\n  // Determine action based on thresholds\n  let action: 'allow' | 'challenge' | 'block' | 'monitor';\n  let challengeType: string | undefined;\n  let challengeData: any | undefined;\n\n  if (riskScore >= PROTECTION_CONFIG.BLOCK_THRESHOLD) {\n    action = PROTECTION_CONFIG.ACTIONS.BLOCK;\n  } else if (riskScore >= PROTECTION_CONFIG.CHALLENGE_THRESHOLD) {\n    action = PROTECTION_CONFIG.ACTIONS.CHALLENGE;\n    const challenge = await generateChallenge(req, riskLevel);\n    challengeType = challenge.type;\n    challengeData = challenge.data;\n  } else if (riskScore >= PROTECTION_CONFIG.MONITOR_THRESHOLD) {\n    action = PROTECTION_CONFIG.ACTIONS.MONITOR;\n  } else {\n    action = PROTECTION_CONFIG.ACTIONS.ALLOW;\n  }\n\n  // Determine final confidence\n  confidence = Math.min(1.0, confidence + 0.2); // Boost confidence slightly\n\n  return {\n    action,\n    confidence,\n    riskScore,\n    riskLevel,\n    reasons: [...new Set(reasons)], // Remove duplicates\n    recommendations: [...new Set(recommendations)],\n    fingerprint,\n    anomalyResult,\n    challengeType,\n    challengeData\n  };\n}\n\n/**\n * Calculate request-based risk factors\n */\nasync function calculateRequestRisk(req: Request): Promise<{ score: number; reasons: string[] }> {\n  let score = 0;\n  const reasons: string[] = [];\n\n  // Check for suspicious headers\n  const userAgent = req.headers['user-agent'];\n  if (!userAgent || userAgent.length < 10) {\n    score += 15;\n    reasons.push('Missing or invalid user agent');\n  }\n\n  // Check for automation indicators\n  if (userAgent && userAgent.includes('HeadlessChrome')) {\n    score += 25;\n    reasons.push('Headless browser detected');\n  }\n\n  // Check for missing referer\n  const referer = req.headers.referer;\n  if (!referer) {\n    score += 10;\n    reasons.push('Missing referer header');\n  }\n\n  // Check for suspicious timing\n  const hour = new Date().getHours();\n  if (hour >= 2 && hour <= 5) {\n    score += 10;\n    reasons.push('Upload during suspicious hours');\n  }\n\n  // Check for missing client fingerprint data\n  if (!req.body.fingerprintData) {\n    score += 20;\n    reasons.push('Missing client fingerprint data');\n  }\n\n  return { score, reasons };\n}\n\n/**\n * Get risk level from score\n */\nexport function getRiskLevel(riskScore: number): 'low' | 'medium' | 'high' | 'critical' {\n  if (riskScore >= 90) return 'critical';\n  if (riskScore >= 70) return 'high';\n  if (riskScore >= 40) return 'medium';\n  return 'low';\n} \n\n/**\n * Execute protection action\n */\nasync function executeProtectionAction(\n  req: Request,\n  res: Response,\n  next: NextFunction,\n  result: ProtectionResult\n): Promise<void> {\n  const { action, riskScore, riskLevel, reasons, confidence } = result;\n\n  // Log the protection decision\n  await securityEventLogger.logEvent({\n    event: 'protection_decision',\n    severity: riskLevel,\n    timestamp: new Date(),\n    source: 'advanced_protection',\n    ipAddress: req.ip || req.connection.remoteAddress || 'unknown',\n    userId: (req as any).user?.id,\n    details: {\n      action,\n      riskScore,\n      riskLevel,\n      confidence,\n      reasons,\n      fingerprintId: result.fingerprint?.fingerprintHash,\n      anomalyScore: result.anomalyResult?.riskScore,\n      deviceId: result.fingerprint?.deviceId\n    }\n  });\n\n  // Execute based on action\n  switch (action) {\n    case PROTECTION_CONFIG.ACTIONS.ALLOW:\n      // Allow request to proceed\n      return next();\n\n    case PROTECTION_CONFIG.ACTIONS.MONITOR:\n      // Allow but add monitoring flag\n      (req as any).monitoringRequired = true;\n      return next();\n\n    case PROTECTION_CONFIG.ACTIONS.CHALLENGE:\n      // Send challenge response\n      return await sendChallengeResponse(req, res, result);\n\n    case PROTECTION_CONFIG.ACTIONS.BLOCK:\n      // Block the request\n      return await sendBlockResponse(req, res, result);\n\n    default:\n      // Unknown action, allow request\n      console.warn(`[AdvancedProtection] Unknown action: ${action}`);\n      return next();\n  }\n}\n\n/**\n * Generate challenge for suspicious requests\n */\nasync function generateChallenge(req: Request, riskLevel: string): Promise<ChallengeResponse> {\n  const sessionId = `challenge_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  \n  let type: string;\n  let difficulty: 'easy' | 'medium' | 'hard';\n  let data: any;\n\n  if (riskLevel === 'high') {\n    type = PROTECTION_CONFIG.CHALLENGES.CAPTCHA;\n    difficulty = 'hard';\n    data = {\n      siteKey: process.env.RECAPTCHA_SITE_KEY,\n      challengeType: 'invisible'\n    };\n  } else if (riskLevel === 'medium') {\n    type = PROTECTION_CONFIG.CHALLENGES.DELAY;\n    difficulty = 'medium';\n    data = {\n      delaySeconds: 5,\n      message: 'Please wait a moment before continuing...'\n    };\n  } else {\n    type = PROTECTION_CONFIG.CHALLENGES.RATE_LIMIT;\n    difficulty = 'easy';\n    data = {\n      maxRequests: 5,\n      windowMinutes: 1\n    };\n  }\n\n  return {\n    type,\n    difficulty,\n    data,\n    expiresAt: new Date(Date.now() + 5 * 60 * 1000), // 5 minutes\n    sessionId\n  };\n}\n\n/**\n * Send challenge response to client\n */\nasync function sendChallengeResponse(req: Request, res: Response, result: ProtectionResult): Promise<void> {\n  const { challengeType, challengeData, riskScore, reasons } = result;\n\n  res.status(403).json({\n    error: 'Challenge required',\n    challenge: {\n      type: challengeType,\n      data: challengeData,\n      riskScore,\n      reasons,\n      instructions: getChallengeInstructions(challengeType)\n    },\n    retryAfter: 60 // seconds\n  });\n  return; \n}\n\n/**\n * Send block response to client\n */\nasync function sendBlockResponse(req: Request, res: Response, result: ProtectionResult): Promise<void> {\n  const { riskScore, reasons, recommendations } = result;\n\n  // Send security alert for blocked request\n  await securityAlertManager.sendAlert({\n    type: 'security',\n    severity: 'high',\n    title: 'Upload Blocked - Advanced Protection',\n    message: `Upload request blocked due to high risk score (${riskScore}/100)`,\n    details: {\n      reasons,\n      recommendations,\n      ipAddress: req.ip || req.connection.remoteAddress,\n      userAgent: req.headers['user-agent'],\n      timestamp: new Date().toISOString()\n    },\n    metadata: {\n      category: 'abuse_prevention',\n      tags: ['blocked', 'high_risk', 'advanced_protection']\n    }\n  });\n\n  res.status(403).json({\n    error: 'Access denied',\n    message: 'Your request has been blocked due to security concerns',\n    riskScore,\n    riskLevel: result.riskLevel,\n    reasons: reasons.slice(0, 3), // Show top 3 reasons\n    supportUrl: '/support/security',\n    incidentId: `INC_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n    retryAfter: 3600 // 1 hour\n  });\n  return; \n}\n\n/**\n * Get challenge instructions\n */\nfunction getChallengeInstructions(challengeType?: string): string {\n  switch (challengeType) {\n    case PROTECTION_CONFIG.CHALLENGES.CAPTCHA:\n      return 'Please complete the CAPTCHA to continue';\n    case PROTECTION_CONFIG.CHALLENGES.DELAY:\n      return 'Please wait for the specified delay before continuing';\n    case PROTECTION_CONFIG.CHALLENGES.RATE_LIMIT:\n      return 'Please reduce your request frequency';\n    default:\n      return 'Please complete the required verification';\n  }\n}\n\n/**\n * Verify challenge response\n */\nexport async function verifyChallengeResponse(\n  req: Request,\n  res: Response,\n  next: NextFunction\n): Promise<void> {\n  try {\n    const { challengeResponse, sessionId } = req.body;\n    \n    if (!challengeResponse || !sessionId) {\n      res.status(400).json({\n        error: 'Missing challenge response'\n      });\n      return;\n    }\n\n    // Verify the challenge response\n    const isValid = await validateChallengeResponse(challengeResponse, sessionId);\n    \n    if (isValid) {\n      // Challenge passed, allow request\n      (req as any).challengePassed = true;\n      return next();\n    } else {\n      // Challenge failed\n      await securityEventLogger.logEvent({\n        event: 'challenge_failed',\n        severity: 'medium',\n        timestamp: new Date(),\n        source: 'challenge_verification',\n        ipAddress: req.ip || req.connection.remoteAddress || 'unknown',\n        userId: (req as any).user?.id,\n        details: {\n          sessionId,\n          challengeResponse\n        }\n      });\n\n      res.status(403).json({\n        error: 'Challenge verification failed',\n        retryAfter: 300 // 5 minutes\n      });\n      return;\n    }\n  } catch (error: unknown) {\n    console.error('[ChallengeVerification] Error:', error);\n    res.status(500).json({\n      error: 'Challenge verification error'\n    });\n    return;\n  }\n}\n\n/**\n * Validate challenge response\n */\nasync function validateChallengeResponse(response: any, sessionId: string): Promise<boolean> {\n  // This would validate the actual challenge response\n  // For now, use simple validation\n  \n  if (!response || !sessionId) return false;\n  \n  // Basic validation logic\n  if (response.type === 'captcha') {\n    return response.token && response.token.length > 10;\n  } else if (response.type === 'delay') {\n    return response.completed === true;\n  } else if (response.type === 'rate_limit') {\n    return response.acknowledged === true;\n  }\n  \n  return false;\n}\n\n/**\n * Get protection statistics\n */\nexport async function getProtectionStats(): Promise<any> {\n  try {\n    const stats = {\n      totalRequests: 0,\n      blockedRequests: 0,\n      challengedRequests: 0,\n      monitoredRequests: 0,\n      allowedRequests: 0,\n      averageRiskScore: 0,\n      modelVersion: mlAnomalyDetector.getModelVersion(),\n      isModelTrained: mlAnomalyDetector.isModelTrained(),\n      timestamp: new Date()\n    };\n    \n    return stats;\n  } catch (error: unknown) {\n    console.error('[ProtectionStats] Error:', error);\n    // Preserve stack when rethrowing if it's an Error\n    if (error instanceof Error) throw error;\n    throw new Error(String(error));\n  }\n}\n\n/**\n * Export for use in routes\n */\nexport { ProtectionResult, ChallengeResponse };","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/middleware/csrf-enhanced.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":104,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2607,2610],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2607,2610],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":129,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3163,3166],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3163,3166],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":177,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4272,4275],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4272,4275],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * CSRF Protection Middleware\n * Implements CSRF token generation and validation for state-changing operations\n */\n\nimport { Request, Response, NextFunction } from 'express';\nimport crypto from 'crypto';\n\n// CSRF token storage (in-memory for single instance, Redis recommended for production)\nconst csrfTokens = new Map<string, CSRFToken>();\n\ninterface CSRFToken {\n  token: string;\n  userId: string;\n  expiresAt: number;\n  used: boolean;\n}\n\nconst CSRF_CONFIG = {\n  TOKEN_LENGTH: 32,\n  TOKEN_EXPIRY_MS: 60 * 60 * 1000, // 1 hour\n  HEADER_NAME: 'X-CSRF-Token',\n  COOKIE_NAME: 'csrf_token',\n  SECRET_LENGTH: 64,\n};\n\n/**\n * Generate a CSRF token for a user session\n */\nexport function generateCSRFToken(userId: string): string {\n  const token = crypto.randomBytes(CSRF_CONFIG.TOKEN_LENGTH).toString('hex');\n  const secret = crypto.randomBytes(CSRF_CONFIG.SECRET_LENGTH).toString('hex');\n  const expiresAt = Date.now() + CSRF_CONFIG.TOKEN_EXPIRY_MS;\n\n  const csrfToken: CSRFToken = {\n    token: `${token}.${secret}`,\n    userId,\n    expiresAt,\n    used: false,\n  };\n\n  csrfTokens.set(token, csrfToken);\n\n  // Clean up expired tokens\n  cleanupExpiredTokens();\n\n  return csrfToken.token;\n}\n\n/**\n * Validate a CSRF token\n */\nexport function validateCSRFToken(token: string, userId: string): boolean {\n  try {\n    if (!token || !userId) return false;\n\n    const [tokenId, secret] = token.split('.');\n    if (!tokenId || !secret) return false;\n\n    const csrfToken = csrfTokens.get(tokenId);\n    if (!csrfToken) return false;\n\n    // Check if token matches and hasn't been used\n    if (csrfToken.token !== token) return false;\n    if (csrfToken.userId !== userId) return false;\n    if (csrfToken.used) return false;\n    if (Date.now() > csrfToken.expiresAt) return false;\n\n    // Mark token as used (one-time use)\n    csrfToken.used = true;\n\n    return true;\n  } catch (error) {\n    console.error('CSRF validation error:', error);\n    return false;\n  }\n}\n\n/**\n * CSRF middleware for state-changing operations\n */\nexport function csrfProtection(\n  req: Request,\n  res: Response,\n  next: NextFunction\n): void {\n  // Skip CSRF for GET, HEAD, OPTIONS requests\n  if (['GET', 'HEAD', 'OPTIONS'].includes(req.method)) {\n    next();\n    return;\n  }\n\n  // Check for CSRF token in header\n  const csrfToken = req.headers[CSRF_CONFIG.HEADER_NAME.toLowerCase()];\n  if (!csrfToken || typeof csrfToken !== 'string') {\n    res.status(403).json({\n      error: 'CSRF token required',\n      message: 'Please include X-CSRF-Token header',\n    });\n    return;\n  }\n\n  // Get user ID from authenticated request\n  const userId = (req as any).user?.id;\n  if (!userId) {\n    res.status(401).json({\n      error: 'Authentication required',\n      message: 'Please authenticate before performing this action',\n    });\n    return;\n  }\n\n  // Validate CSRF token\n  if (!validateCSRFToken(csrfToken, userId)) {\n    res.status(403).json({\n      error: 'Invalid CSRF token',\n      message: 'Please refresh the page and try again',\n    });\n    return;\n  }\n\n  next();\n}\n\n/**\n * Generate CSRF token endpoint\n */\nexport function csrfTokenEndpoint(req: Request, res: Response): void {\n  const userId = (req as any).user?.id;\n  if (!userId) {\n    res.status(401).json({ error: 'Authentication required' });\n    return;\n  }\n\n  const token = generateCSRFToken(userId);\n\n  // Set CSRF token in cookie for client-side access\n  res.cookie(CSRF_CONFIG.COOKIE_NAME, token, {\n    httpOnly: false, // Allow client-side JavaScript to read for AJAX requests\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'strict',\n    maxAge: CSRF_CONFIG.TOKEN_EXPIRY_MS,\n  });\n\n  res.json({\n    token,\n    expiresAt: Date.now() + CSRF_CONFIG.TOKEN_EXPIRY_MS,\n  });\n}\n\n/**\n * Clean up expired CSRF tokens\n */\nfunction cleanupExpiredTokens(): void {\n  const now = Date.now();\n  for (const [tokenId, token] of csrfTokens.entries()) {\n    if (now > token.expiresAt) {\n      csrfTokens.delete(tokenId);\n    }\n  }\n}\n\n/**\n * Enhanced CSRF protection with double-submit cookie pattern\n */\nexport function enhancedCSRFProtection(\n  req: Request,\n  res: Response,\n  next: NextFunction\n): void {\n  // Skip CSRF for safe methods\n  if (['GET', 'HEAD', 'OPTIONS'].includes(req.method)) {\n    next();\n    return;\n  }\n\n  const userId = (req as any).user?.id;\n  if (!userId) {\n    res.status(401).json({ error: 'Authentication required' });\n    return;\n  }\n\n  // Check both header and cookie (double-submit pattern)\n  const headerToken = req.headers[CSRF_CONFIG.HEADER_NAME.toLowerCase()];\n  const cookieToken = req.cookies?.[CSRF_CONFIG.COOKIE_NAME];\n\n  if (!headerToken || !cookieToken) {\n    res.status(403).json({\n      error: 'CSRF tokens required',\n      message: 'Please include both X-CSRF-Token header and CSRF cookie',\n    });\n    return;\n  }\n\n  // Both tokens must match\n  if (headerToken !== cookieToken) {\n    res.status(403).json({\n      error: 'CSRF token mismatch',\n      message: 'Header and cookie tokens do not match',\n    });\n    return;\n  }\n\n  // Validate the token\n  if (!validateCSRFToken(headerToken as string, userId)) {\n    res.status(403).json({\n      error: 'Invalid CSRF token',\n      message: 'Token is invalid or expired',\n    });\n    return;\n  }\n\n  next();\n}\n\n/**\n * CORS configuration for CSRF protection\n */\nexport const csrfCorsConfig = {\n  origin (origin: string, callback: Function) {\n    // Allow same-origin requests\n    if (!origin) return callback(null, true);\n\n    // Allow specific origins in development\n    const allowedOrigins = [\n      'http://localhost:3000',\n      'http://localhost:5173',\n      'http://localhost:5174',\n      'http://localhost:5175',\n    ];\n\n    if (\n      process.env.NODE_ENV === 'development' &&\n      allowedOrigins.includes(origin)\n    ) {\n      return callback(null, true);\n    }\n\n    // In production, only allow exact matches\n    if (process.env.NODE_ENV === 'production') {\n      // Add your production domains here\n      return callback(null, true);\n    }\n\n    callback(new Error('Not allowed by CORS'));\n  },\n  credentials: true,\n  methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],\n  allowedHeaders: ['Content-Type', 'Authorization', 'X-CSRF-Token'],\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/middleware/csrf.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2602,2605],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2602,2605],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":128,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3158,3161],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3158,3161],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":175,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4262,4265],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4262,4265],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * CSRF Protection Middleware\n * Implements CSRF token generation and validation for state-changing operations\n */\n\nimport { Request, Response, NextFunction } from 'express';\nimport crypto from 'crypto';\n\n// CSRF token storage (in-memory for single instance, Redis recommended for production)\nconst csrfTokens = new Map<string, CSRFToken>();\n\ninterface CSRFToken {\n  token: string;\n  userId: string;\n  expiresAt: number;\n  used: boolean;\n}\n\nconst CSRF_CONFIG = {\n  TOKEN_LENGTH: 32,\n  TOKEN_EXPIRY_MS: 60 * 60 * 1000, // 1 hour\n  HEADER_NAME: 'X-CSRF-Token',\n  COOKIE_NAME: 'csrf_token',\n  SECRET_LENGTH: 64,\n};\n\n/**\n * Generate a CSRF token for a user session\n */\nexport function generateCSRFToken(userId: string): string {\n  const token = crypto.randomBytes(CSRF_CONFIG.TOKEN_LENGTH).toString('hex');\n  const secret = crypto.randomBytes(CSRF_CONFIG.SECRET_LENGTH).toString('hex');\n  const expiresAt = Date.now() + CSRF_CONFIG.TOKEN_EXPIRY_MS;\n\n  const csrfToken: CSRFToken = {\n    token: `${token}.${secret}`,\n    userId,\n    expiresAt,\n    used: false,\n  };\n\n  csrfTokens.set(token, csrfToken);\n\n  // Clean up expired tokens\n  cleanupExpiredTokens();\n\n  return csrfToken.token;\n}\n\n/**\n * Validate a CSRF token\n */\nexport function validateCSRFToken(token: string, userId: string): boolean {\n  try {\n    if (!token || !userId) return false;\n\n    const [tokenId, secret] = token.split('.');\n    if (!tokenId || !secret) return false;\n\n    const csrfToken = csrfTokens.get(tokenId);\n    if (!csrfToken) return false;\n\n    // Check if token matches and hasn't been used\n    if (csrfToken.token !== token) return false;\n    if (csrfToken.userId !== userId) return false;\n    if (csrfToken.used) return false;\n    if (Date.now() > csrfToken.expiresAt) return false;\n\n    // Mark token as used (one-time use)\n    csrfToken.used = true;\n\n    return true;\n  } catch (error) {\n    console.error('CSRF validation error:', error);\n    return false;\n  }\n}\n\n/**\n * CSRF middleware for state-changing operations\n */\nexport function csrfProtection(\n  req: Request,\n  res: Response,\n  next: NextFunction\n): void {\n  // Skip CSRF for GET, HEAD, OPTIONS requests\n  if (['GET', 'HEAD', 'OPTIONS'].includes(req.method)) {\n    return next();\n  }\n\n  // Check for CSRF token in header\n  const csrfToken = req.headers[CSRF_CONFIG.HEADER_NAME.toLowerCase()];\n  if (!csrfToken || typeof csrfToken !== 'string') {\n    res.status(403).json({\n      error: 'CSRF token required',\n      message: 'Please include X-CSRF-Token header',\n    });\n    return;\n  }\n\n  // Get user ID from authenticated request\n  const userId = (req as any).user?.id;\n  if (!userId) {\n    res.status(401).json({\n      error: 'Authentication required',\n      message: 'Please authenticate before performing this action',\n    });\n    return;\n  }\n\n  // Validate CSRF token\n  if (!validateCSRFToken(csrfToken, userId)) {\n    res.status(403).json({\n      error: 'Invalid CSRF token',\n      message: 'Please refresh the page and try again',\n    });\n    return;\n  }\n\n  next();\n}\n\n/**\n * Generate CSRF token endpoint\n */\nexport function csrfTokenEndpoint(req: Request, res: Response): void {\n  const userId = (req as any).user?.id;\n  if (!userId) {\n    res.status(401).json({ error: 'Authentication required' });\n    return;\n  }\n\n  const token = generateCSRFToken(userId);\n\n  // Set CSRF token in cookie for client-side access\n  res.cookie(CSRF_CONFIG.COOKIE_NAME, token, {\n    httpOnly: false, // Allow client-side JavaScript to read for AJAX requests\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'strict',\n    maxAge: CSRF_CONFIG.TOKEN_EXPIRY_MS,\n  });\n\n  res.json({\n    token,\n    expiresAt: Date.now() + CSRF_CONFIG.TOKEN_EXPIRY_MS,\n  });\n}\n\n/**\n * Clean up expired CSRF tokens\n */\nfunction cleanupExpiredTokens(): void {\n  const now = Date.now();\n  for (const [tokenId, token] of csrfTokens.entries()) {\n    if (now > token.expiresAt) {\n      csrfTokens.delete(tokenId);\n    }\n  }\n}\n\n/**\n * Enhanced CSRF protection with double-submit cookie pattern\n */\nexport function enhancedCSRFProtection(\n  req: Request,\n  res: Response,\n  next: NextFunction\n): void {\n  // Skip CSRF for safe methods\n  if (['GET', 'HEAD', 'OPTIONS'].includes(req.method)) {\n    return next();\n  }\n\n  const userId = (req as any).user?.id;\n  if (!userId) {\n    res.status(401).json({ error: 'Authentication required' });\n    return;\n  }\n\n  // Check both header and cookie (double-submit pattern)\n  const headerToken = req.headers[CSRF_CONFIG.HEADER_NAME.toLowerCase()];\n  const cookieToken = req.cookies?.[CSRF_CONFIG.COOKIE_NAME];\n\n  if (!headerToken || !cookieToken) {\n    res.status(403).json({\n      error: 'CSRF tokens required',\n      message: 'Please include both X-CSRF-Token header and CSRF cookie',\n    });\n    return;\n  }\n\n  // Both tokens must match\n  if (headerToken !== cookieToken) {\n    res.status(403).json({\n      error: 'CSRF token mismatch',\n      message: 'Header and cookie tokens do not match',\n    });\n    return;\n  }\n\n  // Validate the token\n  if (!validateCSRFToken(headerToken as string, userId)) {\n    res.status(403).json({\n      error: 'Invalid CSRF token',\n      message: 'Token is invalid or expired',\n    });\n    return;\n  }\n\n  next();\n}\n\n/**\n * CORS configuration for CSRF protection\n */\nexport const csrfCorsConfig = {\n  origin (origin: string, callback: Function) {\n    // Allow same-origin requests\n    if (!origin) return callback(null, true);\n\n    // Allow specific origins in development\n    const allowedOrigins = [\n      'http://localhost:3000',\n      'http://localhost:5173',\n      'http://localhost:5174',\n      'http://localhost:5175',\n    ];\n\n    if (\n      process.env.NODE_ENV === 'development' &&\n      allowedOrigins.includes(origin)\n    ) {\n      return callback(null, true);\n    }\n\n    // In production, only allow exact matches\n    if (process.env.NODE_ENV === 'production') {\n      // Add your production domains here\n      return callback(null, true);\n    }\n\n    callback(new Error('Not allowed by CORS'));\n  },\n  credentials: true,\n  methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],\n  allowedHeaders: ['Content-Type', 'Authorization', 'X-CSRF-Token'],\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/middleware/enhanced-protection.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'advancedProtectionMiddleware' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":38},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":65,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1823,1826],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1823,1826],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1851,1854],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1851,1854],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1871,1874],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1871,1874],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1895,1898],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1895,1898],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1994,1997],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1994,1997],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":118,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3270,3273],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3270,3273],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":133,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3861,3864],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3861,3864],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":149,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4187,4190],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4187,4190],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":169,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":169,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4756,4759],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4756,4759],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":193,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5446,5449],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5446,5449],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":199,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":199,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5564,5567],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5564,5567],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":214,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":214,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6038,6041],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6038,6041],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":217,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":217,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6130,6133],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6130,6133],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":240,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":240,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6663,6666],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6663,6666],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":241,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":241,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6685,6688],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6685,6688],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":242,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":242,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6699,6702],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6699,6702],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":243,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":243,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6717,6720],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6717,6720],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":344,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":344,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10498,10501],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10498,10501],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":366,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":366,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11017,11020],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11017,11020],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":440,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":440,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13080,13083],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13080,13083],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":484,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":484,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14492,14495],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14492,14495],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":506,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":506,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15026,15029],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15026,15029],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":531,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":531,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15914,15917],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15914,15917],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":621,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":621,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18844,18847],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18844,18847],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":637,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":637,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19277,19280],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19277,19280],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":652,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":652,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19724,19727],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19724,19727],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":668,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":668,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20084,20087],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20084,20087],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":758,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":758,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22602,22605],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22602,22605],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":759,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":759,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22645,22648],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22645,22648],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":768,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":768,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23009,23012],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23009,23012],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":785,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":785,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23514,23517],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23514,23517],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":809,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":809,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24093,24096],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24093,24096],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sessionId' is defined but never used. Allowed unused args must match /^_/u.","line":809,"column":64,"nodeType":null,"messageId":"unusedVar","endLine":809,"endColumn":73},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":842,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":842,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25042,25045],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25042,25045],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":851,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":851,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25366,25369],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25366,25369],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":864,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":864,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25782,25785],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25782,25785],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":872,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":872,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25986,25989],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25986,25989],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":883,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":883,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26315,26318],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26315,26318],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":921,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":921,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27499,27502],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27499,27502],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":40,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Enhanced Protection Middleware with Threat Intelligence\n * \n * Integrates external threat feeds with behavioral analysis\n * for comprehensive advanced threat protection\n */\n\nimport { Request, Response, NextFunction } from 'express';\nimport { advancedProtectionMiddleware } from './advanced-protection';\nimport { threatIntelligenceService } from '../monitoring/production-validation';\nimport { mlAnomalyDetector } from '../monitoring/ml-anomaly-detection';\nimport { securityEventLogger } from '../monitoring/security-events';\nimport { securityAlertManager } from '../monitoring/security-alerts';\n\n// Enhanced protection configuration\nconst ENHANCED_PROTECTION_CONFIG = {\n  // Feature flags\n  THREAT_INTELLIGENCE: true,\n  BEHAVIORAL_ANALYSIS: true,\n  ADVANCED_ML: true,\n  REAL_TIME_UPDATES: true,\n  \n  // Risk thresholds\n  CRITICAL_RISK_THRESHOLD: 85,\n  HIGH_RISK_THRESHOLD: 70,\n  MEDIUM_RISK_THRESHOLD: 50,\n  LOW_RISK_THRESHOLD: 30,\n  \n  // Response actions\n  ACTIONS: {\n    ALLOW: 'allow',\n    CHALLENGE_EASY: 'challenge_easy',\n    CHALLENGE_MEDIUM: 'challenge_medium',\n    CHALLENGE_HARD: 'challenge_hard',\n    BLOCK_TEMPORARY: 'block_temporary',\n    BLOCK_PERMANENT: 'block_permanent',\n    MONITOR: 'monitor'\n  },\n  \n  // Challenge types\n  CHALLENGES: {\n    CAPTCHA: 'captcha',\n    BEHAVIORAL: 'behavioral',\n    DELAY: 'delay',\n    MFA: 'mfa',\n    RATE_LIMIT: 'rate_limit',\n    DEVICE_VERIFICATION: 'device_verification'\n  },\n  \n  // Feature weights for risk calculation\n  WEIGHTS: {\n    threatIntelligence: 0.35,\n    behavioralAnalysis: 0.25,\n    mlAnomalyDetection: 0.25,\n    deviceFingerprint: 0.15\n  }\n};\n\n// Enhanced protection result\ninterface EnhancedProtectionResult {\n  action: string;\n  confidence: number;\n  riskScore: number;\n  riskLevel: 'low' | 'medium' | 'high' | 'critical';\n  threatIntelligence?: any;\n  behavioralAnalysis?: any;\n  mlAnalysis?: any;\n  deviceAnalysis?: any;\n  reasons: string[];\n  recommendations: string[];\n  challengeType?: string;\n  challengeData?: any;\n  incidentId?: string;\n  requiresVerification?: boolean;\n}\n\n/**\n * Enhanced protection middleware\n */\nexport async function enhancedProtectionMiddleware(\n  req: Request,\n  res: Response,\n  next: NextFunction\n): Promise<void> {\n  try {\n    // Skip if protection is disabled\n    if (!shouldApplyProtection(req)) {\n      return next();\n    }\n\n    console.log(`[EnhancedProtection] Processing request from ${req.ip}`);\n\n    // Gather all protection data in parallel\n    const [\n      threatIntel,\n      behavioralData,\n      mlAnalysis,\n      deviceAnalysis\n    ] = await Promise.allSettled([\n      gatherThreatIntelligence(req),\n      gatherBehavioralAnalysis(req),\n      gatherMLAnalysis(req),\n      gatherDeviceAnalysis(req)\n    ]);\n\n    // Calculate comprehensive risk assessment\n    const protectionResult = await calculateEnhancedRisk(\n      req,\n      {\n        threatIntel: threatIntel.status === 'fulfilled' ? threatIntel.value : null,\n        behavioral: behavioralData.status === 'fulfilled' ? behavioralData.value : null,\n        ml: mlAnalysis.status === 'fulfilled' ? mlAnalysis.value : null,\n        device: deviceAnalysis.status === 'fulfilled' ? deviceAnalysis.value : null\n      }\n    );\n\n    // Store protection result in request for later use\n    (req as any).enhancedProtectionResult = protectionResult;\n\n    // Execute protection action\n    await executeEnhancedProtectionAction(req, res, next, protectionResult);\n\n  } catch (error) {\n    console.error('[EnhancedProtection] Critical error:', error);\n    \n    // On critical error, allow request but log extensively\n    await securityEventLogger.logEvent({\n      event: 'enhanced_protection_critical_error',\n      severity: 'critical',\n      timestamp: new Date(),\n      source: 'enhanced_protection',\n      ipAddress: req.ip || req.connection.remoteAddress || 'unknown',\n      userId: (req as any).user?.id,\n      details: {\n        error: error.message,\n        stack: error.stack,\n        fallbackAction: 'allow'\n      }\n    });\n\n    // Allow request to continue on protection failure\n    return next();\n  }\n}\n\n/**\n * Gather threat intelligence data\n */\nasync function gatherThreatIntelligence(req: Request): Promise<any> {\n  if (!ENHANCED_PROTECTION_CONFIG.THREAT_INTELLIGENCE) {\n    return null;\n  }\n\n  try {\n    const threatIntel = await threatIntelligenceService.checkThreatIntelligence(req);\n    \n    console.log(`[EnhancedProtection] Threat intelligence: ${threatIntel.riskScore}/100 (${threatIntel.threatLevel})`);\n    \n    return threatIntel;\n  } catch (error) {\n    console.warn('[EnhancedProtection] Threat intelligence failed:', error.message);\n    return null;\n  }\n}\n\n/**\n * Gather behavioral analysis data\n */\nasync function gatherBehavioralAnalysis(req: Request): Promise<any> {\n  if (!ENHANCED_PROTECTION_CONFIG.BEHAVIORAL_ANALYSIS) {\n    return null;\n  }\n\n  try {\n    // Get behavioral data from client if available\n    const clientBehavioralData = req.body.behavioralData;\n    \n    if (clientBehavioralData) {\n      console.log(`[EnhancedProtection] Received behavioral analysis: score=${clientBehavioralData.behavioralScore}, human=${clientBehavioralData.isHuman}`);\n      return clientBehavioralData;\n    }\n    \n    return null;\n  } catch (error) {\n    console.warn('[EnhancedProtection] Behavioral analysis failed:', error.message);\n    return null;\n  }\n}\n\n/**\n * Gather ML anomaly detection data\n */\nasync function gatherMLAnalysis(req: Request): Promise<any> {\n  if (!ENHANCED_PROTECTION_CONFIG.ADVANCED_ML) {\n    return null;\n  }\n\n  try {\n    const fingerprint = (req as any).protectionResult?.fingerprint;\n    const mlResult = await mlAnomalyDetector.detectUploadAnomaly(req, fingerprint);\n    \n    console.log(`[EnhancedProtection] ML analysis: ${mlResult.riskScore}/100 (${mlResult.riskLevel})`);\n    \n    return mlResult;\n  } catch (error) {\n    console.warn('[EnhancedProtection] ML analysis failed:', error.message);\n    return null;\n  }\n}\n\n/**\n * Gather device analysis data\n */\nasync function gatherDeviceAnalysis(req: Request): Promise<any> {\n  try {\n    // Use existing device fingerprinting\n    const existingResult = (req as any).protectionResult;\n    \n    if (existingResult?.fingerprint) {\n      return {\n        fingerprint: existingResult.fingerprint,\n        deviceTracking: existingResult.fingerprintTracking,\n        analysis: existingResult.anomalyResult\n      };\n    }\n    \n    return null;\n  } catch (error) {\n    console.warn('[EnhancedProtection] Device analysis failed:', error.message);\n    return null;\n  }\n}\n\n/**\n * Calculate comprehensive risk assessment\n */\nasync function calculateEnhancedRisk(\n  req: Request,\n  data: {\n    threatIntel?: any;\n    behavioral?: any;\n    ml?: any;\n    device?: any;\n  }\n): Promise<EnhancedProtectionResult> {\n  let totalRiskScore = 0;\n  let confidence = 0;\n  const reasons: string[] = [];\n  const recommendations: string[] = [];\n  let maxThreatLevel: 'low' | 'medium' | 'high' | 'critical' = 'low';\n\n  // 1. Threat Intelligence Analysis (35% weight)\n  if (data.threatIntel) {\n    const threatScore = data.threatIntel.riskScore * ENHANCED_PROTECTION_CONFIG.WEIGHTS.threatIntelligence;\n    totalRiskScore += threatScore;\n    confidence += 0.25;\n    maxThreatLevel = getMaxThreatLevel(maxThreatLevel, data.threatIntel.threatLevel);\n    \n    reasons.push(...data.threatIntel.sources.map(source => `Threat intelligence: ${source}`));\n    recommendations.push(...data.threatIntel.recommendations);\n    \n    console.log(`[EnhancedProtection] Threat intel contribution: ${threatScore.toFixed(1)} points`);\n  }\n\n  // 2. Behavioral Analysis (25% weight)\n  if (data.behavioral) {\n    const behavioralScore = calculateBehavioralRiskScore(data.behavioral);\n    const weightedScore = behavioralScore * ENHANCED_PROTECTION_CONFIG.WEIGHTS.behavioralAnalysis;\n    totalRiskScore += weightedScore;\n    confidence += 0.25;\n    \n    if (!data.behavioral.isHuman) {\n      maxThreatLevel = getMaxThreatLevel(maxThreatLevel, 'high');\n      reasons.push('Behavioral analysis indicates automated behavior');\n      recommendations.push('Monitor for continued automated patterns');\n    }\n    \n    console.log(`[EnhancedProtection] Behavioral analysis contribution: ${weightedScore.toFixed(1)} points`);\n  }\n\n  // 3. ML Anomaly Detection (25% weight)\n  if (data.ml) {\n    const mlScore = data.ml.riskScore * ENHANCED_PROTECTION_CONFIG.WEIGHTS.mlAnomalyDetection;\n    totalRiskScore += mlScore;\n    confidence += 0.25;\n    maxThreatLevel = getMaxThreatLevel(maxThreatLevel, data.ml.riskLevel);\n    \n    reasons.push(...data.ml.contributingFactors);\n    recommendations.push(...data.ml.recommendations);\n    \n    console.log(`[EnhancedProtection] ML analysis contribution: ${mlScore.toFixed(1)} points`);\n  }\n\n  // 4. Device Fingerprinting (15% weight)\n  if (data.device) {\n    const deviceScore = calculateDeviceRiskScore(data.device);\n    const weightedScore = deviceScore * ENHANCED_PROTECTION_CONFIG.WEIGHTS.deviceFingerprint;\n    totalRiskScore += weightedScore;\n    confidence += 0.15;\n    \n    if (data.device.fingerprint?.anomalies?.length > 0) {\n      reasons.push(...data.device.fingerprint.anomalies);\n    }\n    \n    console.log(`[EnhancedProtection] Device analysis contribution: ${weightedScore.toFixed(1)} points`);\n  }\n\n  // Normalize confidence\n  confidence = Math.min(1.0, confidence + 0.1); // Boost confidence slightly\n\n  // Normalize risk score\n  totalRiskScore = Math.min(100, Math.round(totalRiskScore));\n\n  // Determine final threat level\n  const finalThreatLevel = maxThreatLevel !== 'low' ? maxThreatLevel : getRiskLevel(totalRiskScore);\n\n  // Determine protection action\n  const action = determineProtectionAction(totalRiskScore, finalThreatLevel, confidence);\n  const challengeType = determineChallengeType(totalRiskScore, finalThreatLevel, data);\n\n  // Generate incident ID for tracking\n  const incidentId = `INC_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n\n  return {\n    action,\n    confidence,\n    riskScore: totalRiskScore,\n    riskLevel: finalThreatLevel,\n    threatIntelligence: data.threatIntel,\n    behavioralAnalysis: data.behavioral,\n    mlAnalysis: data.ml,\n    deviceAnalysis: data.device,\n    reasons: [...new Set(reasons)], // Remove duplicates\n    recommendations: [...new Set(recommendations)],\n    challengeType,\n    incidentId,\n    requiresVerification: action !== ENHANCED_PROTECTION_CONFIG.ACTIONS.ALLOW\n  };\n}\n\n/**\n * Calculate behavioral risk score\n */\nfunction calculateBehavioralRiskScore(behavioralData: any): number {\n  if (!behavioralData) return 0;\n  \n  let riskScore = 0;\n  \n  // Base score on behavioral score\n  riskScore += (100 - behavioralData.behavioralScore) * 0.8;\n  \n  // Adjust for confidence level\n  riskScore *= (1.5 - behavioralData.confidence);\n  \n  // Additional risk factors\n  if (!behavioralData.isHuman) {\n    riskScore += 25; // Significant boost for non-human detection\n  }\n  \n  return Math.min(100, riskScore);\n}\n\n/**\n * Calculate device risk score\n */\nfunction calculateDeviceRiskScore(deviceData: any): number {\n  if (!deviceData) return 0;\n  \n  let riskScore = 0;\n  \n  // Fingerprint confidence\n  if (deviceData.fingerprint) {\n    riskScore += (1 - deviceData.fingerprint.confidence) * 30;\n  }\n  \n  // Device tracking anomalies\n  if (deviceData.deviceTracking) {\n    if (deviceData.deviceTracking.isNewDevice) {\n      riskScore += 10;\n    }\n    if (deviceData.deviceTracking.previousSessions > 10) {\n      riskScore += 15;\n    }\n  }\n  \n  // ML analysis results\n  if (deviceData.analysis) {\n    riskScore += deviceData.analysis.riskScore * 0.3;\n  }\n  \n  return Math.min(100, riskScore);\n}\n\n/**\n * Determine protection action\n */\nfunction determineProtectionAction(\n  riskScore: number,\n  threatLevel: string,\n  confidence: number\n): string {\n  // High confidence decisions\n  if (confidence > 0.8) {\n    if (riskScore >= ENHANCED_PROTECTION_CONFIG.CRITICAL_RISK_THRESHOLD) {\n      return ENHANCED_PROTECTION_CONFIG.ACTIONS.BLOCK_TEMPORARY;\n    }\n    if (riskScore >= ENHANCED_PROTECTION_CONFIG.HIGH_RISK_THRESHOLD) {\n      return ENHANCED_PROTECTION_CONFIG.ACTIONS.CHALLENGE_HARD;\n    }\n    if (riskScore >= ENHANCED_PROTECTION_CONFIG.MEDIUM_RISK_THRESHOLD) {\n      return ENHANCED_PROTECTION_CONFIG.ACTIONS.CHALLENGE_MEDIUM;\n    }\n    if (riskScore >= ENHANCED_PROTECTION_CONFIG.LOW_RISK_THRESHOLD) {\n      return ENHANCED_PROTECTION_CONFIG.ACTIONS.CHALLENGE_EASY;\n    }\n    return ENHANCED_PROTECTION_CONFIG.ACTIONS.ALLOW;\n  }\n  \n  // Medium confidence - more conservative\n  if (confidence > 0.5) {\n    if (riskScore >= ENHANCED_PROTECTION_CONFIG.HIGH_RISK_THRESHOLD) {\n      return ENHANCED_PROTECTION_CONFIG.ACTIONS.CHALLENGE_MEDIUM;\n    }\n    if (riskScore >= ENHANCED_PROTECTION_CONFIG.MEDIUM_RISK_THRESHOLD) {\n      return ENHANCED_PROTECTION_CONFIG.ACTIONS.CHALLENGE_EASY;\n    }\n    return ENHANCED_PROTECTION_CONFIG.ACTIONS.MONITOR;\n  }\n  \n  // Low confidence - monitor only\n  return ENHANCED_PROTECTION_CONFIG.ACTIONS.MONITOR;\n}\n\n/**\n * Determine challenge type\n */\nfunction determineChallengeType(\n  riskScore: number,\n  threatLevel: string,\n  data: any\n): string {\n  // Behavioral challenges for sophisticated threats\n  if (data.behavioral && !data.behavioral.isHuman) {\n    return ENHANCED_PROTECTION_CONFIG.CHALLENGES.BEHAVIORAL;\n  }\n  \n  // CAPTCHA for high-risk automated behavior\n  if (riskScore >= ENHANCED_PROTECTION_CONFIG.HIGH_RISK_THRESHOLD) {\n    return ENHANCED_PROTECTION_CONFIG.CHALLENGES.CAPTCHA;\n  }\n  \n  // Device verification for suspicious devices\n  if (data.device && data.device.fingerprint?.confidence < 0.5) {\n    return ENHANCED_PROTECTION_CONFIG.CHALLENGES.DEVICE_VERIFICATION;\n  }\n  \n  // Delay challenges for medium risk\n  if (riskScore >= ENHANCED_PROTECTION_CONFIG.MEDIUM_RISK_THRESHOLD) {\n    return ENHANCED_PROTECTION_CONFIG.CHALLENGES.DELAY;\n  }\n  \n  // Rate limiting for low-medium risk\n  return ENHANCED_PROTECTION_CONFIG.CHALLENGES.RATE_LIMIT;\n}\n\n/**\n * Execute enhanced protection action\n */\nasync function executeEnhancedProtectionAction(\n  req: Request,\n  res: Response,\n  next: NextFunction,\n  result: EnhancedProtectionResult\n): Promise<void> {\n  const { action, riskScore, riskLevel, reasons, confidence, incidentId } = result;\n\n  // Log the protection decision\n  await securityEventLogger.logEvent({\n    event: 'enhanced_protection_decision',\n    severity: riskLevel,\n    timestamp: new Date(),\n    source: 'enhanced_protection',\n    ipAddress: req.ip || req.connection.remoteAddress || 'unknown',\n    userId: (req as any).user?.id,\n    details: {\n      action,\n      riskScore,\n      riskLevel,\n      confidence,\n      reasons,\n      recommendations: result.recommendations,\n      incidentId,\n      threatIntel: result.threatIntelligence,\n      behavioral: result.behavioralAnalysis,\n      ml: result.mlAnalysis,\n      device: result.deviceAnalysis\n    }\n  });\n\n  // Execute based on action\n  switch (action) {\n    case ENHANCED_PROTECTION_CONFIG.ACTIONS.ALLOW:\n      return next();\n\n    case ENHANCED_PROTECTION_CONFIG.ACTIONS.MONITOR:\n      (req as any).monitoringRequired = true;\n      return next();\n\n    case ENHANCED_PROTECTION_CONFIG.ACTIONS.CHALLENGE_EASY:\n    case ENHANCED_PROTECTION_CONFIG.ACTIONS.CHALLENGE_MEDIUM:\n    case ENHANCED_PROTECTION_CONFIG.ACTIONS.CHALLENGE_HARD:\n      return await sendEnhancedChallenge(req, res, result);\n\n    case ENHANCED_PROTECTION_CONFIG.ACTIONS.BLOCK_TEMPORARY:\n    case ENHANCED_PROTECTION_CONFIG.ACTIONS.BLOCK_PERMANENT:\n      return await sendEnhancedBlock(req, res, result);\n\n    default:\n      console.warn(`[EnhancedProtection] Unknown action: ${action}`);\n      return next();\n  }\n}\n\n/**\n * Send enhanced challenge response\n */\nasync function sendEnhancedChallenge(req: Request, res: Response, result: EnhancedProtectionResult): Promise<void> {\n  const { challengeType, riskScore, reasons, incidentId } = result;\n\n  // Generate appropriate challenge based on type\n  let challengeData: any = {};\n  \n  switch (challengeType) {\n    case ENHANCED_PROTECTION_CONFIG.CHALLENGES.BEHAVIORAL:\n      challengeData = generateBehavioralChallenge();\n      break;\n    case ENHANCED_PROTECTION_CONFIG.CHALLENGES.CAPTCHA:\n      challengeData = generateCaptchaChallenge(riskScore);\n      break;\n    case ENHANCED_PROTECTION_CONFIG.CHALLENGES.DEVICE_VERIFICATION:\n      challengeData = generateDeviceVerificationChallenge();\n      break;\n    default:\n      challengeData = generateStandardChallenge(challengeType, riskScore);\n  }\n\n  res.status(403).json({\n    error: 'Security verification required',\n    challenge: {\n      type: challengeType,\n      difficulty: getChallengeDifficulty(riskScore),\n      data: challengeData,\n      reasons: reasons.slice(0, 2), // Show top 2 reasons\n      incidentId,\n      instructions: getEnhancedChallengeInstructions(challengeType)\n    },\n    retryAfter: getChallengeRetryAfter(challengeType, riskScore)\n  });\n}\n\n/**\n * Send enhanced block response\n */\nasync function sendEnhancedBlock(req: Request, res: Response, result: EnhancedProtectionResult): Promise<void> {\n  const { riskScore, reasons, recommendations, incidentId, threatIntelligence } = result;\n\n  // Send security alert for blocked request\n  await securityAlertManager.sendAlert({\n    type: 'security_incident',\n    severity: 'critical',\n    title: 'Advanced Threat Blocked',\n    message: `Request blocked with risk score ${riskScore}/100 using enhanced protection`,\n    details: {\n      reasons,\n      recommendations,\n      threatIntelligence,\n      incidentId,\n      ipAddress: req.ip || req.connection.remoteAddress,\n      userAgent: req.headers['user-agent'],\n      timestamp: new Date().toISOString()\n    },\n    metadata: {\n      category: 'enhanced_protection',\n      tags: ['blocked', 'critical_risk', 'advanced_threat']\n    }\n  });\n\n  // Report malicious IP if threat intelligence indicates\n  if (threatIntelligence && threatIntelligence.riskScore > 80) {\n    await threatIntelligenceService.reportMaliciousIP(\n      threatIntelligence.ipAddress,\n      ['automated', 'suspicious'],\n      `Blocked by enhanced protection system - risk score: ${threatIntelligence.riskScore}`\n    );\n  }\n\n  res.status(403).json({\n    error: 'Access denied - Security threat detected',\n    message: 'Your request has been blocked due to advanced security analysis',\n    riskScore,\n    reasons: reasons.slice(0, 3), // Show top 3 reasons\n    recommendations: recommendations.slice(0, 3),\n    supportUrl: '/support/security',\n    incidentId,\n    retryAfter: 3600, // 1 hour\n    additionalInfo: {\n      threatLevel: result.riskLevel,\n      confidence: result.confidence,\n      nextSteps: [\n        'Contact support if you believe this is an error',\n        'Verify your network connection is secure',\n        'Check for malware on your device'\n      ]\n    }\n  });\n}\n\n/**\n * Generate behavioral challenge\n */\nfunction generateBehavioralChallenge(): any {\n  return {\n    type: 'behavioral_verification',\n    instructions: [\n      'Please move your mouse in a natural pattern',\n      'Type a few sentences naturally',\n      'Complete simple touch gestures if on mobile'\n    ],\n    duration: 30000, // 30 seconds\n    requiredActions: ['mouse_movement', 'keystrokes', 'natural_timing']\n  };\n}\n\n/**\n * Generate CAPTCHA challenge\n */\nfunction generateCaptchaChallenge(riskScore: number): any {\n  const difficulty = riskScore > 80 ? 'hard' : riskScore > 60 ? 'medium' : 'easy';\n  \n  return {\n    type: 'captcha',\n    difficulty,\n    siteKey: process.env.RECAPTCHA_SITE_KEY,\n    challengeType: riskScore > 70 ? 'invisible' : 'checkbox',\n    expectedDuration: difficulty === 'hard' ? 60000 : difficulty === 'medium' ? 30000 : 15000\n  };\n}\n\n/**\n * Generate device verification challenge\n */\nfunction generateDeviceVerificationChallenge(): any {\n  return {\n    type: 'device_verification',\n    methods: ['sms', 'email', 'authenticator'],\n    verificationCode: {\n      length: 6,\n      expiresIn: 300000, // 5 minutes\n      maxAttempts: 3\n    },\n    trustedDeviceOption: true\n  };\n}\n\n/**\n * Generate standard challenge\n */\nfunction generateStandardChallenge(challengeType: string, riskScore: number): any {\n  switch (challengeType) {\n    case ENHANCED_PROTECTION_CONFIG.CHALLENGES.DELAY:\n      return {\n        type: 'delay',\n        duration: riskScore > 70 ? 10000 : riskScore > 50 ? 5000 : 2000, // 10s, 5s, or 2s\n        message: 'Please wait while we verify your request...',\n        progressBar: true\n      };\n    \n    case ENHANCED_PROTECTION_CONFIG.CHALLENGES.RATE_LIMIT:\n      return {\n        type: 'rate_limit',\n        maxRequests: riskScore > 70 ? 1 : riskScore > 50 ? 3 : 5,\n        windowMinutes: 1,\n        message: 'Too many requests. Please slow down.'\n      };\n    \n    default:\n      return {\n        type: 'standard',\n        message: 'Please complete the verification to continue.'\n      };\n  }\n}\n\n/**\n * Get challenge difficulty\n */\nfunction getChallengeDifficulty(riskScore: number): string {\n  if (riskScore > 80) return 'hard';\n  if (riskScore > 60) return 'medium';\n  return 'easy';\n}\n\n/**\n * Get challenge retry after time\n */\nfunction getChallengeRetryAfter(challengeType: string, riskScore: number): number {\n  const baseTimes = {\n    'captcha': 30,\n    'behavioral': 60,\n    'device_verification': 300,\n    'delay': 0,\n    'rate_limit': 60\n  };\n  \n  const base = baseTimes[challengeType] || 30;\n  const multiplier = riskScore > 80 ? 2 : riskScore > 60 ? 1.5 : 1;\n  \n  return Math.round(base * multiplier);\n}\n\n/**\n * Get enhanced challenge instructions\n */\nfunction getEnhancedChallengeInstructions(challengeType: string): string {\n  const instructions = {\n    'behavioral': 'Complete natural human interactions to verify you are not automated',\n    'captcha': 'Complete the CAPTCHA challenge to continue',\n    'device_verification': 'Verify your identity using a secondary method',\n    'delay': 'Please wait while we process your request',\n    'rate_limit': 'Reduce your request frequency and try again'\n  };\n  \n  return instructions[challengeType] || 'Complete the security verification to continue';\n}\n\n/**\n * Verify enhanced challenge response\n */\nexport async function verifyEnhancedChallengeResponse(\n  req: Request,\n  res: Response,\n  next: NextFunction\n): Promise<void> {\n  try {\n    const { challengeResponse, sessionId, incidentId } = req.body;\n    \n    if (!challengeResponse || !sessionId) {\n      return res.status(400).json({\n        error: 'Missing challenge response data'\n      });\n    }\n\n    // Verify based on challenge type\n    const isValid = await verifyEnhancedChallenge(challengeResponse, sessionId);\n    \n    if (isValid) {\n      // Challenge passed\n      (req as any).challengePassed = true;\n      (req as any).incidentId = incidentId;\n      \n      // Log successful verification\n      await securityEventLogger.logEvent({\n        event: 'enhanced_challenge_passed',\n        severity: 'low',\n        timestamp: new Date(),\n        source: 'enhanced_challenge_verification',\n        ipAddress: req.ip || req.connection.remoteAddress || 'unknown',\n        userId: (req as any).user?.id,\n        details: {\n          challengeType: challengeResponse.type,\n          sessionId,\n          incidentId\n        }\n      });\n      \n      return next();\n    } else {\n      // Challenge failed\n      await securityEventLogger.logEvent({\n        event: 'enhanced_challenge_failed',\n        severity: 'medium',\n        timestamp: new Date(),\n        source: 'enhanced_challenge_verification',\n        ipAddress: req.ip || req.connection.remoteAddress || 'unknown',\n        userId: (req as any).user?.id,\n        details: {\n          challengeType: challengeResponse.type,\n          sessionId,\n          incidentId\n        }\n      });\n      \n      return res.status(403).json({\n        error: 'Challenge verification failed',\n        retryAfter: 300 // 5 minutes\n      });\n    }\n  } catch (error) {\n    console.error('[EnhancedChallengeVerification] Error:', error);\n    return res.status(500).json({\n      error: 'Challenge verification error'\n    });\n  }\n}\n\n/**\n * Verify enhanced challenge based on type\n */\nasync function verifyEnhancedChallenge(challengeResponse: any, sessionId: string): Promise<boolean> {\n  try {\n    const { type } = challengeResponse;\n    \n    switch (type) {\n      case 'captcha':\n        return verifyCaptchaChallenge(challengeResponse);\n      \n      case 'behavioral':\n        return verifyBehavioralChallenge(challengeResponse);\n      \n      case 'device_verification':\n        return verifyDeviceChallenge(challengeResponse);\n      \n      case 'delay':\n        return verifyDelayChallenge(challengeResponse);\n      \n      case 'rate_limit':\n        return verifyRateLimitChallenge(challengeResponse);\n      \n      default:\n        // Standard verification for unknown types\n        return challengeResponse.completed === true || challengeResponse.acknowledged === true;\n    }\n  } catch (error) {\n    console.error('[EnhancedChallengeVerification] Verification failed:', error);\n    return false;\n  }\n}\n\n/**\n * Verify CAPTCHA challenge\n */\nasync function verifyCaptchaChallenge(response: any): Promise<boolean> {\n  // This would integrate with actual CAPTCHA verification service\n  // For now, validate token format and basic checks\n  return response.token && response.token.length > 20 && response.completed === true;\n}\n\n/**\n * Verify behavioral challenge\n */\nasync function verifyBehavioralChallenge(response: any): Promise<boolean> {\n  // Verify behavioral data shows human patterns\n  if (!response.behavioralData) return false;\n  \n  const { behavioralScore, isHuman, confidence } = response.behavioralData;\n  \n  // Must show improvement in human behavior\n  return isHuman === true && behavioralScore > 60 && confidence > 0.7;\n}\n\n/**\n * Verify device verification challenge\n */\nasync function verifyDeviceChallenge(response: any): Promise<boolean> {\n  // Verify verification code\n  return response.verificationCode && response.verified === true;\n}\n\n/**\n * Verify delay challenge\n */\nasync function verifyDelayChallenge(response: any): Promise<boolean> {\n  // Verify minimum delay was observed\n  const minimumDelay = response.minimumDelay || 2000;\n  const actualDelay = response.actualDelay || 0;\n  \n  return actualDelay >= minimumDelay * 0.8; // Allow 20% tolerance\n}\n\n/**\n * Verify rate limit challenge\n */\nasync function verifyRateLimitChallenge(response: any): Promise<boolean> {\n  return response.acknowledged === true && response.complianceConfirmed === true;\n}\n\n/**\n * Utility functions\n */\nfunction shouldApplyProtection(req: Request): boolean {\n  // Skip for health checks and monitoring endpoints\n  const skipPaths = [\n    '/health',\n    '/api/monitoring',\n    '/api/protection',\n    '/metrics',\n    '/favicon.ico'\n  ];\n\n  return !skipPaths.some(path => req.path.startsWith(path));\n}\n\nfunction getMaxThreatLevel(current: string, newLevel: string): string {\n  const levels = ['low', 'medium', 'high', 'critical'];\n  const currentIndex = levels.indexOf(current);\n  const newIndex = levels.indexOf(newLevel);\n  \n  return newIndex > currentIndex ? newLevel : current;\n}\n\nfunction getRiskLevel(riskScore: number): 'low' | 'medium' | 'high' | 'critical' {\n  if (riskScore >= ENHANCED_PROTECTION_CONFIG.CRITICAL_RISK_THRESHOLD) return 'critical';\n  if (riskScore >= ENHANCED_PROTECTION_CONFIG.HIGH_RISK_THRESHOLD) return 'high';\n  if (riskScore >= ENHANCED_PROTECTION_CONFIG.MEDIUM_RISK_THRESHOLD) return 'medium';\n  return 'low';\n}\n\n/**\n * Get enhanced protection statistics\n */\nexport async function getEnhancedProtectionStats(): Promise<any> {\n  try {\n    const threatIntelMetrics = threatIntelligenceService.getMetrics();\n    const mlStats = mlAnomalyDetector.getModelStats();\n    \n    return {\n      threatIntelligence: threatIntelMetrics,\n      mlModel: mlStats,\n      timestamp: new Date(),\n      config: {\n        thresholds: {\n          critical: ENHANCED_PROTECTION_CONFIG.CRITICAL_RISK_THRESHOLD,\n          high: ENHANCED_PROTECTION_CONFIG.HIGH_RISK_THRESHOLD,\n          medium: ENHANCED_PROTECTION_CONFIG.MEDIUM_RISK_THRESHOLD,\n          low: ENHANCED_PROTECTION_CONFIG.LOW_RISK_THRESHOLD\n        },\n        weights: ENHANCED_PROTECTION_CONFIG.WEIGHTS,\n        features: {\n          threatIntelligence: ENHANCED_PROTECTION_CONFIG.THREAT_INTELLIGENCE,\n          behavioralAnalysis: ENHANCED_PROTECTION_CONFIG.BEHAVIORAL_ANALYSIS,\n          advancedML: ENHANCED_PROTECTION_CONFIG.ADVANCED_ML,\n          realTimeUpdates: ENHANCED_PROTECTION_CONFIG.REAL_TIME_UPDATES\n        }\n      }\n    };\n  } catch (error) {\n    console.error('[EnhancedProtectionStats] Error:', error);\n    throw error;\n  }\n}\n\nexport { EnhancedProtectionResult, ENHANCED_PROTECTION_CONFIG };","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/middleware/free-quota.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/middleware/rate-limit.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/middleware/rateLimit.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RateLimitConfig' is defined but never used.","line":35,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":268,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":268,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8049,8052],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8049,8052],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":273,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":273,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8263,8266],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8263,8266],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":273,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":273,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8287,8290],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8287,8290],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'now' is assigned a value but never used.","line":330,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":330,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Rate Limiting Middleware\n *\n * Implements tier-based rate limiting for API endpoints.\n * Uses in-memory storage with sliding window algorithm.\n */\n\nimport type { Request, Response, NextFunction } from 'express';\nimport { getRateLimits, normalizeTier } from '@shared/tierConfig';\nimport type { AuthRequest } from '../auth';\n\n// ============================================================================\n// Constants\n// ============================================================================\n\nconst TIME_CONSTANTS = {\n  MINUTE_MS: 60 * 1000,\n  FIVE_MINUTES_MS: 5 * 60 * 1000,\n  ONE_HOUR_MS: 60 * 60 * 1000,\n  ONE_DAY_MS: 24 * 60 * 60 * 1000,\n  CLEANUP_INTERVAL_MS: 5 * 60 * 1000, // 5 minutes\n};\n\n// ============================================================================\n// Types\n// ============================================================================\n\ninterface RateLimitEntry {\n  count: number;\n  windowStart: number;\n  dailyCount: number;\n  dayStart: number;\n}\n\ninterface RateLimitConfig {\n  requestsPerMinute: number;\n  requestsPerDay: number;\n  burstLimit: number;\n}\n\ninterface RateLimiterMiddleware {\n  (req: Request, res: Response, next: NextFunction): void;\n  windowMs: number;\n}\n\n// ============================================================================\n// In-Memory Rate Limit Store\n// ============================================================================\n\nconst rateLimitStore = new Map<string, RateLimitEntry>();\nlet cleanupInterval: NodeJS.Timeout | null = null;\n\n/**\n * Start the cleanup interval for expired rate limit entries\n */\nfunction startCleanupInterval(): void {\n  if (cleanupInterval) return;\n\n  cleanupInterval = setInterval(() => {\n    const now = Date.now();\n    const oneHourAgo = now - TIME_CONSTANTS.ONE_HOUR_MS;\n\n    for (const [key, entry] of rateLimitStore.entries()) {\n      // Only remove entries that have been inactive for over an hour\n      if (entry.windowStart < oneHourAgo && entry.dayStart < oneHourAgo) {\n        rateLimitStore.delete(key);\n      }\n    }\n  }, TIME_CONSTANTS.CLEANUP_INTERVAL_MS);\n\n  // Allow process to exit even with active interval\n  if (typeof cleanupInterval.unref === 'function') {\n    cleanupInterval.unref();\n  }\n}\n\n/**\n * Stop the cleanup interval (for testing/graceful shutdown)\n */\nexport function stopCleanupInterval(): void {\n  if (cleanupInterval) {\n    clearInterval(cleanupInterval);\n    cleanupInterval = null;\n  }\n}\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\n/**\n * Extract client IP address from request\n * Handles proxied requests via x-forwarded-for header\n */\nfunction getClientIp(req: Request): string {\n  return (\n    req.ip ||\n    req.headers['x-forwarded-for']?.toString().split(',')[0] ||\n    req.socket.remoteAddress ||\n    'unknown'\n  );\n}\n\nfunction getClientKey(req: Request): string {\n  // Use user ID if authenticated, otherwise use IP\n  const authReq = req as AuthRequest;\n  if (authReq.user?.id) {\n    return `user:${authReq.user.id}`;\n  }\n\n  const ip = getClientIp(req);\n  return `ip:${ip}`;\n}\n\nfunction getTierFromRequest(req: Request): string {\n  const authReq = req as AuthRequest;\n\n  // Check user's subscription tier\n  if (authReq.user?.tier) {\n    return authReq.user.tier;\n  }\n\n  // Check query parameter (for testing)\n  if (req.query.tier) {\n    return req.query.tier as string;\n  }\n\n  // Default to free tier\n  return 'free';\n}\n\n// ============================================================================\n// Rate Limit Middleware Factory\n// ============================================================================\n\nexport function createRateLimiter(options?: {\n  windowMs?: number;\n  skipFailedRequests?: boolean;\n  keyGenerator?: (req: Request) => string;\n}): RateLimiterMiddleware {\n  const windowMs = options?.windowMs || TIME_CONSTANTS.MINUTE_MS;\n  const skipFailedRequests = options?.skipFailedRequests ?? false;\n  const keyGenerator = options?.keyGenerator || getClientKey;\n\n  // Start cleanup interval on first middleware creation\n  startCleanupInterval();\n\n  function rateLimitMiddleware(\n    req: Request,\n    res: Response,\n    next: NextFunction\n  ): void {\n    const now = Date.now();\n    const key = keyGenerator(req);\n    const tier = normalizeTier(getTierFromRequest(req));\n    const limits = getRateLimits(tier);\n\n    // Get or create rate limit entry\n    let entry = rateLimitStore.get(key);\n\n    if (!entry) {\n      entry = {\n        count: 0,\n        windowStart: now,\n        dailyCount: 0,\n        dayStart: now,\n      };\n      rateLimitStore.set(key, entry);\n    }\n\n    // Reset window if expired\n    if (now - entry.windowStart > windowMs) {\n      entry.count = 0;\n      entry.windowStart = now;\n    }\n\n    // Reset daily count if new day\n    if (now - entry.dayStart > TIME_CONSTANTS.ONE_DAY_MS) {\n      entry.dailyCount = 0;\n      entry.dayStart = now;\n    }\n\n    //  ATOMIC: Pre-increment counters to prevent race conditions\n    // This ensures concurrent requests atomically consume quota\n    // If multiple requests arrive simultaneously:\n    // - Request A: count=0  1 (allowed)\n    // - Request B: count=1  2 (allowed)\n    // - Request C: count=2  3 (allowed if limit >= 3)\n    // Without this, all 3 could see count=0 and all pass the check\n    const newCount = ++entry.count;\n    const newDailyCount = ++entry.dailyCount;\n\n    // Check per-minute limit (after increment)\n    if (newCount > limits.requestsPerMinute) {\n      const retryAfter = Math.ceil((entry.windowStart + windowMs - now) / 1000);\n\n      res.setHeader('Retry-After', retryAfter);\n      res.setHeader('X-RateLimit-Limit', limits.requestsPerMinute);\n      res.setHeader('X-RateLimit-Remaining', 0);\n      res.setHeader(\n        'X-RateLimit-Reset',\n        Math.ceil((entry.windowStart + windowMs) / 1000)\n      );\n\n      res.status(429).json({\n        error: 'Too many requests',\n        message: `Rate limit exceeded. Maximum ${limits.requestsPerMinute} requests per minute for ${tier} tier.`,\n        tier,\n        retry_after_seconds: retryAfter,\n        upgrade_message:\n          tier === 'free'\n            ? 'Upgrade to Professional for higher rate limits'\n            : tier === 'professional'\n              ? 'Upgrade to Forensic for higher rate limits'\n              : undefined,\n      });\n\n      // Decrement since we're rejecting this request\n      entry.count--;\n      entry.dailyCount--;\n      return;\n    }\n\n    // Check daily limit (after increment)\n    if (newDailyCount > limits.requestsPerDay) {\n      const nextDay = new Date(entry.dayStart + TIME_CONSTANTS.ONE_DAY_MS);\n\n      res.setHeader('X-RateLimit-Daily-Limit', limits.requestsPerDay);\n      res.setHeader('X-RateLimit-Daily-Remaining', 0);\n      res.setHeader('X-RateLimit-Daily-Reset', nextDay.toISOString());\n\n      res.status(429).json({\n        error: 'Daily limit exceeded',\n        message: `Daily limit of ${limits.requestsPerDay} requests exceeded for ${tier} tier.`,\n        tier,\n        reset_at: nextDay.toISOString(),\n        upgrade_message:\n          tier === 'free'\n            ? 'Upgrade to Professional for unlimited daily extractions'\n            : undefined,\n      });\n\n      // Decrement since we're rejecting this request\n      entry.count--;\n      entry.dailyCount--;\n      return;\n    }\n\n    // Set rate limit headers\n    res.setHeader('X-RateLimit-Limit', limits.requestsPerMinute);\n    res.setHeader(\n      'X-RateLimit-Remaining',\n      Math.max(0, limits.requestsPerMinute - newCount)\n    );\n    res.setHeader(\n      'X-RateLimit-Reset',\n      Math.ceil((entry.windowStart + windowMs) / 1000)\n    );\n    res.setHeader('X-RateLimit-Daily-Limit', limits.requestsPerDay);\n    res.setHeader(\n      'X-RateLimit-Daily-Remaining',\n      Math.max(0, limits.requestsPerDay - newDailyCount)\n    );\n\n    // Handle response to decrement on failure if configured\n    if (skipFailedRequests) {\n      const originalEnd = res.end;\n      res.end = function (...args: any[]) {\n        if (res.statusCode >= 400 && entry) {\n          entry.count = Math.max(0, entry.count - 1);\n          entry.dailyCount = Math.max(0, entry.dailyCount - 1);\n        }\n        return (originalEnd as any).apply(res, args as any);\n      };\n    }\n\n    next();\n  }\n\n  // Attach windowMs property for status endpoint compatibility\n  (rateLimitMiddleware as RateLimiterMiddleware).windowMs = windowMs;\n\n  return rateLimitMiddleware as RateLimiterMiddleware;\n}\n\n// ============================================================================\n// Pre-configured Rate Limiters\n// ============================================================================\n\n/**\n * Standard API rate limiter\n * Uses tier-based limits from tierConfig\n */\nexport const apiRateLimiter = createRateLimiter();\n\n/**\n * Extraction endpoint rate limiter\n * Stricter limits for resource-intensive operations\n */\nexport const extractionRateLimiter = createRateLimiter({\n  skipFailedRequests: true,\n});\n\n/**\n * Authentication rate limiter\n * Prevents brute force attacks\n */\nexport const authRateLimiter = createRateLimiter({\n  windowMs: TIME_CONSTANTS.FIVE_MINUTES_MS,\n  keyGenerator: req => {\n    const ip = getClientIp(req);\n    return `auth:${ip}`;\n  },\n});\n\n// ============================================================================\n// Rate Limit Status Endpoint Handler\n// ============================================================================\n\n/**\n * Get current rate limit status for a request\n * Uses the standard 1-minute window for status reporting\n */\nexport function getRateLimitStatus(req: Request, res: Response): void {\n  const key = getClientKey(req);\n  const tier = normalizeTier(getTierFromRequest(req));\n  const limits = getRateLimits(tier);\n  const entry = rateLimitStore.get(key);\n\n  const now = Date.now();\n  // Use standard window for status reporting\n  const windowMs = TIME_CONSTANTS.MINUTE_MS;\n\n  res.json({\n    tier,\n    limits: {\n      requests_per_minute: limits.requestsPerMinute,\n      requests_per_day: limits.requestsPerDay,\n    },\n    current: {\n      minute_count: entry?.count || 0,\n      minute_remaining: Math.max(\n        0,\n        limits.requestsPerMinute - (entry?.count || 0)\n      ),\n      minute_reset: entry\n        ? new Date(entry.windowStart + windowMs).toISOString()\n        : null,\n      daily_count: entry?.dailyCount || 0,\n      daily_remaining: Math.max(\n        0,\n        limits.requestsPerDay - (entry?.dailyCount || 0)\n      ),\n      daily_reset: entry\n        ? new Date(entry.dayStart + TIME_CONSTANTS.ONE_DAY_MS).toISOString()\n        : null,\n    },\n  });\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/middleware/upload-rate-limit.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'NextFunction' is defined but never used.","line":8,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RateLimitRequestHandler' is defined but never used.","line":10,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'storage' is defined but never used.","line":13,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1186,1189],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1186,1189],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1230,1233],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1230,1233],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2021,2024],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2021,2024],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2454,2457],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2454,2457],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'key' is assigned a value but never used.","line":106,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":106,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":107,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2985,2988],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2985,2988],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":128,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3845,3848],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3845,3848],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":154,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4572,4575],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4572,4575],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":177,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5374,5377],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5374,5377],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":191,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":191,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5674,5677],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5674,5677],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":13,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Upload Rate Limiting Middleware\n *\n * Provides rate limiting specifically for file upload endpoints\n * to prevent DoS attacks and abuse.\n */\n\nimport { Request, Response, NextFunction } from 'express';\nimport rateLimit, {\n  RateLimitRequestHandler,\n  ipKeyGenerator,\n} from 'express-rate-limit';\nimport { storage } from '../storage/index';\nimport { securityEventLogger } from '../monitoring/security-events';\n\n// Configuration\nconst UPLOAD_LIMITS = {\n  // Per IP address\n  IP_WINDOW_MS: 15 * 60 * 1000, // 15 minutes\n  IP_MAX_REQUESTS: 50, // Max 50 uploads per IP per 15 minutes\n\n  // Per session/device (more generous for legitimate users)\n  SESSION_WINDOW_MS: 60 * 60 * 1000, // 1 hour\n  SESSION_MAX_REQUESTS: 100, // Max 100 uploads per session per hour\n\n  // Burst protection (short term)\n  BURST_WINDOW_MS: 60 * 1000, // 1 minute\n  BURST_MAX_REQUESTS: 10, // Max 10 uploads per minute\n};\n\n/**\n * Get rate limit key for a request\n * Priority: User ID > Session ID > IP Address\n * Uses the built-in ipKeyGenerator helper to handle IPv6 properly\n */\nexport function getRateLimitKey(req: Request): string {\n  // Authenticated users get their own rate limit bucket\n  if ((req as any).user?.id) {\n    return `user:${(req as any).user.id}`;\n  }\n\n  // Session-based rate limiting for anonymous users\n  const sessionId =\n    req.cookies?.metaextract_session_id || req.headers['x-session-id'];\n  if (sessionId) {\n    return `session:${sessionId}`;\n  }\n\n  // Fallback to IP-based rate limiting - use built-in helper for IPv6 safety\n  // This prevents IPv6 bypass attacks\n  const ip = req.ip || req.connection.remoteAddress || 'unknown';\n  return `ip:${ipKeyGenerator(ip)}`;\n}\n\n/**\n * Check if request should bypass rate limiting\n */\nfunction shouldBypassRateLimit(req: Request): boolean {\n  // Development/testing bypass\n  if (\n    process.env.NODE_ENV === 'development' &&\n    process.env.BYPASS_RATE_LIMIT === 'true'\n  ) {\n    return true;\n  }\n\n  // Admin bypass (if admin authentication is implemented)\n  if ((req as any).user?.role === 'admin') {\n    return true;\n  }\n\n  // Health check bypass\n  if (req.path.includes('/health') || req.path.includes('/status')) {\n    return true;\n  }\n\n  return false;\n}\n\n/**\n * Enhanced rate limiter with Redis/memory fallback\n */\nexport const uploadRateLimit = rateLimit({\n  windowMs: UPLOAD_LIMITS.IP_WINDOW_MS,\n  max: async (req: Request) => {\n    // Dynamic limit based on authentication status\n    if ((req as any).user?.id) {\n      // Authenticated users get higher limits\n      return UPLOAD_LIMITS.SESSION_MAX_REQUESTS;\n    }\n\n    // Anonymous users get standard limits\n    return UPLOAD_LIMITS.IP_MAX_REQUESTS;\n  },\n\n  keyGenerator: getRateLimitKey,\n\n  skip: shouldBypassRateLimit,\n\n  // Disable IPv6 validation warning - we're handling this correctly\n  validate: {\n    ipv6SubnetOrKeyGenerator: false,\n  },\n\n  handler: async (req: Request, res: Response) => {\n    const key = getRateLimitKey(req);\n    const isAuthenticated = !!(req as any).user?.id;\n    const limitType = isAuthenticated ? 'authenticated user' : 'IP address';\n\n    // Log security event for rate limit violation\n    await securityEventLogger.logRateLimitViolation(\n      req,\n      'rate',\n      isAuthenticated\n        ? UPLOAD_LIMITS.SESSION_MAX_REQUESTS\n        : UPLOAD_LIMITS.IP_MAX_REQUESTS,\n      `${Math.round(UPLOAD_LIMITS.IP_WINDOW_MS / (60 * 1000))} minutes`\n    );\n\n    res.status(429).json({\n      error: 'Rate limit exceeded',\n      message: `Too many upload attempts from this ${limitType}. Please try again later.`,\n      limit_type: isAuthenticated ? 'user' : 'ip',\n      window_minutes: Math.round(UPLOAD_LIMITS.IP_WINDOW_MS / (60 * 1000)),\n      max_requests: isAuthenticated\n        ? UPLOAD_LIMITS.SESSION_MAX_REQUESTS\n        : UPLOAD_LIMITS.IP_MAX_REQUESTS,\n      retry_after_seconds: Math.round(((req as any).rateLimit?.resetTime ?? 0) / 1000),\n      suggestions: [\n        'Wait a few minutes before trying again',\n        'Consider creating an account for higher limits',\n        'Contact support if you believe this is an error',\n      ],\n    });\n  },\n\n  standardHeaders: true,\n  legacyHeaders: false,\n\n  // Store configuration - use memory store for now\n  // Redis store can be added later when Redis is properly configured\n});\n\n/**\n * Burst protection - very short-term rate limiting\n */\nexport const burstRateLimit = rateLimit({\n  windowMs: UPLOAD_LIMITS.BURST_WINDOW_MS,\n  max: UPLOAD_LIMITS.BURST_MAX_REQUESTS,\n\n  keyGenerator: getRateLimitKey,\n\n  skip: (req: Request) => {\n    return shouldBypassRateLimit(req) || (req as any).user?.id !== undefined;\n  },\n\n  // Disable IPv6 validation warning - we're handling this correctly\n  validate: {\n    ipv6SubnetOrKeyGenerator: false,\n  },\n\n  handler: async (req: Request, res: Response) => {\n    // Log security event for burst rate limit violation\n    await securityEventLogger.logRateLimitViolation(\n      req,\n      'burst',\n      UPLOAD_LIMITS.BURST_MAX_REQUESTS,\n      `${Math.round(UPLOAD_LIMITS.BURST_WINDOW_MS / 1000)} seconds`\n    );\n\n    res.status(429).json({\n      error: 'Burst rate limit exceeded',\n      message: 'Too many rapid upload attempts. Please slow down.',\n      limit_type: 'burst',\n      window_seconds: Math.round(UPLOAD_LIMITS.BURST_WINDOW_MS / 1000),\n      max_requests: UPLOAD_LIMITS.BURST_MAX_REQUESTS,\n      retry_after_seconds: Math.round(((req as any).rateLimit?.resetTime ?? 0) / 1000),\n    });\n  },\n\n  standardHeaders: true,\n  legacyHeaders: false,\n\n  // Use memory store for burst protection\n});\n\n/**\n * Combined rate limiting middleware\n * Apply burst protection first, then main rate limiting\n */\nexport function applyUploadRateLimiting(app: any): void {\n  // Apply main rate limiting first (more generous, longer window)\n  app.use('/api/images_mvp/extract', uploadRateLimit);\n\n  // Apply burst protection second (stricter, shorter window, only for anonymous users)\n  app.use('/api/images_mvp/extract', burstRateLimit);\n\n  console.log(\n    '[RateLimit] Upload rate limiting applied to /api/images_mvp/extract'\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/payments.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'crypto' is defined but never used.","line":6,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DODO_API_KEY' is assigned a value but never used.","line":18,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'IS_TEST_MODE' is assigned a value but never used.","line":22,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1367,1370],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1367,1370],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1417,1420],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1417,1420],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1598,1601],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1598,1601],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":592,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":592,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19390,19393],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19390,19393],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":596,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":596,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19571,19574],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19571,19574],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":600,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":600,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19649,19652],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19649,19652],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":846,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":846,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27686,27689],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27686,27689],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":892,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":892,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29014,29017],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29014,29017],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":920,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":920,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29698,29701],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29698,29701],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":951,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":951,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30500,30503],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30500,30503],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":970,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":970,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30957,30960],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30957,30960],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1003,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1003,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31775,31778],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31775,31778],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":15,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import DodoPayments from 'dodopayments';\nimport type { Express, Request, Response } from 'express';\nimport { db } from './db';\nimport { users, subscriptions } from '@shared/schema';\nimport { eq } from 'drizzle-orm';\nimport crypto from 'crypto';\nimport { storage } from './storage/index';\nimport { normalizeTier } from '@shared/tierConfig';\nimport type { AuthRequest } from './auth';\nimport { getOrSetSessionId } from './utils/session-id';\nimport { getTrustedAppOrigin } from './utils/trusted-app-origin';\n\n// ============================================================================\n// DodoPayments Configuration\n// ============================================================================\n\n// Allow legacy DOOD_API_KEY/DOOD_WEBHOOK_SECRET env vars to avoid misconfig 503s\nconst DODO_API_KEY =\n  process.env.DODO_PAYMENTS_API_KEY || process.env.DOOD_API_KEY;\nconst DODO_WEBHOOK_SECRET =\n  process.env.DODO_WEBHOOK_SECRET || process.env.DOOD_WEBHOOK_SECRET;\nconst IS_TEST_MODE = (process.env.DODO_ENV || process.env.DOOD_ENV) !== 'live';\n\nfunction getDodoClient() {\n  const apiKey =\n    process.env.DODO_PAYMENTS_API_KEY || process.env.DOOD_API_KEY;\n  const env = (process.env.DODO_ENV || process.env.DOOD_ENV) !== 'live'\n    ? 'test_mode'\n    : 'live_mode';\n  if (!apiKey) return null;\n\n  const cacheKey = `${apiKey}:${env}`;\n  const cached = (getDodoClient as any)._cached as\n    | { cacheKey: string; client: any }\n    | undefined;\n  if (cached?.cacheKey === cacheKey) return cached.client;\n\n  const client = new DodoPayments({ bearerToken: apiKey, environment: env });\n  (getDodoClient as any)._cached = { cacheKey, client };\n  return client;\n}\n\n// ============================================================================\n// Product IDs from Dodo Dashboard\n// ============================================================================\n\n// Subscription products\nexport const DODO_SUBSCRIPTION_PRODUCTS = {\n  professional:\n    process.env.DODO_PRODUCT_PROFESSIONAL ||\n    process.env.DODO_PRODUCT_STARTER ||\n    'pdt_0NV8f7BHv56aq5nVIdg3Y',\n  forensic:\n    process.env.DODO_PRODUCT_FORENSIC ||\n    process.env.DODO_PRODUCT_PREMIUM ||\n    'pdt_0NV8fLqUtlChurxFwXlKB',\n  enterprise:\n    process.env.DODO_PRODUCT_ENTERPRISE ||\n    process.env.DODO_PRODUCT_SUPER ||\n    process.env.DODO_PRODUCT_PREMIUM ||\n    'pdt_0NV8fLqUtlChurxFwXlKB',\n} as const;\n\n// One-time credit pack products\nexport const DODO_CREDIT_PRODUCTS = {\n  single:\n    process.env.DODO_PRODUCT_CREDITS_SINGLE || 'pdt_0NV8hiVHeqx1npWvjaXwt',\n  batch: process.env.DODO_PRODUCT_CREDITS_BATCH || 'pdt_0NV8hnJ3qBd0dUHEbQRw9',\n  bulk: process.env.DODO_PRODUCT_CREDITS_BULK || 'pdt_0NV8hsCRYsFDHaVGPITwa',\n} as const;\n\nexport const DODO_IMAGES_MVP_PRODUCTS = {\n  starter: process.env.DODO_PRODUCT_IMAGES_STARTER || 'pdt_images_mvp_starter',\n  pro: process.env.DODO_PRODUCT_IMAGES_PRO || 'pdt_images_mvp_pro',\n} as const;\n\nfunction formatUsdFromCents(cents: number): string {\n  const value = Number.isFinite(cents) ? cents / 100 : 0;\n  return `$${value.toFixed(2)}`;\n}\n\n// Credit pack configuration\nexport const CREDIT_PACKS = {\n  single: {\n    credits: 10,\n    price: 0,\n    priceDisplay: '$0.00',\n    name: 'Test Pack',\n    description: '10 credits for testing',\n    productId: DODO_CREDIT_PRODUCTS.single,\n  },\n  batch: {\n    credits: 50,\n    price: 600,\n    priceDisplay: '$6.00',\n    name: 'Batch Pack',\n    description: '50 credits - best for occasional use',\n    productId: DODO_CREDIT_PRODUCTS.batch,\n  },\n  bulk: {\n    credits: 200,\n    price: 2800,\n    priceDisplay: '$28.00',\n    name: 'Bulk Pack',\n    description: '200 credits - best value',\n    productId: DODO_CREDIT_PRODUCTS.bulk,\n  },\n} as const;\n\nexport const IMAGES_MVP_CREDIT_PACKS = {\n  starter: {\n    credits: 100,\n    price: Number(process.env.IMAGES_MVP_STARTER_PRICE_CENTS ?? 400),\n    priceDisplay: formatUsdFromCents(\n      Number(process.env.IMAGES_MVP_STARTER_PRICE_CENTS ?? 400)\n    ),\n    name: 'Starter Pack',\n    description: '25 standard images',\n    productId: DODO_IMAGES_MVP_PRODUCTS.starter,\n  },\n  pro: {\n    credits: 400,\n    price: Number(process.env.IMAGES_MVP_PRO_PRICE_CENTS ?? 1200),\n    priceDisplay: formatUsdFromCents(\n      Number(process.env.IMAGES_MVP_PRO_PRICE_CENTS ?? 1200)\n    ),\n    name: 'Pro Pack',\n    description: '100 standard images',\n    productId: DODO_IMAGES_MVP_PRODUCTS.pro,\n  },\n} as const;\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\nfunction getBaseUrl(): string {\n  if (process.env.REPLIT_DEV_DOMAIN) {\n    return `https://${process.env.REPLIT_DEV_DOMAIN}`;\n  }\n  if (process.env.RAILWAY_PUBLIC_DOMAIN) {\n    return `https://${process.env.RAILWAY_PUBLIC_DOMAIN}`;\n  }\n  if (process.env.BASE_URL) {\n    return process.env.BASE_URL;\n  }\n  return 'http://localhost:3000';\n}\n\nfunction getCoreBalanceKeyForSession(sessionId: string): string {\n  return `credits:core:session:${sessionId}`;\n}\n\nfunction getCoreBalanceKeyForUser(userId: string): string {\n  return `credits:core:user:${userId}`;\n}\n\n// ============================================================================\n// Webhook Idempotency Store\n// ============================================================================\n\n// In-memory store to prevent duplicate webhook processing\n// Maps webhook ID to the timestamp it was processed\nconst processedWebhooks = new Map<string, number>();\n\n// Clean up old entries every 1 hour (webhooks expire after 5 min anyway)\n// In tests, avoid keeping the event loop alive (Jest sets JEST_WORKER_ID).\nif (process.env.NODE_ENV !== 'test' && !process.env.JEST_WORKER_ID) {\n  const timer = setInterval(() => {\n    const oneHourAgo = Date.now() - 60 * 60 * 1000;\n    for (const [webhookId, processedTime] of processedWebhooks.entries()) {\n      if (processedTime < oneHourAgo) {\n        processedWebhooks.delete(webhookId);\n      }\n    }\n  }, 60 * 60 * 1000);\n  timer.unref?.();\n}\n\n// ============================================================================\n// Route Registration\n// ============================================================================\n\nexport function registerPaymentRoutes(app: Express) {\n  // ---------------------------------------------------------------------------\n  // Checkout Session Creation (Subscriptions)\n  // ---------------------------------------------------------------------------\n\n  app.post(\n    '/api/checkout/create-session',\n    async (req: Request, res: Response) => {\n      try {\n        const dodoClient = getDodoClient();\n        if (!dodoClient) {\n          return res.status(503).json({\n            error: 'Payment system not configured',\n            message: 'Please add DODO_PAYMENTS_API_KEY to enable payments',\n          });\n        }\n\n        const { tier, userId, email } = req.body;\n        const requestedTier =\n          typeof tier === 'string' ? tier.toLowerCase() : '';\n        const allowedTiers = new Set([\n          'professional',\n          'forensic',\n          'enterprise',\n          'starter',\n          'premium',\n          'super',\n        ]);\n        if (!requestedTier || !allowedTiers.has(requestedTier)) {\n          return res.status(400).json({ error: 'Invalid tier' });\n        }\n\n        const normalizedTier = normalizeTier(requestedTier);\n        const productId = (\n          DODO_SUBSCRIPTION_PRODUCTS as Record<string, string>\n        )[normalizedTier];\n        if (!productId) {\n          return res.status(400).json({\n            error: `Product not configured for tier: ${normalizedTier}`,\n          });\n        }\n\n        const baseUrl = getTrustedAppOrigin(req) ?? getBaseUrl();\n\n        const session = await dodoClient.checkoutSessions.create({\n          product_cart: [{ product_id: productId, quantity: 1 }],\n          allowed_payment_method_types: [\n            'credit',\n            'debit',\n            'apple_pay',\n            'google_pay',\n          ],\n          billing_currency: 'USD',\n          customer: email ? { email } : undefined,\n          return_url: `${baseUrl}/checkout/success?tier=${normalizedTier}`,\n          metadata: {\n            tier: normalizedTier,\n            user_id: userId || 'anonymous',\n            type: 'subscription',\n          },\n        });\n\n        console.log(\n          `Created checkout session for ${normalizedTier}:`,\n          session.session_id\n        );\n\n        res.json({\n          checkout_url: session.checkout_url,\n          session_id: session.session_id,\n        });\n      } catch (error) {\n        console.error('Checkout session error:', error);\n        res.status(500).json({\n          error: 'Failed to create checkout session',\n          details: error instanceof Error ? error.message : 'Unknown error',\n        });\n      }\n    }\n  );\n\n  // ---------------------------------------------------------------------------\n  // Credit Purchase\n  // ---------------------------------------------------------------------------\n\n  app.post('/api/credits/purchase', async (req: Request, res: Response) => {\n    try {\n      const dodoClient = getDodoClient();\n      if (!dodoClient) {\n        return res.status(503).json({\n          error: 'Payment system not configured',\n          message: 'Please add DODO_PAYMENTS_API_KEY to enable payments',\n        });\n      }\n\n      const authReq = req as AuthRequest;\n      const { pack, email } = req.body;\n\n      if (!pack || !['single', 'batch', 'bulk'].includes(pack)) {\n        return res.status(400).json({ error: 'Invalid credit pack' });\n      }\n\n      if (!authReq.user?.id) {\n        return res.status(401).json({\n          error: 'Authentication required',\n          message: 'Please sign in to purchase credits so they are available across devices.',\n        });\n      }\n\n      const balanceKey = getCoreBalanceKeyForUser(authReq.user.id);\n\n      const balance = await storage.getOrCreateCreditBalance(\n        balanceKey,\n        authReq.user?.id\n      );\n      const packInfo = CREDIT_PACKS[pack as keyof typeof CREDIT_PACKS];\n\n      const baseUrl = getTrustedAppOrigin(req) ?? getBaseUrl();\n\n      const session = await dodoClient.checkoutSessions.create({\n        product_cart: [\n          {\n            product_id: packInfo.productId,\n            quantity: 1,\n          },\n        ],\n        allowed_payment_method_types: [\n          'credit',\n          'debit',\n          'apple_pay',\n          'google_pay',\n        ],\n        billing_currency: 'USD',\n        customer: email ? { email } : undefined,\n        return_url: `${baseUrl}/credits/success?pack=${pack}&balanceId=${balance.id}`,\n        metadata: {\n          type: 'credit_purchase',\n          product: 'core',\n          pack,\n          credits: packInfo.credits.toString(),\n          balance_id: balance.id,\n          balance_key: balanceKey,\n          user_id: authReq.user?.id || null,\n          purchaser_email: email || null,\n        },\n      });\n\n      console.log(\n        `Created credit purchase session for ${pack}:`,\n        session.session_id\n      );\n\n      res.json({\n        checkout_url: session.checkout_url,\n        session_id: session.session_id,\n      });\n    } catch (error) {\n      console.error('Credit purchase error:', error);\n      res.status(500).json({\n        error: 'Failed to create checkout session',\n        details: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  });\n\n  // ---------------------------------------------------------------------------\n  // Credit Balance Endpoints\n  // ---------------------------------------------------------------------------\n\n  app.get('/api/credits/balance', async (req: Request, res: Response) => {\n    try {\n      const authReq = req as AuthRequest;\n\n      let balanceKey: string | null = null;\n      if (authReq.user?.id) {\n        balanceKey = getCoreBalanceKeyForUser(authReq.user.id);\n      } else {\n        // If no sessionId was provided, still use a stable cookie session id.\n        const cookieSessionId = getOrSetSessionId(req, res);\n        const legacy = await storage.getCreditBalanceBySessionId(cookieSessionId);\n        balanceKey = legacy\n          ? cookieSessionId\n          : getCoreBalanceKeyForSession(cookieSessionId);\n      }\n\n      if (!balanceKey) return res.json({ credits: 0, balanceId: null });\n\n      const balance = await storage.getOrCreateCreditBalance(\n        balanceKey,\n        authReq.user?.id\n      );\n      res.json({\n        credits: balance.credits,\n        balanceId: balance.id,\n      });\n    } catch (error) {\n      console.error('Get credits error:', error);\n      res.status(500).json({ error: 'Failed to get credit balance' });\n    }\n  });\n\n  // Claim session credits to account credits (core)\n  app.post('/api/credits/claim', async (req: Request, res: Response) => {\n    try {\n      const authReq = req as AuthRequest;\n      if (!authReq.user?.id) {\n        return res.status(401).json({ error: 'Authentication required' });\n      }\n\n      const cookieSessionId = getOrSetSessionId(req, res);\n      const fromKey = (await storage.getCreditBalanceBySessionId(cookieSessionId))\n        ? cookieSessionId\n        : getCoreBalanceKeyForSession(cookieSessionId);\n      const toKey = getCoreBalanceKeyForUser(authReq.user.id);\n\n      const fromBalance = await storage.getCreditBalanceBySessionId(fromKey);\n      if (!fromBalance || (fromBalance.credits ?? 0) <= 0) {\n        return res.json({ transferred: 0 });\n      }\n\n      const toBalance = await storage.getOrCreateCreditBalance(\n        toKey,\n        authReq.user.id\n      );\n\n      const amount = fromBalance.credits;\n      await storage.transferCredits(\n        fromBalance.id,\n        toBalance.id,\n        amount,\n        'Claimed credits to account'\n      );\n\n      return res.json({ transferred: amount });\n    } catch (error) {\n      console.error('Claim credits error:', error);\n      res.status(500).json({ error: 'Failed to claim credits' });\n    }\n  });\n\n  app.get('/api/credits/transactions', async (req: Request, res: Response) => {\n    try {\n      const balanceId = req.query.balanceId as string;\n\n      if (!balanceId) {\n        return res.json({ transactions: [] });\n      }\n\n      const transactions = await storage.getCreditTransactions(balanceId);\n      res.json({ transactions });\n    } catch (error) {\n      console.error('Get transactions error:', error);\n      res.status(500).json({ error: 'Failed to get transactions' });\n    }\n  });\n\n  // Manual credit addition (for testing/admin)\n  app.post('/api/credits/add', async (req: Request, res: Response) => {\n    try {\n      if (process.env.NODE_ENV === 'production') {\n        return res.status(404).json({ error: 'Not found' });\n      }\n\n      const { balanceId, credits, description } = req.body;\n\n      if (!balanceId || !credits) {\n        return res\n          .status(400)\n          .json({ error: 'Balance ID and credits required' });\n      }\n\n      const tx = await storage.addCredits(\n        balanceId,\n        credits,\n        description || 'Manual credit addition'\n      );\n\n      const balance = await storage.getCreditBalance(balanceId);\n\n      res.json({\n        success: true,\n        transaction: tx,\n        newBalance: balance?.credits || 0,\n      });\n    } catch (error) {\n      console.error('Add credits error:', error);\n      res.status(500).json({ error: 'Failed to add credits' });\n    }\n  });\n\n  // Dev helper: grant credits to the current user/session without needing a balanceId.\n  app.post('/api/dev/credits/grant', async (req: Request, res: Response) => {\n    try {\n      if (process.env.NODE_ENV === 'production') {\n        return res.status(404).json({ error: 'Not found' });\n      }\n\n      const authReq = req as AuthRequest;\n      const amount =\n        typeof req.body?.credits === 'number'\n          ? req.body.credits\n          : typeof req.body?.credits === 'string'\n            ? Number(req.body.credits)\n            : 100;\n      if (!Number.isFinite(amount) || amount <= 0) {\n        return res.status(400).json({ error: 'credits must be a positive number' });\n      }\n\n      let balanceKey: string;\n      if (authReq.user?.id) {\n        balanceKey = getCoreBalanceKeyForUser(authReq.user.id);\n      } else {\n        const cookieSessionId = getOrSetSessionId(req, res);\n        const legacy = await storage.getCreditBalanceBySessionId(cookieSessionId);\n        balanceKey = legacy\n          ? cookieSessionId\n          : getCoreBalanceKeyForSession(cookieSessionId);\n      }\n\n      const balance = await storage.getOrCreateCreditBalance(\n        balanceKey,\n        authReq.user?.id\n      );\n\n      await storage.addCredits(\n        balance.id,\n        amount,\n        `Dev grant (${amount} credits)`\n      );\n\n      const updated = await storage.getCreditBalance(balance.id);\n      return res.json({\n        ok: true,\n        balanceId: balance.id,\n        credits: updated?.credits ?? balance.credits,\n      });\n    } catch (error) {\n      console.error('Dev grant credits error:', error);\n      return res.status(500).json({ error: 'Failed to grant credits' });\n    }\n  });\n\n  // Use credits for extraction\n  app.post('/api/credits/use', async (req: Request, res: Response) => {\n    try {\n      const { balanceId, amount, fileType } = req.body;\n\n      if (!balanceId || !amount) {\n        return res\n          .status(400)\n          .json({ error: 'Balance ID and amount required' });\n      }\n\n      const balance = await storage.getCreditBalance(balanceId);\n      if (!balance || balance.credits < amount) {\n        return res.status(402).json({\n          error: 'Insufficient credits',\n          required: amount,\n          available: balance?.credits || 0,\n        });\n      }\n\n      const tx = await storage.useCredits(\n        balanceId,\n        amount,\n        `Extraction: ${fileType || 'file'}`\n      );\n\n      const newBalance = await storage.getCreditBalance(balanceId);\n\n      res.json({\n        success: true,\n        transaction: tx,\n        newBalance: newBalance?.credits || 0,\n      });\n    } catch (error) {\n      console.error('Use credits error:', error);\n      res.status(500).json({ error: 'Failed to use credits' });\n    }\n  });\n\n  // ---------------------------------------------------------------------------\n  // Local payment confirmation (DEV/TEST helper)\n  // ---------------------------------------------------------------------------\n  // When testing checkout flows on localhost, Dodo webhooks can't reach your machine\n  // unless you use a tunnel. This endpoint verifies payment status via the Dodo API\n  // and applies the same credit logic as the webhook handler (idempotent).\n  app.post('/api/payments/confirm', async (req: Request, res: Response) => {\n    try {\n      if (process.env.NODE_ENV === 'production') {\n        return res.status(404).json({ error: 'Not found' });\n      }\n\n      const dodoClient = getDodoClient();\n      if (!dodoClient) {\n        return res.status(503).json({\n          error: 'Payment system not configured',\n          message: 'Please add DODO_PAYMENTS_API_KEY to enable payments',\n        });\n      }\n\n      const paymentId =\n        typeof req.body?.paymentId === 'string' ? req.body.paymentId : null;\n      if (!paymentId) {\n        return res.status(400).json({ error: 'paymentId is required' });\n      }\n\n      const payment = await dodoClient.payments.retrieve(paymentId);\n      const status = String((payment as any)?.status ?? '').toLowerCase();\n      if (status !== 'succeeded') {\n        return res.status(409).json({\n          error: 'Payment not succeeded',\n          status: (payment as any)?.status ?? null,\n        });\n      }\n\n      const metadata = (payment as any)?.metadata ?? null;\n      if (!metadata || metadata.type !== 'credit_purchase') {\n        return res.status(400).json({ error: 'Unsupported payment type' });\n      }\n\n      await handlePaymentSucceeded({\n        payment_id: paymentId,\n        metadata,\n      });\n\n      return res.json({ ok: true });\n    } catch (error) {\n      console.error('Payment confirm error:', error);\n      return res.status(500).json({\n        error: 'Failed to confirm payment',\n        details: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  });\n\n  // ---------------------------------------------------------------------------\n  // Subscription Status\n  // ---------------------------------------------------------------------------\n\n  app.get('/api/subscription/status', async (req: Request, res: Response) => {\n    try {\n      if (!db) {\n        return res.status(503).json({\n          error: 'Database not available',\n          message:\n            'Please configure DATABASE_URL to enable subscription status',\n        });\n      }\n\n      const userId = req.query.userId as string;\n\n      if (!userId) {\n        return res.json({ tier: 'enterprise', status: 'none' });\n      }\n\n      const [user] = await db.select().from(users).where(eq(users.id, userId));\n\n      if (!user) {\n        return res.json({ tier: 'enterprise', status: 'none' });\n      }\n\n      res.json({\n        tier: user.tier,\n        status: user.subscriptionStatus,\n        subscriptionId: user.subscriptionId,\n      });\n    } catch (error) {\n      console.error('Subscription status error:', error);\n      res.status(500).json({ error: 'Failed to get subscription status' });\n    }\n  });\n\n  app.post('/api/subscription/cancel', async (req: Request, res: Response) => {\n    try {\n      const dodoClient = getDodoClient();\n      if (!dodoClient) {\n        return res.status(503).json({ error: 'Payment system not configured' });\n      }\n\n      if (!db) {\n        return res.status(503).json({\n          error: 'Database not available',\n          message:\n            'Please configure DATABASE_URL to enable subscription cancellation',\n        });\n      }\n\n      const { userId } = req.body;\n\n      const [user] = await db.select().from(users).where(eq(users.id, userId));\n\n      if (!user || !user.subscriptionId) {\n        return res.status(400).json({ error: 'No active subscription' });\n      }\n\n      await dodoClient.subscriptions.update(user.subscriptionId, {\n        status: 'cancelled',\n      });\n\n      await db\n        .update(users)\n        .set({\n          subscriptionStatus: 'cancelled',\n          tier: 'enterprise',\n        })\n        .where(eq(users.id, userId));\n\n      res.json({ success: true, message: 'Subscription cancelled' });\n    } catch (error) {\n      console.error('Cancel subscription error:', error);\n      res.status(500).json({ error: 'Failed to cancel subscription' });\n    }\n  });\n\n  // ---------------------------------------------------------------------------\n  // Webhook Handler\n  // ---------------------------------------------------------------------------\n\n  app.post('/api/webhooks/dodo', async (req: Request, res: Response) => {\n    try {\n      // Verify signature (using Standard Webhooks format)\n      const webhookId = req.headers['webhook-id'] as string;\n      const webhookSignature = req.headers['webhook-signature'] as string;\n      const webhookTimestamp = req.headers['webhook-timestamp'] as string;\n\n      // CRITICAL: Validate webhook signature to prevent fake payment events\n      if (!webhookId || !webhookSignature || !webhookTimestamp) {\n        console.error('Missing webhook signature headers');\n        return res.status(400).json({ error: 'Invalid webhook signature' });\n      }\n\n      if (!DODO_WEBHOOK_SECRET) {\n        console.error('DODO_WEBHOOK_SECRET not configured');\n        return res.status(500).json({ error: 'Webhook secret not configured' });\n      }\n\n      // Verify timestamp is recent (within 5 minutes)\n      const timestamp = parseInt(webhookTimestamp);\n      const now = Math.floor(Date.now() / 1000);\n      if (Math.abs(now - timestamp) > 300) {\n        // 5 minutes\n        console.error('Webhook timestamp too old');\n        return res.status(400).json({ error: 'Webhook timestamp expired' });\n      }\n\n      // Verify signature using Standard Webhooks format\n      const crypto = await import('crypto');\n      const signedPayload = `${webhookId}.${webhookTimestamp}.${JSON.stringify(req.body)}`;\n      const expectedSignature = crypto\n        .createHmac('sha256', DODO_WEBHOOK_SECRET)\n        .update(signedPayload, 'utf8')\n        .digest('base64');\n\n      // Standard Webhooks uses v1,signature format\n      const signatureParts = webhookSignature.split(',');\n      const signature = signatureParts\n        .find(part => part.startsWith('v1,'))\n        ?.replace('v1,', '');\n\n      if (\n        !signature ||\n        !crypto.timingSafeEqual(\n          Buffer.from(signature, 'base64'),\n          Buffer.from(expectedSignature, 'base64')\n        )\n      ) {\n        console.error('Invalid webhook signature');\n        return res.status(400).json({ error: 'Invalid webhook signature' });\n      }\n\n      //  IDEMPOTENCY CHECK: Prevent duplicate webhook processing\n      // If we've already processed this webhook ID recently, skip it\n      if (processedWebhooks.has(webhookId)) {\n        console.log('Webhook already processed (duplicate):', {\n          id: webhookId,\n          type: req.body?.type,\n        });\n        // Return 200 OK to acknowledge receipt without reprocessing\n        return res.json({ received: true, duplicate: true });\n      }\n\n      // Log webhook receipt\n      console.log('Webhook received and verified:', {\n        id: webhookId,\n        type: req.body?.type,\n        timestamp: webhookTimestamp,\n      });\n\n      // Mark this webhook as processed\n      processedWebhooks.set(webhookId, Date.now());\n\n      const event = req.body;\n\n      switch (event.type) {\n        case 'subscription.active': {\n          const subscription = event.data;\n          await handleSubscriptionActive(subscription);\n          break;\n        }\n        case 'subscription.on_hold': {\n          const subscription = event.data;\n          await handleSubscriptionOnHold(subscription);\n          break;\n        }\n        case 'subscription.failed': {\n          const subscription = event.data;\n          await handleSubscriptionFailed(subscription);\n          break;\n        }\n        case 'subscription.renewed': {\n          const subscription = event.data;\n          await handleSubscriptionRenewed(subscription);\n          break;\n        }\n        case 'subscription.cancelled': {\n          const subscription = event.data;\n          await handleSubscriptionCancelled(subscription);\n          break;\n        }\n        case 'payment.succeeded': {\n          await handlePaymentSucceeded(event.data);\n          break;\n        }\n        case 'payment.failed': {\n          console.log('Payment failed:', event.data.payment_id);\n          break;\n        }\n        default:\n          console.log('Unhandled webhook event:', event.type);\n      }\n\n      res.json({ received: true });\n    } catch (error) {\n      console.error('Webhook error:', error);\n      res.status(500).json({ error: 'Webhook processing failed' });\n    }\n  });\n\n  // ---------------------------------------------------------------------------\n  // Credit Pack Info\n  // ---------------------------------------------------------------------------\n\n  app.get('/api/credits/packs', (req: Request, res: Response) => {\n    res.json({\n      packs: CREDIT_PACKS,\n      costs: {\n        standard_image: 1,\n        raw_image: 2,\n        video: 3,\n        audio: 2,\n        pdf: 1,\n      },\n      description: '1 credit = 1 standard file extraction',\n    });\n  });\n}\n\n// ============================================================================\n// Webhook Handlers\n// ============================================================================\n\nasync function handleSubscriptionActive(subscription: any) {\n  if (!db) {\n    console.warn('handleSubscriptionActive skipped: database not configured');\n    return;\n  }\n\n  const { subscription_id, customer, metadata } = subscription;\n  const tier = normalizeTier(metadata?.tier || 'enterprise');\n  const userId = metadata?.user_id;\n\n  console.log(`Subscription ${subscription_id} activated for tier ${tier}`);\n\n  if (userId && userId !== 'anonymous') {\n    await db\n      .update(users)\n      .set({\n        tier,\n        subscriptionId: subscription_id,\n        subscriptionStatus: 'active',\n        customerId: customer?.customer_id,\n      })\n      .where(eq(users.id, userId));\n  }\n\n  // Update or create subscription record\n  const existingSub = await db\n    .select()\n    .from(subscriptions)\n    .where(eq(subscriptions.dodoSubscriptionId, subscription_id));\n\n  if (existingSub.length === 0 && userId && userId !== 'anonymous') {\n    await db.insert(subscriptions).values({\n      userId,\n      dodoSubscriptionId: subscription_id,\n      dodoCustomerId: customer?.customer_id || '',\n      tier,\n      status: 'active',\n    });\n  } else if (existingSub.length > 0) {\n    await db\n      .update(subscriptions)\n      .set({ status: 'active', tier })\n      .where(eq(subscriptions.dodoSubscriptionId, subscription_id));\n  }\n}\n\nasync function handleSubscriptionOnHold(subscription: any) {\n  if (!db) {\n    console.warn('handleSubscriptionOnHold skipped: database not configured');\n    return;\n  }\n\n  const { subscription_id } = subscription;\n\n  console.log(`Subscription ${subscription_id} on hold`);\n\n  await db\n    .update(subscriptions)\n    .set({ status: 'on_hold' })\n    .where(eq(subscriptions.dodoSubscriptionId, subscription_id));\n\n  const [sub] = await db\n    .select()\n    .from(subscriptions)\n    .where(eq(subscriptions.dodoSubscriptionId, subscription_id));\n\n  if (sub) {\n    await db\n      .update(users)\n      .set({ subscriptionStatus: 'on_hold' })\n      .where(eq(users.id, sub.userId));\n  }\n}\n\nasync function handleSubscriptionFailed(subscription: any) {\n  if (!db) {\n    console.warn('handleSubscriptionFailed skipped: database not configured');\n    return;\n  }\n\n  const { subscription_id } = subscription;\n\n  console.log(`Subscription ${subscription_id} failed`);\n\n  await db\n    .update(subscriptions)\n    .set({ status: 'failed' })\n    .where(eq(subscriptions.dodoSubscriptionId, subscription_id));\n\n  const [sub] = await db\n    .select()\n    .from(subscriptions)\n    .where(eq(subscriptions.dodoSubscriptionId, subscription_id));\n\n  if (sub) {\n    await db\n      .update(users)\n      .set({\n        subscriptionStatus: 'failed',\n        tier: 'free', // FIXED: Failed subscriptions should downgrade to free, not upgrade to enterprise\n      })\n      .where(eq(users.id, sub.userId));\n  }\n}\n\nasync function handleSubscriptionRenewed(subscription: any) {\n  if (!db) {\n    console.warn('handleSubscriptionRenewed skipped: database not configured');\n    return;\n  }\n\n  const { subscription_id } = subscription;\n\n  console.log(`Subscription ${subscription_id} renewed`);\n\n  await db\n    .update(subscriptions)\n    .set({\n      status: 'active',\n      updatedAt: new Date(),\n    })\n    .where(eq(subscriptions.dodoSubscriptionId, subscription_id));\n}\n\nasync function handleSubscriptionCancelled(subscription: any) {\n  if (!db) {\n    console.warn(\n      'handleSubscriptionCancelled skipped: database not configured'\n    );\n    return;\n  }\n\n  const { subscription_id } = subscription;\n\n  console.log(`Subscription ${subscription_id} cancelled`);\n\n  await db\n    .update(subscriptions)\n    .set({ status: 'cancelled' })\n    .where(eq(subscriptions.dodoSubscriptionId, subscription_id));\n\n  const [sub] = await db\n    .select()\n    .from(subscriptions)\n    .where(eq(subscriptions.dodoSubscriptionId, subscription_id));\n\n  if (sub) {\n    await db\n      .update(users)\n      .set({\n        subscriptionStatus: 'cancelled',\n        tier: 'free', // FIXED: Cancelled subscriptions should downgrade to free, not upgrade to enterprise\n      })\n      .where(eq(users.id, sub.userId));\n  }\n}\n\nasync function handlePaymentSucceeded(data: any) {\n  console.log('Payment succeeded:', data.payment_id);\n\n  const metadata = data.metadata;\n\n  // Handle credit purchases\n  if (metadata?.type === 'credit_purchase') {\n    const credits = parseInt(metadata.credits || '0');\n    const balanceId = metadata.balance_id;\n    const pack = metadata.pack;\n\n    if (credits > 0 && balanceId) {\n      await storage.addCredits(\n        balanceId,\n        credits,\n        `Purchased ${pack} pack`,\n        data.payment_id\n      );\n      console.log(`Added ${credits} credits to balance ${balanceId}`);\n    }\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/rateLimitExamples.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'rateLimitMiddlewareCollection' is defined but never used.","line":18,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'next' is defined but never used. Allowed unused args must match /^_/u.","line":29,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":159,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4486,4489],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4486,4489],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":169,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":169,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4837,4840],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4837,4840],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":273,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":273,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7949,7952],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7949,7952],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":333,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":333,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9823,9826],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9823,9826],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":340,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":340,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10060,10063],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10060,10063],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is defined but never used. Allowed unused args must match /^_/u.","line":390,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":390,"endColumn":38},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":390,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":390,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11453,11456],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11453,11456],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'credentials' is defined but never used. Allowed unused args must match /^_/u.","line":395,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":395,"endColumn":44},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":395,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":395,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11575,11578],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11575,11578],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userData' is defined but never used. Allowed unused args must match /^_/u.","line":400,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":400,"endColumn":37},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":400,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":400,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11680,11683],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11680,11683],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'emailData' is defined but never used. Allowed unused args must match /^_/u.","line":405,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":405,"endColumn":47},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":405,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":405,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11791,11794],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11791,11794],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'query' is defined but never used. Allowed unused args must match /^_/u.","line":420,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":420,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":420,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":420,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12096,12099],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12096,12099],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is defined but never used. Allowed unused args must match /^_/u.","line":425,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":425,"endColumn":36},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":425,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":425,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12197,12200],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12197,12200],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'req' is defined but never used. Allowed unused args must match /^_/u.","line":435,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":435,"endColumn":36},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":435,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":435,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12396,12399],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12396,12399],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is defined but never used. Allowed unused args must match /^_/u.","line":445,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":445,"endColumn":33},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":445,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":445,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12597,12600],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12597,12600],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":23,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Rate Limiting Integration Examples\n *\n * Shows how to integrate the Redis-backed rate limiting layer into existing MetaExtract routes\n */\n\nimport { Router } from 'express';\nimport { rateLimitManager } from './rateLimitRedis';\nimport {\n  rateLimitMiddleware,\n  rateLimitExtraction,\n  rateLimitAuth,\n  rateLimitAPI,\n  rateLimitPublic,\n  rateLimitErrorHandler,\n  shouldSkipRateLimit,\n  combineSkipConditions,\n  rateLimitMiddlewareCollection,\n} from './rateLimitMiddleware';\n\n// ============================================================================\n// Example 1: Basic API Rate Limiting\n// ============================================================================\n\nexport function setupAPIRateLimiting(router: Router): void {\n  // Apply tier-based rate limiting to all API routes\n  router.use('/api',\n    rateLimitAPI(),\n    async (req, res, next) => {\n      // Your normal API logic here\n      res.json({ message: 'API response' });\n    }\n  );\n}\n\n// ============================================================================\n// Example 2: Metadata Extraction Rate Limiting\n// ============================================================================\n\nexport function setupExtractionRateLimiting(router: Router): void {\n  // POST /api/extract - Expensive operation, stricter rate limits\n  router.post('/extract',\n    rateLimitExtraction({\n      enabled: true,\n      skipRateLimit: combineSkipConditions(\n        shouldSkipRateLimit.adminUser,\n        shouldSkipRateLimit.healthCheck\n      ),\n    }),\n    async (req, res) => {\n      // Expensive metadata extraction logic\n      const metadata = await performExtraction(req.body);\n\n      res.json(metadata);\n    }\n  );\n}\n\n// ============================================================================\n// Example 3: Authentication Rate Limiting\n// ============================================================================\n\nexport function setupAuthRateLimiting(router: Router): void {\n  // POST /api/auth/login - IP-based rate limiting\n  router.post('/auth/login',\n    rateLimitAuth({\n      enabled: true,\n      endpoints: {\n        requestsPerMinute: 5,   // Very strict for login\n        requestsPerDay: 50,\n      },\n    }),\n    async (req, res) => {\n      // Authentication logic\n      const result = await authenticateUser(req.body);\n\n      res.json(result);\n    }\n  );\n\n  // POST /api/auth/register - IP-based rate limiting\n  router.post('/auth/register',\n    rateLimitAuth({\n      enabled: true,\n      endpoints: {\n        requestsPerMinute: 3,   // Even stricter for registration\n        requestsPerDay: 10,\n      },\n    }),\n    async (req, res) => {\n      // Registration logic\n      const result = await registerUser(req.body);\n\n      res.json(result);\n    }\n  );\n\n  // POST /api/auth/forgot-password - Rate limit password reset\n  router.post('/auth/forgot-password',\n    rateLimitAuth({\n      enabled: true,\n      endpoints: {\n        requestsPerMinute: 3,\n        requestsPerDay: 10,\n      },\n    }),\n    async (req, res) => {\n      // Password reset logic\n      const result = await initiatePasswordReset(req.body);\n\n      res.json(result);\n    }\n  );\n}\n\n// ============================================================================\n// Example 4: Public Endpoint Rate Limiting\n// ============================================================================\n\nexport function setupPublicRateLimiting(router: Router): void {\n  // GET /api/public/tiers - Public tier information\n  router.get('/public/tiers',\n    rateLimitPublic({\n      enabled: true,\n    }),\n    async (req, res) => {\n      // Fetch public tier information\n      const tiers = await getPublicTiers();\n\n      res.json(tiers);\n    }\n  );\n\n  // GET /api/public/features - Public feature list\n  router.get('/public/features',\n    rateLimitPublic({\n      enabled: true,\n    }),\n    async (req, res) => {\n      // Fetch public features\n      const features = await getPublicFeatures();\n\n      res.json(features);\n    }\n  );\n}\n\n// ============================================================================\n// Example 5: Custom Rate Limiting with Conditions\n// ============================================================================\n\nexport function setupCustomRateLimiting(router: Router): void {\n  // Custom rate limiting for search endpoints\n  router.get('/search',\n    rateLimitMiddleware({\n      enabled: true,\n      keyGenerator: (req) => {\n        // Generate unique key based on user and search query\n        const userId = (req as any).user?.id || 'anonymous';\n        const query = req.query.q?.toString().substring(0, 20) || 'default';\n        return `search:${userId}:${query}`;\n      },\n      endpoints: {\n        requestsPerMinute: 20,\n        requestsPerDay: 500,\n      },\n      skipRateLimit: (req) => {\n        // Skip rate limiting for premium users\n        return (req as any).user?.tier === 'premium';\n      },\n    }),\n    async (req, res) => {\n      // Search logic\n      const results = await performSearch(req.query);\n\n      res.json(results);\n    }\n  );\n}\n\n// ============================================================================\n// Example 6: Admin Endpoints with No Rate Limiting\n// ============================================================================\n\nexport function setupAdminEndpoints(router: Router): void {\n  // Admin endpoints - skip rate limiting for admin users\n  router.post('/admin/cache/clear',\n    rateLimitMiddleware({\n      enabled: true,\n      skipRateLimit: shouldSkipRateLimit.adminUser,\n    }),\n    async (req, res) => {\n      // Admin cache clearing logic\n      const result = await clearAdminCache(req.body);\n\n      res.json(result);\n    }\n  );\n\n  // GET /api/admin/metrics - No rate limiting for admins\n  router.get('/admin/metrics',\n    rateLimitMiddleware({\n      enabled: true,\n      skipRateLimit: shouldSkipRateLimit.adminUser,\n    }),\n    async (req, res) => {\n      // Admin metrics logic\n      const metrics = await getAdminMetrics();\n\n      res.json(metrics);\n    }\n  );\n}\n\n// ============================================================================\n// Example 7: Rate Limit Monitoring Endpoints\n// ============================================================================\n\nexport function setupRateLimitMonitoring(router: Router): void {\n  // GET /api/admin/rate-limit/metrics - Get rate limit metrics\n  router.get('/admin/rate-limit/metrics',\n    async (req, res) => {\n      try {\n        const metrics = await rateLimitManager.getMetrics();\n\n        res.json({\n          success: true,\n          data: metrics,\n        });\n      } catch (error) {\n        res.status(500).json({\n          error: 'Failed to retrieve rate limit metrics',\n          details: error instanceof Error ? error.message : 'Unknown error',\n        });\n      }\n    }\n  );\n\n  // POST /api/admin/rate-limit/reset/:identifier - Reset rate limit for specific user/IP\n  router.post('/admin/rate-limit/reset/:identifier',\n    async (req, res) => {\n      try {\n        const { identifier } = req.params;\n\n        const success = await rateLimitManager.resetRateLimit(identifier);\n\n        res.json({\n          success,\n          message: success\n            ? `Rate limit reset for ${identifier}`\n            : `Failed to reset rate limit for ${identifier}`,\n        });\n      } catch (error) {\n        res.status(500).json({\n          error: 'Rate limit reset failed',\n          details: error instanceof Error ? error.message : 'Unknown error',\n        });\n      }\n    }\n  );\n}\n\n// ============================================================================\n// Example 8: Progressive Rate Limiting\n// ============================================================================\n\nexport function setupProgressiveRateLimiting(router: Router): void {\n  // Upload endpoint with progressive rate limiting based on file size\n  router.post('/upload',\n    rateLimitMiddleware({\n      enabled: true,\n      keyGenerator: (req) => {\n        const userId = (req as any).user?.id || 'anonymous';\n        const fileSize = parseInt(req.headers['content-length'] || '0');\n        const sizeCategory = fileSize > 10 * 1024 * 1024 ? 'large' : 'small'; // 10MB threshold\n        return `upload:${userId}:${sizeCategory}`;\n      },\n      endpoints: {\n        requestsPerMinute: 10,\n        requestsPerDay: 100,\n      },\n    }),\n    async (req, res) => {\n      // File upload logic\n      const result = await handleFileUpload(req);\n\n      res.json(result);\n    }\n  );\n}\n\n// ============================================================================\n// Example 9: WebSocket Upgrade Handling\n// ============================================================================\n\nexport function setupWebSocketRateLimiting(router: Router): void {\n  // WebSocket upgrade endpoint - skip rate limiting\n  router.get('/ws',\n    rateLimitMiddleware({\n      enabled: true,\n      skipRateLimit: shouldSkipRateLimit.webSocket,\n    }),\n    async (req, res) => {\n      // WebSocket upgrade logic\n      res.status(101).send('Switching Protocols');\n    }\n  );\n}\n\n// ============================================================================\n// Example 10: Health Check Endpoint (No Rate Limiting)\n// ============================================================================\n\nexport function setupHealthCheck(router: Router): void {\n  // GET /health - No rate limiting\n  router.get('/health',\n    rateLimitMiddleware({\n      enabled: true,\n      skipRateLimit: shouldSkipRateLimit.healthCheck,\n    }),\n    async (req, res) => {\n      const health = await checkSystemHealth();\n\n      res.json(health);\n    }\n  );\n}\n\n// ============================================================================\n// Example 11: Global Rate Limiting Setup\n// ============================================================================\n\nexport function setupGlobalRateLimiting(app: any): void {\n  // Apply rate limiting to all routes\n  app.use(rateLimitAPI({\n    enabled: true,\n    skipRateLimit: combineSkipConditions(\n      shouldSkipRateLimit.webSocket,\n      shouldSkipRateLimit.healthCheck,\n      (req) => (req as any).user?.role === 'admin' // Skip for admins\n    ),\n  }));\n\n  // Add rate limit error handler\n  app.use(rateLimitErrorHandler);\n}\n\n// ============================================================================\n// Example 12: Route-Specific Rate Limit Overrides\n// ============================================================================\n\nexport function setupRouteSpecificOverrides(router: Router): void {\n  // Default rate limiting for API routes\n  router.use('/api',\n    rateLimitAPI({\n      enabled: true,\n    })\n  );\n\n  // Override with stricter rate limiting for expensive operations\n  router.post('/api/batch-process',\n    rateLimitExtraction({\n      enabled: true,\n      endpoints: {\n        requestsPerMinute: 2,  // Very strict for batch processing\n        requestsPerDay: 20,\n      },\n    }),\n    async (req, res) => {\n      // Batch processing logic\n      const result = await processBatch(req.body);\n\n      res.json(result);\n    }\n  );\n\n  // Override with no rate limiting for admin endpoints\n  router.use('/api/admin',\n    rateLimitMiddleware({\n      enabled: true,\n      skipRateLimit: shouldSkipRateLimit.adminUser,\n    })\n  );\n}\n\n// ============================================================================\n// Helper Functions (to be implemented)\n// ============================================================================\n\nasync function performExtraction(data: any) {\n  // Implementation would perform metadata extraction\n  return {};\n}\n\nasync function authenticateUser(credentials: any) {\n  // Implementation would authenticate user\n  return {};\n}\n\nasync function registerUser(userData: any) {\n  // Implementation would register user\n  return {};\n}\n\nasync function initiatePasswordReset(emailData: any) {\n  // Implementation would initiate password reset\n  return {};\n}\n\nasync function getPublicTiers() {\n  // Implementation would fetch public tiers\n  return [];\n}\n\nasync function getPublicFeatures() {\n  // Implementation would fetch public features\n  return [];\n}\n\nasync function performSearch(query: any) {\n  // Implementation would perform search\n  return {};\n}\n\nasync function clearAdminCache(data: any) {\n  // Implementation would clear admin cache\n  return {};\n}\n\nasync function getAdminMetrics() {\n  // Implementation would get admin metrics\n  return {};\n}\n\nasync function handleFileUpload(req: any) {\n  // Implementation would handle file upload\n  return {};\n}\n\nasync function checkSystemHealth() {\n  // Implementation would check system health\n  return {};\n}\n\nasync function processBatch(data: any) {\n  // Implementation would process batch\n  return {};\n}","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/rateLimitMiddleware.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AuthRequest' is defined but never used.","line":10,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1326,1329],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1326,1329],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1370,1373],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1370,1373],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1646,1649],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1646,1649],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'endpoints' is assigned a value but never used.","line":72,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":72,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2647,2650],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2647,2650],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":89,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2709,2712],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2709,2712],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2752,2755],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2752,2755],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":142,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4533,4536],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4533,4536],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":143,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4592,4595],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4592,4595],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":268,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":268,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7818,7821],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7818,7821],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":276,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":276,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8062,8065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8062,8065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":276,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":276,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8104,8107],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8104,8107],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":13,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Rate Limiting Middleware for Express Routes\n *\n * Provides Redis-backed distributed rate limiting with configurable\n * strategies, tier-based limits, and real-time monitoring integration.\n */\n\nimport { Request, Response, NextFunction } from 'express';\nimport { rateLimitManager, RateLimitStrategy } from './rateLimitRedis';\nimport type { AuthRequest } from './auth';\n\n// ============================================================================\n// Rate Limit Middleware Options\n// ============================================================================\n\nexport interface RateLimitMiddlewareOptions {\n  enabled?: boolean;\n  strategy?: RateLimitStrategy;\n  keyGenerator?: (req: Request) => string;\n  skipRateLimit?: (req: Request) => boolean;\n  tierBased?: boolean;\n  ipBased?: boolean;\n  endpoints?: {\n    requestsPerMinute: number;\n    requestsPerDay: number;\n    burstLimit?: number;\n  };\n}\n\nexport interface RateLimitResponse extends Response {\n  _rateLimited?: boolean;\n  _rateLimitKey?: string;\n}\n\n// ============================================================================\n// Default Key Generators\n// ============================================================================\n\nexport const defaultKeyGenerator = (req: Request): string => {\n  // For authenticated requests, use user ID\n  if ((req as any).user?.id) {\n    return `user:${(req as any).user.id}`;\n  }\n\n  // For anonymous requests, use IP address\n  return `ip:${req.ip}`;\n};\n\nexport const ipBasedKeyGenerator = (req: Request): string => {\n  return `ip:${req.ip}`;\n};\n\nexport const userBasedKeyGenerator = (req: Request): string => {\n  const userId = (req as any).user?.id;\n  if (!userId) {\n    throw new Error('User not authenticated for user-based rate limiting');\n  }\n  return `user:${userId}`;\n};\n\n// ============================================================================\n// Rate Limit Middleware Factory\n// ============================================================================\n\nexport function rateLimitMiddleware(options: RateLimitMiddlewareOptions = {}) {\n  const {\n    enabled = true,\n    keyGenerator = defaultKeyGenerator,\n    skipRateLimit = () => false,\n    tierBased = true,\n    ipBased = false,\n    endpoints,\n  } = options;\n\n  return async (req: Request, res: RateLimitResponse, next: NextFunction) => {\n    // Skip rate limiting if disabled or should skip\n    if (!enabled || skipRateLimit(req)) {\n      return next();\n    }\n\n    try {\n      const rateLimitKey = keyGenerator(req);\n      res._rateLimitKey = rateLimitKey;\n\n      let result;\n\n      // Tier-based rate limiting for authenticated users\n      if (tierBased && (req as any).user?.tier && !ipBased) {\n        const userId = (req as any).user.id;\n        const tier = (req as any).user.tier;\n\n        result = await rateLimitManager.checkUserRateLimit(userId, tier);\n\n        // Add tier-specific headers\n        res.setHeader('X-RateLimit-Tier', tier);\n      }\n      // IP-based rate limiting for anonymous requests or when forced\n      else {\n        const ip = req.ip || req.socket?.remoteAddress || 'unknown';\n        result = await rateLimitManager.checkIPRateLimit(ip);\n\n        res.setHeader('X-RateLimit-Type', 'IP');\n      }\n\n      // Set rate limit headers\n      res.setHeader('X-RateLimit-Limit', result.remaining.toString());\n      res.setHeader('X-RateLimit-Remaining', result.remaining.toString());\n      res.setHeader('X-RateLimit-Reset', new Date(Date.now() + 60000).toISOString());\n\n      if (!result.allowed) {\n        res._rateLimited = true;\n\n        return res.status(429).json({\n          error: 'Too Many Requests',\n          message: 'Rate limit exceeded. Please try again later.',\n          retryAfter: result.retryAfter,\n          resetTime: new Date(Date.now() + (result.retryAfter || 60) * 1000).toISOString(),\n        });\n      }\n\n      next();\n    } catch (error) {\n      console.error('Rate limit middleware error:', error);\n      // Continue without rate limiting on error\n      next();\n    }\n  };\n}\n\n// ============================================================================\n// Specialized Rate Limit Middleware\n// ============================================================================\n\n/**\n * Rate limit middleware for metadata extraction endpoints\n */\nexport function rateLimitExtraction(options: Partial<RateLimitMiddlewareOptions> = {}) {\n  return rateLimitMiddleware({\n    ...options,\n    keyGenerator: (req) => {\n      // More aggressive rate limiting for extraction (expensive operation)\n      if ((req as any).user?.id) {\n        return `extraction:user:${(req as any).user.id}`;\n      }\n      return `extraction:ip:${req.ip}`;\n    },\n    tierBased: true,\n  });\n}\n\n/**\n * Rate limit middleware for authentication endpoints\n */\nexport function rateLimitAuth(options: Partial<RateLimitMiddlewareOptions> = {}) {\n  return rateLimitMiddleware({\n    ...options,\n    keyGenerator: ipBasedKeyGenerator, // Always IP-based for auth\n    tierBased: false,\n    ipBased: true,\n    endpoints: {\n      requestsPerMinute: 10,  // Stricter for auth endpoints\n      requestsPerDay: 100,\n    },\n  });\n}\n\n/**\n * Rate limit middleware for API endpoints\n */\nexport function rateLimitAPI(options: Partial<RateLimitMiddlewareOptions> = {}) {\n  return rateLimitMiddleware({\n    ...options,\n    tierBased: true,\n    skipRateLimit: (req) => {\n      // Skip rate limiting for health checks\n      return req.path === '/health' || req.path === '/api/health';\n    },\n  });\n}\n\n/**\n * Rate limit middleware for public endpoints\n */\nexport function rateLimitPublic(options: Partial<RateLimitMiddlewareOptions> = {}) {\n  return rateLimitMiddleware({\n    ...options,\n    keyGenerator: ipBasedKeyGenerator,\n    tierBased: false,\n    ipBased: true,\n    endpoints: {\n      requestsPerMinute: 30,\n      requestsPerDay: 500,\n    },\n  });\n}\n\n// ============================================================================\n// Rate Limit Monitoring Middleware\n// ============================================================================\n\n/**\n * Add rate limit metrics to response headers\n */\nexport function rateLimitMetrics(req: Request, res: Response, next: NextFunction) {\n  res.setHeader('X-RateLimit-Enabled', 'true');\n  next();\n}\n\n/**\n * Rate limit monitoring endpoint\n */\nexport async function getRateLimitMetrics(req: Request, res: Response): Promise<void> {\n  try {\n    const metrics = await rateLimitManager.getMetrics();\n    res.json(metrics);\n  } catch (error) {\n    res.status(500).json({\n      error: 'Failed to retrieve rate limit metrics',\n      details: error instanceof Error ? error.message : 'Unknown error'\n    });\n  }\n}\n\n/**\n * Rate limit reset endpoint (admin only)\n */\nexport async function resetRateLimit(req: Request, res: Response): Promise<void> {\n  try {\n    const { identifier } = req.params;\n\n    if (!identifier) {\n      res.status(400).json({\n        error: 'Identifier is required'\n      });\n      return;\n    }\n\n    const success = await rateLimitManager.resetRateLimit(identifier);\n\n    res.json({\n      success,\n      message: success\n        ? `Rate limit reset for ${identifier}`\n        : `Failed to reset rate limit for ${identifier}`\n    });\n  } catch (error) {\n    res.status(500).json({\n      error: 'Rate limit reset failed',\n      details: error instanceof Error ? error.message : 'Unknown error'\n    });\n  }\n}\n\n// ============================================================================\n// Rate Limit Control Helpers\n// ============================================================================\n\n/**\n * Check if request should skip rate limiting\n */\nexport const shouldSkipRateLimit = {\n  // Skip for WebSocket upgrades\n  webSocket: (req: Request) =>\n    req.headers.upgrade?.toLowerCase() === 'websocket',\n\n  // Skip for admin users\n  adminUser: (req: Request) =>\n    (req as any).user?.role === 'admin',\n\n  // Skip for health checks\n  healthCheck: (req: Request) =>\n    req.path === '/health' || req.path === '/api/health',\n\n  // Skip for specific user roles\n  roles: (roles: string[]) => (req: Request) =>\n    (req as any).user?.role && roles.includes((req as any).user.role),\n};\n\n/**\n * Combine multiple skip conditions\n */\nexport function combineSkipConditions(...conditions: Array<(req: Request) => boolean>) {\n  return (req: Request) => conditions.some(condition => condition(req));\n}\n\n// ============================================================================\n// Rate Limit Error Handling\n// ============================================================================\n\n/**\n * Custom rate limit error handler\n */\nexport function rateLimitErrorHandler(err: Error, req: Request, res: Response, next: NextFunction) {\n  if (err.message.includes('Rate limit')) {\n    return res.status(429).json({\n      error: 'Too Many Requests',\n      message: err.message,\n      retryAfter: 60,\n    });\n  }\n\n  next(err);\n}\n\n// ============================================================================\n// Export rate limit middleware collections\n// ============================================================================\n\nexport const rateLimitMiddlewareCollection = {\n  // General purpose\n  api: rateLimitAPI,\n\n  // Specific endpoint types\n  extraction: rateLimitExtraction,\n  auth: rateLimitAuth,\n  public: rateLimitPublic,\n\n  // Monitoring\n  metrics: rateLimitMetrics,\n\n  // Error handling\n  errorHandler: rateLimitErrorHandler,\n};","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/rateLimitRedis.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Request' is defined but never used.","line":13,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Response' is defined but never used.","line":13,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'NextFunction' is defined but never used.","line":13,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":46},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AuthRequest' is defined but never used.","line":14,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'normalizeTier' is defined but never used.","line":15,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Redis-Backed Distributed Rate Limiting\n *\n * Replaces in-memory rate limiting with Redis-based solution for:\n * - Distributed rate limiting across multiple server instances\n * - Persistent rate limit state across restarts\n * - Sliding window algorithm with Redis sorted sets\n * - Tier-based and IP-based rate limiting\n * - Real-time monitoring and metrics\n */\n\nimport { createClient, RedisClientType } from 'redis';\nimport type { Request, Response, NextFunction } from 'express';\nimport type { AuthRequest } from './auth';\nimport { getRateLimits, normalizeTier } from '@shared/tierConfig';\n\n// ============================================================================\n// Configuration\n// ============================================================================\n\nexport interface RateLimitConfig {\n  enabled: boolean;\n  redisUrl: string;\n  defaultLimits: {\n    requestsPerMinute: number;\n    requestsPerDay: number;\n    burstLimit: number;\n  };\n}\n\nexport const DEFAULT_RATE_LIMIT_CONFIG: RateLimitConfig = {\n  enabled: process.env.RATE_LIMIT_ENABLED !== 'false',\n  redisUrl: process.env.REDIS_URL || 'redis://localhost:6379',\n  defaultLimits: {\n    requestsPerMinute: 60,\n    requestsPerDay: 1000,\n    burstLimit: 10,\n  },\n};\n\n// ============================================================================\n// Rate Limit Strategies\n// ============================================================================\n\nexport enum RateLimitStrategy {\n  SLIDING_WINDOW = 'sliding_window',  // Precise, Redis-backed\n  TOKEN_BUCKET = 'token_bucket',      // Smooth rate limiting\n  FIXED_WINDOW = 'fixed_window',      // Simple, can have edge effects\n}\n\n// ============================================================================\n// Rate Limit Manager\n// ============================================================================\n\nexport class RateLimitManager {\n  private client: RedisClientType | null = null;\n  private config: RateLimitConfig;\n  private metrics: RateLimitMetrics;\n  private initialized: boolean = false;\n  \n  // In-memory fallback for when Redis is unavailable\n  private inMemoryFallback = new Map<string, { count: number; windowStart: number }>();\n  private fallbackWindowMs = 60000; // 1 minute window\n  private fallbackCleanupInterval: NodeJS.Timeout | null = null;\n\n  constructor(config: Partial<RateLimitConfig> = {}) {\n    this.config = { ...DEFAULT_RATE_LIMIT_CONFIG, ...config };\n    this.metrics = new RateLimitMetrics();\n    this.startFallbackCleanup();\n  }\n  \n  /**\n   * Start periodic cleanup of in-memory fallback entries\n   */\n  private startFallbackCleanup(): void {\n    if (this.fallbackCleanupInterval) return;\n    \n    this.fallbackCleanupInterval = setInterval(() => {\n      const now = Date.now();\n      for (const [key, entry] of this.inMemoryFallback.entries()) {\n        if (now - entry.windowStart > this.fallbackWindowMs * 2) {\n          this.inMemoryFallback.delete(key);\n        }\n      }\n    }, this.fallbackWindowMs);\n    \n    if (typeof this.fallbackCleanupInterval.unref === 'function') {\n      this.fallbackCleanupInterval.unref();\n    }\n  }\n  \n  /**\n   * In-memory rate limit check when Redis is unavailable\n   * Uses conservative limits to prevent abuse during Redis outages\n   */\n  private checkInMemoryFallback(\n    identifier: string, \n    limits: { requestsPerMinute: number; requestsPerDay: number }\n  ): { allowed: boolean; remaining: number } {\n    const now = Date.now();\n    const entry = this.inMemoryFallback.get(identifier);\n    \n    // Conservative limit during Redis outage (50% of normal)\n    const fallbackLimit = Math.max(1, Math.floor(limits.requestsPerMinute / 2));\n    \n    if (!entry || now - entry.windowStart > this.fallbackWindowMs) {\n      this.inMemoryFallback.set(identifier, { count: 1, windowStart: now });\n      return { allowed: true, remaining: fallbackLimit - 1 };\n    }\n    \n    if (entry.count >= fallbackLimit) {\n      return { allowed: false, remaining: 0 };\n    }\n    \n    entry.count++;\n    return { allowed: true, remaining: fallbackLimit - entry.count };\n  }\n\n  async initialize(): Promise<void> {\n    if (!this.config.enabled) {\n      console.log(' Rate limiting disabled');\n      return;\n    }\n\n    try {\n      this.client = createClient({\n        url: this.config.redisUrl,\n        socket: {\n          reconnectStrategy: (retries: number) => {\n            if (retries > 10) {\n              console.error(' Redis reconnection failed for rate limiting');\n              return new Error('Reconnection failed');\n            }\n            return Math.min(retries * 100, 3000);\n          },\n        },\n      });\n\n      this.client.on('error', (err: Error) => {\n        console.error(' Rate limiter Redis error:', err);\n        this.metrics.incrementError();\n      });\n\n      this.client.on('connect', () => {\n        console.log(' Rate limiter Redis connected');\n        this.initialized = true;\n      });\n\n      await this.client.connect();\n      console.log(' Redis-backed rate limiting initialized');\n    } catch (error) {\n      console.error(' Failed to initialize rate limiting:', error);\n      this.client = null;\n      this.initialized = false;\n    }\n  }\n\n  // ============================================================================\n  // Sliding Window Rate Limiting\n  // ============================================================================\n\n  async checkRateLimit(\n    identifier: string,\n    limits: {\n      requestsPerMinute: number;\n      requestsPerDay: number;\n      burstLimit?: number;\n    }\n  ): Promise<{\n    allowed: boolean;\n    remaining: number;\n    resetTime: number;\n    retryAfter?: number;\n  }> {\n    if (!this.client || !this.initialized) {\n      // If rate limiting is disabled, always allow\n      return {\n        allowed: true,\n        remaining: limits.requestsPerMinute,\n        resetTime: Date.now() + 60000,\n      };\n    }\n\n    try {\n      const now = Date.now();\n      const oneMinuteAgo = now - 60000;\n      const oneDayAgo = now - 86400000;\n\n      // Check minute-level limit using sliding window\n      const minuteKey = `ratelimit:minute:${identifier}`;\n      await this.client.zRemRangeByScore(minuteKey, oneMinuteAgo, now);\n      const minuteCount = await this.client.zCount(minuteKey, oneMinuteAgo, now);\n\n      // Check day-level limit\n      const dayKey = `ratelimit:day:${identifier}`;\n      await this.client.zRemRangeByScore(dayKey, oneDayAgo, now);\n      const dayCount = await this.client.zCount(dayKey, oneDayAgo, now);\n\n      const minuteRequests = Number(minuteCount || 0);\n      const dayRequests = Number(dayCount || 0);\n\n      // Check if limits are exceeded\n      const minuteExceeded = minuteRequests >= limits.requestsPerMinute;\n      const dayExceeded = dayRequests >= limits.requestsPerDay;\n\n      if (minuteExceeded || dayExceeded) {\n        this.metrics.incrementBlock();\n        const retryAfter = minuteExceeded ? 60 : 86400;\n\n        return {\n          allowed: false,\n          remaining: 0,\n          resetTime: now + (retryAfter * 1000),\n          retryAfter,\n        };\n      }\n\n      // Add current request to sliding windows\n      await this.client.zAdd(minuteKey, { score: now, value: now.toString() });\n      await this.client.expire(minuteKey, 120); // 2 minutes cleanup\n\n      await this.client.zAdd(dayKey, { score: now, value: now.toString() });\n      await this.client.expire(dayKey, 172800); // 2 days cleanup\n\n      this.metrics.incrementAllow();\n\n      const remaining = Math.min(\n        limits.requestsPerMinute - minuteRequests - 1,\n        limits.requestsPerDay - dayRequests - 1\n      );\n\n      return {\n        allowed: true,\n        remaining: Math.max(0, remaining),\n        resetTime: now + 60000,\n      };\n    } catch (error) {\n      console.error(' Rate limit check error:', error);\n      this.metrics.incrementError();\n\n      // SECURITY FIX: Use in-memory fallback instead of fail-open\n      // This prevents attackers from bypassing rate limits by causing Redis errors\n      console.warn('  Using in-memory rate limit fallback due to Redis error');\n      const fallbackResult = this.checkInMemoryFallback(identifier, limits);\n      \n      if (!fallbackResult.allowed) {\n        return {\n          allowed: false,\n          remaining: 0,\n          resetTime: Date.now() + 60000,\n          retryAfter: 60,\n        };\n      }\n      \n      return {\n        allowed: true,\n        remaining: fallbackResult.remaining,\n        resetTime: Date.now() + 60000,\n      };\n    }\n  }\n\n  // ============================================================================\n  // IP-Based Rate Limiting\n  // ============================================================================\n\n  async checkIPRateLimit(ip: string): Promise<{\n    allowed: boolean;\n    remaining: number;\n    retryAfter?: number;\n  }> {\n    const limits = {\n      requestsPerMinute: 30,  // Stricter for anonymous\n      requestsPerDay: 500,\n    };\n\n    const result = await this.checkRateLimit(`ip:${ip}`, limits);\n\n    return {\n      allowed: result.allowed,\n      remaining: result.remaining,\n      retryAfter: result.retryAfter,\n    };\n  }\n\n  // ============================================================================\n  // User-Based Rate Limiting\n  // ============================================================================\n\n  async checkUserRateLimit(userId: string, tier: string): Promise<{\n    allowed: boolean;\n    remaining: number;\n    retryAfter?: number;\n  }> {\n    const tierLimits = getRateLimits(tier);\n\n    const limits = {\n      requestsPerMinute: tierLimits.requestsPerMinute,\n      requestsPerDay: tierLimits.requestsPerDay,\n    };\n\n    const result = await this.checkRateLimit(`user:${userId}`, limits);\n\n    return {\n      allowed: result.allowed,\n      remaining: result.remaining,\n      retryAfter: result.retryAfter,\n    };\n  }\n\n  // ============================================================================\n  // Admin Functions\n  // ============================================================================\n\n  async resetRateLimit(identifier: string): Promise<boolean> {\n    if (!this.client) return false;\n\n    try {\n      await this.client.del(`ratelimit:minute:${identifier}`);\n      await this.client.del(`ratelimit:day:${identifier}`);\n\n      console.log(` Rate limit reset for ${identifier}`);\n      return true;\n    } catch (error) {\n      console.error(` Failed to reset rate limit for ${identifier}:`, error);\n      return false;\n    }\n  }\n\n  async getMetrics(): Promise<RateLimitMetricsSnapshot> {\n    const snapshot = this.metrics.getSnapshot();\n\n    if (this.client) {\n      try {\n        // Get Redis info for rate limit keys\n        const minuteKeys = await this.client.keys('ratelimit:minute:*');\n        const dayKeys = await this.client.keys('ratelimit:day:*');\n\n        snapshot.activeIdentifiers = {\n          minute: minuteKeys.length,\n          day: dayKeys.length,\n        };\n      } catch (error) {\n        console.error(' Error getting rate limit metrics:', error);\n      }\n    }\n\n    return snapshot;\n  }\n\n  // ============================================================================\n  // Shutdown\n  // ============================================================================\n\n  async shutdown(): Promise<void> {\n    if (this.client) {\n      await this.client.quit();\n      this.initialized = false;\n      console.log(' Rate limiter Redis disconnected');\n    }\n  }\n}\n\n// ============================================================================\n// Rate Limit Metrics\n// ============================================================================\n\nexport class RateLimitMetrics {\n  private allowed: number = 0;\n  private blocked: number = 0;\n  private errors: number = 0;\n  private resets: number = 0;\n\n  incrementAllow(): void {\n    this.allowed++;\n  }\n\n  incrementBlock(): void {\n    this.blocked++;\n  }\n\n  incrementError(): void {\n    this.errors++;\n  }\n\n  incrementReset(): void {\n    this.resets++;\n  }\n\n  reset(): void {\n    this.allowed = 0;\n    this.blocked = 0;\n    this.errors = 0;\n    this.resets = 0;\n  }\n\n  getSnapshot(): RateLimitMetricsSnapshot {\n    const total = this.allowed + this.blocked;\n    const blockRate = total > 0 ? (this.blocked / total) * 100 : 0;\n\n    return {\n      allowed: this.allowed,\n      blocked: this.blocked,\n      errors: this.errors,\n      resets: this.resets,\n      total,\n      blockRate: blockRate.toFixed(2) + '%',\n      allowRate: (100 - blockRate).toFixed(2) + '%',\n    };\n  }\n}\n\nexport interface RateLimitMetricsSnapshot {\n  allowed: number;\n  blocked: number;\n  errors: number;\n  resets: number;\n  total: number;\n  blockRate: string;\n  allowRate: string;\n  activeIdentifiers?: {\n    minute: number;\n    day: number;\n  };\n}\n\n// ============================================================================\n// Export Singleton\n// ============================================================================\n\nexport const rateLimitManager = new RateLimitManager();","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/routes/admin.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Response' is defined but never used.","line":11,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":32},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2792,2795],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2792,2795],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":131,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":131,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":203,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":203,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":291,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":291,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8396,8399],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8396,8399],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":323,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":323,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":359,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":359,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10279,10282],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10279,10282],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":391,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":391,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":427,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":427,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12173,12176],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12173,12176],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":459,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":459,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Admin Routes Module\n *\n * Handles admin and monitoring endpoints:\n * - Analytics\n * - Performance monitoring\n * - Cache management\n * - Health checks\n */\n\nimport type { Express, Response } from 'express';\nimport path from 'path';\nimport { spawn } from 'child_process';\nimport { pythonExecutable } from '../utils/extraction-helpers';\n\n// Get the routes directory - compatible with both ESM and CommonJS\nconst projectRoot = process.cwd();\nconst currentDirPath = path.join(projectRoot, 'server', 'routes');\nimport { storage } from '../storage/index';\nimport { getRateLimitMetrics, resetRateLimit } from '../rateLimitMiddleware';\nimport {\n  adminAuthMiddleware,\n  adminRateLimitMiddleware,\n  healthCheckAuth,\n} from '../middleware/admin-auth';\nimport { sanitizeFilename } from '../security-utils';\n\n// Allowed patterns for cache clearing (whitelist)\nconst ALLOWED_CACHE_PATTERNS = [\n  /^metadata:\\*$/,\n  /^metadata:[\\w-]+$/,\n  /^quota:[\\w-]+$/,\n  /^activity:[\\w-]+$/,\n];\n\n// ============================================================================\n// Route Registration\n// ============================================================================\n\nexport function registerAdminRoutes(app: Express): void {\n  // Health check - no auth required\n  app.get('/api/health', healthCheckAuth, (req, res) => {\n    res.json({\n      status: 'ok',\n      service: 'MetaExtract API',\n      version: '2.0.0',\n      timestamp: new Date().toISOString(),\n    });\n  });\n\n  // Admin-only endpoints require authentication and rate limiting\n  app.use('/api/admin', adminAuthMiddleware);\n  app.use('/api/admin', adminRateLimitMiddleware);\n\n  // Analytics summary\n  app.get('/api/admin/analytics', async (req, res) => {\n    try {\n      const summary = await storage.getAnalyticsSummary();\n      res.json(summary);\n    } catch (error) {\n      console.error('Analytics error:', error);\n      res.status(500).json({ error: 'Failed to fetch analytics' });\n    }\n  });\n\n  // Recent extractions\n  app.get('/api/admin/extractions', async (req, res) => {\n    try {\n      const limit = parseInt(req.query.limit as string) || 50;\n      const extractions = await storage.getRecentExtractions(limit);\n      res.json(extractions);\n    } catch (error) {\n      console.error('Extractions history error:', error);\n      res.status(500).json({ error: 'Failed to fetch extractions' });\n    }\n  });\n\n  // Performance stats (admin only)\n  app.get(\n    '/api/performance/stats',\n    adminAuthMiddleware,\n    adminRateLimitMiddleware,\n    async (req, res) => {\n      try {\n        // Get cache statistics if Redis is available\n        const pythonScript = path.join(\n          currentDirPath,\n          '..',\n          'extractor',\n          'utils',\n          'cache.py'\n        );\n        const cacheStats = await new Promise<any>(resolve => {\n          const python = spawn(pythonExecutable, [\n            '-c',\n            `\nimport sys\nsys.path.append('${path.dirname(pythonScript)}')\nfrom cache import get_cache_stats\nimport json\nprint(json.dumps(get_cache_stats()))\n          `,\n          ]);\n\n          let stdout = '';\n          python.stdout.on('data', data => (stdout += data.toString()));\n          python.on('close', () => {\n            try {\n              resolve(JSON.parse(stdout));\n            } catch {\n              resolve({ available: false });\n            }\n          });\n\n          setTimeout(() => {\n            python.kill();\n            resolve({ available: false, error: 'timeout' });\n          }, 5000);\n        });\n\n        res.json({\n          cache: cacheStats,\n          server: {\n            uptime_seconds: process.uptime(),\n            memory_usage: process.memoryUsage(),\n            node_version: process.version,\n            platform: process.platform,\n          },\n          timestamp: new Date().toISOString(),\n        });\n      } catch (error) {\n        res.status(500).json({ error: 'Failed to get performance stats' });\n      }\n    }\n  );\n\n  // Cache management (admin only)\n  app.post(\n    '/api/performance/cache/clear',\n    adminAuthMiddleware,\n    adminRateLimitMiddleware,\n    async (req, res) => {\n      try {\n        let pattern = req.body.pattern || 'metadata:*';\n\n        // Validate pattern against whitelist\n        const isValidPattern = ALLOWED_CACHE_PATTERNS.some(regex =>\n          regex.test(pattern)\n        );\n        if (!isValidPattern) {\n          return res.status(400).json({\n            error: 'Invalid pattern',\n            message: 'Pattern must match one of the allowed patterns',\n            allowed_patterns: [\n              'metadata:*',\n              'metadata:<id>',\n              'quota:<id>',\n              'activity:<id>',\n            ],\n          });\n        }\n\n        // Sanitize the pattern\n        pattern = sanitizeFilename(pattern);\n\n        const pythonScript = path.join(\n          currentDirPath,\n          '..',\n          'extractor',\n          'utils',\n          'cache.py'\n        );\n        const result = await new Promise<number>(resolve => {\n          const python = spawn(pythonExecutable, [\n            '-c',\n            `\nimport sys\nsys.path.append('${path.dirname(pythonScript)}')\nfrom cache import clear_cache_pattern\nprint(clear_cache_pattern('${pattern}'))\n          `,\n          ]);\n\n          let stdout = '';\n          python.stdout.on('data', data => {\n            stdout += data.toString();\n          });\n          python.on('close', () => {\n            resolve(parseInt(stdout.trim()) || 0);\n          });\n\n          setTimeout(() => {\n            python.kill();\n            resolve(0);\n          }, 10000);\n        });\n\n        res.json({\n          success: true,\n          cleared_entries: result,\n          pattern,\n        });\n      } catch (error) {\n        res.status(500).json({ error: 'Failed to clear cache' });\n      }\n    }\n  );\n\n  // Rate limiting for admin endpoints\n  app.get('/api/admin/rate-limit/metrics', async (req, res) => {\n    try {\n      await getRateLimitMetrics(req, res);\n    } catch (error) {\n      res.status(500).json({\n        error: 'Failed to retrieve rate limit metrics',\n        details: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  });\n\n  // Refund eligibility helper (admin): 7-day unused-only by payment_id\n  app.get('/api/admin/credits/refund-eligibility', async (req, res) => {\n    try {\n      const paymentId =\n        typeof req.query.paymentId === 'string' ? req.query.paymentId : '';\n      if (!paymentId) {\n        return res.status(400).json({ error: 'paymentId is required' });\n      }\n\n      const grant = await storage.getCreditGrantByPaymentId(paymentId);\n      if (!grant) {\n        return res.status(404).json({ error: 'Purchase not found' });\n      }\n\n      const now = Date.now();\n      const createdAtMs = grant.createdAt?.getTime?.() ?? 0;\n      const ageDays = createdAtMs\n        ? (now - createdAtMs) / (1000 * 60 * 60 * 24)\n        : null;\n\n      const unused = (grant.remaining ?? 0) === (grant.amount ?? 0);\n      const withinWindow = ageDays !== null ? ageDays <= 7 : false;\n\n      return res.json({\n        eligible: unused && withinWindow,\n        policy: { window_days: 7, unused_only: true },\n        details: {\n          amount: grant.amount,\n          remaining: grant.remaining,\n          createdAt: grant.createdAt,\n          withinWindow,\n          unused,\n          ageDays,\n        },\n      });\n    } catch (error) {\n      res.status(500).json({\n        error: 'Failed to check refund eligibility',\n        details: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  });\n\n  app.post('/api/admin/rate-limit/reset/:identifier', async (req, res) => {\n    try {\n      await resetRateLimit(req, res);\n    } catch (error) {\n      res.status(500).json({\n        error: 'Failed to reset rate limit',\n        details: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  });\n\n  // Monitoring and health endpoints\n  app.get('/api/monitoring/status', async (req, res) => {\n    try {\n      // Call the Python monitoring module\n      const { spawn } = require('child_process');\n      const path = require('path');\n      const currentDir = path.dirname(\n        require.main ? require.main.filename : __filename\n      );\n\n      const pythonScript = path.join(\n        currentDir,\n        '..',\n        'extractor',\n        'monitoring.py'\n      );\n      const result = await new Promise<any>((resolve, reject) => {\n        const python = spawn(pythonExecutable, [\n          '-c',\n          `\nimport sys\nimport os\nsys.path.append(os.path.join(os.path.dirname('${pythonScript}')))\nfrom monitoring import get_monitoring_data\nimport json\nprint(json.dumps(get_monitoring_data()))\n          `,\n        ]);\n\n        let stdout = '';\n        let stderr = '';\n\n        python.stdout.on('data', (data: Buffer) => {\n          stdout += data.toString();\n        });\n\n        python.stderr.on('data', (data: Buffer) => {\n          stderr += data.toString();\n        });\n\n        python.on('close', (code: number | null) => {\n          if (code !== 0) {\n            console.error('Monitoring data error:', stderr);\n            reject(new Error('Failed to get monitoring data'));\n            return;\n          }\n          try {\n            resolve(JSON.parse(stdout));\n          } catch (e) {\n            reject(new Error('Failed to parse monitoring data'));\n          }\n        });\n\n        setTimeout(() => {\n          python.kill();\n          reject(new Error('Monitoring data request timed out'));\n        }, 10000);\n      });\n\n      res.json(result);\n    } catch (error) {\n      console.error('Monitoring status error:', error);\n      res.status(500).json({\n        error: 'Failed to get monitoring status',\n        details: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  });\n\n  app.get('/api/monitoring/performance', async (req, res) => {\n    try {\n      // Call the Python monitoring module\n      const { spawn } = require('child_process');\n      const path = require('path');\n      const currentDir = path.dirname(\n        require.main ? require.main.filename : __filename\n      );\n\n      const pythonScript = path.join(\n        currentDir,\n        '..',\n        'extractor',\n        'monitoring.py'\n      );\n      const result = await new Promise<any>((resolve, reject) => {\n        const python = spawn(pythonExecutable, [\n          '-c',\n          `\nimport sys\nimport os\nsys.path.append(os.path.join(os.path.dirname('${pythonScript}')))\nfrom monitoring import get_performance_summary\nimport json\nprint(json.dumps(get_performance_summary()))\n          `,\n        ]);\n\n        let stdout = '';\n        let stderr = '';\n\n        python.stdout.on('data', (data: Buffer) => {\n          stdout += data.toString();\n        });\n\n        python.stderr.on('data', (data: Buffer) => {\n          stderr += data.toString();\n        });\n\n        python.on('close', (code: number | null) => {\n          if (code !== 0) {\n            console.error('Performance data error:', stderr);\n            reject(new Error('Failed to get performance data'));\n            return;\n          }\n          try {\n            resolve(JSON.parse(stdout));\n          } catch (e) {\n            reject(new Error('Failed to parse performance data'));\n          }\n        });\n\n        setTimeout(() => {\n          python.kill();\n          reject(new Error('Performance data request timed out'));\n        }, 10000);\n      });\n\n      res.json(result);\n    } catch (error) {\n      console.error('Performance monitoring error:', error);\n      res.status(500).json({\n        error: 'Failed to get performance data',\n        details: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  });\n\n  app.get('/api/monitoring/errors', async (req, res) => {\n    try {\n      // Call the Python monitoring module\n      const { spawn } = require('child_process');\n      const path = require('path');\n      const currentDir = path.dirname(\n        require.main ? require.main.filename : __filename\n      );\n\n      const pythonScript = path.join(\n        currentDir,\n        '..',\n        'extractor',\n        'monitoring.py'\n      );\n      const result = await new Promise<any>((resolve, reject) => {\n        const python = spawn(pythonExecutable, [\n          '-c',\n          `\nimport sys\nimport os\nsys.path.append(os.path.join(os.path.dirname('${pythonScript}')))\nfrom monitoring import get_error_summary\nimport json\nprint(json.dumps(get_error_summary()))\n          `,\n        ]);\n\n        let stdout = '';\n        let stderr = '';\n\n        python.stdout.on('data', (data: Buffer) => {\n          stdout += data.toString();\n        });\n\n        python.stderr.on('data', (data: Buffer) => {\n          stderr += data.toString();\n        });\n\n        python.on('close', (code: number | null) => {\n          if (code !== 0) {\n            console.error('Error data error:', stderr);\n            reject(new Error('Failed to get error data'));\n            return;\n          }\n          try {\n            resolve(JSON.parse(stdout));\n          } catch (e) {\n            reject(new Error('Failed to parse error data'));\n          }\n        });\n\n        setTimeout(() => {\n          python.kill();\n          reject(new Error('Error data request timed out'));\n        }, 10000);\n      });\n\n      res.json(result);\n    } catch (error) {\n      console.error('Error monitoring error:', error);\n      res.status(500).json({\n        error: 'Failed to get error data',\n        details: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  });\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/routes/advanced-protection.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'generateFingerprint' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[841,844],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[841,844],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":143,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4896,4899],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4896,4899],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":161,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5301,5304],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5301,5304],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":226,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":226,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7196,7199],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7196,7199],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":387,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":387,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11920,11923],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11920,11923],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":435,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":435,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13107,13110],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13107,13110],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":469,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":469,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13936,13939],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13936,13939],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Advanced Protection API Routes\n * \n * Provides endpoints for browser fingerprinting and ML anomaly detection\n */\n\nimport { Router, Request, Response } from 'express';\nimport { generateFingerprint, analyzeFingerprint, trackFingerprint } from '../monitoring/browser-fingerprint';\nimport { mlAnomalyDetector } from '../monitoring/ml-anomaly-detection';\nimport { securityEventLogger } from '../monitoring/security-events';\nimport { securityAlertManager } from '../monitoring/security-alerts';\nimport { getProtectionStats, getRiskLevel } from '../middleware/advanced-protection';\n\nconst router = Router();\n\n/**\n * POST /api/protection/fingerprint\n * Submit browser fingerprint data\n */\nrouter.post('/fingerprint', async (req: Request, res: Response) => {\n  try {\n    const { fingerprint, sessionId } = req.body;\n    const userId = (req as any).user?.id;\n    \n    if (!fingerprint) {\n      return res.status(400).json({\n        error: 'Fingerprint data is required'\n      });\n    }\n\n    // Validate fingerprint data\n    const validationResult = validateFingerprintData(fingerprint);\n    if (!validationResult.isValid) {\n      await securityEventLogger.logEvent({\n        event: 'invalid_fingerprint',\n        severity: 'low',\n        timestamp: new Date(),\n        source: 'fingerprint_endpoint',\n        ipAddress: req.ip || req.connection.remoteAddress || 'unknown',\n        userId,\n        details: {\n          validationErrors: validationResult.errors,\n          receivedFingerprint: fingerprint\n        }\n      });\n\n      return res.status(400).json({\n        error: 'Invalid fingerprint data',\n        details: validationResult.errors\n      });\n    }\n\n    // Analyze fingerprint for anomalies\n    const analysis = await analyzeFingerprint(fingerprint);\n    \n    // Track fingerprint across sessions\n    const tracking = await trackFingerprint(fingerprint, userId);\n\n    // Log the fingerprint submission\n    await securityEventLogger.logEvent({\n      event: 'fingerprint_submitted',\n      severity: analysis.riskScore > 50 ? 'medium' : 'low',\n      timestamp: new Date(),\n      source: 'fingerprint_endpoint',\n      ipAddress: req.ip || req.connection.remoteAddress || 'unknown',\n      userId,\n      details: {\n        fingerprintId: fingerprint.fingerprintHash,\n        deviceId: fingerprint.deviceId,\n        sessionId: sessionId || fingerprint.sessionId,\n        riskScore: analysis.riskScore,\n        confidence: analysis.confidence,\n        anomalies: analysis.anomalies,\n        isUnique: analysis.isUnique,\n        similarDevices: analysis.similarFingerprints.length,\n        tracking: {\n          isNewDevice: tracking.isNewDevice,\n          previousSessions: tracking.previousSessions,\n          riskLevel: tracking.riskLevel\n        }\n      }\n    });\n\n    // Send alert for high-risk fingerprints\n    if (analysis.riskScore >= 80) {\n      await securityAlertManager.sendAlert({\n        type: 'security',\n        severity: 'high',\n        title: 'High-Risk Browser Fingerprint Detected',\n        message: `Suspicious browser fingerprint with risk score ${analysis.riskScore}/100`,\n        details: {\n          fingerprintId: fingerprint.fingerprintHash,\n          deviceId: fingerprint.deviceId,\n          ipAddress: req.ip || req.connection.remoteAddress,\n          userAgent: fingerprint.userAgent,\n          anomalies: analysis.anomalies,\n          similarDevices: analysis.similarFingerprints.length\n        },\n        metadata: {\n          category: 'fingerprint_analysis',\n          tags: ['high_risk', 'fingerprint', 'suspicious']\n        }\n      });\n    }\n\n    res.json({\n      success: true,\n      fingerprintId: fingerprint.fingerprintHash,\n      deviceId: fingerprint.deviceId,\n      sessionId: sessionId || fingerprint.sessionId,\n      analysis: {\n        riskScore: analysis.riskScore,\n        riskLevel: getRiskLevel(analysis.riskScore),\n        confidence: analysis.confidence,\n        isUnique: analysis.isUnique,\n        anomalies: analysis.anomalies,\n        recommendations: analysis.recommendations\n      },\n      tracking: {\n        isNewDevice: tracking.isNewDevice,\n        previousSessions: tracking.previousSessions,\n        riskLevel: tracking.riskLevel,\n        action: tracking.action\n      }\n    });\n\n  } catch (error: unknown) {\n    console.error('[FingerprintEndpoint] Error:', error);\n    const errorDetails: { message?: string; stack?: string; raw?: string } = {};\n    if (error instanceof Error) {\n      errorDetails.message = error.message;\n      errorDetails.stack = error.stack;\n    } else {\n      errorDetails.raw = typeof error === 'string' ? error : JSON.stringify(error);\n    }\n\n    await securityEventLogger.logEvent({\n      event: 'fingerprint_error',\n      severity: 'medium',\n      timestamp: new Date(),\n      source: 'fingerprint_endpoint',\n      ipAddress: req.ip || req.connection.remoteAddress || 'unknown',\n      userId: (req as any).user?.id,\n      details: errorDetails\n    });\n\n    res.status(500).json({\n      error: 'Internal server error',\n      message: 'Failed to process fingerprint data'\n    });\n  }\n});\n\n/**\n * GET /api/protection/fingerprint/:id\n * Get fingerprint analysis by ID\n */\nrouter.get('/fingerprint/:id', async (req: Request, res: Response) => {\n  try {\n    const { id } = req.params;\n    const userId = (req as any).user?.id;\n    \n    // Validate fingerprint ID format\n    if (!isValidFingerprintId(id)) {\n      return res.status(400).json({\n        error: 'Invalid fingerprint ID format'\n      });\n    }\n\n    // Get fingerprint data from storage\n    const fingerprintData = await getFingerprintById(id);\n    \n    if (!fingerprintData) {\n      return res.status(404).json({\n        error: 'Fingerprint not found'\n      });\n    }\n\n    // Check authorization\n    if (fingerprintData.userId && fingerprintData.userId !== userId) {\n      return res.status(403).json({\n        error: 'Access denied'\n      });\n    }\n\n    // Re-analyze fingerprint with current data\n    const analysis = await analyzeFingerprint(fingerprintData.fingerprintData);\n\n    res.json({\n      fingerprintId: id,\n      deviceId: fingerprintData.deviceId,\n      userId: fingerprintData.userId,\n      timestamp: fingerprintData.timestamp,\n      analysis: {\n        riskScore: analysis.riskScore,\n        riskLevel: getRiskLevel(analysis.riskScore),\n        confidence: analysis.confidence,\n        isUnique: analysis.isUnique,\n        anomalies: analysis.anomalies,\n        recommendations: analysis.recommendations,\n        similarFingerprints: analysis.similarFingerprints\n      },\n      metadata: {\n        ipAddress: fingerprintData.ipAddress,\n        userAgent: fingerprintData.fingerprintData.userAgent,\n        confidence: fingerprintData.confidence,\n        anomalies: fingerprintData.anomalies\n      }\n    });\n\n  } catch (error) {\n    console.error('[FingerprintGetEndpoint] Error:', error);\n    res.status(500).json({\n      error: 'Internal server error'\n    });\n  }\n});\n\n/**\n * POST /api/protection/anomaly-detection\n * Run ML anomaly detection on current request\n */\nrouter.post('/anomaly-detection', async (req: Request, res: Response) => {\n  try {\n    const { fingerprintData, context } = req.body;\n    const userId = (req as any).user?.id;\n\n    // Parse fingerprint if provided\n    let fingerprint;\n    if (fingerprintData) {\n      fingerprint = {\n        ...fingerprintData,\n        fingerprintHash: fingerprintData.hash,\n        deviceId: fingerprintData.deviceId || 'unknown',\n        sessionId: fingerprintData.sessionId || 'unknown',\n        ipAddress: req.ip || req.connection.remoteAddress || 'unknown',\n        timestamp: new Date(),\n        confidence: 0.8,\n        anomalies: []\n      };\n    }\n\n    // Run ML anomaly detection\n    const anomalyResult = await mlAnomalyDetector.detectUploadAnomaly(req, fingerprint);\n\n    // Log the detection\n    await securityEventLogger.logEvent({\n      event: 'anomaly_detection',\n      severity: anomalyResult.riskLevel,\n      timestamp: new Date(),\n      source: 'anomaly_endpoint',\n      ipAddress: req.ip || req.connection.remoteAddress || 'unknown',\n      userId,\n      details: {\n        isAnomalous: anomalyResult.isAnomalous,\n        confidence: anomalyResult.confidence,\n        riskScore: anomalyResult.riskScore,\n        riskLevel: anomalyResult.riskLevel,\n        contributingFactors: anomalyResult.contributingFactors,\n        modelVersion: anomalyResult.modelVersion,\n        context: context || {}\n      }\n    });\n\n    // Send alert for high-risk detections\n    if (anomalyResult.riskLevel === 'high' || anomalyResult.riskLevel === 'critical') {\n      await securityAlertManager.sendAlert({\n        type: 'security',\n        severity: 'high',\n        title: 'ML Anomaly Detection Alert',\n        message: `High-risk behavior detected with confidence ${Math.round(anomalyResult.confidence * 100)}%`,\n        details: {\n          riskScore: anomalyResult.riskScore,\n          riskLevel: anomalyResult.riskLevel,\n          contributingFactors: anomalyResult.contributingFactors,\n          ipAddress: req.ip || req.connection.remoteAddress,\n          userAgent: req.headers['user-agent'],\n          modelVersion: anomalyResult.modelVersion\n        },\n        metadata: {\n          category: 'anomaly_detection',\n          tags: ['ml_detection', 'high_risk', 'suspicious_behavior']\n        }\n      });\n    }\n\n    res.json({\n      success: true,\n      detection: {\n        isAnomalous: anomalyResult.isAnomalous,\n        confidence: anomalyResult.confidence,\n        riskScore: anomalyResult.riskScore,\n        riskLevel: anomalyResult.riskLevel,\n        contributingFactors: anomalyResult.contributingFactors,\n        recommendations: anomalyResult.recommendations,\n        modelVersion: anomalyResult.modelVersion,\n        timestamp: anomalyResult.timestamp\n      }\n    });\n\n  } catch (error) {\n    console.error('[AnomalyDetectionEndpoint] Error:', error);\n    \n    res.status(500).json({\n      error: 'Internal server error',\n      message: 'Failed to run anomaly detection'\n    });\n  }\n});\n\n/**\n * GET /api/protection/stats\n * Get protection system statistics\n */\nrouter.get('/stats', async (req: Request, res: Response) => {\n  try {\n    const stats = await getProtectionStats();\n    const modelStats = mlAnomalyDetector.getModelStats();\n\n    res.json({\n      success: true,\n      stats: {\n        ...stats,\n        mlModel: modelStats\n      },\n      timestamp: new Date()\n    });\n\n  } catch (error) {\n    console.error('[ProtectionStatsEndpoint] Error:', error);\n    res.status(500).json({\n      error: 'Internal server error'\n    });\n  }\n});\n\n/**\n * GET /api/protection/model-info\n * Get ML model information\n */\nrouter.get('/model-info', async (req: Request, res: Response) => {\n  try {\n    const modelStats = mlAnomalyDetector.getModelStats();\n    const modelVersion = mlAnomalyDetector.getModelVersion();\n    const isTrained = mlAnomalyDetector.isModelTrained();\n\n    res.json({\n      success: true,\n      model: {\n        version: modelVersion,\n        isTrained,\n        stats: modelStats,\n        config: {\n          minSamples: 50,\n          trainingWindowHours: 24,\n          retrainingIntervalHours: 6,\n          anomalyThreshold: 0.8,\n          featureWeights: {\n            uploadFrequency: 0.25,\n            fileSize: 0.20,\n            ipStability: 0.15,\n            deviceConsistency: 0.15,\n            timePattern: 0.10,\n            geolocation: 0.10,\n            fingerprint: 0.05\n          }\n        }\n      },\n      timestamp: new Date()\n    });\n\n  } catch (error) {\n    console.error('[ModelInfoEndpoint] Error:', error);\n    res.status(500).json({\n      error: 'Internal server error'\n    });\n  }\n});\n\n/**\n * POST /api/protection/feedback\n * Submit feedback on protection decisions\n */\nrouter.post('/feedback', async (req: Request, res: Response) => {\n  try {\n    const { fingerprintId, decision, wasCorrect, feedback, context } = req.body;\n    const userId = (req as any).user?.id;\n\n    if (!fingerprintId || !decision) {\n      return res.status(400).json({\n        error: 'Fingerprint ID and decision are required'\n      });\n    }\n\n    // Log the feedback\n    await securityEventLogger.logEvent({\n      event: 'protection_feedback',\n      severity: 'low',\n      timestamp: new Date(),\n      source: 'feedback_endpoint',\n      ipAddress: req.ip || req.connection.remoteAddress || 'unknown',\n      userId,\n      details: {\n        fingerprintId,\n        decision,\n        wasCorrect,\n        feedback: feedback || '',\n        context: context || {}\n      }\n    });\n\n    // Process feedback for model improvement\n    if (wasCorrect !== undefined) {\n      // This would update the ML model with feedback\n      console.log(`[ProtectionFeedback] Processing feedback: decision=${decision}, wasCorrect=${wasCorrect}`);\n    }\n\n    res.json({\n      success: true,\n      message: 'Feedback submitted successfully'\n    });\n\n  } catch (error) {\n    console.error('[ProtectionFeedbackEndpoint] Error:', error);\n    res.status(500).json({\n      error: 'Internal server error'\n    });\n  }\n});\n\n/**\n * Helper functions\n */\n\nfunction validateFingerprintData(fingerprint: any): { isValid: boolean; errors: string[] } {\n  const errors: string[] = [];\n\n  if (!fingerprint.hash) {\n    errors.push('Missing fingerprint hash');\n  }\n\n  if (!fingerprint.timestamp) {\n    errors.push('Missing timestamp');\n  }\n\n  if (!fingerprint.userAgent) {\n    errors.push('Missing user agent');\n  }\n\n  if (fingerprint.canvas && typeof fingerprint.canvas !== 'object') {\n    errors.push('Invalid canvas fingerprint format');\n  }\n\n  if (fingerprint.webgl && typeof fingerprint.webgl !== 'object') {\n    errors.push('Invalid WebGL fingerprint format');\n  }\n\n  return {\n    isValid: errors.length === 0,\n    errors\n  };\n}\n\nfunction isValidFingerprintId(id: string): boolean {\n  // Validate SHA256 hash format (64 hex characters)\n  return /^[a-fA-F0-9]{64}$/.test(id);\n}\n\nasync function getFingerprintById(id: string): Promise<any> {\n  try {\n    // This would query the database\n    // For now, return mock data\n    return {\n      id,\n      deviceId: 'mock_device_123',\n      userId: null,\n      fingerprintData: {\n        fingerprintHash: id,\n        deviceId: 'mock_device_123',\n        sessionId: 'mock_session_456',\n        userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',\n        timestamp: new Date()\n      },\n      ipAddress: '192.168.1.1',\n      timestamp: new Date(),\n      confidence: 0.85,\n      anomalies: []\n    };\n  } catch (error) {\n    console.error('[GetFingerprintById] Error:', error);\n    return null;\n  }\n}\n\nexport default router;","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/routes/analytics.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'crypto' is defined but never used.","line":18,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'EventName' is defined but never used.","line":22,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'UserIntentEvent' is defined but never used.","line":23,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ComprehensionEvent' is defined but never used.","line":24,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'BaseEventProperties' is defined but never used.","line":25,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'UserIntentEventProperties' is defined but never used.","line":26,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ComprehensionEventProperties' is defined but never used.","line":27,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'validateEventPayload' is defined but never used.","line":29,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'dedupeKeySchema' is assigned a value but never used.","line":111,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":111,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":258,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":258,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7813,7816],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7813,7816],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":272,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":272,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8269,8272],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8269,8272],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":296,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":296,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9057,9060],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9057,9060],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":314,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":314,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9827,9830],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9827,9830],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":350,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":350,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11308,11311],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11308,11311],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":351,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":351,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11358,11361],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11358,11361],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":353,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":353,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11428,11431],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11428,11431],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used. Allowed unused args must match /^_/u.","line":372,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":372,"endColumn":44}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":17,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Analytics Events Ingestion Pipeline\n *\n * Minimal, deterministic, append-only event storage.\n * Validates schemas, prevents prohibited fields, handles batching.\n *\n * Key Design Principles:\n * - Single source of truth (database table, no multiple writes)\n * - Prohibited fields are rejected at ingestion (privacy protection)\n * - Deterministic one-shot firing (client sends once, we store once)\n * - Server-side lifecycle events (system truth, not client guesses)\n * - Analytics health monitoring (catch instrumentation bugs)\n */\n\nimport type { Request, Response } from 'express';\nimport { z } from 'zod';\nimport type { InsertUiEvent } from '@shared/analytics-events';\nimport crypto from 'crypto';\nimport { db } from '../db';\nimport { uiEvents } from '@shared/schema';\nimport {\n  EventName,\n  UserIntentEvent,\n  ComprehensionEvent,\n  type BaseEventProperties,\n  type UserIntentEventProperties,\n  type ComprehensionEventProperties,\n  buildDedupeKey,\n  validateEventPayload,\n  FileSizeBucket,\n  UserTier,\n  AuthState,\n  SourceEntryPoint,\n  ClientType,\n  ResultDensity,\n} from '@shared/analytics-events';\n\n// ============================================================================\n// INGESTION SCHEMAS (Validation at Edge)\n// ============================================================================\n\n/**\n * Base analytics event schema\n * All events must conform to this structure\n */\nconst baseAnalyticsSchema = z.object({\n  // Versioning - enables breaking changes without historical data loss\n  version: z.literal('1.0.0'),\n\n  // Event family\n  eventFamily: z.enum(['lifecycle', 'user_intent', 'comprehension']),\n\n  // Event name\n  eventName: z.string(),\n\n  // Correlation IDs\n  sessionId: z.string().uuid(),\n  fileId: z.string().uuid().optional(),\n  correlationId: z.string().optional(),\n\n  // Properties (validated against prohibited list)\n  properties: z.record(z.string(), z.any()),\n\n  // Coarse dimensions (no PII)\n  userTier: z.enum([UserTier.ANON, UserTier.FREE, UserTier.PRO]).optional(),\n  authState: z.enum([AuthState.LOGGED_OUT, AuthState.LOGGED_IN]).optional(),\n  fileSizeBucket: z\n    .enum([\n      FileSizeBucket.SMALL,\n      FileSizeBucket.MEDIUM,\n      FileSizeBucket.LARGE,\n      FileSizeBucket.XLARGE,\n    ])\n    .optional(),\n  sourceEntryPoint: z\n    .enum([\n      SourceEntryPoint.UPLOAD_PAGE,\n      SourceEntryPoint.LANDING,\n      SourceEntryPoint.SHARE_LINK,\n      SourceEntryPoint.API,\n    ])\n    .optional(),\n  resultDensity: z\n    .enum([\n      ResultDensity.SIMPLE,\n      ResultDensity.STANDARD,\n      ResultDensity.ADVANCED,\n    ])\n    .optional(),\n  client: z\n    .enum([ClientType.WEB, ClientType.EXTENSION, ClientType.MOBILE_APP])\n    .optional(),\n\n  // Request ID for tracing\n  requestId: z.string().optional(),\n\n  // Abuse defense (coarse signals only)\n  ipPrefixHash: z.string().max(16).optional(), // First 2 octets of IP, hashed\n  asn: z.string().max(16).optional(), // AS number, not IP\n  uaHash: z.string().max(32).optional(), // User agent fingerprint, not raw UA\n  riskScoreBucket: z.enum(['low', 'medium', 'high', 'blocked']).optional(),\n\n  // Server-enriched fields (always present, no client override)\n  receivedAt: z.string().datetime(), // Canonical ordering field\n  eventTime: z.string().datetime().optional(), // Client-provided timestamp (for clock skew analysis)\n});\n\n/**\n * Deduplication key schema (used for unique constraint)\n */\nconst dedupeKeySchema = z.object({\n  sessionId: z.string().uuid(),\n  eventId: z.string(), // eventName or unique fact ID\n  fileId: z.string().uuid().optional(),\n});\n\n// ============================================================================\n// PROHIBITED FIELD VALIDATION (Privacy Protection)\n// ============================================================================\n\n/**\n * These patterns are rejected at ingestion to prevent privacy leaks\n * Any payload matching these patterns fails validation\n */\nconst PROHIBITED_FIELD_PATTERNS = [\n  /^raw_gps_latitude$/,\n  /^raw_gps_longitude$/,\n  /^raw_timestamp_value$/,\n  /^filename$/,\n  /^device_serial_number$/,\n  /^user_email$/,\n  /^ip_address$/,\n  /^user_agent_string$/,\n  /^metadata_values$/,\n  /^exact_coordinates$/,\n];\n\n/**\n * Validate event payload against prohibited patterns\n * Returns detailed error for debugging\n */\nfunction validateProhibitedFields(properties: Record<string, unknown>): {\n  valid: boolean;\n  errors: string[];\n} {\n  const errors: string[] = [];\n\n  for (const key of Object.keys(properties)) {\n    for (const pattern of PROHIBITED_FIELD_PATTERNS) {\n      if (pattern.test(key)) {\n        errors.push(`Prohibited field: \"${key}\"`);\n      }\n    }\n  }\n\n  return { valid: errors.length === 0, errors };\n}\n\n// ============================================================================\n// ANALYTICS HEALTH METRICS\n// ============================================================================\n\ninterface AnalyticsHealthMetrics {\n  invalidEventRate: number; // Events rejected by schema validation\n  missingSessionIdRate: number; // Events without sessionId\n  duplicateRate: number; // Dedupe key collisions\n  eventLagDistribution: { p50: number; p95: number; p99: number }; // receivedAt - eventTime\n  eventsPerSessionDistribution: { p50: number; p95: number; max: number };\n}\n\n// In-memory metrics (rotate every minute)\nconst healthMetrics: AnalyticsHealthMetrics = {\n  invalidEventRate: 0,\n  missingSessionIdRate: 0,\n  duplicateRate: 0,\n  eventLagDistribution: { p50: 0, p95: 0, p99: 0 },\n  eventsPerSessionDistribution: { p50: 0, p95: 0, max: 0 },\n};\n\n// Sample buffers for distribution tracking\nconst eventLagBuffer: number[] = [];\nconst eventsPerSessionBuffer: Map<string, number> = new Map();\n\n/**\n * Update health metrics\n * Called on every event ingestion\n */\nfunction updateHealthMetrics(\n  eventType: string,\n  validationPassed: boolean,\n  sessionId: string | undefined,\n  receivedAt: Date,\n  eventTime: Date | undefined\n): void {\n  // Invalid event tracking\n  if (!validationPassed) {\n    healthMetrics.invalidEventRate++;\n  }\n\n  // Missing session ID tracking\n  if (!sessionId) {\n    healthMetrics.missingSessionIdRate++;\n  }\n\n  // Event lag tracking (clock skew detection)\n  if (eventTime) {\n    const lag = receivedAt.getTime() - eventTime.getTime();\n    eventLagBuffer.push(lag);\n    if (eventLagBuffer.length > 1000) {\n      eventLagBuffer.shift(); // Keep last 1000 events\n    }\n\n    // Calculate percentiles\n    const sorted = [...eventLagBuffer].sort((a, b) => a - b);\n    healthMetrics.eventLagDistribution = {\n      p50: sorted[Math.floor(sorted.length * 0.5)],\n      p95: sorted[Math.floor(sorted.length * 0.95)],\n      p99: sorted[Math.floor(sorted.length * 0.99)],\n    };\n  }\n\n  // Events per session tracking\n  if (sessionId) {\n    const currentCount = eventsPerSessionBuffer.get(sessionId) || 0;\n    eventsPerSessionBuffer.set(sessionId, currentCount + 1);\n  }\n}\n\n/**\n * Reset health metrics (called every minute)\n */\nfunction resetHealthMetrics(): void {\n  const previous = { ...healthMetrics };\n\n  healthMetrics.invalidEventRate = 0;\n  healthMetrics.missingSessionIdRate = 0;\n  healthMetrics.duplicateRate = 0;\n\n  // Rotate event lag buffer\n  eventLagBuffer.length = 0;\n\n  // Calculate events per session distribution\n  const sessionCounts = Array.from(eventsPerSessionBuffer.values());\n  if (sessionCounts.length > 0) {\n    sessionCounts.sort((a, b) => a - b);\n    healthMetrics.eventsPerSessionDistribution = {\n      p50: sessionCounts[Math.floor(sessionCounts.length * 0.5)] || 0,\n      p95: sessionCounts[Math.floor(sessionCounts.length * 0.95)] || 0,\n      max: sessionCounts[sessionCounts.length - 1] || 0,\n    };\n  } else {\n    healthMetrics.eventsPerSessionDistribution = { p50: 0, p95: 0, max: 0 };\n  }\n\n  eventsPerSessionBuffer.clear();\n\n  // Store previous metrics for comparison\n  (globalThis as any).__previousHealthMetrics = previous;\n}\n\n// Rotate health metrics every minute\nsetInterval(resetHealthMetrics, 60000);\n\n// ============================================================================\n// ROUTE: Analytics Event Ingestion\n// ============================================================================\n\n/**\n * POST /api/analytics/events\n * Ingest batched client-side analytics events\n */\nexport async function registerAnalyticsRoutes(app: any): Promise<void> {\n  app.post('/api/analytics/events', async (req: Request, res: Response) => {\n    try {\n      // Validate request body\n      const body = req.body;\n\n      if (!body || !Array.isArray(body)) {\n        return res.status(400).json({\n          error: 'Invalid request body',\n          message: 'Expected array of events',\n        });\n      }\n\n      const processedEvents: InsertUiEvent[] = [];\n      const errors: string[] = [];\n      const duplicates: string[] = [];\n\n      // Process each event\n      for (const event of body) {\n        try {\n          // Validate against base schema\n          const validatedEvent = baseAnalyticsSchema.parse(event);\n\n          // Validate against prohibited fields\n          const props = validatedEvent.properties as Record<string, any>;\n          const prohibitedCheck = validateProhibitedFields(props);\n          if (!prohibitedCheck.valid) {\n            errors.push(\n              `Event \"${validatedEvent.eventName}\" contains prohibited fields: ${prohibitedCheck.errors.join(', ')}`\n            );\n            continue; // Skip this event\n          }\n\n          // Build dedupe key\n          const dedupeKey = buildDedupeKey(\n            validatedEvent.sessionId,\n            validatedEvent.eventFamily === 'comprehension' && props.fact\n              ? `${validatedEvent.sessionId}:${validatedEvent.eventName}:${props.fact}`\n              : validatedEvent.eventName\n          );\n\n          // Check for duplicates (in-memory check, database enforces unique constraint)\n          if ((globalThis as any).__dedupeBuffer?.has(dedupeKey)) {\n            duplicates.push(dedupeKey);\n            continue; // Skip duplicate\n          }\n\n          // Prepare database insert\n          const insertEvent: InsertUiEvent = {\n            // Base properties (all events)\n            product: validatedEvent.properties.product || 'core',\n            eventName: validatedEvent.eventName,\n            sessionId: validatedEvent.sessionId,\n            userId: props.userId || null,\n            properties: JSON.stringify(props),\n            ipAddress: props.ipPrefixHash || null,\n            userAgent: props.uaHash || null,\n\n            // Coarse dimensions (shared by all events)\n            userTier: validatedEvent.userTier || UserTier.ANON,\n            authState: validatedEvent.authState || AuthState.LOGGED_OUT,\n            fileSizeBucket: validatedEvent.fileSizeBucket,\n            sourceEntryPoint: validatedEvent.sourceEntryPoint,\n            resultDensity: validatedEvent.resultDensity,\n            client: validatedEvent.client || ClientType.WEB,\n\n            // Server-enriched fields\n            requestId: validatedEvent.requestId,\n            receivedAt: validatedEvent.receivedAt,\n\n            // Abuse defense (coarse signals only)\n            asn: validatedEvent.asn,\n            riskScoreBucket: validatedEvent.riskScoreBucket,\n          };\n\n          processedEvents.push(insertEvent);\n\n          // Track dedupe (in-memory, cleared on rotation)\n          if (!(globalThis as any).__dedupeBuffer) {\n            (globalThis as any).__dedupeBuffer = new Set();\n          }\n          (globalThis as any).__dedupeBuffer.add(dedupeKey);\n        } catch (error) {\n          // Log validation error but continue processing other events\n          errors.push(error instanceof Error ? error.message : String(error));\n        }\n      }\n\n      if (processedEvents.length === 0) {\n        return res.status(400).json({\n          error: 'No valid events to process',\n          message: 'All events were invalid or duplicates',\n          errors,\n        });\n      }\n\n      // Batch insert to database (single write, transactional)\n      await db.insert(uiEvents).values(processedEvents);\n\n      // Update health metrics\n      processedEvents.forEach((event, index) => {\n        updateHealthMetrics(\n          event.eventName,\n          true,\n          event.sessionId,\n          new Date(event.receivedAt),\n          event.eventTime ? new Date(event.eventTime) : undefined\n        );\n      });\n\n      // Track duplicates for health metrics\n      if (duplicates.length > 0) {\n        healthMetrics.duplicateRate += duplicates.length;\n      }\n\n      return res.json({\n        success: true,\n        processed: processedEvents.length,\n        skipped: errors.length + duplicates.length,\n        errors: errors.length > 0 ? errors : undefined,\n        duplicates: duplicates.length > 0 ? duplicates : undefined,\n        receivedAt: new Date().toISOString(),\n      });\n    } catch (error: unknown) {\n      console.error('Analytics ingestion error:', error);\n\n      return res.status(500).json({\n        error: 'Failed to process analytics events',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  });\n\n  // ============================================================================\n  // ROUTE: Analytics Health Check\n  // ============================================================================\n\n  /**\n   * GET /api/analytics/health\n   * Returns analytics pipeline health metrics\n   * Used to detect instrumentation bugs, clock skew, abuse patterns\n   */\n  app.get('/api/analytics/health', async (req: Request, res: Response) => {\n    try {\n      res.json({\n        pipelineStatus: 'ok',\n        timestamp: new Date().toISOString(),\n        metrics: {\n          invalidEventRate: healthMetrics.invalidEventRate,\n          missingSessionIdRate: healthMetrics.missingSessionIdRate,\n          duplicateRate: healthMetrics.duplicateRate,\n          eventLagDistribution: healthMetrics.eventLagDistribution,\n          eventsPerSessionDistribution:\n            healthMetrics.eventsPerSessionDistribution,\n        },\n        healthChecks: {\n          invalidEventRate: healthMetrics.invalidEventRate < 100, // Less than 100 invalid/min is OK\n          missingSessionIdRate: healthMetrics.missingSessionIdRate < 50, // Less than 50 missing/min is OK\n          duplicateRate: healthMetrics.duplicateRate < 100, // Less than 100 dupes/min is OK\n          eventLagP95: healthMetrics.eventLagDistribution.p95 < 5000, // Less than 5s lag is OK\n          eventsPerSessionMax:\n            healthMetrics.eventsPerSessionDistribution.max < 1000, // Less than 1000 events/session is OK\n        },\n        status:\n          healthMetrics.invalidEventRate < 100 &&\n          healthMetrics.missingSessionIdRate < 50 &&\n          healthMetrics.duplicateRate < 100 &&\n          healthMetrics.eventLagDistribution.p95 < 5000 &&\n          healthMetrics.eventsPerSessionDistribution.max < 1000\n            ? 'healthy'\n            : 'degraded',\n      });\n    } catch (error: unknown) {\n      console.error('Analytics health check error:', error);\n\n      return res.status(500).json({\n        error: 'Failed to retrieve analytics health metrics',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  });\n\n  // ============================================================================\n  // ROUTE: Event Schema Version\n  // ============================================================================\n\n  /**\n   * GET /api/analytics/schema\n   * Returns current event contracts for client validation\n   * Ensures client and server agree on schema version\n   */\n  app.get('/api/analytics/schema', async (req: Request, res: Response) => {\n    try {\n      res.json({\n        version: '1.0.0',\n        supportedEventFamilies: ['lifecycle', 'user_intent', 'comprehension'],\n        lifecycleEvents: require('@shared/analytics-events').LifecycleEvent,\n        userIntentEvents: require('@shared/analytics-events').UserIntentEvent,\n        comprehensionEvents: require('@shared/analytics-events')\n          .ComprehensionEvent,\n        eventNames: require('@shared/analytics-events').EventName,\n        keyFactTypes: require('@shared/analytics-events').KeyFactType,\n        factRevealTriggers: require('@shared/analytics-events')\n          .FactRevealTrigger,\n        prohibitedProperties: require('@shared/analytics-events')\n          .PROHIBITED_PROPERTIES,\n        coarseDimensions: {\n          fileSizeBuckets: require('@shared/analytics-events').FileSizeBucket,\n          userTiers: require('@shared/analytics-events').UserTier,\n          authStates: require('@shared/analytics-events').AuthState,\n          sourceEntryPoints: require('@shared/analytics-events')\n            .SourceEntryPoint,\n          resultDensities: require('@shared/analytics-events').ResultDensity,\n          clientTypes: require('@shared/analytics-events').ClientType,\n        },\n      });\n    } catch (error) {\n      console.error('Schema endpoint error:', error);\n\n      return res.status(500).json({\n        error: 'Failed to retrieve analytics schema',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  });\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/routes/batch.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'BatchJob' is defined but never used.","line":25,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1221,1224],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1221,1224],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'generateBatchId' is defined but never used.","line":58,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":58,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'generateResultId' is defined but never used.","line":62,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":62,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":240,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":240,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6768,6771],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6768,6771],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Batch Processing Routes Module\n *\n * Handles batch processing operations:\n * - Batch job management\n * - Batch results retrieval\n * - Batch reprocessing\n * - Batch export functionality\n */\n\nimport type { Express, Response } from 'express';\nimport { storage } from '../storage/index';\nimport type { AuthRequest } from '../auth';\nimport { requireAuth } from '../auth';\nimport {\n  sendInvalidRequestError,\n  sendInternalServerError,\n  sendForbiddenError,\n} from '../utils/error-response';\n\n// ============================================================================\n// Types\n// ============================================================================\n\ninterface BatchJob {\n  id: string;\n  userId: string;\n  name: string;\n  status: 'pending' | 'processing' | 'completed' | 'failed';\n  totalFiles: number;\n  processedFiles: number;\n  createdAt: string;\n  updatedAt: string;\n  completedAt?: string;\n  errorMessage?: string;\n}\n\ninterface BatchResult {\n  id: string;\n  batchId: string;\n  filename: string;\n  status: 'success' | 'error' | 'processing' | 'pending';\n  extractionDate: string;\n  fieldsExtracted: number;\n  fileSize: number;\n  fileType: string;\n  authenticityScore?: number;\n  metadata: Record<string, any>;\n  processingTime?: number;\n  errorMessage?: string;\n  createdAt: string;\n}\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\nfunction generateBatchId(): string {\n  return `batch_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n}\n\nfunction generateResultId(): string {\n  return `result_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n}\n\n// ============================================================================\n// Route Handlers\n// ============================================================================\n\n/**\n * Get all batch jobs for the current user\n */\nasync function getBatchJobs(req: AuthRequest, res: Response) {\n  try {\n    const userId = req.user?.id;\n    if (!userId) {\n      return sendForbiddenError(res, 'Authentication required');\n    }\n\n    // Get batch jobs from storage\n    const batchJobs = await storage.getBatchJobs(userId);\n\n    res.json({\n      success: true,\n      jobs: batchJobs,\n      total: batchJobs.length,\n    });\n  } catch (error) {\n    console.error('Error fetching batch jobs:', error);\n    sendInternalServerError(res, 'Failed to fetch batch jobs');\n  }\n}\n\n/**\n * Get detailed results for a specific batch job\n */\nasync function getBatchResults(req: AuthRequest, res: Response) {\n  try {\n    const userId = req.user?.id;\n    const { jobId } = req.params;\n\n    if (!userId) {\n      return sendForbiddenError(res, 'Authentication required');\n    }\n\n    if (!jobId) {\n      return sendInvalidRequestError(res, 'Job ID is required');\n    }\n\n    // Verify the job belongs to the user\n    const batchJob = await storage.getBatchJob(jobId);\n    if (!batchJob || batchJob.userId !== userId) {\n      return sendInvalidRequestError(res, 'Batch job not found');\n    }\n\n    // Get results for this batch job\n    const results = await storage.getBatchResults(jobId);\n\n    res.json({\n      success: true,\n      job: batchJob,\n      results,\n      total: results.length,\n    });\n  } catch (error) {\n    console.error('Error fetching batch results:', error);\n    sendInternalServerError(res, 'Failed to fetch batch results');\n  }\n}\n\n/**\n * Reprocess selected files in a batch\n */\nasync function reprocessFiles(req: AuthRequest, res: Response) {\n  try {\n    const userId = req.user?.id;\n    const { fileIds, batchId } = req.body;\n\n    if (!userId) {\n      return sendForbiddenError(res, 'Authentication required');\n    }\n\n    if (!fileIds || !Array.isArray(fileIds) || fileIds.length === 0) {\n      return sendInvalidRequestError(res, 'File IDs are required');\n    }\n\n    if (!batchId) {\n      return sendInvalidRequestError(res, 'Batch ID is required');\n    }\n\n    // Verify the batch job belongs to the user\n    const batchJob = await storage.getBatchJob(batchId);\n    if (!batchJob || batchJob.userId !== userId) {\n      return sendInvalidRequestError(res, 'Batch job not found');\n    }\n\n    // Get the files to reprocess\n    const filesToReprocess = await storage.getBatchResults(batchId);\n    const validFiles = filesToReprocess.filter(\n      result => fileIds.includes(result.id) && result.status === 'error'\n    );\n\n    if (validFiles.length === 0) {\n      return sendInvalidRequestError(res, 'No valid files to reprocess');\n    }\n\n    // Update file status to pending for reprocessing\n    for (const file of validFiles) {\n      await storage.updateBatchResult(file.id, {\n        status: 'pending',\n        errorMessage: undefined,\n      });\n    }\n\n    // Update batch job status if needed\n    if (batchJob.status === 'completed') {\n      await storage.updateBatchJob(batchId, {\n        status: 'processing',\n        processedFiles: batchJob.processedFiles - validFiles.length,\n        updatedAt: new Date().toISOString(),\n      });\n    }\n\n    res.json({\n      success: true,\n      message: `${validFiles.length} files queued for reprocessing`,\n      reprocessedFiles: validFiles.length,\n    });\n  } catch (error) {\n    console.error('Error reprocessing files:', error);\n    sendInternalServerError(res, 'Failed to reprocess files');\n  }\n}\n\n/**\n * Export batch results\n */\nasync function exportBatchResults(req: AuthRequest, res: Response) {\n  try {\n    const userId = req.user?.id;\n    const { jobId, format, scope, options } = req.body;\n\n    if (!userId) {\n      return sendForbiddenError(res, 'Authentication required');\n    }\n\n    if (!jobId) {\n      return sendInvalidRequestError(res, 'Job ID is required');\n    }\n\n    if (!['json', 'csv', 'pdf'].includes(format)) {\n      return sendInvalidRequestError(res, 'Invalid export format');\n    }\n\n    if (!['all', 'selected', 'successful'].includes(scope)) {\n      return sendInvalidRequestError(res, 'Invalid export scope');\n    }\n\n    // Verify the batch job belongs to the user\n    const batchJob = await storage.getBatchJob(jobId);\n    if (!batchJob || batchJob.userId !== userId) {\n      return sendInvalidRequestError(res, 'Batch job not found');\n    }\n\n    // Get results for this batch job\n    let results = await storage.getBatchResults(jobId);\n\n    // Apply scope filtering\n    if (scope === 'selected' && options?.fileIds) {\n      results = results.filter(result => options.fileIds.includes(result.id));\n    } else if (scope === 'successful') {\n      results = results.filter(result => result.status === 'success');\n    }\n\n    if (results.length === 0) {\n      return sendInvalidRequestError(res, 'No results to export');\n    }\n\n    // Prepare export data\n    const exportData: Record<string, any> = {\n      exportInfo: {\n        timestamp: new Date().toISOString(),\n        totalFiles: results.length,\n        format,\n        scope,\n        options: options || {},\n      },\n      batchJob: {\n        id: batchJob.id,\n        name: batchJob.name,\n        status: batchJob.status,\n        createdAt: batchJob.createdAt,\n        completedAt: batchJob.completedAt,\n      },\n      files: results.map(result => ({\n        id: result.id,\n        filename: result.filename,\n        status: result.status,\n        extractionDate: result.extractionDate,\n        fileType: result.fileType,\n        fileSize: result.fileSize,\n        fieldsExtracted: result.fieldsExtracted,\n        processingTime: result.processingTime,\n        authenticityScore: result.authenticityScore,\n        errorMessage: result.errorMessage,\n        metadata: options?.includeMetadata ? result.metadata : undefined,\n      })),\n    };\n\n    // Add statistics if requested\n    if (options?.includeStatistics) {\n      const totalFields = results.reduce(\n        (sum, r) => sum + r.fieldsExtracted,\n        0\n      );\n      const totalSize = results.reduce((sum, r) => sum + r.fileSize, 0);\n      const processingTimes = results.flatMap(result =>\n        typeof result.processingTime === 'number' ? [result.processingTime] : []\n      );\n      const avgProcessingTime =\n        processingTimes.length > 0\n          ? processingTimes.reduce((sum, time) => sum + time, 0) /\n            processingTimes.length\n          : 0;\n\n      exportData.statistics = {\n        totalFiles: results.length,\n        successfulFiles: results.filter(r => r.status === 'success').length,\n        errorFiles: results.filter(r => r.status === 'error').length,\n        processingFiles: results.filter(r => r.status === 'processing').length,\n        pendingFiles: results.filter(r => r.status === 'pending').length,\n        totalFields,\n        avgFields: Math.round(totalFields / results.length),\n        totalSize,\n        avgSize: totalSize / results.length,\n        avgProcessingTime,\n        successRate:\n          (results.filter(r => r.status === 'success').length /\n            results.length) *\n          100,\n        fileTypeDistribution: getFileTypeDistribution(results),\n        statusDistribution: getStatusDistribution(results),\n      };\n    }\n\n    // Add timeline if requested\n    if (options?.includeTimeline) {\n      exportData.timeline = {\n        startTime: results.length > 0 ? results[0].extractionDate : null,\n        endTime:\n          results.length > 0\n            ? results[results.length - 1].extractionDate\n            : null,\n        events: results.map(result => ({\n          timestamp: result.extractionDate,\n          filename: result.filename,\n          status: result.status,\n          processingTime: result.processingTime,\n          fieldsExtracted: result.fieldsExtracted,\n        })),\n      };\n    }\n\n    res.json({\n      success: true,\n      exportData,\n      message: `Exported ${results.length} files`,\n    });\n  } catch (error) {\n    console.error('Error exporting batch results:', error);\n    sendInternalServerError(res, 'Failed to export batch results');\n  }\n}\n\n// Helper functions for statistics\nfunction getFileTypeDistribution(\n  results: BatchResult[]\n): Record<string, number> {\n  const distribution: Record<string, number> = {};\n  results.forEach(result => {\n    const mainType = result.fileType.split('/')[0];\n    distribution[mainType] = (distribution[mainType] || 0) + 1;\n  });\n  return distribution;\n}\n\nfunction getStatusDistribution(results: BatchResult[]): Record<string, number> {\n  const distribution: Record<string, number> = {\n    success: 0,\n    error: 0,\n    processing: 0,\n    pending: 0,\n  };\n  results.forEach(result => {\n    distribution[result.status]++;\n  });\n  return distribution;\n}\n\n// ============================================================================\n// Route Registration\n// ============================================================================\n\nexport function registerBatchRoutes(app: Express) {\n  // Batch job management - require authentication\n  app.get('/api/batch/jobs', requireAuth, getBatchJobs);\n  app.get('/api/batch/jobs/:jobId/results', requireAuth, getBatchResults);\n\n  // Batch operations - require authentication\n  app.post('/api/batch/reprocess', requireAuth, reprocessFiles);\n  app.post('/api/batch/export', requireAuth, exportBatchResults);\n\n  console.log(' Batch routes registered');\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/routes/enhanced-protection.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[797,800],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[797,800],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":69,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2375,2378],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2375,2378],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":80,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2656,2659],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2656,2659],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":166,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":166,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5557,5560],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5557,5560],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"object-shorthand","severity":1,"message":"Expected property shorthand.","line":176,"column":7,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":176,"endColumn":13,"fix":{"range":[5784,5790],"text":"ip"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":182,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":182,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5933,5936],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5933,5936],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":224,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":224,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7101,7104],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7101,7104],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"object-shorthand","severity":1,"message":"Expected property shorthand.","line":251,"column":9,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":251,"endColumn":31,"fix":{"range":[7898,7920],"text":"categories"}},{"ruleId":"object-shorthand","severity":1,"message":"Expected property shorthand.","line":252,"column":9,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":252,"endColumn":25,"fix":{"range":[7930,7946],"text":"comment"}},{"ruleId":"object-shorthand","severity":1,"message":"Expected property shorthand.","line":260,"column":7,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":260,"endColumn":29,"fix":{"range":[8090,8112],"text":"categories"}},{"ruleId":"object-shorthand","severity":1,"message":"Expected property shorthand.","line":283,"column":7,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":283,"endColumn":19,"fix":{"range":[8615,8627],"text":"stats"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":345,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":345,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10356,10359],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10356,10359],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'req' is defined but never used. Allowed unused args must match /^_/u.","line":397,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":397,"endColumn":41},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":447,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":447,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13395,13398],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13395,13398],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":5,"source":"/**\n * Enhanced Protection API Routes\n * \n * API endpoints for advanced threat intelligence and behavioral analysis\n */\n\nimport { Router, Request, Response } from 'express';\nimport { enhancedProtectionMiddleware, verifyEnhancedChallengeResponse, getEnhancedProtectionStats } from '../middleware/enhanced-protection';\nimport { threatIntelligenceService } from '../monitoring/production-validation';\nimport { securityEventLogger } from '../monitoring/security-events';\nimport { ENHANCED_PROTECTION_CONFIG } from '../middleware/enhanced-protection';\n\nconst router = Router();\n\n/**\n * POST /api/enhanced-protection/check\n * Enhanced protection check endpoint\n */\nrouter.post('/check', enhancedProtectionMiddleware, async (req: Request, res: Response) => {\n  try {\n    const protectionResult = (req as any).enhancedProtectionResult;\n    \n    if (!protectionResult) {\n      return res.status(500).json({\n        error: 'Protection analysis failed',\n        message: 'Unable to perform enhanced protection analysis'\n      });\n    }\n\n    res.json({\n      success: true,\n      protection: {\n        action: protectionResult.action,\n        confidence: protectionResult.confidence,\n        riskScore: protectionResult.riskScore,\n        riskLevel: protectionResult.riskLevel,\n        reasons: protectionResult.reasons,\n        recommendations: protectionResult.recommendations,\n        incidentId: protectionResult.incidentId,\n        requiresVerification: protectionResult.requiresVerification\n      },\n      analysis: {\n        threatIntelligence: protectionResult.threatIntelligence,\n        behavioralAnalysis: protectionResult.behavioralAnalysis,\n        mlAnalysis: protectionResult.mlAnalysis,\n        deviceAnalysis: protectionResult.deviceAnalysis\n      },\n      timestamp: new Date()\n    });\n\n  } catch (error) {\n    console.error('[EnhancedProtectionCheck] Error:', error);\n    res.status(500).json({\n      error: 'Internal server error',\n      message: 'Failed to perform enhanced protection check'\n    });\n  }\n});\n\n/**\n * POST /api/enhanced-protection/verify-challenge\n * Verify enhanced challenge response\n */\nrouter.post('/verify-challenge', verifyEnhancedChallengeResponse, (req: Request, res: Response) => {\n  // Challenge passed, continue with original request\n  res.json({\n    success: true,\n    message: 'Challenge verification successful',\n    incidentId: (req as any).incidentId\n  });\n});\n\n/**\n * POST /api/enhanced-protection/behavioral-data\n * Receive behavioral analysis data from client\n */\nrouter.post('/behavioral-data', async (req: Request, res: Response) => {\n  try {\n    const { behavioralData } = req.body;\n    const userId = (req as any).user?.id;\n    \n    if (!behavioralData) {\n      return res.status(400).json({\n        error: 'Behavioral data is required'\n      });\n    }\n\n    // Validate behavioral data structure\n    const validationResult = validateBehavioralData(behavioralData);\n    if (!validationResult.isValid) {\n      return res.status(400).json({\n        error: 'Invalid behavioral data',\n        details: validationResult.errors\n      });\n    }\n\n    // Log behavioral analysis data\n    await securityEventLogger.logEvent({\n      event: 'behavioral_analysis_received',\n      severity: behavioralData.isHuman ? 'low' : 'high',\n      timestamp: new Date(),\n      source: 'behavioral_analysis',\n      ipAddress: req.ip || req.connection.remoteAddress || 'unknown',\n      userId,\n      details: {\n        behavioralScore: behavioralData.behavioralScore,\n        isHuman: behavioralData.isHuman,\n        confidence: behavioralData.confidence,\n        dataPoints: behavioralData.dataPoints,\n        collectionTime: behavioralData.collectionTime\n      }\n    });\n\n    // Process for ML model training if high confidence\n    if (behavioralData.confidence > 0.8) {\n      // This would feed into ML model for continuous improvement\n      console.log(`[BehavioralData] High confidence behavioral data received: human=${behavioralData.isHuman}, score=${behavioralData.behavioralScore}`);\n    }\n\n    // Alert for non-human behavior\n    if (!behavioralData.isHuman && behavioralData.confidence > 0.7) {\n      await securityAlertManager.sendAlert({\n        type: 'behavioral_anomaly',\n        severity: 'medium',\n        title: 'Non-Human Behavioral Patterns Detected',\n        message: `Behavioral analysis indicates automated behavior with ${Math.round(behavioralData.confidence * 100)}% confidence`,\n        details: {\n          behavioralScore: behavioralData.behavioralScore,\n          confidence: behavioralData.confidence,\n          dataPoints: behavioralData.dataPoints,\n          ipAddress: req.ip || req.connection.remoteAddress\n        },\n        metadata: {\n          category: 'behavioral_analysis',\n          tags: ['non_human', 'automated_behavior', 'high_confidence']\n        }\n      });\n    }\n\n    res.json({\n      success: true,\n      message: 'Behavioral data received successfully',\n      analysis: {\n        behavioralScore: behavioralData.behavioralScore,\n        isHuman: behavioralData.isHuman,\n        confidence: behavioralData.confidence\n      }\n    });\n\n  } catch (error) {\n    console.error('[BehavioralDataEndpoint] Error:', error);\n    res.status(500).json({\n      error: 'Internal server error',\n      message: 'Failed to process behavioral data'\n    });\n  }\n});\n\n/**\n * GET /api/enhanced-protection/threat-intel/:ip\n * Get threat intelligence for specific IP\n */\nrouter.get('/threat-intel/:ip', async (req: Request, res: Response) => {\n  try {\n    const { ip } = req.params;\n    const userId = (req as any).user?.id;\n    \n    if (!isValidIP(ip)) {\n      return res.status(400).json({\n        error: 'Invalid IP address format'\n      });\n    }\n\n    // Create mock request for threat intelligence check\n    const mockReq = {\n      ip: ip,\n      connection: { remoteAddress: ip },\n      headers: req.headers,\n      body: {},\n      path: req.path,\n      method: req.method\n    } as any;\n\n    const threatIntel = await threatIntelligenceService.checkThreatIntelligence(mockReq);\n\n    // Log the lookup\n    await securityEventLogger.logEvent({\n      event: 'threat_intelligence_lookup',\n      severity: threatIntel.threatLevel,\n      timestamp: new Date(),\n      source: 'threat_intelligence_endpoint',\n      ipAddress: ip,\n      userId,\n      details: {\n        riskScore: threatIntel.riskScore,\n        threatLevel: threatIntel.threatLevel,\n        sources: threatIntel.sources,\n        recommendations: threatIntel.recommendations\n      }\n    });\n\n    res.json({\n      success: true,\n      threatIntelligence: threatIntel,\n      timestamp: new Date()\n    });\n\n  } catch (error) {\n    console.error('[ThreatIntelEndpoint] Error:', error);\n    res.status(500).json({\n      error: 'Internal server error',\n      message: 'Failed to retrieve threat intelligence'\n    });\n  }\n});\n\n/**\n * POST /api/enhanced-protection/report-threat\n * Report malicious IP to threat intelligence services\n */\nrouter.post('/report-threat', async (req: Request, res: Response) => {\n  try {\n    const { ipAddress, categories, comment } = req.body;\n    const userId = (req as any).user?.id;\n    \n    if (!ipAddress || !categories || !Array.isArray(categories)) {\n      return res.status(400).json({\n        error: 'IP address and categories are required'\n      });\n    }\n\n    if (!isValidIP(ipAddress)) {\n      return res.status(400).json({\n        error: 'Invalid IP address format'\n      });\n    }\n\n    // Report to threat intelligence services\n    await threatIntelligenceService.reportMaliciousIP(ipAddress, categories, comment);\n\n    // Log the report\n    await securityEventLogger.logEvent({\n      event: 'threat_report_submitted',\n      severity: 'medium',\n      timestamp: new Date(),\n      source: 'threat_report_endpoint',\n      ipAddress: req.ip || req.connection.remoteAddress || 'unknown',\n      userId,\n      details: {\n        reportedIP: ipAddress,\n        categories: categories,\n        comment: comment\n      }\n    });\n\n    res.json({\n      success: true,\n      message: 'Threat report submitted successfully',\n      reportedIP: ipAddress,\n      categories: categories,\n      timestamp: new Date()\n    });\n\n  } catch (error) {\n    console.error('[ThreatReportEndpoint] Error:', error);\n    res.status(500).json({\n      error: 'Internal server error',\n      message: 'Failed to submit threat report'\n    });\n  }\n});\n\n/**\n * GET /api/enhanced-protection/stats\n * Get enhanced protection statistics\n */\nrouter.get('/stats', async (req: Request, res: Response) => {\n  try {\n    const stats = await getEnhancedProtectionStats();\n    \n    res.json({\n      success: true,\n      stats: stats,\n      timestamp: new Date()\n    });\n\n  } catch (error) {\n    console.error('[EnhancedProtectionStatsEndpoint] Error:', error);\n    res.status(500).json({\n      error: 'Internal server error',\n      message: 'Failed to retrieve enhanced protection statistics'\n    });\n  }\n});\n\n/**\n * GET /api/enhanced-protection/config\n * Get enhanced protection configuration\n */\nrouter.get('/config', (req: Request, res: Response) => {\n  // Return safe configuration (without API keys)\n  const safeConfig = {\n    features: {\n      threatIntelligence: ENHANCED_PROTECTION_CONFIG.THREAT_INTELLIGENCE,\n      behavioralAnalysis: ENHANCED_PROTECTION_CONFIG.BEHAVIORAL_ANALYSIS,\n      advancedML: ENHANCED_PROTECTION_CONFIG.ADVANCED_ML,\n      realTimeUpdates: ENHANCED_PROTECTION_CONFIG.REAL_TIME_UPDATES\n    },\n    thresholds: {\n      critical: ENHANCED_PROTECTION_CONFIG.CRITICAL_RISK_THRESHOLD,\n      high: ENHANCED_PROTECTION_CONFIG.HIGH_RISK_THRESHOLD,\n      medium: ENHANCED_PROTECTION_CONFIG.MEDIUM_RISK_THRESHOLD,\n      low: ENHANCED_PROTECTION_CONFIG.LOW_RISK_THRESHOLD\n    },\n    weights: ENHANCED_PROTECTION_CONFIG.WEIGHTS,\n    challenges: {\n      types: Object.values(ENHANCED_PROTECTION_CONFIG.CHALLENGES),\n      actions: Object.values(ENHANCED_PROTECTION_CONFIG.ACTIONS)\n    },\n    timestamp: new Date()\n  };\n\n  res.json({\n    success: true,\n    config: safeConfig\n  });\n});\n\n/**\n * POST /api/enhanced-protection/feedback\n * Submit feedback on protection decisions\n */\nrouter.post('/feedback', async (req: Request, res: Response) => {\n  try {\n    const { \n      incidentId, \n      decision, \n      wasCorrect, \n      feedback, \n      context,\n      expectedAction,\n      actualAction\n    } = req.body;\n    \n    const userId = (req as any).user?.id;\n\n    if (!incidentId || decision === undefined || wasCorrect === undefined) {\n      return res.status(400).json({\n        error: 'Incident ID, decision, and wasCorrect are required'\n      });\n    }\n\n    // Log the feedback\n    await securityEventLogger.logEvent({\n      event: 'enhanced_protection_feedback',\n      severity: wasCorrect ? 'low' : 'medium',\n      timestamp: new Date(),\n      source: 'enhanced_protection_feedback',\n      ipAddress: req.ip || req.connection.remoteAddress || 'unknown',\n      userId,\n      details: {\n        incidentId,\n        decision,\n        wasCorrect,\n        feedback: feedback || '',\n        context: context || {},\n        expectedAction,\n        actualAction\n      }\n    });\n\n    // Process feedback for ML model improvement\n    if (!wasCorrect) {\n      // This would be used to retrain or adjust the ML models\n      console.log(`[EnhancedProtectionFeedback] Incorrect decision reported for incident ${incidentId}`);\n    }\n\n    res.json({\n      success: true,\n      message: 'Feedback submitted successfully',\n      incidentId,\n      timestamp: new Date()\n    });\n\n  } catch (error) {\n    console.error('[EnhancedProtectionFeedbackEndpoint] Error:', error);\n    res.status(500).json({\n      error: 'Internal server error',\n      message: 'Failed to submit feedback'\n    });\n  }\n});\n\n/**\n * WebSocket endpoint for real-time behavioral analysis\n */\nrouter.ws('/behavioral-stream', (ws, req) => {\n  console.log('[EnhancedProtection] Behavioral analysis WebSocket connection established');\n  \n  ws.on('message', async (message) => {\n    try {\n      const data = JSON.parse(message.toString());\n      \n      if (data.type === 'behavioral_data') {\n        // Process real-time behavioral data\n        const { behavioralData } = data;\n        \n        if (behavioralData && behavioralData.confidence > 0.7) {\n          // Real-time analysis and response\n          const analysis = {\n            type: 'behavioral_analysis',\n            behavioralScore: behavioralData.behavioralScore,\n            isHuman: behavioralData.isHuman,\n            confidence: behavioralData.confidence,\n            timestamp: Date.now()\n          };\n          \n          ws.send(JSON.stringify(analysis));\n          \n          // Alert for immediate threats\n          if (!behavioralData.isHuman && behavioralData.confidence > 0.8) {\n            ws.send(JSON.stringify({\n              type: 'immediate_threat',\n              message: 'Non-human behavior detected with high confidence',\n              action: 'immediate_verification_required'\n            }));\n          }\n        }\n      }\n    } catch (error) {\n      console.error('[BehavioralStream] Error processing message:', error);\n      ws.send(JSON.stringify({\n        type: 'error',\n        message: 'Failed to process behavioral data'\n      }));\n    }\n  });\n  \n  ws.on('close', () => {\n    console.log('[EnhancedProtection] Behavioral analysis WebSocket connection closed');\n  });\n});\n\n/**\n * Helper functions\n */\nfunction validateBehavioralData(data: any): { isValid: boolean; errors: string[] } {\n  const errors: string[] = [];\n  \n  if (typeof data.behavioralScore !== 'number' || data.behavioralScore < 0 || data.behavioralScore > 100) {\n    errors.push('Behavioral score must be a number between 0 and 100');\n  }\n  \n  if (typeof data.isHuman !== 'boolean') {\n    errors.push('isHuman must be a boolean');\n  }\n  \n  if (typeof data.confidence !== 'number' || data.confidence < 0 || data.confidence > 1) {\n    errors.push('Confidence must be a number between 0 and 1');\n  }\n  \n  if (data.dataPoints && typeof data.dataPoints !== 'object') {\n    errors.push('Data points must be an object');\n  }\n  \n  return {\n    isValid: errors.length === 0,\n    errors\n  };\n}\n\nfunction isValidIP(ip: string): boolean {\n  const ipv4Regex = /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;\n  const ipv6Regex = /^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.)$/;\n  \n  return ipv4Regex.test(ip) || ipv6Regex.test(ip);\n}\n\nexport default router;","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/routes/extraction.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Response' is defined but never used.","line":10,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PythonMetadataResponse' is defined but never used.","line":17,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FrontendMetadataResponse' is defined but never used.","line":18,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TIER_CONFIGS' is defined but never used.","line":33,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getOrSetSessionId' is defined but never used.","line":49,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":49,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":129,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4394,4397],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4394,4397],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":461,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":461,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16054,16057],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16054,16057],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":493,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":493,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":506,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":506,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17323,17326],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17323,17326],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'parseError' is defined but never used.","line":740,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":740,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Extraction Routes Module\n *\n * Handles all metadata extraction endpoints:\n * - Single file extraction\n * - Batch extraction\n * - Advanced forensic analysis\n */\n\nimport type { Express, Response } from 'express';\nimport multer from 'multer';\nimport crypto from 'crypto';\nimport fs from 'fs/promises';\nimport path from 'path';\nimport { spawn } from 'child_process';\nimport {\n  PythonMetadataResponse,\n  FrontendMetadataResponse,\n  normalizeEmail,\n  getSessionId,\n  transformMetadataForFrontend,\n  extractMetadataWithPython,\n  cleanupTempFile,\n  pythonExecutable,\n  PYTHON_SCRIPT_PATH,\n} from '../utils/extraction-helpers';\nimport { storage } from '../storage/index';\nimport {\n  getTierConfig,\n  isFileTypeAllowed,\n  isFileSizeAllowed,\n  getRequiredTierForFileType,\n  TIER_CONFIGS,\n  normalizeTier,\n  toPythonTier,\n  getCreditCost,\n} from '@shared/tierConfig';\nimport type { AuthRequest } from '../auth';\nimport { requireAuth } from '../auth';\nimport {\n  sendFileTooLargeError,\n  sendInvalidFileTypeError,\n  sendTierInsufficientError,\n  sendQuotaExceededError,\n  sendInvalidRequestError,\n  sendInternalServerError,\n  sendServiceUnavailableError,\n} from '../utils/error-response';\nimport { getOrSetSessionId } from '../utils/session-id';\n\n// ============================================================================\n// Multer Configuration\n// ============================================================================\n\nconst upload = multer({\n  storage: multer.memoryStorage(),\n  limits: {\n    fileSize: 2000 * 1024 * 1024, // 2GB max (enterprise/super tier)\n  },\n});\n\n// ============================================================================\n// Trial Tracking (in-memory; replace with DB for production)\n// ============================================================================\n\n// Removed in-memory trial map - now using database-backed storage.hasTrialUsage()\n\nconst EXTRACTION_HEALTH_TIMEOUT_MS = Number(\n  process.env.EXTRACTION_HEALTH_TIMEOUT_MS ??\n    process.env.HEALTH_CHECK_TIMEOUT_MS ??\n    (process.env.NODE_ENV === 'test' ? 500 : 10000)\n);\n\nfunction getCoreBalanceKeyForSession(sessionId: string): string {\n  return `credits:core:session:${sessionId}`;\n}\n\nfunction getCoreBalanceKeyForUser(userId: string): string {\n  return `credits:core:user:${userId}`;\n}\n\nfunction shouldBypassCredits(req: AuthRequest): boolean {\n  // DEV MODE: opt-in bypass for development testing (disabled by default)\n  const bypassInDev =\n    process.env.NODE_ENV === 'development' &&\n    String(process.env.BYPASS_CREDITS_IN_DEV ?? '').toLowerCase() === 'true';\n  if (bypassInDev) return true;\n\n  // Allow deterministic route testing by bypassing credits gates.\n  // Never enable this in production.\n  if (process.env.NODE_ENV !== 'test') return false;\n  const value = String(\n    req.headers['x-test-bypass-credits'] ?? ''\n  ).toLowerCase();\n  return value === '1' || value === 'true';\n}\n\n// ============================================================================\n// Route Registration\n// ============================================================================\n\nexport function registerExtractionRoutes(app: Express): void {\n  // Main extraction endpoint\n  app.post(\n    '/api/extract',\n    upload.single('file'),\n    async (req: AuthRequest, res) => {\n      const startTime = Date.now();\n      let tempPath: string | null = null;\n      let sessionId: string | null = null;\n      let creditCost = 0;\n      let chargeCredits = false;\n      let trialEmail: string | null = null;\n      let creditBalanceId: string | null = null;\n\n      try {\n        if (!req.file) {\n          return sendInvalidRequestError(res, 'No file uploaded');\n        }\n\n        const requestedTier = (req.query.tier as string) || 'enterprise';\n        const normalizedTier = normalizeTier(requestedTier);\n        const pythonTier = toPythonTier(normalizedTier);\n        const mimeType = req.file.mimetype || 'application/octet-stream';\n        const tierConfig = getTierConfig(normalizedTier);\n        // Credits + trial tracking use a stable cookie session id (shared across localhost ports).\n        // Prefer an explicitly provided session id (query param or header). Do NOT auto-generate a new session id here\n        // because callers without a session_id should be asked to purchase credits rather than having a server-generated id.\n        sessionId = req.user?.id ? null : (getSessionId(req as any) ?? null);\n        trialEmail = normalizeEmail(req.body?.trial_email);\n        creditCost = getCreditCost(mimeType);\n        const bypassCredits = shouldBypassCredits(req);\n\n        // Validate file type for tier\n        if (!isFileTypeAllowed(normalizedTier, mimeType)) {\n          const requiredTier = getRequiredTierForFileType(mimeType);\n          return sendInvalidFileTypeError(\n            res,\n            mimeType,\n            requiredTier,\n            normalizedTier\n          );\n        }\n\n        // Validate file size for tier (do this before any payment gating)\n        if (!isFileSizeAllowed(normalizedTier, req.file.size)) {\n          const fileSizeMB =\n            Math.round((req.file.size / (1024 * 1024)) * 100) / 100;\n          return sendFileTooLargeError(\n            res,\n            fileSizeMB,\n            tierConfig.maxFileSizeMB,\n            normalizedTier\n          );\n        }\n\n        const hasTrialAvailable =\n          !!trialEmail && !(await storage.hasTrialUsage(trialEmail));\n\n        if (!bypassCredits && !hasTrialAvailable) {\n          // If unauthenticated and no explicit session id was provided, ask user to purchase credits\n          if (!req.user?.id && !sessionId) {\n            return sendQuotaExceededError(\n              res,\n              'Purchase credits to unlock a full report.'\n            );\n          }\n\n          let balanceKey: string;\n          if (req.user?.id) {\n            balanceKey = getCoreBalanceKeyForUser(req.user.id);\n          } else {\n            // Back-compat: if an older balance exists keyed by raw sessionId, keep using it.\n            const legacy = await storage.getCreditBalanceBySessionId(\n              sessionId!\n            );\n            balanceKey = legacy\n              ? sessionId!\n              : getCoreBalanceKeyForSession(sessionId!);\n          }\n\n          const balance = await storage.getOrCreateCreditBalance(\n            balanceKey,\n            req.user?.id\n          );\n          creditBalanceId = balance?.id ?? null;\n          if (!balance || balance.credits < creditCost) {\n            return sendQuotaExceededError(\n              res,\n              `Insufficient credits (required: ${creditCost}, available: ${balance?.credits ?? 0})`\n            );\n          }\n\n          chargeCredits = true;\n        }\n\n        // Write file to temp location\n        const tempDir = '/tmp/metaextract';\n        await fs.mkdir(tempDir, { recursive: true });\n        tempPath = path.join(\n          tempDir,\n          `${Date.now()}-${crypto.randomUUID()}-${req.file.originalname}`\n        );\n        await fs.writeFile(tempPath, req.file.buffer);\n\n        // Extract metadata\n        // Automatically enable advanced analysis for forensic and enterprise tiers (Phase 3.1)\n        const shouldEnableAdvancedAnalysis =\n          ['forensic', 'enterprise'].includes(normalizedTier) ||\n          req.query.advanced === 'true';\n\n        const rawMetadata = await extractMetadataWithPython(\n          tempPath,\n          pythonTier,\n          true,\n          shouldEnableAdvancedAnalysis,\n          req.query.store === 'true'\n        );\n\n        const processingMs = Date.now() - startTime;\n        rawMetadata.extraction_info.processing_ms = processingMs;\n\n        const metadata = transformMetadataForFrontend(\n          rawMetadata,\n          req.file.originalname,\n          normalizedTier\n        );\n\n        const clientLastModifiedRaw = req.body?.client_last_modified;\n        const clientLastModifiedMs = clientLastModifiedRaw\n          ? Number(clientLastModifiedRaw)\n          : null;\n        if (clientLastModifiedMs && Number.isFinite(clientLastModifiedMs)) {\n          metadata.client_last_modified_iso = new Date(\n            clientLastModifiedMs\n          ).toISOString();\n        }\n        metadata.access = {\n          trial_email_present: !!trialEmail,\n          trial_granted: bypassCredits\n            ? false\n            : hasTrialAvailable\n              ? true\n              : false,\n          credits_charged: chargeCredits ? creditCost : 0,\n          credits_required: creditCost,\n        };\n\n        // Log analytics (non-critical, error doesn't block response)\n        const fileExt =\n          path.extname(req.file.originalname).toLowerCase().slice(1) ||\n          'unknown';\n        try {\n          await storage.logExtractionUsage({\n            tier: normalizedTier,\n            fileExtension: fileExt,\n            mimeType,\n            fileSizeBytes: req.file.size,\n            isVideo: mimeType.startsWith('video/'),\n            isImage: mimeType.startsWith('image/'),\n            isPdf: mimeType === 'application/pdf',\n            isAudio: mimeType.startsWith('audio/'),\n            fieldsExtracted: metadata.fields_extracted || 0,\n            processingMs,\n            success: true,\n            ipAddress: req.ip || req.socket.remoteAddress || null,\n            userAgent: req.headers['user-agent'] || null,\n          });\n        } catch (err) {\n          console.error('[Extraction] Failed to log usage:', err);\n          // Continue - analytics failure is not blocking\n        }\n\n        //  CRITICAL: Deduct credits (must complete before responding to user)\n        if (chargeCredits && creditBalanceId) {\n          try {\n            const txn = await storage.useCredits(\n              creditBalanceId,\n              creditCost,\n              `Extraction: ${fileExt}`,\n              mimeType\n            );\n\n            if (!txn) {\n              // useCredits returns null if balance insufficient\n              // (safety check in case balance changed between validation and deduction)\n              return sendQuotaExceededError(\n                res,\n                'Credit deduction failed (insufficient balance)'\n              );\n            }\n          } catch (err) {\n            console.error('[Extraction] Failed to deduct credits:', err);\n            return sendInternalServerError(\n              res,\n              'Unable to process credit transaction. Please try again.'\n            );\n          }\n        }\n\n        if (!bypassCredits && hasTrialAvailable && trialEmail) {\n          // Record trial usage in database\n          try {\n            await storage.recordTrialUsage({\n              email: trialEmail,\n              ipAddress: req.ip || req.socket.remoteAddress || undefined,\n              userAgent: req.get('user-agent') || undefined,\n              sessionId: sessionId || undefined,\n            });\n          } catch (err) {\n            console.error('Failed to record trial usage:', err);\n          }\n        }\n\n        // Persist results to database (Fix for QuotaExceededError)\n        try {\n          const savedRecord = await storage.saveMetadata({\n            userId: req.user?.id,\n            fileName: metadata.filename,\n            fileSize: String(req.file.size),\n            mimeType: metadata.mime_type,\n            metadata,\n          });\n\n          if (savedRecord && savedRecord.id) {\n            metadata.id = savedRecord.id;\n            metadata.storage = {\n              provider: savedRecord.metadataRef?.provider ?? 'summary-only',\n              has_full_blob: !!savedRecord.metadataRef,\n            };\n            console.log(\n              `[Extraction] Saved metadata summary + blob with ID: ${savedRecord.id}`\n            );\n          } else {\n            // savedRecord could be null/undefined in degraded modes; proceed without failing\n            console.warn(\n              '[Extraction] saveMetadata returned no saved record; proceeding without DB record'\n            );\n            metadata.storage = {\n              provider: 'summary-only',\n              has_full_blob: false,\n            };\n          }\n        } catch (dbError) {\n          console.error('[Extraction] Failed to save metadata to DB:', dbError);\n          // Continue anyway - frontend will use memory fallback\n          metadata.storage = { provider: 'summary-only', has_full_blob: false };\n        }\n\n        res.json(metadata);\n      } catch (error) {\n        const processingMs = Date.now() - startTime;\n        const failureReason =\n          error instanceof Error ? error.message : 'Unknown error';\n\n        console.error('Metadata extraction error:', error);\n\n        // Log failed extraction\n        if (req.file) {\n          const fileExt =\n            path.extname(req.file.originalname).toLowerCase().slice(1) ||\n            'unknown';\n          const fallbackTier = normalizeTier(\n            (req.query.tier as string) || 'enterprise'\n          );\n          storage\n            .logExtractionUsage({\n              tier: fallbackTier,\n              fileExtension: fileExt,\n              mimeType: req.file.mimetype || 'application/octet-stream',\n              fileSizeBytes: req.file.size,\n              isVideo: false,\n              isImage: false,\n              isPdf: false,\n              isAudio: false,\n              fieldsExtracted: 0,\n              processingMs,\n              success: false,\n              failureReason,\n              ipAddress: req.ip || req.socket.remoteAddress || null,\n              userAgent: req.headers['user-agent'] || null,\n            })\n            .catch(err => console.error('Failed to log usage:', err));\n        }\n\n        sendInternalServerError(\n          res,\n          'Failed to extract metadata',\n          failureReason\n        );\n      } finally {\n        await cleanupTempFile(tempPath);\n      }\n    }\n  );\n\n  // Batch processing endpoint\n  app.post(\n    '/api/extract/batch',\n    upload.array('files', 100),\n    async (req: AuthRequest, res) => {\n      const startTime = Date.now();\n      const tempPaths: string[] = [];\n\n      try {\n        if (!req.files || !Array.isArray(req.files) || req.files.length === 0) {\n          return sendInvalidRequestError(res, 'No files uploaded');\n        }\n\n        const requestedTier = (req.query.tier as string) || 'enterprise';\n        const normalizedTier = normalizeTier(requestedTier);\n        const pythonTier = toPythonTier(normalizedTier);\n        const tierConfig = getTierConfig(normalizedTier);\n\n        if (!tierConfig.features.batchUpload) {\n          return sendTierInsufficientError(res, 'forensic', normalizedTier);\n        }\n\n        // Validate all files first\n        for (const file of req.files) {\n          const mimeType = file.mimetype || 'application/octet-stream';\n\n          if (!isFileTypeAllowed(normalizedTier, mimeType)) {\n            const requiredTier = getRequiredTierForFileType(mimeType);\n            return sendInvalidFileTypeError(res, mimeType, requiredTier);\n          }\n\n          if (!isFileSizeAllowed(normalizedTier, file.size)) {\n            const fileSizeMB =\n              Math.round((file.size / (1024 * 1024)) * 100) / 100;\n            return sendFileTooLargeError(\n              res,\n              fileSizeMB,\n              tierConfig.maxFileSizeMB\n            );\n          }\n        }\n\n        // Write all files to temp locations\n        const tempDir = '/tmp/metaextract';\n        await fs.mkdir(tempDir, { recursive: true });\n\n        const fileInfos = [];\n        for (const file of req.files) {\n          const tempPath = path.join(\n            tempDir,\n            `${Date.now()}-${crypto.randomUUID()}-${file.originalname}`\n          );\n          await fs.writeFile(tempPath, file.buffer);\n          tempPaths.push(tempPath);\n          fileInfos.push({\n            tempPath,\n            originalName: file.originalname,\n            size: file.size,\n            mimeType: file.mimetype,\n          });\n        }\n\n        // Process batch using Python engine\n        const pythonScript = PYTHON_SCRIPT_PATH;\n        const batchResults = await new Promise<any>((resolve, reject) => {\n          const pythonArgs = [\n            pythonScript,\n            '--batch',\n            '--tier',\n            pythonTier,\n            ...tempPaths,\n          ];\n          if (req.query.store === 'true') {\n            pythonArgs.push('--store');\n          }\n          const python = spawn(pythonExecutable, pythonArgs);\n\n          let stdout = '';\n          let stderr = '';\n\n          python.stdout.on('data', data => {\n            stdout += data.toString();\n          });\n\n          python.stderr.on('data', data => {\n            stderr += data.toString();\n          });\n\n          python.on('close', code => {\n            if (code !== 0) {\n              reject(new Error(`Batch processing failed: ${stderr}`));\n              return;\n            }\n\n            try {\n              resolve(JSON.parse(stdout));\n            } catch (e) {\n              reject(new Error('Failed to parse batch results'));\n            }\n          });\n\n          // Longer timeout for batch processing\n          setTimeout(() => {\n            python.kill();\n            reject(new Error('Batch processing timed out'));\n          }, 300000); // 5 minutes\n        });\n\n        // Transform results for frontend\n        const transformedResults: Record<string, any> = {};\n        for (const fileInfo of fileInfos) {\n          const directResult = batchResults.results?.[fileInfo.tempPath];\n          const fallbackKey =\n            !directResult && batchResults.results\n              ? Object.keys(batchResults.results).find(key =>\n                  key.includes(fileInfo.originalName)\n                )\n              : undefined;\n          const result =\n            directResult ||\n            (fallbackKey ? batchResults.results[fallbackKey] : undefined);\n          if (result) {\n            transformedResults[fileInfo.originalName] =\n              transformMetadataForFrontend(\n                result,\n                fileInfo.originalName,\n                normalizedTier\n              );\n          }\n        }\n\n        const processingMs = Date.now() - startTime;\n\n        res.json({\n          success: true,\n          batch_id: crypto.randomUUID(),\n          total_files: fileInfos.length,\n          successful_files: Object.keys(transformedResults).length,\n          processing_time_ms: processingMs,\n          results: transformedResults,\n          summary: batchResults.summary,\n        });\n      } catch (error) {\n        const processingMs = Date.now() - startTime;\n        console.error('Batch processing error:', error);\n\n        res.status(500).json({\n          error: 'Batch processing failed',\n          details: error instanceof Error ? error.message : 'Unknown error',\n          processing_time_ms: processingMs,\n        });\n      } finally {\n        // Clean up all temp files\n        for (const tempPath of tempPaths) {\n          await cleanupTempFile(tempPath);\n        }\n      }\n    }\n  );\n\n  // Advanced extraction with forensic analysis\n  app.post(\n    '/api/extract/advanced',\n    upload.single('file'),\n    async (req: AuthRequest, res) => {\n      const startTime = Date.now();\n      let tempPath: string | null = null;\n\n      try {\n        if (!req.file) {\n          return sendInvalidRequestError(res, 'No file uploaded');\n        }\n\n        const requestedTier = (req.query.tier as string) || 'enterprise';\n        const normalizedTier = normalizeTier(requestedTier);\n        const pythonTier = toPythonTier(normalizedTier);\n        const mimeType = req.file.mimetype || 'application/octet-stream';\n        const tierConfig = getTierConfig(normalizedTier);\n\n        // Advanced analysis requires Forensic+ tier (bypass in development)\n        if (\n          process.env.NODE_ENV !== 'development' &&\n          !['forensic', 'enterprise'].includes(normalizedTier)\n        ) {\n          return res.status(403).json({\n            error: 'Advanced analysis requires Forensic or Enterprise tier',\n            current_tier: normalizedTier,\n            required_tier: 'forensic',\n            upgrade_message:\n              'Upgrade to Forensic tier for advanced analysis capabilities',\n          });\n        }\n\n        // Validate file type and size\n        if (!isFileTypeAllowed(normalizedTier, mimeType)) {\n          const requiredTier = getRequiredTierForFileType(mimeType);\n          return res.status(403).json({\n            error: 'File type not allowed',\n            file_type: mimeType,\n            required_tier: requiredTier,\n          });\n        }\n\n        if (!isFileSizeAllowed(normalizedTier, req.file.size)) {\n          return res.status(403).json({\n            error: 'File size exceeds limit',\n            file_size_mb:\n              Math.round((req.file.size / (1024 * 1024)) * 100) / 100,\n            max_size_mb: tierConfig.maxFileSizeMB,\n          });\n        }\n\n        // Write file to temp location\n        const tempDir = '/tmp/metaextract';\n        await fs.mkdir(tempDir, { recursive: true });\n        tempPath = path.join(\n          tempDir,\n          `${Date.now()}-${crypto.randomUUID()}-${req.file.originalname}`\n        );\n        await fs.writeFile(tempPath, req.file.buffer);\n\n        // Extract with advanced analysis enabled\n        const rawMetadata = await extractMetadataWithPython(\n          tempPath,\n          pythonTier,\n          true,\n          true, // Enable advanced analysis\n          req.query.store === 'true'\n        );\n\n        const processingMs = Date.now() - startTime;\n        rawMetadata.extraction_info.processing_ms = processingMs;\n\n        const metadata = transformMetadataForFrontend(\n          rawMetadata,\n          req.file.originalname,\n          normalizedTier\n        );\n\n        // Calculate forensic score\n        let forensicScore = 100;\n        if (rawMetadata.steganography_analysis?.suspicious_score) {\n          forensicScore -=\n            rawMetadata.steganography_analysis.suspicious_score * 30;\n        }\n        if (rawMetadata.manipulation_detection?.manipulation_probability) {\n          forensicScore -=\n            rawMetadata.manipulation_detection.manipulation_probability * 50;\n        }\n        if (rawMetadata.ai_detection?.ai_probability) {\n          forensicScore -= rawMetadata.ai_detection.ai_probability * 20;\n        }\n\n        metadata.advanced_analysis = {\n          enabled: true,\n          processing_time_ms: processingMs,\n          modules_run: [\n            'steganography_detection',\n            'manipulation_detection',\n            'ai_detection',\n            'timeline_analysis',\n          ],\n          forensic_score: Math.max(0, Math.round(forensicScore)),\n          authenticity_assessment:\n            forensicScore > 80\n              ? 'authentic'\n              : forensicScore > 50\n                ? 'questionable'\n                : 'suspicious',\n        };\n\n        res.json(metadata);\n      } catch (error) {\n        console.error('Advanced extraction error:', error);\n        res.status(500).json({\n          error: 'Advanced analysis failed',\n          details: error instanceof Error ? error.message : 'Unknown error',\n        });\n      } finally {\n        await cleanupTempFile(tempPath);\n      }\n    }\n  );\n\n  // Health check endpoint for Python extraction engine\n  app.get('/api/extract/health', async (_req, res) => {\n    try {\n      // Test the Python extraction engine by running a simple check\n      const pythonScript = PYTHON_SCRIPT_PATH;\n\n      // Create a temporary empty file to test with\n      const tempDir = '/tmp/metaextract';\n      await fs.mkdir(tempDir, { recursive: true });\n      const testFilePath = path.join(tempDir, 'health_check_test.txt');\n      await fs.writeFile(testFilePath, 'health check');\n      const args = [pythonScript, testFilePath, '--tier', 'free'];\n\n      const python = spawn(pythonExecutable, args);\n\n      let responded = false;\n      const safeRespond = (fn: () => void) => {\n        if (responded) return;\n        responded = true;\n        if (res.headersSent) return;\n        fn();\n      };\n\n      let stdout = '';\n      let stderr = '';\n\n      python.stdout.on('data', (data: Buffer) => {\n        stdout += data.toString();\n      });\n\n      python.stderr.on('data', (data: Buffer) => {\n        stderr += data.toString();\n      });\n\n      python.on('close', async (code: number | null) => {\n        if (responded) return;\n        // Clean up the test file\n        try {\n          await fs.unlink(testFilePath);\n        } catch (cleanupError) {\n          console.error(\n            'Failed to clean up health check test file:',\n            cleanupError\n          );\n        }\n\n        if (code === 0) {\n          try {\n            const result = JSON.parse(stdout);\n            safeRespond(() =>\n              res.json({\n                status: 'healthy',\n                python_engine: 'available',\n                engine_version:\n                  result.extraction_info?.engine_version || 'unknown',\n                timestamp: new Date().toISOString(),\n                message: 'Python extraction engine is responding correctly',\n              })\n            );\n          } catch (parseError) {\n            safeRespond(() =>\n              res.json({\n                status: 'healthy',\n                python_engine: 'available',\n                timestamp: new Date().toISOString(),\n                message:\n                  'Python extraction engine is responding but output format may be unexpected',\n                warning: 'Could not parse Python output as JSON',\n              })\n            );\n          }\n        } else {\n          safeRespond(() =>\n            res.status(503).json({\n              status: 'unhealthy',\n              python_engine: 'unavailable',\n              error_code: code,\n              error_message: stderr || 'Unknown error',\n              timestamp: new Date().toISOString(),\n              message: 'Python extraction engine is not responding correctly',\n            })\n          );\n        }\n      });\n\n      python.on('error', async (err: Error) => {\n        if (responded) return;\n        // Clean up the test file\n        try {\n          await fs.unlink(testFilePath);\n        } catch (cleanupError) {\n          console.error(\n            'Failed to clean up health check test file:',\n            cleanupError\n          );\n        }\n\n        safeRespond(() =>\n          res.status(503).json({\n            status: 'unhealthy',\n            python_engine: 'unavailable',\n            error: err.message,\n            timestamp: new Date().toISOString(),\n            message: 'Failed to start Python extraction engine',\n          })\n        );\n      });\n\n      // Set timeout for health check\n      const timeoutId = setTimeout(() => {\n        if (!python.killed) {\n          python.kill();\n        }\n        // Clean up the test file\n        fs.unlink(testFilePath).catch(err =>\n          console.error('Failed to clean up health check test file:', err)\n        );\n\n        safeRespond(() =>\n          res.status(503).json({\n            status: 'timeout',\n            python_engine: 'unresponsive',\n            timestamp: new Date().toISOString(),\n            message:\n              'Python extraction engine did not respond within timeout period',\n          })\n        );\n      }, EXTRACTION_HEALTH_TIMEOUT_MS);\n\n      python.on('close', () => clearTimeout(timeoutId));\n      python.on('error', () => clearTimeout(timeoutId));\n    } catch (error) {\n      console.error('Health check error:', error);\n      sendServiceUnavailableError(\n        res,\n        'Health check failed with internal error'\n      );\n    }\n  });\n\n  // Full image extraction health check (ensures EXIF/RAW pipeline stays intact)\n  app.get('/api/extract/health/image', async (_req, res) => {\n    const samplePath =\n      process.env.IMAGE_HEALTHCHECK_PATH ||\n      path.join(process.cwd(), 'sample_with_meta.jpg');\n\n    try {\n      await fs.access(samplePath);\n    } catch {\n      return res.status(503).json({\n        status: 'unhealthy',\n        reason: 'sample_not_found',\n        samplePath,\n        message:\n          'Health check sample image is missing; set IMAGE_HEALTHCHECK_PATH or add sample_with_meta.jpg',\n      });\n    }\n\n    try {\n      const raw = await extractMetadataWithPython(\n        samplePath,\n        'super',\n        true,\n        true,\n        false\n      );\n      const metadata = transformMetadataForFrontend(\n        raw,\n        path.basename(samplePath),\n        'super'\n      );\n\n      const exifCount = metadata.exif ? Object.keys(metadata.exif).length : 0;\n      const fieldsExtracted = metadata.fields_extracted || 0;\n\n      return res.json({\n        status: 'healthy',\n        python_engine: 'available',\n        samplePath,\n        exif_fields: exifCount,\n        fields_extracted: fieldsExtracted,\n        engine_version: raw.extraction_info?.engine_version ?? 'unknown',\n        timestamp: new Date().toISOString(),\n        message:\n          'Full image extractor (EXIF/RAW) responded successfully using the sample image.',\n      });\n    } catch (error) {\n      console.error('[HealthCheck] Full image extractor failed:', error);\n      return res.status(503).json({\n        status: 'unhealthy',\n        python_engine: 'error',\n        samplePath,\n        error: error instanceof Error ? error.message : String(error),\n        timestamp: new Date().toISOString(),\n      });\n    }\n  });\n\n  // Retrieve saved extraction result\n  app.get(\n    '/api/extract/results/:id',\n    requireAuth,\n    async (req: AuthRequest, res) => {\n      try {\n        // Verify user owns this result\n        const result = await storage.getMetadata(req.params.id);\n        if (!result) {\n          return res.status(404).json({ error: 'Result not found' });\n        }\n\n        // Check if user owns this result\n        if (result.userId !== req.user?.id) {\n          return res.status(403).json({ error: 'Access denied' });\n        }\n\n        res.json(result.metadata);\n      } catch (error) {\n        console.error('Failed to retrieve metadata:', error);\n        res.status(500).json({ error: 'Internal server error' });\n      }\n    }\n  );\n}\n\nexport { extractMetadataWithPython, transformMetadataForFrontend };\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/routes/forensic.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":49,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":49,"endColumn":13},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":274,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":274,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9185,9188],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9185,9188],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":288,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":288,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9572,9575],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9572,9575],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":306,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":306,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10131,10134],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10131,10134],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":315,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":315,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10468,10471],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10468,10471],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":431,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":431,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14144,14147],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14144,14147],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":434,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":434,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14233,14236],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14233,14236],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":502,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":502,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16357,16360],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16357,16360],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":581,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":581,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19157,19160],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19157,19160],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":584,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":584,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19246,19249],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19246,19249],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Forensic Analysis Routes Module\n *\n * Handles forensic-specific endpoints:\n * - Metadata comparison\n * - Timeline reconstruction\n * - Forensic capabilities\n * - Forensic reports\n */\n\nimport type { Express } from 'express';\nimport type { AuthRequest } from '../auth';\nimport { requireAuth } from '../auth';\nimport multer from 'multer';\nimport crypto from 'crypto';\nimport fs from 'fs/promises';\nimport path from 'path';\nimport {\n  getTierConfig,\n  isFileTypeAllowed,\n  isFileSizeAllowed,\n  normalizeTier,\n  toPythonTier,\n  getRateLimits,\n} from '@shared/tierConfig';\nimport {\n  extractMetadataWithPython,\n  transformMetadataForFrontend,\n} from './extraction';\n\n// ============================================================================\n// Multer Configuration (secure disk storage)\n// ============================================================================\n\nconst TEMP_DIR = process.env.FORENSIC_TEMP_DIR || '/tmp/metaextract';\nconst MAX_FORENSIC_FILE_SIZE = parseInt(\n  process.env.FORENSIC_MAX_FILE_SIZE_BYTES || String(50 * 1024 * 1024),\n  10\n); // default 50MB per file\n\n// Ensure the temp dir exists with restricted permissions (owner rwx)\ntry {\n  // Use sync variant to ensure dir exists before multer initializes\n  const { mkdirSync, chmodSync } = require('fs');\n  mkdirSync(TEMP_DIR, { recursive: true, mode: 0o700 });\n  // In case the dir already existed, enforce perms\n  try {\n    chmodSync(TEMP_DIR, 0o700);\n  } catch (e) {\n    // ignore if not permitted\n  }\n} catch (e) {\n  console.warn('Could not ensure forensic temp dir exists:', e);\n}\n\nconst forensicStorage = multer.diskStorage({\n  destination: (req, file, cb) => cb(null, TEMP_DIR),\n  filename: (req, file, cb) => {\n    const safeName = `${Date.now()}-${crypto.randomUUID()}-${path.basename(\n      file.originalname\n    )}`;\n    cb(null, safeName);\n  },\n});\n\nconst upload = multer({\n  storage: forensicStorage,\n  limits: { fileSize: MAX_FORENSIC_FILE_SIZE },\n  fileFilter: (req, file, cb) => {\n    // Allow common image types only. Defer strict tier-based validation to route logic.\n    const allowed =\n      (file && file.mimetype && file.mimetype.startsWith('image/')) ||\n      ['image/heic', 'image/heif', 'image/x-canon-cr2', 'image/x-nikon-nef'].includes(\n        (file && file.mimetype) || ''\n      );\n    if (!allowed) {\n      // Reject files that are not common images\n      return cb(null, false);\n    }\n    cb(null, true);\n  },\n});\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\nasync function cleanupTempFiles(tempPaths: string[]): Promise<void> {\n  for (const tempPath of tempPaths) {\n    try {\n      await fs.unlink(tempPath);\n    } catch (error) {\n      console.error('Failed to delete temp file:', tempPath, error);\n    }\n  }\n}\n\n// ============================================================================\n// Route Registration\n// ============================================================================\n\nexport function registerForensicRoutes(app: Express): void {\n  // Forensic capabilities endpoint\n  app.get('/api/forensic/capabilities', (req, res) => {\n    const requestedTier = (req.query.tier as string) || 'enterprise';\n    const normalizedTier = normalizeTier(requestedTier);\n    const tierConfig = getTierConfig(normalizedTier);\n\n    const capabilities = {\n      tier: normalizedTier,\n      advanced_analysis_available:\n        process.env.NODE_ENV === 'development' || normalizedTier !== 'free',\n      modules: {\n        steganography_detection: {\n          available:\n            process.env.NODE_ENV === 'development' ||\n            normalizedTier === 'professional' ||\n            normalizedTier === 'forensic' ||\n            normalizedTier === 'enterprise',\n          description:\n            'Detect hidden data using LSB analysis, frequency domain analysis, and entropy calculation',\n          methods: [\n            'LSB Analysis',\n            'FFT Analysis',\n            'Entropy Calculation',\n            'Visual Attack Detection',\n          ],\n        },\n        manipulation_detection: {\n          available:\n            process.env.NODE_ENV === 'development' ||\n            normalizedTier === 'professional' ||\n            normalizedTier === 'forensic' ||\n            normalizedTier === 'enterprise',\n          description:\n            'Detect image manipulation using JPEG analysis, noise patterns, and edge inconsistencies',\n          methods: [\n            'JPEG Compression Analysis',\n            'Noise Pattern Analysis',\n            'Edge Inconsistency Detection',\n            'Copy-Move Detection',\n          ],\n        },\n        ai_content_detection: {\n          available:\n            process.env.NODE_ENV === 'development' ||\n            normalizedTier === 'professional' ||\n            normalizedTier === 'forensic' ||\n            normalizedTier === 'enterprise',\n          description: 'Detect AI-generated content in images and text',\n          methods: [\n            'Neural Network Analysis',\n            'Pattern Recognition',\n            'Metadata Analysis',\n          ],\n        },\n        metadata_comparison: {\n          available:\n            process.env.NODE_ENV === 'development' ||\n            normalizedTier === 'professional' ||\n            normalizedTier === 'forensic' ||\n            normalizedTier === 'enterprise',\n          description:\n            'Compare metadata across multiple files for consistency analysis',\n          methods: [\n            'Field-by-field Comparison',\n            'Similarity Scoring',\n            'Pattern Detection',\n          ],\n        },\n        timeline_reconstruction: {\n          available:\n            process.env.NODE_ENV === 'development' ||\n            normalizedTier === 'professional' ||\n            normalizedTier === 'forensic' ||\n            normalizedTier === 'enterprise',\n          description: 'Reconstruct chronological timeline from multiple files',\n          methods: [\n            'Timestamp Correlation',\n            'Gap Analysis',\n            'Chain of Custody',\n          ],\n        },\n        batch_processing: {\n          available:\n            process.env.NODE_ENV === 'development' ||\n            tierConfig.features.batchUpload,\n          description: 'Process multiple files simultaneously',\n          max_files:\n            process.env.NODE_ENV === 'development'\n              ? 100\n              : normalizedTier === 'enterprise'\n                ? 100\n                : normalizedTier === 'forensic'\n                  ? 50\n                  : normalizedTier === 'professional'\n                    ? 25\n                    : 0,\n        },\n      },\n      reporting: {\n        pdf_reports:\n          process.env.NODE_ENV === 'development' ||\n          normalizedTier === 'enterprise',\n        forensic_reports:\n          process.env.NODE_ENV === 'development' ||\n          normalizedTier === 'enterprise',\n        expert_witness_format:\n          process.env.NODE_ENV === 'development' ||\n          normalizedTier === 'enterprise',\n      },\n      api_access: {\n        available:\n          process.env.NODE_ENV === 'development' ||\n          normalizedTier === 'enterprise',\n        rate_limits: getRateLimits(normalizedTier),\n      },\n    };\n\n    res.json(capabilities);\n  });\n\n  // Batch metadata comparison endpoint\n  app.post(\n    '/api/compare/batch',\n    upload.array('files', 50),\n    async (req, res) => {\n      const startTime = Date.now();\n      const tempPaths: string[] = [];\n\n      try {\n        if (!req.files || !Array.isArray(req.files) || req.files.length < 2) {\n          return res.status(400).json({\n            error: 'At least 2 files required for comparison',\n          });\n        }\n\n        const requestedTier = (req.query.tier as string) || 'enterprise';\n        const normalizedTier = normalizeTier(requestedTier);\n        const pythonTier = toPythonTier(normalizedTier);\n\n        // Comparison requires Professional+ tier (disabled in dev)\n        if (\n          process.env.NODE_ENV !== 'development' &&\n          normalizedTier === 'free'\n        ) {\n          return res.status(403).json({\n            error: 'Batch comparison not available for your plan',\n            current_tier: normalizedTier,\n            required_tier: 'professional',\n          });\n        }\n\n        // Validate all files\n        for (const file of req.files) {\n          const mimeType = file.mimetype || 'application/octet-stream';\n          if (!isFileTypeAllowed(normalizedTier, mimeType)) {\n            return res.status(403).json({\n              error: `File type not allowed: ${file.originalname}`,\n              file_type: mimeType,\n            });\n          }\n          if (!isFileSizeAllowed(normalizedTier, file.size)) {\n            return res.status(403).json({\n              error: `File size exceeds limit: ${file.originalname}`,\n            });\n          }\n        }\n\n        // Files are stored by multer on disk; use file.path\n        const fileInfos = [];\n        for (const file of req.files) {\n          // multer stores the path as file.path when using diskStorage\n          const tempPath = (file as any).path;\n          if (!tempPath) {\n            // unexpected - skip this file\n            continue;\n          }\n          tempPaths.push(tempPath);\n          fileInfos.push({\n            tempPath,\n            originalName: file.originalname,\n            size: file.size,\n          });\n        }\n\n        // Extract metadata for all files\n        const metadataResults: Record<string, any> = {};\n        for (const fileInfo of fileInfos) {\n          const rawMetadata = await extractMetadataWithPython(\n            fileInfo.tempPath,\n            pythonTier,\n            false,\n            false,\n            false\n          );\n          metadataResults[fileInfo.originalName] = transformMetadataForFrontend(\n            rawMetadata,\n            fileInfo.originalName,\n            normalizedTier\n          );\n        }\n\n        // Compare metadata between files\n        const fileNames = Object.keys(metadataResults);\n        const comparisons: any[] = [];\n\n        for (let i = 0; i < fileNames.length; i++) {\n          for (let j = i + 1; j < fileNames.length; j++) {\n            const file1 = fileNames[i];\n            const file2 = fileNames[j];\n            const meta1 = metadataResults[file1];\n            const meta2 = metadataResults[file2];\n\n            const differences: any[] = [];\n            const allKeys = new Set([\n              ...Object.keys(meta1.exif || {}),\n              ...Object.keys(meta2.exif || {}),\n            ]);\n\n            let matchCount = 0;\n            let diffCount = 0;\n\n            for (const key of allKeys) {\n              const val1 = meta1.exif?.[key];\n              const val2 = meta2.exif?.[key];\n\n              if (val1 === val2) {\n                matchCount++;\n                differences.push({\n                  field: key,\n                  file1_value: val1,\n                  file2_value: val2,\n                  status: 'match',\n                });\n              } else if (val1 === undefined) {\n                diffCount++;\n                differences.push({\n                  field: key,\n                  file1_value: null,\n                  file2_value: val2,\n                  status: 'only_in_file2',\n                });\n              } else if (val2 === undefined) {\n                diffCount++;\n                differences.push({\n                  field: key,\n                  file1_value: val1,\n                  file2_value: null,\n                  status: 'only_in_file1',\n                });\n              } else {\n                diffCount++;\n                differences.push({\n                  field: key,\n                  file1_value: val1,\n                  file2_value: val2,\n                  status: 'different',\n                });\n              }\n            }\n\n            const totalFields = matchCount + diffCount;\n            const similarityScore =\n              totalFields > 0\n                ? Math.round((matchCount / totalFields) * 100)\n                : 0;\n\n            comparisons.push({\n              file1,\n              file2,\n              similarity_score: similarityScore,\n              matching_fields: matchCount,\n              different_fields: diffCount,\n              differences: differences.slice(0, 100), // Limit to prevent huge responses\n            });\n          }\n        }\n\n        res.json({\n          success: true,\n          comparison_id: crypto.randomUUID(),\n          files_compared: fileNames.length,\n          comparisons,\n          processing_time_ms: Date.now() - startTime,\n        });\n      } catch (error) {\n        console.error('Comparison error:', error);\n        res.status(500).json({\n          error: 'Comparison failed',\n          details: error instanceof Error ? error.message : 'Unknown error',\n        });\n      } finally {\n        await cleanupTempFiles(tempPaths);\n      }\n    }\n  );\n\n  // Timeline reconstruction endpoint\n  app.post(\n    '/api/timeline/reconstruct',\n    upload.array('files', 100),\n    async (req, res) => {\n      const startTime = Date.now();\n      const tempPaths: string[] = [];\n\n      try {\n        if (!req.files || !Array.isArray(req.files) || req.files.length === 0) {\n          return res.status(400).json({\n            error: 'No files uploaded for timeline reconstruction',\n          });\n        }\n\n        const requestedTier = (req.query.tier as string) || 'enterprise';\n        const normalizedTier = normalizeTier(requestedTier);\n        const pythonTier = toPythonTier(normalizedTier);\n\n        // Timeline reconstruction requires Professional+ tier (disabled in dev)\n        if (\n          process.env.NODE_ENV !== 'development' &&\n          normalizedTier === 'free'\n        ) {\n          return res.status(403).json({\n            error: 'Timeline reconstruction not available for your plan',\n            current_tier: normalizedTier,\n            required_tier: 'professional',\n          });\n        }\n\n        // Files are stored by multer on disk; use file.path\n        const allEvents: any[] = [];\n\n        for (const file of req.files) {\n          const tempPath = (file as any).path;\n          if (!tempPath) continue; // skip if not stored\n          tempPaths.push(tempPath);\n\n          const rawMetadata = await extractMetadataWithPython(\n            tempPath,\n            pythonTier,\n            false,\n            false,\n            false\n          );\n\n          const metadata = transformMetadataForFrontend(\n            rawMetadata,\n            file.originalname,\n            normalizedTier\n          );\n\n          // Extract timeline events from metadata\n          if (metadata.exif?.DateTimeOriginal) {\n            allEvents.push({\n              timestamp: metadata.exif.DateTimeOriginal,\n              event_type: 'capture',\n              source: 'EXIF:DateTimeOriginal',\n              file: file.originalname,\n            });\n          }\n          if (metadata.exif?.CreateDate) {\n            allEvents.push({\n              timestamp: metadata.exif.CreateDate,\n              event_type: 'created',\n              source: 'EXIF:CreateDate',\n              file: file.originalname,\n            });\n          }\n          if (metadata.exif?.ModifyDate) {\n            allEvents.push({\n              timestamp: metadata.exif.ModifyDate,\n              event_type: 'modified',\n              source: 'EXIF:ModifyDate',\n              file: file.originalname,\n            });\n          }\n          if (metadata.filesystem?.created) {\n            allEvents.push({\n              timestamp: metadata.filesystem.created,\n              event_type: 'file_created',\n              source: 'Filesystem',\n              file: file.originalname,\n            });\n          }\n          if (metadata.filesystem?.modified) {\n            allEvents.push({\n              timestamp: metadata.filesystem.modified,\n              event_type: 'file_modified',\n              source: 'Filesystem',\n              file: file.originalname,\n            });\n          }\n        }\n\n        // Sort events chronologically\n        allEvents.sort(\n          (a, b) =>\n            new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime()\n        );\n\n        // Detect gaps (events more than 24 hours apart)\n        const gaps: any[] = [];\n        for (let i = 0; i < allEvents.length - 1; i++) {\n          const current = new Date(allEvents[i].timestamp).getTime();\n          const next = new Date(allEvents[i + 1].timestamp).getTime();\n          const diffMs = next - current;\n          const diffHours = diffMs / (1000 * 60 * 60);\n\n          if (diffHours > 24) {\n            gaps.push({\n              start: allEvents[i].timestamp,\n              end: allEvents[i + 1].timestamp,\n              duration_hours: Math.round(diffHours),\n              duration_readable:\n                diffHours > 24\n                  ? `${Math.round(diffHours / 24)} days`\n                  : `${Math.round(diffHours)} hours`,\n              suspicious: diffHours > 168, // More than a week\n            });\n          }\n        }\n\n        res.json({\n          success: true,\n          timeline_id: crypto.randomUUID(),\n          files_analyzed: req.files.length,\n          events: allEvents,\n          gaps,\n          chain_of_custody_complete:\n            gaps.filter(g => g.suspicious).length === 0,\n          first_event: allEvents[0] || null,\n          last_event: allEvents[allEvents.length - 1] || null,\n          processing_time_ms: Date.now() - startTime,\n        });\n      } catch (error) {\n        console.error('Timeline reconstruction error:', error);\n        res.status(500).json({\n          error: 'Timeline reconstruction failed',\n          details: error instanceof Error ? error.message : 'Unknown error',\n        });\n      } finally {\n        await cleanupTempFiles(tempPaths);\n      }\n    }\n  );\n\n  // Comprehensive forensic report endpoint\n  app.post(\n    '/api/forensic/report',\n    upload.array('files', 100),\n    async (req, res) => {\n      const startTime = Date.now();\n      const tempPaths: string[] = [];\n\n      try {\n        if (!req.files || !Array.isArray(req.files) || req.files.length === 0) {\n          return res.status(400).json({\n            error: 'No files uploaded for forensic analysis',\n          });\n        }\n\n        const requestedTier = (req.query.tier as string) || 'enterprise';\n        const normalizedTier = normalizeTier(requestedTier);\n        const pythonTier = toPythonTier(normalizedTier);\n\n        // Forensic reports require Enterprise tier (disabled in dev)\n        if (\n          process.env.NODE_ENV !== 'development' &&\n          normalizedTier !== 'enterprise'\n        ) {\n          return res.status(403).json({\n            error: 'Forensic reports not available for your plan',\n            current_tier: normalizedTier,\n            required_tier: 'enterprise',\n            upgrade_message:\n              'Upgrade to Enterprise tier for professional forensic reports',\n          });\n        }\n\n        // Files are stored by multer on disk; use file.path\n        const fileAnalyses: any[] = [];\n\n        for (const file of req.files) {\n          const tempPath = (file as any).path;\n          if (!tempPath) continue; // skip if not stored\n          tempPaths.push(tempPath);\n\n          try {\n            const rawMetadata = await extractMetadataWithPython(\n              tempPath,\n              pythonTier,\n              true,\n              true, // Advanced analysis\n              false\n            );\n\n            const metadata = transformMetadataForFrontend(\n              rawMetadata,\n              file.originalname,\n              normalizedTier\n            );\n\n            let authenticityScore = 100;\n            const forensicFindings: string[] = [];\n            let riskLevel = 'low';\n\n            // Analyze forensic indicators\n            if (\n              rawMetadata.steganography_analysis?.suspicious_score &&\n              rawMetadata.steganography_analysis.suspicious_score > 0.3\n            ) {\n              forensicFindings.push('Potential steganography detected');\n              authenticityScore -= 30;\n              riskLevel = 'medium';\n            }\n\n            if (\n              rawMetadata.manipulation_detection?.manipulation_probability &&\n              rawMetadata.manipulation_detection.manipulation_probability > 0.5\n            ) {\n              forensicFindings.push('Image manipulation indicators found');\n              authenticityScore -= 50;\n              riskLevel = 'high';\n            }\n\n            if (\n              rawMetadata.ai_detection?.ai_probability &&\n              rawMetadata.ai_detection.ai_probability > 0.7\n            ) {\n              forensicFindings.push('AI-generated content detected');\n              authenticityScore -= 20;\n            }\n\n            fileAnalyses.push({\n              file_name: file.originalname,\n              file_size: file.size,\n              metadata,\n              forensic_findings: forensicFindings,\n              authenticity_score: Math.max(0, authenticityScore),\n              risk_level: riskLevel,\n            });\n          } catch (error) {\n            console.error(`Error analyzing ${file.originalname}:`, error);\n            fileAnalyses.push({\n              file_name: file.originalname,\n              file_size: file.size,\n              error: error instanceof Error ? error.message : 'Unknown error',\n              forensic_findings: [],\n              authenticity_score: 0,\n              risk_level: 'unknown',\n            });\n          }\n        }\n\n        // Generate conclusions\n        const highRiskFiles = fileAnalyses.filter(f => f.risk_level === 'high');\n        const mediumRiskFiles = fileAnalyses.filter(\n          f => f.risk_level === 'medium'\n        );\n\n        const recommendations: string[] = [];\n        if (highRiskFiles.length > 0) {\n          recommendations.push(\n            'Immediate investigation recommended for high-risk files'\n          );\n        }\n        if (mediumRiskFiles.length > 0) {\n          recommendations.push(\n            'Further analysis recommended for medium-risk files'\n          );\n        }\n        if (highRiskFiles.length === 0 && mediumRiskFiles.length === 0) {\n          recommendations.push('No significant forensic concerns detected');\n        }\n\n        const report = {\n          report_id: crypto.randomUUID(),\n          generated_at: new Date().toISOString(),\n          analyst: 'MetaExtract Forensic Engine v4.0',\n          case_summary: {\n            total_files: req.files.length,\n            file_names: fileAnalyses.map(f => f.file_name),\n            analysis_scope: 'Comprehensive forensic metadata analysis',\n          },\n          files: fileAnalyses,\n          conclusions: {\n            overall_assessment: highRiskFiles.length\n              ? 'high'\n              : mediumRiskFiles.length\n                ? 'medium'\n                : 'low',\n            files_analyzed: fileAnalyses.length,\n            high_risk_files: highRiskFiles.length,\n            medium_risk_files: mediumRiskFiles.length,\n            average_authenticity_score:\n              fileAnalyses.length > 0\n                ? Math.round(\n                    fileAnalyses.reduce(\n                      (sum, f) => sum + f.authenticity_score,\n                      0\n                    ) / fileAnalyses.length\n                  )\n                : 0,\n          },\n          recommendations,\n          processing_time_ms: Date.now() - startTime,\n        };\n\n        res.json(report);\n      } catch (error) {\n        console.error('Forensic report error:', error);\n        res.status(500).json({\n          error: 'Forensic report generation failed',\n          details: error instanceof Error ? error.message : 'Unknown error',\n        });\n      } finally {\n        await cleanupTempFiles(tempPaths);\n      }\n    }\n  );\n\n  // Advanced single file extraction with forensic analysis\n  app.post(\n    '/api/extract/advanced',\n    requireAuth,\n    upload.single('file'),\n    async (req: AuthRequest, res) => {\n      const startTime = Date.now();\n      let tempPath: string | null = null;\n\n      try {\n        if (!req.file) {\n          return res.status(400).json({ error: 'No file uploaded' });\n        }\n\n        const requestedTier = (req.query.tier as string) || 'enterprise';\n        const normalizedTier = normalizeTier(requestedTier);\n        const pythonTier = toPythonTier(normalizedTier);\n        const mimeType = req.file.mimetype || 'application/octet-stream';\n\n        // Advanced extraction requires Professional+ tier (disabled in dev)\n        if (\n          process.env.NODE_ENV !== 'development' &&\n          normalizedTier === 'free'\n        ) {\n          return res.status(403).json({\n            error: 'Advanced extraction not available for your plan',\n            current_tier: normalizedTier,\n            required_tier: 'professional',\n          });\n        }\n\n        // Validate file type for tier\n        if (!isFileTypeAllowed(normalizedTier, mimeType)) {\n          return res.status(403).json({\n            error: `File type not allowed: ${req.file.originalname}`,\n            file_type: mimeType,\n          });\n        }\n\n        // Validate file size for tier\n        if (!isFileSizeAllowed(normalizedTier, req.file.size)) {\n          return res.status(403).json({\n            error: `File size exceeds limit: ${req.file.originalname}`,\n          });\n        }\n\n        // Write file to temp location\n        const tempDir = '/tmp/metaextract';\n        await fs.mkdir(tempDir, { recursive: true });\n        tempPath = path.join(\n          tempDir,\n          `${Date.now()}-${crypto.randomUUID()}-${req.file.originalname}`\n        );\n        await fs.writeFile(tempPath, req.file.buffer);\n\n        // Extract metadata with advanced analysis enabled\n        const rawMetadata = await extractMetadataWithPython(\n          tempPath,\n          pythonTier,\n          false, // includePerformanceMetrics\n          true // enableAdvancedAnalysis\n        );\n\n        const metadata = transformMetadataForFrontend(\n          rawMetadata,\n          req.file.originalname,\n          normalizedTier\n        );\n\n        // Add advanced analysis summary\n        const advancedAnalysis = rawMetadata.advanced_analysis;\n        metadata.advanced_analysis = {\n          enabled: true,\n          processing_time_ms: advancedAnalysis?.processing_time_ms || 0,\n          modules_run: advancedAnalysis?.modules_run || [],\n          forensic_score: advancedAnalysis?.forensic_score || 0,\n          authenticity_assessment:\n            advancedAnalysis?.authenticity_assessment || 'Unknown',\n        };\n\n        const processingMs = Date.now() - startTime;\n\n        res.json({\n          ...metadata,\n          advanced_enabled: true,\n          processing_time_ms: processingMs,\n        });\n      } catch (error) {\n        const processingMs = Date.now() - startTime;\n        console.error('Advanced extraction error:', error);\n        res.status(500).json({\n          error: 'Advanced extraction failed',\n          details: error instanceof Error ? error.message : 'Unknown error',\n          processing_time_ms: processingMs,\n        });\n      } finally {\n        if (tempPath) {\n          try {\n            await fs.unlink(tempPath);\n          } catch (error) {\n            console.error('Failed to delete temp file:', tempPath, error);\n          }\n        }\n      }\n    }\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/routes/geocoding.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'generateMapPreviewUrl' is defined but never used.","line":13,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getCoordinateConfidence' is defined but never used.","line":15,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[541,544],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[541,544],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Geocoding Routes\n *\n * Reverse geocoding endpoints for converting GPS coordinates to addresses.\n * Includes caching for performance optimization.\n */\n\nimport type { Express, Request, Response } from 'express';\nimport {\n  reverseGeocode,\n  validateCoordinates,\n  generateGoogleMapsUrl,\n  generateMapPreviewUrl,\n  formatCoordinatesForDisplay,\n  getCoordinateConfidence\n} from '../utils/geolocation';\n\n/**\n * Simple in-memory cache for geocoding results\n * In production, use Redis or database\n */\nconst geocodingCache = new Map<string, any>();\n\n/**\n * Cache key for coordinates\n */\nfunction getCacheKey(lat: number, lon: number): string {\n  // Round to 4 decimal places for caching (11m precision)\n  const roundedLat = Math.round(lat * 10000) / 10000;\n  const roundedLon = Math.round(lon * 10000) / 10000;\n  return `${roundedLat},${roundedLon}`;\n}\n\n/**\n * Register geocoding routes\n */\nexport function registerGeocodingRoutes(app: Express): void {\n  /**\n   * POST /api/geocode/reverse\n   * Reverse geocode GPS coordinates to address\n   */\n  app.post('/api/geocode/reverse', async (req: Request, res: Response) => {\n    try {\n      const { latitude, longitude } = req.body;\n\n      // Validate input\n      if (latitude === undefined || longitude === undefined) {\n        return res.status(400).json({\n          error: 'Missing required fields: latitude, longitude'\n        });\n      }\n\n      const lat = parseFloat(latitude);\n      const lon = parseFloat(longitude);\n\n      // Validate coordinates\n      if (!validateCoordinates(lat, lon)) {\n        return res.status(400).json({\n          error: 'Invalid coordinates. Latitude must be -90 to 90, longitude must be -180 to 180'\n        });\n      }\n\n      // Check cache\n      const cacheKey = getCacheKey(lat, lon);\n      if (geocodingCache.has(cacheKey)) {\n        const cached = geocodingCache.get(cacheKey);\n        return res.json({\n          ...cached,\n          cached: true\n        });\n      }\n\n      // Reverse geocode\n      const result = await reverseGeocode(lat, lon);\n\n      if (!result.success) {\n        return res.status(400).json({\n          error: result.error || 'Geocoding failed'\n        });\n      }\n\n      // Add maps URLs\n      const response = {\n        ...result,\n        coordinates: formatCoordinatesForDisplay(lat, lon),\n        mapsUrl: generateGoogleMapsUrl(lat, lon),\n        osmUrl: `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}&zoom=15`,\n        cached: false\n      };\n\n      // Cache result\n      geocodingCache.set(cacheKey, response);\n\n      // Limit cache size (keep last 1000 entries)\n      if (geocodingCache.size > 1000) {\n        const firstKey = geocodingCache.keys().next().value;\n        if (firstKey !== undefined) {\n          geocodingCache.delete(firstKey);\n        }\n      }\n\n      res.json(response);\n    } catch (error) {\n      console.error('Geocoding error:', error);\n      res.status(500).json({\n        error: 'Internal server error'\n      });\n    }\n  });\n\n  /**\n   * GET /api/geocode/reverse\n   * Reverse geocode via query parameters\n   */\n  app.get('/api/geocode/reverse', async (req: Request, res: Response) => {\n    try {\n      const { latitude, longitude } = req.query;\n\n      // Validate input\n      if (!latitude || !longitude) {\n        return res.status(400).json({\n          error: 'Missing required parameters: latitude, longitude'\n        });\n      }\n\n      const lat = parseFloat(latitude as string);\n      const lon = parseFloat(longitude as string);\n\n      // Validate coordinates\n      if (!validateCoordinates(lat, lon)) {\n        return res.status(400).json({\n          error: 'Invalid coordinates'\n        });\n      }\n\n      // Check cache\n      const cacheKey = getCacheKey(lat, lon);\n      if (geocodingCache.has(cacheKey)) {\n        const cached = geocodingCache.get(cacheKey);\n        return res.json({\n          ...cached,\n          cached: true\n        });\n      }\n\n      // Reverse geocode\n      const result = await reverseGeocode(lat, lon);\n\n      if (!result.success) {\n        return res.status(400).json({\n          error: result.error || 'Geocoding failed'\n        });\n      }\n\n      const response = {\n        ...result,\n        coordinates: formatCoordinatesForDisplay(lat, lon),\n        mapsUrl: generateGoogleMapsUrl(lat, lon),\n        osmUrl: `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}&zoom=15`,\n        cached: false\n      };\n\n      // Cache result\n      geocodingCache.set(cacheKey, response);\n\n      res.json(response);\n    } catch (error) {\n      console.error('Geocoding error:', error);\n      res.status(500).json({\n        error: 'Internal server error'\n      });\n    }\n  });\n\n  /**\n   * POST /api/geocode/batch\n   * Batch reverse geocoding for multiple coordinates\n   */\n  app.post('/api/geocode/batch', async (req: Request, res: Response) => {\n    try {\n      const { coordinates } = req.body;\n\n      if (!Array.isArray(coordinates)) {\n        return res.status(400).json({\n          error: 'coordinates must be an array'\n        });\n      }\n\n      if (coordinates.length === 0) {\n        return res.status(400).json({\n          error: 'coordinates array cannot be empty'\n        });\n      }\n\n      if (coordinates.length > 100) {\n        return res.status(400).json({\n          error: 'Maximum 100 coordinates per batch'\n        });\n      }\n\n      // Process all coordinates\n      const results = await Promise.all(\n        coordinates.map(async (coord) => {\n          const { latitude, longitude } = coord;\n\n          if (latitude === undefined || longitude === undefined) {\n            return {\n              success: false,\n              error: 'Missing latitude or longitude'\n            };\n          }\n\n          const lat = parseFloat(latitude);\n          const lon = parseFloat(longitude);\n\n          if (!validateCoordinates(lat, lon)) {\n            return {\n              success: false,\n              error: 'Invalid coordinates'\n            };\n          }\n\n          // Check cache\n          const cacheKey = getCacheKey(lat, lon);\n          if (geocodingCache.has(cacheKey)) {\n            return {\n              ...geocodingCache.get(cacheKey),\n              cached: true\n            };\n          }\n\n          // Reverse geocode\n          const result = await reverseGeocode(lat, lon);\n\n          if (result.success) {\n            const response = {\n              ...result,\n              coordinates: formatCoordinatesForDisplay(lat, lon),\n              mapsUrl: generateGoogleMapsUrl(lat, lon),\n              cached: false\n            };\n\n            // Cache result\n            geocodingCache.set(cacheKey, response);\n            return response;\n          }\n\n          return result;\n        })\n      );\n\n      res.json({\n        success: true,\n        count: results.length,\n        results\n      });\n    } catch (error) {\n      console.error('Batch geocoding error:', error);\n      res.status(500).json({\n        error: 'Internal server error'\n      });\n    }\n  });\n\n  /**\n   * GET /api/geocode/cache/clear\n   * Clear geocoding cache (admin only)\n   */\n  app.get('/api/geocode/cache/clear', (req: Request, res: Response) => {\n    // In production, add proper authorization\n    geocodingCache.clear();\n    res.json({\n      success: true,\n      message: 'Geocoding cache cleared'\n    });\n  });\n\n  /**\n   * GET /api/geocode/cache/stats\n   * Get cache statistics\n   */\n  app.get('/api/geocode/cache/stats', (req: Request, res: Response) => {\n    res.json({\n      cacheSize: geocodingCache.size,\n      maxSize: 1000\n    });\n  });\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/routes/health.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'path' is defined but never used.","line":15,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":34,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":34,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":206,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":206,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6275,6278],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6275,6278],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Health Check Routes\n *\n * Provides health monitoring endpoints for:\n * - Temp directory usage\n * - Memory usage\n * - Disk space\n * - Security metrics\n */\n\nimport type { Express, Request, Response } from 'express';\nimport { checkTempHealth, cleanupOrphanedTempFiles } from '../startup-cleanup';\nimport os from 'os';\nimport fs from 'fs/promises';\nimport path from 'path';\n\n/**\n * Register health check routes\n */\nexport function registerHealthRoutes(app: Express): void {\n  // Basic health check\n  app.get('/api/health', async (req: Request, res: Response) => {\n    try {\n      res.json({\n        status: 'healthy',\n        timestamp: new Date().toISOString(),\n        uptime: process.uptime(),\n        memory: process.memoryUsage(),\n        pid: process.pid,\n        node: process.version,\n        platform: os.platform(),\n        arch: os.arch(),\n      });\n    } catch (error) {\n      res.status(500).json({\n        status: 'unhealthy',\n        error: 'Health check failed',\n        timestamp: new Date().toISOString(),\n      });\n    }\n  });\n\n  // Temp directory health check\n  app.get('/api/health/disk', async (req: Request, res: Response) => {\n    try {\n      const tempHealth = await checkTempHealth();\n\n      // Get disk space info\n      const diskInfo = {\n        total: os.totalmem(),\n        free: os.freemem(),\n        used: os.totalmem() - os.freemem(),\n        usage_percent: Math.round(\n          ((os.totalmem() - os.freemem()) / os.totalmem()) * 100\n        ),\n      };\n\n      const response = {\n        status: tempHealth.healthy ? 'healthy' : 'warning',\n        timestamp: new Date().toISOString(),\n        temp_directories: {\n          healthy: tempHealth.healthy,\n          total_size: tempHealth.totalSize,\n          file_count: tempHealth.fileCount,\n          warnings: tempHealth.warnings,\n          limits: {\n            max_size_bytes: 10 * 1024 * 1024 * 1024, // 10GB\n            max_file_count: 1000,\n            max_file_age_ms: 60 * 60 * 1000, // 1 hour\n          },\n        },\n        memory: diskInfo,\n      };\n\n      if (tempHealth.healthy) {\n        res.json(response);\n      } else {\n        res.status(503).json(response);\n      }\n    } catch (error) {\n      res.status(500).json({\n        status: 'error',\n        error: 'Disk health check failed',\n        timestamp: new Date().toISOString(),\n        details: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  });\n\n  // Trigger temp cleanup manually\n  app.post('/api/health/cleanup', async (req: Request, res: Response) => {\n    try {\n      // Optional: Add authentication for this endpoint in production\n      if (\n        process.env.NODE_ENV === 'production' &&\n        !req.headers['x-admin-token']\n      ) {\n        return res.status(401).json({\n          error: 'Unauthorized',\n          message: 'Admin token required for cleanup',\n        });\n      }\n\n      const result = await cleanupOrphanedTempFiles();\n\n      res.json({\n        status: 'success',\n        timestamp: new Date().toISOString(),\n        cleanup: {\n          files_removed: result.totalFilesRemoved,\n          space_freed_bytes: result.totalSpaceFreed,\n          space_freed_mb: Math.round(result.totalSpaceFreed / (1024 * 1024)),\n          duration_ms: result.totalDuration,\n          directories: result.directories.map(d => ({\n            path: d.directory,\n            files_removed: d.filesRemoved,\n            space_freed_bytes: d.spaceFreed,\n            errors: d.errors.length,\n          })),\n          warnings: result.warnings,\n          errors: result.errors,\n        },\n      });\n    } catch (error) {\n      res.status(500).json({\n        status: 'error',\n        error: 'Cleanup failed',\n        timestamp: new Date().toISOString(),\n        details: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  });\n\n  // Security metrics endpoint\n  app.get('/api/health/security', async (req: Request, res: Response) => {\n    try {\n      // Get basic security metrics\n      const tempHealth = await checkTempHealth();\n\n      // Get process security info\n      const securityInfo = {\n        uid: process.getuid?.() || null,\n        gid: process.getgid?.() || null,\n        groups: process.getgroups?.() || null,\n        cwd: process.cwd(),\n        execPath: process.execPath,\n        version: process.version,\n        argv: process.argv,\n      };\n\n      // Get environment security info (redacted)\n      const envSecurity = {\n        node_env: process.env.NODE_ENV,\n        has_database_url: !!process.env.DATABASE_URL,\n        has_redis_url: !!process.env.REDIS_URL,\n        has_jwt_secret: !!process.env.JWT_SECRET,\n        has_token_secret: !!process.env.TOKEN_SECRET,\n        app_version: process.env.APP_VERSION,\n        has_dodo_api_key: !!process.env.DODO_PAYMENTS_API_KEY,\n      };\n\n      res.json({\n        status: 'healthy',\n        timestamp: new Date().toISOString(),\n        security: {\n          temp_directories: {\n            healthy: tempHealth.healthy,\n            file_count: tempHealth.fileCount,\n            total_size: tempHealth.totalSize,\n            warnings: tempHealth.warnings.length,\n          },\n          process: securityInfo,\n          environment: envSecurity,\n          memory: {\n            usage: process.memoryUsage(),\n            system: {\n              total: os.totalmem(),\n              free: os.freemem(),\n              usage_percent: Math.round(\n                ((os.totalmem() - os.freemem()) / os.totalmem()) * 100\n              ),\n            },\n          },\n        },\n      });\n    } catch (error) {\n      res.status(500).json({\n        status: 'error',\n        error: 'Security health check failed',\n        timestamp: new Date().toISOString(),\n        details: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  });\n\n  // Detailed system info (for debugging)\n  app.get('/api/health/system', async (req: Request, res: Response) => {\n    try {\n      const uptime = process.uptime();\n      const loadAvg = os.loadavg();\n      const cpuCount = os.cpus().length;\n      const networkInterfaces = os.networkInterfaces();\n\n      // Get disk space for temp directories\n      const tempDirs = ['/tmp', '/tmp/metaextract', '/tmp/metaextract-uploads'];\n      const diskInfo: Record<string, any> = {};\n\n      for (const dir of tempDirs) {\n        try {\n          const stats = await fs.stat(dir);\n          diskInfo[dir] = {\n            exists: true,\n            size: stats.size,\n            mode: stats.mode.toString(8),\n            uid: stats.uid,\n            gid: stats.gid,\n            atime: stats.atime,\n            mtime: stats.mtime,\n            ctime: stats.ctime,\n          };\n        } catch (error) {\n          diskInfo[dir] = {\n            exists: false,\n            error: (error as Error).message,\n          };\n        }\n      }\n\n      res.json({\n        status: 'healthy',\n        timestamp: new Date().toISOString(),\n        system: {\n          hostname: os.hostname(),\n          platform: os.platform(),\n          arch: os.arch(),\n          release: os.release(),\n          uptime: os.uptime(),\n          loadavg: loadAvg,\n          cpu_count: cpuCount,\n          memory: {\n            total: os.totalmem(),\n            free: os.freemem(),\n            used: os.totalmem() - os.freemem(),\n            usage_percent: Math.round(\n              ((os.totalmem() - os.freemem()) / os.totalmem()) * 100\n            ),\n          },\n          process: {\n            pid: process.pid,\n            ppid: process.ppid,\n            uptime,\n            version: process.version,\n            versions: process.versions,\n            arch: process.arch,\n            platform: process.platform,\n            argv: process.argv,\n            execPath: process.execPath,\n            cwd: process.cwd(),\n            memory: process.memoryUsage(),\n          },\n          network: {\n            interfaces: Object.keys(networkInterfaces),\n          },\n          disk: diskInfo,\n        },\n      });\n    } catch (error) {\n      res.status(500).json({\n        status: 'error',\n        error: 'System health check failed',\n        timestamp: new Date().toISOString(),\n        details: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  });\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/routes/images-mvp-enhanced.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[962,965],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[962,965],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Enhanced Images MVP Route with Quota Enforcement\n * Integrates the 3-tier quota enforcement system\n */\n\nimport type { Express } from 'express';\nimport { freeQuotaMiddleware } from '../middleware/free-quota';\n\n/**\n * Register enhanced Images MVP routes with quota enforcement\n * This wraps the existing routes with our quota system\n */\nexport function registerEnhancedImagesMvpRoutes(app: Express): void {\n  // Apply quota enforcement to the main extraction endpoint\n  app.post('/api/images_mvp/extract', freeQuotaMiddleware);\n  \n  // The quota enforcement will call the original handler if within limits\n  // or return appropriate error responses if quota exceeded\n}\n\n/**\n * Alternative: Modify the existing route registration\n * This approach integrates directly into the existing route\n */\nexport function enhanceExistingImagesMvpRoutes(app: Express): void {\n  // Store original route handler\n  const originalRoute = app._router.stack.find(\n    (layer: any) => layer.route && layer.route.path === '/api/images_mvp/extract'\n  );\n  \n  if (originalRoute) {\n    // Apply quota enforcement to existing route\n    app.use('/api/images_mvp/extract', freeQuotaMiddleware);\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/routes/images-mvp.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'NextFunction' is defined but never used.","line":1,"column":43,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":55},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RedisClientType' is defined but never used.","line":11,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DODO_IMAGES_MVP_PRODUCTS' is defined but never used.","line":41,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":59},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getClientIP' is defined but never used.","line":42,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":42,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'processImageBuffer' is defined but never used.","line":45,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":45,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2220,2223],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2220,2223],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'progressSubscriber' is assigned a value but never used.","line":67,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":67,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2256,2259],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2256,2259],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":161,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4796,4799],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4796,4799],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5426,5429],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5426,5429],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":182,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":182,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5476,5479],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5476,5479],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":187,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5657,5660],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5657,5660],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":221,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":221,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6466,6469],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6466,6469],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":422,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":422,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11601,11604],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11601,11604],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":429,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":429,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11829,11832],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11829,11832],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":558,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":558,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14885,14888],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14885,14888],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":559,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":559,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14923,14926],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14923,14926],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sanitizedEvent' is assigned a value but never used.","line":695,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":695,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1017,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1017,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30320,30323],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30320,30323],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1038,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1038,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31062,31065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31062,31065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1461,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1461,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[44705,44708],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[44705,44708],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1744,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1744,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[55760,55763],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[55760,55763],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1843,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1843,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[59047,59050],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[59047,59050],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1850,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1850,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[59273,59276],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[59273,59276],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1910,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1910,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[61859,61862],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[61859,61862],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1920,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1920,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[62258,62261],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[62258,62261],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":26,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Express, Request, Response, NextFunction } from 'express';\nimport type { WebSocket } from 'ws';\nimport multer from 'multer';\nimport crypto from 'crypto';\nimport fs from 'fs/promises';\nimport path from 'path';\nimport os from 'os';\nimport { fileTypeFromBuffer } from 'file-type';\nimport { eq } from 'drizzle-orm';\nimport DodoPayments from 'dodopayments';\nimport { createClient, type RedisClientType } from 'redis';\nimport { getDatabase, isDatabaseConnected } from '../db';\nimport { trialUsages } from '@shared/schema';\nimport { storage } from '../storage/index';\nimport {\n  extractMetadataWithPython,\n  transformMetadataForFrontend,\n  normalizeEmail,\n  getSessionId,\n  cleanupTempFile,\n  applyAccessModeRedaction,\n} from '../utils/extraction-helpers';\nimport {\n  sendQuotaExceededError,\n  sendInvalidRequestError,\n  sendInternalServerError,\n} from '../utils/error-response';\nimport { freeQuotaMiddleware } from '../middleware/free-quota';\nimport { securityEventLogger } from '../monitoring/security-events';\nimport {\n  generateClientToken,\n  verifyClientToken,\n  getClientUsage,\n  incrementUsage,\n  handleQuotaExceeded,\n  checkCircuitBreaker,\n  getServerDeviceId,\n  checkDeviceSuspicious,\n} from '../utils/free-quota-enforcement';\nimport { circuitBreaker } from '../utils/circuit-breaker';\nimport { IMAGES_MVP_CREDIT_PACKS, DODO_IMAGES_MVP_PRODUCTS } from '../payments';\nimport { getClientIP, sanitizeFilename } from '../security-utils';\nimport { rateLimitExtraction } from '../rateLimitMiddleware';\n// Utility available for future \"Safe Export\" feature (stripping metadata for privacy)\nimport { processImageBuffer } from '../utils/exif-stripper';\nimport { type AuthRequest as ServerAuthRequest, requireAuth } from '../auth';\nimport { getOrSetSessionId } from '../utils/session-id';\n\n// WebSocket progress tracking\ninterface ProgressConnection {\n  ws: WebSocket;\n  sessionId: string;\n  startTime: number;\n}\n\nconst activeConnections = new Map<string, ProgressConnection[]>();\n\ntype ProgressBusMessage = {\n  instanceId: string;\n  sessionId: string;\n  payload: Record<string, unknown>;\n};\n\nconst PROGRESS_CHANNEL = 'images_mvp:progress';\nconst PROGRESS_INSTANCE_ID = crypto.randomUUID();\nlet progressPublisher: any = null;\nlet progressSubscriber: any = null;\nlet progressBusReady = false;\nlet progressBusInit: Promise<void> | null = null;\n\nasync function initProgressBus(): Promise<void> {\n  if (progressBusReady || progressBusInit) {\n    return progressBusInit ?? Promise.resolve();\n  }\n\n  if (process.env.IMAGES_MVP_PROGRESS_BUS !== 'redis') {\n    return;\n  }\n\n  const redisUrl = process.env.REDIS_URL;\n  if (!redisUrl) {\n    return;\n  }\n\n  progressBusInit = (async () => {\n    try {\n      const publisher = createClient({ url: redisUrl });\n      const subscriber = publisher.duplicate();\n\n      publisher.on('error', err => {\n        console.error('Progress bus Redis publisher error:', err);\n        progressBusReady = false;\n      });\n      subscriber.on('error', err => {\n        console.error('Progress bus Redis subscriber error:', err);\n        progressBusReady = false;\n      });\n\n      await publisher.connect();\n      await subscriber.connect();\n\n      await subscriber.subscribe(PROGRESS_CHANNEL, message => {\n        try {\n          const parsed = JSON.parse(message) as ProgressBusMessage;\n          if (!parsed || parsed.instanceId === PROGRESS_INSTANCE_ID) {\n            return;\n          }\n          if (!parsed.sessionId || !parsed.payload) {\n            return;\n          }\n          sendToConnections(parsed.sessionId, parsed.payload);\n        } catch (error: unknown) {\n          console.error('Progress bus message parse error:', error);\n        }\n      });\n\n      progressPublisher = publisher;\n      progressSubscriber = subscriber;\n      progressBusReady = true;\n    } catch (error: unknown) {\n      console.error('Failed to initialize progress bus:', error);\n      progressPublisher = null;\n      progressSubscriber = null;\n      progressBusReady = false;\n      progressBusInit = null;\n    }\n  })();\n\n  return progressBusInit;\n}\n\nfunction sendToConnections(\n  sessionId: string,\n  payload: Record<string, unknown>\n): void {\n  const connections = activeConnections.get(sessionId);\n  if (!connections || connections.length === 0) return;\n\n  const messageStr = JSON.stringify(payload);\n  connections.forEach(conn => {\n    if (conn.ws.readyState === 1) {\n      conn.ws.send(messageStr);\n    }\n  });\n}\n\nfunction publishProgressPayload(\n  sessionId: string,\n  payload: Record<string, unknown>\n): void {\n  if (!progressPublisher || !progressBusReady) return;\n\n  const message: ProgressBusMessage = {\n    instanceId: PROGRESS_INSTANCE_ID,\n    sessionId,\n    payload,\n  };\n\n  progressPublisher\n    .publish(PROGRESS_CHANNEL, JSON.stringify(message))\n    .catch((error: any) => {\n      console.error('Failed to publish progress event:', error);\n    });\n}\n\n// ============================================================================\n// Configuration\n// ============================================================================\n\ntype AuthRequest = ServerAuthRequest;\n\nfunction getDodoClient() {\n  const apiKey = process.env.DODO_PAYMENTS_API_KEY || process.env.DOOD_API_KEY;\n  const env =\n    (process.env.DODO_ENV || process.env.DOOD_ENV) !== 'live'\n      ? 'test_mode'\n      : 'live_mode';\n  if (!apiKey) return null;\n\n  const cacheKey = `${apiKey}:${env}`;\n  const cached = (getDodoClient as any)._cached as\n    | { cacheKey: string; client: any }\n    | undefined;\n  if (cached?.cacheKey === cacheKey) return cached.client;\n\n  const client = new DodoPayments({ bearerToken: apiKey, environment: env });\n  (getDodoClient as any)._cached = { cacheKey, client };\n  return client;\n}\n\n// WebSocket Progress Tracking Functions\nfunction broadcastProgress(\n  sessionId: string,\n  progress: number,\n  message: string,\n  stage?: string\n) {\n  const progressData = {\n    type: 'progress',\n    sessionId,\n    progress: Math.min(100, Math.max(0, progress)),\n    message,\n    stage: stage || 'processing',\n    timestamp: Date.now(),\n  };\n  sendToConnections(sessionId, progressData);\n  publishProgressPayload(sessionId, progressData);\n}\n\nfunction broadcastError(sessionId: string, error: string) {\n  const errorData = {\n    type: 'error',\n    sessionId,\n    error,\n    timestamp: Date.now(),\n  };\n  sendToConnections(sessionId, errorData);\n  publishProgressPayload(sessionId, errorData);\n}\n\nfunction broadcastComplete(sessionId: string, metadata: any) {\n  const completeData = {\n    type: 'complete',\n    sessionId,\n    metadata: {\n      fields_extracted: metadata.fields_extracted || 0,\n      processing_time_ms: metadata.processing_time_ms || 0,\n      file_size: metadata.file_size || 0,\n    },\n    timestamp: Date.now(),\n  };\n  sendToConnections(sessionId, completeData);\n  publishProgressPayload(sessionId, completeData);\n}\n\nfunction cleanupConnections(sessionId: string) {\n  const connections = activeConnections.get(sessionId);\n  if (connections) {\n    connections.forEach(conn => {\n      if (conn.ws.readyState === 1) {\n        conn.ws.close();\n      }\n    });\n    activeConnections.delete(sessionId);\n  }\n}\n\nconst IMAGES_MVP_MAX_BYTES = 100 * 1024 * 1024;\nconst IMAGES_MVP_MAX_FILES = 1;\nconst IMAGES_MVP_QUOTE_TTL_MS = 10 * 60 * 1000;\nconst IMAGES_MVP_QUOTE_VERSION = 'images_mvp_quote_v1';\n\nconst IMAGES_MVP_MP_BUCKETS = [\n  { label: 'standard', maxMp: 12, credits: 0 },\n  { label: 'large', maxMp: 24, credits: 1 },\n  { label: 'xl', maxMp: 48, credits: 3 },\n  { label: 'xxl', maxMp: 96, credits: 7 },\n] as const;\n\nconst IMAGES_MVP_CREDIT_SCHEDULE = {\n  base: 1,\n  embedding: 3,\n  ocr: 6,\n  forensics: 4,\n  mpBuckets: IMAGES_MVP_MP_BUCKETS,\n  standardCreditsPerImage: 4,\n} as const;\n\ntype ImagesMvpQuoteOps = {\n  embedding?: boolean;\n  ocr?: boolean;\n  forensics?: boolean;\n};\n\ntype ImagesMvpQuoteFile = {\n  id: string;\n  name: string;\n  mime?: string | null;\n  sizeBytes: number;\n  width?: number | null;\n  height?: number | null;\n};\n\ntype ImagesMvpQuoteEntry = {\n  accepted: boolean;\n  reason?: string;\n  detected_type?: string | null;\n  creditsTotal?: number;\n  mp?: number | null;\n  mpBucket?: string | null;\n  breakdown?: {\n    base: number;\n    embedding: number;\n    ocr: number;\n    forensics: number;\n    mp: number;\n  };\n  warnings?: string[];\n  sizeBytes?: number;\n  name?: string;\n};\n\nconst imagesMvpQuoteStore = new Map<\n  string,\n  {\n    expiresAt: number;\n    signature: string;\n    files: ImagesMvpQuoteFile[];\n    ops: ImagesMvpQuoteOps;\n    perFile: Record<string, ImagesMvpQuoteEntry>;\n  }\n>();\n\nfunction getExtensionFromName(name: string): string | null {\n  const idx = name.lastIndexOf('.');\n  if (idx <= 0) return null;\n  return name.slice(idx).toLowerCase();\n}\n\nfunction computeMp(\n  width?: number | null,\n  height?: number | null\n): number | null {\n  if (!width || !height || width <= 0 || height <= 0) return null;\n  const mp = (width * height) / 1_000_000;\n  return Number.isFinite(mp) ? Math.round(mp * 10) / 10 : null;\n}\n\nfunction resolveMpBucket(mp: number | null): {\n  label: string;\n  credits: number;\n  maxMp: number;\n  warning?: string;\n  invalid?: boolean;\n} {\n  const maxBucket = IMAGES_MVP_MP_BUCKETS[IMAGES_MVP_MP_BUCKETS.length - 1];\n  if (mp === null) {\n    return {\n      label: 'unknown',\n      credits: maxBucket.credits,\n      maxMp: maxBucket.maxMp,\n      warning: 'Dimensions unknown; using conservative size bucket.',\n    };\n  }\n  for (const bucket of IMAGES_MVP_MP_BUCKETS) {\n    if (mp <= bucket.maxMp) {\n      return {\n        label: bucket.label,\n        credits: bucket.credits,\n        maxMp: bucket.maxMp,\n      };\n    }\n  }\n  return {\n    label: 'oversize',\n    credits: maxBucket.credits,\n    maxMp: maxBucket.maxMp,\n    invalid: true,\n  };\n}\n\nfunction buildQuoteSignature(payload: unknown): string {\n  return crypto\n    .createHash('sha256')\n    .update(JSON.stringify(payload))\n    .digest('hex');\n}\n\nfunction getStoredQuote(quoteId: string) {\n  const stored = imagesMvpQuoteStore.get(quoteId);\n  if (!stored) return null;\n  if (Date.now() > stored.expiresAt) {\n    imagesMvpQuoteStore.delete(quoteId);\n    return null;\n  }\n  return stored;\n}\n\n// Use disk storage to prevent DoS via memory exhaustion\nconst uploadDir = path.join(os.tmpdir(), 'metaextract-uploads');\nfs.mkdir(uploadDir, { recursive: true }).catch(e =>\n  console.warn('Failed to create upload dir:', e)\n);\n\nconst upload = multer({\n  storage: multer.diskStorage({\n    destination: uploadDir,\n    filename: (req, file, cb) => {\n      const hash = crypto.randomBytes(8).toString('hex');\n      const sanitized = sanitizeFilename(file.originalname).replace(\n        /[^a-z0-9._-]/gi,\n        '_'\n      );\n      cb(null, `${hash}-${Date.now()}-${sanitized}`);\n    },\n  }),\n  limits: {\n    fileSize: IMAGES_MVP_MAX_BYTES,\n  },\n  fileFilter: (req, file, cb) => {\n    // SECURITY: Reject invalid file types before disk write\n    const mimeType = file.mimetype;\n    const fileExt = path.extname(file.originalname).toLowerCase();\n\n    // Check MIME type against supported list\n    const isSupportedMime = SUPPORTED_IMAGE_MIMES.has(mimeType);\n\n    // Check file extension as additional validation\n    const isSupportedExt = fileExt\n      ? SUPPORTED_IMAGE_EXTENSIONS.has(fileExt)\n      : false;\n\n    // Allow if either MIME type or extension is supported (defensive)\n    if (isSupportedMime || isSupportedExt) {\n      return cb(null, true);\n    }\n\n    // Reject with descriptive error\n    // Provide a concise, security-minded error message for clients\n    const errorMessage = 'File type not permitted';\n    const error = new Error(errorMessage);\n    (error as any).code = 'UNSUPPORTED_FILE_TYPE';\n\n    // Log the detailed reason at debug level for diagnostics\n    console.debug(\n      `Rejected upload - unsupported file type: ${mimeType} (extension: ${fileExt})`\n    );\n\n    cb(error as any, false);\n  },\n});\n\nconst SUPPORTED_IMAGE_MIMES = new Set([\n  // Original MVP formats\n  'image/jpeg',\n  'image/png',\n  'image/webp',\n  'image/heic',\n  'image/heif',\n\n  // Enhanced formats\n  'image/tiff',\n  'image/bmp',\n  'image/gif',\n  'image/x-icon',\n  'image/svg+xml',\n  'image/x-raw',\n  'image/x-canon-cr2',\n  'image/x-nikon-nef',\n  'image/x-sony-arw',\n  'image/x-adobe-dng',\n  'image/x-olympus-orf',\n  'image/x-fuji-raf',\n  'image/x-pentax-pef',\n  'image/x-sigma-x3f',\n  'image/x-samsung-srw',\n  'image/x-panasonic-rw2',\n]);\n\nconst SUPPORTED_IMAGE_EXTENSIONS = new Set([\n  // Original MVP formats (maintained for backward compatibility)\n  '.jpg',\n  '.jpeg',\n  '.png',\n  '.webp',\n  '.heic',\n  '.heif',\n\n  // Enhanced formats from our comprehensive system\n  '.tiff',\n  '.tif',\n  '.bmp',\n  '.gif',\n  '.ico',\n  '.svg',\n  '.raw',\n  '.cr2',\n  '.nef',\n  '.arw',\n  '.dng',\n  '.orf',\n  '.raf',\n  '.pef',\n  '.x3f',\n  '.srw',\n  '.rw2',\n]);\n\nfunction getBaseUrl(): string {\n  if (process.env.REPLIT_DEV_DOMAIN) {\n    return `https://${process.env.REPLIT_DEV_DOMAIN}`;\n  }\n  if (process.env.RAILWAY_PUBLIC_DOMAIN) {\n    return `https://${process.env.RAILWAY_PUBLIC_DOMAIN}`;\n  }\n  if (process.env.BASE_URL) {\n    return process.env.BASE_URL;\n  }\n  return 'http://localhost:3000';\n}\n\nfunction getImagesMvpBalanceKeyForSession(sessionId: string): string {\n  return `images_mvp:${sessionId}`;\n}\n\nfunction getImagesMvpBalanceKeyForUser(userId: string): string {\n  return `images_mvp:user:${userId}`;\n}\n\nconst ANALYTICS_LIMIT_DEFAULT = 5000;\n\nfunction isPlainObject(value: unknown): value is Record<string, unknown> {\n  return !!value && typeof value === 'object' && !Array.isArray(value);\n}\n\nfunction parseAnalyticsPeriod(value?: string): {\n  range: '24h' | '7d' | '30d' | 'all';\n  since: Date | null;\n} {\n  const normalized = (value || '7d').toLowerCase();\n  const now = Date.now();\n\n  switch (normalized) {\n    case '24h':\n    case '1d':\n    case 'day':\n      return { range: '24h', since: new Date(now - 24 * 60 * 60 * 1000) };\n    case '30d':\n    case 'month':\n      return { range: '30d', since: new Date(now - 30 * 24 * 60 * 60 * 1000) };\n    case 'all':\n      return { range: 'all', since: null };\n    case '7d':\n    case 'week':\n    default:\n      return { range: '7d', since: new Date(now - 7 * 24 * 60 * 60 * 1000) };\n  }\n}\n\nfunction parseLimitParam(value?: string): number {\n  if (!value) return ANALYTICS_LIMIT_DEFAULT;\n  const parsed = Number.parseInt(value, 10);\n  if (!Number.isFinite(parsed) || parsed <= 0) {\n    return ANALYTICS_LIMIT_DEFAULT;\n  }\n  return parsed;\n}\n\n// ============================================================================\n// Routes\n// ============================================================================\n\nexport function registerImagesMvpRoutes(app: Express) {\n  void initProgressBus();\n  // ---------------------------------------------------------------------------\n  // WebSocket: Real-time Progress Tracking\n  // ---------------------------------------------------------------------------\n  if (typeof (app as any).ws === 'function') {\n    (app as any).ws(\n      '/api/images_mvp/progress/:sessionId',\n      (ws: WebSocket, req: Request) => {\n        const sessionId = req.params.sessionId;\n\n        if (!sessionId) {\n          ws.close(1002, 'Session ID required');\n          return;\n        }\n\n        // Validate session ID format\n        const sanitizedSessionId = sanitizeFilename(sessionId);\n        if (sanitizedSessionId !== sessionId) {\n          ws.close(1008, 'Invalid session ID format');\n          return;\n        }\n\n        // Optional: Validate client token for WebSocket connection\n        const clientToken = req.cookies?.metaextract_client;\n        const clientId = req.query?.clientId as string;\n\n        if (clientId && clientToken) {\n          const decoded = verifyClientToken(clientToken);\n          if (!decoded || decoded.clientId !== clientId) {\n            ws.close(1008, 'Client token validation failed');\n            return;\n          }\n        }\n\n        // Add connection to active connections\n        const connection: ProgressConnection = {\n          ws,\n          sessionId,\n          startTime: Date.now(),\n        };\n\n        if (!activeConnections.has(sessionId)) {\n          activeConnections.set(sessionId, []);\n        }\n        activeConnections.get(sessionId)!.push(connection);\n\n        // Send initial connection confirmation\n        ws.send(\n          JSON.stringify({\n            type: 'connected',\n            sessionId,\n            timestamp: Date.now(),\n          })\n        );\n\n        // Handle incoming messages (if needed for client acknowledgments)\n        ws.on('message', data => {\n          try {\n            const message = JSON.parse(data.toString());\n            if (message.type === 'ping') {\n              ws.send(JSON.stringify({ type: 'pong', timestamp: Date.now() }));\n            }\n          } catch (error: unknown) {\n            console.error('WebSocket message parsing error:', error);\n          }\n        });\n\n        // Handle connection close\n        ws.on('close', () => {\n          const connections = activeConnections.get(sessionId);\n          if (connections) {\n            const index = connections.indexOf(connection);\n            if (index > -1) {\n              connections.splice(index, 1);\n            }\n            if (connections.length === 0) {\n              activeConnections.delete(sessionId);\n            }\n          }\n        });\n\n        // Handle connection errors\n        ws.on('error', error => {\n          console.error('WebSocket error for session', sessionId, ':', error);\n          cleanupConnections(sessionId);\n        });\n\n        // Send periodic progress updates (every 2 seconds)\n        const progressInterval = setInterval(() => {\n          if (ws.readyState === 1) {\n            // WebSocket.OPEN\n            ws.send(\n              JSON.stringify({\n                type: 'heartbeat',\n                sessionId,\n                timestamp: Date.now(),\n              })\n            );\n          } else {\n            clearInterval(progressInterval);\n          }\n        }, 2000);\n\n        ws.on('close', () => {\n          clearInterval(progressInterval);\n        });\n      }\n    );\n  }\n\n  // ---------------------------------------------------------------------------\n  // Analytics: Track UI Events (Images MVP)\n  // ---------------------------------------------------------------------------\n  app.post(\n    '/api/images_mvp/analytics/track',\n    async (req: Request, res: Response) => {\n      try {\n        const event = typeof req.body?.event === 'string' ? req.body.event : '';\n        let properties =\n          req.body?.properties && typeof req.body.properties === 'object'\n            ? req.body.properties\n            : {};\n        const sessionId =\n          typeof req.body?.sessionId === 'string' ? req.body.sessionId : null;\n\n        // Validate event name\n        if (!event) {\n          return sendInvalidRequestError(res, 'Event name is required');\n        }\n\n        // Limit properties size to 10KB\n        const propertiesString = JSON.stringify(properties);\n        if (propertiesString.length > 10 * 1024) {\n          // Truncate properties if too large\n          properties = {\n            _truncated: true,\n            _originalSize: propertiesString.length,\n          };\n        }\n\n        // Sanitize event name\n        const sanitizedEvent = event\n          .replace(/[^a-zA-Z0-9_-]/g, '')\n          .substring(0, 100);\n\n        try {\n          await storage.logUiEvent({\n            product: 'images_mvp',\n            eventName: event,\n            sessionId,\n            userId: null,\n            properties,\n            ipAddress: req.ip || req.socket.remoteAddress || null,\n            userAgent: req.headers['user-agent'] || null,\n          });\n        } catch (error: unknown) {\n          // Analytics is non-critical; fail open for unsigned users\n          console.warn(\n            '[ImagesMVP] Analytics log failed (non-blocking):',\n            error instanceof Error ? error.message : String(error)\n          );\n        }\n\n        return res.status(204).send();\n      } catch (error: unknown) {\n        console.error('Images MVP analytics error:', error);\n        return res.status(500).json({ error: 'Failed to log analytics event' });\n      }\n    }\n  );\n\n  // ---------------------------------------------------------------------------\n  // Analytics: Report (Images MVP)\n  // ---------------------------------------------------------------------------\n  app.get(\n    '/api/images_mvp/analytics/report',\n    async (req: Request, res: Response) => {\n      try {\n        const periodQuery =\n          typeof req.query.period === 'string' ? req.query.period : undefined;\n        const limitQuery =\n          typeof req.query.limit === 'string' ? req.query.limit : undefined;\n        const period = parseAnalyticsPeriod(periodQuery);\n        const limit = parseLimitParam(limitQuery);\n\n        const events = await storage.getUiEvents({\n          product: 'images_mvp',\n          since: period.since ?? undefined,\n          limit,\n        });\n\n        const eventCounts: Record<string, number> = {};\n        const purposeCounts: Record<string, number> = {};\n        const tabCounts: Record<string, number> = {};\n        const densityCounts: Record<string, number> = {};\n        const formatHintCounts: Record<string, number> = {};\n        const resultsMimeCounts: Record<string, number> = {};\n\n        let landingViewed = 0;\n        let uploadSelected = 0;\n        let uploadRejected = 0;\n        let analysisStarted = 0;\n        let analysisCompleted = 0;\n        let analysisSuccess = 0;\n        let analysisFailed = 0;\n        let analysisProcessingMsTotal = 0;\n        let analysisProcessingCount = 0;\n        let paywallViewed = 0;\n        let purchaseCompleted = 0;\n\n        let paywallPreviewed = 0;\n        let paywallClicked = 0;\n        let summaryCopied = 0;\n        let summaryDownloaded = 0;\n        let jsonDownloaded = 0;\n        let fullTxtDownloaded = 0;\n        let purposePromptShown = 0;\n        let purposePromptOpened = 0;\n        let purposeSkipped = 0;\n\n        const sessionIds = new Set<string>();\n        const userIds = new Set<string>();\n        let firstEventAt: Date | null = null;\n        let lastEventAt: Date | null = null;\n\n        const increment = (bucket: Record<string, number>, key: string) => {\n          bucket[key] = (bucket[key] || 0) + 1;\n        };\n\n        for (const event of events) {\n          increment(eventCounts, event.eventName);\n\n          if (event.sessionId) {\n            sessionIds.add(event.sessionId);\n          }\n          if (event.userId) {\n            userIds.add(event.userId);\n          }\n          if (!firstEventAt || event.createdAt < firstEventAt) {\n            firstEventAt = event.createdAt;\n          }\n          if (!lastEventAt || event.createdAt > lastEventAt) {\n            lastEventAt = event.createdAt;\n          }\n\n          const properties = isPlainObject(event.properties)\n            ? event.properties\n            : {};\n\n          switch (event.eventName) {\n            case 'images_landing_viewed':\n              landingViewed += 1;\n              break;\n            case 'upload_selected':\n              uploadSelected += 1;\n              break;\n            case 'upload_rejected':\n              uploadRejected += 1;\n              break;\n            case 'analysis_started':\n              analysisStarted += 1;\n              break;\n            case 'analysis_completed': {\n              analysisCompleted += 1;\n              const success =\n                typeof properties.success === 'boolean'\n                  ? properties.success\n                  : null;\n              if (success === true) {\n                analysisSuccess += 1;\n              } else if (success === false) {\n                analysisFailed += 1;\n              }\n              const processingMs =\n                typeof properties.processing_ms === 'number'\n                  ? properties.processing_ms\n                  : null;\n              if (processingMs !== null) {\n                analysisProcessingMsTotal += processingMs;\n                analysisProcessingCount += 1;\n              }\n              break;\n            }\n            case 'purpose_selected': {\n              const purpose =\n                typeof properties.purpose === 'string'\n                  ? properties.purpose\n                  : 'unknown';\n              increment(purposeCounts, purpose);\n              break;\n            }\n            case 'purpose_prompt_shown':\n              purposePromptShown += 1;\n              break;\n            case 'purpose_prompt_opened':\n              purposePromptOpened += 1;\n              break;\n            case 'purpose_skipped':\n              purposeSkipped += 1;\n              break;\n            case 'tab_changed': {\n              const tab =\n                typeof properties.tab === 'string' ? properties.tab : 'unknown';\n              increment(tabCounts, tab);\n              break;\n            }\n            case 'density_changed': {\n              const mode =\n                typeof properties.mode === 'string'\n                  ? properties.mode\n                  : 'unknown';\n              increment(densityCounts, mode);\n              break;\n            }\n            case 'format_hint_shown': {\n              const mimeType =\n                typeof properties.mime_type === 'string'\n                  ? properties.mime_type\n                  : 'unknown';\n              increment(formatHintCounts, mimeType);\n              break;\n            }\n            case 'results_viewed': {\n              const mimeType =\n                typeof properties.mime_type === 'string'\n                  ? properties.mime_type\n                  : 'unknown';\n              increment(resultsMimeCounts, mimeType);\n              break;\n            }\n            case 'paywall_viewed':\n              paywallViewed += 1;\n              break;\n            case 'paywall_preview_shown':\n              paywallPreviewed += 1;\n              break;\n            case 'paywall_cta_clicked':\n              paywallClicked += 1;\n              break;\n            case 'purchase_completed':\n              purchaseCompleted += 1;\n              break;\n            case 'summary_copied':\n              summaryCopied += 1;\n              break;\n            case 'export_summary_downloaded':\n              summaryDownloaded += 1;\n              break;\n            case 'export_json_downloaded':\n              jsonDownloaded += 1;\n              break;\n            case 'export_full_txt_downloaded':\n              fullTxtDownloaded += 1;\n              break;\n            default:\n              break;\n          }\n        }\n\n        res.json({\n          period: {\n            range: period.range,\n            since: period.since ? period.since.toISOString() : null,\n            until: new Date().toISOString(),\n            limit,\n          },\n          totals: {\n            events: events.length,\n            sessions: sessionIds.size,\n            users: userIds.size,\n            firstEventAt: firstEventAt ? firstEventAt.toISOString() : null,\n            lastEventAt: lastEventAt ? lastEventAt.toISOString() : null,\n          },\n          funnel: {\n            landing_viewed: landingViewed,\n            upload_selected: uploadSelected,\n            upload_rejected: uploadRejected,\n            analysis_started: analysisStarted,\n            analysis_completed: analysisCompleted,\n            analysis_success: analysisSuccess,\n            analysis_failed: analysisFailed,\n            results_viewed: eventCounts.results_viewed || 0,\n            paywall_viewed: paywallViewed,\n            paywall_previewed: paywallPreviewed,\n            paywall_clicked: paywallClicked,\n            purchase_completed: purchaseCompleted,\n            export_summary_downloaded: summaryDownloaded,\n            export_json_downloaded: jsonDownloaded,\n            export_full_txt_downloaded: fullTxtDownloaded,\n          },\n          events: eventCounts,\n          purposes: {\n            selected: purposeCounts,\n            prompt_shown: purposePromptShown,\n            prompt_opened: purposePromptOpened,\n            skipped: purposeSkipped,\n          },\n          tabs: tabCounts,\n          density: densityCounts,\n          formats: {\n            hints: formatHintCounts,\n            results: resultsMimeCounts,\n          },\n          exports: {\n            json: jsonDownloaded,\n            summary: summaryDownloaded,\n            full_txt: fullTxtDownloaded,\n            summary_copied: summaryCopied,\n          },\n          analysis: {\n            completed: analysisCompleted,\n            success: analysisSuccess,\n            failed: analysisFailed,\n            average_processing_ms:\n              analysisProcessingCount > 0\n                ? Math.round(\n                    analysisProcessingMsTotal / analysisProcessingCount\n                  )\n                : null,\n          },\n          paywall: {\n            previewed: paywallPreviewed,\n            cta_clicked: paywallClicked,\n          },\n        });\n      } catch (error: unknown) {\n        console.error('Images MVP analytics report error:', error);\n        return res\n          .status(500)\n          .json({ error: 'Failed to build analytics report' });\n      }\n    }\n  );\n\n  // ---------------------------------------------------------------------------\n  // Quote: Preflight credits + limits\n  // ---------------------------------------------------------------------------\n  app.post('/api/images_mvp/quote', async (req: Request, res: Response) => {\n    try {\n      const rawFiles = Array.isArray(req.body?.files) ? req.body.files : [];\n      const ops: ImagesMvpQuoteOps = {\n        embedding:\n          typeof req.body?.ops?.embedding === 'boolean'\n            ? req.body.ops.embedding\n            : true,\n        ocr: typeof req.body?.ops?.ocr === 'boolean' ? req.body.ops.ocr : false,\n        forensics:\n          typeof req.body?.ops?.forensics === 'boolean'\n            ? req.body.ops.forensics\n            : false,\n      };\n\n      if (rawFiles.length === 0) {\n        return res.status(400).json({ error: 'No files provided' });\n      }\n      if (rawFiles.length > IMAGES_MVP_MAX_FILES) {\n        return res.status(400).json({\n          error: 'Too many files',\n          maxFiles: IMAGES_MVP_MAX_FILES,\n        });\n      }\n\n      const files: ImagesMvpQuoteFile[] = rawFiles\n        .map((file: any) => ({\n          id: typeof file?.id === 'string' ? file.id : '',\n          name: typeof file?.name === 'string' ? file.name : '',\n          mime: typeof file?.mime === 'string' ? file.mime : null,\n          sizeBytes:\n            typeof file?.sizeBytes === 'number'\n              ? file.sizeBytes\n              : Number(file?.sizeBytes ?? 0),\n          width:\n            typeof file?.width === 'number'\n              ? file.width\n              : file?.width\n                ? Number(file.width)\n                : null,\n          height:\n            typeof file?.height === 'number'\n              ? file.height\n              : file?.height\n                ? Number(file.height)\n                : null,\n        }))\n        .filter((file: any) => file.id && file.name);\n\n      if (files.length === 0) {\n        return res.status(400).json({ error: 'Invalid file metadata' });\n      }\n\n      const perFile: Record<string, ImagesMvpQuoteEntry> = {};\n      let totalCredits = 0;\n      const warnings: string[] = [];\n\n      for (const file of files) {\n        const ext = getExtensionFromName(file.name);\n        const mimeType = file.mime?.toLowerCase() ?? '';\n        const hasValidMime = mimeType\n          ? SUPPORTED_IMAGE_MIMES.has(mimeType)\n          : false;\n        const hasValidExt = ext ? SUPPORTED_IMAGE_EXTENSIONS.has(ext) : false;\n\n        if (!hasValidMime && !hasValidExt) {\n          perFile[file.id] = {\n            accepted: false,\n            reason: 'unsupported_type',\n            detected_type: mimeType || null,\n            name: file.name,\n            sizeBytes: file.sizeBytes,\n          };\n          continue;\n        }\n\n        if (!Number.isFinite(file.sizeBytes) || file.sizeBytes <= 0) {\n          perFile[file.id] = {\n            accepted: false,\n            reason: 'invalid_size',\n            detected_type: mimeType || null,\n            name: file.name,\n            sizeBytes: file.sizeBytes,\n          };\n          continue;\n        }\n\n        if (file.sizeBytes > IMAGES_MVP_MAX_BYTES) {\n          perFile[file.id] = {\n            accepted: false,\n            reason: 'file_too_large',\n            detected_type: mimeType || null,\n            name: file.name,\n            sizeBytes: file.sizeBytes,\n          };\n          continue;\n        }\n\n        const mp = computeMp(file.width, file.height);\n        const bucket = resolveMpBucket(mp);\n        if (bucket.invalid) {\n          perFile[file.id] = {\n            accepted: false,\n            reason: 'megapixels_exceed_limit',\n            detected_type: mimeType || null,\n            name: file.name,\n            sizeBytes: file.sizeBytes,\n            mp,\n            mpBucket: bucket.label,\n          };\n          continue;\n        }\n\n        const fileWarnings: string[] = [];\n        if (bucket.warning) {\n          fileWarnings.push(bucket.warning);\n          warnings.push(bucket.warning);\n        }\n\n        const breakdown = {\n          base: IMAGES_MVP_CREDIT_SCHEDULE.base,\n          embedding: ops.embedding ? IMAGES_MVP_CREDIT_SCHEDULE.embedding : 0,\n          ocr: ops.ocr ? IMAGES_MVP_CREDIT_SCHEDULE.ocr : 0,\n          forensics: ops.forensics ? IMAGES_MVP_CREDIT_SCHEDULE.forensics : 0,\n          mp: bucket.credits,\n        };\n\n        const creditsTotal =\n          breakdown.base +\n          breakdown.embedding +\n          breakdown.ocr +\n          breakdown.forensics +\n          breakdown.mp;\n\n        totalCredits += creditsTotal;\n\n        perFile[file.id] = {\n          accepted: true,\n          detected_type: mimeType || null,\n          creditsTotal,\n          breakdown,\n          mp,\n          mpBucket: bucket.label,\n          warnings: fileWarnings,\n          name: file.name,\n          sizeBytes: file.sizeBytes,\n        };\n      }\n\n      const signaturePayload = {\n        files: files.map(file => ({\n          id: file.id,\n          name: file.name,\n          mime: file.mime ?? null,\n          sizeBytes: file.sizeBytes,\n          width: file.width ?? null,\n          height: file.height ?? null,\n        })),\n        ops,\n        scheduleVersion: IMAGES_MVP_QUOTE_VERSION,\n      };\n\n      const signature = buildQuoteSignature(signaturePayload);\n      const quoteId = `q_${crypto.randomUUID()}`;\n      const expiresAt = Date.now() + IMAGES_MVP_QUOTE_TTL_MS;\n\n      imagesMvpQuoteStore.set(quoteId, {\n        expiresAt,\n        signature,\n        files,\n        ops,\n        perFile,\n      });\n\n      res.json({\n        limits: {\n          maxBytes: IMAGES_MVP_MAX_BYTES,\n          allowedMimes: Array.from(SUPPORTED_IMAGE_MIMES),\n          maxFiles: IMAGES_MVP_MAX_FILES,\n        },\n        creditSchedule: IMAGES_MVP_CREDIT_SCHEDULE,\n        quote: {\n          perFile: files.map(file => ({\n            id: file.id,\n            ...perFile[file.id],\n          })),\n          totalCredits,\n          standardEquivalents:\n            IMAGES_MVP_CREDIT_SCHEDULE.standardCreditsPerImage > 0\n              ? Number(\n                  (\n                    totalCredits /\n                    IMAGES_MVP_CREDIT_SCHEDULE.standardCreditsPerImage\n                  ).toFixed(2)\n                )\n              : null,\n        },\n        quoteId,\n        expiresAt: new Date(expiresAt).toISOString(),\n        warnings,\n      });\n    } catch (error: unknown) {\n      console.error('Images MVP quote error:', error);\n      res.status(500).json({ error: 'Failed to generate quote' });\n    }\n  });\n\n  // ---------------------------------------------------------------------------\n  // Credits: Get Packs\n  // ---------------------------------------------------------------------------\n  app.get('/api/images_mvp/credits/packs', (req: Request, res: Response) => {\n    res.json({\n      packs: IMAGES_MVP_CREDIT_PACKS,\n      description: 'Credits for using the Images Metadata tool.',\n    });\n  });\n\n  // ---------------------------------------------------------------------------\n  // Credits: Get Balance\n  // ---------------------------------------------------------------------------\n  app.get(\n    '/api/images_mvp/credits/balance',\n    async (req: Request, res: Response) => {\n      try {\n        const authReq = req as AuthRequest;\n\n        const balanceKey = authReq.user?.id\n          ? getImagesMvpBalanceKeyForUser(authReq.user.id)\n          : getImagesMvpBalanceKeyForSession(getOrSetSessionId(req, res));\n\n        const balance = await storage.getOrCreateCreditBalance(\n          balanceKey,\n          authReq.user?.id\n        );\n\n        res.json({\n          credits: balance.credits,\n          balanceId: balance.id,\n        });\n      } catch (error: unknown) {\n        console.error('Get images_mvp credits error:', error);\n        res.status(500).json({ error: 'Failed to get credit balance' });\n      }\n    }\n  );\n\n  // ---------------------------------------------------------------------------\n  // Credits: Transactions\n  // ---------------------------------------------------------------------------\n  app.get(\n    '/api/images_mvp/credits/transactions',\n    async (req: Request, res: Response) => {\n      try {\n        const balanceId =\n          typeof req.query.balanceId === 'string' ? req.query.balanceId : null;\n        if (!balanceId) return res.json({ transactions: [] });\n        const transactions = await storage.getCreditTransactions(balanceId);\n        return res.json({ transactions });\n      } catch (error: unknown) {\n        console.error('Get images_mvp credit transactions error:', error);\n        return res\n          .status(500)\n          .json({ error: 'Failed to get credit transactions' });\n      }\n    }\n  );\n\n  // ---------------------------------------------------------------------------\n  // Credits: Claim (convert session credits -> account credits)\n  // ---------------------------------------------------------------------------\n  app.post(\n    '/api/images_mvp/credits/claim',\n    requireAuth,\n    async (req: Request, res: Response) => {\n      try {\n        const authReq = req as AuthRequest;\n        if (!authReq.user?.id) {\n          return res.status(401).json({ error: 'Authentication required' });\n        }\n\n        const rawSessionId = getOrSetSessionId(req, res);\n\n        const fromKey = getImagesMvpBalanceKeyForSession(rawSessionId);\n        const toKey = getImagesMvpBalanceKeyForUser(authReq.user.id);\n\n        const fromBalance = await storage.getCreditBalanceBySessionId(fromKey);\n        if (!fromBalance || (fromBalance.credits ?? 0) <= 0) {\n          return res.json({ transferred: 0 });\n        }\n\n        const toBalance = await storage.getOrCreateCreditBalance(\n          toKey,\n          authReq.user.id\n        );\n\n        const amount = fromBalance.credits;\n        await storage.transferCredits(\n          fromBalance.id,\n          toBalance.id,\n          amount,\n          'Claimed Images MVP credits to account'\n        );\n\n        return res.json({ transferred: amount });\n      } catch (error: unknown) {\n        console.error('Images MVP claim credits error:', error);\n        return res.status(500).json({ error: 'Failed to claim credits' });\n      }\n    }\n  );\n\n  // ---------------------------------------------------------------------------\n  // Credits: Dev grant (testing helper)\n  // ---------------------------------------------------------------------------\n  app.post(\n    '/api/dev/images_mvp/credits/grant',\n    async (req: Request, res: Response) => {\n      try {\n        if (process.env.NODE_ENV === 'production') {\n          return res.status(404).json({ error: 'Not found' });\n        }\n\n        const authReq = req as AuthRequest;\n        const amount =\n          typeof req.body?.credits === 'number'\n            ? req.body.credits\n            : typeof req.body?.credits === 'string'\n              ? Number(req.body.credits)\n              : 100;\n        if (!Number.isFinite(amount) || amount <= 0) {\n          return res\n            .status(400)\n            .json({ error: 'credits must be a positive number' });\n        }\n\n        const balanceKey = authReq.user?.id\n          ? getImagesMvpBalanceKeyForUser(authReq.user.id)\n          : getImagesMvpBalanceKeyForSession(getOrSetSessionId(req, res));\n\n        const balance = await storage.getOrCreateCreditBalance(\n          balanceKey,\n          authReq.user?.id\n        );\n\n        await storage.addCredits(\n          balance.id,\n          amount,\n          `Dev grant (${amount} credits)`\n        );\n\n        const updated = await storage.getCreditBalance(balance.id);\n        return res.json({\n          ok: true,\n          balanceId: balance.id,\n          credits: updated?.credits ?? balance.credits,\n        });\n      } catch (error: unknown) {\n        console.error('Images MVP dev grant credits error:', error);\n        return res.status(500).json({ error: 'Failed to grant credits' });\n      }\n    }\n  );\n\n  // ---------------------------------------------------------------------------\n  // Credits: Purchase\n  // ---------------------------------------------------------------------------\n  app.post(\n    '/api/images_mvp/credits/purchase',\n    requireAuth,\n    async (req: Request, res: Response) => {\n      try {\n        const dodoClient = getDodoClient();\n        if (!dodoClient) {\n          return res.status(503).json({\n            error: 'Payment system not configured',\n            message: 'Please add DODO_PAYMENTS_API_KEY to enable payments',\n          });\n        }\n\n        const authReq = req as AuthRequest;\n        const { pack, email } = req.body;\n\n        if (!pack || !['starter', 'pro'].includes(pack)) {\n          return res.status(400).json({ error: 'Invalid credit pack' });\n        }\n\n        if (!authReq.user?.id) {\n          return res.status(401).json({\n            error: 'Authentication required',\n            message:\n              'Please sign in to purchase credits so they are available across devices.',\n          });\n        }\n\n        const balanceKey = getImagesMvpBalanceKeyForUser(authReq.user.id);\n\n        const balance = await storage.getOrCreateCreditBalance(\n          balanceKey,\n          authReq.user?.id\n        );\n        const packInfo =\n          IMAGES_MVP_CREDIT_PACKS[pack as keyof typeof IMAGES_MVP_CREDIT_PACKS];\n\n        const baseUrl = getBaseUrl();\n\n        // Ensure product is valid\n        if (!packInfo || !packInfo.productId) {\n          return res\n            .status(500)\n            .json({ error: 'Product configuration missing' });\n        }\n\n        const session = await dodoClient.checkoutSessions.create({\n          product_cart: [\n            {\n              product_id: packInfo.productId,\n              quantity: 1,\n            },\n          ],\n          allowed_payment_method_types: [\n            'credit',\n            'debit',\n            'apple_pay',\n            'google_pay',\n          ],\n          billing_currency: 'USD',\n          customer: email ? { email } : undefined,\n          // Redirect to specialized success page\n          return_url: `${baseUrl}/images_mvp/credits/success?pack=${pack}&balanceId=${balance.id}`,\n          metadata: {\n            type: 'credit_purchase',\n            product: 'images_mvp', // Marker for webhook logic\n            pack,\n            credits: packInfo.credits.toString(),\n            balance_id: balance.id,\n            balance_key: balanceKey,\n            user_id: authReq.user?.id || null,\n            purchaser_email: email || null,\n          },\n        });\n\n        console.log(\n          `Created images_mvp purchase session for ${pack}:`,\n          session.session_id\n        );\n\n        res.json({\n          checkout_url: session.checkout_url,\n          session_id: session.session_id,\n        });\n      } catch (error: unknown) {\n        console.error('Images MVP purchase error:', error);\n        res.status(500).json({\n          error: 'Failed to create checkout session',\n          details: error instanceof Error ? error.message : 'Unknown error',\n        });\n      }\n    }\n  );\n\n  // ---------------------------------------------------------------------------\n  // Extraction Endpoint\n  // ---------------------------------------------------------------------------\n  // Allow unauthenticated free extractions  quota enforcement handles anonymous limits\n  app.post(\n    '/api/images_mvp/extract',\n    freeQuotaMiddleware,\n    rateLimitExtraction(), // Rate limit: per-IP/user throttling\n    upload.single('file'),\n    // Multer error handling middleware\n    async (err: any, req: Request, res: Response, next: Function) => {\n      if (err) {\n        // Handle multer-specific errors\n        if (err.code === 'UNSUPPORTED_FILE_TYPE') {\n          // Log security event for file type rejection\n          await securityEventLogger.logUploadRejection(req, err.message, {\n            filename: req.file?.originalname || 'unknown',\n            mimetype: req.file?.mimetype || 'unknown',\n            size: req.file?.size || 0,\n            extension:\n              path.extname(req.file?.originalname || '').toLowerCase() ||\n              'unknown',\n          });\n\n          return res.status(403).json({\n            error: 'Unsupported file type',\n            message: err.message,\n            code: 'UNSUPPORTED_FILE_TYPE',\n          });\n        }\n\n        if (err.code === 'LIMIT_FILE_SIZE') {\n          return res.status(413).json({\n            error: 'File too large',\n            message: `File size exceeds the maximum allowed size of ${IMAGES_MVP_MAX_BYTES / (1024 * 1024)}MB`,\n            code: 'FILE_TOO_LARGE',\n          });\n        }\n\n        if (err.code === 'LIMIT_UNEXPECTED_FILE') {\n          return res.status(400).json({\n            error: 'Invalid file upload',\n            message: 'Only one file can be uploaded at a time',\n            code: 'LIMIT_UNEXPECTED_FILE',\n          });\n        }\n\n        // Generic multer error\n        return res.status(400).json({\n          error: 'File upload failed',\n          message: err.message || 'Unknown upload error',\n          code: err.code || 'UPLOAD_ERROR',\n        });\n      }\n\n      // No error, proceed to main handler\n      next();\n    },\n    async (req: Request, res: Response) => {\n      const startTime = Date.now();\n      // Correlation ID for observability (traces request through pipeline)\n      const requestId = `req_${Date.now()}_${crypto.randomUUID().slice(0, 8)}`;\n      res.setHeader('X-Request-Id', requestId);\n\n      let tempPath: string | null = null;\n      let sessionId: string | null = null;\n      let creditBalanceId: string | null = null;\n      const useTrial = false;\n      let chargeCredits = false;\n\n      // Access mode: device_free | trial_limited | paid\n      let accessMode: 'device_free' | 'trial_limited' | 'paid' = 'paid';\n\n      let creditCost = 1;\n      let runOcr = true;\n      const quoteId =\n        typeof req.body?.quote_id === 'string' ? req.body.quote_id : null;\n      const clientFileId =\n        typeof req.body?.client_file_id === 'string'\n          ? req.body.client_file_id\n          : null;\n\n      try {\n        const authReq = req as AuthRequest;\n        if (!req.file) {\n          return sendInvalidRequestError(res, 'No file uploaded');\n        }\n\n        // Enforce file type (MIME + extension check)\n        const mimeType = req.file.mimetype;\n        const fileExt = path.extname(req.file.originalname).toLowerCase();\n        const isSupportedMime = SUPPORTED_IMAGE_MIMES.has(mimeType);\n        const isSupportedExt = fileExt\n          ? SUPPORTED_IMAGE_EXTENSIONS.has(fileExt)\n          : false;\n        if (!isSupportedMime && !isSupportedExt) {\n          // Return a 403 Forbidden for unsupported files as per security policy\n          return res.status(403).json({\n            error: 'File type not permitted',\n            message:\n              'For security reasons, we only support standard photo formats: JPG, PNG, HEIC, and WebP. Please upload a supported image file.',\n            code: 'FILE_TYPE_FORBIDDEN',\n            supported: ['JPG', 'JPEG', 'PNG', 'HEIC', 'HEIF', 'WebP'],\n          });\n        }\n\n        // Magic-byte validation: verify actual file content matches claimed type\n        const fileBuffer =\n          req.file.buffer || (await fs.readFile(req.file.path));\n        const detectedType = await fileTypeFromBuffer(fileBuffer);\n        if (detectedType && !SUPPORTED_IMAGE_MIMES.has(detectedType.mime)) {\n          // File content doesn't match a supported image type - potential spoofing attempt\n          return res.status(403).json({\n            error: 'Invalid file content',\n            message:\n              'The uploaded file content does not match a supported image type. Please upload a genuine photo file.',\n            code: 'INVALID_MAGIC_BYTES_FORBIDDEN',\n            detected: detectedType.mime,\n          });\n        }\n\n        if (quoteId) {\n          const storedQuote = getStoredQuote(quoteId);\n          if (!storedQuote) {\n            return res.status(400).json({\n              error: 'Quote expired or invalid',\n              code: 'QUOTE_INVALID',\n            });\n          }\n          if (!clientFileId) {\n            return res.status(400).json({\n              error: 'Missing client file id for quote validation',\n              code: 'QUOTE_MISSING_FILE_ID',\n            });\n          }\n          const quotedFile = storedQuote.perFile[clientFileId];\n          if (!quotedFile || !quotedFile.accepted) {\n            return res.status(400).json({\n              error: 'Quote does not match uploaded file',\n              code: 'QUOTE_MISMATCH',\n            });\n          }\n          if (\n            typeof quotedFile.sizeBytes === 'number' &&\n            quotedFile.sizeBytes !== req.file.size\n          ) {\n            return res.status(400).json({\n              error: 'Quote does not match uploaded file size',\n              code: 'QUOTE_SIZE_MISMATCH',\n            });\n          }\n          if (\n            typeof quotedFile.creditsTotal !== 'number' ||\n            !Number.isFinite(quotedFile.creditsTotal)\n          ) {\n            return res.status(400).json({\n              error: 'Quote missing credit total',\n              code: 'QUOTE_MISSING_CREDITS',\n            });\n          }\n          creditCost = quotedFile.creditsTotal;\n          runOcr = (quotedFile.breakdown?.ocr ?? 0) > 0;\n        }\n\n        const trialEmail = normalizeEmail(req.body?.trial_email);\n        // WebSocket progress uses `session_id` (client-provided). Credits use the stable cookie session.\n        sessionId = getSessionId(req); // progress session id\n        const cookieSessionId = authReq.user?.id\n          ? null\n          : getOrSetSessionId(req, res);\n\n        // Check Trial Status\n        let trialUses = 0;\n        if (trialEmail) {\n          if (isDatabaseConnected()) {\n            const dbClient = getDatabase();\n            const result = await dbClient\n              .select({ uses: trialUsages.uses })\n              .from(trialUsages)\n              .where(eq(trialUsages.email, trialEmail))\n              .limit(1);\n            trialUses = result[0]?.uses || 0;\n          } else {\n            const usage = await storage.getTrialUsageByEmail(trialEmail);\n            trialUses = usage?.uses || 0;\n          }\n        }\n\n        const hasTrialAvailable = !!trialEmail && trialUses < 2;\n\n        // Determine Access\n        // Security is enforced in all environments\n        // For testing, use accounts with sufficient credits\n        if (hasTrialAvailable) {\n          // Email trial grants a restricted \"trial_limited\" mode (heavy redaction)\n          accessMode = 'trial_limited';\n        } else {\n          if (trialEmail) {\n            // Trial email provided but trial is exhausted: require credits (do not stack free quota).\n\n            const balanceKey = authReq.user?.id\n              ? getImagesMvpBalanceKeyForUser(authReq.user.id)\n              : getImagesMvpBalanceKeyForSession(cookieSessionId!);\n\n            const balance = await storage.getOrCreateCreditBalance(\n              balanceKey,\n              authReq.user?.id\n            );\n            creditBalanceId = balance?.id ?? null;\n\n            if (!balance || balance.credits < creditCost) {\n              return sendQuotaExceededError(\n                res,\n                `Insufficient credits (required: ${creditCost}, available: ${balance?.credits ?? 0})`\n              );\n            }\n            chargeCredits = true;\n            accessMode = 'paid';\n          } else {\n            // No trial available: allow up to 2 free extractions per device, then require credits.\n            const ip = req.ip || req.socket.remoteAddress || 'unknown';\n\n            // Use SERVER-ISSUED device token (resistant to cookie clearing)\n            // Falls back to old client token for backward compatibility\n            let deviceId: string;\n            try {\n              deviceId = getServerDeviceId(req, res);\n            } catch {\n              // Fallback to legacy client token\n              let clientToken = req.cookies?.metaextract_client;\n              let decoded = verifyClientToken(clientToken ?? '');\n\n              if (!decoded) {\n                clientToken = generateClientToken();\n                res.cookie('metaextract_client', clientToken, {\n                  maxAge: 30 * 24 * 60 * 60 * 1000, // 30 days\n                  path: '/',\n                  httpOnly: true,\n                  sameSite: 'lax',\n                });\n                decoded = verifyClientToken(clientToken);\n              }\n\n              if (!decoded) {\n                return res.status(429).json({\n                  error: 'Invalid session',\n                  message: 'Please refresh the page to continue.',\n                  requires_refresh: true,\n                });\n              }\n              deviceId = decoded.clientId;\n            }\n\n            // Check for suspicious device behavior\n            const isSuspicious = await checkDeviceSuspicious(req, deviceId);\n            if (isSuspicious) {\n              console.warn(\n                `[Security] Suspicious device detected: ${deviceId} from IP ${ip}`\n              );\n\n              // Return challenge response instead of just logging\n              return res.status(429).json({\n                error: 'Rate limit exceeded',\n                message: 'Please try again later',\n                code: 'SUSPICIOUS_DEVICE',\n                retryAfter: 300 // 5 minutes\n              });\n            }\n\n            // Check circuit breaker for free tier load shedding\n            const loadCheck = checkCircuitBreaker(false); // isPaid = false\n            if (loadCheck.delayed && loadCheck.estimatedWaitSeconds > 60) {\n              // Under extreme load, suggest purchasing\n              return res.status(503).json({\n                error: 'High demand',\n                message: loadCheck.message,\n                estimated_wait_seconds: loadCheck.estimatedWaitSeconds,\n                upgrade_available: true,\n              });\n            }\n\n            const usage = await getClientUsage(deviceId);\n            const freeUsed = usage?.freeUsed || 0;\n            const freeLimit = 2;\n\n            if (freeUsed < freeLimit) {\n              await incrementUsage(deviceId, ip);\n              // Device-level free check: show high-value data but redact sensitive identifiers\n              accessMode = 'device_free';\n              chargeCredits = false;\n\n              // reflect usage count in response (n of freeLimit)\n              // freeUsed is prior to increment; record nextFreeUsed for response\n              (req as any)._nextFreeUsed = (freeUsed || 0) + 1;\n\n              // Record success for circuit breaker recovery\n              circuitBreaker.recordSuccess();\n            } else {\n              // Free quota exhausted: require credits.\n              const balanceKey = authReq.user?.id\n                ? getImagesMvpBalanceKeyForUser(authReq.user.id)\n                : getImagesMvpBalanceKeyForSession(cookieSessionId!);\n\n              const balance = await storage.getOrCreateCreditBalance(\n                balanceKey,\n                authReq.user?.id\n              );\n              creditBalanceId = balance?.id ?? null;\n\n              if (!balance || balance.credits < creditCost) {\n                await handleQuotaExceeded(req, res, deviceId, ip);\n                return;\n              }\n              chargeCredits = true;\n              accessMode = 'paid';\n            }\n          }\n        }\n\n        // Proceed with Extraction\n        const tempDir = '/tmp/metaextract';\n        await fs.mkdir(tempDir, { recursive: true });\n        const sanitizedFilename = sanitizeFilename(req.file.originalname);\n        tempPath = path.join(\n          tempDir,\n          `${crypto.randomUUID()}-${sanitizedFilename}`\n        );\n        // If file is already on disk (diskStorage), move it; otherwise write from buffer\n        if (req.file.path) {\n          await fs.copyFile(req.file.path, tempPath);\n        } else {\n          await fs.writeFile(tempPath, req.file.buffer);\n        }\n\n        // Send initial progress update\n        if (sessionId) {\n          broadcastProgress(\n            sessionId,\n            10,\n            'File uploaded successfully',\n            'upload_complete'\n          );\n        }\n\n        // Extract with enhanced features\n        // Use full engine tier for device_free to provide high-value fields; reserve `free` for trial_limited\n        const engineTier = accessMode === 'trial_limited' ? 'free' : 'super';\n\n        // Send progress update before extraction\n        if (sessionId) {\n          broadcastProgress(\n            sessionId,\n            20,\n            'Starting metadata extraction',\n            'extraction_start'\n          );\n        }\n\n        const rawMetadata = await extractMetadataWithPython(\n          tempPath,\n          engineTier,\n          true, // performance\n          true, // advanced (needed for authenticity signals)\n          req.query.store === 'true',\n          {\n            ocr: runOcr,\n            maxDim: 2048,\n          }\n        );\n\n        // Send progress update after extraction\n        if (sessionId) {\n          broadcastProgress(\n            sessionId,\n            90,\n            'Metadata extraction complete',\n            'extraction_complete'\n          );\n        }\n\n        const processingMs = Date.now() - startTime;\n        rawMetadata.extraction_info.processing_ms = processingMs;\n\n        // Add enhanced processing insights\n        rawMetadata.extraction_info = {\n          ...rawMetadata.extraction_info,\n          tier: engineTier,\n          enhanced_extraction: true,\n          total_fields_extracted:\n            rawMetadata.extraction_info?.fields_extracted || 0,\n          streaming_enabled: false, // Will be enabled when we add streaming support\n          fallback_extraction: false,\n        } as any; // Type assertion to allow additional properties\n\n        const metadata = transformMetadataForFrontend(\n          rawMetadata,\n          req.file.originalname,\n          engineTier\n        );\n        delete (metadata as any).tier;\n        if (process.env.NODE_ENV !== 'production') {\n          metadata.debug = {\n            ...(metadata.debug || {}),\n            engine_tier: engineTier,\n          };\n        }\n\n        const clientLastModifiedRaw = req.body?.client_last_modified;\n        const clientLastModifiedMs = clientLastModifiedRaw\n          ? Number(clientLastModifiedRaw)\n          : null;\n        if (clientLastModifiedMs && Number.isFinite(clientLastModifiedMs)) {\n          metadata.client_last_modified_iso = new Date(\n            clientLastModifiedMs\n          ).toISOString();\n        }\n\n        // Send final progress update\n        if (sessionId) {\n          broadcastProgress(sessionId, 100, 'Processing complete', 'complete');\n          broadcastComplete(sessionId, {\n            fields_extracted: rawMetadata.extraction_info.fields_extracted || 0,\n            processing_time_ms: processingMs,\n            file_size: req.file.size,\n          });\n        }\n\n        // Add quality metrics and processing insights for enhanced user experience\n        // Use the extraction_info data structure from the Python backend\n        metadata.quality_metrics = {\n          confidence_score: 0.85, // High confidence for successful extraction\n          extraction_completeness: Math.min(\n            1.0,\n            (rawMetadata.extraction_info.fields_extracted || 0) / 100\n          ), // Completeness based on field count\n          processing_efficiency: 0.88, // Good efficiency for successful extraction\n          format_support_level: 'comprehensive', // We support comprehensive formats\n          recommended_actions: [], // No specific recommendations for successful extraction\n          enhanced_extraction: true,\n          streaming_enabled: false,\n        };\n\n        metadata.processing_insights = {\n          total_fields_extracted:\n            rawMetadata.extraction_info.fields_extracted || 0,\n          processing_time_ms: processingMs,\n          memory_usage_mb: 0, // Memory usage not tracked yet\n          streaming_enabled: false,\n          fallback_extraction: false,\n          progress_updates: [],\n        };\n\n        // Apply access-mode redactions\n        // 'trial_limited' = heavy redaction (email trial)\n        // 'device_free' = hybrid redaction (show high-value data, redact sensitive identifiers)\n        if (accessMode === 'trial_limited') {\n          applyAccessModeRedaction(metadata, 'trial_limited');\n        } else if (accessMode === 'device_free') {\n          // Ensure we don't mark trial-limited and apply hybrid redactions\n          delete (metadata as any)._trial_limited;\n          applyAccessModeRedaction(metadata, 'device_free');\n        }\n\n        metadata.access = {\n          trial_email_present: !!trialEmail,\n          trial_granted: accessMode === 'trial_limited',\n          credits_charged: chargeCredits ? creditCost : 0,\n          credits_required: chargeCredits ? creditCost : 0,\n          mode: accessMode,\n          free_used: (req as any)._nextFreeUsed ?? undefined,\n        };\n\n        // Record Usage\n        const fileExtension = fileExt?.slice(1) || 'unknown';\n\n        // 1. Log extraction analytics (generic) - fire-and-forget is OK for analytics\n        storage\n          .logExtractionUsage({\n            tier: useTrial ? 'free' : 'enterprise',\n            fileExtension,\n            mimeType,\n            fileSizeBytes: req.file.size,\n            isVideo: false,\n            isImage: true,\n            isPdf: false,\n            isAudio: false,\n            fieldsExtracted: metadata.fields_extracted || 0,\n            processingMs,\n            success: true,\n            ipAddress: req.ip || req.socket.remoteAddress || null,\n            userAgent: req.headers['user-agent'] || null,\n          })\n          .catch(console.error);\n\n        // 2.  Charge credits - MUST await before responding (critical for billing)\n        if (chargeCredits && creditBalanceId) {\n          try {\n            await storage.useCredits(\n              creditBalanceId,\n              creditCost,\n              `Extraction: ${fileExtension} (Images MVP)`,\n              mimeType\n            );\n          } catch (error: unknown) {\n            console.error('Failed to charge credits:', error);\n            return res.status(402).json({\n              error: 'Payment failed',\n              message: 'Could not charge credits for this extraction',\n              requiresRefresh: true,\n            });\n          }\n        }\n\n        // 3. Record Trial Usage\n        if (accessMode === 'trial_limited' && trialEmail) {\n          try {\n            await storage.recordTrialUsage({\n              email: trialEmail,\n              ipAddress: req.ip || req.socket.remoteAddress || undefined,\n              userAgent: req.get('user-agent') || undefined,\n              sessionId: sessionId || undefined,\n              // We log to the main trial table. This counts towards the \"2 limit\".\n            });\n          } catch (error: unknown) {\n            console.error('Failed to record trial usage:', error);\n          }\n        }\n\n        res.json(metadata);\n      } catch (error: unknown) {\n        console.error('Images MVP extraction error:', error);\n\n        // Send error notification via WebSocket\n        if (sessionId) {\n          broadcastError(\n            sessionId,\n            error instanceof Error ? error.message : 'Extraction failed'\n          );\n        }\n\n        sendInternalServerError(res, 'Failed to extract metadata');\n      } finally {\n        await cleanupTempFile(tempPath);\n\n        // Clean up WebSocket connections for this session\n        if (sessionId) {\n          setTimeout(() => cleanupConnections(sessionId!), 5000); // Delay cleanup to allow final messages\n        }\n      }\n    }\n  );\n\n  // ---------------------------------------------------------------------------\n  // Job Status Endpoint (Async Processing Support)\n  // ---------------------------------------------------------------------------\n  app.get(\n    '/api/images_mvp/jobs/:jobId/status',\n    async (req: Request, res: Response) => {\n      try {\n        const { jobId } = req.params;\n\n        if (!jobId) {\n          return res.status(400).json({ error: 'Job ID is required' });\n        }\n\n        // For now, check metadata_results as the \"completed\" indicator\n        // Full async queue implementation is in short-term roadmap\n        const metadata = await storage.getMetadata(jobId);\n\n        if (metadata) {\n          return res.json({\n            jobId,\n            status: 'complete',\n            progress: 100,\n            message: 'Extraction complete',\n            result: {\n              id: metadata.id,\n              fileName: metadata.fileName,\n              createdAt: metadata.createdAt,\n            },\n          });\n        }\n\n        // Job not found - could be pending or invalid\n        return res.status(404).json({\n          jobId,\n          status: 'not_found',\n          message:\n            'Job not found. It may still be processing or the ID is invalid.',\n        });\n      } catch (error: unknown) {\n        console.error('Error fetching job status:', error);\n        return res.status(500).json({\n          error: 'Failed to fetch job status',\n          message: error instanceof Error ? error.message : 'Unknown error',\n        });\n      }\n    }\n  );\n\n  // ---------------------------------------------------------------------------\n  // Thumbnail Endpoint with Format Negotiation (CDN Optimization)\n  // ---------------------------------------------------------------------------\n  app.get(\n    '/api/images_mvp/thumbnail/:resultId',\n    async (req: Request, res: Response) => {\n      try {\n        const { resultId } = req.params;\n        const acceptHeader = req.headers.accept || '';\n\n        // Format negotiation based on client capabilities\n        let preferredFormat: 'avif' | 'webp' | 'jpeg' = 'jpeg';\n        if (acceptHeader.includes('image/avif')) {\n          preferredFormat = 'avif';\n        } else if (acceptHeader.includes('image/webp')) {\n          preferredFormat = 'webp';\n        }\n\n        // Get metadata result to find original image\n        const metadata = await storage.getMetadata(resultId);\n        if (!metadata) {\n          return res.status(404).json({ error: 'Result not found' });\n        }\n\n        // For now, return format info - actual thumbnail generation\n        // requires object storage integration (short-term roadmap)\n        return res.json({\n          resultId,\n          preferredFormat,\n          message: 'Thumbnail endpoint ready. CDN integration pending.',\n          thumbnailUrl: `/api/images_mvp/thumbnail/${resultId}/image.${preferredFormat}`,\n          formats: {\n            avif: acceptHeader.includes('image/avif'),\n            webp: acceptHeader.includes('image/webp'),\n            jpeg: true,\n          },\n        });\n      } catch (error: unknown) {\n        console.error('Error generating thumbnail:', error);\n        return res.status(500).json({\n          error: 'Failed to generate thumbnail',\n          message: error instanceof Error ? error.message : 'Unknown error',\n        });\n      }\n    }\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/routes/index.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'registerExtractionRoutes' is defined but never used.","line":14,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Routes Index\n *\n * Central registration for all API routes.\n * Modular organization for better maintainability.\n * \n * SECURITY NOTICE: Legacy extraction route disabled due to memory exhaustion vulnerability\n * See: https://github.com/your-org/metaextract/security/advisories/001\n */\n\nimport type { Express } from 'express';\nimport type { Server } from 'http';\nimport { registerImagesMvpRoutes } from './images-mvp';\nimport { registerExtractionRoutes } from './extraction';\nimport { registerForensicRoutes } from './forensic';\nimport { registerMetadataRoutes } from './metadata';\nimport { registerLLMFindingsRoutes } from './llm-findings';\nimport { registerTierRoutes } from './tiers';\nimport { registerAdminRoutes } from './admin';\nimport { registerPaymentRoutes } from '../payments';\nimport { registerGeocodingRoutes } from './geocoding';\nimport { registerOnboardingRoutes } from './onboarding';\nimport { registerLegalComplianceRoutes } from './legal-compliance';\nimport { registerBatchRoutes } from './batch';\nimport { rateLimitManager } from '../rateLimitRedis';\nimport { rateLimitAPI } from '../rateLimitMiddleware';\n\n/**\n * Register all API routes on the Express app.\n *\n * Route modules:\n * - extraction: File upload and metadata extraction\n * - forensic: Advanced forensic analysis, comparison, timeline\n * - metadata: Search, storage, favorites, similar files\n * - tiers: Tier configurations, field info, samples\n * - admin: Analytics, performance, health checks\n * - payments: Subscription and payment handling\n */\nexport async function registerRoutes(\n  httpServer: Server,\n  app: Express\n): Promise<Server> {\n  // Initialize rate limiter\n  await rateLimitManager.initialize();\n\n  // Apply global API rate limiting to all /api routes\n  app.use('/api', rateLimitAPI());\n\n  // Register route modules\n  registerImagesMvpRoutes(app);\n  // SECURITY: Legacy extraction route disabled for Images MVP launch\n  // registerExtractionRoutes(app); //  CRITICAL: 2GB memory storage vulnerability\n  registerForensicRoutes(app);\n  registerMetadataRoutes(app);\n  registerLLMFindingsRoutes(app);\n  registerTierRoutes(app);\n  registerAdminRoutes(app);\n  registerPaymentRoutes(app);\n  registerGeocodingRoutes(app);\n  registerOnboardingRoutes(app);\n  registerLegalComplianceRoutes(app);\n  registerBatchRoutes(app);\n\n  return httpServer;\n}\n\n// Re-export for backwards compatibility\nexport { registerExtractionRoutes } from './extraction';\nexport { registerForensicRoutes } from './forensic';\nexport { registerMetadataRoutes } from './metadata';\nexport { registerTierRoutes } from './tiers';\nexport { registerAdminRoutes } from './admin';\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/routes/legal-compliance.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":164,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6416,6419],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6416,6419],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":199,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":199,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7562,7565],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7562,7565],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'reason' is assigned a value but never used.","line":249,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":249,"endColumn":34},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":250,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":250,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9250,9253],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9250,9253],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Legal Compliance Routes for MetaExtract\n * \n * Handles legal compliance endpoints including:\n * - Privacy policy\n * - Terms of service\n * - GDPR compliance\n * - Data processing agreements\n */\n\nimport type { Express, Request, Response } from 'express';\nimport { z } from 'zod';\nimport { storage } from '../storage';\nimport { requireAuth } from '../auth';\nimport { rateLimitAPI } from '../rateLimitMiddleware';\n\n// ============================================================================\n// Validation Schemas\n// ============================================================================\n\nconst gdprRequestSchema = z.object({\n  requestType: z.enum(['access', 'rectification', 'erasure', 'portability']),\n  reason: z.string().min(10).max(500),\n  verification: z.object({\n    email: z.string().email(),\n    confirmationCode: z.string().length(6),\n  }),\n});\n\n// ============================================================================\n// Privacy Policy\n// ============================================================================\n\nconst PRIVACY_POLICY_VERSION = '1.0.0';\nconst PRIVACY_POLICY_LAST_UPDATED = '2025-01-04';\n\nconst privacyPolicyContent = `\n<h1>Privacy Policy for MetaExtract</h1>\n\n<p><strong>Last Updated:</strong> ${new Date().toISOString().split('T')[0]}</p>\n\n<h2>Information We Collect</h2>\n<p>We collect the following types of information when you use our service:</p>\n\n<h3>File Data</h3>\n<ul>\n  <li>Metadata from uploaded files (EXIF, IPTC, XMP, etc.)</li>\n  <li>File hashes for integrity verification</li>\n  <li>File type, size, and basic properties</li>\n  <li>Processing results and analysis</li>\n</ul>\n\n<h3>Technical Information</h3>\n<ul>\n  <li>IP address and browser information</li>\n  <li>Device type and operating system</li>\n  <li>Timestamps of file uploads and downloads</li>\n  <li>Usage patterns and feature preferences</li>\n</ul>\n\n<h3>Account Information</h3>\n<ul>\n  <li>Email address and username</li>\n  <li>Subscription tier and payment information</li>\n  <li>Credit usage and transaction history</li>\n  <li>Communication preferences</li>\n</ul>\n\n<h2>How We Use Your Information</h2>\n<ul>\n  <li>Provide and improve the service</li>\n  <li>Process and analyze uploaded files</li>\n  <li>Manage accounts, subscriptions, and billing</li>\n  <li>Protect against fraud and abuse and comply with legal obligations</li>\n</ul>\n\n<h2>Data Retention and Deletion</h2>\n<ul>\n  <li>Uploaded files are deleted after processing.</li>\n  <li>Metadata results may be retained to provide the service and improve reliability.</li>\n  <li>Account information is retained while your account remains active; deletion requests are processed subject to legal obligations.</li>\n</ul>\n\n<h2>Your Rights</h2>\n<p>Depending on your jurisdiction (including GDPR), you may have rights to access, correct, delete, or export your personal data.</p>\n\n<h2>Security Measures</h2>\n<p>We use reasonable technical and organizational safeguards to protect your data, including encryption in transit and access controls.</p>\n\n<h2>Data Sharing and Disclosure</h2>\n<p>We do not sell your personal information. We may share information with service providers (e.g., infrastructure, payment processing) and to comply with legal obligations.</p>\n\n<h2>International Transfers</h2>\n<p>If you are located outside the country where our servers are located, your information may be transferred and processed there with appropriate safeguards.</p>\n\n<h2>Children's Privacy</h2>\n<p>Our service does not address anyone under the age of 13. We do not knowingly collect personal information from children under 13.</p>\n\n<h2>Changes to This Privacy Policy</h2>\n<p>We may update this policy periodically by posting an updated version and changing the Last Updated date.</p>\n\n<h2>Contact Us</h2>\n<p>If you have questions about this privacy policy, contact <a href=\"mailto:privacy@metaextract.com\">privacy@metaextract.com</a>.</p>\n`;\n\n// ============================================================================\n// Terms of Service\n// ============================================================================\n\nconst TERMS_OF_SERVICE_VERSION = '1.0.0';\nconst TERMS_OF_SERVICE_LAST_UPDATED = '2025-01-04';\n\nconst termsOfServiceContent = `\n<h1>Terms of Service for MetaExtract</h1>\n\n<p><strong>Last Updated:</strong> ${new Date().toISOString().split('T')[0]}</p>\n\n<h2>Acceptance of Terms</h2>\n<p>By accessing and using MetaExtract, you accept and agree to be bound by these Terms.</p>\n\n<h2>Description of Service</h2>\n<p>MetaExtract provides metadata extraction services for uploaded files. Results depend on what metadata is embedded in the file; some files may have metadata removed or missing.</p>\n\n<h2>Credits and Usage</h2>\n<p>Some features require credits. Credits are consumed per analysis and are non-transferable.</p>\n\n<h2>Refund Policy (Credit Packs)</h2>\n<p><strong>Refunds are available within 7 days of purchase for unused credit packs only.</strong> If any credits are used, the purchase is non-refundable.</p>\n\n<h2>User Responsibilities</h2>\n<h3>Acceptable Use</h3>\n<ul>\n  <li>Use the service in compliance with applicable laws</li>\n  <li>Respect intellectual property rights</li>\n  <li>Do not upload illegal content</li>\n  <li>Do not attempt to circumvent security measures</li>\n</ul>\n\n<h3>Prohibited Activities</h3>\n<ul>\n  <li>Uploading copyrighted material without permission</li>\n  <li>Using the service for illegal activities</li>\n  <li>Attempting to disrupt service operations</li>\n  <li>Scraping or reverse engineering the service</li>\n</ul>\n\n<h2>Intellectual Property</h2>\n<p>The service and its original content, features, and functionality are owned by MetaExtract and are protected by applicable intellectual property laws.</p>\n\n<h2>Limitation of Liability</h2>\n<p>To the maximum extent permitted by law, MetaExtract will not be liable for indirect, incidental, special, consequential, or punitive damages.</p>\n\n<h2>Termination</h2>\n<p>We may terminate or suspend access to the service if you breach these Terms.</p>\n\n<h2>Contact Information</h2>\n<p>For questions about these Terms, contact <a href=\"mailto:legal@metaextract.com\">legal@metaextract.com</a>.</p>\n`;\n\n// ============================================================================\n// GDPR Compliance\n// ============================================================================\n\nasync function handleGDPRAccessRequest(userId: string): Promise<any> {\n  // Retrieve all personal data associated with the user\n  const userData = await storage.getUserById?.(userId);\n  const coreBalanceKey = `credits:core:user:${userId}`;\n  const imagesBalanceKey = `images_mvp:user:${userId}`;\n  const coreCredits = await storage.getCreditBalanceBySessionId?.(coreBalanceKey);\n  const imagesCredits = await storage.getCreditBalanceBySessionId?.(\n    imagesBalanceKey\n  );\n  const extractionHistory =\n    (await storage.getExtractionHistoryByUser?.(userId, 100)) ?? [];\n\n  return {\n    userData: userData\n      ? {\n          id: userData.id,\n          email: userData.email,\n          username: userData.username,\n          createdAt: userData.createdAt,\n        }\n      : null,\n    creditData: {\n      core: coreCredits ?? null,\n      images_mvp: imagesCredits ?? null,\n    },\n    extractionHistory,\n    timestamp: new Date().toISOString(),\n  };\n}\n\nasync function handleGDPRErasureRequest(userId: string): Promise<void> {\n  // Anonymize or delete user data according to retention policies\n  await storage.anonymizeUserData?.(userId);\n}\n\nasync function handleGDPRRectificationRequest(userId: string, updates: any): Promise<void> {\n  // Update user data as requested\n  await storage.updateUserProfile?.(userId, updates);\n}\n\n// ============================================================================\n// Registration Function\n// ============================================================================\n\nexport function registerLegalComplianceRoutes(app: Express): void {\n  // Rate limit for legal endpoints\n  const legalRateLimiter = rateLimitAPI({\n    ipBased: true,\n    tierBased: false,\n    endpoints: {\n      // Rough equivalent to 100 requests per 15 minutes.\n      requestsPerMinute: 20,\n      requestsPerDay: 1000,\n    },\n  });\n\n  // Privacy Policy\n  app.get('/api/legal/privacy', legalRateLimiter, (_req: Request, res: Response) => {\n    res.json({\n      version: PRIVACY_POLICY_VERSION,\n      lastUpdated: PRIVACY_POLICY_LAST_UPDATED,\n      content: privacyPolicyContent,\n    });\n  });\n\n  // Terms of Service\n  app.get('/api/legal/terms', legalRateLimiter, (_req: Request, res: Response) => {\n    res.json({\n      version: TERMS_OF_SERVICE_VERSION,\n      lastUpdated: TERMS_OF_SERVICE_LAST_UPDATED,\n      content: termsOfServiceContent,\n    });\n  });\n\n  // GDPR Compliance Requests (authenticated users only)\n  app.post('/api/legal/gdpr', requireAuth, legalRateLimiter, async (req: Request, res: Response) => {\n    try {\n      const validationResult = gdprRequestSchema.safeParse(req.body);\n      if (!validationResult.success) {\n        return res.status(400).json({\n          error: 'Validation failed',\n          details: validationResult.error.flatten().fieldErrors,\n        });\n      }\n\n      const { requestType, reason } = validationResult.data;\n      const userId = (req as any).user.id;\n\n      let result;\n      switch (requestType) {\n        case 'access':\n          result = await handleGDPRAccessRequest(userId);\n          break;\n        case 'rectification':\n          // For rectification, we need the updates in the request\n          if (!req.body.updates) {\n            return res.status(400).json({ error: 'Updates required for rectification request' });\n          }\n          await handleGDPRRectificationRequest(userId, req.body.updates);\n          result = { success: true, message: 'Data rectification completed' };\n          break;\n        case 'erasure':\n          await handleGDPRErasureRequest(userId);\n          result = { success: true, message: 'Data erasure completed' };\n          break;\n        case 'portability':\n          result = await handleGDPRAccessRequest(userId);\n          break;\n        default:\n          return res.status(400).json({ error: 'Invalid request type' });\n      }\n\n      res.json({\n        success: true,\n        requestType,\n        result,\n      });\n    } catch (error) {\n      console.error('GDPR request error:', error);\n      res.status(500).json({ error: 'GDPR request failed' });\n    }\n  });\n\n  // Data Processing Agreement (DPA)\n  app.get('/api/legal/dpa', legalRateLimiter, (_req: Request, res: Response) => {\n    const dpaContent = `\n# Data Processing Agreement (DPA)\n\n**Effective Date:** ${new Date().toISOString().split('T')[0]}\n\nThis Data Processing Agreement (\"DPA\") supplements the Terms of Service between MetaExtract (\"Processor\") and the Customer (\"Controller\").\n\n## Purpose\nThis DPA governs the processing of personal data by Processor on behalf of Controller in connection with the provision of the MetaExtract service.\n\n## Scope of Processing\n- **Personal Data:** Metadata extracted from customer files that may contain personal identifiers\n- **Processing Activities:** Extraction, analysis, and reporting of metadata\n- **Categories of Data Subjects:** End users whose files contain personal metadata\n- **Types of Personal Data:** Location data, device identifiers, timestamps, and other personal identifiers contained in file metadata\n\n## Instructions for Processing\nProcessor shall process personal data only on documented instructions from Controller, as set forth in the main service agreement and this DPA, unless required to do otherwise by EU or Member State law.\n\n## Obligations of Processor\nProcessor agrees to:\n- Implement appropriate technical and organizational measures to ensure security\n- Assist with data subject requests for access, rectification, erasure, and portability\n- Notify Controller of any personal data breaches within 24 hours\n- Delete or return personal data at the end of the service\n\n## Sub-processors\nProcessor may engage sub-processors for the provision of services, provided that it maintains responsibility for compliance with this DPA.\n\n## Data Security\nProcessor implements appropriate technical and organizational measures including:\n- Encryption in transit and at rest\n- Access controls and authentication\n- Regular security assessments\n- Staff training on data protection\n\n## International Transfers\nIf personal data is transferred internationally, Processor ensures appropriate safeguards are in place.\n\n## Audit Rights\nController has the right to audit Processor's compliance with this DPA annually.\n\n## Term and Termination\nThis DPA remains in effect as long as personal data is processed on behalf of Controller.\n    `;\n\n    res.json({\n      version: '1.0.0',\n      lastUpdated: new Date().toISOString().split('T')[0],\n      content: dpaContent,\n    });\n  });\n\n  // Cookie Policy\n  app.get('/api/legal/cookies', legalRateLimiter, (_req: Request, res: Response) => {\n    const cookiePolicyContent = `\n# Cookie Policy for MetaExtract\n\n**Last Updated:** ${new Date().toISOString().split('T')[0]}\n\n## What Are Cookies?\n\nCookies are small text files placed on your device when you visit our website. They help us provide our services and improve your experience.\n\n## Types of Cookies We Use\n\n### Essential Cookies\n- Authenticate users\n- Enable core functionality\n- Remember session information\n\n### Performance Cookies\n- Analyze site usage\n- Improve site performance\n- Identify popular features\n\n### Functional Cookies\n- Remember user preferences\n- Provide personalized features\n- Enable social media functions\n\n## Managing Cookies\n\nYou can control and manage cookies in several ways:\n- Adjust your browser settings\n- Use our cookie preference manager\n- Delete existing cookies\n\n## Updates to This Policy\n\nWe may update this cookie policy periodically. Continued use of our service constitutes acceptance of any changes.\n    `;\n\n    res.json({\n      version: '1.0.0',\n      lastUpdated: new Date().toISOString().split('T')[0],\n      content: cookiePolicyContent,\n    });\n  });\n\n  // Acceptable Use Policy\n  app.get('/api/legal/aup', legalRateLimiter, (_req: Request, res: Response) => {\n    const aupContent = `\n# Acceptable Use Policy for MetaExtract\n\n**Last Updated:** ${new Date().toISOString().split('T')[0]}\n\n## Prohibited Uses\n\nYou agree not to use our service to:\n- Upload illegal or copyrighted content without permission\n- Engage in unlawful activities\n- Violate intellectual property rights\n- Circumvent security measures\n- Disrupt service operations\n- Harvest or scrape user data\n\n## Enforcement\n\nViolations of this policy may result in:\n- Account suspension or termination\n- Reporting to appropriate authorities\n- Legal action when necessary\n\n## Reporting Violations\n\nIf you discover a violation of this policy, please report it to: abuse@metaextract.com\n    `;\n\n    res.json({\n      version: '1.0.0',\n      lastUpdated: new Date().toISOString().split('T')[0],\n      content: aupContent,\n    });\n  });\n\n  console.log(' Legal compliance routes registered');\n}\n\nexport default registerLegalComplianceRoutes;\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/routes/llm-findings.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/routes/metadata.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[753,756],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[753,756],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_error' is defined but never used.","line":69,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":69,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_error' is defined but never used.","line":110,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":110,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_error' is defined but never used.","line":167,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":167,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_error' is defined but never used.","line":293,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":293,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Metadata Routes Module\n *\n * Handles metadata-related endpoints:\n * - Search and storage\n * - History\n * - Favorites\n * - Similar file finding\n */\n\nimport { spawn } from 'child_process';\n\nimport type { Express } from 'express';\nimport type { AuthRequest } from '../auth';\nimport { requireAuth } from '../auth';\nimport path from 'path';\n\n// Get the routes directory - compatible with both ESM and CommonJS\nconst projectRoot = process.cwd();\nconst currentDirPath = path.join(projectRoot, 'server', 'routes');\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\nasync function runMetadataDbCli(args: string[]): Promise<any> {\n  return new Promise((resolve, reject) => {\n    const pythonScript = path.join(\n      currentDirPath,\n      '..',\n      'extractor',\n      'metadata_db_cli.py'\n    );\n\n    // Prefer a configured Python executable (e.g., project's venv) when available\n    const configuredPython = process.env.PYTHON_EXECUTABLE;\n    const venvPython = path.join(\n      currentDirPath,\n      '..',\n      '.venv',\n      'bin',\n      'python'\n    );\n    const pythonExec =\n      configuredPython ||\n      (require('fs').existsSync(venvPython) ? venvPython : 'python3');\n\n    const python = spawn(pythonExec, [pythonScript, ...args]);\n\n    let stdout = '';\n    let stderr = '';\n\n    python.stdout.on('data', data => {\n      stdout += data.toString();\n    });\n\n    python.stderr.on('data', data => {\n      stderr += data.toString();\n    });\n\n    python.on('close', code => {\n      if (code !== 0) {\n        console.error('metadata_db_cli stderr:', stderr);\n        reject(new Error(stderr || 'metadata db cli failed'));\n        return;\n      }\n      try {\n        resolve(JSON.parse(stdout));\n      } catch (_error) {\n        console.error('metadata_db_cli stdout (raw):', stdout);\n        reject(new Error('failed to parse metadata db cli output'));\n      }\n    });\n\n    python.on('error', err => {\n      reject(new Error(`failed to start metadata db cli: ${err.message}`));\n    });\n\n    setTimeout(() => {\n      python.kill();\n      reject(new Error('metadata db cli timed out'));\n    }, 15000);\n  });\n}\n\n// ============================================================================\n// Route Registration\n// ============================================================================\n\nexport function registerMetadataRoutes(app: Express): void {\n  // Metadata search endpoint\n  app.get('/api/metadata/search', async (req, res) => {\n    try {\n      const query = (req.query.q || req.query.query) as string | undefined;\n      if (!query) {\n        return res.status(400).json({ error: 'query required' });\n      }\n      const limit = req.query.limit ? Number(req.query.limit) : 100;\n      const offset = req.query.offset ? Number(req.query.offset) : 0;\n      const results = await runMetadataDbCli([\n        'search',\n        '--query',\n        query,\n        '--limit',\n        String(limit),\n        '--offset',\n        String(offset),\n      ]);\n      res.json(results);\n    } catch (_error) {\n      res.status(500).json({ error: 'metadata search failed' });\n    }\n  });\n\n  // History endpoint\n  app.get(\n    '/api/metadata/history',\n    requireAuth,\n    async (req: AuthRequest, res) => {\n      try {\n        // Verify user is authenticated and get their ID\n        if (!req.user?.id) {\n          return res.status(401).json({ error: 'Authentication required' });\n        }\n\n        // Use Python script to get metadata history for this user\n        const pythonProcess = spawn('python3', [\n          path.join(currentDirPath, 'metadata-history.py'),\n          '--user-id',\n          req.user.id,\n          '--limit',\n          '50',\n        ]);\n\n        let data = '';\n        pythonProcess.stdout.on('data', chunk => {\n          data += chunk.toString();\n        });\n\n        pythonProcess.on('close', code => {\n          if (code !== 0) {\n            return res\n              .status(500)\n              .json({ error: 'Failed to get metadata history' });\n          }\n\n          try {\n            const history = JSON.parse(data);\n            res.json({ history });\n          } catch (error) {\n            console.error('Failed to parse metadata history:', error);\n            res.status(500).json({ error: 'Failed to parse metadata history' });\n          }\n        });\n      } catch (error) {\n        console.error('Error getting metadata history:', error);\n        res.status(500).json({ error: 'Internal server error' });\n      }\n    }\n  );\n\n  // Stats endpoint\n  app.get('/api/metadata/stats', async (req, res) => {\n    try {\n      const stats = await runMetadataDbCli(['stats']);\n      res.json(stats);\n    } catch (_error) {\n      res.status(500).json({ error: 'metadata stats failed' });\n    }\n  });\n\n  // Favorites list endpoint\n  app.get(\n    '/api/metadata/favorites',\n    requireAuth,\n    async (req: AuthRequest, res) => {\n      try {\n        // Verify user is authenticated and get their ID\n        if (!req.user?.id) {\n          return res.status(401).json({ error: 'Authentication required' });\n        }\n\n        // Use Python script to get favorites for this user\n        const pythonProcess = spawn('python3', [\n          path.join(currentDirPath, 'metadata-favorites.py'),\n          '--user-id',\n          req.user.id,\n          '--action',\n          'list',\n        ]);\n\n        let data = '';\n        pythonProcess.stdout.on('data', chunk => {\n          data += chunk.toString();\n        });\n\n        pythonProcess.on('close', code => {\n          if (code !== 0) {\n            return res.status(500).json({ error: 'Failed to get favorites' });\n          }\n\n          try {\n            const favorites = JSON.parse(data);\n            res.json({ favorites });\n          } catch (error) {\n            console.error('Failed to parse favorites:', error);\n            res.status(500).json({ error: 'Failed to parse favorites' });\n          }\n        });\n      } catch (error) {\n        console.error('Error getting favorites:', error);\n        res.status(500).json({ error: 'Internal server error' });\n      }\n    }\n  );\n\n  // Favorites toggle endpoint\n  app.post(\n    '/api/metadata/favorites',\n    requireAuth,\n    async (req: AuthRequest, res) => {\n      try {\n        // Verify user is authenticated and get their ID\n        if (!req.user?.id) {\n          return res.status(401).json({ error: 'Authentication required' });\n        }\n\n        const { fileId, action } = req.body;\n\n        if (!fileId || !action) {\n          return res\n            .status(400)\n            .json({ error: 'fileId and action are required' });\n        }\n\n        // Use Python script to manage favorites for this user\n        const pythonProcess = spawn('python3', [\n          path.join(currentDirPath, 'metadata-favorites.py'),\n          '--user-id',\n          req.user.id,\n          '--action',\n          action,\n          '--file-id',\n          fileId,\n        ]);\n\n        let data = '';\n        pythonProcess.stdout.on('data', chunk => {\n          data += chunk.toString();\n        });\n\n        pythonProcess.on('close', code => {\n          if (code !== 0) {\n            return res\n              .status(500)\n              .json({ error: 'Failed to manage favorites' });\n          }\n\n          try {\n            const result = JSON.parse(data);\n            res.json(result);\n          } catch (error) {\n            console.error('Failed to parse result:', error);\n            res.status(500).json({ error: 'Failed to parse result' });\n          }\n        });\n      } catch (error) {\n        console.error('Error managing favorites:', error);\n        res.status(500).json({ error: 'Internal server error' });\n      }\n    }\n  );\n\n  // Similar files endpoint\n  app.get('/api/metadata/similar', async (req, res) => {\n    try {\n      const phash = req.query.phash as string | undefined;\n      if (!phash) {\n        return res.status(400).json({ error: 'phash required' });\n      }\n      const threshold = req.query.threshold ? Number(req.query.threshold) : 5;\n      const limit = req.query.limit ? Number(req.query.limit) : 20;\n      const result = await runMetadataDbCli([\n        'similar',\n        '--phash',\n        phash,\n        '--threshold',\n        String(threshold),\n        '--limit',\n        String(limit),\n      ]);\n      res.json(result);\n    } catch (_error) {\n      res.status(500).json({ error: 'similarity search failed' });\n    }\n  });\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/routes/monitoring.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":107,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3505,3508],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3505,3508],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":261,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":261,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8084,8087],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8084,8087],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":308,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":308,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9266,9269],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9266,9269],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":309,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":309,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9284,9287],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9284,9287],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":310,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":310,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9307,9310],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9307,9310],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":361,"column":5,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":361,"endColumn":8,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10703,10706],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10703,10706],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":402,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":402,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11934,11937],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11934,11937],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Monitoring Routes\n * \n * Security monitoring dashboard and analytics endpoints\n */\n\nimport type { Express, Request, Response } from 'express';\nimport { securityEventLogger, SecurityEventType } from '../monitoring/security-events';\nimport { securityAlertManager } from '../monitoring/security-alerts';\nimport { checkTempHealth } from '../startup-cleanup';\nimport os from 'os';\n\n/**\n * Register monitoring routes\n */\nexport function registerMonitoringRoutes(app: Express): void {\n  \n  /**\n   * Security Dashboard - Main overview\n   */\n  app.get('/api/monitoring/dashboard', async (req: Request, res: Response) => {\n    try {\n      // Get temp directory health\n      const tempHealth = await checkTempHealth();\n      \n      // Get system metrics\n      const systemMetrics = {\n        memory: {\n          total: os.totalmem(),\n          free: os.freemem(),\n          used: os.totalmem() - os.freemem(),\n          usagePercent: Math.round(((os.totalmem() - os.freemem()) / os.totalmem()) * 100),\n        },\n        loadAverage: os.loadavg(),\n        uptime: os.uptime(),\n        platform: os.platform(),\n        nodeVersion: process.version,\n      };\n\n      // Get recent security analytics (mock data for now)\n      const analytics = await securityEventLogger.getSecurityAnalytics(\n        new Date(Date.now() - 24 * 60 * 60 * 1000), // Last 24 hours\n        new Date()\n      );\n\n      // Get recent alerts\n      const recentAlerts = securityAlertManager.getAlertHistory(10);\n\n      // Get abuse pattern detection\n      const abuseDetection = await securityEventLogger.detectAbusePatterns();\n\n      const dashboard = {\n        status: 'active',\n        timestamp: new Date().toISOString(),\n        overview: {\n          totalEvents: analytics.totalEvents,\n          criticalAlerts: recentAlerts.filter(a => a.severity === 'critical').length,\n          highSeverityEvents: analytics.eventsBySeverity.high || 0,\n          tempFiles: tempHealth.fileCount,\n          tempSizeMB: Math.round(tempHealth.totalSize / (1024 * 1024)),\n        },\n        systemHealth: {\n          tempDirectories: tempHealth,\n          systemMetrics,\n          status: tempHealth.healthy && systemMetrics.memory.usagePercent < 90 ? 'healthy' : 'warning',\n        },\n        securityMetrics: {\n          eventsByType: analytics.eventsByType,\n          eventsBySeverity: analytics.eventsBySeverity,\n          topIPs: analytics.topIPs,\n          hourlyBreakdown: analytics.hourlyBreakdown,\n        },\n        recentAlerts,\n        abuseDetection,\n        recommendations: generateRecommendations(tempHealth, analytics, abuseDetection),\n      };\n\n      res.json(dashboard);\n    } catch (error) {\n      console.error('[Monitoring] Dashboard error:', error);\n      res.status(500).json({\n        error: 'Dashboard generation failed',\n        message: 'Unable to generate security dashboard',\n      });\n    }\n  });\n\n  /**\n   * Security Events - Detailed event list\n   */\n  app.get('/api/monitoring/events', async (req: Request, res: Response) => {\n    try {\n      const {\n        startTime = new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(),\n        endTime = new Date().toISOString(),\n        eventType,\n        severity,\n        ipAddress,\n        limit = 100,\n        offset = 0,\n      } = req.query;\n\n      // Get security events from logger\n      const analytics = await securityEventLogger.getSecurityAnalytics(\n        new Date(startTime as string),\n        new Date(endTime as string),\n        eventType ? [eventType as any] : undefined\n      );\n\n      // Mock event list (in production, this would query database)\n      const events = generateMockEvents({\n        startTime: new Date(startTime as string),\n        endTime: new Date(endTime as string),\n        eventType: eventType as string,\n        severity: severity as string,\n        ipAddress: ipAddress as string,\n        limit: parseInt(limit as string),\n        offset: parseInt(offset as string),\n      });\n\n      res.json({\n        events,\n        totalCount: analytics.totalEvents,\n        filters: {\n          startTime,\n          endTime,\n          eventType,\n          severity,\n          ipAddress,\n        },\n        pagination: {\n          limit: parseInt(limit as string),\n          offset: parseInt(offset as string),\n          hasMore: events.length === parseInt(limit as string),\n        },\n      });\n    } catch (error) {\n      console.error('[Monitoring] Events error:', error);\n      res.status(500).json({\n        error: 'Events retrieval failed',\n        message: 'Unable to retrieve security events',\n      });\n    }\n  });\n\n  /**\n   * Alert History - Recent security alerts\n   */\n  app.get('/api/monitoring/alerts', (req: Request, res: Response) => {\n    try {\n      const { limit = 50, severity, type } = req.query;\n      \n      let alerts = securityAlertManager.getAlertHistory(parseInt(limit as string));\n      \n      // Apply filters if specified\n      if (severity) {\n        alerts = alerts.filter(a => a.severity === severity);\n      }\n      \n      if (type) {\n        alerts = alerts.filter(a => a.type === type);\n      }\n\n      res.json({\n        alerts,\n        totalCount: alerts.length,\n        filters: {\n          severity: severity as string,\n          type: type as string,\n          limit: parseInt(limit as string),\n        },\n      });\n    } catch (error) {\n      console.error('[Monitoring] Alerts error:', error);\n      res.status(500).json({\n        error: 'Alerts retrieval failed',\n        message: 'Unable to retrieve security alerts',\n      });\n    }\n  });\n\n  /**\n   * Abuse Detection - Pattern analysis\n   */\n  app.get('/api/monitoring/abuse-detection', async (req: Request, res: Response) => {\n    try {\n      const { hoursBack = 24 } = req.query;\n      \n      const detection = await securityEventLogger.detectAbusePatterns(\n        parseInt(hoursBack as string)\n      );\n\n      res.json({\n        patterns: detection.patterns,\n        riskScore: detection.riskScore,\n        riskLevel: getRiskLevel(detection.riskScore),\n        analysisTime: new Date().toISOString(),\n        timeWindow: `${hoursBack} hours`,\n      });\n    } catch (error) {\n      console.error('[Monitoring] Abuse detection error:', error);\n      res.status(500).json({\n        error: 'Abuse detection failed',\n        message: 'Unable to analyze abuse patterns',\n      });\n    }\n  });\n\n  /**\n   * Real-time Metrics - Live security metrics\n   */\n  app.get('/api/monitoring/metrics', async (req: Request, res: Response) => {\n    try {\n      const tempHealth = await checkTempHealth();\n      \n      const metrics = {\n        timestamp: new Date().toISOString(),\n        tempDirectory: {\n          fileCount: tempHealth.fileCount,\n          totalSize: tempHealth.totalSize,\n          healthy: tempHealth.healthy,\n        },\n        system: {\n          memoryUsagePercent: Math.round(((os.totalmem() - os.freemem()) / os.totalmem()) * 100),\n          loadAverage: os.loadavg(),\n          uptime: os.uptime(),\n        },\n        security: {\n          eventsLastMinute: Math.floor(Math.random() * 50), // Mock data\n          rateLimitHits: Math.floor(Math.random() * 20),    // Mock data\n          suspiciousIPs: 2,                                   // Mock data\n        },\n      };\n\n      res.json(metrics);\n    } catch (error) {\n      console.error('[Monitoring] Metrics error:', error);\n      res.status(500).json({\n        error: 'Metrics retrieval failed',\n        message: 'Unable to retrieve real-time metrics',\n      });\n    }\n  });\n\n  /**\n   * Export Security Data - For external analysis\n   */\n  app.get('/api/monitoring/export', async (req: Request, res: Response) => {\n    try {\n      const {\n        format = 'json',\n        startTime = new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(),\n        endTime = new Date().toISOString(),\n        eventTypes,\n      } = req.query;\n\n      // Get analytics data\n      const analytics = await securityEventLogger.getSecurityAnalytics(\n        new Date(startTime as string),\n        new Date(endTime as string),\n        eventTypes ? (eventTypes as string).split(',') as any : undefined\n      );\n\n      const exportData = {\n        exportInfo: {\n          timestamp: new Date().toISOString(),\n          format: format as string,\n          timeRange: {\n            start: startTime,\n            end: endTime,\n          },\n        },\n        analytics,\n        systemInfo: {\n          platform: os.platform(),\n          nodeVersion: process.version,\n          memory: {\n            total: os.totalmem(),\n            free: os.freemem(),\n          },\n        },\n      };\n\n      if (format === 'csv') {\n        // Convert to CSV format\n        const csv = convertToCSV(analytics);\n        res.setHeader('Content-Type', 'text/csv');\n        res.setHeader('Content-Disposition', 'attachment; filename=\"security-export.csv\"');\n        res.send(csv);\n      } else {\n        // Default JSON format\n        res.json(exportData);\n      }\n    } catch (error) {\n      console.error('[Monitoring] Export error:', error);\n      res.status(500).json({\n        error: 'Export failed',\n        message: 'Unable to export security data',\n      });\n    }\n  });\n}\n\n/**\n * Generate recommendations based on security metrics\n */\nfunction generateRecommendations(\n  tempHealth: any,\n  analytics: any,\n  abuseDetection: any\n): string[] {\n  const recommendations: string[] = [];\n\n  // Temp directory recommendations\n  if (!tempHealth.healthy) {\n    recommendations.push('Run manual cleanup via /api/health/cleanup endpoint');\n  }\n  \n  if (tempHealth.fileCount > 100) {\n    recommendations.push('Consider increasing cleanup frequency due to high temp file count');\n  }\n\n  // Analytics-based recommendations\n  if ((analytics.eventsBySeverity.high || 0) > 20) {\n    recommendations.push('High number of security events detected - review access patterns');\n  }\n\n  if ((analytics.eventsByType.rate_limit_exceeded || 0) > 50) {\n    recommendations.push('High rate limit activity - consider adjusting limits or investigating abuse');\n  }\n\n  // Abuse detection recommendations\n  if (abuseDetection.riskScore > 70) {\n    recommendations.push('High abuse risk detected - consider IP blocking or stricter rate limits');\n  }\n\n  return recommendations;\n}\n\n/**\n * Get risk level from score\n */\nfunction getRiskLevel(score: number): 'low' | 'medium' | 'high' | 'critical' {\n  if (score >= 80) return 'critical';\n  if (score >= 60) return 'high';\n  if (score >= 40) return 'medium';\n  return 'low';\n}\n\n/**\n * Generate mock security events for testing\n */\nfunction generateMockEvents(params: {\n  startTime: Date;\n  endTime: Date;\n  eventType?: string;\n  severity?: string;\n  ipAddress?: string;\n  limit: number;\n  offset: number;\n}): any[] {\n  const events = [];\n  const eventTypes: SecurityEventType[] = [\n    'upload_rejected',\n    'rate_limit_exceeded',\n    'burst_limit_exceeded',\n    'invalid_file_type',\n    'suspicious_access',\n    'temp_cleanup_performed',\n  ];\n\n  for (let i = 0; i < params.limit; i++) {\n    const timestamp = new Date(\n      params.startTime.getTime() + \n      Math.random() * (params.endTime.getTime() - params.startTime.getTime())\n    );\n\n    const eventType = params.eventType || eventTypes[Math.floor(Math.random() * eventTypes.length)];\n    const severity = params.severity || ['low', 'medium', 'high'][Math.floor(Math.random() * 3)];\n\n    events.push({\n      id: `evt_${Date.now()}_${i}`,\n      event: eventType,\n      severity,\n      timestamp: timestamp.toISOString(),\n      source: 'security_system',\n      ipAddress: params.ipAddress || `192.168.1.${Math.floor(Math.random() * 255)}`,\n      userAgent: 'Mozilla/5.0 (Test Browser)',\n      details: {\n        reason: 'Mock security event',\n        confidence: Math.random(),\n      },\n    });\n  }\n\n  return events.sort((a, b) => new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime());\n}\n\n/**\n * Convert analytics data to CSV format\n */\nfunction convertToCSV(analytics: any): string {\n  const headers = ['timestamp', 'event_type', 'severity', 'count', 'description'];\n  const rows = [];\n\n  // Add header row\n  rows.push(headers.join(','));\n\n  // Add data rows\n  Object.entries(analytics.eventsByType).forEach(([type, count]) => {\n    const numericCount = Number(count) || 0;\n    rows.push([\n      new Date().toISOString(),\n      type,\n      'mixed',\n      numericCount,\n      `Total ${type} events`,\n    ].join(','));\n  });\n\n  return rows.join('\\n');\n}","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/routes/onboarding.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'OnboardingSession' is defined but never used.","line":15,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'OnboardingInteraction' is defined but never used.","line":28,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":32},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[952,955],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[952,955],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Onboarding API Routes\n *\n * Handles onboarding session management, progress tracking, and user profile persistence.\n */\n\nimport type { Express, Request, Response } from 'express';\nimport { storage } from '../storage/index';\nimport type { AuthRequest } from '../auth';\n\n// ============================================================================\n// Types\n// ============================================================================\n\ninterface OnboardingSession {\n  id: string;\n  userId?: string;\n  startedAt: Date;\n  completedAt?: Date;\n  currentStep: number;\n  pathId: string;\n  userProfile: string; // JSON string\n  progress: string; // JSON string\n  interactions: string; // JSON array string\n  isActive: boolean;\n}\n\ninterface OnboardingInteraction {\n  timestamp: Date;\n  type: 'step-complete' | 'skip' | 'help-request' | 'feature-try' | 'error';\n  stepId?: string;\n  featureId?: string;\n  duration?: number;\n  metadata: Record<string, any>;\n}\n\n// ============================================================================\n// Route Handlers\n// ============================================================================\n\n/**\n * Get onboarding status for current user\n */\nasync function getOnboardingStatus(req: Request, res: Response) {\n  try {\n    const authReq = req as AuthRequest;\n    const userId = authReq.user?.id;\n\n    if (!userId) {\n      return res.status(401).json({ error: 'Authentication required' });\n    }\n\n    // Get active or most recent onboarding session\n    const session = await storage.getOnboardingSession(userId);\n\n    res.json({\n      hasSession: !!session,\n      session: session || null,\n      isComplete: session?.completedAt != null,\n      isActive: session?.isActive || false,\n    });\n  } catch (error) {\n    console.error('Failed to get onboarding status:', error);\n    res.status(500).json({ error: 'Failed to retrieve onboarding status' });\n  }\n}\n\n/**\n * Start a new onboarding session\n */\nasync function startOnboarding(req: Request, res: Response) {\n  try {\n    const authReq = req as AuthRequest;\n    const userId = authReq.user?.id;\n\n    if (!userId) {\n      return res.status(401).json({ error: 'Authentication required' });\n    }\n\n    const { pathId, userProfile, progress, interactions } = req.body;\n\n    if (!pathId || !userProfile) {\n      return res.status(400).json({\n        error: 'Missing required fields: pathId, userProfile',\n      });\n    }\n\n    // Create new onboarding session\n    const session = await storage.createOnboardingSession({\n      userId,\n      startedAt: new Date(),\n      currentStep: 0,\n      pathId,\n      userProfile: JSON.stringify(userProfile),\n      progress: JSON.stringify(progress || {}),\n      interactions: JSON.stringify(interactions || []),\n      isActive: true,\n    });\n\n    res.json({\n      success: true,\n      session,\n    });\n  } catch (error) {\n    console.error('Failed to start onboarding:', error);\n    res.status(500).json({ error: 'Failed to start onboarding session' });\n  }\n}\n\n/**\n * Update onboarding progress\n */\nasync function updateProgress(req: Request, res: Response) {\n  try {\n    const authReq = req as AuthRequest;\n    const userId = authReq.user?.id;\n\n    if (!userId) {\n      return res.status(401).json({ error: 'Authentication required' });\n    }\n\n    const { session } = req.body;\n\n    if (!session) {\n      return res.status(400).json({ error: 'Session data required' });\n    }\n\n    // Update session in database\n    await storage.updateOnboardingSession(session.id, {\n      currentStep: session.progress.currentStepIndex,\n      progress: JSON.stringify(session.progress),\n      interactions: JSON.stringify(session.interactions),\n      isActive: session.isActive,\n    });\n\n    res.json({\n      success: true,\n      message: 'Progress updated successfully',\n    });\n  } catch (_error) {\n    console.error('Failed to update progress:', _error);\n    res.status(500).json({ error: 'Failed to update onboarding progress' });\n  }\n}\n\n/**\n * Pause onboarding session\n */\nasync function pauseOnboarding(req: Request, res: Response) {\n  try {\n    const authReq = req as AuthRequest;\n    const userId = authReq.user?.id;\n\n    if (!userId) {\n      return res.status(401).json({ error: 'Authentication required' });\n    }\n\n    const { sessionId } = req.body;\n\n    if (!sessionId) {\n      return res.status(400).json({ error: 'Session ID required' });\n    }\n\n    await storage.updateOnboardingSession(sessionId, {\n      isActive: false,\n    });\n\n    res.json({\n      success: true,\n      message: 'Onboarding paused',\n    });\n  } catch (_error) {\n    console.error('Failed to pause onboarding:', _error);\n    res.status(500).json({ error: 'Failed to pause onboarding' });\n  }\n}\n\n/**\n * Resume onboarding session\n */\nasync function resumeOnboarding(req: Request, res: Response) {\n  try {\n    const authReq = req as AuthRequest;\n    const userId = authReq.user?.id;\n\n    if (!userId) {\n      return res.status(401).json({ error: 'Authentication required' });\n    }\n\n    const { sessionId } = req.body;\n\n    if (!sessionId) {\n      return res.status(400).json({ error: 'Session ID required' });\n    }\n\n    await storage.updateOnboardingSession(sessionId, {\n      isActive: true,\n    });\n\n    res.json({\n      success: true,\n      message: 'Onboarding resumed',\n    });\n  } catch (_error) {\n    console.error('Failed to resume onboarding:', _error);\n    res.status(500).json({ error: 'Failed to resume onboarding' });\n  }\n}\n\n/**\n * Complete onboarding session\n */\nasync function completeOnboarding(req: Request, res: Response) {\n  try {\n    const authReq = req as AuthRequest;\n    const userId = authReq.user?.id;\n\n    if (!userId) {\n      return res.status(401).json({ error: 'Authentication required' });\n    }\n\n    const { sessionId } = req.body;\n\n    if (!sessionId) {\n      return res.status(400).json({ error: 'Session ID required' });\n    }\n\n    await storage.updateOnboardingSession(sessionId, {\n      completedAt: new Date(),\n      isActive: false,\n    });\n\n    res.json({\n      success: true,\n      message: 'Onboarding completed',\n    });\n  } catch (_error) {\n    console.error('Failed to complete onboarding:', _error);\n    res.status(500).json({ error: 'Failed to complete onboarding' });\n  }\n}\n\n/**\n * Get onboarding analytics for user\n */\nasync function getOnboardingAnalytics(req: Request, res: Response) {\n  try {\n    const authReq = req as AuthRequest;\n    const userId = authReq.user?.id;\n\n    if (!userId) {\n      return res.status(401).json({ error: 'Authentication required' });\n    }\n\n    const session = await storage.getOnboardingSession(userId);\n\n    if (!session) {\n      return res.json({\n        hasData: false,\n        analytics: null,\n      });\n    }\n\n    const progress = JSON.parse(session.progress);\n    const interactions = JSON.parse(session.interactions);\n    const userProfile = JSON.parse(session.userProfile);\n\n    res.json({\n      hasData: true,\n      analytics: {\n        timeSpent: progress.timeSpent || 0,\n        stepsCompleted: progress.stepsCompleted?.length || 0,\n        completionRate: progress.completionRate || 0,\n        interactions: interactions || [],\n        userProfile,\n        pathId: session.pathId,\n        isComplete: !!session.completedAt,\n        startedAt: session.startedAt,\n        completedAt: session.completedAt,\n      },\n    });\n  } catch (_error) {\n    console.error('Failed to get onboarding analytics:', _error);\n    res.status(500).json({ error: 'Failed to retrieve analytics' });\n  }\n}\n\n// ============================================================================\n// Route Registration\n// ============================================================================\n\nexport function registerOnboardingRoutes(app: Express): void {\n  // Get onboarding status\n  app.get('/api/onboarding/status', getOnboardingStatus);\n\n  // Start new onboarding session\n  app.post('/api/onboarding/start', startOnboarding);\n\n  // Update progress\n  app.post('/api/onboarding/progress', updateProgress);\n\n  // Pause onboarding\n  app.post('/api/onboarding/pause', pauseOnboarding);\n\n  // Resume onboarding\n  app.post('/api/onboarding/resume', resumeOnboarding);\n\n  // Complete onboarding\n  app.post('/api/onboarding/complete', completeOnboarding);\n\n  // Get analytics\n  app.get('/api/onboarding/analytics', getOnboardingAnalytics);\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/routes/tiers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/routes_legacy.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Response' is defined but never used.","line":1,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'createServer' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'rateLimitAuth' is defined but never used.","line":14,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CREDIT_PACKS' is defined but never used.","line":43,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":43,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getRateLimits' is defined but never used.","line":44,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'registerOnboardingRoutes' is defined but never used.","line":48,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":48,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AuthRequest' is defined but never used.","line":49,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":49,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getEffectiveTier' is defined but never used.","line":49,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":49,"endColumn":44},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2196,2199],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2196,2199],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2231,2234],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2231,2234],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":74,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2262,2265],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2262,2265],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2292,2295],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2292,2295],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":76,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2328,2331],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2328,2331],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2363,2366],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2363,2366],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2400,2403],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2400,2403],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2437,2440],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2437,2440],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":80,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2472,2475],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2472,2475],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":81,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2507,2510],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2507,2510],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2558,2561],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2558,2561],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2600,2603],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2600,2603],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2633,2636],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2633,2636],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2667,2670],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2667,2670],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":86,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2703,2706],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2703,2706],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2738,2741],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2738,2741],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2781,2784],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2781,2784],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":89,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2826,2829],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2826,2829],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2871,2874],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2871,2874],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2919,2922],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2919,2922],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":92,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2969,2972],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2969,2972],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3015,3018],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3015,3018],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3064,3067],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3064,3067],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":95,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3109,3112],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3109,3112],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":96,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3156,3159],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3156,3159],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":97,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3203,3206],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3203,3206],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3258,3261],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3258,3261],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3313,3316],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3313,3316],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":100,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3358,3361],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3358,3361],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":101,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3408,3411],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3408,3411],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3449,3452],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3449,3452],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3489,3492],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3489,3492],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":104,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3531,3534],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3531,3534],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3581,3584],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3581,3584],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":107,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3656,3659],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3656,3659],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3708,3711],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3708,3711],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":130,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4240,4243],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4240,4243],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":131,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4275,4278],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4275,4278],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":132,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4303,4306],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4303,4306],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":133,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4342,4345],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4342,4345],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":134,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4375,4378],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4375,4378],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":135,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4404,4407],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4404,4407],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":136,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4434,4437],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4434,4437],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":137,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4471,4474],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4471,4474],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":138,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4508,4511],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4508,4511],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":139,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4543,4546],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4543,4546],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":140,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4578,4581],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4578,4581],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":141,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4619,4622],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4619,4622],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":142,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4655,4658],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4655,4658],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":143,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4690,4693],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4690,4693],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":144,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4733,4736],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4733,4736],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":145,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4778,4781],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4778,4781],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":146,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4823,4826],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4823,4826],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":147,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4871,4874],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4871,4874],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":148,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4921,4924],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4921,4924],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":149,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4967,4970],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4967,4970],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":150,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":150,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5016,5019],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5016,5019],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":151,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5061,5064],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5061,5064],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":152,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5108,5111],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5108,5111],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":153,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5155,5158],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5155,5158],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":154,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5210,5213],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5210,5213],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":155,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":155,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5265,5268],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5265,5268],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":156,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":156,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5310,5313],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5310,5313],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":157,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5360,5363],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5360,5363],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":158,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5401,5404],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5401,5404],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":159,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5441,5444],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5441,5444],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":160,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5483,5486],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5483,5486],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":161,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5533,5536],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5533,5536],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":162,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5584,5587],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5584,5587],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":163,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5625,5628],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5625,5628],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":164,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5673,5676],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5673,5676],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":165,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5725,5728],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5725,5728],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":167,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5799,5802],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5799,5802],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":385,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":385,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11693,11696],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11693,11696],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":413,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":413,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":562,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":562,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17259,17262],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17259,17262],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":594,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":594,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":966,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":966,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":986,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":986,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":995,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":995,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":1004,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":1004,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":1026,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":1026,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":1049,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":1049,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1207,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1207,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[39052,39055],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[39052,39055],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1225,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1225,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[39611,39614],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[39611,39614],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1234,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1234,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[39948,39951],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[39948,39951],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1357,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1357,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43815,43818],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43815,43818],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1431,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1431,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[46121,46124],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[46121,46124],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1492,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1492,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[48186,48189],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[48186,48189],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":1530,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":1530,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":1575,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":1575,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1787,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1787,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[57344,57347],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[57344,57347],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":1821,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":1821,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tierConfig' is assigned a value but never used.","line":1930,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":1930,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1991,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1991,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[63710,63713],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[63710,63713],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":2041,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":2041,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2141,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2141,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[68250,68253],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[68250,68253],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":2191,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":2191,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2287,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2287,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[72790,72793],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[72790,72793],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":2393,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":2393,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2469,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2469,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[79041,79044],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[79041,79044],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":2501,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":2501,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2532,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2532,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[80871,80874],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[80871,80874],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":2564,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":2564,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2595,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2595,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[82712,82715],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[82712,82715],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":2627,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":2627,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":114,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Express, Response } from 'express';\nimport { createServer, type Server } from 'http';\nimport multer from 'multer';\nimport crypto from 'crypto';\nimport fs from 'fs/promises';\nimport { existsSync } from 'fs';\nimport path from 'path';\nimport { spawn } from 'child_process';\nimport { storage } from './storage';\nimport { rateLimitManager } from './rateLimitRedis';\nimport {\n  rateLimitAPI,\n  rateLimitExtraction,\n  rateLimitAuth,\n  rateLimitPublic,\n  getRateLimitMetrics,\n  resetRateLimit,\n} from './rateLimitMiddleware';\n\n// Helper function to get current directory (ES module compatible)\nfunction getCurrentDir(): string {\n  // In CommonJS builds/tests, Node provides __dirname.\n   \n  if (typeof __dirname !== 'undefined') return __dirname;\n\n  // In ESM builds, default to the conventional project layout.\n  // Most invocations run from the repo root, so /server is the correct base.\n  const cwd = process.cwd();\n  const serverDirFromRoot = path.resolve(cwd, 'server');\n  if (existsSync(serverDirFromRoot)) return serverDirFromRoot;\n\n  // If we're already in /server (or a bundled runtime dir), fall back to cwd.\n  return cwd;\n}\nimport {\n  getTierConfig,\n  isFileTypeAllowed,\n  isFileSizeAllowed,\n  getRequiredTierForFileType,\n  TIER_CONFIGS,\n  normalizeTier,\n  toPythonTier,\n  CREDIT_PACKS,\n  getRateLimits,\n} from '@shared/tierConfig';\nimport { registerPaymentRoutes } from './payments';\nimport { registerForensicRoutes } from './routes/forensic';\nimport { registerOnboardingRoutes } from './routes/onboarding';\nimport { type AuthRequest, getEffectiveTier } from './auth';\n\n// ============================================================================\n// Enhanced Python Metadata Engine Integration\n// ============================================================================\n\ninterface PythonMetadataResponse {\n  extraction_info: {\n    timestamp: string;\n    tier: string;\n    engine_version: string;\n    libraries: Record<string, boolean>;\n    fields_extracted: number;\n    locked_categories: number;\n    processing_ms?: number;\n  };\n  file: {\n    path: string;\n    name: string;\n    stem: string;\n    extension: string;\n    mime_type: string;\n  };\n  summary: Record<string, any>;\n  filesystem: Record<string, any>;\n  hashes: Record<string, any>;\n  image: Record<string, any> | null;\n  exif: Record<string, any> | null;\n  gps: Record<string, any> | null;\n  video: Record<string, any> | null;\n  audio: Record<string, any> | null;\n  pdf: Record<string, any> | null;\n  svg: Record<string, any> | null;\n  extended_attributes: Record<string, any> | null;\n  calculated: Record<string, any>;\n  forensic: Record<string, any>;\n  makernote: Record<string, any> | null;\n  iptc: Record<string, any> | null;\n  xmp: Record<string, any> | null;\n  normalized?: Record<string, any> | null;\n  web_metadata?: Record<string, any> | null;\n  social_media?: Record<string, any> | null;\n  mobile_metadata?: Record<string, any> | null;\n  forensic_security?: Record<string, any> | null;\n  action_camera?: Record<string, any> | null;\n  print_publishing?: Record<string, any> | null;\n  workflow_dam?: Record<string, any> | null;\n  audio_advanced?: Record<string, any> | null;\n  video_advanced?: Record<string, any> | null;\n  steganography_analysis?: Record<string, any> | null;\n  manipulation_detection?: Record<string, any> | null;\n  ai_detection?: Record<string, any> | null;\n  timeline_analysis?: Record<string, any> | null;\n  iptc_raw?: Record<string, any> | null;\n  xmp_raw?: Record<string, any> | null;\n  thumbnail?: Record<string, any> | null;\n  perceptual_hashes?: Record<string, any> | null;\n  locked_fields: string[];\n  burned_metadata?: Record<string, any> | null;\n  metadata_comparison?: Record<string, any> | null;\n  advanced_analysis?: {\n    enabled: boolean;\n    processing_time_ms: number;\n    modules_run: string[];\n    forensic_score: number;\n    authenticity_assessment: string;\n  } | null;\n  error?: string;\n}\n\n// Frontend-compatible format\ninterface FrontendMetadataResponse {\n  filename: string;\n  filesize: string;\n  filetype: string;\n  mime_type: string;\n  tier: string;\n  fields_extracted: number;\n  fields_available: number;\n  processing_ms: number;\n  file_integrity: Record<string, string>;\n  filesystem: Record<string, any>;\n  calculated: Record<string, any>;\n  gps: Record<string, any> | null;\n  summary: Record<string, any>;\n  forensic: Record<string, any>;\n  exif: Record<string, any>;\n  image: Record<string, any> | null;\n  video: Record<string, any> | null;\n  audio: Record<string, any> | null;\n  pdf: Record<string, any> | null;\n  svg: Record<string, any> | null;\n  makernote: Record<string, any> | null;\n  iptc: Record<string, any> | null;\n  xmp: Record<string, any> | null;\n  normalized?: Record<string, any> | null;\n  web_metadata?: Record<string, any> | null;\n  social_media?: Record<string, any> | null;\n  mobile_metadata?: Record<string, any> | null;\n  forensic_security?: Record<string, any> | null;\n  action_camera?: Record<string, any> | null;\n  print_publishing?: Record<string, any> | null;\n  workflow_dam?: Record<string, any> | null;\n  audio_advanced?: Record<string, any> | null;\n  video_advanced?: Record<string, any> | null;\n  steganography_analysis?: Record<string, any> | null;\n  manipulation_detection?: Record<string, any> | null;\n  ai_detection?: Record<string, any> | null;\n  timeline_analysis?: Record<string, any> | null;\n  iptc_raw?: Record<string, any> | null;\n  xmp_raw?: Record<string, any> | null;\n  thumbnail?: Record<string, any> | null;\n  perceptual_hashes?: Record<string, any> | null;\n  extended_attributes: Record<string, any> | null;\n  extended?: Record<string, any> | null;\n  burned_metadata?: Record<string, any> | null;\n  metadata_comparison?: Record<string, any> | null;\n  locked_fields: string[];\n  extraction_info: Record<string, any>;\n  advanced_analysis?: {\n    enabled: boolean;\n    processing_time_ms: number;\n    modules_run: string[];\n    forensic_score: number;\n    authenticity_assessment: string;\n  };\n}\n\nfunction transformMetadataForFrontend(\n  raw: PythonMetadataResponse,\n  originalFilename: string,\n  tier: string\n): FrontendMetadataResponse {\n  // Count total available fields based on comprehensive engine capabilities\n  const normalizedTier = normalizeTier(tier);\n  const fieldsAvailableByTier: Record<string, number> = {\n    free: 200,\n    professional: 1000,\n    forensic: 15000,\n    enterprise: 45000,\n  };\n  const fieldsAvailable = fieldsAvailableByTier[normalizedTier] ?? 45000;\n\n  return {\n    filename: originalFilename,\n    filesize: raw.filesystem?.size_human || raw.summary?.filesize || 'Unknown',\n    filetype:\n      raw.file?.extension?.toUpperCase().replace('.', '') ||\n      raw.summary?.filetype ||\n      'Unknown',\n    mime_type:\n      raw.file?.mime_type ||\n      raw.summary?.mime_type ||\n      'application/octet-stream',\n    tier,\n    fields_extracted: raw.extraction_info?.fields_extracted || 0,\n    fields_available: fieldsAvailable,\n    processing_ms: raw.extraction_info?.processing_ms || 0,\n\n    // File integrity / hashes\n    file_integrity: raw.hashes?._locked ? { _locked: true } : raw.hashes || {},\n\n    // Filesystem details\n    filesystem: raw.filesystem || {},\n\n    // Calculated/inferred fields\n    calculated: raw.calculated || {},\n\n    // GPS data\n    gps: raw.gps,\n\n    // Summary (quick overview)\n    summary: {\n      ...raw.summary,\n      filename: originalFilename,\n    },\n\n    // Forensic details\n    forensic: raw.forensic || {},\n\n    // EXIF data\n    exif: raw.exif || {},\n\n    // Image properties\n    image: raw.image,\n\n    // Video properties\n    video: raw.video,\n\n    // Audio properties\n    audio: raw.audio,\n\n    // PDF properties\n    pdf: raw.pdf,\n\n    // SVG properties\n    svg: raw.svg,\n\n    // MakerNote (vendor-specific)\n    makernote: raw.makernote,\n\n    // IPTC metadata\n    iptc: raw.iptc,\n\n    // XMP metadata\n    xmp: raw.xmp,\n\n    // Normalized/search fields\n    normalized: raw.normalized,\n\n    // Optional analysis categories\n    web_metadata: raw.web_metadata ?? null,\n    social_media: raw.social_media ?? null,\n    mobile_metadata: raw.mobile_metadata ?? null,\n    forensic_security: raw.forensic_security ?? null,\n    action_camera: raw.action_camera ?? null,\n    print_publishing: raw.print_publishing ?? null,\n    workflow_dam: raw.workflow_dam ?? null,\n    audio_advanced: raw.audio_advanced ?? null,\n    video_advanced: raw.video_advanced ?? null,\n    steganography_analysis: raw.steganography_analysis ?? null,\n    manipulation_detection: raw.manipulation_detection ?? null,\n    ai_detection: raw.ai_detection ?? null,\n    timeline_analysis: raw.timeline_analysis ?? null,\n\n    // Raw IPTC/XMP (fallback)\n    iptc_raw: raw.iptc_raw,\n    xmp_raw: raw.xmp_raw,\n\n    // Image-derived extras\n    thumbnail: raw.thumbnail,\n    perceptual_hashes: raw.perceptual_hashes,\n\n    // Extended attributes\n    extended_attributes: raw.extended_attributes,\n    extended: raw.extended_attributes,\n\n    // Burned-in overlay metadata (OCR)\n    burned_metadata: raw.burned_metadata ?? null,\n    metadata_comparison: raw.metadata_comparison ?? null,\n\n    // Locked fields list\n    locked_fields: raw.locked_fields || [],\n\n    // Full extraction info\n    extraction_info: raw.extraction_info || {},\n  };\n}\n\nasync function extractMetadataWithPython(\n  filePath: string,\n  tier: string,\n  includePerformanceMetrics: boolean = false,\n  enableAdvancedAnalysis: boolean = false,\n  storeMetadata: boolean = false\n): Promise<PythonMetadataResponse> {\n  return new Promise((resolve, reject) => {\n    // Use comprehensive metadata engine for configurable comprehensive field support\n    const currentDir = getCurrentDir();\n    const pythonScript = path.join(\n      currentDir,\n      'extractor',\n      'comprehensive_metadata_engine.py'\n    );\n\n    const args: string[] = [pythonScript, filePath, '--tier', tier];\n\n    if (includePerformanceMetrics) {\n      args.push('--performance');\n    }\n\n    if (enableAdvancedAnalysis) {\n      args.push('--advanced');\n    }\n\n    if (storeMetadata) {\n      args.push('--store');\n    }\n\n    const venvPython = path.join(currentDir, '..', '.venv', 'bin', 'python');\n    const pythonCommand = existsSync(venvPython) ? venvPython : 'python3';\n    const python = spawn(pythonCommand, args);\n\n    let stdout = '';\n    let stderr = '';\n\n    python.stdout.on('data', (data: Buffer) => {\n      stdout += data.toString();\n    });\n\n    python.stderr.on('data', (data: Buffer) => {\n      stderr += data.toString();\n    });\n\n    python.on('close', (code: number | null) => {\n      if (code !== 0) {\n        console.error('Comprehensive Python extractor error:', stderr);\n        reject(\n          new Error(\n            `Comprehensive Python extractor failed: ${\n              stderr || 'Unknown error'\n            }`\n          )\n        );\n        return;\n      }\n\n      try {\n        const result = JSON.parse(stdout);\n        resolve(result);\n      } catch (e) {\n        console.error('Failed to parse comprehensive Python output:', e);\n        console.error('Raw output:', stdout.substring(0, 500));\n        reject(\n          new Error('Failed to parse comprehensive metadata extraction result')\n        );\n      }\n    });\n\n    python.on('error', (err: Error) => {\n      console.error('Failed to spawn comprehensive Python:', err);\n      reject(\n        new Error(\n          `Failed to start comprehensive Python extractor: ${err.message}`\n        )\n      );\n    });\n\n    // Timeout after 180 seconds (increased for comprehensive analysis)\n    setTimeout(() => {\n      python.kill();\n      reject(new Error('Comprehensive metadata extraction timed out'));\n    }, 180000);\n  });\n}\n\nasync function runMetadataDbCli(args: string[]): Promise<any> {\n  return new Promise((resolve, reject) => {\n    const currentDir = getCurrentDir();\n    const pythonScript = path.join(\n      currentDir,\n      'extractor',\n      'metadata_db_cli.py'\n    );\n    const python = spawn('python3', [pythonScript, ...args]);\n\n    let stdout = '';\n    let stderr = '';\n\n    python.stdout.on('data', (data: Buffer) => {\n      stdout += data.toString();\n    });\n\n    python.stderr.on('data', (data: Buffer) => {\n      stderr += data.toString();\n    });\n\n    python.on('close', (code: number | null) => {\n      if (code !== 0) {\n        reject(new Error(stderr || 'metadata db cli failed'));\n        return;\n      }\n      try {\n        resolve(JSON.parse(stdout));\n      } catch (error) {\n        reject(new Error('failed to parse metadata db cli output'));\n      }\n    });\n\n    python.on('error', (err: Error) => {\n      reject(new Error(`failed to start metadata db cli: ${err.message}`));\n    });\n\n    setTimeout(() => {\n      python.kill();\n      reject(new Error('metadata db cli timed out'));\n    }, 15000);\n  });\n}\n\n// ============================================================================\n// Multer Configuration\n// ============================================================================\n\nconst upload = multer({\n  storage: multer.memoryStorage(),\n  limits: {\n    fileSize: 2000 * 1024 * 1024, // 2GB max (enterprise/super tier)\n  },\n});\n\n// ============================================================================\n// API Routes\n// ============================================================================\n\nexport async function registerRoutes(\n  httpServer: Server,\n  app: Express\n): Promise<Server> {\n  // Initialize rate limiter\n  await rateLimitManager.initialize();\n\n  // Apply global API rate limiting to all /api routes\n  app.use('/api', rateLimitAPI());\n\n  // Rate limiting for admin endpoints\n  app.get('/api/admin/rate-limit/metrics', async (req, res) => {\n    try {\n      await getRateLimitMetrics(req, res);\n    } catch (error) {\n      res.status(500).json({\n        error: 'Failed to retrieve rate limit metrics',\n        details: error instanceof Error ? error.message : 'Unknown error'\n      });\n    }\n  });\n\n  app.post('/api/admin/rate-limit/reset/:identifier', async (req, res) => {\n    try {\n      await resetRateLimit(req, res);\n    } catch (error) {\n      res.status(500).json({\n        error: 'Failed to reset rate limit',\n        details: error instanceof Error ? error.message : 'Unknown error'\n      });\n    }\n  });\n\n  // Batch processing endpoint (Forensic/Enterprise tiers) - with stricter rate limiting\n  app.post(\n    '/api/extract/batch',\n    rateLimitExtraction(),\n    upload.array('files', 100),\n    async (req, res) => {\n      const startTime = Date.now();\n      const tempPaths: string[] = [];\n\n      try {\n        if (!req.files || !Array.isArray(req.files) || req.files.length === 0) {\n          return res.status(400).json({ error: 'No files uploaded' });\n        }\n\n        const requestedTier = (req.query.tier as string) || 'enterprise';\n        const normalizedTier = normalizeTier(requestedTier);\n        const pythonTier = toPythonTier(normalizedTier);\n        const tierConfig = getTierConfig(normalizedTier);\n\n        // Check if tier supports batch processing\n        if (!tierConfig.features.batchUpload) {\n          return res.status(403).json({\n            error: 'Batch processing not available for your plan',\n            current_tier: normalizedTier,\n            required_tier: 'forensic',\n            upgrade_message:\n              'Upgrade to Forensic or Enterprise for batch processing',\n          });\n        }\n\n        // Validate all files first\n        for (const file of req.files) {\n          const mimeType = file.mimetype || 'application/octet-stream';\n\n          if (!isFileTypeAllowed(normalizedTier, mimeType)) {\n            const requiredTier = getRequiredTierForFileType(mimeType);\n            return res.status(403).json({\n              error: `File type not allowed: ${file.originalname}`,\n              file_type: mimeType,\n              current_tier: normalizedTier,\n              required_tier: requiredTier,\n            });\n          }\n\n          if (!isFileSizeAllowed(normalizedTier, file.size)) {\n            return res.status(403).json({\n              error: `File size exceeds limit: ${file.originalname}`,\n              file_size_mb: Math.round((file.size / (1024 * 1024)) * 100) / 100,\n              max_size_mb: tierConfig.maxFileSizeMB,\n            });\n          }\n        }\n\n        // Write all files to temp locations\n        const tempDir = '/tmp/metaextract';\n        await fs.mkdir(tempDir, { recursive: true });\n\n        const fileInfos: Array<{\n          tempPath: string;\n          originalName: string;\n          size: number;\n          mimeType?: string;\n        }> = [];\n        for (const file of req.files) {\n          const tempPath = path.join(\n            tempDir,\n            `${Date.now()}-${crypto.randomUUID()}-${file.originalname}`\n          );\n          await fs.writeFile(tempPath, file.buffer);\n          tempPaths.push(tempPath);\n          fileInfos.push({\n            tempPath,\n            originalName: file.originalname,\n            size: file.size,\n            mimeType: file.mimetype,\n          });\n        }\n\n        // Process batch using enhanced Python engine\n        const currentDir = getCurrentDir();\n        const pythonScript = path.join(\n          currentDir,\n          'extractor',\n          'comprehensive_metadata_engine.py'\n        );\n        const batchResults = await new Promise<any>((resolve, reject) => {\n          const pythonArgs = [\n            pythonScript,\n            '--batch',\n            '--tier',\n            pythonTier,\n            ...tempPaths,\n          ];\n          if (req.query.store === 'true') {\n            pythonArgs.push('--store');\n          }\n          const python = spawn('python3', pythonArgs);\n\n          let stdout = '';\n          let stderr = '';\n\n          python.stdout.on('data', (data: Buffer) => {\n            stdout += data.toString();\n          });\n\n          python.stderr.on('data', (data: Buffer) => {\n            stderr += data.toString();\n          });\n\n          python.on('close', (code: number | null) => {\n            if (code !== 0) {\n              reject(new Error(`Batch processing failed: ${stderr}`));\n              return;\n            }\n\n            try {\n              resolve(JSON.parse(stdout));\n            } catch (e) {\n              reject(new Error('Failed to parse batch results'));\n            }\n          });\n\n          // Longer timeout for batch processing\n          setTimeout(() => {\n            python.kill();\n            reject(new Error('Batch processing timed out'));\n          }, 300000); // 5 minutes\n        });\n\n        // Transform results for frontend\n        const transformedResults: Record<string, FrontendMetadataResponse> = {};\n        for (const fileInfo of fileInfos) {\n          const result = batchResults.results[fileInfo.tempPath];\n          if (result) {\n            transformedResults[fileInfo.originalName] =\n              transformMetadataForFrontend(\n                result,\n                fileInfo.originalName,\n                normalizedTier\n              );\n          }\n        }\n\n        const processingMs = Date.now() - startTime;\n\n        // Log batch analytics\n        for (const fileInfo of fileInfos) {\n          const fileExt =\n            path.extname(fileInfo.originalName).toLowerCase().slice(1) ||\n            'unknown';\n          storage\n            .logExtractionUsage({\n              tier: normalizedTier,\n              fileExtension: fileExt,\n              mimeType: fileInfo.mimeType || 'application/octet-stream',\n              fileSizeBytes: fileInfo.size,\n              isVideo: fileInfo.mimeType?.startsWith('video/') || false,\n              isImage: fileInfo.mimeType?.startsWith('image/') || false,\n              isPdf: fileInfo.mimeType === 'application/pdf',\n              isAudio: fileInfo.mimeType?.startsWith('audio/') || false,\n              fieldsExtracted: 0, // Will be updated per file\n              processingMs: processingMs / fileInfos.length, // Average per file\n              success: true,\n              ipAddress: req.ip || req.socket.remoteAddress || null,\n              userAgent: req.headers['user-agent'] || null,\n            })\n            .catch((err) => console.error('Failed to log batch usage:', err));\n        }\n\n        res.json({\n          success: true,\n          batch_id: crypto.randomUUID(),\n          total_files: fileInfos.length,\n          successful_files: Object.keys(transformedResults).length,\n          processing_time_ms: processingMs,\n          results: transformedResults,\n          summary: batchResults.summary,\n        });\n      } catch (error) {\n        const processingMs = Date.now() - startTime;\n        console.error('Batch processing error:', error);\n\n        res.status(500).json({\n          error: 'Batch processing failed',\n          details: error instanceof Error ? error.message : 'Unknown error',\n          processing_time_ms: processingMs,\n        });\n      } finally {\n        // Clean up all temp files\n        for (const tempPath of tempPaths) {\n          try {\n            await fs.unlink(tempPath);\n          } catch (error) {\n            console.error('Failed to delete temp file:', tempPath, error);\n          }\n        }\n      }\n    }\n  );\n\n  // Main extraction endpoint - with rate limiting\n  app.post('/api/extract', rateLimitExtraction(), upload.single('file'), async (req, res) => {\n    const startTime = Date.now();\n    let tempPath: string | null = null;\n\n    try {\n      if (!req.file) {\n        return res.status(400).json({ error: 'No file uploaded' });\n      }\n\n      const requestedTier = (req.query.tier as string) || 'enterprise';\n      const normalizedTier = normalizeTier(requestedTier);\n      const pythonTier = toPythonTier(normalizedTier);\n      const mimeType = req.file.mimetype || 'application/octet-stream';\n      const tierConfig = getTierConfig(normalizedTier);\n\n      // Validate file type for tier\n      if (!isFileTypeAllowed(normalizedTier, mimeType)) {\n        const requiredTier = getRequiredTierForFileType(mimeType);\n        return res.status(403).json({\n          error: 'File type not allowed for your plan',\n          file_type: mimeType,\n          current_tier: normalizedTier,\n          required_tier: requiredTier,\n          upgrade_message: `Upgrade to ${\n            TIER_CONFIGS[requiredTier].displayName\n          } (${TIER_CONFIGS[requiredTier].priceLabel}) to process ${\n            mimeType.split('/')[0]\n          } files`,\n        });\n      }\n\n      // Validate file size for tier\n      if (!isFileSizeAllowed(normalizedTier, req.file.size)) {\n        return res.status(403).json({\n          error: 'File size exceeds plan limit',\n          file_size_mb: Math.round((req.file.size / (1024 * 1024)) * 100) / 100,\n          max_size_mb: tierConfig.maxFileSizeMB,\n          current_tier: normalizedTier,\n          upgrade_message: `Upgrade to a higher plan for larger file support`,\n        });\n      }\n\n      // Write file to temp location\n      const tempDir = '/tmp/metaextract';\n      await fs.mkdir(tempDir, { recursive: true });\n      tempPath = path.join(\n        tempDir,\n        `${Date.now()}-${crypto.randomUUID()}-${req.file.originalname}`\n      );\n      await fs.writeFile(tempPath, req.file.buffer);\n\n      // Capture a non-null temp path for use inside async closures\n      const tempPathForPython = tempPath;\n      if (!tempPathForPython) {\n        throw new Error('Failed to create temp file for extraction');\n      }\n\n      // Extract metadata using Comprehensive Python engine (v4.0)\n      const rawMetadata = await extractMetadataWithPython(\n        tempPathForPython,\n        pythonTier,\n        true,\n        true,\n        req.query.store === 'true'\n      );\n\n      // Calculate processing time and add to raw metadata\n      const processingMs = Date.now() - startTime;\n      rawMetadata.extraction_info.processing_ms = processingMs;\n\n      // Transform for frontend\n      const metadata = transformMetadataForFrontend(\n        rawMetadata,\n        req.file.originalname,\n        normalizedTier\n      );\n\n      // Log analytics\n      const fileExt =\n        path.extname(req.file.originalname).toLowerCase().slice(1) || 'unknown';\n      storage\n        .logExtractionUsage({\n          tier: normalizedTier,\n          fileExtension: fileExt,\n          mimeType,\n          fileSizeBytes: req.file.size,\n          isVideo: mimeType.startsWith('video/'),\n          isImage: mimeType.startsWith('image/'),\n          isPdf: mimeType === 'application/pdf',\n          isAudio: mimeType.startsWith('audio/'),\n          fieldsExtracted: metadata.fields_extracted || 0,\n          processingMs,\n          success: true,\n          ipAddress: req.ip || req.socket.remoteAddress || null,\n          userAgent: req.headers['user-agent'] || null,\n        })\n        .catch((err) => console.error('Failed to log usage:', err));\n\n      res.json(metadata);\n    } catch (error) {\n      const processingMs = Date.now() - startTime;\n      const failureReason =\n        error instanceof Error ? error.message : 'Unknown error';\n\n      console.error('Metadata extraction error:', error);\n\n      // Log failed extraction\n      if (req.file) {\n        const fileExt =\n          path.extname(req.file.originalname).toLowerCase().slice(1) ||\n          'unknown';\n        const fallbackTier = normalizeTier(\n          (req.query.tier as string) || 'enterprise'\n        );\n        storage\n          .logExtractionUsage({\n            tier: fallbackTier,\n            fileExtension: fileExt,\n            mimeType: req.file.mimetype || 'application/octet-stream',\n            fileSizeBytes: req.file.size,\n            isVideo: false,\n            isImage: false,\n            isPdf: false,\n            isAudio: false,\n            fieldsExtracted: 0,\n            processingMs,\n            success: false,\n            failureReason,\n            ipAddress: req.ip || req.socket.remoteAddress || null,\n            userAgent: req.headers['user-agent'] || null,\n          })\n          .catch((err) => console.error('Failed to log usage:', err));\n      }\n\n      res.status(500).json({\n        error: 'Failed to extract metadata',\n        details: failureReason,\n      });\n    } finally {\n      // Clean up temp file\n      if (tempPath) {\n        try {\n          await fs.unlink(tempPath);\n        } catch (error) {\n          console.error('Failed to delete temp file:', error);\n        }\n      }\n    }\n  });\n\n  // Tier configuration endpoints - public rate limiting\n  app.get('/api/tiers', rateLimitPublic(), (req, res) => {\n    res.json(TIER_CONFIGS);\n  });\n\n  app.get('/api/tiers/:tier', (req, res) => {\n    const tierConfig = getTierConfig(req.params.tier);\n    res.json(tierConfig);\n  });\n\n  // Field information endpoint\n  app.get('/api/fields', (req, res) => {\n    res.json({\n      total_possible_fields: 'configurable',\n      comprehensive_engine_version: '4.0.0',\n      tiers: {\n        free: {\n          fields: '~200',\n          categories: [\n            'summary',\n            'basic_exif',\n            'basic_image',\n            'gps',\n            'hashes',\n            'calculated',\n          ],\n          file_types: ['Images (JPEG, PNG, GIF, WebP)'],\n          max_size_mb: 10,\n          locked: [\n            'makernote',\n            'iptc',\n            'xmp',\n            'extended_attributes',\n            'serial_numbers',\n            'video',\n            'audio',\n            'pdf',\n            'advanced_analysis',\n          ],\n        },\n        professional: {\n          fields: '~1000',\n          categories: [\n            'summary',\n            'exif',\n            'image',\n            'gps',\n            'filesystem',\n            'hashes',\n            'calculated',\n            'forensic',\n            'audio',\n            'pdf',\n          ],\n          file_types: ['Images + RAW + HEIC'],\n          max_size_mb: 100,\n          locked: [\n            'video',\n            'audio',\n            'pdf',\n            'advanced_analysis',\n            'timeline_analysis',\n          ],\n        },\n        forensic: {\n          fields: '~15000',\n          categories: ['all_fields'],\n          file_types: ['Images + RAW + Video + Audio + PDF + SVG'],\n          max_size_mb: 500,\n          locked: [\n            'medical_imaging',\n            'astronomical_data',\n            'scientific_data',\n            'blockchain_provenance',\n          ],\n        },\n        enterprise: {\n          fields: 'configurable',\n          categories: ['all_fields', 'batch_processing', 'api_access'],\n          file_types: ['All file types'],\n          max_size_mb: 2000,\n          locked: [],\n        },\n      },\n      categories: {\n        summary: 'Basic file information (name, size, type)',\n        exif: 'Camera settings, dates, software',\n        image: 'Resolution, color mode, format details',\n        gps: 'GPS coordinates with Google Maps links',\n        filesystem: 'Permissions, ownership, timestamps',\n        hashes: 'MD5, SHA256, SHA1, CRC32 checksums',\n        calculated: 'Aspect ratio, megapixels, file age',\n        forensic: 'Device identification, modification detection',\n        makernote: 'Vendor-specific camera data (Canon, Nikon, Sony, etc.)',\n        iptc: 'News/photo agency metadata (copyright, keywords, captions)',\n        xmp: 'Adobe metadata (editing history, keywords)',\n        video: 'Codec, streams, chapters, HDR metadata',\n        audio: 'Tags, album art, bitrate, format details',\n        pdf: 'Pages, author, encryption, forms',\n        svg: 'Elements, viewBox, scripts detection',\n        extended_attributes: 'macOS Finder tags, Spotlight metadata',\n        normalized: 'Normalized/searchable fields (camera/lens/exposure)',\n        web_metadata: 'Open Graph, schema.org, and web metadata',\n        social_media: 'Platform-specific social metadata',\n        mobile_metadata: 'Smartphone computational photography fields',\n        forensic_security: 'C2PA, signatures, provenance indicators',\n        action_camera: 'GoPro/Action cam specific tags',\n        print_publishing: 'Print/publishing workflow metadata',\n        workflow_dam: 'DAM/workflow metadata',\n        audio_advanced: 'ReplayGain and advanced audio analysis',\n        video_advanced: 'HDR and professional video analysis',\n        steganography_analysis: 'Hidden data detection signals',\n        manipulation_detection: 'Tampering detection indicators',\n        ai_detection: 'AI-generated content indicators',\n        timeline_analysis: 'Forensic timeline reconstruction',\n      },\n    });\n  });\n\n  // Metadata search/storage endpoints\n  app.get('/api/metadata/search', async (req, res) => {\n    try {\n      const query = (req.query.q || req.query.query) as string | undefined;\n      if (!query) {\n        return res.status(400).json({ error: 'query required' });\n      }\n      const limit = req.query.limit ? Number(req.query.limit) : 100;\n      const offset = req.query.offset ? Number(req.query.offset) : 0;\n      const results = await runMetadataDbCli([\n        'search',\n        '--query',\n        query,\n        '--limit',\n        String(limit),\n        '--offset',\n        String(offset),\n      ]);\n      res.json(results);\n    } catch (error) {\n      res.status(500).json({ error: 'metadata search failed' });\n    }\n  });\n\n  app.get('/api/metadata/history', async (req, res) => {\n    try {\n      const fileId = req.query.file_id as string | undefined;\n      const filePath = req.query.file_path as string | undefined;\n      if (!fileId && !filePath) {\n        return res.status(400).json({ error: 'file_id or file_path required' });\n      }\n      const args = ['history'];\n      if (fileId) {\n        args.push('--file-id', fileId);\n      } else if (filePath) {\n        args.push('--file-path', filePath);\n      }\n      const history = await runMetadataDbCli(args);\n      res.json(history);\n    } catch (error) {\n      res.status(500).json({ error: 'history lookup failed' });\n    }\n  });\n\n  app.get('/api/metadata/stats', async (req, res) => {\n    try {\n      const stats = await runMetadataDbCli(['stats']);\n      res.json(stats);\n    } catch (error) {\n      res.status(500).json({ error: 'metadata stats failed' });\n    }\n  });\n\n  app.get('/api/metadata/favorites', async (req, res) => {\n    try {\n      const favorites = await runMetadataDbCli(['favorites', '--list']);\n      res.json(favorites);\n    } catch (error) {\n      res.status(500).json({ error: 'favorites lookup failed' });\n    }\n  });\n\n  app.post('/api/metadata/favorites', async (req, res) => {\n    try {\n      const { file_id, notes, tags } = req.body || {};\n      if (!file_id) {\n        return res.status(400).json({ error: 'file_id required' });\n      }\n      const args = ['favorites', '--toggle', '--file-id', String(file_id)];\n      if (notes) {\n        args.push('--notes', String(notes));\n      }\n      if (tags && Array.isArray(tags)) {\n        args.push('--tags', tags.join(','));\n      } else if (typeof tags === 'string') {\n        args.push('--tags', tags);\n      }\n      const result = await runMetadataDbCli(args);\n      res.json(result);\n    } catch (error) {\n      res.status(500).json({ error: 'favorites toggle failed' });\n    }\n  });\n\n  app.get('/api/metadata/similar', async (req, res) => {\n    try {\n      const phash = req.query.phash as string | undefined;\n      if (!phash) {\n        return res.status(400).json({ error: 'phash required' });\n      }\n      const threshold = req.query.threshold ? Number(req.query.threshold) : 5;\n      const limit = req.query.limit ? Number(req.query.limit) : 20;\n      const result = await runMetadataDbCli([\n        'similar',\n        '--phash',\n        phash,\n        '--threshold',\n        String(threshold),\n        '--limit',\n        String(limit),\n      ]);\n      res.json(result);\n    } catch (error) {\n      res.status(500).json({ error: 'similarity search failed' });\n    }\n  });\n\n  // ============================================================================\n  // Advanced Forensic Analysis Endpoints\n  // ============================================================================\n\n  // Advanced single file extraction with forensic analysis - with stricter rate limiting\n  app.post('/api/extract/advanced', rateLimitExtraction(), upload.single('file'), async (req, res) => {\n    const startTime = Date.now();\n    let tempPath: string | null = null;\n\n    try {\n      if (!req.file) {\n        return res.status(400).json({ error: 'No file uploaded' });\n      }\n\n      const requestedTier = (req.query.tier as string) || 'enterprise';\n      const normalizedTier = normalizeTier(requestedTier);\n      const pythonTier = toPythonTier(normalizedTier);\n      const mimeType = req.file.mimetype || 'application/octet-stream';\n      const tierConfig = getTierConfig(normalizedTier);\n\n      // Check if tier supports advanced analysis (disabled in dev)\n      if (process.env.NODE_ENV !== 'development' && normalizedTier === 'free') {\n        return res.status(403).json({\n          error: 'Advanced analysis not available for your plan',\n          current_tier: normalizedTier,\n          required_tier: 'professional',\n          upgrade_message:\n            'Upgrade to Professional or higher for advanced analysis capabilities',\n        });\n      }\n\n      // Validate file type and size\n      if (!isFileTypeAllowed(normalizedTier, mimeType)) {\n        const requiredTier = getRequiredTierForFileType(mimeType);\n        return res.status(403).json({\n          error: 'File type not allowed',\n          file_type: mimeType,\n          required_tier: requiredTier,\n        });\n      }\n\n      if (!isFileSizeAllowed(normalizedTier, req.file.size)) {\n        return res.status(403).json({\n          error: 'File size exceeds limit',\n          file_size_mb: Math.round((req.file.size / (1024 * 1024)) * 100) / 100,\n          max_size_mb: tierConfig.maxFileSizeMB,\n        });\n      }\n\n      // Write file to temp location\n      const tempDir = '/tmp/metaextract';\n      await fs.mkdir(tempDir, { recursive: true });\n      tempPath = path.join(\n        tempDir,\n        `${Date.now()}-${crypto.randomUUID()}-${req.file.originalname}`\n      );\n      await fs.writeFile(tempPath, req.file.buffer);\n\n      // Extract with advanced analysis enabled\n      const rawMetadata = await extractMetadataWithPython(\n        tempPath,\n        pythonTier,\n        true,\n        true, // Enable advanced analysis\n        req.query.store === 'true'\n      );\n\n      const processingMs = Date.now() - startTime;\n      rawMetadata.extraction_info.processing_ms = processingMs;\n\n      const metadata = transformMetadataForFrontend(\n        rawMetadata,\n        req.file.originalname,\n        normalizedTier\n      );\n\n      res.json({\n        ...metadata,\n        advanced_analysis: {\n          enabled: true,\n          modules_run: [\n            'steganography_detection',\n            'manipulation_detection',\n            'ai_detection',\n            'timeline_analysis',\n          ],\n        },\n      });\n    } catch (error) {\n      console.error('Advanced extraction error:', error);\n      res.status(500).json({\n        error: 'Advanced analysis failed',\n        details: error instanceof Error ? error.message : 'Unknown error',\n      });\n    } finally {\n      if (tempPath) {\n        try {\n          await fs.unlink(tempPath);\n        } catch (error) {\n          console.error('Failed to delete temp file:', error);\n        }\n      }\n    }\n  });\n\n  // Batch metadata comparison endpoint - with stricter rate limiting\n  app.post(\n    '/api/compare/batch',\n    rateLimitExtraction(),\n    upload.array('files', 10),\n    async (req, res) => {\n      const startTime = Date.now();\n      const tempPaths: string[] = [];\n\n      try {\n        if (!req.files || !Array.isArray(req.files) || req.files.length < 2) {\n          return res\n            .status(400)\n            .json({ error: 'At least 2 files required for comparison' });\n        }\n\n        const requestedTier = (req.query.tier as string) || 'enterprise';\n        const normalizedTier = normalizeTier(requestedTier);\n        const pythonTier = toPythonTier(normalizedTier);\n\n        // Check tier supports comparison (disabled in dev)\n        if (\n          process.env.NODE_ENV !== 'development' &&\n          !['professional', 'forensic', 'enterprise'].includes(normalizedTier)\n        ) {\n          return res.status(403).json({\n            error: 'Metadata comparison requires Professional or higher tier',\n            current_tier: normalizedTier,\n            required_tier: 'professional',\n          });\n        }\n\n        // Write files to temp\n        const tempDir = '/tmp/metaextract';\n        await fs.mkdir(tempDir, { recursive: true });\n\n        const fileInfos: Array<{ tempPath: string; originalName: string }> = [];\n        for (const file of req.files) {\n          const tempPath = path.join(\n            tempDir,\n            `${Date.now()}-${crypto.randomUUID()}-${file.originalname}`\n          );\n          await fs.writeFile(tempPath, file.buffer);\n          tempPaths.push(tempPath);\n          fileInfos.push({ tempPath, originalName: file.originalname });\n        }\n\n        // Extract metadata for all files\n        const metadataResults: Record<string, any> = {};\n        for (const fileInfo of fileInfos) {\n          const rawMetadata = await extractMetadataWithPython(\n            fileInfo.tempPath,\n            pythonTier,\n            false,\n            false,\n            false\n          );\n          metadataResults[fileInfo.originalName] = transformMetadataForFrontend(\n            rawMetadata,\n            fileInfo.originalName,\n            normalizedTier\n          );\n        }\n\n        // Compare metadata between files\n        const fileNames = Object.keys(metadataResults);\n        const comparisons: any[] = [];\n\n        for (let i = 0; i < fileNames.length; i++) {\n          for (let j = i + 1; j < fileNames.length; j++) {\n            const file1 = fileNames[i];\n            const file2 = fileNames[j];\n            const meta1 = metadataResults[file1];\n            const meta2 = metadataResults[file2];\n\n            const differences: any[] = [];\n            const allKeys = new Set([\n              ...Object.keys(meta1.exif || {}),\n              ...Object.keys(meta2.exif || {}),\n            ]);\n\n            let matchCount = 0;\n            let diffCount = 0;\n\n            for (const key of allKeys) {\n              const val1 = meta1.exif?.[key];\n              const val2 = meta2.exif?.[key];\n\n              if (val1 === val2) {\n                matchCount++;\n                differences.push({\n                  field: key,\n                  file1_value: val1,\n                  file2_value: val2,\n                  status: 'match',\n                });\n              } else if (val1 === undefined) {\n                diffCount++;\n                differences.push({\n                  field: key,\n                  file1_value: null,\n                  file2_value: val2,\n                  status: 'only_in_file2',\n                });\n              } else if (val2 === undefined) {\n                diffCount++;\n                differences.push({\n                  field: key,\n                  file1_value: val1,\n                  file2_value: null,\n                  status: 'only_in_file1',\n                });\n              } else {\n                diffCount++;\n                differences.push({\n                  field: key,\n                  file1_value: val1,\n                  file2_value: val2,\n                  status: 'different',\n                });\n              }\n            }\n\n            const totalFields = matchCount + diffCount;\n            const similarityScore =\n              totalFields > 0\n                ? Math.round((matchCount / totalFields) * 100)\n                : 0;\n\n            comparisons.push({\n              file1,\n              file2,\n              similarity_score: similarityScore,\n              matching_fields: matchCount,\n              different_fields: diffCount,\n              differences: differences.slice(0, 100), // Limit to prevent huge responses\n            });\n          }\n        }\n\n        res.json({\n          success: true,\n          files_compared: fileNames.length,\n          comparisons,\n          processing_time_ms: Date.now() - startTime,\n        });\n      } catch (error) {\n        console.error('Comparison error:', error);\n        res.status(500).json({\n          error: 'Comparison failed',\n          details: error instanceof Error ? error.message : 'Unknown error',\n        });\n      } finally {\n        for (const tempPath of tempPaths) {\n          try {\n            await fs.unlink(tempPath);\n          } catch (error) {\n            console.error('Failed to delete temp file:', error);\n          }\n        }\n      }\n    }\n  );\n\n  // Timeline reconstruction endpoint - with stricter rate limiting\n  app.post(\n    '/api/timeline/reconstruct',\n    rateLimitExtraction(),\n    upload.array('files', 50),\n    async (req, res) => {\n      const startTime = Date.now();\n      const tempPaths: string[] = [];\n\n      try {\n        if (!req.files || !Array.isArray(req.files) || req.files.length === 0) {\n          return res.status(400).json({ error: 'At least 1 file required' });\n        }\n\n        const requestedTier = (req.query.tier as string) || 'enterprise';\n        const normalizedTier = normalizeTier(requestedTier);\n        const pythonTier = toPythonTier(normalizedTier);\n\n        if (\n          process.env.NODE_ENV !== 'development' &&\n          !['professional', 'forensic', 'enterprise'].includes(normalizedTier)\n        ) {\n          return res.status(403).json({\n            error:\n              'Timeline reconstruction requires Professional or higher tier',\n            current_tier: normalizedTier,\n            required_tier: 'professional',\n          });\n        }\n\n        // Write files to temp\n        const tempDir = '/tmp/metaextract';\n        await fs.mkdir(tempDir, { recursive: true });\n\n        const allEvents: any[] = [];\n\n        for (const file of req.files) {\n          const tempPath = path.join(\n            tempDir,\n            `${Date.now()}-${crypto.randomUUID()}-${file.originalname}`\n          );\n          await fs.writeFile(tempPath, file.buffer);\n          tempPaths.push(tempPath);\n\n          const rawMetadata = await extractMetadataWithPython(\n            tempPath,\n            pythonTier,\n            false,\n            false,\n            false\n          );\n\n          // Extract timeline events from metadata\n          const metadata = transformMetadataForFrontend(\n            rawMetadata,\n            file.originalname,\n            normalizedTier\n          );\n\n          if (metadata.exif?.DateTimeOriginal) {\n            allEvents.push({\n              timestamp: metadata.exif.DateTimeOriginal,\n              event_type: 'capture',\n              source: 'EXIF:DateTimeOriginal',\n              file: file.originalname,\n            });\n          }\n          if (metadata.exif?.CreateDate) {\n            allEvents.push({\n              timestamp: metadata.exif.CreateDate,\n              event_type: 'created',\n              source: 'EXIF:CreateDate',\n              file: file.originalname,\n            });\n          }\n          if (metadata.exif?.ModifyDate) {\n            allEvents.push({\n              timestamp: metadata.exif.ModifyDate,\n              event_type: 'modified',\n              source: 'EXIF:ModifyDate',\n              file: file.originalname,\n            });\n          }\n          if (metadata.filesystem?.created) {\n            allEvents.push({\n              timestamp: metadata.filesystem.created,\n              event_type: 'file_created',\n              source: 'Filesystem',\n              file: file.originalname,\n            });\n          }\n          if (metadata.filesystem?.modified) {\n            allEvents.push({\n              timestamp: metadata.filesystem.modified,\n              event_type: 'file_modified',\n              source: 'Filesystem',\n              file: file.originalname,\n            });\n          }\n        }\n\n        // Sort events chronologically\n        allEvents.sort(\n          (a, b) =>\n            new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime()\n        );\n\n        // Detect gaps (events more than 24 hours apart)\n        const gaps: any[] = [];\n        for (let i = 0; i < allEvents.length - 1; i++) {\n          const current = new Date(allEvents[i].timestamp).getTime();\n          const next = new Date(allEvents[i + 1].timestamp).getTime();\n          const diffMs = next - current;\n          const diffHours = diffMs / (1000 * 60 * 60);\n\n          if (diffHours > 24) {\n            gaps.push({\n              start: allEvents[i].timestamp,\n              end: allEvents[i + 1].timestamp,\n              duration_hours: Math.round(diffHours),\n              duration_readable:\n                diffHours > 24\n                  ? `${Math.round(diffHours / 24)} days`\n                  : `${Math.round(diffHours)} hours`,\n              suspicious: diffHours > 168, // More than a week\n            });\n          }\n        }\n\n        res.json({\n          success: true,\n          files_analyzed: req.files.length,\n          events: allEvents,\n          gaps,\n          chain_of_custody_complete:\n            gaps.filter((g) => g.suspicious).length === 0,\n          first_event: allEvents[0] || null,\n          last_event: allEvents[allEvents.length - 1] || null,\n          processing_time_ms: Date.now() - startTime,\n        });\n      } catch (error) {\n        console.error('Timeline reconstruction error:', error);\n        res.status(500).json({\n          error: 'Timeline reconstruction failed',\n          details: error instanceof Error ? error.message : 'Unknown error',\n        });\n      } finally {\n        for (const tempPath of tempPaths) {\n          try {\n            await fs.unlink(tempPath);\n          } catch (error) {\n            console.error('Failed to delete temp file:', error);\n          }\n        }\n      }\n    }\n  );\n\n  // Performance monitoring endpoint\n  app.get('/api/performance/stats', async (req, res) => {\n    try {\n      // Get cache statistics if Redis is available\n      const currentDir = getCurrentDir();\n      const pythonScript = path.join(\n        currentDir,\n        'extractor',\n        'utils',\n        'cache.py'\n      );\n      const cacheStats = await new Promise<any>((resolve) => {\n        const python = spawn('python3', [\n          '-c',\n          `\nimport sys\nsys.path.append('${path.dirname(pythonScript)}')\nfrom cache import get_cache_stats\nimport json\nprint(json.dumps(get_cache_stats()))\n        `,\n        ]);\n\n        let stdout = '';\n        python.stdout.on('data', (data) => (stdout += data.toString()));\n        python.on('close', () => {\n          try {\n            resolve(JSON.parse(stdout));\n          } catch {\n            resolve({ available: false });\n          }\n        });\n\n        setTimeout(() => {\n          python.kill();\n          resolve({ available: false, error: 'timeout' });\n        }, 5000);\n      });\n\n      res.json({\n        cache: cacheStats,\n        server: {\n          uptime_seconds: process.uptime(),\n          memory_usage: process.memoryUsage(),\n          node_version: process.version,\n          platform: process.platform,\n        },\n        timestamp: new Date().toISOString(),\n      });\n    } catch (error) {\n      res.status(500).json({ error: 'Failed to get performance stats' });\n    }\n  });\n\n  // Cache management endpoint (admin only)\n  app.post('/api/performance/cache/clear', async (req, res) => {\n    try {\n      const pattern = req.body.pattern || 'metadata:*';\n\n      const currentDir = getCurrentDir();\n      const pythonScript = path.join(\n        currentDir,\n        'extractor',\n        'utils',\n        'cache.py'\n      );\n      const result = await new Promise<number>((resolve) => {\n        const python = spawn('python3', [\n          '-c',\n          `\nimport sys\nsys.path.append('${path.dirname(pythonScript)}')\nfrom cache import clear_cache_pattern\nprint(clear_cache_pattern('${pattern}'))\n        `,\n        ]);\n\n        let stdout = '';\n        python.stdout.on('data', (data) => (stdout += data.toString()));\n        python.on('close', () => {\n          resolve(parseInt(stdout.trim()) || 0);\n        });\n\n        setTimeout(() => {\n          python.kill();\n          resolve(0);\n        }, 10000);\n      });\n\n      res.json({\n        success: true,\n        cleared_entries: result,\n        pattern,\n      });\n    } catch (error) {\n      res.status(500).json({ error: 'Failed to clear cache' });\n    }\n  });\n\n  // Sample files endpoint for onboarding\n  app.get('/api/samples', (req, res) => {\n    const samples = [\n      {\n        id: 'sample_photo',\n        name: 'Standard Photo',\n        filename: 'sample_photo.jpg',\n        description: 'JPEG with basic EXIF data - perfect for beginners',\n        size: '2.3 MB',\n        type: 'image/jpeg',\n        highlights: ['Camera settings', 'Timestamp', 'Resolution'],\n        tier_required: 'free',\n      },\n      {\n        id: 'sample_gps',\n        name: 'GPS Photo',\n        filename: 'sample_gps.jpg',\n        description: 'Photo with embedded GPS coordinates',\n        size: '3.1 MB',\n        type: 'image/jpeg',\n        highlights: ['GPS coordinates', 'Google Maps link', 'Location data'],\n        tier_required: 'professional',\n      },\n      {\n        id: 'sample_raw',\n        name: 'Canon RAW',\n        filename: 'sample_raw.cr2',\n        description: 'Canon RAW file with extensive MakerNotes',\n        size: '24.5 MB',\n        type: 'image/x-canon-cr2',\n        highlights: ['Canon MakerNotes', 'Lens data', 'Camera serial'],\n        tier_required: 'professional',\n      },\n      {\n        id: 'sample_video',\n        name: 'Video Sample',\n        filename: 'sample_video.mp4',\n        description: 'MP4 video with codec and stream information',\n        size: '15.2 MB',\n        type: 'video/mp4',\n        highlights: ['Video codecs', 'Stream data', 'Duration'],\n        tier_required: 'forensic',\n      },\n      {\n        id: 'sample_audio',\n        name: 'Audio File',\n        filename: 'sample_audio.mp3',\n        description: 'MP3 with ID3 tags and album art',\n        size: '4.8 MB',\n        type: 'audio/mpeg',\n        highlights: ['ID3 tags', 'Album art', 'Audio quality'],\n        tier_required: 'forensic',\n      },\n      {\n        id: 'sample_pdf',\n        name: 'PDF Document',\n        filename: 'sample_document.pdf',\n        description: 'PDF with document metadata and form fields',\n        size: '1.2 MB',\n        type: 'application/pdf',\n        highlights: ['Document info', 'Page count', 'Creation software'],\n        tier_required: 'forensic',\n      },\n    ];\n\n    res.json({\n      samples,\n      total_count: samples.length,\n      description: 'Sample files for demonstrating MetaExtract capabilities',\n    });\n  });\n\n  // Sample file download endpoint - with public rate limiting\n  app.get('/api/samples/:sampleId/download', rateLimitPublic(), async (req, res) => {\n    try {\n      const sampleId = req.params.sampleId;\n      const currentDir = getCurrentDir();\n      const samplePath = path.join(\n        currentDir,\n        'sample-files',\n        `${sampleId}.bin`\n      );\n\n      // Check if sample file exists\n      try {\n        await fs.access(samplePath);\n      } catch {\n        return res.status(404).json({ error: 'Sample file not found' });\n      }\n\n      // Get sample info\n      const samples = [\n        {\n          id: 'sample_photo',\n          filename: 'sample_photo.jpg',\n          type: 'image/jpeg',\n        },\n        { id: 'sample_gps', filename: 'sample_gps.jpg', type: 'image/jpeg' },\n        {\n          id: 'sample_raw',\n          filename: 'sample_raw.cr2',\n          type: 'image/x-canon-cr2',\n        },\n        { id: 'sample_video', filename: 'sample_video.mp4', type: 'video/mp4' },\n        {\n          id: 'sample_audio',\n          filename: 'sample_audio.mp3',\n          type: 'audio/mpeg',\n        },\n        {\n          id: 'sample_pdf',\n          filename: 'sample_document.pdf',\n          type: 'application/pdf',\n        },\n      ];\n\n      const sample = samples.find((s) => s.id === sampleId);\n      if (!sample) {\n        return res.status(404).json({ error: 'Sample not found' });\n      }\n\n      res.setHeader('Content-Type', sample.type);\n      res.setHeader(\n        'Content-Disposition',\n        `attachment; filename=\"${sample.filename}\"`\n      );\n\n      const fileStream = require('fs').createReadStream(samplePath);\n      fileStream.pipe(res);\n    } catch (error) {\n      console.error('Sample download error:', error);\n      res.status(500).json({ error: 'Failed to download sample file' });\n    }\n  });\n\n  // ============================================================================\n  // Advanced Analysis Endpoints (Phase 3)\n  // ============================================================================\n\n  // Advanced single file analysis with forensic capabilities\n  app.post('/api/extract/advanced', upload.single('file'), async (req, res) => {\n    const startTime = Date.now();\n    let tempPath: string | null = null;\n\n    try {\n      if (!req.file) {\n        return res.status(400).json({ error: 'No file uploaded' });\n      }\n\n      const requestedTier = (req.query.tier as string) || 'enterprise';\n      const normalizedTier = normalizeTier(requestedTier);\n      const pythonTier = toPythonTier(normalizedTier);\n      const mimeType = req.file.mimetype || 'application/octet-stream';\n      const tierConfig = getTierConfig(normalizedTier);\n\n      // Advanced analysis requires Professional+ tier (disabled in dev)\n      if (process.env.NODE_ENV !== 'development' && normalizedTier === 'free') {\n        return res.status(403).json({\n          error: 'Advanced analysis not available for your plan',\n          current_tier: normalizedTier,\n          required_tier: 'professional',\n          upgrade_message:\n            'Upgrade to Professional or higher for advanced forensic analysis',\n        });\n      }\n\n      // Validate file type and size\n      if (!isFileTypeAllowed(normalizedTier, mimeType)) {\n        const requiredTier = getRequiredTierForFileType(mimeType);\n        return res.status(403).json({\n          error: 'File type not allowed for your plan',\n          file_type: mimeType,\n          current_tier: normalizedTier,\n          required_tier: requiredTier,\n        });\n      }\n\n      if (!isFileSizeAllowed(normalizedTier, req.file.size)) {\n        return res.status(403).json({\n          error: 'File size exceeds plan limit',\n          file_size_mb: Math.round((req.file.size / (1024 * 1024)) * 100) / 100,\n          max_size_mb: tierConfig.maxFileSizeMB,\n        });\n      }\n\n      // Write file to temp location\n      const tempDir = '/tmp/metaextract';\n      await fs.mkdir(tempDir, { recursive: true });\n      tempPath = path.join(\n        tempDir,\n        `${Date.now()}-${crypto.randomUUID()}-${req.file.originalname}`\n      );\n      await fs.writeFile(tempPath, req.file.buffer);\n\n      // Capture a non-null temp path for use inside async closures\n      const tempPathForPython = tempPath;\n      if (!tempPathForPython) {\n        throw new Error('Failed to create temp file for extraction');\n      }\n\n      // Run advanced analysis using comprehensive engine\n      const currentDir = getCurrentDir();\n      const pythonScript = path.join(\n        currentDir,\n        'extractor',\n        'comprehensive_metadata_engine.py'\n      );\n      const advancedResult = await new Promise<any>((resolve, reject) => {\n        const args: string[] = [\n          pythonScript,\n          tempPathForPython,\n          '--tier',\n          pythonTier,\n          '--advanced',\n          '--performance',\n        ];\n\n        if (req.query.store === 'true') {\n          args.push('--store');\n        }\n\n        const python = spawn('python3', args);\n        let stdout = '';\n        let stderr = '';\n\n        python.stdout.on('data', (data: Buffer) => {\n          stdout += data.toString();\n        });\n\n        python.stderr.on('data', (data: Buffer) => {\n          stderr += data.toString();\n        });\n\n        python.on('close', (code: number | null) => {\n          if (code !== 0) {\n            reject(new Error(`Advanced analysis failed: ${stderr}`));\n            return;\n          }\n\n          try {\n            resolve(JSON.parse(stdout));\n          } catch (e) {\n            reject(new Error('Failed to parse advanced analysis result'));\n          }\n        });\n\n        // Extended timeout for advanced analysis\n        setTimeout(() => {\n          python.kill();\n          reject(new Error('Advanced analysis timed out'));\n        }, 300000); // 5 minutes\n      });\n\n      const processingMs = Date.now() - startTime;\n      advancedResult.extraction_info.processing_ms = processingMs;\n\n      // Transform for frontend\n      const metadata = transformMetadataForFrontend(\n        advancedResult,\n        req.file.originalname,\n        normalizedTier\n      );\n\n      // Add advanced analysis summary\n      metadata.advanced_analysis = {\n        enabled: true,\n        processing_time_ms: processingMs,\n        modules_run: [],\n        forensic_score: 0,\n        authenticity_assessment: 'unknown',\n      };\n\n      // Extract advanced analysis results\n      if (advancedResult.steganography_analysis) {\n        metadata.advanced_analysis.modules_run.push('steganography');\n        metadata.steganography_analysis = advancedResult.steganography_analysis;\n      }\n\n      if (advancedResult.manipulation_detection) {\n        metadata.advanced_analysis.modules_run.push('manipulation_detection');\n        metadata.manipulation_detection = advancedResult.manipulation_detection;\n      }\n\n      if (advancedResult.ai_detection) {\n        metadata.advanced_analysis.modules_run.push('ai_detection');\n        metadata.ai_detection = advancedResult.ai_detection;\n      }\n\n      // Calculate overall forensic score\n      let forensicScore = 100;\n      if (metadata.steganography_analysis?.suspicious_score) {\n        forensicScore -= metadata.steganography_analysis.suspicious_score * 30;\n      }\n      if (metadata.manipulation_detection?.manipulation_probability) {\n        forensicScore -=\n          metadata.manipulation_detection.manipulation_probability * 50;\n      }\n      if (metadata.ai_detection?.ai_probability) {\n        forensicScore -= metadata.ai_detection.ai_probability * 20;\n      }\n\n      metadata.advanced_analysis.forensic_score = Math.max(\n        0,\n        Math.round(forensicScore)\n      );\n      metadata.advanced_analysis.authenticity_assessment =\n        forensicScore > 80\n          ? 'authentic'\n          : forensicScore > 50\n          ? 'questionable'\n          : 'suspicious';\n\n      res.json(metadata);\n    } catch (error) {\n      const processingMs = Date.now() - startTime;\n      console.error('Advanced analysis error:', error);\n\n      res.status(500).json({\n        error: 'Advanced analysis failed',\n        details: error instanceof Error ? error.message : 'Unknown error',\n        processing_time_ms: processingMs,\n      });\n    } finally {\n      if (tempPath) {\n        try {\n          await fs.unlink(tempPath);\n        } catch (error) {\n          console.error('Failed to delete temp file:', error);\n        }\n      }\n    }\n  });\n\n  // Batch metadata comparison endpoint\n  app.post(\n    '/api/compare/batch',\n    upload.array('files', 50),\n    async (req, res) => {\n      const startTime = Date.now();\n      const tempPaths: string[] = [];\n\n      try {\n        if (!req.files || !Array.isArray(req.files) || req.files.length < 2) {\n          return res.status(400).json({\n            error: 'At least 2 files required for comparison',\n          });\n        }\n\n        const requestedTier = (req.query.tier as string) || 'enterprise';\n        const normalizedTier = normalizeTier(requestedTier);\n        const tierConfig = getTierConfig(normalizedTier);\n\n        // Comparison requires Professional+ tier (disabled in dev)\n        if (\n          process.env.NODE_ENV !== 'development' &&\n          normalizedTier === 'free'\n        ) {\n          return res.status(403).json({\n            error: 'Batch comparison not available for your plan',\n            current_tier: normalizedTier,\n            required_tier: 'professional',\n          });\n        }\n\n        // Validate all files\n        for (const file of req.files) {\n          const mimeType = file.mimetype || 'application/octet-stream';\n          if (!isFileTypeAllowed(normalizedTier, mimeType)) {\n            return res.status(403).json({\n              error: `File type not allowed: ${file.originalname}`,\n              file_type: mimeType,\n            });\n          }\n          if (!isFileSizeAllowed(normalizedTier, file.size)) {\n            return res.status(403).json({\n              error: `File size exceeds limit: ${file.originalname}`,\n            });\n          }\n        }\n\n        // Write files to temp locations\n        const tempDir = '/tmp/metaextract';\n        await fs.mkdir(tempDir, { recursive: true });\n\n        const fileInfos: Array<{\n          tempPath: string;\n          originalName: string;\n          size: number;\n        }> = [];\n        for (const file of req.files) {\n          const tempPath = path.join(\n            tempDir,\n            `${Date.now()}-${crypto.randomUUID()}-${file.originalname}`\n          );\n          await fs.writeFile(tempPath, file.buffer);\n          tempPaths.push(tempPath);\n          fileInfos.push({\n            tempPath,\n            originalName: file.originalname,\n            size: file.size,\n          });\n        }\n\n        // Run comparison using Python module\n        const currentDir = getCurrentDir();\n        const pythonScript = path.join(\n          currentDir,\n          'extractor',\n          'modules',\n          'comparison.py'\n        );\n        const comparisonResult = await new Promise<any>((resolve, reject) => {\n          const python = spawn('python3', [\n            '-c',\n            `\nimport sys\nsys.path.append('${path.dirname(pythonScript)}')\nfrom comparison import compare_metadata_files\nfrom comprehensive_metadata_engine import extract_comprehensive_metadata\nimport json\n\n# Extract metadata for all files\nfile_metadata = []\nfilepaths = ${JSON.stringify(tempPaths)}\nfor filepath in filepaths:\n    try:\n        metadata = extract_comprehensive_metadata(filepath, tier='${toPythonTier(\n          normalizedTier\n        )}')\n        file_metadata.append(metadata)\n    except Exception as e:\n        print(f\"Error extracting {filepath}: {e}\", file=sys.stderr)\n\n# Compare metadata\nif len(file_metadata) >= 2:\n    comparison = compare_metadata_files(file_metadata, comparison_mode=\"detailed\")\n    print(json.dumps(comparison))\nelse:\n    print(json.dumps({\"error\": \"Insufficient metadata extracted\"}))\n          `,\n          ]);\n\n          let stdout = '';\n          let stderr = '';\n\n          python.stdout.on('data', (data) => {\n            stdout += data.toString();\n          });\n\n          python.stderr.on('data', (data) => {\n            stderr += data.toString();\n          });\n\n          python.on('close', (code) => {\n            if (code !== 0) {\n              reject(new Error(`Comparison failed: ${stderr}`));\n              return;\n            }\n\n            try {\n              resolve(JSON.parse(stdout));\n            } catch (e) {\n              reject(new Error('Failed to parse comparison result'));\n            }\n          });\n\n          setTimeout(() => {\n            python.kill();\n            reject(new Error('Comparison timed out'));\n          }, 120000); // 2 minutes\n        });\n\n        const processingMs = Date.now() - startTime;\n\n        res.json({\n          success: true,\n          comparison_id: crypto.randomUUID(),\n          total_files: fileInfos.length,\n          processing_time_ms: processingMs,\n          file_names: fileInfos.map((f) => f.originalName),\n          comparison_result: comparisonResult,\n        });\n      } catch (error) {\n        console.error('Batch comparison error:', error);\n        res.status(500).json({\n          error: 'Batch comparison failed',\n          details: error instanceof Error ? error.message : 'Unknown error',\n        });\n      } finally {\n        for (const tempPath of tempPaths) {\n          try {\n            await fs.unlink(tempPath);\n          } catch (error) {\n            console.error('Failed to delete temp file:', tempPath, error);\n          }\n        }\n      }\n    }\n  );\n\n  // Timeline reconstruction endpoint\n  app.post(\n    '/api/timeline/reconstruct',\n    upload.array('files', 100),\n    async (req, res) => {\n      const startTime = Date.now();\n      const tempPaths: string[] = [];\n\n      try {\n        if (!req.files || !Array.isArray(req.files) || req.files.length === 0) {\n          return res.status(400).json({\n            error: 'No files uploaded for timeline reconstruction',\n          });\n        }\n\n        const requestedTier = (req.query.tier as string) || 'enterprise';\n        const normalizedTier = normalizeTier(requestedTier);\n\n        // Timeline reconstruction requires Professional+ tier (disabled in dev)\n        if (\n          process.env.NODE_ENV !== 'development' &&\n          normalizedTier === 'free'\n        ) {\n          return res.status(403).json({\n            error: 'Timeline reconstruction not available for your plan',\n            current_tier: normalizedTier,\n            required_tier: 'professional',\n          });\n        }\n\n        // Write files to temp locations\n        const tempDir = '/tmp/metaextract';\n        await fs.mkdir(tempDir, { recursive: true });\n\n        const fileInfos: Array<{\n          tempPath: string;\n          originalName: string;\n          size: number;\n        }> = [];\n        for (const file of req.files) {\n          const tempPath = path.join(\n            tempDir,\n            `${Date.now()}-${crypto.randomUUID()}-${file.originalname}`\n          );\n          await fs.writeFile(tempPath, file.buffer);\n          tempPaths.push(tempPath);\n          fileInfos.push({\n            tempPath,\n            originalName: file.originalname,\n            size: file.size,\n          });\n        }\n\n        // Run timeline reconstruction\n        const currentDir = getCurrentDir();\n        const pythonScript = path.join(\n          currentDir,\n          'extractor',\n          'modules',\n          'timeline.py'\n        );\n        const timelineResult = await new Promise<any>((resolve, reject) => {\n          const python = spawn('python3', [\n            '-c',\n            `\nimport sys\nsys.path.append('${path.dirname(pythonScript)}')\nfrom timeline import reconstruct_timeline\nfrom comprehensive_metadata_engine import extract_comprehensive_metadata\nimport json\n\n# Extract metadata for all files\nfile_metadata = []\nfilepaths = ${JSON.stringify(tempPaths)}\nfor filepath in filepaths:\n    try:\n        metadata = extract_comprehensive_metadata(filepath, tier='${toPythonTier(\n          normalizedTier\n        )}')\n        file_metadata.append(metadata)\n    except Exception as e:\n        print(f\"Error extracting {filepath}: {e}\", file=sys.stderr)\n\n# Reconstruct timeline\nif file_metadata:\n    timeline = reconstruct_timeline(file_metadata, analysis_mode=\"comprehensive\")\n    print(json.dumps(timeline))\nelse:\n    print(json.dumps({\"error\": \"No metadata extracted\"}))\n          `,\n          ]);\n\n          let stdout = '';\n          let stderr = '';\n\n          python.stdout.on('data', (data) => {\n            stdout += data.toString();\n          });\n\n          python.stderr.on('data', (data) => {\n            stderr += data.toString();\n          });\n\n          python.on('close', (code) => {\n            if (code !== 0) {\n              reject(new Error(`Timeline reconstruction failed: ${stderr}`));\n              return;\n            }\n\n            try {\n              resolve(JSON.parse(stdout));\n            } catch (e) {\n              reject(new Error('Failed to parse timeline result'));\n            }\n          });\n\n          setTimeout(() => {\n            python.kill();\n            reject(new Error('Timeline reconstruction timed out'));\n          }, 180000); // 3 minutes\n        });\n\n        const processingMs = Date.now() - startTime;\n\n        res.json({\n          success: true,\n          timeline_id: crypto.randomUUID(),\n          total_files: fileInfos.length,\n          processing_time_ms: processingMs,\n          file_names: fileInfos.map((f) => f.originalName),\n          timeline: timelineResult,\n        });\n      } catch (error) {\n        console.error('Timeline reconstruction error:', error);\n        res.status(500).json({\n          error: 'Timeline reconstruction failed',\n          details: error instanceof Error ? error.message : 'Unknown error',\n        });\n      } finally {\n        for (const tempPath of tempPaths) {\n          try {\n            await fs.unlink(tempPath);\n          } catch (error) {\n            console.error('Failed to delete temp file:', tempPath, error);\n          }\n        }\n      }\n    }\n  );\n\n  // Comprehensive forensic report endpoint - with stricter rate limiting\n  app.post(\n    '/api/forensic/report',\n    rateLimitExtraction(),\n    upload.array('files', 100),\n    async (req, res) => {\n      const startTime = Date.now();\n      const tempPaths: string[] = [];\n\n      try {\n        if (!req.files || !Array.isArray(req.files) || req.files.length === 0) {\n          return res.status(400).json({\n            error: 'No files uploaded for forensic analysis',\n          });\n        }\n\n        const requestedTier = (req.query.tier as string) || 'enterprise';\n        const normalizedTier = normalizeTier(requestedTier);\n\n        // Forensic reports require Enterprise tier (disabled in dev)\n        if (\n          process.env.NODE_ENV !== 'development' &&\n          normalizedTier !== 'enterprise'\n        ) {\n          return res.status(403).json({\n            error: 'Forensic reports not available for your plan',\n            current_tier: normalizedTier,\n            required_tier: 'enterprise',\n            upgrade_message:\n              'Upgrade to Enterprise tier for professional forensic reports',\n          });\n        }\n\n        // Process files and generate comprehensive forensic report\n        const tempDir = '/tmp/metaextract';\n        await fs.mkdir(tempDir, { recursive: true });\n\n        const fileInfos: Array<{\n          tempPath: string;\n          originalName: string;\n          size: number;\n        }> = [];\n        for (const file of req.files) {\n          const tempPath = path.join(\n            tempDir,\n            `${Date.now()}-${crypto.randomUUID()}-${file.originalname}`\n          );\n          await fs.writeFile(tempPath, file.buffer);\n          tempPaths.push(tempPath);\n          fileInfos.push({\n            tempPath,\n            originalName: file.originalname,\n            size: file.size,\n          });\n        }\n\n        // Generate comprehensive forensic analysis\n        const reportResult = await new Promise<any>((resolve, reject) => {\n          const python = spawn('python3', [\n            '-c',\n            `\nimport sys\nimport json\nfrom datetime import datetime\nsys.path.append('${path.join(getCurrentDir(), 'extractor')}')\nfrom comprehensive_metadata_engine import extract_comprehensive_metadata\n\n# Generate forensic report\nfile_names = ${JSON.stringify(fileInfos.map((f) => f.originalName))}\nfile_sizes = ${JSON.stringify(fileInfos.map((f) => f.size))}\nfilepaths = ${JSON.stringify(tempPaths)}\n\nreport = {\n    \"report_id\": \"${crypto.randomUUID()}\",\n    \"generated_at\": datetime.now().isoformat(),\n    \"analyst\": \"MetaExtract Forensic Engine v4.0\",\n    \"case_summary\": {\n        \"total_files\": ${fileInfos.length},\n        \"file_names\": file_names,\n        \"analysis_scope\": \"Comprehensive forensic metadata analysis\"\n    },\n    \"files\": [],\n    \"cross_file_analysis\": {},\n    \"conclusions\": {},\n    \"recommendations\": []\n}\n\n# Analyze each file\nfor i, filepath in enumerate(filepaths):\n    try:\n        metadata = extract_comprehensive_metadata(filepath, tier='enterprise')\n        \n        file_analysis = {\n            \"file_name\": file_names[i],\n            \"file_size\": file_sizes[i],\n            \"metadata\": metadata,\n            \"forensic_findings\": [],\n            \"authenticity_score\": 100,\n            \"risk_level\": \"low\"\n        }\n        \n        # Analyze forensic indicators\n        if metadata.get('steganography_analysis', {}).get('suspicious_score', 0) > 0.3:\n            file_analysis[\"forensic_findings\"].append(\"Potential steganography detected\")\n            file_analysis[\"authenticity_score\"] -= 30\n            file_analysis[\"risk_level\"] = \"medium\"\n            \n        if metadata.get('manipulation_detection', {}).get('manipulation_probability', 0) > 0.5:\n            file_analysis[\"forensic_findings\"].append(\"Image manipulation indicators found\")\n            file_analysis[\"authenticity_score\"] -= 50\n            file_analysis[\"risk_level\"] = \"high\"\n            \n        if metadata.get('ai_detection', {}).get('ai_probability', 0) > 0.7:\n            file_analysis[\"forensic_findings\"].append(\"AI-generated content detected\")\n            file_analysis[\"authenticity_score\"] -= 20\n            \n        report[\"files\"].append(file_analysis)\n        \n    except Exception as e:\n        print(f\"Error analyzing {filepath}: {e}\", file=sys.stderr)\n\n# Generate conclusions\nhigh_risk_files = [f for f in report[\"files\"] if f[\"risk_level\"] == \"high\"]\nmedium_risk_files = [f for f in report[\"files\"] if f[\"risk_level\"] == \"medium\"]\n\nreport[\"conclusions\"] = {\n    \"overall_assessment\": \"high\" if high_risk_files else \"medium\" if medium_risk_files else \"low\",\n    \"files_analyzed\": len(report[\"files\"]),\n    \"high_risk_files\": len(high_risk_files),\n    \"medium_risk_files\": len(medium_risk_files),\n    \"average_authenticity_score\": sum(f[\"authenticity_score\"] for f in report[\"files\"]) / len(report[\"files\"]) if report[\"files\"] else 0\n}\n\nif high_risk_files:\n    report[\"recommendations\"].append(\"Immediate investigation recommended for high-risk files\")\nif medium_risk_files:\n    report[\"recommendations\"].append(\"Further analysis recommended for medium-risk files\")\nif not high_risk_files and not medium_risk_files:\n    report[\"recommendations\"].append(\"No significant forensic concerns detected\")\n\nprint(json.dumps(report))\n          `,\n          ]);\n\n          let stdout = '';\n          let stderr = '';\n\n          python.stdout.on('data', (data) => {\n            stdout += data.toString();\n          });\n\n          python.stderr.on('data', (data) => {\n            stderr += data.toString();\n          });\n\n          python.on('close', (code) => {\n            if (code !== 0) {\n              reject(new Error(`Forensic report generation failed: ${stderr}`));\n              return;\n            }\n\n            try {\n              resolve(JSON.parse(stdout));\n            } catch (e) {\n              reject(new Error('Failed to parse forensic report'));\n            }\n          });\n\n          setTimeout(() => {\n            python.kill();\n            reject(new Error('Forensic report generation timed out'));\n          }, 600000); // 10 minutes for comprehensive analysis\n        });\n\n        const processingMs = Date.now() - startTime;\n        reportResult.processing_time_ms = processingMs;\n\n        res.json(reportResult);\n      } catch (error) {\n        console.error('Forensic report error:', error);\n        res.status(500).json({\n          error: 'Forensic report generation failed',\n          details: error instanceof Error ? error.message : 'Unknown error',\n        });\n      } finally {\n        for (const tempPath of tempPaths) {\n          try {\n            await fs.unlink(tempPath);\n          } catch (error) {\n            console.error('Failed to delete temp file:', tempPath, error);\n          }\n        }\n      }\n    }\n  );\n\n  // Health check\n  app.get('/api/health', (req, res) => {\n    res.json({\n      status: 'ok',\n      service: 'MetaExtract API',\n      version: '2.0.0',\n      timestamp: new Date().toISOString(),\n    });\n  });\n\n  // Analytics endpoints (admin)\n  app.get('/api/admin/analytics', async (req, res) => {\n    try {\n      const summary = await storage.getAnalyticsSummary();\n      res.json(summary);\n    } catch (error) {\n      console.error('Analytics error:', error);\n      res.status(500).json({ error: 'Failed to fetch analytics' });\n    }\n  });\n\n  app.get('/api/admin/extractions', async (req, res) => {\n    try {\n      const limit = parseInt(req.query.limit as string) || 50;\n      const extractions = await storage.getRecentExtractions(limit);\n      res.json(extractions);\n    } catch (error) {\n      console.error('Extractions history error:', error);\n      res.status(500).json({ error: 'Failed to fetch extractions' });\n    }\n  });\n\n  // Monitoring and health endpoints\n  app.get('/api/monitoring/status', async (req, res) => {\n    try {\n      // Call the Python monitoring module\n      const { spawn } = require('child_process');\n      const path = require('path');\n      const currentDir = path.dirname(\n        require.main ? require.main.filename : __filename\n      );\n\n      const pythonScript = path.join(currentDir, 'extractor', 'monitoring.py');\n      const result = await new Promise<any>((resolve, reject) => {\n        const python = spawn('python3', [\n          '-c',\n          `\nimport sys\nimport os\nsys.path.append(os.path.join(os.path.dirname('${pythonScript}')))\nfrom monitoring import get_monitoring_data\nimport json\nprint(json.dumps(get_monitoring_data()))\n          `,\n        ]);\n\n        let stdout = '';\n        let stderr = '';\n\n        python.stdout.on('data', (data: Buffer) => {\n          stdout += data.toString();\n        });\n\n        python.stderr.on('data', (data: Buffer) => {\n          stderr += data.toString();\n        });\n\n        python.on('close', (code: number | null) => {\n          if (code !== 0) {\n            console.error('Monitoring data error:', stderr);\n            reject(new Error('Failed to get monitoring data'));\n            return;\n          }\n          try {\n            resolve(JSON.parse(stdout));\n          } catch (e) {\n            reject(new Error('Failed to parse monitoring data'));\n          }\n        });\n\n        setTimeout(() => {\n          python.kill();\n          reject(new Error('Monitoring data request timed out'));\n        }, 10000);\n      });\n\n      res.json(result);\n    } catch (error) {\n      console.error('Monitoring status error:', error);\n      res.status(500).json({\n        error: 'Failed to get monitoring status',\n        details: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  });\n\n  app.get('/api/monitoring/performance', async (req, res) => {\n    try {\n      // Call the Python monitoring module\n      const { spawn } = require('child_process');\n      const path = require('path');\n      const currentDir = path.dirname(\n        require.main ? require.main.filename : __filename\n      );\n\n      const pythonScript = path.join(currentDir, 'extractor', 'monitoring.py');\n      const result = await new Promise<any>((resolve, reject) => {\n        const python = spawn('python3', [\n          '-c',\n          `\nimport sys\nimport os\nsys.path.append(os.path.join(os.path.dirname('${pythonScript}')))\nfrom monitoring import get_performance_summary\nimport json\nprint(json.dumps(get_performance_summary()))\n          `,\n        ]);\n\n        let stdout = '';\n        let stderr = '';\n\n        python.stdout.on('data', (data: Buffer) => {\n          stdout += data.toString();\n        });\n\n        python.stderr.on('data', (data: Buffer) => {\n          stderr += data.toString();\n        });\n\n        python.on('close', (code: number | null) => {\n          if (code !== 0) {\n            console.error('Performance data error:', stderr);\n            reject(new Error('Failed to get performance data'));\n            return;\n          }\n          try {\n            resolve(JSON.parse(stdout));\n          } catch (e) {\n            reject(new Error('Failed to parse performance data'));\n          }\n        });\n\n        setTimeout(() => {\n          python.kill();\n          reject(new Error('Performance data request timed out'));\n        }, 10000);\n      });\n\n      res.json(result);\n    } catch (error) {\n      console.error('Performance monitoring error:', error);\n      res.status(500).json({\n        error: 'Failed to get performance data',\n        details: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  });\n\n  app.get('/api/monitoring/errors', async (req, res) => {\n    try {\n      // Call the Python monitoring module\n      const { spawn } = require('child_process');\n      const path = require('path');\n      const currentDir = path.dirname(\n        require.main ? require.main.filename : __filename\n      );\n\n      const pythonScript = path.join(currentDir, 'extractor', 'monitoring.py');\n      const result = await new Promise<any>((resolve, reject) => {\n        const python = spawn('python3', [\n          '-c',\n          `\nimport sys\nimport os\nsys.path.append(os.path.join(os.path.dirname('${pythonScript}')))\nfrom monitoring import get_error_summary\nimport json\nprint(json.dumps(get_error_summary()))\n          `,\n        ]);\n\n        let stdout = '';\n        let stderr = '';\n\n        python.stdout.on('data', (data: Buffer) => {\n          stdout += data.toString();\n        });\n\n        python.stderr.on('data', (data: Buffer) => {\n          stderr += data.toString();\n        });\n\n        python.on('close', (code: number | null) => {\n          if (code !== 0) {\n            console.error('Error data error:', stderr);\n            reject(new Error('Failed to get error data'));\n            return;\n          }\n          try {\n            resolve(JSON.parse(stdout));\n          } catch (e) {\n            reject(new Error('Failed to parse error data'));\n          }\n        });\n\n        setTimeout(() => {\n          python.kill();\n          reject(new Error('Error data request timed out'));\n        }, 10000);\n      });\n\n      res.json(result);\n    } catch (error) {\n      console.error('Error monitoring error:', error);\n      res.status(500).json({\n        error: 'Failed to get error data',\n        details: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  });\n\n  // Register payment routes\n  registerPaymentRoutes(app);\n\n  // Register forensic routes\n  registerForensicRoutes(app);\n\n  return httpServer;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/security-utils.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'NextFunction' is defined but never used.","line":6,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":41},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":350,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":350,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8471,8474],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8471,8474],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CSRFEntry' is defined but never used.","line":376,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":376,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'maxAttempts' is assigned a value but never used. Allowed unused args must match /^_/u.","line":563,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":563,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * MetaExtract Security Utilities\n * Centralized security functions used across the application\n */\n\nimport { Request, Response, NextFunction } from 'express';\nimport crypto from 'crypto';\nimport path from 'path';\n\n// ============================================================================\n// IP Address Validation and Extraction\n// ============================================================================\n\n/**\n * Get the real client IP address, properly handling proxy headers\n * Only trusts X-Forwarded-For if the request comes from a known proxy\n */\nexport function getClientIP(req: Request): string {\n  const trustedProxies = [\n    '127.0.0.1',\n    '::1',\n    '10.0.0.0/8',\n    '172.16.0.0/12',\n    '192.168.0.0/16',\n  ];\n\n  const forwardedFor = req.headers['x-forwarded-for'];\n  const remoteAddress = req.socket.remoteAddress || req.ip || 'unknown';\n\n  // If behind a trusted proxy, use X-Forwarded-For\n  if (forwardedFor && isTrustedProxy(remoteAddress, trustedProxies)) {\n    // X-Forwarded-For can be comma-separated, take the first (original client)\n    const ips = Array.isArray(forwardedFor)\n      ? forwardedFor\n      : forwardedFor.split(',').map(ip => ip.trim());\n    return ips[0];\n  }\n\n  return remoteAddress;\n}\n\n/**\n * Check if the request comes from a trusted proxy\n */\nfunction isTrustedProxy(\n  remoteAddress: string,\n  trustedProxies: string[]\n): boolean {\n  for (const proxy of trustedProxies) {\n    if (proxy.includes('/')) {\n      // CIDR notation\n      if (isIPInCIDR(remoteAddress, proxy)) {\n        return true;\n      }\n    } else if (remoteAddress === proxy) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Check if an IP is within a CIDR range\n */\nfunction isIPInCIDR(ip: string, cidr: string): boolean {\n  const [range, bits] = cidr.split('/');\n  const mask = ~(2 ** (32 - parseInt(bits)) - 1);\n\n  const ipNum = ipToNumber(ip);\n  const rangeNum = ipToNumber(range);\n\n  return (ipNum & mask) === (rangeNum & mask);\n}\n\nfunction ipToNumber(ip: string): number {\n  const parts = ip.split('.').map(Number);\n  return (parts[0] << 24) | (parts[1] << 16) | (parts[2] << 8) | parts[3];\n}\n\n// ============================================================================\n// Request Sanitization\n// ============================================================================\n\n/**\n * Sanitize string input to prevent injection attacks\n */\nexport function sanitizeString(\n  input: string,\n  maxLength: number = 1000\n): string {\n  // Remove null bytes and control characters\n  // Use a safer approach with individual character replacements\n  let sanitized = input;\n\n  // Remove common control characters\n  const controlChars = [\n    '\\x00',\n    '\\x01',\n    '\\x02',\n    '\\x03',\n    '\\x04',\n    '\\x05',\n    '\\x06',\n    '\\x07',\n    '\\x08',\n  ];\n  const otherControlChars = [\n    '\\x0B',\n    '\\x0C',\n    '\\x0E',\n    '\\x0F',\n    '\\x10',\n    '\\x11',\n    '\\x12',\n    '\\x13',\n    '\\x14',\n    '\\x15',\n    '\\x16',\n    '\\x17',\n    '\\x18',\n    '\\x19',\n    '\\x1A',\n    '\\x1B',\n    '\\x1C',\n    '\\x1D',\n    '\\x1E',\n    '\\x1F',\n    '\\x7F',\n  ];\n  const allControlChars = [...controlChars, ...otherControlChars];\n\n  for (const char of allControlChars) {\n    sanitized = sanitized.split(char).join('');\n  }\n\n  // Limit length\n  if (sanitized.length > maxLength) {\n    sanitized = sanitized.substring(0, maxLength);\n  }\n\n  return sanitized;\n}\n\n/**\n * Validate that a string is safe for use as a filename\n */\nexport function sanitizeFilename(filename: string): string {\n  // Remove path separators and dangerous characters\n  const dangerousChars = ['<', '>', ':', '\"', '/', '\\\\', '|', '?', '*'];\n  const controlChars = [\n    '\\x00',\n    '\\x01',\n    '\\x02',\n    '\\x03',\n    '\\x04',\n    '\\x05',\n    '\\x06',\n    '\\x07',\n    '\\x08',\n    '\\x0B',\n    '\\x0C',\n    '\\x0E',\n    '\\x0F',\n    '\\x10',\n    '\\x11',\n    '\\x12',\n    '\\x13',\n    '\\x14',\n    '\\x15',\n    '\\x16',\n    '\\x17',\n    '\\x18',\n    '\\x19',\n    '\\x1A',\n    '\\x1B',\n    '\\x1C',\n    '\\x1D',\n    '\\x1E',\n    '\\x1F',\n  ];\n  let sanitized = filename;\n\n  for (const char of [...dangerousChars, ...controlChars]) {\n    sanitized = sanitized.split(char).join('_');\n  }\n\n  // Remove leading/trailing dots and spaces\n  sanitized = sanitized.trim().replace(/^\\.+|\\.+$/g, '');\n\n  // Limit length\n  if (sanitized.length > 255) {\n    const ext = filename.includes('.')\n      ? filename.slice(filename.lastIndexOf('.'))\n      : '';\n    sanitized = sanitized.slice(0, 250) + ext;\n  }\n\n  return sanitized || 'file';\n}\n\n/**\n * Validate file path is within allowed directories\n */\nexport function isPathSafe(filePath: string, allowedDirs: string[]): boolean {\n  try {\n    const resolved = path.resolve(filePath);\n    for (const dir of allowedDirs) {\n      const allowed = path.resolve(dir);\n      if (resolved.startsWith(allowed + path.sep)) {\n        return true;\n      }\n    }\n    return false;\n  } catch {\n    return false;\n  }\n}\n\n// ============================================================================\n// Rate Limiting Storage (In-memory for single instance)\n// ============================================================================\n\ninterface RateLimitEntry {\n  count: number;\n  resetTime: number;\n}\n\nconst rateLimitStore = new Map<string, RateLimitEntry>();\n\n/**\n * Check if request should be rate limited\n * Returns true if over limit, false if allowed\n */\nexport function checkRateLimit(\n  key: string,\n  maxRequests: number,\n  windowMs: number\n): { allowed: boolean; remaining: number; resetTime: number } {\n  const now = Date.now();\n\n  let entry = rateLimitStore.get(key);\n\n  if (!entry || now > entry.resetTime) {\n    entry = { count: 1, resetTime: now + windowMs };\n    rateLimitStore.set(key, entry);\n    return {\n      allowed: true,\n      remaining: maxRequests - 1,\n      resetTime: entry.resetTime,\n    };\n  }\n\n  if (entry.count >= maxRequests) {\n    return { allowed: false, remaining: 0, resetTime: entry.resetTime };\n  }\n\n  entry.count++;\n  return {\n    allowed: true,\n    remaining: maxRequests - entry.count,\n    resetTime: entry.resetTime,\n  };\n}\n\n/**\n * Clean up expired rate limit entries\n */\nexport function cleanupRateLimitStore(): void {\n  const now = Date.now();\n  for (const [key, entry] of rateLimitStore.entries()) {\n    if (now > entry.resetTime) {\n      rateLimitStore.delete(key);\n    }\n  }\n}\n\n// ============================================================================\n// Security Headers\n// ============================================================================\n\n/**\n * Security headers to include in all responses\n */\nconst IS_DEV = process.env.NODE_ENV !== 'production';\nconst DEV_HTTP_ORIGINS = [\n  'http://localhost:3000',\n  'http://127.0.0.1:3000',\n  'http://localhost:5173',\n  'http://127.0.0.1:5173',\n  'http://localhost:5174',\n  'http://127.0.0.1:5174',\n  'http://localhost:5175',\n  'http://127.0.0.1:5175',\n];\nconst VITE_DEV_WS = [\n  'ws://localhost:3000',\n  'ws://127.0.0.1:3000',\n  'ws://localhost:5173',\n  'ws://127.0.0.1:5173',\n  'ws://localhost:5174',\n  'ws://127.0.0.1:5174',\n  'ws://localhost:5175',\n  'ws://127.0.0.1:5175',\n];\n\nfunction buildCsp(isDevLike: boolean): string {\n  const scriptSrcValue = isDevLike\n    ? \"'self' 'unsafe-inline' 'unsafe-eval' blob:\"\n    : \"'self'\";\n  const scriptSrc = `script-src ${scriptSrcValue}`;\n  const scriptSrcElem = `script-src-elem ${scriptSrcValue}`;\n\n  const styleSrcValue = \"'self' 'unsafe-inline' https://fonts.googleapis.com\";\n  const styleSrc = `style-src ${styleSrcValue}`;\n  const styleSrcElem = `style-src-elem ${styleSrcValue}`;\n\n  const connectSrc = isDevLike\n    ? `connect-src 'self' ${DEV_HTTP_ORIGINS.join(' ')} ${VITE_DEV_WS.join(' ')}`\n    : \"connect-src 'self'\";\n\n  return [\n    \"default-src 'self'\",\n    scriptSrc,\n    scriptSrcElem,\n    styleSrc,\n    styleSrcElem,\n    \"img-src 'self' data: https:\",\n    \"font-src 'self' https://fonts.gstatic.com\",\n    connectSrc,\n    \"frame-ancestors 'none'\",\n    \"worker-src 'self' blob:\",\n  ].join('; ');\n}\n\nexport const SECURITY_HEADERS = {\n  'X-Content-Type-Options': 'nosniff',\n  'X-Frame-Options': 'DENY',\n  'X-XSS-Protection': '1; mode=block',\n  'Strict-Transport-Security': 'max-age=31536000; includeSubDomains',\n  // Content-Security-Policy is set dynamically in applySecurityHeaders()\n  'Referrer-Policy': 'strict-origin-when-cross-origin',\n  'Permissions-Policy': 'geolocation=(), microphone=(), camera=()',\n};\n\n/**\n * Apply security headers to response\n */\nexport function applySecurityHeaders(\n  res: Response,\n  req?: { headers?: any }\n): void {\n  for (const [header, value] of Object.entries(SECURITY_HEADERS)) {\n    res.setHeader(header, value);\n  }\n\n  // CSP needs to adapt for local dev (Vite injects inline module scripts and uses WS)\n  const hostHeader =\n    typeof req?.headers?.host === 'string' ? req.headers.host : '';\n  const isLocalhost =\n    hostHeader.startsWith('localhost') ||\n    hostHeader.startsWith('127.0.0.1') ||\n    hostHeader.startsWith('0.0.0.0');\n\n  const isDevLike = IS_DEV || isLocalhost;\n  const csp = buildCsp(isDevLike);\n  res.setHeader('Content-Security-Policy', csp);\n}\n\n// ============================================================================\n// CSRF Token Generation and Validation\n// ============================================================================\n\nconst CSRF_SECRET = process.env.CSRF_SECRET || crypto.randomUUID();\nconst CSRF_TOKEN_EXPIRY_MS = 60 * 60 * 1000; // 1 hour\n\ninterface CSRFEntry {\n  token: string;\n  expiresAt: number;\n}\n\n/**\n * Generate a CSRF token for a user session (enhanced version)\n */\nexport function generateCSRFToken(): string {\n  const token = crypto.randomBytes(32).toString('hex');\n  const expiresAt = Date.now() + CSRF_TOKEN_EXPIRY_MS;\n  return `${token}.${expiresAt}`;\n}\n\n/**\n * Generate a CSRF token for a specific user (enhanced security)\n */\nexport function generateUserCSRFToken(userId: string): string {\n  const token = crypto.randomBytes(32).toString('hex');\n  const expiresAt = Date.now() + CSRF_TOKEN_EXPIRY_MS;\n\n  // Create HMAC signature with user ID\n  const hmac = crypto.createHmac('sha256', CSRF_SECRET);\n  const dataToSign = [token, userId, expiresAt.toString()].join('.');\n  hmac.update(dataToSign);\n  const signature = hmac.digest('hex');\n\n  return [token, userId, expiresAt.toString(), signature].join('.');\n}\n\n/**\n * Validate a CSRF token\n */\nexport function validateCSRFToken(token: string): boolean {\n  try {\n    const [tokenValue, expiresAt] = token.split('.');\n    if (!tokenValue || !expiresAt) return false;\n\n    const expiry = parseInt(expiresAt, 10);\n    if (isNaN(expiry) || Date.now() > expiry) return false;\n\n    // Token format validation\n    if (tokenValue.length !== 64) return false;\n\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Validate a user-specific CSRF token\n */\nexport function validateUserCSRFToken(token: string, userId: string): boolean {\n  try {\n    const parts = token.split('.');\n    if (parts.length !== 4) return false;\n\n    const tokenValue = parts[0];\n    const tokenUserId = parts[1];\n    const expiresAt = parts[2];\n    const signature = parts[3];\n\n    if (!tokenValue || !tokenUserId || !expiresAt || !signature) return false;\n\n    // Verify user ID matches\n    if (tokenUserId !== userId) return false;\n\n    // Check expiry\n    const expiry = parseInt(expiresAt, 10);\n    if (isNaN(expiry) || Date.now() > expiry) return false;\n\n    // Verify HMAC signature\n    const hmac = crypto.createHmac('sha256', CSRF_SECRET);\n    const dataToVerify = tokenValue + '.' + userId + '.' + expiresAt;\n    hmac.update(dataToVerify);\n    const expectedSignature = hmac.digest('hex');\n\n    if (signature !== expectedSignature) return false;\n\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n// ============================================================================\n// Secure Random Generation\n// ============================================================================\n\n/**\n * Generate a cryptographically secure random string\n */\nexport function secureRandom(length: number = 32): string {\n  return crypto.randomBytes(length).toString('hex');\n}\n\n/**\n * Generate a secure confirmation code (numeric)\n */\nexport function secureConfirmationCode(length: number = 6): string {\n  const digits = '0123456789';\n  let code = '';\n  const randomBytes = crypto.randomBytes(length);\n  for (let i = 0; i < length; i++) {\n    code += digits[randomBytes[i] % 10];\n  }\n  return code;\n}\n\n// ============================================================================\n// Error Message Sanitization\n// ============================================================================\n\n/**\n * Sanitize error messages to prevent information disclosure\n */\nexport function sanitizeErrorMessage(\n  error: unknown,\n  context: 'production' | 'development'\n): string {\n  const message = error instanceof Error ? error.message : String(error);\n\n  if (context === 'production') {\n    // Remove potential sensitive information\n    return message\n      .replace(/password[:\\s]*\\S+/gi, 'password: [REDACTED]')\n      .replace(/token[:\\s]*\\S+/gi, 'token: [REDACTED]')\n      .replace(/key[:\\s]*\\S+/gi, 'key: [REDACTED]')\n      .replace(/secret[:\\s]*\\S+/gi, 'secret: [REDACTED]')\n      .replace(/Bearer\\s+\\S+/gi, 'Bearer [REDACTED]')\n      .replace(/authorization[:\\s]*\\S+/gi, 'authorization: [REDACTED]')\n      .replace(\n        /(?:DATABASE_URL|JWT_SECRET|TOKEN_SECRET)[^\\s]*/gi,\n        '[REDACTED]'\n      );\n  }\n\n  return message;\n}\n\n// ============================================================================\n// Brute Force Protection\n// ============================================================================\n\ninterface BruteForceEntry {\n  attempts: number;\n  resetTime: number;\n}\n\nconst bruteForceStore = new Map<string, BruteForceEntry>();\n\n/**\n * Check if an identifier is locked out due to too many failed attempts\n */\nexport function isLockedOut(\n  identifier: string,\n  maxAttempts: number = 5,\n  lockoutMs: number = 15 * 60 * 1000 // 15 minutes\n): { locked: boolean; remainingAttempts: number; resetTime: number } {\n  const now = Date.now();\n  const entry = bruteForceStore.get(identifier);\n\n  if (!entry || now > entry.resetTime) {\n    return {\n      locked: false,\n      remainingAttempts: maxAttempts,\n      resetTime: now + lockoutMs,\n    };\n  }\n\n  if (entry.attempts >= maxAttempts) {\n    return { locked: true, remainingAttempts: 0, resetTime: entry.resetTime };\n  }\n\n  return {\n    locked: false,\n    remainingAttempts: maxAttempts - entry.attempts,\n    resetTime: entry.resetTime,\n  };\n}\n\n/**\n * Record a failed attempt\n */\nexport function recordFailedAttempt(\n  identifier: string,\n  maxAttempts: number = 5,\n  lockoutMs: number = 15 * 60 * 1000\n): void {\n  const now = Date.now();\n  const entry = bruteForceStore.get(identifier);\n\n  if (!entry || now > entry.resetTime) {\n    bruteForceStore.set(identifier, {\n      attempts: 1,\n      resetTime: now + lockoutMs,\n    });\n  } else {\n    entry.attempts++;\n  }\n}\n\n/**\n * Clear failed attempts on successful login\n */\nexport function clearFailedAttempts(identifier: string): void {\n  bruteForceStore.delete(identifier);\n}\n\n// ============================================================================\n// Enhanced CSRF Protection\n// ============================================================================\n\n// ============================================================================\n// PII Redaction for Logging\n// ============================================================================\n\n/**\n * Redact PII from objects before logging\n */\nexport function redactPII(\n  obj: Record<string, unknown>\n): Record<string, unknown> {\n  const sensitiveFields = [\n    'password',\n    'email',\n    'token',\n    'secret',\n    'key',\n    'creditCard',\n    'ssn',\n    'socialSecurity',\n    'phone',\n    'address',\n    'birthDate',\n  ];\n\n  const result: Record<string, unknown> = {};\n\n  for (const [key, value] of Object.entries(obj)) {\n    const lowerKey = key.toLowerCase();\n\n    if (sensitiveFields.some(field => lowerKey.includes(field))) {\n      result[key] = '[REDACTED]';\n    } else if (typeof value === 'object' && value !== null) {\n      result[key] = redactPII(value as Record<string, unknown>);\n    } else {\n      result[key] = value;\n    }\n  }\n\n  return result;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/startup-cleanup.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'os' is defined but never used.","line":12,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":10},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3057,3060],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3057,3060],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":167,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":167,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":318,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":318,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9818,9821],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9818,9821],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Temp File Cleanup System\n *\n * Prevents accumulation of orphaned temp files from crashed processes.\n * Cleans up files from both extraction endpoints:\n * - `/tmp/metaextract` (legacy route)\n * - `/tmp/metaextract-uploads` (MVP route)\n */\n\nimport fs from 'fs/promises';\nimport path from 'path';\nimport os from 'os';\n\n// Configuration - allow override for testing\nexport function getTempDirs(): string[] {\n  return process.env.CLEANUP_TEMP_DIRS\n    ? process.env.CLEANUP_TEMP_DIRS.split(',')\n    : ['/tmp/metaextract', '/tmp/metaextract-uploads'];\n}\n\nconst MAX_FILE_AGE_MS = 60 * 60 * 1000; // 1 hour\nconst MAX_TOTAL_SIZE_BYTES = 10 * 1024 * 1024 * 1024; // 10GB\nconst MAX_FILE_COUNT = 1000;\n\n// Runtime getters to allow test-time overrides via env\nexport function getMaxTotalSizeBytes(): number {\n  return process.env.CLEANUP_MAX_TOTAL_SIZE_BYTES\n    ? parseInt(process.env.CLEANUP_MAX_TOTAL_SIZE_BYTES, 10)\n    : MAX_TOTAL_SIZE_BYTES;\n}\n\nexport function getMaxFileCount(): number {\n  return process.env.CLEANUP_MAX_FILE_COUNT\n    ? parseInt(process.env.CLEANUP_MAX_FILE_COUNT, 10)\n    : MAX_FILE_COUNT;\n}\n\nexport interface CleanupResult {\n  directory: string;\n  filesRemoved: number;\n  spaceFreed: number;\n  errors: string[];\n  duration: number;\n}\n\nexport interface CleanupSummary {\n  totalFilesRemoved: number;\n  totalSpaceFreed: number;\n  totalDuration: number;\n  directories: CleanupResult[];\n  warnings: string[];\n  errors: string[];\n}\n\n/**\n * Clean up orphaned temp files from a single directory\n */\nasync function cleanupDirectory(dirPath: string): Promise<CleanupResult> {\n  const startTime = Date.now();\n  const result: CleanupResult = {\n    directory: dirPath,\n    filesRemoved: 0,\n    spaceFreed: 0,\n    errors: [],\n    duration: 0,\n  };\n\n  try {\n    // Ensure directory exists and secure perms\n    await fs.mkdir(dirPath, { recursive: true, mode: 0o700 });\n\n    const files = await fs.readdir(dirPath);\n    console.log(`[Cleanup] Found ${files.length} files in ${dirPath}`);\n\n    const now = Date.now();\n    const cutoffTime = now - MAX_FILE_AGE_MS;\n    console.log(`[Cleanup] Cutoff time: ${new Date(cutoffTime).toISOString()}`);\n\n    for (const file of files) {\n      const filePath = path.join(dirPath, file);\n\n      try {\n        const stats = await fs.stat(filePath);\n        console.log(`[Cleanup] Processing: ${file}`);\n        console.log(\n          `[Cleanup] - mtime: ${new Date(stats.mtimeMs).toISOString()}`\n        );\n        console.log(\n          `[Cleanup] - cutoff: ${new Date(cutoffTime).toISOString()}`\n        );\n        console.log(`[Cleanup] - isOld: ${stats.mtimeMs < cutoffTime}`);\n\n        // Remove files older than 1 hour\n        if (stats.mtimeMs < cutoffTime) {\n          console.log(`[Cleanup] Removing old file: ${file}`);\n          try {\n            await fs.unlink(filePath);\n            result.filesRemoved++;\n            result.spaceFreed += stats.size;\n            console.log(\n              `[Cleanup] Removed: ${file} (${Math.round(stats.size / 1024)}KB)`\n            );\n          } catch (unlinkErr: any) {\n            // If file is busy/locked or permission issue, try to rename to a quarantine marker for later removal\n            const code = unlinkErr && unlinkErr.code ? unlinkErr.code : '';\n            const quarantined = `${filePath}.quarantine-${Date.now()}`;\n            if (['EBUSY', 'EPERM', 'EACCES', 'ENOTEMPTY'].includes(code)) {\n              try {\n                await fs.rename(filePath, quarantined);\n                result.filesRemoved++;\n                // size unknown now; ignore for space accounting\n                result.errors.push(\n                  `File ${filePath} was locked; renamed to ${quarantined} for later cleanup`\n                );\n                console.warn(\n                  `[Cleanup] Renamed locked file to ${quarantined}`\n                );\n              } catch (renameErr) {\n                const errorMsg = `Failed to unlink or rename ${filePath}: ${renameErr}`;\n                result.errors.push(errorMsg);\n                console.warn(`[Cleanup] ${errorMsg}`);\n              }\n            } else {\n              const errorMsg = `Could not delete ${filePath}: ${unlinkErr}`;\n              result.errors.push(errorMsg);\n              console.warn(`[Cleanup] ${errorMsg}`);\n            }\n          }\n        } else {\n          console.log(`[Cleanup] Preserving recent file: ${file}`);\n        }\n      } catch (fileError) {\n        const errorMsg = `Could not process ${file}: ${fileError}`;\n        result.errors.push(errorMsg);\n        console.warn(`[Cleanup] ${errorMsg}`);\n      }\n    }\n  } catch (dirError) {\n    const errorMsg = `Could not clean directory ${dirPath}: ${dirError}`;\n    result.errors.push(errorMsg);\n    console.error(`[Cleanup] ${errorMsg}`);\n  }\n\n  result.duration = Date.now() - startTime;\n  console.log(\n    `[Cleanup] Directory ${dirPath} cleanup completed in ${result.duration}ms`\n  );\n  return result;\n}\n\n/**\n * Check if emergency cleanup is needed (high disk usage)\n */\nexport async function checkEmergencyCleanup(): Promise<boolean> {\n  try {\n    let totalSize = 0;\n    let totalFiles = 0;\n\n    for (const dir of getTempDirs()) {\n      try {\n        const files = await fs.readdir(dir);\n        for (const file of files) {\n          const stats = await fs.stat(path.join(dir, file));\n          totalSize += stats.size;\n          totalFiles++;\n        }\n      } catch (error) {\n        // Directory might not exist, skip\n      }\n    }\n\n    const thresholdSize = getMaxTotalSizeBytes();\n    const thresholdFiles = getMaxFileCount();\n    const needsEmergency =\n      totalSize > thresholdSize || totalFiles > thresholdFiles;\n\n    if (needsEmergency) {\n      console.warn(\n        `[Cleanup] Emergency cleanup needed: ${totalFiles} files, ${Math.round(totalSize / (1024 * 1024))}MB (threshold: ${Math.round(thresholdSize / (1024 * 1024))}MB / ${thresholdFiles} files)`\n      );\n    }\n\n    return needsEmergency;\n  } catch (error) {\n    console.error('[Cleanup] Error checking emergency cleanup:', error);\n    return false;\n  }\n}\n\n/**\n * Ensure temp directories exist with secure permissions.\n * Exported for tests.\n */\nexport async function ensureTempDirsCreated(): Promise<void> {\n  const dirs = getTempDirs();\n  for (const dir of dirs) {\n    try {\n      await fs.mkdir(dir, { recursive: true, mode: 0o700 });\n      try {\n        // Attempt to set restrictive permissions; may be noop on some OSes\n        await fs.chmod(dir, 0o700);\n      } catch (chmodErr) {\n        console.warn(`[Cleanup] Could not set permissions on ${dir}: ${chmodErr}`);\n      }\n    } catch (err) {\n      console.warn(`[Cleanup] Could not ensure directory ${dir}: ${err}`);\n    }\n  }\n}\n\n/**\n * Main cleanup function - cleans all temp directories\n */\nexport async function cleanupOrphanedTempFiles(): Promise<CleanupSummary> {\n  const startTime = Date.now();\n  console.log('[Cleanup] Starting temp file cleanup...');\n  const tempDirs = getTempDirs();\n  console.log('[Cleanup] Using directories:', tempDirs);\n\n  const summary: CleanupSummary = {\n    totalFilesRemoved: 0,\n    totalSpaceFreed: 0,\n    totalDuration: 0,\n    directories: [],\n    warnings: [],\n    errors: [],\n  };\n\n  try {\n    // Ensure temp dirs exist and have secure permissions\n    ensureTempDirsCreated();\n\n    // Check if emergency cleanup is needed\n    const emergencyNeeded = await checkEmergencyCleanup();\n    if (emergencyNeeded) {\n      summary.warnings.push(\n        'High temp directory usage detected - emergency cleanup performed'\n      );\n    }\n\n    // Clean up each directory\n    for (const dir of tempDirs) {\n      try {\n        console.log(`[Cleanup] Cleaning directory: ${dir}`);\n        const result = await cleanupDirectory(dir);\n        console.log(`[Cleanup] Directory result:`, result);\n        summary.directories.push(result);\n        summary.totalFilesRemoved += result.filesRemoved;\n        summary.totalSpaceFreed += result.spaceFreed;\n\n        if (result.errors.length > 0) {\n          summary.errors.push(...result.errors);\n        }\n      } catch (error) {\n        const errorMsg = `Failed to clean ${dir}: ${error}`;\n        summary.errors.push(errorMsg);\n        console.error(`[Cleanup] ${errorMsg}`);\n      }\n    }\n\n    summary.totalDuration = Date.now() - startTime;\n\n    // Log summary\n    console.log('[Cleanup] Summary:');\n    console.log(`[Cleanup] - Files removed: ${summary.totalFilesRemoved}`);\n    console.log(\n      `[Cleanup] - Space freed: ${Math.round(summary.totalSpaceFreed / (1024 * 1024))}MB`\n    );\n    console.log(`[Cleanup] - Duration: ${summary.totalDuration}ms`);\n\n    if (summary.warnings.length > 0) {\n      console.warn('[Cleanup] Warnings:', summary.warnings);\n    }\n\n    if (summary.errors.length > 0) {\n      console.error('[Cleanup] Errors:', summary.errors);\n    }\n  } catch (error) {\n    const errorMsg = `Cleanup failed: ${error}`;\n    summary.errors.push(errorMsg);\n    console.error(`[Cleanup] ${errorMsg}`);\n  }\n\n  return summary;\n}\n\n/**\n * Health check for temp directories\n */\nexport async function checkTempHealth(): Promise<{\n  healthy: boolean;\n  totalSize: number;\n  fileCount: number;\n  warnings: string[];\n}> {\n  const warnings: string[] = [];\n  let totalSize = 0;\n  let totalFiles = 0;\n  const tempDirs = getTempDirs();\n\n  try {\n    for (const dir of tempDirs) {\n      try {\n        const files = await fs.readdir(dir);\n\n        for (const file of files) {\n          const filePath = path.join(dir, file);\n          try {\n            const stats = await fs.stat(filePath);\n            totalSize += stats.size;\n            totalFiles++;\n          } catch (fileError) {\n            warnings.push(`Could not stat ${filePath}: ${fileError}`);\n          }\n        }\n      } catch (dirError) {\n        // Directory doesn't exist or can't be read\n        if ((dirError as any).code !== 'ENOENT') {\n          warnings.push(`Could not read directory ${dir}: ${dirError}`);\n        }\n      }\n    }\n\n    // Check thresholds\n    if (totalSize > MAX_TOTAL_SIZE_BYTES) {\n      warnings.push(\n        `Temp directory size ${totalSize} exceeds limit of ${MAX_TOTAL_SIZE_BYTES}`\n      );\n    }\n\n    if (totalFiles > MAX_FILE_COUNT) {\n      warnings.push(\n        `Temp file count ${totalFiles} exceeds limit of ${MAX_FILE_COUNT}`\n      );\n    }\n\n    const healthy = warnings.length === 0;\n\n    if (!healthy) {\n      console.warn('[Health] Temp directory health check failed:', warnings);\n    }\n\n    return {\n      healthy,\n      totalSize,\n      fileCount: totalFiles,\n      warnings,\n    };\n  } catch (error) {\n    console.error('[Health] Error checking temp health:', error);\n    return {\n      healthy: false,\n      totalSize: 0,\n      fileCount: 0,\n      warnings: [`Failed to check temp health: ${error}`],\n    };\n  }\n}\n\n/**\n * Setup periodic cleanup (for production use)\n */\nexport function startPeriodicCleanup(\n  intervalMs = 60 * 60 * 1000\n): NodeJS.Timeout {\n  console.log(\n    `[Cleanup] Starting periodic cleanup every ${intervalMs / (60 * 1000)} minutes`\n  );\n\n  const interval = setInterval(async () => {\n    try {\n      console.log('[Cleanup] Running scheduled cleanup...');\n      const result = await cleanupOrphanedTempFiles();\n\n      if (result.totalFilesRemoved > 0) {\n        console.log(\n          `[Cleanup] Scheduled cleanup completed: removed ${result.totalFilesRemoved} files`\n        );\n      } else {\n        console.log(\n          '[Cleanup] Scheduled cleanup completed: no files to remove'\n        );\n      }\n    } catch (error) {\n      console.error('[Cleanup] Scheduled cleanup failed:', error);\n    }\n  }, intervalMs);\n\n  return interval;\n}\n\n/**\n * Cleanup on process exit\n */\nexport async function cleanupOnExit(): Promise<void> {\n  console.log('[Cleanup] Running cleanup on process exit...');\n  try {\n    const result = await cleanupOrphanedTempFiles();\n    console.log(\n      `[Cleanup] Exit cleanup completed: removed ${result.totalFilesRemoved} files`\n    );\n  } catch (error) {\n    console.error('[Cleanup] Exit cleanup failed:', error);\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/static.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/storage_legacy.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":375,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":375,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10773,10776],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10773,10776],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\n  type User,\n  type InsertUser,\n  type InsertExtractionAnalytics,\n  type ExtractionAnalytics,\n  extractionAnalytics,\n  creditBalances,\n  creditTransactions,\n  type CreditBalance,\n  type CreditTransaction,\n  onboardingSessions,\n  type OnboardingSession,\n  type InsertOnboardingSession,\n  trialUsages,\n  type TrialUsage,\n  type InsertTrialUsage,\n} from '@shared/schema';\nimport { randomUUID } from 'crypto';\nimport { desc, sql, eq } from 'drizzle-orm';\n\nexport interface IStorage {\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  logExtractionUsage(data: InsertExtractionAnalytics): Promise<void>;\n  getAnalyticsSummary(): Promise<AnalyticsSummary>;\n  getRecentExtractions(limit?: number): Promise<ExtractionAnalytics[]>;\n  // Credits system\n  getOrCreateCreditBalance(\n    sessionId: string,\n    userId?: string\n  ): Promise<CreditBalance>;\n  getCreditBalance(balanceId: string): Promise<CreditBalance | undefined>;\n  addCredits(\n    balanceId: string,\n    amount: number,\n    description: string,\n    paymentId?: string\n  ): Promise<CreditTransaction>;\n  useCredits(\n    balanceId: string,\n    amount: number,\n    description: string,\n    fileType?: string\n  ): Promise<CreditTransaction | null>;\n  getCreditTransactions(\n    balanceId: string,\n    limit?: number\n  ): Promise<CreditTransaction[]>;\n  // Onboarding system\n  getOnboardingSession(userId: string): Promise<OnboardingSession | undefined>;\n  createOnboardingSession(\n    data: InsertOnboardingSession\n  ): Promise<OnboardingSession>;\n  updateOnboardingSession(\n    sessionId: string,\n    updates: Partial<OnboardingSession>\n  ): Promise<void>;\n  // Trial system\n  hasTrialUsage(email: string): Promise<boolean>;\n  recordTrialUsage(data: InsertTrialUsage): Promise<TrialUsage>;\n  getTrialUsageByEmail(email: string): Promise<TrialUsage | undefined>;\n}\n\nexport interface AnalyticsSummary {\n  totalExtractions: number;\n  byTier: Record<string, number>;\n  byFileType: Record<string, number>;\n  byMediaType: {\n    images: number;\n    videos: number;\n    pdfs: number;\n    audio: number;\n    other: number;\n  };\n  last24Hours: number;\n  last7Days: number;\n  averageProcessingMs: number;\n  totalBytesProcessed: number;\n  successRate: number;\n}\n\nexport class MemStorage implements IStorage {\n  private users: Map<string, User>;\n  private analyticsLog: ExtractionAnalytics[];\n  private creditBalancesMap: Map<string, CreditBalance> = new Map();\n  private creditTransactionsList: CreditTransaction[] = [];\n  private onboardingSessionsMap: Map<string, OnboardingSession> = new Map();\n  private trialUsagesMap: Map<string, TrialUsage> = new Map();\n\n  constructor() {\n    this.users = new Map();\n    this.analyticsLog = [];\n  }\n\n  async getUser(id: string): Promise<User | undefined> {\n    return this.users.get(id);\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    return Array.from(this.users.values()).find(\n      user => user.username === username\n    );\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const id = randomUUID();\n    const user: User = {\n      ...insertUser,\n      id,\n      tier: 'enterprise',\n      subscriptionId: null,\n      subscriptionStatus: null,\n      customerId: null,\n      emailVerified: false,\n      createdAt: new Date(),\n    };\n    this.users.set(id, user);\n    return user;\n  }\n\n  async logExtractionUsage(data: InsertExtractionAnalytics): Promise<void> {\n    const entry: ExtractionAnalytics = {\n      id: randomUUID(),\n      tier: data.tier || 'enterprise',\n      fileExtension: data.fileExtension,\n      mimeType: data.mimeType,\n      fileSizeBytes: data.fileSizeBytes,\n      isVideo: data.isVideo || false,\n      isImage: data.isImage || false,\n      isPdf: data.isPdf || false,\n      isAudio: data.isAudio || false,\n      fieldsExtracted: data.fieldsExtracted || 0,\n      processingMs: data.processingMs || 0,\n      success: data.success !== undefined ? data.success : true,\n      failureReason: data.failureReason || null,\n      ipAddress: data.ipAddress || null,\n      userAgent: data.userAgent || null,\n      requestedAt: new Date(),\n    };\n    this.analyticsLog.push(entry);\n  }\n\n  async getAnalyticsSummary(): Promise<AnalyticsSummary> {\n    const now = new Date();\n    const oneDayAgo = new Date(now.getTime() - 24 * 60 * 60 * 1000);\n    const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n\n    const byTier: Record<string, number> = {};\n    const byFileType: Record<string, number> = {};\n    let images = 0,\n      videos = 0,\n      pdfs = 0,\n      audio = 0,\n      other = 0;\n    let last24Hours = 0,\n      last7Days = 0;\n    let totalProcessingMs = 0;\n    let totalBytes = 0;\n    let successCount = 0;\n\n    for (const entry of this.analyticsLog) {\n      byTier[entry.tier] = (byTier[entry.tier] || 0) + 1;\n      byFileType[entry.fileExtension] =\n        (byFileType[entry.fileExtension] || 0) + 1;\n\n      if (entry.isImage) images++;\n      else if (entry.isVideo) videos++;\n      else if (entry.isPdf) pdfs++;\n      else if (entry.isAudio) audio++;\n      else other++;\n\n      if (entry.requestedAt >= oneDayAgo) last24Hours++;\n      if (entry.requestedAt >= sevenDaysAgo) last7Days++;\n\n      totalProcessingMs += entry.processingMs;\n      totalBytes += entry.fileSizeBytes;\n      if (entry.success) successCount++;\n    }\n\n    return {\n      totalExtractions: this.analyticsLog.length,\n      byTier,\n      byFileType,\n      byMediaType: { images, videos, pdfs, audio, other },\n      last24Hours,\n      last7Days,\n      averageProcessingMs:\n        this.analyticsLog.length > 0\n          ? Math.round(totalProcessingMs / this.analyticsLog.length)\n          : 0,\n      totalBytesProcessed: totalBytes,\n      successRate:\n        this.analyticsLog.length > 0\n          ? Math.round((successCount / this.analyticsLog.length) * 100)\n          : 100,\n    };\n  }\n\n  async getRecentExtractions(\n    limit: number = 50\n  ): Promise<ExtractionAnalytics[]> {\n    return this.analyticsLog.slice(-limit).reverse();\n  }\n\n  async getOrCreateCreditBalance(\n    sessionId: string,\n    userId?: string\n  ): Promise<CreditBalance> {\n    const existing = Array.from(this.creditBalancesMap.values()).find(\n      b => b.sessionId === sessionId\n    );\n    if (existing) return existing;\n\n    const balance: CreditBalance = {\n      id: randomUUID(),\n      userId: userId || null,\n      sessionId,\n      credits: 0,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    };\n    this.creditBalancesMap.set(balance.id, balance);\n    return balance;\n  }\n\n  async getCreditBalance(\n    balanceId: string\n  ): Promise<CreditBalance | undefined> {\n    return this.creditBalancesMap.get(balanceId);\n  }\n\n  async addCredits(\n    balanceId: string,\n    amount: number,\n    description: string,\n    paymentId?: string\n  ): Promise<CreditTransaction> {\n    const balance = this.creditBalancesMap.get(balanceId);\n    if (balance) {\n      balance.credits += amount;\n      balance.updatedAt = new Date();\n    }\n\n    const tx: CreditTransaction = {\n      id: randomUUID(),\n      balanceId,\n      grantId: null,\n      type: 'purchase',\n      amount,\n      description,\n      fileType: null,\n      dodoPaymentId: paymentId || null,\n      createdAt: new Date(),\n    };\n    this.creditTransactionsList.push(tx);\n    return tx;\n  }\n\n  async useCredits(\n    balanceId: string,\n    amount: number,\n    description: string,\n    fileType?: string\n  ): Promise<CreditTransaction | null> {\n    const balance = this.creditBalancesMap.get(balanceId);\n    if (!balance || balance.credits < amount) return null;\n\n    balance.credits -= amount;\n    balance.updatedAt = new Date();\n\n    const tx: CreditTransaction = {\n      id: randomUUID(),\n      balanceId,\n      grantId: null,\n      type: 'usage',\n      amount: -amount,\n      description,\n      fileType: fileType || null,\n      dodoPaymentId: null,\n      createdAt: new Date(),\n    };\n    this.creditTransactionsList.push(tx);\n    return tx;\n  }\n\n  async getCreditTransactions(\n    balanceId: string,\n    limit: number = 50\n  ): Promise<CreditTransaction[]> {\n    return this.creditTransactionsList\n      .filter(t => t.balanceId === balanceId)\n      .slice(-limit)\n      .reverse();\n  }\n\n  async getOnboardingSession(\n    userId: string\n  ): Promise<OnboardingSession | undefined> {\n    return Array.from(this.onboardingSessionsMap.values())\n      .filter(s => s.userId === userId)\n      .sort((a, b) => b.startedAt.getTime() - a.startedAt.getTime())[0];\n  }\n\n  async createOnboardingSession(\n    data: InsertOnboardingSession\n  ): Promise<OnboardingSession> {\n    const session: OnboardingSession = {\n      id: randomUUID(),\n      userId: data.userId ?? null,\n      startedAt: data.startedAt ?? new Date(),\n      completedAt: data.completedAt ?? null,\n      currentStep: data.currentStep ?? 0,\n      pathId: data.pathId,\n      userProfile: data.userProfile,\n      progress: data.progress,\n      interactions: data.interactions ?? '[]',\n      isActive: data.isActive ?? true,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    };\n    this.onboardingSessionsMap.set(session.id, session);\n    return session;\n  }\n\n  async updateOnboardingSession(\n    sessionId: string,\n    updates: Partial<OnboardingSession>\n  ): Promise<void> {\n    const session = this.onboardingSessionsMap.get(sessionId);\n    if (session) {\n      Object.assign(session, updates, { updatedAt: new Date() });\n    }\n  }\n\n  async hasTrialUsage(email: string): Promise<boolean> {\n    const normalizedEmail = email.trim().toLowerCase();\n    const usage = this.trialUsagesMap.get(normalizedEmail);\n    return !!usage && usage.uses > 0;\n  }\n\n  async recordTrialUsage(data: InsertTrialUsage): Promise<TrialUsage> {\n    const normalizedEmail = data.email.trim().toLowerCase();\n    const existing = this.trialUsagesMap.get(normalizedEmail);\n    if (existing) {\n      existing.uses += 1;\n      existing.usedAt = new Date();\n      existing.ipAddress = data.ipAddress ?? null;\n      existing.userAgent = data.userAgent ?? null;\n      existing.sessionId = data.sessionId ?? null;\n      return existing;\n    }\n\n    const usage: TrialUsage = {\n      id: randomUUID(),\n      email: normalizedEmail,\n      uses: 1,\n      usedAt: new Date(),\n      ipAddress: data.ipAddress ?? null,\n      userAgent: data.userAgent ?? null,\n      sessionId: data.sessionId ?? null,\n    };\n\n    this.trialUsagesMap.set(normalizedEmail, usage);\n    return usage;\n  }\n\n  async getTrialUsageByEmail(email: string): Promise<TrialUsage | undefined> {\n    const normalizedEmail = email.trim().toLowerCase();\n    return this.trialUsagesMap.get(normalizedEmail);\n  }\n}\n\nexport class DatabaseStorage implements IStorage {\n  private db: any;\n\n  constructor() {\n    // Lazy load database connection\n    try {\n      const { db } = require('./db');\n      this.db = db;\n    } catch (error) {\n      console.error('Failed to connect to database:', error);\n      this.db = null;\n    }\n  }\n\n  async getUser(_id: string): Promise<User | undefined> {\n    return undefined;\n  }\n\n  async getUserByUsername(_username: string): Promise<User | undefined> {\n    return undefined;\n  }\n\n  async createUser(_insertUser: InsertUser): Promise<User> {\n    throw new Error('Not implemented');\n  }\n\n  async logExtractionUsage(data: InsertExtractionAnalytics): Promise<void> {\n    if (!this.db) return;\n    try {\n      await this.db.insert(extractionAnalytics).values(data);\n    } catch (error) {\n      console.error('Failed to log extraction usage:', error);\n    }\n  }\n\n  async getAnalyticsSummary(): Promise<AnalyticsSummary> {\n    if (!this.db) {\n      return {\n        totalExtractions: 0,\n        byTier: {},\n        byFileType: {},\n        byMediaType: { images: 0, videos: 0, pdfs: 0, audio: 0, other: 0 },\n        last24Hours: 0,\n        last7Days: 0,\n        averageProcessingMs: 0,\n        totalBytesProcessed: 0,\n        successRate: 100,\n      };\n    }\n\n    try {\n      const now = new Date();\n      const oneDayAgo = new Date(now.getTime() - 24 * 60 * 60 * 1000);\n      const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n\n      const allEntries = await this.db.select().from(extractionAnalytics);\n\n      const byTier: Record<string, number> = {};\n      const byFileType: Record<string, number> = {};\n      let images = 0,\n        videos = 0,\n        pdfs = 0,\n        audio = 0,\n        other = 0;\n      let last24Hours = 0,\n        last7Days = 0;\n      let totalProcessingMs = 0;\n      let totalBytes = 0;\n      let successCount = 0;\n\n      for (const entry of allEntries) {\n        byTier[entry.tier] = (byTier[entry.tier] || 0) + 1;\n        byFileType[entry.fileExtension] =\n          (byFileType[entry.fileExtension] || 0) + 1;\n\n        if (entry.isImage) images++;\n        else if (entry.isVideo) videos++;\n        else if (entry.isPdf) pdfs++;\n        else if (entry.isAudio) audio++;\n        else other++;\n\n        if (entry.requestedAt >= oneDayAgo) last24Hours++;\n        if (entry.requestedAt >= sevenDaysAgo) last7Days++;\n\n        totalProcessingMs += entry.processingMs;\n        totalBytes += entry.fileSizeBytes;\n        if (entry.success) successCount++;\n      }\n\n      return {\n        totalExtractions: allEntries.length,\n        byTier,\n        byFileType,\n        byMediaType: { images, videos, pdfs, audio, other },\n        last24Hours,\n        last7Days,\n        averageProcessingMs:\n          allEntries.length > 0\n            ? Math.round(totalProcessingMs / allEntries.length)\n            : 0,\n        totalBytesProcessed: totalBytes,\n        successRate:\n          allEntries.length > 0\n            ? Math.round((successCount / allEntries.length) * 100)\n            : 100,\n      };\n    } catch (error) {\n      console.error('Failed to get analytics summary:', error);\n      return {\n        totalExtractions: 0,\n        byTier: {},\n        byFileType: {},\n        byMediaType: { images: 0, videos: 0, pdfs: 0, audio: 0, other: 0 },\n        last24Hours: 0,\n        last7Days: 0,\n        averageProcessingMs: 0,\n        totalBytesProcessed: 0,\n        successRate: 100,\n      };\n    }\n  }\n\n  async getRecentExtractions(\n    limit: number = 50\n  ): Promise<ExtractionAnalytics[]> {\n    if (!this.db) return [];\n    try {\n      return await this.db\n        .select()\n        .from(extractionAnalytics)\n        .orderBy(desc(extractionAnalytics.requestedAt))\n        .limit(limit);\n    } catch (error) {\n      console.error('Failed to get recent extractions:', error);\n      return [];\n    }\n  }\n\n  async getOrCreateCreditBalance(\n    sessionId: string,\n    userId?: string\n  ): Promise<CreditBalance> {\n    if (!this.db) throw new Error('Database not available');\n    try {\n      const existing = await this.db\n        .select()\n        .from(creditBalances)\n        .where(eq(creditBalances.sessionId, sessionId))\n        .limit(1);\n\n      if (existing.length > 0) return existing[0];\n\n      const [newBalance] = await this.db\n        .insert(creditBalances)\n        .values({ sessionId, userId, credits: 0 })\n        .returning();\n      return newBalance;\n    } catch (error) {\n      console.error('Failed to get/create credit balance:', error);\n      throw error;\n    }\n  }\n\n  async getCreditBalance(\n    balanceId: string\n  ): Promise<CreditBalance | undefined> {\n    if (!this.db) return undefined;\n    try {\n      const [balance] = await this.db\n        .select()\n        .from(creditBalances)\n        .where(eq(creditBalances.id, balanceId))\n        .limit(1);\n      return balance;\n    } catch (error) {\n      console.error('Failed to get credit balance:', error);\n      return undefined;\n    }\n  }\n\n  async addCredits(\n    balanceId: string,\n    amount: number,\n    description: string,\n    paymentId?: string\n  ): Promise<CreditTransaction> {\n    if (!this.db) throw new Error('Database not available');\n    try {\n      await this.db\n        .update(creditBalances)\n        .set({\n          credits: sql`${creditBalances.credits} + ${amount}`,\n          updatedAt: new Date(),\n        })\n        .where(eq(creditBalances.id, balanceId));\n\n      const [tx] = await this.db\n        .insert(creditTransactions)\n        .values({\n          balanceId,\n          type: 'purchase',\n          amount,\n          description,\n          dodoPaymentId: paymentId,\n        })\n        .returning();\n      return tx;\n    } catch (error) {\n      console.error('Failed to add credits:', error);\n      throw error;\n    }\n  }\n\n  async useCredits(\n    balanceId: string,\n    amount: number,\n    description: string,\n    fileType?: string\n  ): Promise<CreditTransaction | null> {\n    if (!this.db) return null;\n    try {\n      const [balance] = await this.db\n        .select()\n        .from(creditBalances)\n        .where(eq(creditBalances.id, balanceId))\n        .limit(1);\n\n      if (!balance || balance.credits < amount) return null;\n\n      await this.db\n        .update(creditBalances)\n        .set({\n          credits: sql`${creditBalances.credits} - ${amount}`,\n          updatedAt: new Date(),\n        })\n        .where(eq(creditBalances.id, balanceId));\n\n      const [tx] = await this.db\n        .insert(creditTransactions)\n        .values({\n          balanceId,\n          type: 'usage',\n          amount: -amount,\n          description,\n          fileType,\n        })\n        .returning();\n      return tx;\n    } catch (error) {\n      console.error('Failed to use credits:', error);\n      return null;\n    }\n  }\n\n  async getCreditTransactions(\n    balanceId: string,\n    limit: number = 50\n  ): Promise<CreditTransaction[]> {\n    if (!this.db) return [];\n    try {\n      return await this.db\n        .select()\n        .from(creditTransactions)\n        .where(eq(creditTransactions.balanceId, balanceId))\n        .orderBy(desc(creditTransactions.createdAt))\n        .limit(limit);\n    } catch (error) {\n      console.error('Failed to get credit transactions:', error);\n      return [];\n    }\n  }\n\n  async getOnboardingSession(\n    userId: string\n  ): Promise<OnboardingSession | undefined> {\n    if (!this.db) return undefined;\n    try {\n      const [session] = await this.db\n        .select()\n        .from(onboardingSessions)\n        .where(eq(onboardingSessions.userId, userId))\n        .orderBy(desc(onboardingSessions.startedAt))\n        .limit(1);\n      return session;\n    } catch (error) {\n      console.error('Failed to get onboarding session:', error);\n      return undefined;\n    }\n  }\n\n  async createOnboardingSession(\n    data: InsertOnboardingSession\n  ): Promise<OnboardingSession> {\n    if (!this.db) throw new Error('Database not available');\n    try {\n      const [session] = await this.db\n        .insert(onboardingSessions)\n        .values(data)\n        .returning();\n      return session;\n    } catch (error) {\n      console.error('Failed to create onboarding session:', error);\n      throw error;\n    }\n  }\n\n  async updateOnboardingSession(\n    sessionId: string,\n    updates: Partial<OnboardingSession>\n  ): Promise<void> {\n    if (!this.db) return;\n    try {\n      await this.db\n        .update(onboardingSessions)\n        .set({ ...updates, updatedAt: new Date() })\n        .where(eq(onboardingSessions.id, sessionId));\n    } catch (error) {\n      console.error('Failed to update onboarding session:', error);\n    }\n  }\n\n  // Trial system methods\n  async hasTrialUsage(email: string): Promise<boolean> {\n    if (!this.db) return false;\n    try {\n      const result = await this.db\n        .select({ id: trialUsages.id })\n        .from(trialUsages)\n        .where(eq(trialUsages.email, email.toLowerCase()))\n        .limit(1);\n      return result.length > 0;\n    } catch (error) {\n      console.error('Failed to check trial usage:', error);\n      return false;\n    }\n  }\n\n  async recordTrialUsage(data: InsertTrialUsage): Promise<TrialUsage> {\n    if (!this.db) throw new Error('Database not available');\n    try {\n      const normalizedEmail = data.email.toLowerCase();\n      const [updated] = await this.db\n        .update(trialUsages)\n        .set({\n          uses: sql`${trialUsages.uses} + 1`,\n          usedAt: new Date(),\n          ipAddress: data.ipAddress ?? null,\n          userAgent: data.userAgent ?? null,\n          sessionId: data.sessionId ?? null,\n        })\n        .where(eq(trialUsages.email, normalizedEmail))\n        .returning();\n\n      if (updated) {\n        return updated;\n      }\n\n      const [trialUsage] = await this.db\n        .insert(trialUsages)\n        .values({\n          ...data,\n          email: normalizedEmail,\n          uses: 1,\n        })\n        .returning();\n      return trialUsage;\n    } catch (error) {\n      console.error('Failed to record trial usage:', error);\n      throw error;\n    }\n  }\n\n  async getTrialUsageByEmail(email: string): Promise<TrialUsage | undefined> {\n    if (!this.db) return undefined;\n    try {\n      const [trialUsage] = await this.db\n        .select()\n        .from(trialUsages)\n        .where(eq(trialUsages.email, email.toLowerCase()))\n        .limit(1);\n      return trialUsage;\n    } catch (error) {\n      console.error('Failed to get trial usage:', error);\n      return undefined;\n    }\n  }\n}\n\n// Use MemStorage for development when DATABASE_URL is placeholder or missing\nconst isDatabaseConfigured =\n  process.env.DATABASE_URL &&\n  !process.env.DATABASE_URL.includes('user:password@host');\n\nexport const storage: IStorage = isDatabaseConfigured\n  ? new DatabaseStorage()\n  : new MemStorage();\n\nif (!isDatabaseConfigured) {\n  console.log(\n    '  DATABASE_URL not configured - using in-memory storage (data will not persist)'\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/types/aws-sdk-client-s3.d.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[89,92],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[89,92],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[113,116],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[113,116],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[127,130],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[127,130],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[196,199],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[196,199],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[265,268],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[265,268],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[337,340],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[337,340],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"declare module '@aws-sdk/client-s3' {\n  export class S3Client {\n    constructor(options: any);\n    send(command: any): Promise<any>;\n  }\n\n  export class PutObjectCommand {\n    constructor(params: any);\n  }\n\n  export class GetObjectCommand {\n    constructor(params: any);\n  }\n\n  export class DeleteObjectCommand {\n    constructor(params: any);\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/types/shared-analytics.d.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[70,73],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[70,73],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[107,110],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[107,110],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[147,150],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[147,150],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[392,395],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[392,395],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[456,459],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[456,459],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[462,465],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[462,465],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1156,1159],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1156,1159],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1191,1194],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1191,1194],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"declare module '@shared/analytics-events' {\n  export const EventName: any;\n  export const UserIntentEvent: any;\n  export const ComprehensionEvent: any;\n  export type BaseEventProperties = Record<string, unknown>;\n  export type UserIntentEventProperties = Record<string, unknown>;\n  export type ComprehensionEventProperties = Record<string, unknown>;\n  export function buildDedupeKey(...args: any[]): string;\n  export function validateEventPayload(payload: any): any;\n  export enum FileSizeBucket {\n    SMALL = 'SMALL',\n    MEDIUM = 'MEDIUM',\n    LARGE = 'LARGE',\n    XLARGE = 'XLARGE',\n  }\n  export enum UserTier {\n    ANON = 'ANON',\n    FREE = 'FREE',\n    PRO = 'PRO',\n  }\n  export enum AuthState {\n    LOGGED_OUT = 'LOGGED_OUT',\n    LOGGED_IN = 'LOGGED_IN',\n  }\n  export enum SourceEntryPoint {\n    UPLOAD_PAGE = 'UPLOAD_PAGE',\n    LANDING = 'LANDING',\n    SHARE_LINK = 'SHARE_LINK',\n    API = 'API',\n  }\n  export enum ClientType {\n    WEB = 'WEB',\n    EXTENSION = 'EXTENSION',\n    MOBILE_APP = 'MOBILE_APP',\n  }\n  export enum ResultDensity {\n    SIMPLE = 'SIMPLE',\n    STANDARD = 'STANDARD',\n    ADVANCED = 'ADVANCED',\n  }\n  export const validateEvent: any;\n  export type InsertUiEvent = any;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/utils/cdn-helper.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'expiresInSeconds' is assigned a value but never used. Allowed unused args must match /^_/u.","line":45,"column":49,"nodeType":null,"messageId":"unusedVar","endLine":45,"endColumn":65}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * CDN Helper Utility\n * \n * Centralizes URL generation for assets.\n * Allows switching between local serving and CDN (CloudFront/S3/R2).\n */\n\nconst CDN_BASE_URL = process.env.CDN_BASE_URL || ''; // Empty = relative/local\n\nexport interface CdnAsset {\n  key: string;      // Storage key/path\n  bucket?: string;  // Optional bucket name\n  variant?: 'original' | 'thumbnail' | 'preview';\n}\n\n/**\n * Generate a public URL for an asset.\n * \n * @param asset - Asset details\n * @returns Full public URL\n */\nexport function getCdnUrl(asset: CdnAsset): string {\n  const { key, variant } = asset;\n  \n  // If no CDN configured, serve via local API proxy\n  if (!CDN_BASE_URL) {\n    if (variant === 'thumbnail') {\n      // Assuming key is resultId for local thumbnail endpoint\n      return `/api/images_mvp/thumbnail/${key}`;\n    }\n    // Generic local file serve (not implemented in MVP yet, usually S3 signed url)\n    return `/api/files/${key}`;\n  }\n\n  // Production CDN URL construction\n  // e.g. https://cdn.metaextract.com/thumbnails/key.webp\n  const path = variant ? `${variant}s/${key}` : key;\n  return new URL(path, CDN_BASE_URL).toString();\n}\n\n/**\n * Generate a signed URL for private assets (Time-limited).\n * Placeholder for S3/CloudFront signed URLs.\n */\nexport async function getSignedUrl(key: string, expiresInSeconds = 3600): Promise<string> {\n  // Mock implementation\n  return getCdnUrl({ key });\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/utils/circuit-breaker.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":219,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":219,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5948,5951],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5948,5951],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":220,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":220,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5988,5991],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5988,5991],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":220,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":220,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5998,6001],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5998,6001],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":220,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":220,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6009,6012],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6009,6012],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Circuit Breaker for Emergency Load Shedding\n * \n * Protects the system during high load or attack conditions:\n * - Free tier gets delayed (not denied) during high load\n * - Paid tier stays fast\n * - Prevents cost runaway from attacks\n * \n * States:\n * - CLOSED: Normal operation, all requests processed normally\n * - OPEN: High load, free tier delayed, paid tier normal\n * - HALF_OPEN: Testing if load has normalized\n */\n\nexport type CircuitState = 'closed' | 'open' | 'half_open';\n\nexport interface CircuitBreakerConfig {\n  /** Queue depth threshold to trip the breaker */\n  queueDepthThreshold: number;\n  /** CPU percentage threshold */\n  cpuThreshold: number;\n  /** Memory percentage threshold */\n  memoryThreshold: number;\n  /** How long to stay open before testing (ms) */\n  resetTimeout: number;\n  /** Number of successful requests to close from half-open */\n  successThreshold: number;\n}\n\nexport interface LoadCheckResult {\n  allowed: boolean;\n  delayed: boolean;\n  estimatedWaitSeconds: number;\n  message: string;\n  circuitState: CircuitState;\n}\n\nconst DEFAULT_CONFIG: CircuitBreakerConfig = {\n  queueDepthThreshold: 500,\n  cpuThreshold: 80,\n  memoryThreshold: 85,\n  resetTimeout: 60000, // 1 minute\n  successThreshold: 5,\n};\n\nexport class CircuitBreaker {\n  private state: CircuitState = 'closed';\n  private config: CircuitBreakerConfig;\n  private lastTrippedAt: number = 0;\n  private successCount: number = 0;\n  private currentQueueDepth: number = 0;\n  private currentCpuUsage: number = 0;\n  private currentMemoryUsage: number = 0;\n  \n  constructor(config: Partial<CircuitBreakerConfig> = {}) {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n  }\n  \n  /**\n   * Update system metrics (called periodically or before checks)\n   */\n  updateMetrics(metrics: {\n    queueDepth?: number;\n    cpuUsage?: number;\n    memoryUsage?: number;\n  }): void {\n    if (typeof metrics.queueDepth === 'number') {\n      this.currentQueueDepth = metrics.queueDepth;\n    }\n    if (typeof metrics.cpuUsage === 'number') {\n      this.currentCpuUsage = metrics.cpuUsage;\n    }\n    if (typeof metrics.memoryUsage === 'number') {\n      this.currentMemoryUsage = metrics.memoryUsage;\n    }\n    \n    // Check if we need to trip or reset\n    this.evaluateState();\n  }\n  \n  /**\n   * Evaluate and potentially change circuit state\n   */\n  private evaluateState(): void {\n    const shouldTrip = \n      this.currentQueueDepth > this.config.queueDepthThreshold ||\n      this.currentCpuUsage > this.config.cpuThreshold ||\n      this.currentMemoryUsage > this.config.memoryThreshold;\n    \n    if (this.state === 'closed' && shouldTrip) {\n      this.trip();\n    } else if (this.state === 'open') {\n      // Check if we should try to recover\n      const elapsed = Date.now() - this.lastTrippedAt;\n      if (elapsed > this.config.resetTimeout) {\n        this.state = 'half_open';\n        this.successCount = 0;\n        console.log(' Circuit breaker entering half-open state');\n      }\n    } else if (this.state === 'half_open') {\n      if (shouldTrip) {\n        // Still under load, trip again\n        this.trip();\n      } else if (this.successCount >= this.config.successThreshold) {\n        // Load has normalized, close the circuit\n        this.reset();\n      }\n    }\n  }\n  \n  /**\n   * Trip the circuit breaker (enter open state)\n   */\n  trip(): void {\n    this.state = 'open';\n    this.lastTrippedAt = Date.now();\n    this.successCount = 0;\n    console.warn(' Circuit breaker TRIPPED - Free tier requests will be delayed');\n  }\n  \n  /**\n   * Reset the circuit breaker (return to closed state)\n   */\n  reset(): void {\n    this.state = 'closed';\n    this.successCount = 0;\n    console.log(' Circuit breaker RESET - Normal operation resumed');\n  }\n  \n  /**\n   * Record a successful request (for half-open state)\n   */\n  recordSuccess(): void {\n    if (this.state === 'half_open') {\n      this.successCount++;\n      this.evaluateState();\n    }\n  }\n  \n  /**\n   * Check if a free tier request should be delayed\n   */\n  checkFreeTier(): LoadCheckResult {\n    this.evaluateState();\n    \n    if (this.state === 'closed') {\n      return {\n        allowed: true,\n        delayed: false,\n        estimatedWaitSeconds: 0,\n        message: '',\n        circuitState: this.state,\n      };\n    }\n    \n    // Open or half-open: delay free tier\n    const estimatedWait = Math.min(300, Math.ceil(this.currentQueueDepth / 10));\n    \n    return {\n      allowed: true, // Still allowed, just delayed\n      delayed: true,\n      estimatedWaitSeconds: estimatedWait,\n      message: `High demand: Your file is queued. Estimated wait: ${estimatedWait} seconds. Paid tier bypasses queue.`,\n      circuitState: this.state,\n    };\n  }\n  \n  /**\n   * Check if a paid tier request should be delayed (rarely)\n   */\n  checkPaidTier(): LoadCheckResult {\n    // Paid tier is almost never delayed\n    // Only in extreme circumstances\n    if (this.currentQueueDepth > this.config.queueDepthThreshold * 3) {\n      return {\n        allowed: true,\n        delayed: true,\n        estimatedWaitSeconds: 10,\n        message: 'System under extreme load. Brief delay expected.',\n        circuitState: this.state,\n      };\n    }\n    \n    return {\n      allowed: true,\n      delayed: false,\n      estimatedWaitSeconds: 0,\n      message: '',\n      circuitState: this.state,\n    };\n  }\n  \n  /**\n   * Get current state for monitoring\n   */\n  getStatus(): {\n    state: CircuitState;\n    queueDepth: number;\n    cpuUsage: number;\n    memoryUsage: number;\n    lastTrippedAt: number | null;\n  } {\n    return {\n      state: this.state,\n      queueDepth: this.currentQueueDepth,\n      cpuUsage: this.currentCpuUsage,\n      memoryUsage: this.currentMemoryUsage,\n      lastTrippedAt: this.lastTrippedAt || null,\n    };\n  }\n}\n\n// Export singleton instance\nexport const circuitBreaker = new CircuitBreaker();\n\n/**\n * Middleware factory for circuit breaker\n */\nexport function createCircuitBreakerMiddleware(isPaidTier: (req: any) => boolean) {\n  return async (req: any, res: any, next: any) => {\n    const isPaid = isPaidTier(req);\n    const check = isPaid ? circuitBreaker.checkPaidTier() : circuitBreaker.checkFreeTier();\n    \n    if (check.delayed) {\n      // Add delay headers for client awareness\n      res.setHeader('X-Queue-Delayed', 'true');\n      res.setHeader('X-Estimated-Wait', check.estimatedWaitSeconds.toString());\n      \n      // For free tier, we might want to return early with queue info\n      // For now, just add headers and proceed\n    }\n    \n    // Store check result on request for downstream handlers\n    req.circuitBreaker = check;\n    \n    next();\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/utils/cost-calculator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/utils/device-token.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/utils/email-verification.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":233,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":233,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5937,5940],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5937,5940],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Email Verification System\n * Handles email verification for new user registrations\n */\n\nimport { Request, Response } from 'express';\nimport crypto from 'crypto';\nimport { db } from '../db';\nimport { users, emailVerificationTokens } from '@shared/schema';\nimport { eq, sql } from 'drizzle-orm';\nimport { addHours } from 'date-fns';\n\nconst VERIFICATION_CONFIG = {\n  TOKEN_EXPIRY_HOURS: 24,\n  TOKEN_LENGTH: 32,\n  MAX_ATTEMPTS: 3,\n};\n\n/**\n * Generate email verification token\n */\nexport function generateEmailVerificationToken(): string {\n  return crypto.randomBytes(VERIFICATION_CONFIG.TOKEN_LENGTH).toString('hex');\n}\n\n/**\n * Create email verification token for user\n */\nexport async function createEmailVerificationToken(\n  userId: string\n): Promise<string> {\n  const token = generateEmailVerificationToken();\n  const expiresAt = addHours(\n    new Date(),\n    VERIFICATION_CONFIG.TOKEN_EXPIRY_HOURS\n  );\n\n  // Delete any existing tokens for this user\n  await db\n    .delete(emailVerificationTokens)\n    .where(eq(emailVerificationTokens.userId, userId));\n\n  // Create new token\n  await db.insert(emailVerificationTokens).values({\n    userId,\n    token,\n    expiresAt,\n    createdAt: new Date(),\n  });\n\n  return token;\n}\n\n/**\n * Verify email verification token\n */\nexport async function verifyEmailToken(\n  token: string\n): Promise<{ success: boolean; userId?: string; message: string }> {\n  try {\n    if (!token || token.length !== VERIFICATION_CONFIG.TOKEN_LENGTH * 2) {\n      return { success: false, message: 'Invalid verification token' };\n    }\n\n    // Find token in database\n    const [verification] = await db\n      .select()\n      .from(emailVerificationTokens)\n      .where(eq(emailVerificationTokens.token, token))\n      .limit(1);\n\n    if (!verification) {\n      return { success: false, message: 'Verification token not found' };\n    }\n\n    // Check if token is expired\n    if (new Date() > verification.expiresAt) {\n      // Clean up expired token\n      await db\n        .delete(emailVerificationTokens)\n        .where(eq(emailVerificationTokens.token, token));\n      return { success: false, message: 'Verification token has expired' };\n    }\n\n    // Check if token has been used\n    if (verification.usedAt) {\n      return {\n        success: false,\n        message: 'Verification token has already been used',\n      };\n    }\n\n    // Mark token as used\n    await db\n      .update(emailVerificationTokens)\n      .set({ usedAt: new Date() })\n      .where(eq(emailVerificationTokens.token, token));\n\n    // Update user email verification status\n    await db\n      .update(users)\n      .set({ emailVerified: true, updatedAt: new Date() })\n      .where(eq(users.id, verification.userId));\n\n    return {\n      success: true,\n      userId: verification.userId,\n      message: 'Email verified successfully',\n    };\n  } catch (error) {\n    console.error('Email verification error:', error);\n    return { success: false, message: 'Email verification failed' };\n  }\n}\n\n/**\n * Resend email verification token\n */\nexport async function resendEmailVerificationToken(\n  userId: string\n): Promise<{ success: boolean; message: string; token?: string }> {\n  try {\n    // Check if user exists and email is not already verified\n    const [user] = await db\n      .select()\n      .from(users)\n      .where(eq(users.id, userId))\n      .limit(1);\n\n    if (!user) {\n      return { success: false, message: 'User not found' };\n    }\n\n    if (user.emailVerified) {\n      return { success: false, message: 'Email already verified' };\n    }\n\n    // Delete any existing tokens\n    await db\n      .delete(emailVerificationTokens)\n      .where(eq(emailVerificationTokens.userId, userId));\n\n    // Create new token\n    const token = await createEmailVerificationToken(userId);\n\n    // In production, this would send an email\n    // For now, return the token for development/testing\n    return { success: true, message: 'Verification email sent', token };\n  } catch (error) {\n    console.error('Resend verification error:', error);\n    return { success: false, message: 'Failed to resend verification email' };\n  }\n}\n\n/**\n * Check if user email is verified\n */\nexport async function isEmailVerified(userId: string): Promise<boolean> {\n  try {\n    const [user] = await db\n      .select({ emailVerified: users.emailVerified })\n      .from(users)\n      .where(eq(users.id, userId))\n      .limit(1);\n\n    return user?.emailVerified || false;\n  } catch (error) {\n    console.error('Email verification check error:', error);\n    return false;\n  }\n}\n\n/**\n * Clean up expired email verification tokens\n */\nexport async function cleanupEmailVerificationTokens(): Promise<void> {\n  try {\n    const now = new Date();\n    await db\n      .delete(emailVerificationTokens)\n      .where(sql`${emailVerificationTokens.expiresAt} < ${now}`);\n  } catch (error) {\n    console.error('Cleanup email verification tokens error:', error);\n  }\n}\n\n/**\n * Email verification endpoint handler\n */\nexport async function handleEmailVerification(\n  req: Request,\n  res: Response\n): Promise<void> {\n  try {\n    const { token } = req.body;\n\n    if (!token) {\n      res.status(400).json({ error: 'Verification token is required' });\n      return;\n    }\n\n    const result = await verifyEmailToken(token);\n\n    if (result.success) {\n      res.json({\n        success: true,\n        message: result.message,\n        userId: result.userId,\n      });\n    } else {\n      res.status(400).json({\n        success: false,\n        error: result.message,\n      });\n    }\n  } catch (error) {\n    console.error('Email verification handler error:', error);\n    res.status(500).json({\n      error: 'Email verification failed',\n      message: error instanceof Error ? error.message : 'Unknown error',\n    });\n  }\n}\n\n/**\n * Resend verification email endpoint handler\n */\nexport async function handleResendVerification(\n  req: Request,\n  res: Response\n): Promise<void> {\n  try {\n    const userId = (req as any).user?.id;\n\n    if (!userId) {\n      res.status(401).json({ error: 'Authentication required' });\n      return;\n    }\n\n    const result = await resendEmailVerificationToken(userId);\n\n    if (result.success) {\n      res.json({\n        success: true,\n        message: 'Verification email sent',\n      });\n    } else {\n      res.status(400).json({\n        success: false,\n        error: result.message,\n      });\n    }\n  } catch (error) {\n    console.error('Resend verification handler error:', error);\n    res.status(500).json({\n      error: 'Failed to resend verification email',\n      message: error instanceof Error ? error.message : 'Unknown error',\n    });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/utils/error-response.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2154,2157],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2154,2157],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":194,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":194,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5129,5132],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5129,5132],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Server-Side Error Response Utilities\n *\n * Standardizes error responses across all API endpoints.\n * Handles validation errors, business logic errors, and server errors.\n *\n * Usage:\n *   res.status(400).json(createValidationErrorResponse([...fieldErrors]))\n *   res.status(403).json(createApiErrorResponse('TIER_INSUFFICIENT', message, 403))\n */\n\nimport type { Response } from 'express';\nimport { ZodError } from 'zod';\nimport type {\n  ApiErrorResponse,\n  ValidationErrorResponse,\n  ValidationFieldError,\n  ErrorCode,\n} from '@shared/error-schema';\n\n/**\n * Generate a unique request ID for error tracking\n */\nfunction generateRequestId(): string {\n  return `REQ-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n}\n\n/**\n * Get current ISO timestamp\n */\nfunction getCurrentTimestamp(): string {\n  return new Date().toISOString();\n}\n\n/**\n * Create a standard API error response\n *\n * @param code - Machine-readable error code\n * @param message - User-friendly error message\n * @param status - HTTP status code\n * @param details - Optional additional details\n * @param context - Optional request context\n * @returns Standard error response\n */\nexport function createApiErrorResponse(\n  code: ErrorCode,\n  message: string,\n  status: number,\n  details?: unknown,\n  context?: Record<string, unknown>\n): ApiErrorResponse {\n  return {\n    error: {\n      code,\n      message,\n      status,\n      timestamp: getCurrentTimestamp(),\n      requestId: generateRequestId(),\n      ...(details !== undefined && details !== null ? { details } : {}),\n      ...(context && { context }),\n    },\n  };\n}\n\n/**\n * Convert Zod validation errors to field errors\n *\n * @param zodError - Zod validation error\n * @returns Array of field validation errors\n */\nexport function zodsErrorToFieldErrors(\n  zodError: ZodError\n): ValidationFieldError[] {\n  return zodError.errors.map((error) => {\n    const fieldError: ValidationFieldError = {\n      field: error.path.join('.') || 'unknown',\n      message: error.message,\n      code: error.code,\n    };\n    // Some Zod error types have 'received' property\n    if ('received' in error) {\n      fieldError.received = (error as any).received;\n    }\n    return fieldError;\n  });\n}\n\n/**\n * Create a validation error response (400)\n *\n * @param fieldErrors - Array of field validation errors\n * @param context - Optional request context\n * @returns Validation error response\n */\nexport function createValidationErrorResponse(\n  fieldErrors: ValidationFieldError[],\n  context?: Record<string, unknown>\n): ValidationErrorResponse {\n  const errorCount = fieldErrors.length;\n  const message =\n    errorCount === 1\n      ? `Validation failed: ${fieldErrors[0].message}`\n      : `Validation failed on ${errorCount} field${errorCount > 1 ? 's' : ''}`;\n\n  return {\n    error: {\n      code: 'VALIDATION_ERROR',\n      message,\n      status: 400,\n      timestamp: getCurrentTimestamp(),\n      requestId: generateRequestId(),\n      fields: fieldErrors,\n      ...(context && { context }),\n    },\n  };\n}\n\n/**\n * Create a validation error response from Zod error\n *\n * @param zodError - Zod validation error\n * @param context - Optional request context\n * @returns Validation error response\n */\nexport function createValidationErrorResponseFromZod(\n  zodError: ZodError,\n  context?: Record<string, unknown>\n): ValidationErrorResponse {\n  const fieldErrors = zodsErrorToFieldErrors(zodError);\n  return createValidationErrorResponse(fieldErrors, context);\n}\n\n/**\n * Send an error response and handle response state\n *\n * @param res - Express response object\n * @param status - HTTP status code\n * @param code - Error code\n * @param message - Error message\n * @param details - Optional additional details\n * @param context - Optional request context\n */\nexport function sendErrorResponse(\n  res: Response,\n  status: number,\n  code: ErrorCode,\n  message: string,\n  details?: unknown,\n  context?: Record<string, unknown>\n): Response {\n  const response = createApiErrorResponse(code, message, status, details, context);\n  return res.status(status).json(response);\n}\n\n/**\n * Send a validation error response\n *\n * @param res - Express response object\n * @param fieldErrors - Array of field validation errors\n * @param context - Optional request context\n */\nexport function sendValidationErrorResponse(\n  res: Response,\n  fieldErrors: ValidationFieldError[],\n  context?: Record<string, unknown>\n): Response {\n  const response = createValidationErrorResponse(fieldErrors, context);\n  return res.status(400).json(response);\n}\n\n/**\n * Send a validation error response from Zod error\n *\n * @param res - Express response object\n * @param zodError - Zod validation error\n * @param context - Optional request context\n */\nexport function sendValidationErrorResponseFromZod(\n  res: Response,\n  zodError: ZodError,\n  context?: Record<string, unknown>\n): Response {\n  const response = createValidationErrorResponseFromZod(zodError, context);\n  return res.status(400).json(response);\n}\n\n/**\n * Common error response helpers for specific scenarios\n */\n\nexport function sendInvalidRequestError(\n  res: Response,\n  message: string,\n  details?: any\n): Response {\n  return sendErrorResponse(\n    res,\n    400,\n    'INVALID_REQUEST',\n    message,\n    details\n  );\n}\n\nexport function sendUnauthorizedError(\n  res: Response,\n  message: string = 'Authentication required'\n): Response {\n  return sendErrorResponse(\n    res,\n    401,\n    'UNAUTHORIZED',\n    message\n  );\n}\n\nexport function sendForbiddenError(\n  res: Response,\n  message: string = 'Access denied'\n): Response {\n  return sendErrorResponse(\n    res,\n    403,\n    'FORBIDDEN',\n    message\n  );\n}\n\nexport function sendTierInsufficientError(\n  res: Response,\n  requiredTier: string,\n  currentTier: string = 'free'\n): Response {\n  return sendErrorResponse(\n    res,\n    403,\n    'TIER_INSUFFICIENT',\n    `This feature requires ${requiredTier} tier`,\n    { required_tier: requiredTier, current_tier: currentTier }\n  );\n}\n\nexport function sendQuotaExceededError(\n  res: Response,\n  reason: string = 'Quota exceeded'\n): Response {\n  return sendErrorResponse(\n    res,\n    402,\n    'QUOTA_EXCEEDED',\n    reason\n  );\n}\n\nexport function sendFileTooLargeError(\n  res: Response,\n  fileSizeMB: number,\n  maxSizeMB: number,\n  currentTier?: string\n): Response {\n  return sendErrorResponse(\n    res,\n    403,\n    'FILE_TOO_LARGE',\n    `File size exceeds limit`,\n    {\n      file_size_mb: fileSizeMB,\n      max_size_mb: maxSizeMB,\n    },\n    currentTier ? { current_tier: currentTier } : undefined\n  );\n}\n\nexport function sendInvalidFileTypeError(\n  res: Response,\n  mimeType: string,\n  requiredTier?: string,\n  currentTier?: string\n): Response {\n  return sendErrorResponse(\n    res,\n    403,\n    'INVALID_FILE_TYPE',\n    `File type not allowed`,\n    {\n      mime_type: mimeType,\n      ...(requiredTier && { required_tier: requiredTier }),\n    },\n    currentTier ? { current_tier: currentTier } : undefined\n  );\n}\n\nexport function sendInternalServerError(\n  res: Response,\n  message: string = 'Internal server error',\n  details?: unknown\n): Response {\n  return sendErrorResponse(\n    res,\n    500,\n    'INTERNAL_ERROR',\n    message,\n    details\n  );\n}\n\nexport function sendServiceUnavailableError(\n  res: Response,\n  message: string = 'Service temporarily unavailable'\n): Response {\n  return sendErrorResponse(\n    res,\n    503,\n    'SERVICE_UNAVAILABLE',\n    message\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/utils/exif-stripper.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/utils/extraction-helpers-new.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'spawn' is defined but never used.","line":10,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'existsSync' is defined but never used.","line":11,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'normalizeTier' is defined but never used.","line":12,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AuthRequest' is defined but never used.","line":13,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'currentDirPath' is assigned a value but never used.","line":17,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1387,1390],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1387,1390],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1422,1425],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1422,1425],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1453,1456],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1453,1456],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1483,1486],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1483,1486],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1519,1522],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1519,1522],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1554,1557],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1554,1557],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1591,1594],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1591,1594],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1628,1631],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1628,1631],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1663,1666],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1663,1666],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1698,1701],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1698,1701],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1749,1752],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1749,1752],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1791,1794],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1791,1794],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1824,1827],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1824,1827],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1858,1861],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1858,1861],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1894,1897],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1894,1897],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1929,1932],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1929,1932],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1972,1975],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1972,1975],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":65,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2017,2020],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2017,2020],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2062,2065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2062,2065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2110,2113],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2110,2113],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2160,2163],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2160,2163],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":69,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2206,2209],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2206,2209],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2255,2258],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2255,2258],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2300,2303],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2300,2303],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2347,2350],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2347,2350],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2394,2397],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2394,2397],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":74,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2449,2452],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2449,2452],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2504,2507],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2504,2507],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":76,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2549,2552],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2549,2552],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2599,2602],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2599,2602],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2640,2643],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2640,2643],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2680,2683],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2680,2683],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":80,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2722,2725],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2722,2725],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":81,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2772,2775],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2772,2775],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2847,2850],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2847,2850],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2899,2902],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2899,2902],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3154,3157],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3154,3157],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3204,3207],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3204,3207],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":95,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3253,3256],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3253,3256],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":154,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4994,4997],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4994,4997],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":158,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5081,5084],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5081,5084],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":265,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":265,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8361,8364],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8361,8364],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":265,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":265,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8383,8386],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8383,8386],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":266,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":266,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8422,8425],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8422,8425],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":291,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":291,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9063,9066],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9063,9066],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":292,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":292,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9086,9089],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9086,9089],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":293,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":293,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9128,9131],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9128,9131],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":313,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":313,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9538,9541],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9538,9541],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":314,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":314,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9561,9564],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9561,9564],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":315,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":315,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9610,9613],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9610,9613],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":334,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":334,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10010,10013],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10010,10013],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":368,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":368,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10771,10774],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10771,10774],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'metadata' is defined but never used. Allowed unused args must match /^_/u.","line":383,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":383,"endColumn":41},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":383,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":383,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11088,11091],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11088,11091],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'filePath' is defined but never used. Allowed unused args must match /^_/u.","line":404,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":404,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tier' is defined but never used. Allowed unused args must match /^_/u.","line":405,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":405,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'includePerformanceMetrics' is defined but never used. Allowed unused args must match /^_/u.","line":406,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":406,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'enableAdvancedAnalysis' is defined but never used. Allowed unused args must match /^_/u.","line":407,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":407,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'storeMetadata' is defined but never used. Allowed unused args must match /^_/u.","line":408,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":408,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":64,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * New extraction helpers using the refactored metadata engine.\n *\n * This module provides compatibility functions that use the new modular\n * architecture while maintaining the same API as the original helpers.\n */\n\nimport path from 'path';\nimport fs from 'fs/promises';\nimport { spawn } from 'child_process';\nimport { existsSync } from 'fs';\nimport { normalizeTier } from '@shared/tierConfig';\nimport type { AuthRequest } from '../auth';\n\n// Get the utils directory - compatible with both ESM and CommonJS\nconst projectRoot = process.cwd();\nconst currentDirPath = path.join(projectRoot, 'server', 'utils');\n\n// Import the new refactored engine\n// import { extract_comprehensive_metadata_new } from '../extractor/core/comprehensive_engine';\n\n// Re-export original helper functions for compatibility\nexport {\n  transformMetadataForFrontend,\n  normalizeEmail,\n  getSessionId,\n  cleanupTempFile,\n} from './extraction-helpers';\n\n// Re-export the original types for compatibility\nexport interface PythonMetadataResponse {\n  extraction_info: {\n    timestamp: string;\n    tier: string;\n    engine_version: string;\n    libraries: Record<string, boolean>;\n    fields_extracted: number;\n    locked_categories: number;\n    processing_ms?: number;\n  };\n  file: {\n    path: string;\n    name: string;\n    stem: string;\n    extension: string;\n    mime_type: string;\n  };\n  summary: Record<string, any>;\n  filesystem: Record<string, any>;\n  hashes: Record<string, any>;\n  image: Record<string, any> | null;\n  exif: Record<string, any> | null;\n  gps: Record<string, any> | null;\n  video: Record<string, any> | null;\n  audio: Record<string, any> | null;\n  pdf: Record<string, any> | null;\n  svg: Record<string, any> | null;\n  extended_attributes: Record<string, any> | null;\n  calculated: Record<string, any>;\n  forensic: Record<string, any>;\n  makernote: Record<string, any> | null;\n  iptc: Record<string, any> | null;\n  xmp: Record<string, any> | null;\n  normalized?: Record<string, any> | null;\n  web_metadata?: Record<string, any> | null;\n  social_media?: Record<string, any> | null;\n  mobile_metadata?: Record<string, any> | null;\n  forensic_security?: Record<string, any> | null;\n  action_camera?: Record<string, any> | null;\n  print_publishing?: Record<string, any> | null;\n  workflow_dam?: Record<string, any> | null;\n  audio_advanced?: Record<string, any> | null;\n  video_advanced?: Record<string, any> | null;\n  steganography_analysis?: Record<string, any> | null;\n  manipulation_detection?: Record<string, any> | null;\n  ai_detection?: Record<string, any> | null;\n  timeline_analysis?: Record<string, any> | null;\n  iptc_raw?: Record<string, any> | null;\n  xmp_raw?: Record<string, any> | null;\n  thumbnail?: Record<string, any> | null;\n  perceptual_hashes?: Record<string, any> | null;\n  locked_fields: string[];\n  burned_metadata?: Record<string, any> | null;\n  metadata_comparison?: Record<string, any> | null;\n  advanced_analysis?: {\n    enabled: boolean;\n    processing_time_ms: number;\n    modules_run: string[];\n    forensic_score: number;\n    authenticity_assessment: string;\n  } | null;\n  // Specialized Modules\n  medical_imaging?: Record<string, any> | null;\n  astronomical_data?: Record<string, any> | null;\n  registry_summary?: Record<string, any>;\n}\n\n/**\n * New metadata extraction function using the refactored engine.\n * Maintains compatibility with the original API while using the new architecture.\n */\nexport async function extractMetadataWithPythonNew(\n  filePath: string,\n  tier: string,\n  includePerformanceMetrics: boolean = false,\n  enableAdvancedAnalysis: boolean = false,\n  storeMetadata: boolean = false\n): Promise<PythonMetadataResponse> {\n  try {\n    // Get file information\n    const fileStats = await fs.stat(filePath);\n    const pathInfo = path.parse(filePath);\n    const mimeType = await detectMimeType(filePath);\n\n    // Record start time for performance tracking\n    const startTime = Date.now();\n\n    // Use the new refactored engine\n    // const result = await extract_comprehensive_metadata_new(filePath, tier);\n    // TODO: Implement proper Python interop for the new engine\n    const result = { error: 'New engine not yet implemented in TypeScript' };\n\n    const processingTime = Date.now() - startTime;\n\n    // Transform the new format to the old format for compatibility\n    return transformNewResultToOldFormat(\n      result,\n      filePath,\n      pathInfo,\n      mimeType,\n      fileStats,\n      tier,\n      processingTime,\n      includePerformanceMetrics,\n      enableAdvancedAnalysis\n    );\n  } catch (error) {\n    console.error('New extraction failed, falling back to old engine:', error);\n    // Fallback to the original extraction method\n    return await extractMetadataWithPythonOriginal(\n      filePath,\n      tier,\n      includePerformanceMetrics,\n      enableAdvancedAnalysis,\n      storeMetadata\n    );\n  }\n}\n\n/**\n * Transform the new engine result to the old format for compatibility.\n */\nfunction transformNewResultToOldFormat(\n  newResult: any,\n  filePath: string,\n  pathInfo: path.ParsedPath,\n  mimeType: string,\n  fileStats: any,\n  tier: string,\n  processingTime: number,\n  includePerformanceMetrics: boolean,\n  enableAdvancedAnalysis: boolean\n): PythonMetadataResponse {\n  const metadata = newResult.metadata || {};\n  const extractionInfo = newResult.extraction_info || {};\n\n  // Extract different metadata categories\n  const fileInfo = metadata.file_info || {};\n  const exifData = metadata.exif || {};\n  const gpsData = metadata.gps || {};\n  const iptcData = metadata.iptc || {};\n  const xmpData = metadata.xmp || {};\n  const pilData = metadata.pil || {};\n\n  // Create registry summary for frontend\n  const registrySummary = {\n    image: {\n      exif: Object.keys(exifData).length,\n      iptc: Object.keys(iptcData).length,\n      xmp: Object.keys(xmpData).length,\n      mobile: 0, // Will be populated when mobile extractor is added\n      perceptual_hashes: 0, // Will be populated when hash extractor is added\n    },\n  };\n\n  // Determine locked fields based on tier\n  const lockedFields = getLockedFields(tier, metadata);\n\n  // Calculate field counts\n  const totalFields = countFields(metadata);\n  const lockedCategories = Math.max(0, 5 - getTierLevel(tier)); // Simplified logic\n\n  return {\n    extraction_info: {\n      timestamp: new Date().toISOString(),\n      tier,\n      engine_version: extractionInfo.engine_version || '4.1.0-refactored',\n      libraries: extractionInfo.libraries || {},\n      fields_extracted: totalFields,\n      locked_categories: lockedCategories,\n      processing_ms: processingTime,\n    },\n    file: {\n      path: filePath,\n      name: pathInfo.name,\n      stem: pathInfo.name,\n      extension: pathInfo.ext,\n      mime_type: mimeType,\n    },\n    summary: createSummary(metadata),\n    filesystem: fileInfo,\n    hashes: {}, // Will be populated when hash extractor is added\n    image: pilData,\n    exif: exifData,\n    gps: gpsData,\n    video: null, // Will be populated when video extractor is added\n    audio: null, // Will be populated when audio extractor is added\n    pdf: null, // Will be populated when document extractor is added\n    svg: null,\n    extended_attributes: {},\n    calculated: createCalculatedFields(metadata),\n    forensic: {},\n    makernote: extractMakerNotes(exifData),\n    iptc: iptcData,\n    xmp: xmpData,\n    locked_fields: lockedFields,\n    registry_summary: registrySummary,\n    // Add other fields as they become available\n    burned_metadata: null,\n    advanced_analysis: enableAdvancedAnalysis\n      ? createAdvancedAnalysis(metadata)\n      : null,\n  };\n}\n\n/**\n * Simple MIME type detection.\n */\nasync function detectMimeType(filePath: string): Promise<string> {\n  const ext = path.extname(filePath).toLowerCase();\n  const mimeMap: Record<string, string> = {\n    '.jpg': 'image/jpeg',\n    '.jpeg': 'image/jpeg',\n    '.png': 'image/png',\n    '.gif': 'image/gif',\n    '.bmp': 'image/bmp',\n    '.tiff': 'image/tiff',\n    '.tif': 'image/tiff',\n    '.webp': 'image/webp',\n    '.heic': 'image/heic',\n    '.heif': 'image/heif',\n    '.mp4': 'video/mp4',\n    '.avi': 'video/x-msvideo',\n    '.mov': 'video/quicktime',\n    '.mp3': 'audio/mpeg',\n    '.wav': 'audio/wav',\n    '.pdf': 'application/pdf',\n  };\n  return mimeMap[ext] || 'application/octet-stream';\n}\n\n/**\n * Create a summary of the metadata.\n */\nfunction createSummary(metadata: Record<string, any>): Record<string, any> {\n  const summary: Record<string, any> = {};\n\n  // Add key summary information\n  if (metadata.exif) {\n    summary.has_exif = Object.keys(metadata.exif).length > 0;\n    summary.exif_field_count = Object.keys(metadata.exif).length;\n  }\n\n  if (metadata.gps) {\n    summary.has_gps = Object.keys(metadata.gps).length > 0;\n    summary.gps_coordinates = metadata.gps.latitude && metadata.gps.longitude;\n  }\n\n  if (metadata.iptc) {\n    summary.has_iptc = Object.keys(metadata.iptc).length > 0;\n    summary.iptc_field_count = Object.keys(metadata.iptc).length;\n  }\n\n  return summary;\n}\n\n/**\n * Create calculated fields.\n */\nfunction createCalculatedFields(\n  metadata: Record<string, any>\n): Record<string, any> {\n  const calculated: Record<string, any> = {};\n\n  // Add any calculated fields based on the metadata\n  if (metadata.exif) {\n    calculated.exif_field_count = Object.keys(metadata.exif).length;\n  }\n\n  if (metadata.gps) {\n    calculated.has_location = !!(\n      metadata.gps.latitude && metadata.gps.longitude\n    );\n  }\n\n  return calculated;\n}\n\n/**\n * Extract maker notes from EXIF data.\n */\nfunction extractMakerNotes(\n  exifData: Record<string, any>\n): Record<string, any> | null {\n  const makerNotes: Record<string, any> = {};\n\n  for (const [key, value] of Object.entries(exifData)) {\n    if (\n      key.toLowerCase().includes('maker') ||\n      key.toLowerCase().includes('makernote')\n    ) {\n      makerNotes[key] = value;\n    }\n  }\n\n  return Object.keys(makerNotes).length > 0 ? makerNotes : null;\n}\n\n/**\n * Get locked fields based on tier.\n */\nfunction getLockedFields(\n  tier: string,\n  metadata: Record<string, any>\n): string[] {\n  const tierLevel = getTierLevel(tier);\n  const lockedFields: string[] = [];\n\n  // Simple logic: higher tiers unlock more fields\n  if (tierLevel < 2) {\n    // Lock some advanced fields for lower tiers\n    if (metadata.exif) {\n      const exifKeys = Object.keys(metadata.exif);\n      lockedFields.push(...exifKeys.slice(10)); // Lock fields beyond the first 10\n    }\n  }\n\n  return lockedFields;\n}\n\n/**\n * Get tier level as a number.\n */\nfunction getTierLevel(tier: string): number {\n  const tierMap: Record<string, number> = {\n    free: 0,\n    basic: 1,\n    super: 2,\n    premium: 3,\n    enterprise: 4,\n  };\n  return tierMap[tier.toLowerCase()] || 0;\n}\n\n/**\n * Count total fields in metadata.\n */\nfunction countFields(metadata: Record<string, any>): number {\n  let count = 0;\n\n  for (const section of Object.values(metadata)) {\n    if (typeof section === 'object' && section !== null) {\n      count += Object.keys(section).length;\n    }\n  }\n\n  return count;\n}\n\n/**\n * Create advanced analysis data.\n */\nfunction createAdvancedAnalysis(metadata: Record<string, any>): {\n  enabled: boolean;\n  processing_time_ms: number;\n  modules_run: string[];\n  forensic_score: number;\n  authenticity_assessment: string;\n} {\n  return {\n    enabled: true,\n    processing_time_ms: 0, // Will be populated with actual timing\n    modules_run: ['image_extractor'],\n    forensic_score: 0.5, // Simplified scoring\n    authenticity_assessment: 'basic_analysis_complete',\n  };\n}\n\n/**\n * Original extraction function for fallback.\n * This would call the old Python engine as a backup.\n */\nasync function extractMetadataWithPythonOriginal(\n  filePath: string,\n  tier: string,\n  includePerformanceMetrics: boolean,\n  enableAdvancedAnalysis: boolean,\n  storeMetadata: boolean\n): Promise<PythonMetadataResponse> {\n  // For now, throw an error to indicate fallback is not implemented\n  // In a full implementation, this would call the original Python script\n  throw new Error('Fallback to original engine not implemented yet');\n}\n\n// Re-export the new function with the original name for drop-in replacement\nexport const extractMetadataWithPython = extractMetadataWithPythonNew;\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/utils/extraction-helpers.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2049,2052],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2049,2052],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":69,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2084,2087],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2084,2087],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2115,2118],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2115,2118],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2145,2148],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2145,2148],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2181,2184],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2181,2184],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2216,2219],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2216,2219],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":74,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2253,2256],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2253,2256],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2290,2293],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2290,2293],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":76,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2325,2328],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2325,2328],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2360,2363],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2360,2363],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2411,2414],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2411,2414],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2453,2456],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2453,2456],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":80,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2486,2489],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2486,2489],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":81,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2520,2523],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2520,2523],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2556,2559],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2556,2559],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2591,2594],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2591,2594],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2634,2637],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2634,2637],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2679,2682],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2679,2682],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":86,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2724,2727],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2724,2727],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2772,2775],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2772,2775],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2822,2825],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2822,2825],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":89,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2868,2871],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2868,2871],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2917,2920],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2917,2920],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2962,2965],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2962,2965],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":92,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3009,3012],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3009,3012],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3056,3059],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3056,3059],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3111,3114],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3111,3114],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":95,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3166,3169],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3166,3169],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":96,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3211,3214],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3211,3214],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":97,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3261,3264],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3261,3264],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3302,3305],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3302,3305],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3342,3345],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3342,3345],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":100,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3384,3387],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3384,3387],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":101,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3434,3437],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3434,3437],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3509,3512],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3509,3512],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":104,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3561,3564],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3561,3564],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":113,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3816,3819],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3816,3819],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3866,3869],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3866,3869],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":115,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3918,3921],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3918,3921],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":116,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3973,3976],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3973,3976],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":117,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4021,4024],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4021,4024],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":118,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4075,4078],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4075,4078],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":119,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4127,4130],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4127,4130],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":120,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4177,4180],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4177,4180],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":121,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4229,4232],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4229,4232],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":122,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4286,4289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4286,4289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":123,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4343,4346],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4343,4346],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":124,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4394,4397],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4394,4397],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":125,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":125,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4445,4448],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4445,4448],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":126,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4502,4505],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4502,4505],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":127,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4553,4556],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4553,4556],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":128,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4602,4605],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4602,4605],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":129,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4663,4666],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4663,4666],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":130,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4716,4719],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4716,4719],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":131,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4769,4772],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4769,4772],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":132,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4831,4834],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4831,4834],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":176,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":176,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5837,5840],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5837,5840],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":180,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":180,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5916,5919],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5916,5919],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":190,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":190,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6125,6128],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6125,6128],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":191,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":191,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6164,6167],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6164,6167],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":230,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":230,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7300,7303],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7300,7303],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":275,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":275,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8676,8679],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8676,8679],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":276,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":276,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8707,8710],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8707,8710],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":281,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":281,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8830,8833],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8830,8833],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":293,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":293,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9103,9106],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9103,9106],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":294,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":294,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9138,9141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9138,9141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":295,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":295,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9166,9169],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9166,9169],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":296,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":296,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9205,9208],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9205,9208],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":297,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":297,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9238,9241],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9238,9241],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":298,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":298,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9267,9270],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9267,9270],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":299,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":299,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9297,9300],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9297,9300],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":300,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":300,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9334,9337],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9334,9337],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":301,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":301,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9371,9374],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9371,9374],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":302,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":302,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9406,9409],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9406,9409],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":303,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":303,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9441,9444],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9441,9444],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":304,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":304,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9482,9485],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9482,9485],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":305,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":305,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9518,9521],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9518,9521],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":306,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":306,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9553,9556],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9553,9556],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":307,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":307,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9596,9599],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9596,9599],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":309,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":309,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9670,9673],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9670,9673],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":317,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":317,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9900,9903],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9900,9903],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":321,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":321,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10049,10052],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10049,10052],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":354,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":354,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11152,11155],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11152,11155],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":355,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":355,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11184,11187],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11184,11187],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":392,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":392,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12097,12100],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12097,12100],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":393,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":393,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12129,12132],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12129,12132],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":395,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":395,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12222,12225],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12222,12225],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":432,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":432,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13435,13438],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13435,13438],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":433,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":433,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13478,13481],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13478,13481],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":481,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":481,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15109,15112],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15109,15112],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":549,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":549,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18021,18024],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18021,18024],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":595,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":595,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19550,19553],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19550,19553],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":596,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":596,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19615,19618],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19615,19618],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":598,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":598,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19722,19725],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19722,19725],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":599,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":599,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19792,19795],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19792,19795],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":601,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":601,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19935,19938],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19935,19938],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":602,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":602,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19991,19994],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19991,19994],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":611,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":611,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20289,20292],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20289,20292],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":619,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":619,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20695,20698],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20695,20698],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":620,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":620,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20724,20727],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20724,20727],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":632,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":632,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21155,21158],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21155,21158],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":634,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":634,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21232,21235],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21232,21235],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":635,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":635,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21286,21289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21286,21289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":637,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":637,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21397,21400],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21397,21400],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":652,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":652,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21813,21816],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21813,21816],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":657,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":657,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21991,21994],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21991,21994],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":662,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":662,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22142,22145],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22142,22145],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":670,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":670,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22355,22358],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22355,22358],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":676,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":676,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22536,22539],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22536,22539],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":686,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":686,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22793,22796],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22793,22796],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":686,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":686,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22815,22818],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22815,22818],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":111,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import path from 'path';\nimport fs from 'fs/promises';\nimport { spawn } from 'child_process';\nimport * as fsSync from 'fs';\nimport { normalizeTier } from '@shared/tierConfig';\nimport type { AuthRequest } from '../auth';\nimport { isPathSafe } from '../security-utils';\n\n// Get the server directory - resolve from project root\n// During tests, use process.cwd() which is the project root\n// During runtime, the app will be at the project root\nconst projectRoot = process.cwd();\nconst currentDirPath = path.join(projectRoot, 'server');\n\n// Python executable: prefer project venv, fall back to system python3\nconst venvCandidates = [\n  path.join(currentDirPath, '..', '..', '.venv', 'bin', 'python3'),\n  path.join(currentDirPath, '..', '..', 'venv', 'bin', 'python3'),\n  path.join(currentDirPath, '..', '..', '.venv', 'bin', 'python'),\n  path.join(currentDirPath, '..', '..', 'venv', 'bin', 'python'),\n];\n\nexport function findPythonExecutable(): string {\n  if (process.env.PYTHON_EXECUTABLE && process.env.PYTHON_EXECUTABLE.length)\n    return process.env.PYTHON_EXECUTABLE;\n\n  for (const candidate of venvCandidates) {\n    try {\n      if (fsSync.existsSync(candidate)) return candidate;\n    } catch {\n      // ignore\n    }\n  }\n\n  // Last resort: rely on system python3 in PATH\n  return 'python3';\n}\n\nexport const pythonExecutable = findPythonExecutable();\n\nexport const PYTHON_SCRIPT_PATH = path.join(\n  currentDirPath,\n  'extractor',\n  'comprehensive_metadata_engine.py'\n);\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface PythonMetadataResponse {\n  extraction_info: {\n    timestamp: string;\n    tier: string;\n    engine_version: string;\n    libraries: Record<string, boolean>;\n    fields_extracted: number;\n    locked_categories: number;\n    processing_ms?: number;\n  };\n  file: {\n    path: string;\n    name: string;\n    stem: string;\n    extension: string;\n    mime_type: string;\n  };\n  summary: Record<string, any>;\n  filesystem: Record<string, any>;\n  hashes: Record<string, any>;\n  image: Record<string, any> | null;\n  exif: Record<string, any> | null;\n  gps: Record<string, any> | null;\n  video: Record<string, any> | null;\n  audio: Record<string, any> | null;\n  pdf: Record<string, any> | null;\n  svg: Record<string, any> | null;\n  extended_attributes: Record<string, any> | null;\n  calculated: Record<string, any>;\n  forensic: Record<string, any>;\n  makernote: Record<string, any> | null;\n  iptc: Record<string, any> | null;\n  xmp: Record<string, any> | null;\n  normalized?: Record<string, any> | null;\n  web_metadata?: Record<string, any> | null;\n  social_media?: Record<string, any> | null;\n  mobile_metadata?: Record<string, any> | null;\n  forensic_security?: Record<string, any> | null;\n  action_camera?: Record<string, any> | null;\n  print_publishing?: Record<string, any> | null;\n  workflow_dam?: Record<string, any> | null;\n  audio_advanced?: Record<string, any> | null;\n  video_advanced?: Record<string, any> | null;\n  steganography_analysis?: Record<string, any> | null;\n  manipulation_detection?: Record<string, any> | null;\n  ai_detection?: Record<string, any> | null;\n  timeline_analysis?: Record<string, any> | null;\n  iptc_raw?: Record<string, any> | null;\n  xmp_raw?: Record<string, any> | null;\n  thumbnail?: Record<string, any> | null;\n  perceptual_hashes?: Record<string, any> | null;\n  locked_fields: string[];\n  burned_metadata?: Record<string, any> | null;\n  metadata_comparison?: Record<string, any> | null;\n  advanced_analysis?: {\n    enabled: boolean;\n    processing_time_ms: number;\n    modules_run: string[];\n    forensic_score: number;\n    authenticity_assessment: string;\n  } | null;\n  // Specialized Modules\n  medical_imaging?: Record<string, any> | null;\n  astronomical_data?: Record<string, any> | null;\n  geospatial_analysis?: Record<string, any> | null;\n  scientific_instruments?: Record<string, any> | null;\n  drone_telemetry?: Record<string, any> | null;\n  blockchain_provenance?: Record<string, any> | null;\n  emerging_technology?: Record<string, any> | null;\n  document_analysis?: Record<string, any> | null;\n  scientific_research?: Record<string, any> | null;\n  multimedia_entertainment?: Record<string, any> | null;\n  industrial_manufacturing?: Record<string, any> | null;\n  financial_business?: Record<string, any> | null;\n  healthcare_medical?: Record<string, any> | null;\n  transportation_logistics?: Record<string, any> | null;\n  education_academic?: Record<string, any> | null;\n  legal_compliance?: Record<string, any> | null;\n  environmental_sustainability?: Record<string, any> | null;\n  social_media_digital?: Record<string, any> | null;\n  gaming_entertainment?: Record<string, any> | null;\n  forensic_analysis_integration?: Record<string, any> | null;\n  // Email and Communication metadata\n  email?: EmailMetadata | null;\n  error?: string;\n}\n\nexport interface PersonaInterpretation {\n  persona: string;\n  key_findings: string[];\n  plain_english_answers: {\n    when_taken: {\n      answer: string;\n      details: string;\n      source: string;\n      confidence: string;\n    };\n    location: {\n      has_location: boolean;\n      answer: string;\n      details: string;\n      confidence: string;\n      coordinates?: {\n        latitude: number;\n        longitude: number;\n        formatted: string;\n      };\n      readable_location?: string;\n      possible_reasons?: string[];\n    };\n    device: {\n      answer: string;\n      device_type: string;\n      details: {\n        make: string | null;\n        model: string | null;\n        software: string | null;\n      };\n      confidence: string;\n    };\n    authenticity: {\n      assessment: string;\n      confidence: string;\n      score: number;\n      answer: string;\n      checks_performed: Record<string, any>;\n      reasons: string[];\n    };\n  };\n  confidence_scores: Record<string, any>;\n  warnings: string[];\n  recommendations: string[];\n}\n\nexport interface EmailMetadata {\n  available: boolean;\n  registry?: {\n    available: boolean;\n    fields_extracted: number;\n    tags: Record<string, any>;\n    unknown_tags: Record<string, any>;\n    field_catalog: string[];\n  };\n  email_from?: string;\n  email_from_name?: string;\n  email_from_address?: string;\n  email_to?: string;\n  email_to_count?: number;\n  email_to_addresses?: string[];\n  email_cc?: string;\n  email_cc_count?: number;\n  email_cc_addresses?: string[];\n  email_bcc?: string;\n  email_bcc_count?: number;\n  email_bcc_addresses?: string[];\n  email_subject?: string;\n  email_date?: string;\n  email_message_id?: string;\n  email_in_reply_to?: string;\n  email_references?: string;\n  email_reply_to?: string;\n  email_sender?: string;\n  email_return_path?: string;\n  email_delivered_to?: string;\n  email_received_headers?: string[];\n  email_content_type?: string;\n  email_content_transfer_encoding?: string;\n  email_content_disposition?: string;\n  email_user_agent?: string;\n  email_x_mailer?: string;\n  email_originating_ip?: string;\n  email_x_sender?: string;\n  email_x_receiver?: string;\n  email_dkim_present?: boolean;\n  email_spf_result?: string;\n  email_authentication_results?: string;\n  email_spam_status?: string;\n  email_spam_score?: string;\n  email_virus_scanned?: string;\n  email_dkim?: Record<string, any>;\n  email_is_multipart?: boolean;\n  email_part_count?: number;\n  email_text_parts?: number;\n  email_html_parts?: number;\n  email_attachment_parts?: number;\n  email_content_main_type?: string;\n  email_content_charset?: string;\n  email_content_boundary?: string;\n  email_received_count?: number;\n  email_first_ip?: string;\n  email_first_hostname?: string;\n  email_first_protocol?: string;\n  email_last_ip?: string;\n  email_last_hostname?: string;\n  email_last_protocol?: string;\n  email_return_path_parsed?: string;\n  email_datetime_parsed?: string;\n  email_timestamp?: number;\n  email_day_of_week?: string;\n  email_hour_of_day?: number;\n  email_is_weekend?: boolean;\n  email_timezone?: string;\n  email_timezone_offset?: number;\n  email_is_reply?: boolean;\n  email_is_direct_reply?: boolean;\n  email_is_forward?: boolean;\n  email_thread_level?: number;\n  email_subject_length?: number;\n  email_raw_size?: number;\n  email_header_size?: number;\n  email_content_language?: string;\n  email_priority?: string;\n  email_encrypted?: boolean;\n  email_attachment_count?: number;\n  email_attachments?: Array<{\n    filename: string;\n    content_type: string;\n    size: number;\n    disposition?: string;\n  }>;\n  email_attachments_total_size?: number;\n  email_attachment_types?: string[];\n  email_contains_calendar?: boolean;\n  email_contains_vcard?: boolean;\n  calendar?: Record<string, any>;\n  vcard?: Record<string, any>;\n  spf_result?: string;\n  dkim_domain?: string;\n  dkim_selector?: string;\n  dkim_algorithm?: string;\n  [key: string]: any;\n}\n\nexport interface FrontendMetadataResponse {\n  filename: string;\n  filesize: string;\n  filetype: string;\n  mime_type: string;\n  tier: string;\n  fields_extracted: number;\n  processing_ms: number;\n  file_integrity: Record<string, string>;\n  filesystem: Record<string, any>;\n  calculated: Record<string, any>;\n  gps: Record<string, any> | null;\n  summary: Record<string, any>;\n  forensic: Record<string, any>;\n  exif: Record<string, any>;\n  image: Record<string, any> | null;\n  video: Record<string, any> | null;\n  audio: Record<string, any> | null;\n  pdf: Record<string, any> | null;\n  svg: Record<string, any> | null;\n  makernote: Record<string, any> | null;\n  iptc: Record<string, any> | null;\n  xmp: Record<string, any> | null;\n  normalized?: Record<string, any> | null;\n  locked_fields: string[];\n  extraction_info: Record<string, any>;\n  advanced_analysis?: {\n    enabled: boolean;\n    processing_time_ms: number;\n    modules_run: string[];\n    forensic_score: number;\n    authenticity_assessment: string;\n  };\n  forensic_analysis_integration?: Record<string, any> | null;\n  persona_interpretation?: PersonaInterpretation;\n  // Email and Communication metadata\n  email: EmailMetadata | null;\n  [key: string]: any;\n}\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\nexport function normalizeEmail(\n  email: string | null | undefined\n): string | null {\n  if (!email || typeof email !== 'string') return null;\n  const trimmed = email.trim().toLowerCase();\n  return trimmed.length > 3 && trimmed.includes('@') ? trimmed : null;\n}\n\nexport function getSessionId(req: AuthRequest): string | null {\n  const bodySession =\n    typeof req.body?.session_id === 'string' ? req.body.session_id : null;\n  const querySession =\n    typeof req.query?.session_id === 'string' ? req.query.session_id : null;\n  const headerSession =\n    typeof req.headers['x-session-id'] === 'string'\n      ? req.headers['x-session-id']\n      : null;\n  return bodySession || querySession || headerSession || null;\n}\n\nexport function transformMetadataForFrontend(\n  raw: PythonMetadataResponse,\n  originalFilename: string,\n  tier: string\n): FrontendMetadataResponse {\n  const normalizeGps = (\n    gps: Record<string, any> | null\n  ): Record<string, any> | null => {\n    if (!gps || typeof gps !== 'object') return null;\n    const latRaw =\n      gps.latitude ??\n      gps.lat ??\n      gps.latitude_decimal ??\n      gps.GPSLatitude ??\n      gps.gps_latitude ??\n      gps.Latitude;\n    const lonRaw =\n      gps.longitude ??\n      gps.lon ??\n      gps.longitude_decimal ??\n      gps.GPSLongitude ??\n      gps.gps_longitude ??\n      gps.Longitude;\n\n    const lat =\n      typeof latRaw === 'number' ? latRaw : parseFloat(String(latRaw));\n    const lon =\n      typeof lonRaw === 'number' ? lonRaw : parseFloat(String(lonRaw));\n\n    if (!Number.isFinite(lat) || !Number.isFinite(lon)) {\n      return null;\n    }\n\n    const googleMapsUrl =\n      gps.google_maps_url || `https://maps.google.com/?q=${lat},${lon}`;\n\n    return {\n      latitude: lat,\n      longitude: lon,\n      google_maps_url: googleMapsUrl,\n    };\n  };\n\n  const flattenObject = (\n    obj: Record<string, any> | null\n  ): Record<string, any> => {\n    if (!obj || typeof obj !== 'object') return {};\n    const flat: Record<string, any> = {};\n\n    // Flatten nested objects\n    Object.entries(obj).forEach(([key, value]) => {\n      if (value && typeof value === 'object' && !Array.isArray(value)) {\n        Object.entries(value).forEach(([subKey, subValue]) => {\n          flat[`${key}_${subKey}`] = subValue;\n        });\n      } else {\n        flat[key] = value;\n      }\n    });\n\n    return flat;\n  };\n\n  const cleanedGps = normalizeGps(raw.gps);\n  const exifData = raw.exif && Object.keys(raw.exif).length > 0 ? raw.exif : {};\n  const iptcData =\n    raw.iptc && Object.keys(raw.iptc).length > 0 ? raw.iptc : null;\n  const xmpData = raw.xmp && Object.keys(raw.xmp).length > 0 ? raw.xmp : null;\n  const mobileData =\n    raw.mobile_metadata && Object.keys(raw.mobile_metadata).length > 0\n      ? raw.mobile_metadata\n      : null;\n\n  const parseWhatsappFilenameDate = (name?: string) => {\n    if (!name) return null;\n    const match = name.match(\n      /WhatsApp Image (\\d{4})-(\\d{2})-(\\d{2}) at (\\d{2})\\.(\\d{2})\\.(\\d{2})/i\n    );\n    if (!match) return null;\n    const [, year, month, day, hour, minute, second] = match;\n    return new Date(`${year}-${month}-${day}T${hour}:${minute}:${second}`);\n  };\n\n  const captureDateExif =\n    (exifData as any)?.DateTimeOriginal ||\n    (exifData as any)?.CreateDate ||\n    null;\n  const filenameDate = parseWhatsappFilenameDate(originalFilename);\n  const captureDate =\n    captureDateExif || (filenameDate ? filenameDate.toISOString() : null);\n  const captureSource = captureDateExif\n    ? 'exif'\n    : filenameDate\n      ? 'filename'\n      : null;\n\n  const calculated = {\n    ...flattenObject(raw.calculated),\n    capture_date: captureDate,\n    capture_date_source: captureSource,\n    location_embedded: !!cleanedGps,\n  };\n\n  const registrySummary = {\n    image: {\n      exif: exifData ? Object.keys(exifData).length : 0,\n      iptc: iptcData ? Object.keys(iptcData).length : 0,\n      xmp: xmpData ? Object.keys(xmpData).length : 0,\n      mobile: mobileData ? Object.keys(mobileData).length : 0,\n      perceptual_hashes: raw.perceptual_hashes\n        ? Object.keys(raw.perceptual_hashes).length\n        : 0,\n    },\n    email: raw.email ? Object.keys(raw.email).length - 1 : 0,\n  };\n\n  return {\n    filename: originalFilename,\n    filesize: raw.filesystem?.size_human || raw.summary?.filesize || 'Unknown',\n    filetype:\n      raw.file?.extension?.toUpperCase().replace('.', '') ||\n      raw.summary?.filetype ||\n      'Unknown',\n    mime_type:\n      raw.file?.mime_type ||\n      raw.summary?.mime_type ||\n      'application/octet-stream',\n    tier: normalizeTier(tier),\n    fields_extracted: raw.extraction_info?.fields_extracted || 0,\n    processing_ms: raw.extraction_info?.processing_ms || 0,\n    file_integrity: raw.hashes?._locked ? { _locked: true } : raw.hashes || {},\n    filesystem: raw.filesystem || {},\n    filesystem_source: raw.filesystem\n      ? (raw.filesystem as any).source || 'server_temp_upload'\n      : null,\n    calculated,\n    gps: cleanedGps,\n    summary: { ...raw.summary, filename: originalFilename },\n    forensic: flattenObject(raw.forensic),\n    exif: exifData,\n    image: raw.image,\n    video: raw.video,\n    audio: raw.audio,\n    pdf: raw.pdf,\n    svg: raw.svg,\n    makernote: raw.makernote,\n    iptc: iptcData,\n    xmp: xmpData,\n    normalized: raw.normalized,\n    web_metadata: raw.web_metadata ?? null,\n    social_media: raw.social_media ?? null,\n    mobile_metadata: mobileData,\n    forensic_security: raw.forensic_security ?? null,\n    action_camera: raw.action_camera ?? null,\n    print_publishing: raw.print_publishing ?? null,\n    workflow_dam: raw.workflow_dam ?? null,\n    audio_advanced: raw.audio_advanced ?? null,\n    video_advanced: raw.video_advanced ?? null,\n    steganography_analysis: raw.steganography_analysis ?? null,\n    manipulation_detection: raw.manipulation_detection ?? null,\n    ai_detection: raw.ai_detection ?? null,\n    timeline_analysis: raw.timeline_analysis ?? null,\n    iptc_raw: raw.iptc_raw,\n    xmp_raw: raw.xmp_raw,\n    thumbnail: raw.thumbnail,\n    perceptual_hashes: raw.perceptual_hashes,\n    extended_attributes: raw.extended_attributes,\n    extended: raw.extended_attributes,\n    burned_metadata: raw.burned_metadata ?? null,\n    metadata_comparison: raw.metadata_comparison ?? null,\n    registry_summary: registrySummary,\n    locked_fields: raw.locked_fields || [],\n    extraction_info: raw.extraction_info || {},\n\n    // Specialized Modules\n    medical_imaging: raw.medical_imaging ?? null,\n    astronomical_data: raw.astronomical_data ?? null,\n    geospatial_analysis: raw.geospatial_analysis ?? null,\n    scientific_instruments: raw.scientific_instruments ?? null,\n    drone_telemetry: raw.drone_telemetry ?? null,\n    blockchain_provenance: raw.blockchain_provenance ?? null,\n    emerging_technology: raw.emerging_technology ?? null,\n    document_analysis: raw.document_analysis ?? null,\n    scientific_research: raw.scientific_research ?? null,\n    multimedia_entertainment: raw.multimedia_entertainment ?? null,\n    industrial_manufacturing: raw.industrial_manufacturing ?? null,\n    financial_business: raw.financial_business ?? null,\n    healthcare_medical: raw.healthcare_medical ?? null,\n    transportation_logistics: raw.transportation_logistics ?? null,\n    education_academic: raw.education_academic ?? null,\n    legal_compliance: raw.legal_compliance ?? null,\n    environmental_sustainability: raw.environmental_sustainability ?? null,\n    social_media_digital: raw.social_media_digital ?? null,\n    gaming_entertainment: raw.gaming_entertainment ?? null,\n\n    // Email and Communication metadata\n    email: raw.email?._locked\n      ? { _locked: true, available: false }\n      : (raw.email ?? null),\n\n    // Persona interpretation (if available from Python backend)\n    persona_interpretation: (raw as any).persona_interpretation ?? undefined,\n\n    // Forensic Analysis Integration (NEW: Phase 3.1)\n    forensic_analysis_integration:\n      raw.forensic_analysis_integration ?? undefined,\n  };\n}\n\n// Apply access-mode redactions in a single place so all routes behave consistently\nexport function applyAccessModeRedaction(\n  metadata: FrontendMetadataResponse,\n  mode: 'device_free' | 'trial_limited' | 'paid'\n) {\n  if (mode === 'trial_limited') {\n    // Current trial behavior: heavy redaction (same as before)\n    metadata.iptc = null;\n    metadata.xmp = null;\n    metadata.exif = {}; // EXIF cannot be null in FrontendMetadataResponse, so use empty object\n    metadata.iptc_raw = null;\n    metadata.xmp_raw = null;\n    metadata._trial_limited = true;\n    // Mark locked_fields conservatively\n    metadata.locked_fields = Array.from(\n      new Set([\n        ...(metadata.locked_fields || []),\n        'filesystem_details',\n        'hashes',\n        'extended_attributes',\n        'thumbnail',\n        'embedded_thumbnails',\n        'perceptual_hashes',\n        'makernote',\n        'gps',\n        'iptc',\n        'xmp',\n        'calculated',\n        'forensic',\n        'burned_metadata',\n        'metadata_comparison',\n      ])\n    );\n  } else if (mode === 'device_free') {\n    // Hybrid mode: keep high-value fields, redact only sensitive identifiers\n\n    // GPS: round coordinates to 2 decimals OR replace with presence flag\n    if (metadata.gps && typeof metadata.gps === 'object') {\n      const lat = Number((metadata.gps as any).latitude ?? NaN);\n      const lon = Number((metadata.gps as any).longitude ?? NaN);\n      if (Number.isFinite(lat) && Number.isFinite(lon)) {\n        (metadata.gps as any).latitude = Math.round(lat * 100) / 100;\n        (metadata.gps as any).longitude = Math.round(lon * 100) / 100;\n        // Remove precise map link to avoid exposing exact location\n        if ((metadata.gps as any).google_maps_url)\n          delete (metadata.gps as any).google_maps_url;\n      } else {\n        // No coordinates - keep gps null\n        metadata.gps = null;\n      }\n    }\n\n    // Burned metadata: keep presence and confidence, redact text and parsed precise location\n    if (metadata.burned_metadata) {\n      const bm = metadata.burned_metadata as any;\n      bm.extracted_text = null;\n      if (bm.parsed_data) {\n        if (bm.parsed_data.gps) delete bm.parsed_data.gps;\n        if (bm.parsed_data.plus_code) delete bm.parsed_data.plus_code;\n        // Coarsen address by removing street-level info if present\n        if (bm.parsed_data.location) {\n          // Keep only city/state/country if available\n          const loc = bm.parsed_data.location as any;\n          const coarse: any = {};\n          if (loc.city) coarse.city = loc.city;\n          if (loc.state) coarse.state = loc.state;\n          if (loc.country) coarse.country = loc.country;\n          bm.parsed_data.location = Object.keys(coarse).length ? coarse : null;\n        }\n      }\n    }\n\n    // Extended attributes: keep available/count, redact attribute values\n    if (\n      metadata.extended_attributes &&\n      (metadata.extended_attributes as any).attributes\n    ) {\n      const attrs = (metadata.extended_attributes as any).attributes;\n      const redacted: Record<string, any> = {};\n      Object.keys(attrs).forEach(k => (redacted[k] = null));\n      (metadata.extended_attributes as any).attributes = redacted;\n    }\n\n    // Filesystem: remove owner and sensitive internals\n    if (metadata.filesystem && typeof metadata.filesystem === 'object') {\n      [\n        'owner',\n        'owner_uid',\n        'group',\n        'group_gid',\n        'inode',\n        'device',\n        'permissions_octal',\n        'permissions_human',\n        'hard_links',\n      ].forEach(k => delete (metadata.filesystem as any)[k]);\n    }\n\n    // Thumbnail: keep presence + basic attrs only\n    if (metadata.thumbnail && typeof metadata.thumbnail === 'object') {\n      const t = metadata.thumbnail as any;\n      metadata.thumbnail = {\n        has_embedded: !!t.has_embedded,\n        width: t.width || null,\n        height: t.height || null,\n      } as any;\n    }\n\n    // Perceptual hashes: keep only basic hashes\n    if (\n      metadata.perceptual_hashes &&\n      typeof metadata.perceptual_hashes === 'object'\n    ) {\n      const p = metadata.perceptual_hashes as any;\n      metadata.perceptual_hashes = {\n        phash: p.phash || null,\n        dhash: p.dhash || null,\n        ahash: p.ahash || null,\n        whash: p.whash || null,\n      } as any;\n    }\n\n    // Enterprise-only bulky buckets: hide to avoid leaking heavy internals\n    [\n      'drone_telemetry',\n      'emerging_technology',\n      'synthetic_media_analysis',\n      'blockchain_provenance',\n    ].forEach(k => {\n      if ((metadata as any)[k]) (metadata as any)[k] = null;\n    });\n\n    // Update locked fields to reflect minimal redactions\n    metadata.locked_fields = Array.from(\n      new Set([...(metadata.locked_fields || []), 'gps', 'extended_attributes'])\n    );\n  }\n}\n\ntype ExtractOptions = {\n  ocr?: boolean;\n  maxDim?: number;\n};\n\nexport async function extractMetadataWithPython(\n  filePath: string,\n  tier: string,\n  includePerformanceMetrics: boolean = false,\n  enableAdvancedAnalysis: boolean = false,\n  storeMetadata: boolean = false,\n  opts: ExtractOptions = {}\n): Promise<PythonMetadataResponse> {\n  // Validate and sanitize the file path\n  const resolvedPath = path.resolve(filePath);\n  const tempDir = '/tmp/metaextract';\n  const allowedDirs = [tempDir, process.cwd()];\n\n  if (!isPathSafe(resolvedPath, allowedDirs)) {\n    throw new Error(`Invalid file path: path is outside allowed directories`);\n  }\n\n  // Ensure the file exists (use async access so it's mockable in tests)\n  try {\n    await fs.access(resolvedPath);\n  } catch {\n    throw new Error(`File not found: ${filePath}`);\n  }\n\n  return new Promise((resolve, reject) => {\n    const args = [PYTHON_SCRIPT_PATH, filePath, '--tier', tier];\n\n    if (includePerformanceMetrics) {\n      args.push('--performance');\n    }\n\n    if (enableAdvancedAnalysis) {\n      args.push('--advanced');\n    }\n\n    if (storeMetadata) {\n      args.push('--store');\n    }\n\n    if (opts?.ocr) {\n      args.push('--ocr');\n    }\n\n    const maxDim = typeof opts?.maxDim === 'number' ? opts.maxDim : 2048;\n    if (maxDim && Number.isFinite(maxDim)) {\n      args.push('--max-dim', String(maxDim));\n    }\n\n    // Log the Python process startup (opt-in, to support manual smoke)\n    if (process.env.METAEXTRACT_LOG_PY_ARGS === '1') {\n      console.log(\n        `[DEBUG] extractMetadataWithPython: tier=${tier}, file=${path.basename(filePath)}`\n      );\n      console.log(`Command: ${pythonExecutable} ${args.join(' ')}`);\n    }\n\n    const python = spawn(pythonExecutable, args);\n\n    let stdout = '';\n    let stderr = '';\n\n    const enablePyLogging =\n      process.env.NODE_ENV !== 'test' ||\n      process.env.METAEXTRACT_LOG_PY_ARGS === '1';\n\n    python.stdout.on('data', data => {\n      const dataStr = data.toString();\n      stdout += dataStr;\n      // Log large outputs in chunks to avoid overwhelming the console\n      if (enablePyLogging && dataStr.length > 1000) {\n        console.log(\n          `Python stdout (partial): ${dataStr.substring(0, 1000)}...`\n        );\n      }\n    });\n\n    python.stderr.on('data', data => {\n      const dataStr = data.toString();\n      stderr += dataStr;\n      // Log errors immediately when not running unit tests\n      if (enablePyLogging) {\n        console.error(`Python stderr: ${dataStr}`);\n      }\n    });\n\n    python.on('close', code => {\n      if (enablePyLogging) {\n        console.log(`Python extraction process exited with code: ${code}`);\n      }\n\n      if (code !== 0) {\n        const errorDetails = {\n          message: `Python extractor failed with code ${code}`,\n          stderr: stderr || 'No stderr output',\n          stdout: stdout || 'No stdout output',\n          command: `${pythonExecutable} ${args.join(' ')}`,\n          filePath,\n          tier,\n        };\n\n        if (enablePyLogging) {\n          console.error('Python extraction error details:', errorDetails);\n        }\n        reject(\n          new Error(`Python extractor failed: ${stderr || 'Unknown error'}`)\n        );\n        return;\n      }\n\n      if (!stdout) {\n        const error = 'Python extractor returned empty output';\n        if (enablePyLogging) {\n          console.error(error, {\n            stderr,\n            command: `${pythonExecutable} ${args.join(' ')}`,\n          });\n        }\n        reject(new Error(error));\n        return;\n      }\n\n      try {\n        const result = JSON.parse(stdout);\n        if (enablePyLogging) {\n          console.log(\n            `Successfully parsed Python extraction result for ${path.basename(\n              filePath\n            )}, ${result.extraction_info?.fields_extracted || 0} fields extracted`\n          );\n        }\n        resolve(result);\n      } catch (parseError) {\n        if (enablePyLogging) {\n          console.error(\n            'Failed to parse Python extraction output:',\n            parseError\n          );\n          console.error(\n            'Raw stdout (first 1000 chars):',\n            stdout.substring(0, 1000)\n          );\n          console.error('Raw stderr:', stderr.substring(0, 500));\n        }\n        reject(\n          new Error(\n            `Failed to parse metadata extraction result: ${\n              parseError instanceof Error\n                ? parseError.message\n                : 'Unknown parsing error'\n            }`\n          )\n        );\n      }\n    });\n\n    python.on('error', err => {\n      console.error('Failed to spawn Python extraction process:', err);\n      reject(new Error(`Failed to start Python extractor: ${err.message}`));\n    });\n\n    // Set timeout with detailed logging\n    const timeoutMs = 180000; // 3 minutes\n    const timeoutId = setTimeout(() => {\n      console.warn(\n        `Python extraction timeout after ${timeoutMs}ms for file: ${filePath}`\n      );\n      if (!python.killed) {\n        python.kill();\n        console.log(`Killed Python process for file: ${filePath}`);\n      }\n      reject(new Error(`Metadata extraction timed out after ${timeoutMs}ms`));\n    }, timeoutMs);\n\n    // Allow timer to not keep the Node process alive (so tests can exit)\n    if (typeof timeoutId.unref === 'function') {\n      timeoutId.unref();\n    }\n\n    // Clear timeout on completion\n    python.on('close', () => {\n      clearTimeout(timeoutId);\n    });\n  });\n}\n\nexport async function cleanupTempFile(tempPath: string | null): Promise<void> {\n  if (tempPath) {\n    try {\n      await fs.unlink(tempPath);\n    } catch (error) {\n      console.error('Failed to delete temp file:', error);\n    }\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/utils/free-quota-enforcement.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":135,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3960,3963],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3960,3963],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":137,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4035,4038],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4035,4038],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":152,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4391,4394],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4391,4394],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":315,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":315,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9147,9150],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9147,9150],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":399,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":399,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11487,11490],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11487,11490],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":449,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":449,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12884,12887],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12884,12887],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":481,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":481,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13771,13774],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13771,13774],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":482,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":482,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13838,13841],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13838,13841],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":503,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":503,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14439,14442],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14439,14442],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":542,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":542,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15520,15523],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15520,15523],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":543,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":543,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15574,15577],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15574,15577],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":545,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":545,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15632,15635],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15632,15635],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":546,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":546,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15699,15702],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15699,15702],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":547,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":547,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15771,15774],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15771,15774],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":548,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":548,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15827,15830],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15827,15830],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":551,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":551,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15923,15926],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15923,15926],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":552,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":552,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15977,15980],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15977,15980],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":554,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":554,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16035,16038],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16035,16038],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":555,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":555,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16102,16105],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16102,16105],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":556,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":556,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16156,16159],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16156,16159],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":557,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":557,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16212,16215],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16212,16215],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":563,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":563,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16422,16425],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16422,16425],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":564,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":564,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16478,16481],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16478,16481],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":566,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":566,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16559,16562],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16559,16562],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":567,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":567,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16593,16596],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16593,16596],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":577,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":577,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16868,16871],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16868,16871],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":578,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":578,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16937,16940],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16937,16940],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":579,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":579,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16997,17000],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16997,17000],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":604,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":604,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17735,17738],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17735,17738],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":609,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":609,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17899,17902],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17899,17902],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":610,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":610,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17938,17941],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17938,17941],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":611,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":611,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18008,18011],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18008,18011],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":612,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":612,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18067,18070],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18067,18070],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":613,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":613,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18132,18135],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18132,18135],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":34,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * MetaExtract Free Quota Enforcement System\n * Implements \"2 Free Images per Device\" with 4-tier protection\n *\n * Tier 1: Server-issued device tokens (not client-controllable)\n * Tier 2: IP rate limiting with fail-closed Redis fallback\n * Tier 3: Advanced fingerprinting and abuse scoring\n * Tier 4: Circuit breaker for load shedding\n *\n * Security changelog:\n * - 2026-01-07: Added server-issued device tokens (device-token.ts)\n * - 2026-01-07: Fixed fail-open Redis to use in-memory fallback\n * - 2026-01-07: Added circuit breaker for load shedding\n */\n\nimport crypto from 'crypto';\nimport { Request, Response, NextFunction } from 'express';\nimport { eq, sql } from 'drizzle-orm';\nimport { getDatabase } from '../db';\nimport { clientUsage } from '@shared/schema';\nimport { storage } from '../storage/index';\nimport { circuitBreaker } from './circuit-breaker';\nimport {\n  getOrCreateDeviceToken,\n  verifyDeviceToken as verifyServerDeviceToken,\n  isDeviceSuspicious,\n} from './device-token';\nimport { getOrSetSessionId } from './session-id';\n// import { trackImagesMvpEvent } from '../lib/images-mvp-analytics';\n\n// Token secret validation - fail fast if not set\nconst TOKEN_SECRET = process.env.TOKEN_SECRET ?? '';\nif (!TOKEN_SECRET) {\n  throw new Error(\n    'CRITICAL: TOKEN_SECRET environment variable is required for security. ' +\n      'Please set this in your .env file before starting the server. ' +\n      'Generate a strong random secret: openssl rand -hex 32'\n  );\n}\n\n// Configuration\nconst CONFIG = {\n  // Tier 1: Device Quota\n  FREE_LIMIT: 2,\n  TOKEN_EXPIRY_HOURS: 24 * 30, // 30 days\n  COOKIE_NAME: 'metaextract_client',\n  COOKIE_OPTIONS: {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    // Lax so device quota survives external checkout redirects.\n    sameSite: 'lax' as const,\n    maxAge: 1000 * 60 * 60 * 24 * 7, // 7 days - reduced for security\n  },\n\n  // Tier 2: Rate Limiting\n  IP_DAILY_LIMIT: 10,\n  IP_MINUTE_LIMIT: 2,\n  CLIENT_MINUTE_LIMIT: 2,\n\n  // Tier 3: Abuse Detection\n  ABUSE_SCORE_THRESHOLD: 0.7,\n  FINGERPRINT_COMPONENTS: [\n    'userAgent',\n    'platform',\n    'timezone',\n    'language',\n    'screenSize',\n  ],\n};\n\n/**\n * Generate cryptographically secure client token\n * Includes client_id, expiry, and HMAC signature\n */\nexport function generateClientToken(): string {\n  const clientId = crypto.randomUUID();\n  const expiry = Date.now() + CONFIG.TOKEN_EXPIRY_HOURS * 60 * 60 * 1000;\n  const payload = `${clientId}.${expiry}`;\n\n  // Create HMAC signature using validated TOKEN_SECRET\n  const signature = crypto\n    .createHmac('sha256', TOKEN_SECRET)\n    .update(payload)\n    .digest('hex');\n\n  return `${payload}.${signature}`;\n}\n\n/**\n * Verify and decode client token\n * Returns null if invalid or expired\n */\nexport function verifyClientToken(\n  token: string\n): { clientId: string; expiry: number } | null {\n  try {\n    const parts = token.split('.');\n    if (parts.length !== 3) return null;\n\n    const [clientId, expiryStr, signature] = parts;\n    const payload = `${clientId}.${expiryStr}`;\n\n    // Verify signature using validated TOKEN_SECRET\n    const expectedSignature = crypto\n      .createHmac('sha256', TOKEN_SECRET)\n      .update(payload)\n      .digest('hex');\n\n    if (signature !== expectedSignature) return null;\n\n    // Parse expiry\n    const expiry = parseInt(expiryStr, 10);\n    if (isNaN(expiry)) return null;\n\n    // Check expiry\n    if (Date.now() > expiry) return null;\n\n    return { clientId, expiry };\n  } catch (error) {\n    console.error('Token verification failed:', error);\n    return null;\n  }\n}\n\n/**\n * Generate lightweight device fingerprint\n * Used as additional abuse signal (not hard ban)\n */\nexport function generateDeviceFingerprint(req: Request): string {\n  const components = [\n    req.headers['user-agent'] || '',\n    req.headers['accept-language'] || '',\n    req.headers['accept'] || '',\n    // Add screen size if available from client\n    (req.body as any)?._screenSize || '',\n    // Add timezone if available\n    (req.body as any)?._timezone || '',\n  ];\n\n  const fingerprint = components.join('|');\n  return crypto.createHash('sha256').update(fingerprint).digest('hex');\n}\n\n/**\n * Calculate abuse score based on various signals\n * Score 0-1, where 1 is highest risk\n */\nexport function calculateAbuseScore(\n  clientId: string,\n  ip: string,\n  fingerprint: string,\n  recentActivity: any[]\n): number {\n  let score = 0;\n\n  // Signal 1: Multiple client IDs from same IP\n  const uniqueClientsFromIP = new Set(\n    recentActivity.filter(a => a.ip === ip).map(a => a.clientId)\n  ).size;\n  if (uniqueClientsFromIP > 3) score += 0.3;\n  if (uniqueClientsFromIP > 10) score += 0.2;\n\n  // Signal 2: High velocity\n  const recentRequests = recentActivity.filter(\n    a => a.timestamp > Date.now() - 60000\n  ); // Last minute\n  if (recentRequests.length > 10) score += 0.2;\n  if (recentRequests.length > 30) score += 0.2;\n\n  // Signal 3: Repeated quota hits with new tokens\n  const quotaHits = recentActivity.filter(a => a.action === 'quota_hit');\n  const newTokens = recentActivity.filter(a => a.action === 'new_token');\n  if (quotaHits.length > 2 && newTokens.length > 3) score += 0.2;\n\n  // Signal 4: Datacenter/Cloud IPs (optional enhancement)\n  // Could add IP reputation checking here\n\n  return Math.min(score, 1.0);\n}\n\n/**\n * Main quota enforcement middleware\n * Implements all 3 tiers of protection\n */\nexport async function enforceFreeQuota(\n  req: Request,\n  res: Response,\n  next: NextFunction\n): Promise<void> {\n  try {\n    const startTime = Date.now();\n    const ip = req.ip || req.connection.remoteAddress || 'unknown';\n    const userAgent = req.headers['user-agent'] || 'unknown';\n\n    // Get or create client token (defensive: req.cookies may be undefined in some test environments)\n    let clientToken = req.cookies?.[CONFIG.COOKIE_NAME];\n    let clientId: string;\n    let isNewToken = false;\n\n    if (!clientToken) {\n      // New visitor - generate token\n      clientToken = generateClientToken();\n      res.cookie(CONFIG.COOKIE_NAME, clientToken, CONFIG.COOKIE_OPTIONS);\n      const decoded = verifyClientToken(clientToken);\n      clientId = decoded!.clientId;\n      isNewToken = true;\n    } else {\n      // Existing visitor - verify token\n      const decoded = verifyClientToken(clientToken);\n      if (!decoded) {\n        // Invalid token - generate new one\n        clientToken = generateClientToken();\n        res.cookie(CONFIG.COOKIE_NAME, clientToken, CONFIG.COOKIE_OPTIONS);\n        const newDecoded = verifyClientToken(clientToken);\n        clientId = newDecoded!.clientId;\n        isNewToken = true;\n      } else {\n        clientId = decoded.clientId;\n      }\n    }\n\n    // Track this request for analytics\n    await trackRequest(clientId, ip, userAgent, startTime);\n\n    // Check if this is an extraction request (not just page view)\n    if (req.method === 'POST' && req.path === '/api/images_mvp/extract') {\n      await handleExtractionRequest(req, res, next, {\n        clientId,\n        ip,\n        userAgent,\n        isNewToken,\n        startTime,\n      });\n    } else {\n      // Non-extraction request - allow but track\n      next();\n    }\n  } catch (error) {\n    console.error('Quota enforcement error:', error);\n    // Don't break the app - allow request but log error\n    next();\n  }\n}\n\n/**\n * Handle extraction requests with full quota enforcement\n */\nasync function handleExtractionRequest(\n  req: Request,\n  res: Response,\n  next: NextFunction,\n  context: {\n    clientId: string;\n    ip: string;\n    userAgent: string;\n    isNewToken: boolean;\n    startTime: number;\n  }\n): Promise<void> {\n  const { clientId, ip } = context;\n\n  try {\n    // Check if user has trial email (bypasses free limits)\n    const trialEmail = req.body?.trial_email;\n    if (trialEmail) {\n      // Trial users bypass free limits - let them through\n      next();\n      return;\n    }\n\n    // Remove SKIP_FREE_LIMITS bypass - security must be enforced in all environments\n    // Development testing should use test accounts with credits, not bypass security\n\n    // Get current usage for this client\n    const usage = await getClientUsage(clientId);\n    const currentCount = usage?.freeUsed || 0;\n\n    // Check quota\n    if (currentCount >= CONFIG.FREE_LIMIT) {\n      const hasCredits = await hasCreditsAvailable(req, res);\n      if (hasCredits) {\n        next();\n        return;\n      }\n      // Quota exceeded - handle based on abuse score\n      await handleQuotaExceeded(req, res, clientId, ip);\n      return;\n    }\n\n    // Within quota - proceed but track usage\n    await incrementUsage(clientId, ip);\n\n    // Log successful free usage\n    // trackImagesMvpEvent('free_extraction_used', {\n    //   client_id: clientId,\n    //   ip: ip,\n    //   usage_count: currentCount + 1,\n    //   is_new_token: isNewToken,\n    // });\n\n    // Allow the extraction\n    next();\n  } catch (error) {\n    console.error('Extraction handling error:', error);\n    // Allow request but log error - don't break the app\n    next();\n  }\n}\n\nasync function hasCreditsAvailable(\n  req: Request,\n  res: Response\n): Promise<boolean> {\n  try {\n    const userId = (req as any).user?.id as string | undefined;\n    const balanceKey = userId\n      ? `images_mvp:user:${userId}`\n      : `images_mvp:${getOrSetSessionId(req, res)}`;\n    const balance = await storage.getOrCreateCreditBalance(balanceKey, userId);\n    return (balance?.credits ?? 0) > 0;\n  } catch (error) {\n    console.error('Credit availability check failed:', error);\n    return false;\n  }\n}\n\n/**\n * Handle quota exceeded situations\n * Escalates based on abuse score\n */\nexport async function handleQuotaExceeded(\n  req: Request,\n  res: Response,\n  clientId: string,\n  ip: string\n): Promise<void> {\n  try {\n    // Calculate abuse score\n    const recentActivity = await getRecentActivity(clientId, ip);\n    const fingerprint = generateDeviceFingerprint(req);\n    const abuseScore = calculateAbuseScore(\n      clientId,\n      ip,\n      fingerprint,\n      recentActivity\n    );\n\n    // Log quota exceeded event\n    // trackImagesMvpEvent('quota_exceeded', {\n    //   client_id: clientId,\n    //   ip: ip,\n    //   abuse_score: abuseScore,\n    //   recent_activity_count: recentActivity.length,\n    // });\n\n    // Respond based on abuse score\n    if (abuseScore > CONFIG.ABUSE_SCORE_THRESHOLD) {\n      // High abuse score - require CAPTCHA\n      res.status(429).json({\n        error: 'Quota exceeded',\n        message:\n          'Free limit reached on this device. Complete verification to continue.',\n        requires_captcha: true,\n        abuse_score: abuseScore,\n      });\n    } else {\n      // Normal quota exceeded - show paywall\n      res.status(429).json({\n        error: 'Quota exceeded',\n        message:\n          'Free limit reached on this device. Purchase credits to continue.',\n        credits_required: 1,\n        current_usage: CONFIG.FREE_LIMIT,\n      });\n    }\n  } catch (error) {\n    console.error('Quota exceeded handling error:', error);\n    // Fallback response\n    res.status(429).json({\n      error: 'Quota exceeded',\n      message:\n        'Free limit reached on this device. Purchase credits to continue.',\n      credits_required: 1,\n    });\n  }\n}\n\n/**\n * Database operations for usage tracking\n */\n\nexport async function getClientUsage(\n  clientId: string\n): Promise<{ freeUsed: number } | null> {\n  try {\n    // Try to get from database first\n    if (isDatabaseConnected()) {\n      try {\n        const db = getDatabase() as any;\n        if (typeof db.select !== 'function') {\n          throw new Error('Database client missing select()');\n        }\n        const result = await db\n          .select({ freeUsed: clientUsage.freeUsed })\n          .from(clientUsage)\n          .where(eq(clientUsage.clientId, clientId))\n          .limit(1);\n\n        return result[0] || null;\n      } catch {\n        // Fall back to storage in test / partial-mock environments.\n      }\n    }\n\n    // Fallback to Redis/storage\n    const key = `quota:${clientId}`;\n    const data = await storage.get(key);\n    if (!data) return null;\n    try {\n      const parsed = JSON.parse(data);\n      if (typeof parsed === 'number') {\n        return { freeUsed: parsed };\n      }\n      if (parsed && typeof parsed === 'object' && 'freeUsed' in parsed) {\n        const value = Number((parsed as { freeUsed: number }).freeUsed);\n        return { freeUsed: Number.isNaN(value) ? 0 : value };\n      }\n    } catch {\n      const numeric = Number(data);\n      if (!Number.isNaN(numeric)) {\n        return { freeUsed: numeric };\n      }\n    }\n    return null;\n  } catch (error) {\n    console.error('Error getting client usage:', error);\n    return null;\n  }\n}\n\nexport async function incrementUsage(\n  clientId: string,\n  ip: string\n): Promise<void> {\n  try {\n    // Update database\n    if (isDatabaseConnected()) {\n      try {\n        const db = getDatabase() as any;\n        console.log(`[QuotaDebug] Incrementing usage in DB for ${clientId}`);\n        await db\n          .insert(clientUsage)\n          .values({\n            clientId,\n            freeUsed: 1,\n            lastIp: ip,\n            lastUsed: new Date(),\n          })\n          .onConflictDoUpdate({\n            target: clientUsage.clientId,\n            set: {\n              freeUsed: sql`${clientUsage.freeUsed} + 1`,\n              lastIp: ip,\n              lastUsed: new Date(),\n            },\n          });\n        console.log(\n          `[QuotaDebug] Successfully incremented usage in DB for ${clientId}`\n        );\n        return;\n      } catch (dbError) {\n        console.warn(\n          '[QuotaDebug] Database increment failed, falling back:',\n          dbError\n        );\n      }\n    }\n\n    // Fallback to storage\n    const key = `quota:${clientId}`;\n    if (typeof (storage as any).get === 'function') {\n      const current = await (storage as any).get(key);\n      let count = 0;\n      if (current) {\n        try {\n          const parsed = JSON.parse(current);\n          if (typeof parsed === 'number') {\n            count = parsed;\n          } else if (\n            parsed &&\n            typeof parsed === 'object' &&\n            'freeUsed' in parsed\n          ) {\n            count = Number((parsed as { freeUsed: number }).freeUsed) || 0;\n          } else {\n            count = Number(current) || 0;\n          }\n        } catch {\n          count = Number(current) || 0;\n        }\n      }\n      const next = count + 1;\n      await (storage as any).set(key, JSON.stringify({ freeUsed: next }));\n      console.log(\n        `[QuotaDebug] Incremented usage in fallback storage for ${clientId}: ${next}`\n      );\n    } else {\n      console.warn('[QuotaDebug] Fallback storage does not support get/set');\n    }\n  } catch (error) {\n    console.error('Error incrementing usage:', error);\n  }\n}\n\nasync function trackRequest(\n  clientId: string,\n  ip: string,\n  userAgent: string,\n  timestamp: number\n): Promise<void> {\n  try {\n    // Track for analytics and abuse detection\n    // await trackImagesMvpEvent('request_tracked', {\n    //   client_id: clientId,\n    //   ip: ip,\n    //   user_agent: userAgent,\n    //   timestamp: timestamp,\n    // });\n\n    // Store for abuse detection (keep last 1000 requests per client)\n    const key = `activity:${clientId}`;\n    const activity = {\n      client_id: clientId,\n      ip,\n      user_agent: userAgent,\n      timestamp,\n      action: 'request',\n    };\n\n    // Prefer native list ops when available (Redis-like). Fall back to best-effort get/set if not.\n    if (\n      typeof (storage as any).lpush === 'function' &&\n      typeof (storage as any).ltrim === 'function'\n    ) {\n      await (storage as any).lpush(key, JSON.stringify(activity));\n      await (storage as any).ltrim(key, 0, 999); // Keep last 1000\n      if (typeof (storage as any).expire === 'function') {\n        await (storage as any).expire(key, 3600); // Expire after 1 hour\n      }\n    } else if (\n      typeof (storage as any).rpush === 'function' &&\n      typeof (storage as any).ltrim === 'function'\n    ) {\n      await (storage as any).rpush(key, JSON.stringify(activity));\n      await (storage as any).ltrim(key, 0, 999);\n      if (typeof (storage as any).expire === 'function') {\n        await (storage as any).expire(key, 3600);\n      }\n    } else {\n      // Best-effort fallback: use get/set to persist a JSON array of recent activities if storage supports it\n      try {\n        if (\n          typeof (storage as any).get === 'function' &&\n          typeof (storage as any).set === 'function'\n        ) {\n          const existing = await (storage as any).get(key);\n          let arr: any[] = [];\n          if (existing) {\n            try {\n              arr = JSON.parse(existing);\n            } catch {\n              arr = [existing];\n            }\n          }\n          arr.unshift(activity);\n          arr = arr.slice(0, 1000);\n          await (storage as any).set(key, JSON.stringify(arr));\n          if (typeof (storage as any).expire === 'function') {\n            await (storage as any).expire(key, 3600);\n          }\n        } else {\n          // Storage backend lacks list-like semantics; skip activity persistence quietly in tests or constrained envs\n          console.debug(\n            '[QuotaDebug] Storage lacks list ops; skipping activity persistence'\n          );\n        }\n      } catch (fallbackError) {\n        console.debug(\n          '[QuotaDebug] Activity tracking fallback failed:',\n          fallbackError\n        );\n      }\n    }\n  } catch (error) {\n    // Reduce noise in test environments where storage may be a partial mock.\n    console.debug('Error tracking request (non-fatal):', error);\n  }\n}\n\nasync function getRecentActivity(\n  clientId: string,\n  ip: string,\n  minutes: number = 60\n): Promise<any[]> {\n  try {\n    const key = `activity:${clientId}`;\n\n    // Prefer list ops, fall back to stored JSON array if list ops are unavailable\n    let activitiesRaw: any[] = [];\n    if (typeof (storage as any).lrange === 'function') {\n      activitiesRaw = await (storage as any).lrange(key, 0, -1);\n    } else if (typeof (storage as any).get === 'function') {\n      const value = await (storage as any).get(key);\n      if (value) {\n        try {\n          activitiesRaw = Array.isArray(value) ? value : JSON.parse(value);\n        } catch {\n          activitiesRaw = [];\n        }\n      }\n    } else {\n      return [];\n    }\n\n    const cutoff = Date.now() - minutes * 60 * 1000;\n    return activitiesRaw\n      .map(a => (typeof a === 'string' ? JSON.parse(a) : a))\n      .filter(a => a && a.timestamp && a.timestamp > cutoff);\n  } catch (error) {\n    console.debug('Error getting recent activity (non-fatal):', error);\n    return [];\n  }\n}\n\nfunction isDatabaseConnected(): boolean {\n  try {\n    // Check if database connection is available\n    return !!getDatabase();\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Check circuit breaker for free tier requests\n * Returns delay info if system is under load\n */\nexport function checkCircuitBreaker(isPaid: boolean): {\n  allowed: boolean;\n  delayed: boolean;\n  message: string;\n  estimatedWaitSeconds: number;\n} {\n  if (isPaid) {\n    const result = circuitBreaker.checkPaidTier();\n    return {\n      allowed: result.allowed,\n      delayed: result.delayed,\n      message: result.message,\n      estimatedWaitSeconds: result.estimatedWaitSeconds,\n    };\n  }\n\n  const result = circuitBreaker.checkFreeTier();\n  return {\n    allowed: result.allowed,\n    delayed: result.delayed,\n    message: result.message,\n    estimatedWaitSeconds: result.estimatedWaitSeconds,\n  };\n}\n\n/**\n * Get server-issued device ID for quota tracking\n * Uses the new secure device token system\n */\nexport function getServerDeviceId(req: Request, res: Response): string {\n  return getOrCreateDeviceToken(req, res);\n}\n\n/**\n * Check if device shows suspicious behavior patterns\n */\nexport async function checkDeviceSuspicious(\n  req: Request,\n  deviceId: string\n): Promise<boolean> {\n  const ip = req.ip || req.connection.remoteAddress || 'unknown';\n\n  // Get recent IPs for this device\n  const recentActivity = await getRecentActivity(deviceId, ip, 15); // Last 15 minutes\n  const recentIps = recentActivity.map(a => a.ip).filter(Boolean);\n\n  // Get device token for age check\n  const token = req.cookies?.metaextract_device;\n  if (!token) return false;\n\n  const decoded = verifyServerDeviceToken(token);\n  if (!decoded) return false;\n\n  return isDeviceSuspicious(decoded, ip, recentIps);\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/utils/geolocation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/utils/optimized-extraction-helpers.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":296,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":296,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9073,9076],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9073,9076],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Optimized Metadata Extraction Helpers with Caching\n *\n * Provides enhanced metadata extraction with intelligent caching,\n * memory management, and performance optimizations.\n *\n * Key features:\n * - Intelligent caching with tier-based TTL strategies\n * - Automatic cache invalidation\n * - Memory-efficient processing\n * - Performance monitoring and metrics\n */\n\nimport path from 'path';\nimport fs from 'fs/promises';\nimport { spawn } from 'child_process';\nimport { existsSync } from 'fs';\nimport { metadataCacheManager } from '../cache/metadata-cache';\nimport type { PythonMetadataResponse } from './extraction-helpers';\n\n// Get the server directory - resolve from project root\n// During tests, use process.cwd() which is the project root\n// During runtime, the app will be at the project root\nconst projectRoot = process.cwd();\nconst currentDirPath = path.join(projectRoot, 'server');\n\n// Python executable: prefer project venv, fall back to system python3\nconst venvPython = path.join(\n  currentDirPath,\n  '..',\n  '..',\n  '.venv',\n  'bin',\n  'python3'\n);\nexport const pythonExecutable =\n  process.env.PYTHON_EXECUTABLE ||\n  (existsSync(venvPython) ? venvPython : 'python3');\n\nexport const PYTHON_SCRIPT_PATH = path.join(\n  currentDirPath,\n  'extractor',\n  'comprehensive_metadata_engine.py'\n);\n\n/**\n * Extract metadata with optimized caching and performance\n *\n * This function provides enhanced metadata extraction with intelligent caching,\n * memory management, and performance optimizations. It first checks the cache\n * for existing results before performing expensive extraction operations.\n *\n * @param filePath Path to the file to extract metadata from\n * @param tier The user's subscription tier (affects caching strategy)\n * @param includePerformanceMetrics Whether to include performance metrics in the result\n * @param enableAdvancedAnalysis Whether to enable advanced analysis features\n * @param storeMetadata Whether to store the metadata in the database\n * @returns Promise resolving to the extracted metadata response\n * @throws Error if extraction fails\n */\nexport async function extractMetadataWithPythonOptimized(\n  filePath: string,\n  tier: string,\n  includePerformanceMetrics: boolean = false,\n  enableAdvancedAnalysis: boolean = false,\n  storeMetadata: boolean = false\n): Promise<PythonMetadataResponse> {\n  // Initialize the metadata cache if not already done\n  if (!metadataCacheManager['initialized']) {\n    await metadataCacheManager.initialize();\n  }\n\n  // Try to get from cache first\n  const cachedResult = await metadataCacheManager.get(\n    filePath,\n    tier,\n    { includePerformance: includePerformanceMetrics, enableAdvancedAnalysis }\n  );\n\n  if (cachedResult) {\n    console.log(` Returning cached metadata for ${path.basename(filePath)}`);\n    return cachedResult;\n  }\n\n  // If not in cache, perform extraction\n  const result = await new Promise<PythonMetadataResponse>((resolve, reject) => {\n    const args = [PYTHON_SCRIPT_PATH, filePath, '--tier', tier];\n\n    if (includePerformanceMetrics) {\n      args.push('--performance');\n    }\n\n    if (enableAdvancedAnalysis) {\n      args.push('--advanced');\n    }\n\n    if (storeMetadata) {\n      args.push('--store');\n    }\n\n    // Log the Python process startup\n    console.log(\n      ` Starting Python extraction process: ${pythonExecutable} ${args.join(' ')}`\n    );\n\n    const python = spawn(pythonExecutable, args);\n\n    let stdout = '';\n    let stderr = '';\n\n    python.stdout.on('data', data => {\n      const dataStr = data.toString();\n      stdout += dataStr;\n      // Log large outputs in chunks to avoid overwhelming the console\n      if (dataStr.length > 1000) {\n        console.log(\n          `Python stdout (partial): ${dataStr.substring(0, 1000)}...`\n        );\n      }\n    });\n\n    python.stderr.on('data', data => {\n      const dataStr = data.toString();\n      stderr += dataStr;\n      // Log errors immediately\n      console.error(`Python stderr: ${dataStr}`);\n    });\n\n    python.on('close', code => {\n      console.log(` Python extraction process exited with code: ${code}`);\n\n      if (code !== 0) {\n        const errorDetails = {\n          message: `Python extractor failed with code ${code}`,\n          stderr: stderr || 'No stderr output',\n          stdout: stdout || 'No stdout output',\n          command: `${pythonExecutable} ${args.join(' ')}`,\n          filePath,\n          tier,\n        };\n\n        console.error('Python extraction error details:', errorDetails);\n        reject(\n          new Error(`Python extractor failed: ${stderr || 'Unknown error'}`)\n        );\n        return;\n      }\n\n      if (!stdout) {\n        const error = 'Python extractor returned empty output';\n        console.error(error, {\n          stderr,\n          command: `${pythonExecutable} ${args.join(' ')}`,\n        });\n        reject(new Error(error));\n        return;\n      }\n\n      try {\n        const result = JSON.parse(stdout);\n        console.log(\n          ` Successfully parsed Python extraction result for ${path.basename(\n            filePath\n          )}, ${result.extraction_info?.fields_extracted || 0} fields extracted`\n        );\n        resolve(result);\n      } catch (parseError) {\n        console.error('Failed to parse Python extraction output:', parseError);\n        console.error(\n          'Raw stdout (first 1000 chars):',\n          stdout.substring(0, 1000)\n        );\n        console.error('Raw stderr:', stderr.substring(0, 500));\n        reject(\n          new Error(\n            `Failed to parse metadata extraction result: ${\n              parseError instanceof Error\n                ? parseError.message\n                : 'Unknown parsing error'\n            }`\n          )\n        );\n      }\n    });\n\n    python.on('error', err => {\n      console.error('Failed to spawn Python extraction process:', err);\n      reject(new Error(`Failed to start Python extractor: ${err.message}`));\n    });\n\n    // Set timeout with detailed logging\n    const timeoutMs = 180000; // 3 minutes\n    const timeoutId = setTimeout(() => {\n      console.warn(\n        ` Python extraction timeout after ${timeoutMs}ms for file: ${filePath}`\n      );\n      if (!python.killed) {\n        python.kill();\n        console.log(` Killed Python process for file: ${filePath}`);\n      }\n      reject(new Error(`Metadata extraction timed out after ${timeoutMs}ms`));\n    }, timeoutMs);\n\n    // Clear timeout on completion\n    python.on('close', () => {\n      clearTimeout(timeoutId);\n    });\n  });\n\n  // Cache the result for future requests\n  await metadataCacheManager.set(\n    filePath,\n    tier,\n    result,\n    {\n      includePerformance: includePerformanceMetrics,\n      enableAdvancedAnalysis,\n      customTTL: getCacheTTLForTier(tier, result)\n    }\n  );\n\n  return result;\n}\n\n/**\n * Get appropriate cache TTL based on tier and result characteristics\n *\n * Different tiers have different cache TTL requirements:\n * - Free tier: 5 minutes\n * - Starter tier: 10 minutes\n * - Pro tier: 1 hour\n * - Super/Enterprise tier: 2-4 hours depending on metadata size\n *\n * @param tier The user's subscription tier\n * @param result The metadata extraction result\n * @returns The appropriate cache TTL in seconds\n */\nfunction getCacheTTLForTier(tier: string, result: PythonMetadataResponse): number {\n  // Different tiers have different cache TTL requirements\n  switch (tier.toLowerCase()) {\n    case 'free':\n      return 300; // 5 minutes for free tier\n    case 'starter':\n      return 600; // 10 minutes for starter tier\n    case 'pro':\n      return 3600; // 1 hour for pro tier\n    case 'super':\n    case 'enterprise': {\n      // For enterprise, cache longer but consider metadata size\n      const fieldCount = result.extraction_info?.fields_extracted || 0;\n      if (fieldCount > 1000) {\n        // Large extractions get shorter cache time to avoid memory issues\n        return 7200; // 2 hours\n      }\n      return 14400; // 4 hours\n    }\n    default:\n      return 1800; // 30 minutes default\n  }\n}\n\n/**\n * Invalidate cached metadata for a specific file\n *\n * @param filePath Path to the file to invalidate from cache\n * @param tier The tier for which metadata was extracted\n * @param options Additional options that affect the extraction\n * @returns Promise resolving to true if invalidation was successful\n */\nexport async function invalidateCachedMetadata(\n  filePath: string,\n  tier: string,\n  options: {\n    includePerformance?: boolean;\n    enableAdvancedAnalysis?: boolean\n  } = {}\n): Promise<boolean> {\n  return await metadataCacheManager.delete(filePath, tier, options);\n}\n\n/**\n * Invalidate cached metadata by tier\n *\n * @param tier The tier to invalidate all cached metadata for\n * @returns Promise resolving to the number of invalidated entries\n */\nexport async function invalidateCachedMetadataByTier(tier: string): Promise<number> {\n  return await metadataCacheManager.invalidateByTier(tier);\n}\n\n/**\n * Get cache metrics and statistics\n *\n * @returns Promise resolving to cache metrics and configuration\n */\nexport async function getMetadataCacheMetrics(): Promise<any> {\n  return await metadataCacheManager.getMetrics();\n}\n\n/**\n * Clear all metadata cache\n *\n * @returns Promise resolving to true if clear was successful\n */\nexport async function clearMetadataCache(): Promise<boolean> {\n  return await metadataCacheManager.clear();\n}\n\n/**\n * Cleanup temp file helper\n *\n * @param tempPath Path to the temporary file to delete\n */\nexport async function cleanupTempFile(tempPath: string | null): Promise<void> {\n  if (tempPath) {\n    try {\n      await fs.unlink(tempPath);\n    } catch (error) {\n      console.error('Failed to delete temp file:', error);\n    }\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/utils/resumable-upload-manager.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/utils/session-id.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1097,1100],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1097,1100],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1130,1133],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1130,1133],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1251,1254],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1251,1254],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1283,1286],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1283,1286],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1551,1554],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1551,1554],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Request, Response } from 'express';\nimport crypto from 'crypto';\n\nconst COOKIE_NAME = 'metaextract_session_id';\n\nfunction isNonEmptyString(value: unknown): value is string {\n  return typeof value === 'string' && value.trim().length > 0;\n}\n\nfunction readCookieHeader(req: Request, name: string): string | null {\n  const header = req.headers?.cookie;\n  if (!isNonEmptyString(header)) return null;\n  // Very small parser: \"a=b; c=d\"\n  const parts = header.split(';');\n  for (const part of parts) {\n    const trimmed = part.trim();\n    if (!trimmed) continue;\n    const eqIndex = trimmed.indexOf('=');\n    if (eqIndex <= 0) continue;\n    const key = trimmed.slice(0, eqIndex).trim();\n    if (key !== name) continue;\n    const value = trimmed.slice(eqIndex + 1).trim();\n    return value ? decodeURIComponent(value) : null;\n  }\n  return null;\n}\n\nexport function getOrSetSessionId(\n  req: Request,\n  res: Response,\n  preferredSessionId?: string | null\n): string {\n  // If an explicit session id was provided via query or header, prefer it (do not set cookie)\n  const querySession = (req as any).query?.sessionId ?? (req as any).query?.session_id;\n  if (isNonEmptyString(querySession)) return querySession.trim();\n\n  const bodySession = (req as any).body?.sessionId ?? (req as any).body?.session_id;\n  if (isNonEmptyString(bodySession)) return bodySession.trim();\n\n  const headerSession = req.headers?.['x-session-id'] as string | undefined;\n  if (isNonEmptyString(headerSession)) return headerSession.trim();\n\n  const cookieValue =\n    (req as any).cookies?.[COOKIE_NAME] ?? readCookieHeader(req, COOKIE_NAME);\n  if (isNonEmptyString(cookieValue)) return cookieValue;\n\n  const sessionId = isNonEmptyString(preferredSessionId)\n    ? preferredSessionId.trim()\n    : crypto.randomUUID();\n\n  res.cookie(COOKIE_NAME, sessionId, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'lax',\n    maxAge: 365 * 24 * 60 * 60 * 1000, // 1 year\n    path: '/',\n  });\n\n  return sessionId;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/utils/session-revocation.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'crypto' is defined but never used.","line":7,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":161,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3921,3924],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3921,3924],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":197,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":197,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4716,4719],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4716,4719],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Session and Token Revocation System\n * Handles token blacklisting and session management\n */\n\nimport { Request, Response } from 'express';\nimport crypto from 'crypto';\nimport { db } from '../db';\nimport { userSessions } from '@shared/schema';\nimport { eq, sql } from 'drizzle-orm';\n\nconst JWT_SECRET = process.env.JWT_SECRET;\nif (!JWT_SECRET) {\n  throw new Error('JWT_SECRET environment variable is required');\n}\n\n// In-memory token blacklist (use Redis in production)\nconst tokenBlacklist = new Set<string>();\n\n// Session token storage for revocation\nconst sessionTokens = new Map<\n  string,\n  { token: string; userId: string; expiresAt: number }\n>();\n\nconst REVOCATION_CONFIG = {\n  BLACKLIST_CLEANUP_INTERVAL: 60 * 60 * 1000, // 1 hour\n  MAX_BLACKLIST_SIZE: 10000,\n};\n\n/**\n * Add token to blacklist\n */\nexport function addToBlacklist(token: string): void {\n  if (token && token.length > 20) {\n    // Basic validation\n    tokenBlacklist.add(token);\n\n    // Clean up old tokens if blacklist gets too large\n    if (tokenBlacklist.size > REVOCATION_CONFIG.MAX_BLACKLIST_SIZE) {\n      cleanupBlacklist();\n    }\n  }\n}\n\n/**\n * Check if token is blacklisted\n */\nexport function isTokenBlacklisted(token: string): boolean {\n  return tokenBlacklist.has(token);\n}\n\n/**\n * Cleanup old tokens from blacklist\n */\nfunction cleanupBlacklist(): void {\n  // Remove oldest tokens (simple FIFO approach)\n  const tokensToRemove = Array.from(tokenBlacklist).slice(0, 1000);\n  for (const token of tokensToRemove) {\n    tokenBlacklist.delete(token);\n  }\n}\n\n/**\n * Revoke all sessions for a user\n */\nexport async function revokeAllUserSessions(userId: string): Promise<void> {\n  try {\n    // Delete all sessions from database\n    await db.delete(userSessions).where(eq(userSessions.userId, userId));\n\n    // Remove from in-memory storage\n    for (const [sessionId, session] of sessionTokens.entries()) {\n      if (session.userId === userId) {\n        sessionTokens.delete(sessionId);\n      }\n    }\n\n    console.log(`Revoked all sessions for user: ${userId}`);\n  } catch (error) {\n    console.error('Error revoking user sessions:', error);\n  }\n}\n\n/**\n * Revoke specific session\n */\nexport async function revokeSession(sessionId: string): Promise<void> {\n  try {\n    // Delete from database\n    await db.delete(userSessions).where(eq(userSessions.sessionId, sessionId));\n\n    // Remove from in-memory storage\n    sessionTokens.delete(sessionId);\n\n    console.log(`Revoked session: ${sessionId}`);\n  } catch (error) {\n    console.error('Error revoking session:', error);\n  }\n}\n\n/**\n * Store session token for potential revocation\n */\nexport function storeSessionToken(\n  sessionId: string,\n  token: string,\n  userId: string,\n  expiresAt: Date\n): void {\n  sessionTokens.set(sessionId, {\n    token,\n    userId,\n    expiresAt: expiresAt.getTime(),\n  });\n}\n\n/**\n * Cleanup expired sessions\n */\nexport async function cleanupExpiredSessions(): Promise<void> {\n  try {\n    const now = new Date();\n\n    // Clean up database\n    await db\n      .delete(userSessions)\n      .where(sql`${userSessions.expiresAt} < ${now}`);\n\n    // Clean up in-memory storage\n    for (const [sessionId, session] of sessionTokens.entries()) {\n      if (new Date() > new Date(session.expiresAt)) {\n        sessionTokens.delete(sessionId);\n      }\n    }\n\n    // Clean up blacklist periodically\n    setTimeout(\n      () => cleanupBlacklist(),\n      REVOCATION_CONFIG.BLACKLIST_CLEANUP_INTERVAL\n    );\n\n    console.log('Cleaned up expired sessions');\n  } catch (error) {\n    console.error('Error cleaning up expired sessions:', error);\n  }\n}\n\n/**\n * Handle logout with token revocation\n */\nexport async function handleLogoutWithRevocation(\n  req: Request,\n  res: Response\n): Promise<void> {\n  try {\n    const authHeader = req.headers.authorization;\n    const token = authHeader?.startsWith('Bearer ')\n      ? authHeader.substring(7)\n      : null;\n    const userId = (req as any).user?.id;\n\n    if (token) {\n      // Add current token to blacklist\n      addToBlacklist(token);\n    }\n\n    if (userId) {\n      // Revoke all sessions for this user\n      await revokeAllUserSessions(userId);\n    }\n\n    // Clear auth cookie\n    res.clearCookie('auth_token');\n\n    res.json({\n      success: true,\n      message: 'Logged out successfully. All sessions have been revoked.',\n    });\n  } catch (error) {\n    console.error('Logout with revocation error:', error);\n    res.status(500).json({\n      error: 'Logout failed',\n      message: error instanceof Error ? error.message : 'Unknown error',\n    });\n  }\n}\n\n/**\n * Handle revoke all sessions\n */\nexport async function handleRevokeAllSessions(\n  req: Request,\n  res: Response\n): Promise<void> {\n  try {\n    const userId = (req as any).user?.id;\n\n    if (!userId) {\n      res.status(401).json({ error: 'Authentication required' });\n      return;\n    }\n\n    await revokeAllUserSessions(userId);\n\n    // Add current token to blacklist\n    const authHeader = req.headers.authorization;\n    const token = authHeader?.startsWith('Bearer ')\n      ? authHeader.substring(7)\n      : null;\n    if (token) {\n      addToBlacklist(token);\n    }\n\n    res.json({\n      success: true,\n      message: 'All sessions have been revoked',\n    });\n  } catch (error) {\n    console.error('Revoke all sessions error:', error);\n    res.status(500).json({\n      error: 'Failed to revoke sessions',\n      message: error instanceof Error ? error.message : 'Unknown error',\n    });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/utils/thumbnail-generator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/utils/trusted-app-origin.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/utils/validation-schemas.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/utils/virus-scanner.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/utils/worker-queue.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[507,510],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[507,510],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[587,590],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[587,590],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":76,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1703,1706],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1703,1706],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1792,1795],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1792,1795],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2724,2727],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2724,2727],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Async Worker Queue Adapter\n * \n * Abstraction for offloading heavy tasks.\n * MVP: In-memory async execution\n * Production: Redis (BullMQ) or Cloud Tasks\n */\n\nimport { v4 as uuidv4 } from 'uuid';\n\nexport type JobStatus = 'pending' | 'processing' | 'completed' | 'failed';\n\nexport interface JobOptions {\n  timeoutMs?: number;    // Execution timeout (Resource Limit)\n  retries?: number;      // Max retries (Retry Strategy)\n  backoffMs?: number;    // Delay between retries\n}\n\nexport interface Job<T = any> {\n  id: string;\n  type: string;\n  data: T;\n  status: JobStatus;\n  result?: any;\n  error?: string;\n  createdAt: Date;\n  startedAt?: Date;\n  completedAt?: Date;\n  attempts: number;      // Current attempt count\n  maxAttempts: number;   // Max retries allowed\n}\n\n// In-memory job store for MVP\nconst jobs = new Map<string, Job>();\n\n// Default options\nconst DEFAULT_OPTIONS: JobOptions = {\n  timeoutMs: 60000, // 1 minute default timeout\n  retries: 3,       // 3 retries\n  backoffMs: 1000,\n};\n\n/**\n * Add a job to the queue.\n */\nexport async function addJob<T>(type: string, data: T, options?: JobOptions): Promise<Job<T>> {\n  const id = uuidv4();\n  const opts = { ...DEFAULT_OPTIONS, ...options };\n  \n  const job: Job<T> = {\n    id,\n    type,\n    data,\n    status: 'pending',\n    createdAt: new Date(),\n    attempts: 0,\n    maxAttempts: opts.retries || 0,\n  };\n  \n  jobs.set(id, job);\n\n  // In MVP, trigger processing immediately (async)\n  processNext(id, opts);\n\n  return job;\n}\n\n/**\n * Get job status/result.\n */\nexport async function getJob(id: string): Promise<Job | undefined> {\n  return jobs.get(id);\n}\n\n// Mock processor registry\nconst processors = new Map<string, (job: Job) => Promise<any>>();\n\nexport function registerProcessor(type: string, handler: (job: Job) => Promise<any>) {\n  processors.set(type, handler);\n}\n\nasync function processNext(jobId: string, options: JobOptions) {\n  const job = jobs.get(jobId);\n  if (!job) return;\n\n  const processor = processors.get(job.type);\n  if (!processor) {\n    job.status = 'failed';\n    job.error = `No processor for type ${job.type}`;\n    return;\n  }\n\n  // Retry Logic\n  while (job.attempts <= job.maxAttempts) {\n    job.attempts++;\n    job.status = 'processing';\n    job.startedAt = new Date(); // Update start time for each attempt\n\n    try {\n      // Resource Limit: Timeout enforcement\n      const result = await Promise.race([\n        processor(job),\n        new Promise((_, reject) => \n          setTimeout(() => reject(new Error('Job timeout exceeded')), options.timeoutMs)\n        )\n      ]);\n\n      // Success\n      job.status = 'completed';\n      job.result = result;\n      job.completedAt = new Date();\n      return; // Exit loop\n\n    } catch (err: any) {\n      console.warn(`Job ${jobId} failed attempt ${job.attempts}/${job.maxAttempts + 1}: ${err.message}`);\n      job.error = err.message || 'Unknown error';\n      \n      // If retries remaining, wait before next attempt\n      if (job.attempts <= job.maxAttempts) {\n        job.status = 'pending'; // Reset status for visibility\n        await new Promise(resolve => setTimeout(resolve, options.backoffMs));\n      } else {\n        // Final failure\n        job.status = 'failed';\n        job.completedAt = new Date();\n      }\n    }\n  }\n}\n\n/**\n * Autoscale Metrics\n * Returns current metrics for Horizontal Pod Autoscaler (HPA) or CloudWatch.\n */\nexport function getQueueMetrics() {\n  const pending = Array.from(jobs.values()).filter(j => j.status === 'pending').length;\n  const processing = Array.from(jobs.values()).filter(j => j.status === 'processing').length;\n  \n  // Calculate average processing time for completed jobs (last 100)\n  const completed = Array.from(jobs.values())\n    .filter(j => j.status === 'completed' && j.startedAt && j.completedAt)\n    .sort((a, b) => b.completedAt!.getTime() - a.completedAt!.getTime()) // Newest first\n    .slice(0, 100);\n\n  const avgProcessingTimeMs = completed.reduce((acc, job) => {\n    return acc + (job.completedAt!.getTime() - job.startedAt!.getTime());\n  }, 0) / (completed.length || 1);\n\n  return {\n    queueDepth: pending,\n    activeWorkers: processing,\n    avgProcessingTimeMs,\n    scalingRecommendation: pending > 50 ? 'scale_up' : pending < 5 ? 'scale_down' : 'hold'\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/server/vite.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/shared/error-schema.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/shared/schema.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":397,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":397,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13235,13238],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13235,13238],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":401,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":401,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13314,13317],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13314,13317],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { sql } from 'drizzle-orm';\nimport {\n  pgTable,\n  text,\n  varchar,\n  integer,\n  boolean,\n  timestamp,\n  bigint,\n  jsonb,\n} from 'drizzle-orm/pg-core';\nimport { createInsertSchema } from 'drizzle-zod';\nimport { z } from 'zod';\n\nexport const users = pgTable('users', {\n  id: varchar('id')\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  username: text('username').notNull().unique(),\n  email: text('email').notNull().unique(),\n  password: text('password').notNull(),\n  tier: text('tier').notNull().default('free'),\n  subscriptionId: text('subscription_id'),\n  subscriptionStatus: text('subscription_status').default('none'),\n  customerId: text('customer_id'),\n  emailVerified: boolean('email_verified').notNull().default(false),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n});\n\nexport const insertUserSchema = createInsertSchema(users).pick({\n  username: true,\n  email: true,\n  password: true,\n});\n\nexport const subscriptions = pgTable('subscriptions', {\n  id: varchar('id')\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  userId: varchar('user_id')\n    .notNull()\n    .references(() => users.id),\n  dodoSubscriptionId: text('dodo_subscription_id').notNull().unique(),\n  dodoCustomerId: text('dodo_customer_id').notNull(),\n  tier: text('tier').notNull(),\n  status: text('status').notNull().default('pending'),\n  currentPeriodStart: timestamp('current_period_start'),\n  currentPeriodEnd: timestamp('current_period_end'),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n  updatedAt: timestamp('updated_at').notNull().defaultNow(),\n});\n\nexport const insertSubscriptionSchema = createInsertSchema(subscriptions).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type InsertSubscription = z.infer<typeof insertSubscriptionSchema>;\nexport type Subscription = typeof subscriptions.$inferSelect;\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\n\nexport const extractionAnalytics = pgTable('extraction_analytics', {\n  id: varchar('id')\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  tier: text('tier').notNull().default('free'),\n  fileExtension: text('file_extension').notNull(),\n  mimeType: text('mime_type').notNull(),\n  fileSizeBytes: bigint('file_size_bytes', { mode: 'number' }).notNull(),\n  isVideo: boolean('is_video').notNull().default(false),\n  isImage: boolean('is_image').notNull().default(false),\n  isPdf: boolean('is_pdf').notNull().default(false),\n  isAudio: boolean('is_audio').notNull().default(false),\n  fieldsExtracted: integer('fields_extracted').notNull().default(0),\n  processingMs: integer('processing_ms').notNull().default(0),\n  success: boolean('success').notNull().default(true),\n  failureReason: text('failure_reason'),\n  ipAddress: text('ip_address'),\n  userAgent: text('user_agent'),\n  requestedAt: timestamp('requested_at').notNull().defaultNow(),\n});\n\nexport const insertExtractionAnalyticsSchema = createInsertSchema(\n  extractionAnalytics\n).omit({\n  id: true,\n  requestedAt: true,\n});\n\nexport type InsertExtractionAnalytics = z.infer<\n  typeof insertExtractionAnalyticsSchema\n>;\nexport type ExtractionAnalytics = typeof extractionAnalytics.$inferSelect;\n\n// =====================================================================\n// UI / Product Analytics Events\n// =====================================================================\n\nexport const uiEvents = pgTable('ui_events', {\n  id: varchar('id')\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  product: text('product').notNull().default('core'),\n  eventName: text('event_name').notNull(),\n  sessionId: text('session_id'),\n  userId: varchar('user_id').references(() => users.id),\n  properties: jsonb('properties')\n    .notNull()\n    .default(sql`'{}'::jsonb`),\n  ipAddress: text('ip_address'),\n  userAgent: text('user_agent'),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n});\n\nexport const insertUiEventSchema = createInsertSchema(uiEvents).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertUiEvent = z.infer<typeof insertUiEventSchema>;\nexport type UiEvent = typeof uiEvents.$inferSelect;\n\n// Credits system for pay-as-you-go\nexport const creditBalances = pgTable('credit_balances', {\n  id: varchar('id')\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  userId: varchar('user_id').references(() => users.id),\n  sessionId: text('session_id'),\n  credits: integer('credits').notNull().default(0),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n  updatedAt: timestamp('updated_at').notNull().defaultNow(),\n});\n\nexport const emailVerificationTokens = pgTable('email_verification_tokens', {\n  id: varchar('id')\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  userId: varchar('user_id')\n    .notNull()\n    .references(() => users.id),\n  token: text('token').notNull().unique(),\n  expiresAt: timestamp('expires_at').notNull(),\n  usedAt: timestamp('used_at'),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n});\n\nexport const userSessions = pgTable('user_sessions', {\n  id: varchar('id')\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  userId: varchar('user_id')\n    .notNull()\n    .references(() => users.id),\n  sessionId: text('session_id').notNull().unique(),\n  tokenHash: text('token_hash').notNull(),\n  expiresAt: timestamp('expires_at').notNull(),\n  userAgent: text('user_agent'),\n  ipAddress: text('ip_address'),\n  revokedAt: timestamp('revoked_at'),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n});\n\n// Credit grants (\"lots\") for safe refunding and FIFO consumption\nexport const creditGrants = pgTable('credit_grants', {\n  id: varchar('id')\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  balanceId: varchar('balance_id')\n    .notNull()\n    .references(() => creditBalances.id),\n  amount: integer('amount').notNull(),\n  remaining: integer('remaining').notNull(),\n  description: text('description'),\n  pack: text('pack'),\n  dodoPaymentId: text('dodo_payment_id'),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n  expiresAt: timestamp('expires_at'),\n});\n\nexport const creditTransactions = pgTable('credit_transactions', {\n  id: varchar('id')\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  balanceId: varchar('balance_id')\n    .notNull()\n    .references(() => creditBalances.id),\n  grantId: varchar('grant_id').references(() => creditGrants.id),\n  type: text('type').notNull(), // 'purchase', 'usage', 'refund'\n  amount: integer('amount').notNull(), // positive for purchase/refund, negative for usage\n  description: text('description'),\n  fileType: text('file_type'),\n  dodoPaymentId: text('dodo_payment_id'),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n});\n\nexport const insertCreditBalanceSchema = createInsertSchema(\n  creditBalances\n).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertCreditTransactionSchema = createInsertSchema(\n  creditTransactions\n).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertCreditBalance = z.infer<typeof insertCreditBalanceSchema>;\nexport type CreditBalance = typeof creditBalances.$inferSelect;\nexport type CreditGrant = typeof creditGrants.$inferSelect;\nexport type InsertCreditTransaction = z.infer<\n  typeof insertCreditTransactionSchema\n>;\nexport type CreditTransaction = typeof creditTransactions.$inferSelect;\n\n// ============================================================================\n// Metadata Storage Schema (Phase 1: Foundation)\n// ============================================================================\n\nexport const metadataResults = pgTable('metadata_results', {\n  id: varchar('id')\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  userId: varchar('user_id').references(() => users.id),\n  fileName: text('file_name').notNull(),\n  fileSize: text('file_size'),\n  mimeType: text('mime_type'),\n  metadataSummary: jsonb('metadata_summary')\n    .notNull()\n    .default(sql`'{}'::jsonb`), // Capped summary for search/indexing\n  metadataRef: jsonb('metadata_ref'), // Pointer to full blob in object storage\n  metadataSha256: text('metadata_sha256'),\n  metadataSizeBytes: bigint('metadata_size_bytes', { mode: 'number' }),\n  metadataContentType: text('metadata_content_type'),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n});\n\nexport const insertMetadataResultSchema = createInsertSchema(\n  metadataResults\n).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertMetadataResult = z.infer<typeof insertMetadataResultSchema>;\nexport type MetadataResult = typeof metadataResults.$inferSelect;\nexport type MetadataRef = {\n  provider: string;\n  bucket: string;\n  key: string;\n  sizeBytes: number;\n  sha256: string;\n  contentType?: string | null;\n  encoding?: string | null;\n  createdAt?: string | null;\n};\n\n// ============================================================================\n// Extraction Jobs Schema (Async Processing)\n// ============================================================================\n\nexport const extractionJobs = pgTable('extraction_jobs', {\n  id: varchar('id')\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  sessionId: varchar('session_id'),\n  userId: varchar('user_id').references(() => users.id),\n  fileName: text('file_name').notNull(),\n  fileSize: bigint('file_size', { mode: 'number' }),\n  mimeType: text('mime_type'),\n  status: varchar('status', { length: 20 }).notNull().default('pending'), // pending, processing, complete, failed\n  progress: integer('progress').notNull().default(0), // 0-100\n  progressMessage: text('progress_message'),\n  resultId: varchar('result_id').references(() => metadataResults.id), // Link to result when complete\n  error: text('error'), // Error message if failed\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n  updatedAt: timestamp('updated_at').notNull().defaultNow(),\n  completedAt: timestamp('completed_at'),\n});\n\nexport const insertExtractionJobSchema = createInsertSchema(\n  extractionJobs\n).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type InsertExtractionJob = z.infer<typeof insertExtractionJobSchema>;\nexport type ExtractionJob = typeof extractionJobs.$inferSelect;\n\n// ============================================================================\n// Onboarding System Schema\n// ============================================================================\n\nexport const onboardingSessions = pgTable('onboarding_sessions', {\n  id: varchar('id')\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  userId: varchar('user_id').references(() => users.id),\n  startedAt: timestamp('started_at').notNull().defaultNow(),\n  completedAt: timestamp('completed_at'),\n  currentStep: integer('current_step').notNull().default(0),\n  pathId: text('path_id').notNull(),\n  userProfile: text('user_profile').notNull(), // JSON string\n  progress: text('progress').notNull(), // JSON string\n  interactions: text('interactions').notNull().default('[]'), // JSON array\n  isActive: boolean('is_active').notNull().default(true),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n  updatedAt: timestamp('updated_at').notNull().defaultNow(),\n});\n\nexport const insertOnboardingSessionSchema = createInsertSchema(\n  onboardingSessions\n).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type InsertOnboardingSession = z.infer<\n  typeof insertOnboardingSessionSchema\n>;\nexport type OnboardingSession = typeof onboardingSessions.$inferSelect;\n\n// ============================================================================\n// Trial Usage Tracking Schema\n// ============================================================================\n\nexport const trialUsages = pgTable('trial_usages', {\n  id: varchar('id')\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  email: text('email').notNull().unique(),\n  uses: integer('uses').notNull().default(1),\n  usedAt: timestamp('used_at').notNull().defaultNow(),\n  ipAddress: text('ip_address'),\n  userAgent: text('user_agent'),\n  sessionId: text('session_id'),\n});\n\nexport const insertTrialUsageSchema = createInsertSchema(trialUsages).omit({\n  id: true,\n  usedAt: true,\n  uses: true,\n});\n\nexport type InsertTrialUsage = z.infer<typeof insertTrialUsageSchema>;\nexport type TrialUsage = typeof trialUsages.$inferSelect;\n\n// Persona Interpretation Types\nexport interface PersonaInterpretation {\n  persona: string;\n  key_findings: string[];\n  plain_english_answers: {\n    when_taken: {\n      answer: string;\n      details: string;\n      source: string;\n      confidence: string;\n    };\n    location: {\n      has_location: boolean;\n      answer: string;\n      details: string;\n      confidence: string;\n      coordinates?: {\n        latitude: number;\n        longitude: number;\n        formatted: string;\n      };\n      readable_location?: string;\n      possible_reasons?: string[];\n    };\n    device: {\n      answer: string;\n      device_type: string;\n      details: {\n        make: string | null;\n        model: string | null;\n        software: string | null;\n      };\n      confidence: string;\n    };\n    authenticity: {\n      assessment: string;\n      confidence: string;\n      score: number;\n      answer: string;\n      checks_performed: Record<string, any>;\n      reasons: string[];\n    };\n  };\n  confidence_scores: Record<string, any>;\n  warnings: string[];\n  recommendations: string[];\n}\n\n// ============================================================================\n// Free Quota Tracking Schema\n// ============================================================================\n\nexport const clientUsage = pgTable('client_usage', {\n  id: varchar('id')\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  clientId: varchar('client_id').notNull().unique(),\n  freeUsed: integer('free_used').notNull().default(0),\n  lastIp: text('last_ip'),\n  lastUserAgent: text('last_user_agent'),\n  fingerprintHash: varchar('fingerprint_hash', { length: 64 }),\n  abuseScore: text('abuse_score').default('0.00'),\n  firstSeen: timestamp('first_seen').notNull().defaultNow(),\n  lastUsed: timestamp('last_used').notNull().defaultNow(),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n  updatedAt: timestamp('updated_at').notNull().defaultNow(),\n});\n\nexport const insertClientUsageSchema = createInsertSchema(clientUsage).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type InsertClientUsage = z.infer<typeof insertClientUsageSchema>;\nexport type ClientUsage = typeof clientUsage.$inferSelect;\n\n// ============================================================================\n// Client Activity Tracking (Abuse Detection - Tier 2 & 3)\n// Best Practice: Serial ID for high-throughput append-only tables\n// ============================================================================\n\nexport const clientActivity = pgTable('client_activity', {\n  id: varchar('id')\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  clientId: varchar('client_id', { length: 36 }).notNull(),\n  ip: text('ip'),\n  userAgent: text('user_agent'),\n  fingerprintHash: varchar('fingerprint_hash', { length: 64 }),\n  action: varchar('action', { length: 50 }).notNull(), // 'request', 'quota_hit', 'new_token', etc.\n  abuseScore: text('abuse_score').default('0.00'),\n  timestamp: timestamp('timestamp').notNull().defaultNow(),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n});\n\nexport const insertClientActivitySchema = createInsertSchema(\n  clientActivity\n).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertClientActivity = z.infer<typeof insertClientActivitySchema>;\nexport type ClientActivity = typeof clientActivity.$inferSelect;\n\n// ============================================================================\n// IP Rate Limiting (Tier 2)\n// ============================================================================\n\nexport const ipRateLimits = pgTable('ip_rate_limits', {\n  id: varchar('id')\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  ip: text('ip').notNull().unique(),\n  dailyCount: integer('daily_count').notNull().default(0),\n  minuteCount: integer('minute_count').notNull().default(0),\n  lastReset: timestamp('last_reset').notNull().defaultNow(),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n  updatedAt: timestamp('updated_at').notNull().defaultNow(),\n});\n\nexport const insertIpRateLimitSchema = createInsertSchema(ipRateLimits).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type InsertIpRateLimit = z.infer<typeof insertIpRateLimitSchema>;\nexport type IpRateLimit = typeof ipRateLimits.$inferSelect;\n\n// ============================================================================\n// Abuse Pattern Tracking (Tier 3 - Advanced Detection)\n// ============================================================================\n\nexport const abusePatterns = pgTable('abuse_patterns', {\n  id: varchar('id')\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  patternType: varchar('pattern_type', { length: 50 }).notNull(), // 'multiple_clients_same_ip', 'high_velocity', etc.\n  targetType: varchar('target_type', { length: 50 }).notNull(), // 'ip', 'fingerprint', 'client_id'\n  targetValue: text('target_value').notNull(),\n  abuseScore: text('abuse_score').notNull(),\n  evidence: jsonb('evidence'),\n  isActive: boolean('is_active').notNull().default(true),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n  expiresAt: timestamp('expires_at').default(sql`NOW() + INTERVAL '24 hours'`),\n});\n\nexport const insertAbusePatternSchema = createInsertSchema(abusePatterns).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertAbusePattern = z.infer<typeof insertAbusePatternSchema>;\nexport type AbusePattern = typeof abusePatterns.$inferSelect;\n\n// ============================================================================\n// Quota Analytics Summary (Monitoring & Reporting)\n// ============================================================================\n\nexport const quotaAnalytics = pgTable('quota_analytics', {\n  id: varchar('id')\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  date: timestamp('date')\n    .notNull()\n    .default(sql`CURRENT_DATE`),\n  totalRequests: integer('total_requests').notNull().default(0),\n  freeRequests: integer('free_requests').notNull().default(0),\n  paidRequests: integer('paid_requests').notNull().default(0),\n  quotaHits: integer('quota_hits').notNull().default(0),\n  uniqueClients: integer('unique_clients').notNull().default(0),\n  uniqueIps: integer('unique_ips').notNull().default(0),\n  abuseScoreAvg: text('abuse_score_avg').default('0.00'),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n});\n\nexport const insertQuotaAnalyticsSchema = createInsertSchema(\n  quotaAnalytics\n).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertQuotaAnalytics = z.infer<typeof insertQuotaAnalyticsSchema>;\nexport type QuotaAnalytics = typeof quotaAnalytics.$inferSelect;\n\n// ============================================================================\n// Batch Processing Schema (Phase 3.2)\n// ============================================================================\n\nexport const batchJobs = pgTable('batch_jobs', {\n  id: varchar('id')\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  userId: varchar('user_id')\n    .notNull()\n    .references(() => users.id),\n  name: text('name').notNull(),\n  status: text('status')\n    .notNull()\n    .default('pending')\n    .$type<'pending' | 'processing' | 'completed' | 'failed'>(),\n  totalFiles: integer('total_files').notNull().default(0),\n  processedFiles: integer('processed_files').notNull().default(0),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n  updatedAt: timestamp('updated_at').notNull().defaultNow(),\n  completedAt: timestamp('completed_at'),\n  errorMessage: text('error_message'),\n});\n\nexport const batchResults = pgTable('batch_results', {\n  id: varchar('id')\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  batchId: varchar('batch_id')\n    .notNull()\n    .references(() => batchJobs.id),\n  filename: text('filename').notNull(),\n  status: text('status')\n    .notNull()\n    .default('pending')\n    .$type<'success' | 'error' | 'processing' | 'pending'>(),\n  extractionDate: timestamp('extraction_date').notNull().defaultNow(),\n  fieldsExtracted: integer('fields_extracted').notNull().default(0),\n  fileSize: bigint('file_size', { mode: 'number' }).notNull(),\n  fileType: text('file_type').notNull(),\n  authenticityScore: integer('authenticity_score'),\n  metadata: jsonb('metadata')\n    .notNull()\n    .default(sql`'{}'::jsonb`),\n  processingTime: integer('processing_time'),\n  errorMessage: text('error_message'),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n});\n\nexport const insertBatchJobSchema = createInsertSchema(batchJobs).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertBatchResultSchema = createInsertSchema(batchResults).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertBatchJob = z.infer<typeof insertBatchJobSchema>;\nexport type BatchJob = typeof batchJobs.$inferSelect;\nexport type InsertBatchResult = z.infer<typeof insertBatchResultSchema>;\nexport type BatchResult = typeof batchResults.$inferSelect;\n","usedDeprecatedRules":[]},{"filePath":"/Users/pranay/Projects/metaextract/shared/tierConfig.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":423,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":423,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12374,12377],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12374,12377],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":428,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":428,"endColumn":16,"suggestions":[{"fix":{"range":[12542,12618],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * MetaExtract Tier Configuration\n *\n * Pricing based on forensic value proposition:\n * - 7,000+ metadata fields (competitors: 50-200)\n * - Parsed MakerNotes (Canon, Sony, Nikon proprietary data)\n * - Advanced forensic analysis (steganography, manipulation detection)\n * - Court-admissible evidence preservation\n *\n * This is enterprise-grade forensic software, priced accordingly.\n */\n\nexport type TierName = 'free' | 'professional' | 'forensic' | 'enterprise';\n\nexport interface TierConfig {\n  name: TierName;\n  displayName: string;\n  tagline: string;\n  price: number;\n  priceLabel: string;\n  billingPeriod: 'month' | 'year' | 'one-time';\n  allowedFileTypes: string[];\n  maxFileSizeMB: number;\n  monthlyFileLimit: number | null; // null = unlimited\n  dailyFileLimit: number | null; // null = unlimited (for free tier rate limiting)\n  apiRequestsPerMonth: number | null;\n  features: {\n    // Basic extraction\n    basicExif: boolean;\n    imageProperties: boolean;\n\n    // File integrity\n    fileHashes: boolean;\n    filesystemMetadata: boolean;\n\n    // Location & Time\n    gpsData: boolean;\n    calculatedFields: boolean;\n\n    // Advanced metadata\n    makerNotes: boolean;\n    iptcXmp: boolean;\n    extendedAttributes: boolean;\n    serialNumbers: boolean;\n\n    // File type support\n    rawFormats: boolean;\n    videoSupport: boolean;\n    audioSupport: boolean;\n    pdfSupport: boolean;\n\n    // Forensic features\n    forensicAnalysis: boolean;\n    manipulationDetection: boolean;\n    timelineReconstruction: boolean;\n\n    // Processing features\n    batchUpload: boolean;\n    apiAccess: boolean;\n    priorityProcessing: boolean;\n\n    // Export\n    jsonExport: boolean;\n    csvExport: boolean;\n    pdfReport: boolean;\n\n    // Support\n    emailSupport: boolean;\n    prioritySupport: boolean;\n    dedicatedSupport: boolean;\n  };\n  fieldCount: string;\n  fieldCategories: string[];\n  description: string;\n}\n\nexport const TIER_CONFIGS: Record<TierName, TierConfig> = {\n  // =========================================================================\n  // FREE - Evaluation Tier\n  // =========================================================================\n  free: {\n    name: 'free',\n    displayName: 'Free',\n    tagline: 'Evaluate our extraction quality',\n    price: 0,\n    priceLabel: 'Free',\n    billingPeriod: 'month',\n    allowedFileTypes: ['image/jpeg', 'image/png', 'image/gif', 'image/webp'],\n    maxFileSizeMB: 10,\n    monthlyFileLimit: null,\n    dailyFileLimit: 3, // 3 files per day for evaluation\n    apiRequestsPerMonth: null,\n    features: {\n      basicExif: true,\n      imageProperties: true,\n      fileHashes: true,\n      filesystemMetadata: false,\n      gpsData: true,\n      calculatedFields: true,\n      makerNotes: false,\n      iptcXmp: false,\n      extendedAttributes: false,\n      serialNumbers: false,\n      rawFormats: false,\n      videoSupport: false,\n      audioSupport: false,\n      pdfSupport: false,\n      forensicAnalysis: false,\n      manipulationDetection: false,\n      timelineReconstruction: false,\n      batchUpload: false,\n      apiAccess: false,\n      priorityProcessing: false,\n      jsonExport: true,\n      csvExport: false,\n      pdfReport: false,\n      emailSupport: false,\n      prioritySupport: false,\n      dedicatedSupport: false,\n    },\n    fieldCount: '200-300',\n    fieldCategories: [\n      'summary',\n      'basic_exif',\n      'image',\n      'gps',\n      'hashes',\n      'calculated',\n    ],\n    description:\n      'Basic EXIF + GPS + file hashes. Perfect for evaluation before upgrading.',\n  },\n\n  // =========================================================================\n  // PROFESSIONAL - Investigator Tier ($19/month)\n  // =========================================================================\n  professional: {\n    name: 'professional',\n    displayName: 'Professional',\n    tagline: 'For investigators & photographers',\n    price: 19,\n    priceLabel: '$19/month',\n    billingPeriod: 'month',\n    allowedFileTypes: [\n      // Standard images\n      'image/jpeg',\n      'image/png',\n      'image/gif',\n      'image/webp',\n      'image/tiff',\n      'image/bmp',\n      'image/heic',\n      'image/heif',\n      'image/svg+xml',\n      // RAW formats\n      'image/x-canon-cr2',\n      'image/x-canon-cr3',\n      'image/x-nikon-nef',\n      'image/x-nikon-nrw',\n      'image/x-sony-arw',\n      'image/x-sony-sr2',\n      'image/x-adobe-dng',\n      'image/x-olympus-orf',\n      'image/x-panasonic-rw2',\n      'image/x-panasonic-raw',\n      'image/x-fuji-raf',\n      'image/x-pentax-pef',\n      'image/x-leica-rwl',\n      'image/x-hasselblad-3fr',\n      'image/x-phaseone-iiq',\n      // Documents\n      'application/pdf',\n      'application/msword',\n      'application/vnd.openxmlformats-officedocument.wordprocessingml.document', // .docx\n      'application/vnd.ms-excel',\n      'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', // .xlsx\n      'application/vnd.ms-powerpoint',\n      'application/vnd.openxmlformats-officedocument.presentationml.presentation', // .pptx\n      'text/plain',\n      'text/html',\n      'application/json',\n      'application/xml',\n      'text/csv',\n    ],\n    maxFileSizeMB: 500, // Increased for convenience\n    monthlyFileLimit: 500,\n    dailyFileLimit: null,\n    apiRequestsPerMonth: null,\n    features: {\n      basicExif: true,\n      imageProperties: true,\n      fileHashes: true,\n      filesystemMetadata: true,\n      gpsData: true,\n      calculatedFields: true,\n      makerNotes: true,\n      iptcXmp: true,\n      extendedAttributes: true,\n      serialNumbers: true,\n      rawFormats: true,\n      videoSupport: false,\n      audioSupport: false,\n      pdfSupport: true,\n      forensicAnalysis: true,\n      manipulationDetection: false,\n      timelineReconstruction: false,\n      batchUpload: false,\n      apiAccess: false,\n      priorityProcessing: false,\n      jsonExport: true,\n      csvExport: true,\n      pdfReport: false,\n      emailSupport: true,\n      prioritySupport: false,\n      dedicatedSupport: false,\n    },\n    fieldCount: '2,000+',\n    fieldCategories: [\n      'summary',\n      'exif',\n      'image',\n      'gps',\n      'filesystem',\n      'hashes',\n      'calculated',\n      'forensic',\n      'makernote',\n      'iptc',\n      'xmp',\n      'extended_attributes',\n    ],\n    description:\n      'Full EXIF + MakerNotes + IPTC/XMP. All image formats including RAW.',\n  },\n\n  // =========================================================================\n  // FORENSIC - Expert Tier ($49/month)\n  // =========================================================================\n  forensic: {\n    name: 'forensic',\n    displayName: 'Forensic',\n    tagline: 'Complete forensic analysis toolkit',\n    price: 49,\n    priceLabel: '$49/month',\n    billingPeriod: 'month',\n    allowedFileTypes: [\n      // All Professional types + Video/Audio + Scientific/Medical\n      'image/*',\n      'video/*',\n      'audio/*',\n      'application/pdf',\n      'application/msword',\n      'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n      'application/vnd.ms-excel',\n      'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n      'application/vnd.ms-powerpoint',\n      'application/vnd.openxmlformats-officedocument.presentationml.presentation',\n      'text/*',\n      'application/json',\n      'application/xml',\n      'application/zip',\n      'application/x-tar',\n      'application/x-rar-compressed',\n      'application/x-7z-compressed',\n      // Medical / Scientific\n      'application/dicom',\n      'application/fits',\n      'application/x-hdf',\n      'application/x-netcdf',\n      'application/x-shapefile',\n      // Emerging Tech\n      'application/x-ai-model',\n      'application/x-blockchain',\n      'application/x-ar-vr',\n      'application/x-iot',\n      'application/x-quantum',\n      'application/x-neural',\n      'application/x-robotics',\n      'application/x-biotech',\n    ],\n    maxFileSizeMB: 2000,\n    monthlyFileLimit: null, // Unlimited\n    dailyFileLimit: null,\n    apiRequestsPerMonth: 5000,\n    features: {\n      basicExif: true,\n      imageProperties: true,\n      fileHashes: true,\n      filesystemMetadata: true,\n      gpsData: true,\n      calculatedFields: true,\n      makerNotes: true,\n      iptcXmp: true,\n      extendedAttributes: true,\n      serialNumbers: true,\n      rawFormats: true,\n      videoSupport: true,\n      audioSupport: true,\n      pdfSupport: true,\n      forensicAnalysis: true,\n      manipulationDetection: true,\n      timelineReconstruction: true,\n      batchUpload: true,\n      apiAccess: true,\n      priorityProcessing: true,\n      jsonExport: true,\n      csvExport: true,\n      pdfReport: true,\n      emailSupport: true,\n      prioritySupport: true,\n      dedicatedSupport: false,\n    },\n    fieldCount: '7,000+',\n    fieldCategories: ['*'],\n    description:\n      'Complete 7,000+ field extraction. Video, audio, batch processing. API access.',\n  },\n\n  // =========================================================================\n  // ENTERPRISE - Agency Tier ($149/month)\n  // =========================================================================\n  enterprise: {\n    name: 'enterprise',\n    displayName: 'Enterprise',\n    tagline: 'For agencies & legal teams',\n    price: 149,\n    priceLabel: '$149/month',\n    billingPeriod: 'month',\n    allowedFileTypes: ['*/*'], // All file types\n    maxFileSizeMB: 5000, // 5GB\n    monthlyFileLimit: null, // Unlimited\n    dailyFileLimit: null,\n    apiRequestsPerMonth: null, // Unlimited\n    features: {\n      basicExif: true,\n      imageProperties: true,\n      fileHashes: true,\n      filesystemMetadata: true,\n      gpsData: true,\n      calculatedFields: true,\n      makerNotes: true,\n      iptcXmp: true,\n      extendedAttributes: true,\n      serialNumbers: true,\n      rawFormats: true,\n      videoSupport: true,\n      audioSupport: true,\n      pdfSupport: true,\n      forensicAnalysis: true,\n      manipulationDetection: true,\n      timelineReconstruction: true,\n      batchUpload: true,\n      apiAccess: true,\n      priorityProcessing: true,\n      jsonExport: true,\n      csvExport: true,\n      pdfReport: true,\n      emailSupport: true,\n      prioritySupport: true,\n      dedicatedSupport: true,\n    },\n    fieldCount: '7,000+',\n    fieldCategories: ['*'],\n    description:\n      'Everything in Forensic + unlimited API, 5GB files, dedicated support, compliance reporting.',\n  },\n};\n\n// ============================================================================\n// Legacy tier mapping (for backwards compatibility)\n// ============================================================================\n\nexport const LEGACY_TIER_MAP: Record<string, TierName> = {\n  free: 'free',\n  starter: 'professional', // Old starter  new professional\n  premium: 'forensic', // Old premium  new forensic\n  super: 'enterprise', // Old super  new enterprise\n  pro: 'forensic', // Alias\n};\n\nexport function normalizeTier(tier: string | null | undefined): TierName {\n  if (!tier) return 'enterprise';\n  const normalized = tier.toLowerCase();\n  return (\n    LEGACY_TIER_MAP[normalized] ||\n    (TIER_CONFIGS[normalized as TierName]\n      ? (normalized as TierName)\n      : 'enterprise')\n  );\n}\n\nexport type PythonTierName = 'free' | 'starter' | 'premium' | 'super';\n\nconst PYTHON_TIER_MAP: Record<TierName, PythonTierName> = {\n  free: 'free',\n  professional: 'starter',\n  forensic: 'premium',\n  enterprise: 'super',\n};\n\nexport function toPythonTier(tier: string): PythonTierName {\n  const normalizedTier = normalizeTier(tier);\n  return PYTHON_TIER_MAP[normalizedTier] || 'super';\n}\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\n/**\n * Get tier configuration with dev mode override capability.\n *\n * In development mode (VITE_DEV_FULL_ACCESS=true), always returns enterprise config\n * to provide full access to all features without payment barriers.\n */\nexport function getTierConfig(tier: string): TierConfig {\n  // Dev mode: Full access for development\n  // NOTE: Avoid `import.meta` here so this file can be compiled by Jest/ts-jest\n  // in CommonJS mode. The Vite client entrypoint sets a global flag from\n  // `import.meta.env.VITE_DEV_FULL_ACCESS`.\n  const isDevMode =\n    (typeof globalThis !== 'undefined' &&\n      (globalThis as any).__METAEXTRACT_DEV_FULL_ACCESS__ === 'true') ||\n    (typeof process !== 'undefined' &&\n      process.env?.VITE_DEV_FULL_ACCESS === 'true');\n\n  if (isDevMode) {\n    console.log('[DEV MODE] Full access enabled - returning enterprise config');\n    return TIER_CONFIGS.enterprise;\n  }\n\n  const normalizedTier = normalizeTier(tier);\n  return TIER_CONFIGS[normalizedTier] || TIER_CONFIGS.free;\n}\n\nexport function isFileTypeAllowed(tier: string, mimeType: string): boolean {\n  // DEV MODE: Allow all file types for development testing\n  if (typeof process !== 'undefined' && process.env?.NODE_ENV === 'development') {\n    return true;\n  }\n\n  const config = getTierConfig(tier);\n\n  // Enterprise allows all\n  if (config.allowedFileTypes.includes('*/*')) return true;\n\n  // Check exact match\n  if (config.allowedFileTypes.includes(mimeType)) return true;\n\n  // Check wildcard match (e.g., \"image/*\")\n  const typePrefix = mimeType.split('/')[0];\n  if (config.allowedFileTypes.includes(`${typePrefix}/*`)) return true;\n\n  // Check if any allowed type matches the subtype\n  const subtype = mimeType.split('/')[1];\n  return config.allowedFileTypes.some((allowed) => {\n    const allowedSubtype = allowed.split('/')[1];\n    return allowedSubtype === subtype;\n  });\n}\n\nexport function isFileSizeAllowed(tier: string, sizeBytes: number): boolean {\n  // DEV MODE: Allow unlimited file size for development testing\n  if (typeof process !== 'undefined' && process.env?.NODE_ENV === 'development') {\n    return true;\n  }\n\n  const config = getTierConfig(tier);\n  const sizeMB = sizeBytes / (1024 * 1024);\n  return sizeMB <= config.maxFileSizeMB;\n}\n\nexport function getRequiredTierForFileType(mimeType: string): TierName {\n  // Video requires forensic\n  if (mimeType.startsWith('video/')) {\n    return 'forensic';\n  }\n\n  // Audio and PDF require forensic\n  if (mimeType.startsWith('audio/') || mimeType === 'application/pdf') {\n    return 'forensic';\n  }\n\n  // RAW images require professional\n  const rawIndicators = [\n    'raw',\n    'cr2',\n    'cr3',\n    'nef',\n    'arw',\n    'dng',\n    'orf',\n    'rw2',\n    'raf',\n    'pef',\n    'rwl',\n    '3fr',\n    'iiq',\n  ];\n  if (rawIndicators.some((ind) => mimeType.toLowerCase().includes(ind))) {\n    return 'professional';\n  }\n\n  // HEIC/HEIF requires professional\n  if (mimeType.includes('heic') || mimeType.includes('heif')) {\n    return 'professional';\n  }\n\n  // SVG requires forensic\n  if (mimeType === 'image/svg+xml') {\n    return 'forensic';\n  }\n\n  // Standard images are free\n  return 'free';\n}\n\nexport function canAccessFeature(\n  tier: string,\n  feature: keyof TierConfig['features']\n): boolean {\n  const config = getTierConfig(tier);\n  return config.features[feature] === true;\n}\n\n// ============================================================================\n// Field Category Labels\n// ============================================================================\n\nexport const TIER_FIELD_LABELS: Record<string, string> = {\n  summary: 'File Summary',\n  basic_exif: 'Basic EXIF',\n  exif: 'Full EXIF Data',\n  image: 'Image Properties',\n  gps: 'GPS/Location Data',\n  filesystem: 'Filesystem Metadata',\n  hashes: 'File Integrity (Hashes)',\n  calculated: 'Calculated Fields',\n  forensic: 'Forensic Evidence',\n  makernote: 'Camera MakerNotes',\n  iptc: 'IPTC Metadata',\n  xmp: 'XMP Metadata',\n  video: 'Video Properties',\n  audio: 'Audio Properties',\n  pdf: 'PDF Document Info',\n  svg: 'SVG Metadata',\n  extended_attributes: 'Extended Attributes',\n};\n\n// ============================================================================\n// Credit Costs (for pay-per-use)\n// ============================================================================\n\nexport const CREDIT_COSTS: Record<string, number> = {\n  // Standard images\n  'image/jpeg': 1,\n  'image/png': 1,\n  'image/gif': 1,\n  'image/webp': 1,\n  'image/bmp': 1,\n  'image/tiff': 1,\n\n  // RAW images (more processing)\n  'image/heic': 2,\n  'image/heif': 2,\n  'image/x-canon-cr2': 2,\n  'image/x-canon-cr3': 2,\n  'image/x-nikon-nef': 2,\n  'image/x-sony-arw': 2,\n  'image/x-adobe-dng': 2,\n  'image/x-olympus-orf': 2,\n  'image/x-panasonic-rw2': 2,\n  'image/x-fuji-raf': 2,\n\n  // Video (heavy processing)\n  'video/mp4': 5,\n  'video/quicktime': 5,\n  'video/x-msvideo': 5,\n  'video/webm': 5,\n  'video/x-matroska': 5,\n\n  // Audio\n  'audio/mpeg': 2,\n  'audio/wav': 2,\n  'audio/flac': 2,\n  'audio/ogg': 2,\n\n  // Documents\n  'application/pdf': 2,\n  'image/svg+xml': 1,\n\n  // Default\n  default: 2,\n};\n\nexport function getCreditCost(mimeType: string): number {\n  return CREDIT_COSTS[mimeType] || CREDIT_COSTS['default'];\n}\n\n// ============================================================================\n// Credit Pack Definitions\n// ============================================================================\n\nexport interface CreditPack {\n  id: string;\n  name: string;\n  credits: number;\n  price: number;\n  priceDisplay: string;\n  pricePerCredit: string;\n  description: string;\n  popular?: boolean;\n}\n\nexport const CREDIT_PACKS: CreditPack[] = [\n  {\n    id: 'single',\n    name: 'Single Analysis',\n    credits: 1,\n    price: 200, // $2.00 in cents\n    priceDisplay: '$2',\n    pricePerCredit: '$2.00/file',\n    description: '1 full forensic analysis',\n  },\n  {\n    id: 'investigation',\n    name: 'Investigation Pack',\n    credits: 10,\n    price: 1500, // $15.00\n    priceDisplay: '$15',\n    pricePerCredit: '$1.50/file',\n    description: '10 file analyses - perfect for small cases',\n    popular: true,\n  },\n  {\n    id: 'case',\n    name: 'Case Pack',\n    credits: 50,\n    price: 5000, // $50.00\n    priceDisplay: '$50',\n    pricePerCredit: '$1.00/file',\n    description: '50 file analyses - best value',\n  },\n  {\n    id: 'agency',\n    name: 'Agency Pack',\n    credits: 200,\n    price: 15000, // $150.00\n    priceDisplay: '$150',\n    pricePerCredit: '$0.75/file',\n    description: '200 file analyses - bulk discount',\n  },\n];\n\n// ============================================================================\n// Rate Limiting Configuration\n// ============================================================================\n\nexport interface RateLimitConfig {\n  maxRequestsPerMinute: number;\n  maxRequestsPerHour: number;\n  maxRequestsPerDay: number;\n}\n\nexport const RATE_LIMITS: Record<TierName, RateLimitConfig> = {\n  free: {\n    maxRequestsPerMinute: 3,\n    maxRequestsPerHour: 10,\n    maxRequestsPerDay: 3, // Matches dailyFileLimit\n  },\n  professional: {\n    maxRequestsPerMinute: 10,\n    maxRequestsPerHour: 100,\n    maxRequestsPerDay: 500, // Matches monthlyFileLimit / 30\n  },\n  forensic: {\n    maxRequestsPerMinute: 30,\n    maxRequestsPerHour: 500,\n    maxRequestsPerDay: 5000,\n  },\n  enterprise: {\n    maxRequestsPerMinute: 100,\n    maxRequestsPerHour: 2000,\n    maxRequestsPerDay: 50000,\n  },\n};\n\n// Field count by tier for UI display\nexport const TIER_FIELD_COUNTS: Record<TierName, number> = {\n  free: 200,\n  professional: 1000,\n  forensic: 15000,\n  enterprise: 45000, // configurable goal; update as targets evolve\n};\n\n// Alias for backwards compatibility\nexport const fieldsPerFile = TIER_FIELD_COUNTS;\n\nexport function getRateLimits(tier: string): {\n  requestsPerMinute: number;\n  requestsPerDay: number;\n} {\n  const normalizedTier = normalizeTier(tier);\n  const limits = RATE_LIMITS[normalizedTier] || RATE_LIMITS.free;\n  return {\n    requestsPerMinute: limits.maxRequestsPerMinute,\n    requestsPerDay: limits.maxRequestsPerDay,\n  };\n}\n","usedDeprecatedRules":[]}]