<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MetaExtract - Simple Visual Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #0B0C10;
            color: white;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-card {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .status {
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: bold;
            margin: 10px 0;
        }
        .success { background: #10b981; }
        .error { background: #ef4444; }
        .pending { background: #f59e0b; }
        button {
            background: #6366f1;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px 10px 10px 0;
            font-size: 14px;
        }
        button:hover { background: #5855eb; }
        .log {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin: 15px 0;
        }
        .iframe-container {
            border: 2px solid #444;
            border-radius: 8px;
            overflow: hidden;
            margin: 20px 0;
        }
        .iframe-container iframe {
            width: 100%;
            height: 600px;
            border: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ MetaExtract - Simple Visual Test</h1>
        <p>Quick visual test of core functionality</p>

        <!-- Quick Tests -->
        <div class="test-card">
            <h3>üîß Quick Tests</h3>
            <button onclick="runAllTests()">Run All Tests</button>
            <button onclick="testUpload()">Test File Upload</button>
            <button onclick="testTiers()">Test Tiers</button>
            <button onclick="openFrontend()">Open Frontend</button>
            
            <div id="test-status" class="status pending">Ready to test</div>
            <div id="test-log" class="log">Click "Run All Tests" to start...</div>
        </div>

        <!-- File Upload Test -->
        <div class="test-card">
            <h3>üìÅ File Upload Test</h3>
            <input type="file" id="file-input" accept="image/*" style="margin: 10px 0;">
            <button onclick="uploadFile()">Upload & Analyze</button>
            <div id="upload-log" class="log">Select a file and click upload...</div>
        </div>

        <!-- Live Frontend -->
        <div class="test-card">
            <h3>üñ•Ô∏è Live Frontend</h3>
            <div class="iframe-container">
                <iframe src="http://localhost:3000" title="MetaExtract Frontend"></iframe>
            </div>
            <button onclick="refreshIframe()">Refresh</button>
            <button onclick="openInNewTab()">Open in New Tab</button>
        </div>
    </div>

    <script>
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : '#74c0fc';
            element.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            element.scrollTop = element.scrollHeight;
        }

        function setStatus(status, type) {
            const element = document.getElementById('test-status');
            element.textContent = status;
            element.className = `status ${type}`;
        }

        async function runAllTests() {
            setStatus('Running tests...', 'pending');
            log('test-log', 'Starting comprehensive test suite...');
            
            // Test 1: Health Check
            log('test-log', '1. Testing server health...');
            try {
                const response = await fetch('http://localhost:3000/api/health');
                const data = await response.json();
                log('test-log', `‚úÖ Server: ${data.service} v${data.version}`, 'success');
            } catch (error) {
                log('test-log', `‚ùå Health check failed: ${error.message}`, 'error');
            }

            // Test 2: Frontend
            log('test-log', '2. Testing frontend access...');
            try {
                const response = await fetch('http://localhost:3000/');
                if (response.ok) {
                    log('test-log', '‚úÖ Frontend accessible', 'success');
                } else {
                    log('test-log', `‚ùå Frontend error: ${response.status}`, 'error');
                }
            } catch (error) {
                log('test-log', `‚ùå Frontend error: ${error.message}`, 'error');
            }

            // Test 3: File Upload (with test image)
            log('test-log', '3. Testing file upload...');
            try {
                const response = await fetch('http://localhost:3000/test.jpg');
                const blob = await response.blob();
                const formData = new FormData();
                formData.append('file', blob, 'test.jpg');
                
                const uploadResponse = await fetch('http://localhost:3000/api/extract?tier=free', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await uploadResponse.json();
                log('test-log', `‚úÖ Upload successful: ${data.fields_extracted} fields`, 'success');
            } catch (error) {
                log('test-log', `‚ùå Upload failed: ${error.message}`, 'error');
            }

            // Test 4: Tiers
            log('test-log', '4. Testing tier system...');
            const tiers = ['free', 'professional', 'forensic', 'enterprise'];
            
            for (const tier of tiers) {
                try {
                    const response = await fetch('http://localhost:3000/test.jpg');
                    const blob = await response.blob();
                    const formData = new FormData();
                    formData.append('file', blob, 'test.jpg');
                    
                    const tierResponse = await fetch(`http://localhost:3000/api/extract?tier=${tier}`, {
                        method: 'POST',
                        body: formData
                    });
                    
                    const data = await tierResponse.json();
                    log('test-log', `‚úÖ ${tier}: ${data.fields_extracted} fields`, 'success');
                } catch (error) {
                    log('test-log', `‚ùå ${tier}: ${error.message}`, 'error');
                }
            }

            // Test 5: Advanced Features
            log('test-log', '5. Testing advanced features...');
            try {
                const response = await fetch('http://localhost:3000/api/forensic/capabilities?tier=enterprise');
                const data = await response.json();
                log('test-log', `‚úÖ Forensic modules: ${data.modules.length}`, 'success');
            } catch (error) {
                log('test-log', `‚ùå Advanced features: ${error.message}`, 'error');
            }

            setStatus('Tests complete!', 'success');
            log('test-log', 'üéâ All tests finished!', 'success');
        }

        async function testUpload() {
            log('test-log', 'Testing upload functionality...');
            try {
                const response = await fetch('http://localhost:3000/test.jpg');
                const blob = await response.blob();
                const formData = new FormData();
                formData.append('file', blob, 'test.jpg');
                
                const uploadResponse = await fetch('http://localhost:3000/api/extract?tier=professional', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await uploadResponse.json();
                log('test-log', `‚úÖ Upload test: ${data.filename} - ${data.fields_extracted} fields`, 'success');
            } catch (error) {
                log('test-log', `‚ùå Upload test failed: ${error.message}`, 'error');
            }
        }

        async function testTiers() {
            log('test-log', 'Testing tier access levels...');
            const tiers = ['free', 'professional', 'forensic', 'enterprise'];
            
            for (const tier of tiers) {
                try {
                    const response = await fetch(`http://localhost:3000/api/forensic/capabilities?tier=${tier}`);
                    const data = await response.json();
                    
                    if (response.ok) {
                        log('test-log', `‚úÖ ${tier}: ${data.modules.length} modules available`, 'success');
                    } else {
                        log('test-log', `‚ö†Ô∏è ${tier}: ${data.error}`, 'error');
                    }
                } catch (error) {
                    log('test-log', `‚ùå ${tier}: ${error.message}`, 'error');
                }
            }
        }

        async function uploadFile() {
            const fileInput = document.getElementById('file-input');
            const file = fileInput.files[0];
            
            if (!file) {
                log('upload-log', '‚ùå No file selected', 'error');
                return;
            }

            log('upload-log', `Uploading ${file.name}...`);
            
            try {
                const formData = new FormData();
                formData.append('file', file);
                
                const response = await fetch('http://localhost:3000/api/extract?tier=professional', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    log('upload-log', `‚úÖ Success: ${data.filename}`, 'success');
                    log('upload-log', `üìä Fields extracted: ${data.fields_extracted}`, 'success');
                    log('upload-log', `üìÅ File size: ${data.filesize}`, 'info');
                    log('upload-log', `üéØ Tier: ${data.tier}`, 'info');
                } else {
                    log('upload-log', `‚ùå Upload failed: ${data.error}`, 'error');
                }
            } catch (error) {
                log('upload-log', `‚ùå Upload error: ${error.message}`, 'error');
            }
        }

        function openFrontend() {
            window.open('http://localhost:3000', '_blank');
        }

        function refreshIframe() {
            const iframe = document.querySelector('iframe');
            iframe.src = iframe.src;
        }

        function openInNewTab() {
            window.open('http://localhost:3000', '_blank');
        }

        // Auto-run basic test on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('test-log', 'Page loaded. Ready for testing!');
                log('test-log', 'Click "Run All Tests" to start automated testing.');
            }, 500);
        });
    </script>
</body>
</html>